(self.webpackChunkmy_wedding=self.webpackChunkmy_wedding||[]).push([[179],{416:(I_,Uh,$h)=>{"use strict";function bi(e){return"function"==typeof e}function Df(e){const i=e(a=>{Error.call(a),a.stack=(new Error).stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}const S_=Df(e=>function(i){e(this),this.message=i?`${i.length} errors occurred during unsubscription:\n${i.map((a,u)=>`${u+1}) ${a.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=i});function d(e,r){if(e){const i=e.indexOf(r);0<=i&&e.splice(i,1)}}class Zt{constructor(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let r;if(!this.closed){this.closed=!0;const{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(const _ of i)_.remove(this);else i.remove(this);const{initialTeardown:a}=this;if(bi(a))try{a()}catch(_){r=_ instanceof S_?_.errors:[_]}const{_finalizers:u}=this;if(u){this._finalizers=null;for(const _ of u)try{Ea(_)}catch(b){r=r??[],b instanceof S_?r=[...r,...b.errors]:r.push(b)}}if(r)throw new S_(r)}}add(r){var i;if(r&&r!==this)if(this.closed)Ea(r);else{if(r instanceof Zt){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=null!==(i=this._finalizers)&&void 0!==i?i:[]).push(r)}}_hasParent(r){const{_parentage:i}=this;return i===r||Array.isArray(i)&&i.includes(r)}_addParent(r){const{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(r),i):i?[i,r]:r}_removeParent(r){const{_parentage:i}=this;i===r?this._parentage=null:Array.isArray(i)&&d(i,r)}remove(r){const{_finalizers:i}=this;i&&d(i,r),r instanceof Zt&&r._removeParent(this)}}Zt.EMPTY=(()=>{const e=new Zt;return e.closed=!0,e})();const is=Zt.EMPTY;function fn(e){return e instanceof Zt||e&&"closed"in e&&bi(e.remove)&&bi(e.add)&&bi(e.unsubscribe)}function Ea(e){bi(e)?e():e.unsubscribe()}const bn={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ao={setTimeout(e,r,...i){const{delegate:a}=ao;return a?.setTimeout?a.setTimeout(e,r,...i):setTimeout(e,r,...i)},clearTimeout(e){const{delegate:r}=ao;return(r?.clearTimeout||clearTimeout)(e)},delegate:void 0};function bs(e){ao.setTimeout(()=>{const{onUnhandledError:r}=bn;if(!r)throw e;r(e)})}function rs(){}const Al=Xa("C",void 0,void 0);function Xa(e,r,i){return{kind:e,value:r,error:i}}let Go=null;function ws(e){if(bn.useDeprecatedSynchronousErrorHandling){const r=!Go;if(r&&(Go={errorThrown:!1,error:null}),e(),r){const{errorThrown:i,error:a}=Go;if(Go=null,i)throw a}}else e()}class Es extends Zt{constructor(r){super(),this.isStopped=!1,r?(this.destination=r,fn(r)&&r.add(this)):this.destination=Cs}static create(r,i,a){return new Cn(r,i,a)}next(r){this.isStopped?_t(function $o(e){return Xa("N",e,void 0)}(r),this):this._next(r)}error(r){this.isStopped?_t(function Gh(e){return Xa("E",void 0,e)}(r),this):(this.isStopped=!0,this._error(r))}complete(){this.isStopped?_t(Al,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(r){this.destination.next(r)}_error(r){try{this.destination.error(r)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ht=Function.prototype.bind;function Ca(e,r){return ht.call(e,r)}class gu{constructor(r){this.partialObserver=r}next(r){const{partialObserver:i}=this;if(i.next)try{i.next(r)}catch(a){Er(a)}}error(r){const{partialObserver:i}=this;if(i.error)try{i.error(r)}catch(a){Er(a)}else Er(r)}complete(){const{partialObserver:r}=this;if(r.complete)try{r.complete()}catch(i){Er(i)}}}class Cn extends Es{constructor(r,i,a){let u;if(super(),bi(r)||!r)u={next:r??void 0,error:i??void 0,complete:a??void 0};else{let _;this&&bn.useDeprecatedNextContext?(_=Object.create(r),_.unsubscribe=()=>this.unsubscribe(),u={next:r.next&&Ca(r.next,_),error:r.error&&Ca(r.error,_),complete:r.complete&&Ca(r.complete,_)}):u=r}this.destination=new gu(u)}}function Er(e){bn.useDeprecatedSynchronousErrorHandling?function Ka(e){bn.useDeprecatedSynchronousErrorHandling&&Go&&(Go.errorThrown=!0,Go.error=e)}(e):bs(e)}function _t(e,r){const{onStoppedNotification:i}=bn;i&&ao.setTimeout(()=>i(e,r))}const Cs={closed:!0,next:rs,error:function Hh(e){throw e},complete:rs},qr="function"==typeof Symbol&&Symbol.observable||"@@observable";function on(e){return e}function Da(e){return 0===e.length?on:1===e.length?e[0]:function(i){return e.reduce((a,u)=>u(a),i)}}let Di=(()=>{class e{constructor(i){i&&(this._subscribe=i)}lift(i){const a=new e;return a.source=this,a.operator=i,a}subscribe(i,a,u){const _=function bc(e){return e&&e instanceof Es||function Rl(e){return e&&bi(e.next)&&bi(e.error)&&bi(e.complete)}(e)&&fn(e)}(i)?i:new Cn(i,a,u);return ws(()=>{const{operator:b,source:M}=this;_.add(b?b.call(_,M):M?this._subscribe(_):this._trySubscribe(_))}),_}_trySubscribe(i){try{return this._subscribe(i)}catch(a){i.error(a)}}forEach(i,a){return new(a=Vr(a))((u,_)=>{const b=new Cn({next:M=>{try{i(M)}catch(R){_(R),b.unsubscribe()}},error:_,complete:u});this.subscribe(b)})}_subscribe(i){var a;return null===(a=this.source)||void 0===a?void 0:a.subscribe(i)}[qr](){return this}pipe(...i){return Da(i)(this)}toPromise(i){return new(i=Vr(i))((a,u)=>{let _;this.subscribe(b=>_=b,b=>u(b),()=>a(_))})}}return e.create=r=>new e(r),e})();function Vr(e){var r;return null!==(r=e??bn.Promise)&&void 0!==r?r:Promise}const _u=Df(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Ti=(()=>{class e extends Di{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){const a=new wc(this,this);return a.operator=i,a}_throwIfClosed(){if(this.closed)throw new _u}next(i){ws(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const a of this.currentObservers)a.next(i)}})}error(i){ws(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;const{observers:a}=this;for(;a.length;)a.shift().error(i)}})}complete(){ws(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return(null===(i=this.observers)||void 0===i?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){const{hasError:a,isStopped:u,observers:_}=this;return a||u?is:(this.currentObservers=null,_.push(i),new Zt(()=>{this.currentObservers=null,d(_,i)}))}_checkFinalizedStatuses(i){const{hasError:a,thrownError:u,isStopped:_}=this;a?i.error(u):_&&i.complete()}asObservable(){const i=new Di;return i.source=this,i}}return e.create=(r,i)=>new wc(r,i),e})();class wc extends Ti{constructor(r,i){super(),this.destination=r,this.source=i}next(r){var i,a;null===(a=null===(i=this.destination)||void 0===i?void 0:i.next)||void 0===a||a.call(i,r)}error(r){var i,a;null===(a=null===(i=this.destination)||void 0===i?void 0:i.error)||void 0===a||a.call(i,r)}complete(){var r,i;null===(i=null===(r=this.destination)||void 0===r?void 0:r.complete)||void 0===i||i.call(r)}_subscribe(r){var i,a;return null!==(a=null===(i=this.source)||void 0===i?void 0:i.subscribe(r))&&void 0!==a?a:is}}function Ja(e){return bi(e?.lift)}function Fi(e){return r=>{if(Ja(r))return r.lift(function(i){try{return e(i,this)}catch(a){this.error(a)}});throw new TypeError("Unable to lift unknown Observable type")}}function si(e,r,i,a,u){return new os(e,r,i,a,u)}class os extends Es{constructor(r,i,a,u,_,b){super(r),this.onFinalize=_,this.shouldUnsubscribe=b,this._next=i?function(M){try{i(M)}catch(R){r.error(R)}}:super._next,this._error=u?function(M){try{u(M)}catch(R){r.error(R)}finally{this.unsubscribe()}}:super._error,this._complete=a?function(){try{a()}catch(M){r.error(M)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:i}=this;super.unsubscribe(),!i&&(null===(r=this.onFinalize)||void 0===r||r.call(this))}}}function ti(e,r){return Fi((i,a)=>{let u=0;i.subscribe(si(a,_=>{a.next(e.call(r,_,u++))}))})}function wt(e){return this instanceof wt?(this.v=e,this):new wt(e)}function Et(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=e[Symbol.asyncIterator];return r?r.call(e):(e=function le(e){var r="function"==typeof Symbol&&Symbol.iterator,i=r&&e[r],a=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i);function a(_){i[_]=e[_]&&function(b){return new Promise(function(M,R){!function u(_,b,M,R){Promise.resolve(R).then(function(z){_({value:z,done:M})},b)}(M,R,(b=e[_](b)).done,b.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Zr=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Wr(e){return bi(e?.then)}function mo(e){return bi(e[qr])}function cr(e){return Symbol.asyncIterator&&bi(e?.[Symbol.asyncIterator])}function lr(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const ze=function Le(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Ke(e){return bi(e?.[ze])}function ot(e){return function Ne(e,r,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,a=i.apply(e,r||[]),_=[];return u={},b("next"),b("throw"),b("return"),u[Symbol.asyncIterator]=function(){return this},u;function b(ce){a[ce]&&(u[ce]=function(me){return new Promise(function(Me,ke){_.push([ce,me,Me,ke])>1||M(ce,me)})})}function M(ce,me){try{!function R(ce){ce.value instanceof wt?Promise.resolve(ce.value.v).then(z,$):K(_[0][2],ce)}(a[ce](me))}catch(Me){K(_[0][3],Me)}}function z(ce){M("next",ce)}function $(ce){M("throw",ce)}function K(ce,me){ce(me),_.shift(),_.length&&M(_[0][0],_[0][1])}}(this,arguments,function*(){const i=e.getReader();try{for(;;){const{value:a,done:u}=yield wt(i.read());if(u)return yield wt(void 0);yield yield wt(a)}}finally{i.releaseLock()}})}function it(e){return bi(e?.getReader)}function tt(e){if(e instanceof Di)return e;if(null!=e){if(mo(e))return function mt(e){return new Di(r=>{const i=e[qr]();if(bi(i.subscribe))return i.subscribe(r);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Zr(e))return function st(e){return new Di(r=>{for(let i=0;i<e.length&&!r.closed;i++)r.next(e[i]);r.complete()})}(e);if(Wr(e))return function vt(e){return new Di(r=>{e.then(i=>{r.closed||(r.next(i),r.complete())},i=>r.error(i)).then(null,bs)})}(e);if(cr(e))return Wt(e);if(Ke(e))return function ct(e){return new Di(r=>{for(const i of e)if(r.next(i),r.closed)return;r.complete()})}(e);if(it(e))return function An(e){return Wt(ot(e))}(e)}throw lr(e)}function Wt(e){return new Di(r=>{(function Nt(e,r){var i,a,u,_;return function Ks(e,r,i,a){return new(i||(i=Promise))(function(_,b){function M($){try{z(a.next($))}catch(K){b(K)}}function R($){try{z(a.throw($))}catch(K){b(K)}}function z($){$.done?_($.value):function u(_){return _ instanceof i?_:new i(function(b){b(_)})}($.value).then(M,R)}z((a=a.apply(e,r||[])).next())})}(this,void 0,void 0,function*(){try{for(i=Et(e);!(a=yield i.next()).done;)if(r.next(a.value),r.closed)return}catch(b){u={error:b}}finally{try{a&&!a.done&&(_=i.return)&&(yield _.call(i))}finally{if(u)throw u.error}}r.complete()})})(e,r).catch(i=>r.error(i))})}function Hn(e,r,i,a=0,u=!1){const _=r.schedule(function(){i(),u?e.add(this.schedule(null,a)):this.unsubscribe()},a);if(e.add(_),!u)return _}function Un(e,r,i=1/0){return bi(r)?Un((a,u)=>ti((_,b)=>r(a,_,u,b))(tt(e(a,u))),i):("number"==typeof r&&(i=r),Fi((a,u)=>function Ni(e,r,i,a,u,_,b,M){const R=[];let z=0,$=0,K=!1;const ce=()=>{K&&!R.length&&!z&&r.complete()},me=ke=>z<a?Me(ke):R.push(ke),Me=ke=>{_&&r.next(ke),z++;let ut=!1;tt(i(ke,$++)).subscribe(si(r,It=>{u?.(It),_?me(It):r.next(It)},()=>{ut=!0},void 0,()=>{if(ut)try{for(z--;R.length&&z<a;){const It=R.shift();b?Hn(r,b,()=>Me(It)):Me(It)}ce()}catch(It){r.error(It)}}))};return e.subscribe(si(r,me,()=>{K=!0,ce()})),()=>{M?.()}}(a,u,e,i)))}function qi(e=1/0){return Un(on,e)}const Zi=new Di(e=>e.complete());function as(e){return e&&bi(e.schedule)}function Dr(e){return e[e.length-1]}function ls(e){return as(Dr(e))?e.pop():void 0}function qh(e,r=0){return Fi((i,a)=>{i.subscribe(si(a,u=>Hn(a,e,()=>a.next(u),r),()=>Hn(a,e,()=>a.complete(),r),u=>Hn(a,e,()=>a.error(u),r)))})}function el(e,r=0){return Fi((i,a)=>{a.add(e.schedule(()=>i.subscribe(a),r))})}function Wh(e,r){if(!e)throw new Error("Iterable cannot be null");return new Di(i=>{Hn(i,r,()=>{const a=e[Symbol.asyncIterator]();Hn(i,r,()=>{a.next().then(u=>{u.done?i.complete():i.next(u.value)})},0,!0)})})}function ki(e,r){return r?function Mf(e,r){if(null!=e){if(mo(e))return function Tf(e,r){return tt(e).pipe(el(r),qh(r))}(e,r);if(Zr(e))return function gm(e,r){return new Di(i=>{let a=0;return r.schedule(function(){a===e.length?i.complete():(i.next(e[a++]),i.closed||this.schedule())})})}(e,r);if(Wr(e))return function Tc(e,r){return tt(e).pipe(el(r),qh(r))}(e,r);if(cr(e))return Wh(e,r);if(Ke(e))return function Zh(e,r){return new Di(i=>{let a;return Hn(i,r,()=>{a=e[ze](),Hn(i,r,()=>{let u,_;try{({value:u,done:_}=a.next())}catch(b){return void i.error(b)}_?i.complete():i.next(u)},0,!0)}),()=>bi(a?.return)&&a.return()})}(e,r);if(it(e))return function Yh(e,r){return Wh(ot(e),r)}(e,r)}throw lr(e)}(e,r):tt(e)}function ir(...e){const r=ls(e),i=function Dc(e,r){return"number"==typeof Dr(e)?e.pop():r}(e,1/0),a=e;return a.length?1===a.length?tt(a[0]):qi(i)(ki(a,r)):Zi}class rn extends Ti{constructor(r){super(),this._value=r}get value(){return this.getValue()}_subscribe(r){const i=super._subscribe(r);return!i.closed&&r.next(this._value),i}getValue(){const{hasError:r,thrownError:i,_value:a}=this;if(r)throw i;return this._throwIfClosed(),a}next(r){super.next(this._value=r)}}function Sn(...e){return ki(e,ls(e))}function bu(e={}){const{connector:r=(()=>new Ti),resetOnError:i=!0,resetOnComplete:a=!0,resetOnRefCountZero:u=!0}=e;return _=>{let b,M,R,z=0,$=!1,K=!1;const ce=()=>{M?.unsubscribe(),M=void 0},me=()=>{ce(),b=R=void 0,$=K=!1},Me=()=>{const ke=b;me(),ke?.unsubscribe()};return Fi((ke,ut)=>{z++,!K&&!$&&ce();const It=R=R??r();ut.add(()=>{z--,0===z&&!K&&!$&&(M=wu(Me,u))}),It.subscribe(ut),!b&&z>0&&(b=new Cn({next:Ye=>It.next(Ye),error:Ye=>{K=!0,ce(),M=wu(me,i,Ye),It.error(Ye)},complete:()=>{$=!0,ce(),M=wu(me,a),It.complete()}}),tt(ke).subscribe(b))})(_)}}function wu(e,r,...i){if(!0===r)return void e();if(!1===r)return;const a=new Cn({next:()=>{a.unsubscribe(),e()}});return tt(r(...i)).subscribe(a)}function Js(e,r){return Fi((i,a)=>{let u=null,_=0,b=!1;const M=()=>b&&!u&&a.complete();i.subscribe(si(a,R=>{u?.unsubscribe();let z=0;const $=_++;tt(e(R,$)).subscribe(u=si(a,K=>a.next(r?r(R,K,$,z++):K),()=>{u=null,M()}))},()=>{b=!0,M()}))})}function Ds(e,r=on){return e=e??If,Fi((i,a)=>{let u,_=!0;i.subscribe(si(a,b=>{const M=r(b);(_||!e(u,M))&&(_=!1,u=M,a.next(b))}))})}function If(e,r){return e===r}function zi(e){for(let r in e)if(e[r]===zi)return r;throw Error("Could not find renamed property on target object.")}function Ma(e,r){for(const i in r)r.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(e[i]=r[i])}function at(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(at).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const r=e.toString();if(null==r)return""+r;const i=r.indexOf("\n");return-1===i?r:r.substring(0,i)}function $n(e,r){return null==e||""===e?null===r?"":r:null==r||""===r?e:e+" "+r}const Xn=zi({__forward_ref__:zi});function So(e){return e.__forward_ref__=So,e.toString=function(){return at(this())},e}function wn(e){return On(e)?e():e}function On(e){return"function"==typeof e&&e.hasOwnProperty(Xn)&&e.__forward_ref__===So}function Mc(e){return e&&!!e.\u0275providers}const Ic="https://g.co/ng/security#xss";class xt extends Error{constructor(r,i){super(function Wi(e,r){return`NG0${Math.abs(e)}${r?": "+r:""}`}(r,i)),this.code=r}}function rt(e){return"string"==typeof e?e:null==e?"":String(e)}function tl(e,r){throw new xt(-201,!1)}function jr(e,r){null==e&&function gn(e,r,i,a){throw new Error(`ASSERTION ERROR: ${e}`+(null==a?"":` [Expected=> ${i} ${a} ${r} <=Actual]`))}(r,e,null,"!=")}function $t(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function rr(e){return{providers:e.providers||[],imports:e.imports||[]}}function Du(e){return Ac(e,Kh)||Ac(e,Sa)}function Ac(e,r){return e.hasOwnProperty(r)?e[r]:null}function Xh(e){return e&&(e.hasOwnProperty(ea)||e.hasOwnProperty(Jh))?e[ea]:null}const Kh=zi({\u0275prov:zi}),ea=zi({\u0275inj:zi}),Sa=zi({ngInjectableDef:zi}),Jh=zi({ngInjectorDef:zi});var Kn=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Kn||{});let Tu;function xr(e){const r=Tu;return Tu=e,r}function Rc(e,r,i){const a=Du(e);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:i&Kn.Optional?null:void 0!==r?r:void tl(at(e))}const $i=globalThis;class Bt{constructor(r,i){this._desc=r,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof i?this.__NG_ELEMENT_ID__=i:void 0!==i&&(this.\u0275prov=$t({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const rl={},Au="__NG_DI_FLAG__",ol="ngTempTokenPath",sl=/\n/gm,td="__source";let cs;function Ao(e){const r=cs;return cs=e,r}function Of(e,r=Kn.Default){if(void 0===cs)throw new xt(-203,!1);return null===cs?Rc(e,void 0,r):cs.get(e,r&Kn.Optional?null:void 0,r)}function Qe(e,r=Kn.Default){return(function ta(){return Tu}()||Of)(wn(e),r)}function Xt(e,r=Kn.Default){return Qe(e,Ru(r))}function Ru(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function id(e){const r=[];for(let i=0;i<e.length;i++){const a=wn(e[i]);if(Array.isArray(a)){if(0===a.length)throw new xt(900,!1);let u,_=Kn.Default;for(let b=0;b<a.length;b++){const M=a[b],R=P_(M);"number"==typeof R?-1===R?u=M.token:_|=R:u=M}r.push(Qe(u,_))}else r.push(Qe(a))}return r}function Nl(e,r){return e[Au]=r,e.prototype[Au]=r,e}function P_(e){return e[Au]}function na(e){return{toString:e}.toString()}var al=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(al||{}),As=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(As||{});const qo={},wi=[],Pu=zi({\u0275cmp:zi}),Ou=zi({\u0275dir:zi}),kc=zi({\u0275pipe:zi}),rd=zi({\u0275mod:zi}),go=zi({\u0275fac:zi}),ll=zi({__NG_ELEMENT_ID__:zi}),Lc=zi({__NG_ENV_ID__:zi});function od(e,r,i){let a=e.length;for(;;){const u=e.indexOf(r,i);if(-1===u)return u;if(0===u||e.charCodeAt(u-1)<=32){const _=r.length;if(u+_===a||e.charCodeAt(u+_)<=32)return u}i=u+1}}function zl(e,r,i){let a=0;for(;a<i.length;){const u=i[a];if("number"==typeof u){if(0!==u)break;a++;const _=i[a++],b=i[a++],M=i[a++];e.setAttribute(r,b,M,_)}else{const _=u,b=i[++a];Vl(_)?e.setProperty(r,_,b):e.setAttribute(r,_,b),a++}}return a}function Bl(e){return 3===e||4===e||6===e}function Vl(e){return 64===e.charCodeAt(0)}function Aa(e,r){if(null!==r&&0!==r.length)if(null===e||0===e.length)e=r.slice();else{let i=-1;for(let a=0;a<r.length;a++){const u=r[a];"number"==typeof u?i=u:0===i||Fc(e,i,u,null,-1===i||2===i?r[++a]:null)}}return e}function Fc(e,r,i,a,u){let _=0,b=e.length;if(-1===r)b=-1;else for(;_<e.length;){const M=e[_++];if("number"==typeof M){if(M===r){b=-1;break}if(M>r){b=_-1;break}}}for(;_<e.length;){const M=e[_];if("number"==typeof M)break;if(M===i){if(null===a)return void(null!==u&&(e[_+1]=u));if(a===e[_+1])return void(e[_+2]=u)}_++,null!==a&&_++,null!==u&&_++}-1!==b&&(e.splice(b,0,r),_=b+1),e.splice(_++,0,i),null!==a&&e.splice(_++,0,a),null!==u&&e.splice(_++,0,u)}const kr="ng-template";function cl(e,r,i){let a=0,u=!0;for(;a<e.length;){let _=e[a++];if("string"==typeof _&&u){const b=e[a++];if(i&&"class"===_&&-1!==od(b.toLowerCase(),r,0))return!0}else{if(1===_){for(;a<e.length&&"string"==typeof(_=e[a++]);)if(_.toLowerCase()===r)return!0;return!1}"number"==typeof _&&(u=!1)}}return!1}function lo(e){return 4===e.type&&e.value!==kr}function kf(e,r,i){return r===(4!==e.type||i?e.value:kr)}function bm(e,r,i){let a=4;const u=e.attrs||[],_=function wm(e){for(let r=0;r<e.length;r++)if(Bl(e[r]))return r;return e.length}(u);let b=!1;for(let M=0;M<r.length;M++){const R=r[M];if("number"!=typeof R){if(!b)if(4&a){if(a=2|1&a,""!==R&&!kf(e,R,i)||""===R&&1===r.length){if(Zo(a))return!1;b=!0}}else{const z=8&a?R:r[++M];if(8&a&&null!==e.attrs){if(!cl(e.attrs,z,i)){if(Zo(a))return!1;b=!0}continue}const K=jl(8&a?"class":R,u,lo(e),i);if(-1===K){if(Zo(a))return!1;b=!0;continue}if(""!==z){let ce;ce=K>_?"":u[K+1].toLowerCase();const me=8&a?ce:null;if(me&&-1!==od(me,z,0)||2&a&&z!==ce){if(Zo(a))return!1;b=!0}}}}else{if(!b&&!Zo(a)&&!Zo(R))return!1;if(b&&Zo(R))continue;b=!1,a=R|1&a}}return Zo(a)||b}function Zo(e){return 0==(1&e)}function jl(e,r,i,a){if(null===r)return-1;let u=0;if(a||!i){let _=!1;for(;u<r.length;){const b=r[u];if(b===e)return u;if(3===b||6===b)_=!0;else{if(1===b||2===b){let M=r[++u];for(;"string"==typeof M;)M=r[++u];continue}if(4===b)break;if(0===b){u+=4;continue}}u+=_?1:2}return-1}return function ul(e,r){let i=e.indexOf(4);if(i>-1)for(i++;i<e.length;){const a=e[i];if("number"==typeof a)return-1;if(a===r)return i;i++}return-1}(r,e)}function ku(e,r,i=!1){for(let a=0;a<r.length;a++)if(bm(e,r[a],i))return!0;return!1}function Ul(e,r){return e?":not("+r.trim()+")":r}function Lf(e){let r=e[0],i=1,a=2,u="",_=!1;for(;i<e.length;){let b=e[i];if("string"==typeof b)if(2&a){const M=e[++i];u+="["+b+(M.length>0?'="'+M+'"':"")+"]"}else 8&a?u+="."+b:4&a&&(u+=" "+b);else""!==u&&!Zo(b)&&(r+=Ul(_,u),u=""),a=b,_=_||!Zo(a);i++}return""!==u&&(r+=Ul(_,u)),r}function Bi(e){return na(()=>{const r=$l(e),i={...r,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===al.OnPush,directiveDefs:null,pipeDefs:null,dependencies:r.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||As.Emulated,styles:e.styles||wi,_:null,schemas:e.schemas||null,tView:null,id:""};ud(i);const a=e.dependencies;return i.directiveDefs=Gl(a,!1),i.pipeDefs=Gl(a,!0),i.id=function hl(e){let r=0;const i=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const u of i)r=Math.imul(31,r)+u.charCodeAt(0)<<0;return r+=2147483648,"c"+r}(i),i})}function ad(e){return ni(e)||Fr(e)}function ld(e){return null!==e}function br(e){return na(()=>({type:e.type,bootstrap:e.bootstrap||wi,declarations:e.declarations||wi,imports:e.imports||wi,exports:e.exports||wi,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function cd(e,r){if(null==e)return qo;const i={};for(const a in e)if(e.hasOwnProperty(a)){let u=e[a],_=u;Array.isArray(u)&&(_=u[1],u=u[0]),i[u]=a,r&&(r[u]=_)}return i}function Tr(e){return na(()=>{const r=$l(e);return ud(r),r})}function ni(e){return e[Pu]||null}function Fr(e){return e[Ou]||null}function Nr(e){return e[kc]||null}function or(e,r){const i=e[rd]||null;if(!i&&!0===r)throw new Error(`Type ${at(e)} does not have '\u0275mod' property.`);return i}function $l(e){const r={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:r,inputTransforms:null,inputConfig:e.inputs||qo,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||wi,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:cd(e.inputs,r),outputs:cd(e.outputs)}}function ud(e){e.features?.forEach(r=>r(e))}function Gl(e,r){if(!e)return null;const i=r?Nr:ad;return()=>("function"==typeof e?e():e).map(a=>i(a)).filter(ld)}const Kt=0,Gt=1,qn=2,Yi=3,us=4,Hl=5,Yr=6,Ra=7,pr=8,hs=9,Ps=10,Ln=11,ql=12,Zl=13,dl=14,ur=15,Fu=16,Nc=17,Os=18,Nu=19,hd=20,ia=21,ra=22,Wl=23,Yl=24,li=25,zu=1,fl=2,_o=7,ds=9,Mr=11;function yo(e){return Array.isArray(e)&&"object"==typeof e[zu]}function Xr(e){return Array.isArray(e)&&!0===e[zu]}function Vc(e){return 0!=(4&e.flags)}function pl(e){return e.componentOffset>-1}function jc(e){return 1==(1&e.flags)}function vo(e){return!!e.template}function zf(e){return 0!=(512&e[qn])}function Ro(e,r){return e.hasOwnProperty(go)?e[go]:null}let Ur=null,ju=!1;function Wo(e){const r=Ur;return Ur=e,r}const _d={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function vd(e){if(!Kr(e)||e.dirty){if(!e.producerMustRecompute(e)&&!wd(e))return void(e.dirty=!1);e.producerRecomputeValue(e),e.dirty=!1}}function xo(e){e.dirty=!0,function xd(e){if(void 0===e.liveConsumerNode)return;const r=ju;ju=!0;try{for(const i of e.liveConsumerNode)i.dirty||xo(i)}finally{ju=r}}(e),e.consumerMarkedDirty?.(e)}function aa(e){return e&&(e.nextProducerIndex=0),Wo(e)}function bd(e,r){if(Wo(r),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(Kr(e))for(let i=e.nextProducerIndex;i<e.producerNode.length;i++)$c(e.producerNode[i],e.producerIndexOfThis[i]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function wd(e){Mi(e);for(let r=0;r<e.producerNode.length;r++){const i=e.producerNode[r],a=e.producerLastReadVersion[r];if(a!==i.version||(vd(i),a!==i.version))return!0}return!1}function Ed(e){if(Mi(e),Kr(e))for(let r=0;r<e.producerNode.length;r++)$c(e.producerNode[r],e.producerIndexOfThis[r]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function $c(e,r){if(function $u(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),Mi(e),1===e.liveConsumerNode.length)for(let a=0;a<e.producerNode.length;a++)$c(e.producerNode[a],e.producerIndexOfThis[a]);const i=e.liveConsumerNode.length-1;if(e.liveConsumerNode[r]=e.liveConsumerNode[i],e.liveConsumerIndexOfThis[r]=e.liveConsumerIndexOfThis[i],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,r<e.liveConsumerNode.length){const a=e.liveConsumerIndexOfThis[r],u=e.liveConsumerNode[r];Mi(u),u.producerIndexOfThis[a]=r}}function Kr(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function Mi(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let Gc=null;const Om=()=>{},km=(()=>({..._d,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:e=>{e.schedule(e.ref)},hasRun:!1,cleanupFn:Om}))();class qu{constructor(r,i,a){this.previousValue=r,this.currentValue=i,this.firstChange=a}isFirstChange(){return this.firstChange}}function la(){return $f}function $f(e){return e.type.prototype.ngOnChanges&&(e.setInput=Md),Zu}function Zu(){const e=Hc(this),r=e?.current;if(r){const i=e.previous;if(i===qo)e.previous=r;else for(let a in r)i[a]=r[a];e.current=null,this.ngOnChanges(r)}}function Md(e,r,i,a){const u=this.declaredInputs[i],_=Hc(e)||function Po(e,r){return e[Id]=r}(e,{previous:qo,current:null}),b=_.current||(_.current={}),M=_.previous,R=M[u];b[u]=new qu(R&&R.currentValue,r,M===qo),e[a]=r}la.ngInherit=!0;const Id="__ngSimpleChanges__";function Hc(e){return e[Id]||null}const ii=function(e,r,i){};function mi(e){for(;Array.isArray(e);)e=e[Kt];return e}function fs(e,r){return mi(r[e])}function co(e,r){return mi(r[e.index])}function ka(e,r){return e.data[r]}function $r(e,r){const i=r[e];return yo(i)?i:i[Kt]}function ca(e,r){return null==r?null:e[r]}function ks(e){e[Nc]=0}function Zf(e){1024&e[qn]||(e[qn]|=1024,Yu(e,1))}function Zc(e){1024&e[qn]&&(e[qn]&=-1025,Yu(e,-1))}function Yu(e,r){let i=e[Yi];if(null===i)return;i[Hl]+=r;let a=i;for(i=i[Yi];null!==i&&(1===r&&1===a[Hl]||-1===r&&0===a[Hl]);)i[Hl]+=r,a=i,i=i[Yi]}const _n={lFrame:Fa(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Od(){return _n.bindingsEnabled}function ft(){return _n.lFrame.lView}function yi(){return _n.lFrame.tView}function Gr(){let e=Kf();for(;null!==e&&64===e.type;)e=e.parent;return e}function Kf(){return _n.lFrame.currentTNode}function Ls(e,r){const i=_n.lFrame;i.currentTNode=e,i.isParent=r}function kd(){return _n.lFrame.isParent}function ha(){return _n.lFrame.bindingIndex++}function zm(e,r){const i=_n.lFrame;i.bindingIndex=i.bindingRootIndex=e,eh(r)}function eh(e){_n.lFrame.currentDirectiveIndex=e}function tp(){return _n.lFrame.currentQueryIndex}function th(e){_n.lFrame.currentQueryIndex=e}function Ld(e){const r=e[Gt];return 2===r.type?r.declTNode:1===r.type?e[Yr]:null}function da(e,r,i){if(i&Kn.SkipSelf){let u=r,_=e;for(;!(u=u.parent,null!==u||i&Kn.Host||(u=Ld(_),null===u||(_=_[dl],10&u.type))););if(null===u)return!1;r=u,e=_}const a=_n.lFrame=eo();return a.currentTNode=r,a.lView=e,!0}function Wc(e){const r=eo(),i=e[Gt];_n.lFrame=r,r.currentTNode=i.firstChild,r.lView=e,r.tView=i,r.contextLView=e,r.bindingIndex=i.bindingStartIndex,r.inI18n=!1}function eo(){const e=_n.lFrame,r=null===e?null:e.child;return null===r?Fa(e):r}function Fa(e){const r={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=r),r}function np(){const e=_n.lFrame;return _n.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const p=np;function s(){const e=np();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function y(){return _n.lFrame.selectedIndex}function x(e){_n.lFrame.selectedIndex=e}function C(){const e=_n.lFrame;return ka(e.tView,e.selectedIndex)}let V=!0;function j(){return V}function q(e){V=e}function Y(e,r){for(let i=r.directiveStart,a=r.directiveEnd;i<a;i++){const _=e.data[i].type.prototype,{ngAfterContentInit:b,ngAfterContentChecked:M,ngAfterViewInit:R,ngAfterViewChecked:z,ngOnDestroy:$}=_;b&&(e.contentHooks??=[]).push(-i,b),M&&((e.contentHooks??=[]).push(i,M),(e.contentCheckHooks??=[]).push(i,M)),R&&(e.viewHooks??=[]).push(-i,R),z&&((e.viewHooks??=[]).push(i,z),(e.viewCheckHooks??=[]).push(i,z)),null!=$&&(e.destroyHooks??=[]).push(i,$)}}function G(e,r,i){ee(e,r,3,i)}function J(e,r,i,a){(3&e[qn])===i&&ee(e,r,i,a)}function re(e,r){let i=e[qn];(3&i)===r&&(i&=8191,i+=1,e[qn]=i)}function ee(e,r,i,a){const _=a??-1,b=r.length-1;let M=0;for(let R=void 0!==a?65535&e[Nc]:0;R<b;R++)if("number"==typeof r[R+1]){if(M=r[R],null!=a&&M>=a)break}else r[R]<0&&(e[Nc]+=65536),(M<_||-1==_)&&(X(e,i,r,R),e[Nc]=(4294901760&e[Nc])+R+2),R++}function oe(e,r){ii(4,e,r);const i=Wo(null);try{r.call(e)}finally{Wo(i),ii(5,e,r)}}function X(e,r,i,a){const u=i[a]<0,_=i[a+1],M=e[u?-i[a]:i[a]];u?e[qn]>>13<e[Nc]>>16&&(3&e[qn])===r&&(e[qn]+=8192,oe(M,_)):oe(M,_)}const se=-1;class he{constructor(r,i,a){this.factory=r,this.resolving=!1,this.canSeeViewProviders=i,this.injectImpl=a}}function Se(e){return e!==se}function pe(e){return 32767&e}function He(e,r){let i=function Ee(e){return e>>16}(e),a=r;for(;i>0;)a=a[dl],i--;return a}let et=!0;function Je(e){const r=et;return et=e,r}const Mt=255,zt=5;let Ot=0;const Dt={};function Yt(e,r){const i=tn(e,r);if(-1!==i)return i;const a=r[Gt];a.firstCreatePass&&(e.injectorIndex=r.length,en(a.data,e),en(r,null),en(a.blueprint,null));const u=Dn(e,r),_=e.injectorIndex;if(Se(u)){const b=pe(u),M=He(u,r),R=M[Gt].data;for(let z=0;z<8;z++)r[_+z]=M[b+z]|R[b+z]}return r[_+8]=u,_}function en(e,r){e.push(0,0,0,0,0,0,0,0,r)}function tn(e,r){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===r[e.injectorIndex+8]?-1:e.injectorIndex}function Dn(e,r){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let i=0,a=null,u=r;for(;null!==u;){if(a=Fs(u),null===a)return se;if(i++,u=u[dl],-1!==a.injectorIndex)return a.injectorIndex|i<<16}return se}function gi(e,r,i){!function hn(e,r,i){let a;"string"==typeof i?a=i.charCodeAt(0)||0:i.hasOwnProperty(ll)&&(a=i[ll]),null==a&&(a=i[ll]=Ot++);const u=a&Mt;r.data[e+(u>>zt)]|=1<<u}(e,r,i)}function Vi(e,r,i){if(i&Kn.Optional||void 0!==e)return e;tl()}function yn(e,r,i,a){if(i&Kn.Optional&&void 0===a&&(a=null),!(i&(Kn.Self|Kn.Host))){const u=e[hs],_=xr(void 0);try{return u?u.get(r,a,i&Kn.Optional):Rc(r,a,i&Kn.Optional)}finally{xr(_)}}return Vi(a,0,i)}function Nn(e,r,i,a=Kn.Default,u){if(null!==e){if(2048&r[qn]&&!(a&Kn.Self)){const b=function Lo(e,r,i,a,u){let _=e,b=r;for(;null!==_&&null!==b&&2048&b[qn]&&!(512&b[qn]);){const M=vn(_,b,i,a|Kn.Self,Dt);if(M!==Dt)return M;let R=_.parent;if(!R){const z=b[hd];if(z){const $=z.get(i,Dt,a);if($!==Dt)return $}R=Fs(b),b=b[dl]}_=R}return u}(e,r,i,a,Dt);if(b!==Dt)return b}const _=vn(e,r,i,a,Dt);if(_!==Dt)return _}return yn(r,i,a,u)}function vn(e,r,i,a,u){const _=function Sr(e){if("string"==typeof e)return e.charCodeAt(0)||0;const r=e.hasOwnProperty(ll)?e[ll]:void 0;return"number"==typeof r?r>=0?r&Mt:mr:r}(i);if("function"==typeof _){if(!da(r,e,a))return a&Kn.Host?Vi(u,0,a):yn(r,i,a,u);try{let b;if(b=_(a),null!=b||a&Kn.Optional)return b;tl()}finally{p()}}else if("number"==typeof _){let b=null,M=tn(e,r),R=se,z=a&Kn.Host?r[ur][Yr]:null;for((-1===M||a&Kn.SkipSelf)&&(R=-1===M?Dn(e,r):r[M+8],R!==se&&bo(a,!1)?(b=r[Gt],M=pe(R),r=He(R,r)):M=-1);-1!==M;){const $=r[Gt];if(zr(_,M,$.data)){const K=zn(M,r,i,b,a,z);if(K!==Dt)return K}R=r[M+8],R!==se&&bo(a,r[Gt].data[M+8]===z)&&zr(_,M,r)?(b=$,M=pe(R),r=He(R,r)):M=-1}}return u}function zn(e,r,i,a,u,_){const b=r[Gt],M=b.data[e+8],$=vi(M,b,i,null==a?pl(M)&&et:a!=b&&0!=(3&M.type),u&Kn.Host&&_===M);return null!==$?Rn(r,b,$,M):Dt}function vi(e,r,i,a,u){const _=e.providerIndexes,b=r.data,M=1048575&_,R=e.directiveStart,$=_>>20,ce=u?M+$:e.directiveEnd;for(let me=a?M:M+$;me<ce;me++){const Me=b[me];if(me<R&&i===Me||me>=R&&Me.type===i)return me}if(u){const me=b[R];if(me&&vo(me)&&me.type===i)return R}return null}function Rn(e,r,i,a){let u=e[i];const _=r.data;if(function fe(e){return e instanceof he}(u)){const b=u;b.resolving&&function Qt(e,r){const i=r?`. Dependency path: ${r.join(" > ")} > ${e}`:"";throw new xt(-200,`Circular dependency in DI detected for ${e}${i}`)}(function pi(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():rt(e)}(_[i]));const M=Je(b.canSeeViewProviders);b.resolving=!0;const z=b.injectImpl?xr(b.injectImpl):null;da(e,a,Kn.Default);try{u=e[i]=b.factory(void 0,_,e,a),r.firstCreatePass&&i>=a.directiveStart&&function W(e,r,i){const{ngOnChanges:a,ngOnInit:u,ngDoCheck:_}=r.type.prototype;if(a){const b=$f(r);(i.preOrderHooks??=[]).push(e,b),(i.preOrderCheckHooks??=[]).push(e,b)}u&&(i.preOrderHooks??=[]).push(0-e,u),_&&((i.preOrderHooks??=[]).push(e,_),(i.preOrderCheckHooks??=[]).push(e,_))}(i,_[i],r)}finally{null!==z&&xr(z),Je(M),b.resolving=!1,p()}}return u}function zr(e,r,i){return!!(i[r+(e>>zt)]&1<<e)}function bo(e,r){return!(e&Kn.Self||e&Kn.Host&&r)}class Ei{constructor(r,i){this._tNode=r,this._lView=i}get(r,i,a){return Nn(this._tNode,this._lView,r,Ru(a),i)}}function mr(){return new Ei(Gr(),ft())}function no(e){return On(e)?()=>{const r=no(wn(e));return r&&r()}:Ro(e)}function Fs(e){const r=e[Gt],i=r.type;return 2===i?r.declTNode:1===i?e[Yr]:null}const fa="__parameters__";function zs(e,r,i){return na(()=>{const a=function tc(e){return function(...i){if(e){const a=e(...i);for(const u in a)this[u]=a[u]}}}(r);function u(..._){if(this instanceof u)return a.apply(this,_),this;const b=new u(..._);return M.annotation=b,M;function M(R,z,$){const K=R.hasOwnProperty(fa)?R[fa]:Object.defineProperty(R,fa,{value:[]})[fa];for(;K.length<=$;)K.push(null);return(K[$]=K[$]||[]).push(b),R}}return i&&(u.prototype=Object.create(i.prototype)),u.prototype.ngMetadataName=e,u.annotationCls=u,u})}function Nd(e,r){e.forEach(i=>Array.isArray(i)?Nd(i,r):r(i))}function w0(e,r,i){r>=e.length?e.push(i):e.splice(r,0,i)}function Ri(e,r){return r>=e.length-1?e.pop():e.splice(r,1)[0]}function ri(e,r,i){let a=Ko(e,r);return a>=0?e[1|a]=i:(a=~a,function E0(e,r,i,a){let u=e.length;if(u==r)e.push(i,a);else if(1===u)e.push(a,e[0]),e[0]=i;else{for(u--,e.push(e[u-1],e[u]);u>r;)e[u]=e[u-2],u--;e[r]=i,e[r+1]=a}}(e,a,r,i)),a}function sp(e,r){const i=Ko(e,r);if(i>=0)return e[1|i]}function Ko(e,r){return function $_(e,r,i){let a=0,u=e.length>>i;for(;u!==a;){const _=a+(u-a>>1),b=e[_<<i];if(r===b)return _<<i;b>r?u=_:a=_+1}return~(u<<i)}(e,r,1)}const Gi=Nl(zs("Optional"),8),ap=Nl(zs("SkipSelf"),4);function up(e){return 128==(128&e.flags)}var rc=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(rc||{});const Zm=new Map;let B0=0;const js="__ngContext__";function No(e,r){yo(r)?(e[js]=r[Nu],function za(e){Zm.set(e[Nu],e)}(r)):e[js]=r}let Xm;function zd(e,r){return Xm(e,r)}function oh(e){const r=e[Yi];return Xr(r)?r[Yi]:r}function ry(e){return sy(e[ql])}function oy(e){return sy(e[us])}function sy(e){for(;null!==e&&!Xr(e);)e=e[us];return e}function ah(e,r,i,a,u){if(null!=a){let _,b=!1;Xr(a)?_=a:yo(a)&&(b=!0,a=a[Kt]);const M=mi(a);0===e&&null!==i?null==u?eg(r,i,M):sc(r,i,M,u||null,!0):1===e&&null!==i?sc(r,i,M,u||null,!0):2===e?function Vd(e,r,i){const a=mp(e,r);a&&function W0(e,r,i,a){e.removeChild(r,i,a)}(e,a,r,i)}(r,M,b):3===e&&r.destroyNode(M),null!=_&&function gy(e,r,i,a,u){const _=i[_o];_!==mi(i)&&ah(r,e,a,_,u);for(let M=Mr;M<i.length;M++){const R=i[M];jd(R[Gt],R,e,r,a,_)}}(r,e,_,i,u)}}function pp(e,r,i){return e.createElement(r,i)}function Z0(e,r){const i=e[ds],a=i.indexOf(r);Zc(r),i.splice(a,1)}function Jm(e,r){if(e.length<=Mr)return;const i=Mr+r,a=e[i];if(a){const u=a[Fu];null!==u&&u!==e&&Z0(u,a),r>0&&(e[i-1][us]=a[us]);const _=Ri(e,Mr+r);!function vw(e,r){jd(e,r,r[Ln],2,null,null),r[Kt]=null,r[Yr]=null}(a[Gt],a);const b=_[Os];null!==b&&b.detachView(_[Gt]),a[Yi]=null,a[us]=null,a[qn]&=-129}return a}function cy(e,r){if(!(256&r[qn])){const i=r[Ln];r[Wl]&&Ed(r[Wl]),r[Yl]&&Ed(r[Yl]),i.destroyNode&&jd(e,r,i,3,null,null),function bw(e){let r=e[ql];if(!r)return uy(e[Gt],e);for(;r;){let i=null;if(yo(r))i=r[ql];else{const a=r[Mr];a&&(i=a)}if(!i){for(;r&&!r[us]&&r!==e;)yo(r)&&uy(r[Gt],r),r=r[Yi];null===r&&(r=e),yo(r)&&uy(r[Gt],r),i=r&&r[us]}r=i}}(r)}}function uy(e,r){if(!(256&r[qn])){r[qn]&=-129,r[qn]|=256,function Dw(e,r){let i;if(null!=e&&null!=(i=e.destroyHooks))for(let a=0;a<i.length;a+=2){const u=r[i[a]];if(!(u instanceof he)){const _=i[a+1];if(Array.isArray(_))for(let b=0;b<_.length;b+=2){const M=u[_[b]],R=_[b+1];ii(4,M,R);try{R.call(M)}finally{ii(5,M,R)}}else{ii(4,u,_);try{_.call(u)}finally{ii(5,u,_)}}}}}(e,r),function Cw(e,r){const i=e.cleanup,a=r[Ra];if(null!==i)for(let _=0;_<i.length-1;_+=2)if("string"==typeof i[_]){const b=i[_+3];b>=0?a[b]():a[-b].unsubscribe(),_+=2}else i[_].call(a[i[_+1]]);null!==a&&(r[Ra]=null);const u=r[ia];if(null!==u){r[ia]=null;for(let _=0;_<u.length;_++)(0,u[_])()}}(e,r),1===r[Gt].type&&r[Ln].destroy();const i=r[Fu];if(null!==i&&Xr(r[Yi])){i!==r[Yi]&&Z0(i,r);const a=r[Os];null!==a&&a.detachView(e)}!function V0(e){Zm.delete(e[Nu])}(r)}}function Qm(e,r,i){return function Ba(e,r,i){let a=r;for(;null!==a&&40&a.type;)a=(r=a).parent;if(null===a)return i[Kt];{const{componentOffset:u}=a;if(u>-1){const{encapsulation:_}=e.data[a.directiveStart+u];if(_===As.None||_===As.Emulated)return null}return co(a,i)}}(e,r.parent,i)}function sc(e,r,i,a,u){e.insertBefore(r,i,a,u)}function eg(e,r,i){e.appendChild(r,i)}function Bd(e,r,i,a,u){null!==a?sc(e,r,i,a,u):eg(e,r,i)}function mp(e,r){return e.parentNode(r)}let dy,ng,ig,gp=function Y0(e,r,i){return 40&e.type?co(e,i):null};function lh(e,r,i,a){const u=Qm(e,a,r),_=r[Ln],M=function Hi(e,r,i){return gp(e,r,i)}(a.parent||r[Yr],a,r);if(null!=u)if(Array.isArray(i))for(let R=0;R<i.length;R++)Bd(_,u,i[R],M,!1);else Bd(_,u,i,M,!1);void 0!==dy&&dy(_,a,r,i,u)}function _p(e,r){if(null!==r){const i=r.type;if(3&i)return co(r,e);if(4&i)return my(-1,e[r.index]);if(8&i){const a=r.child;if(null!==a)return _p(e,a);{const u=e[r.index];return Xr(u)?my(-1,u):mi(u)}}if(32&i)return zd(r,e)()||mi(e[r.index]);{const a=py(e,r);return null!==a?Array.isArray(a)?a[0]:_p(oh(e[ur]),a):_p(e,r.next)}}return null}function py(e,r){return null!==r?e[ur][Yr].projection[r.projection]:null}function my(e,r){const i=Mr+e+1;if(i<r.length){const a=r[i],u=a[Gt].firstChild;if(null!==u)return _p(a,u)}return r[_o]}function ja(e,r,i,a,u,_,b){for(;null!=i;){const M=a[i.index],R=i.type;if(b&&0===r&&(M&&No(mi(M),a),i.flags|=2),32!=(32&i.flags))if(8&R)ja(e,r,i.child,a,u,_,!1),ah(r,e,u,M,_);else if(32&R){const z=zd(i,a);let $;for(;$=z();)ah(r,e,u,$,_);ah(r,e,u,M,_)}else 16&R?yp(e,r,a,i,u,_):ah(r,e,u,M,_);i=b?i.projectionNext:i.next}}function jd(e,r,i,a,u,_){ja(i,a,e.firstChild,r,u,_,!1)}function yp(e,r,i,a,u,_){const b=i[ur],R=b[Yr].projection[a.projection];if(Array.isArray(R))for(let z=0;z<R.length;z++)ah(r,e,u,R[z],_);else{let z=R;const $=b[Yi];up(a)&&(z.flags|=128),ja(e,r,z,$,u,_,!0)}}function _y(e,r,i){""===i?e.removeAttribute(r,"class"):e.setAttribute(r,"class",i)}function xp(e,r,i){const{mergedAttrs:a,classes:u,styles:_}=i;null!==a&&zl(e,r,a),null!==u&&_y(e,r,u),null!==_&&function tg(e,r,i){e.setAttribute(r,"style",i)}(e,r,_)}function xy(e){return function rg(){if(void 0===ig&&(ig=null,$i.trustedTypes))try{ig=$i.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return ig}()?.createScriptURL(e)||e}class Q0{constructor(r){this.changingThisBreaksApplicationSecurity=r}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Ic})`}}function Jo(e){return e instanceof Q0?e.changingThisBreaksApplicationSecurity:e}function wo(e,r){const i=function ix(e){return e instanceof Q0&&e.getTypeName()||null}(e);if(null!=i&&i!==r){if("ResourceURL"===i&&"URL"===r)return!0;throw new Error(`Required a safe ${r}, got a ${i} (see ${Ic})`)}return i===r}const ox=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Kc=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(Kc||{});function hx(e){const r=Tp();return r?r.sanitize(Kc.URL,e)||"":wo(e,"URL")?Jo(e):function ac(e){return(e=String(e)).match(ox)?e:"unsafe:"+e}(rt(e))}function hg(e){const r=Tp();if(r)return xy(r.sanitize(Kc.RESOURCE_URL,e)||"");if(wo(e,"ResourceURL"))return xy(Jo(e));throw new xt(904,!1)}function Tp(){const e=ft();return e&&e[Ps].sanitizer}const Mp=new Bt("ENVIRONMENT_INITIALIZER"),fx=new Bt("INJECTOR",-1),Ip=new Bt("INJECTOR_DEF_TYPES");class Iy{get(r,i=rl){if(i===rl){const a=new Error(`NullInjectorError: No provider for ${at(r)}!`);throw a.name="NullInjectorError",a}return i}}function Hd(...e){return{\u0275providers:px(0,e),\u0275fromNgModule:!0}}function px(e,...r){const i=[],a=new Set;let u;const _=b=>{i.push(b)};return Nd(r,b=>{const M=b;dg(M,_,[],a)&&(u||=[],u.push(M))}),void 0!==u&&mx(u,_),i}function mx(e,r){for(let i=0;i<e.length;i++){const{ngModule:a,providers:u}=e[i];fg(u,_=>{r(_,a)})}}function dg(e,r,i,a){if(!(e=wn(e)))return!1;let u=null,_=Xh(e);const b=!_&&ni(e);if(_||b){if(b&&!b.standalone)return!1;u=e}else{const R=e.ngModule;if(_=Xh(R),!_)return!1;u=R}const M=a.has(u);if(b){if(M)return!1;if(a.add(u),b.dependencies){const R="function"==typeof b.dependencies?b.dependencies():b.dependencies;for(const z of R)dg(z,r,i,a)}}else{if(!_)return!1;{if(null!=_.imports&&!M){let z;a.add(u);try{Nd(_.imports,$=>{dg($,r,i,a)&&(z||=[],z.push($))})}finally{}void 0!==z&&mx(z,r)}if(!M){const z=Ro(u)||(()=>new u);r({provide:u,useFactory:z,deps:wi},u),r({provide:Ip,useValue:u,multi:!0},u),r({provide:Mp,useValue:()=>Qe(u),multi:!0},u)}const R=_.providers;if(null!=R&&!M){const z=e;fg(R,$=>{r($,z)})}}}return u!==e&&void 0!==e.providers}function fg(e,r){for(let i of e)Mc(i)&&(i=i.\u0275providers),Array.isArray(i)?fg(i,r):r(i)}const kw=zi({provide:String,useValue:zi});function Ay(e){return null!==e&&"object"==typeof e&&kw in e}function wl(e){return"function"==typeof e}const qd=new Bt("Set Injector scope."),Sp={},_x={};let gg;function _g(){return void 0===gg&&(gg=new Iy),gg}class $s{}class hh extends $s{get destroyed(){return this._destroyed}constructor(r,i,a,u){super(),this.parent=i,this.source=a,this.scopes=u,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Py(r,b=>this.processProvider(b)),this.records.set(fx,dh(void 0,this)),u.has("environment")&&this.records.set($s,dh(void 0,this));const _=this.records.get(qd);null!=_&&"string"==typeof _.value&&this.scopes.add(_.value),this.injectorDefTypes=new Set(this.get(Ip.multi,wi,Kn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const r=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of r)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(r){return this.assertNotDestroyed(),this._onDestroyHooks.push(r),()=>this.removeOnDestroy(r)}runInContext(r){this.assertNotDestroyed();const i=Ao(this),a=xr(void 0);try{return r()}finally{Ao(i),xr(a)}}get(r,i=rl,a=Kn.Default){if(this.assertNotDestroyed(),r.hasOwnProperty(Lc))return r[Lc](this);a=Ru(a);const _=Ao(this),b=xr(void 0);try{if(!(a&Kn.SkipSelf)){let R=this.records.get(r);if(void 0===R){const z=function Jc(e){return"function"==typeof e||"object"==typeof e&&e instanceof Bt}(r)&&Du(r);R=z&&this.injectableDefInScope(z)?dh(yg(r),Sp):null,this.records.set(r,R)}if(null!=R)return this.hydrate(r,R)}return(a&Kn.Self?_g():this.parent).get(r,i=a&Kn.Optional&&i===rl?null:i)}catch(M){if("NullInjectorError"===M.name){if((M[ol]=M[ol]||[]).unshift(at(r)),_)throw M;return function O_(e,r,i,a){const u=e[ol];throw r[td]&&u.unshift(r[td]),e.message=function k_(e,r,i,a=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let u=at(r);if(Array.isArray(r))u=r.map(at).join(" -> ");else if("object"==typeof r){let _=[];for(let b in r)if(r.hasOwnProperty(b)){let M=r[b];_.push(b+":"+("string"==typeof M?JSON.stringify(M):at(M)))}u=`{${_.join(", ")}}`}return`${i}${a?"("+a+")":""}[${u}]: ${e.replace(sl,"\n  ")}`}("\n"+e.message,u,i,a),e.ngTokenPath=u,e[ol]=null,e}(M,r,"R3InjectorError",this.source)}throw M}finally{xr(b),Ao(_)}}resolveInjectorInitializers(){const r=Ao(this),i=xr(void 0);try{const u=this.get(Mp.multi,wi,Kn.Self);for(const _ of u)_()}finally{Ao(r),xr(i)}}toString(){const r=[],i=this.records;for(const a of i.keys())r.push(at(a));return`R3Injector[${r.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new xt(205,!1)}processProvider(r){let i=wl(r=wn(r))?r:wn(r&&r.provide);const a=function vx(e){return Ay(e)?dh(void 0,e.useValue):dh(function Ry(e,r,i){let a;if(wl(e)){const u=wn(e);return Ro(u)||yg(u)}if(Ay(e))a=()=>wn(e.useValue);else if(function pg(e){return!(!e||!e.useFactory)}(e))a=()=>e.useFactory(...id(e.deps||[]));else if(function gx(e){return!(!e||!e.useExisting)}(e))a=()=>Qe(wn(e.useExisting));else{const u=wn(e&&(e.useClass||e.provide));if(!function xx(e){return!!e.deps}(e))return Ro(u)||yg(u);a=()=>new u(...id(e.deps))}return a}(e),Sp)}(r);if(wl(r)||!0!==r.multi)this.records.get(i);else{let u=this.records.get(i);u||(u=dh(void 0,Sp,!0),u.factory=()=>id(u.multi),this.records.set(i,u)),i=r,u.multi.push(r)}this.records.set(i,a)}hydrate(r,i){return i.value===Sp&&(i.value=_x,i.value=i.factory()),"object"==typeof i.value&&i.value&&function bx(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}injectableDefInScope(r){if(!r.providedIn)return!1;const i=wn(r.providedIn);return"string"==typeof i?"any"===i||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(r){const i=this._onDestroyHooks.indexOf(r);-1!==i&&this._onDestroyHooks.splice(i,1)}}function yg(e){const r=Du(e),i=null!==r?r.factory:Ro(e);if(null!==i)return i;if(e instanceof Bt)throw new xt(204,!1);if(e instanceof Function)return function yx(e){const r=e.length;if(r>0)throw function ih(e,r){const i=[];for(let a=0;a<e;a++)i.push(r);return i}(r,"?"),new xt(204,!1);const i=function Rf(e){return e&&(e[Kh]||e[Sa])||null}(e);return null!==i?()=>i.factory(e):()=>new e}(e);throw new xt(204,!1)}function dh(e,r,i=!1){return{factory:e,value:r,multi:i?[]:void 0}}function Py(e,r){for(const i of e)Array.isArray(i)?Py(i,r):i&&Mc(i)?Py(i.\u0275providers,r):r(i)}const vg=new Bt("AppId",{providedIn:"root",factory:()=>Lw}),Lw="ng",Ap=new Bt("Platform Initializer"),ga=new Bt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Oy=new Bt("AnimationModuleType"),ky=new Bt("CSP nonce",{providedIn:"root",factory:()=>function $d(){if(void 0!==ng)return ng;if(typeof document<"u")return document;throw new xt(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let Ly=(e,r,i)=>null;function Dg(e,r,i=!1){return Ly(e,r,i)}class Mx{}class Ix{}class Sx{resolveComponentFactory(r){throw function jw(e){const r=Error(`No component factory found for ${at(e)}.`);return r.ngComponent=e,r}(r)}}let gh=(()=>{class e{static#e=this.NULL=new Sx}return e})();function Ax(){return _h(Gr(),ft())}function _h(e,r){return new Bo(co(e,r))}let Bo=(()=>{class e{constructor(i){this.nativeElement=i}static#e=this.__NG_ELEMENT_ID__=Ax}return e})();function Rx(e){return e instanceof Bo?e.nativeElement:e}class Ny{}let Fp=(()=>{class e{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function Uw(){const e=ft(),i=$r(Gr().index,e);return(yo(i)?i:e)[Ln]}()}return e})(),$w=(()=>{class e{static#e=this.\u0275prov=$t({token:e,providedIn:"root",factory:()=>null})}return e})();class Kd{constructor(r){this.full=r,this.major=r.split(".")[0],this.minor=r.split(".")[1],this.patch=r.split(".").slice(2).join(".")}}const Gw=new Kd("16.2.12"),zy={};function Qd(e,r=null,i=null,a){const u=Px(e,r,i,a);return u.resolveInjectorInitializers(),u}function Px(e,r=null,i=null,a,u=new Set){const _=[i||wi,Hd(e)];return a=a||("object"==typeof e?void 0:at(e)),new hh(_,r||_g(),a||null,u)}let uo=(()=>{class e{static#e=this.THROW_IF_NOT_FOUND=rl;static#t=this.NULL=new Iy;static create(i,a){if(Array.isArray(i))return Qd({name:""},a,i,"");{const u=i.name??"";return Qd({name:u},i.parent,i.providers,u)}}static#n=this.\u0275prov=$t({token:e,providedIn:"any",factory:()=>Qe(fx)});static#i=this.__NG_ELEMENT_ID__=-1}return e})();function ef(e){return e.ngOriginalError}class ui{constructor(){this._console=console}handleError(r){const i=this._findOriginalError(r);this._console.error("ERROR",r),i&&this._console.error("ORIGINAL ERROR",i)}_findOriginalError(r){let i=r&&ef(r);for(;i&&ef(i);)i=ef(i);return i||null}}function Qc(e){return r=>{setTimeout(e,void 0,r)}}const oo=class lc extends Ti{constructor(r=!1){super(),this.__isAsync=r}emit(r){super.next(r)}subscribe(r,i,a){let u=r,_=i||(()=>null),b=a;if(r&&"object"==typeof r){const R=r;u=R.next?.bind(R),_=R.error?.bind(R),b=R.complete?.bind(R)}this.__isAsync&&(_=Qc(_),u&&(u=Qc(u)),b&&(b=Qc(b)));const M=super.subscribe({next:u,error:_,complete:b});return r instanceof Zt&&r.add(M),M}};function Lx(...e){}class hi{constructor({enableLongStackTrace:r=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new oo(!1),this.onMicrotaskEmpty=new oo(!1),this.onStable=new oo(!1),this.onError=new oo(!1),typeof Zone>"u")throw new xt(908,!1);Zone.assertZonePatched();const u=this;u._nesting=0,u._outer=u._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(u._inner=u._inner.fork(new Zone.TaskTrackingZoneSpec)),r&&Zone.longStackTraceZoneSpec&&(u._inner=u._inner.fork(Zone.longStackTraceZoneSpec)),u.shouldCoalesceEventChangeDetection=!a&&i,u.shouldCoalesceRunChangeDetection=a,u.lastRequestAnimationFrameId=-1,u.nativeRequestAnimationFrame=function Yw(){const e="function"==typeof $i.requestAnimationFrame;let r=$i[e?"requestAnimationFrame":"setTimeout"],i=$i[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&r&&i){const a=r[Zone.__symbol__("OriginalDelegate")];a&&(r=a);const u=i[Zone.__symbol__("OriginalDelegate")];u&&(i=u)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:i}}().nativeRequestAnimationFrame,function Jw(e){const r=()=>{!function Kw(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call($i,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,$y(e),e.isCheckStableRunning=!0,Uy(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),$y(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,a,u,_,b,M)=>{if(function Qw(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(M))return i.invokeTask(u,_,b,M);try{return Bp(e),i.invokeTask(u,_,b,M)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===_.type||e.shouldCoalesceRunChangeDetection)&&r(),yh(e)}},onInvoke:(i,a,u,_,b,M,R)=>{try{return Bp(e),i.invoke(u,_,b,M,R)}finally{e.shouldCoalesceRunChangeDetection&&r(),yh(e)}},onHasTask:(i,a,u,_)=>{i.hasTask(u,_),a===u&&("microTask"==_.change?(e._hasPendingMicrotasks=_.microTask,$y(e),Uy(e)):"macroTask"==_.change&&(e.hasPendingMacrotasks=_.macroTask))},onHandleError:(i,a,u,_)=>(i.handleError(u,_),e.runOutsideAngular(()=>e.onError.emit(_)),!1)})}(u)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!hi.isInAngularZone())throw new xt(909,!1)}static assertNotInAngularZone(){if(hi.isInAngularZone())throw new xt(909,!1)}run(r,i,a){return this._inner.run(r,i,a)}runTask(r,i,a,u){const _=this._inner,b=_.scheduleEventTask("NgZoneEvent: "+u,r,Xw,Lx,Lx);try{return _.runTask(b,i,a)}finally{_.cancelTask(b)}}runGuarded(r,i,a){return this._inner.runGuarded(r,i,a)}runOutsideAngular(r){return this._outer.run(r)}}const Xw={};function Uy(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function $y(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function Bp(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function yh(e){e._nesting--,Uy(e)}class Fx{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new oo,this.onMicrotaskEmpty=new oo,this.onStable=new oo,this.onError=new oo}run(r,i,a){return r.apply(i,a)}runGuarded(r,i,a){return r.apply(i,a)}runOutsideAngular(r){return r()}runTask(r,i,a,u){return r.apply(i,a)}}const vh=new Bt("",{providedIn:"root",factory:Sg});function Sg(){const e=Xt(hi);let r=!0;return ir(new Di(u=>{r=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{u.next(r),u.complete()})}),new Di(u=>{let _;e.runOutsideAngular(()=>{_=e.onStable.subscribe(()=>{hi.assertNotInAngularZone(),queueMicrotask(()=>{!r&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(r=!0,u.next(!0))})})});const b=e.onUnstable.subscribe(()=>{hi.assertInAngularZone(),r&&(r=!1,e.runOutsideAngular(()=>{u.next(!1)}))});return()=>{_.unsubscribe(),b.unsubscribe()}}).pipe(bu()))}function Gs(e){return e instanceof Function?e():e}let Rg=(()=>{class e{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#e=this.\u0275prov=$t({token:e,providedIn:"root",factory:()=>new e})}return e})();function Vp(e){for(;e;){e[qn]|=64;const r=oh(e);if(zf(e)&&!r)return e;e=r}return null}const Pg=new Bt("",{providedIn:"root",factory:()=>!1});let Up=null;function Qo(e,r){return e[r]??Xy()}function Og(e,r){const i=Xy();i.producerNode?.length&&(e[r]=Up,i.lView=e,Up=tf())}const Ux={..._d,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{Vp(e.lView)},lView:null};function tf(){return Object.create(Ux)}function Xy(){return Up??=tf(),Up}const Zn={};function Eo(e){kg(yi(),ft(),y()+e,!1)}function kg(e,r,i,a){if(!a)if(3==(3&r[qn])){const _=e.preOrderCheckHooks;null!==_&&G(r,_,i)}else{const _=e.preOrderHooks;null!==_&&J(r,_,0,i)}x(i)}function Pt(e,r=Kn.Default){const i=ft();return null===i?Qe(e,r):Nn(Gr(),i,wn(e),r)}function El(){throw new Error("invalid")}function xh(e,r,i,a,u,_,b,M,R,z,$){const K=r.blueprint.slice();return K[Kt]=u,K[qn]=140|a,(null!==z||e&&2048&e[qn])&&(K[qn]|=2048),ks(K),K[Yi]=K[dl]=e,K[pr]=i,K[Ps]=b||e&&e[Ps],K[Ln]=M||e&&e[Ln],K[hs]=R||e&&e[hs]||null,K[Yr]=_,K[Nu]=function ey(){return B0++}(),K[ra]=$,K[hd]=z,K[ur]=2==r.type?e[ur]:K,K}function bh(e,r,i,a,u){let _=e.data[r];if(null===_)_=function nf(e,r,i,a,u){const _=Kf(),b=kd(),R=e.data[r]=function Fg(e,r,i,a,u,_){let b=r?r.injectorIndex:-1,M=0;return function ps(){return null!==_n.skipHydrationRootTNode}()&&(M|=128),{type:i,index:a,insertBeforeIndex:null,injectorIndex:b,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:M,providerIndexes:0,value:u,attrs:_,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:r,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,b?_:_&&_.parent,i,r,a,u);return null===e.firstChild&&(e.firstChild=R),null!==_&&(b?null==_.child&&null!==R.parent&&(_.child=R):null===_.next&&(_.next=R,R.prev=_)),R}(e,r,i,a,u),function Qf(){return _n.lFrame.inI18n}()&&(_.flags|=32);else if(64&_.type){_.type=i,_.value=a,_.attrs=u;const b=function La(){const e=_n.lFrame,r=e.currentTNode;return e.isParent?r:r.parent}();_.injectorIndex=null===b?-1:b.injectorIndex}return Ls(_,!0),_}function eu(e,r,i,a){if(0===i)return-1;const u=r.length;for(let _=0;_<i;_++)r.push(a),e.blueprint.push(a),e.data.push(null);return u}function Gx(e,r,i,a,u){const _=Qo(r,Wl),b=y(),M=2&a;try{x(-1),M&&r.length>li&&kg(e,r,li,!1),ii(M?2:0,u);const z=M?_:null,$=aa(z);try{null!==z&&(z.dirty=!1),i(a,u)}finally{bd(z,$)}}finally{M&&null===r[Wl]&&Og(r,Wl),x(b),ii(M?3:1,u)}}function Ky(e,r,i){if(Vc(r)){const a=Wo(null);try{const _=r.directiveEnd;for(let b=r.directiveStart;b<_;b++){const M=e.data[b];M.contentQueries&&M.contentQueries(1,i[b],b)}}finally{Wo(a)}}}function Jy(e,r,i){Od()&&(function zg(e,r,i,a){const u=i.directiveStart,_=i.directiveEnd;pl(i)&&function Qx(e,r,i){const a=co(r,e),u=Lg(i);let b=16;i.signals?b=4096:i.onPush&&(b=64);const M=Eh(e,xh(e,u,null,b,a,r,null,e[Ps].rendererFactory.createRenderer(a,i),null,null,null));e[r.index]=M}(r,i,e.data[u+i.componentOffset]),e.firstCreatePass||Yt(i,r),No(a,r);const b=i.initialInputs;for(let M=u;M<_;M++){const R=e.data[M],z=Rn(r,e,M,i);No(z,r),null!==b&&hE(0,M-u,z,R,0,b),vo(R)&&($r(i.index,r)[pr]=Rn(r,e,M,i))}}(e,r,i,co(i,r)),64==(64&i.flags)&&Xx(e,r,i))}function tu(e,r,i=co){const a=r.localNames;if(null!==a){let u=r.index+1;for(let _=0;_<a.length;_+=2){const b=a[_+1],M=-1===b?i(r,e):e[b];e[u++]=M}}}function Lg(e){const r=e.tView;return null===r||r.incompleteFirstPass?e.tView=Qy(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):r}function Qy(e,r,i,a,u,_,b,M,R,z,$){const K=li+a,ce=K+u,me=function Hx(e,r){const i=[];for(let a=0;a<r;a++)i.push(a<e?null:Zn);return i}(K,ce),Me="function"==typeof z?z():z;return me[Gt]={type:e,blueprint:me,template:i,queries:null,viewQuery:M,declTNode:r,data:me.slice().fill(null,K),bindingStartIndex:K,expandoStartIndex:ce,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof _?_():_,pipeRegistry:"function"==typeof b?b():b,firstChild:null,schemas:R,consts:Me,incompleteFirstPass:!1,ssrId:$}}let rf=e=>null;function Ng(e,r,i,a){for(let u in e)if(e.hasOwnProperty(u)){i=null===i?{}:i;const _=e[u];null===a?Wx(i,r,u,_):a.hasOwnProperty(u)&&Wx(i,r,a[u],_)}return i}function Wx(e,r,i,a){e.hasOwnProperty(i)?e[i].push(r,a):e[i]=[r,a]}function ys(e,r,i,a,u,_,b,M){const R=co(r,i);let $,z=r.inputs;!M&&null!=z&&($=z[a])?(iv(e,i,$,a,u),pl(r)&&function aE(e,r){const i=$r(r,e);16&i[qn]||(i[qn]|=64)}(i,r.index)):3&r.type&&(a=function $p(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(a),u=null!=b?b(u,r.value||"",a):u,_.setProperty(R,a,u))}function wh(e,r,i,a){if(Od()){const u=null===a?null:{"":-1},_=function af(e,r){const i=e.directiveRegistry;let a=null,u=null;if(i)for(let _=0;_<i.length;_++){const b=i[_];if(ku(r,b.selectors,!1))if(a||(a=[]),vo(b))if(null!==b.findHostDirectiveDefs){const M=[];u=u||new Map,b.findHostDirectiveDefs(b,M,u),a.unshift(...M,b),lf(e,r,M.length)}else a.unshift(b),lf(e,r,0);else u=u||new Map,b.findHostDirectiveDefs?.(b,a,u),a.push(b)}return null===a?null:[a,u]}(e,i);let b,M;null===_?b=M=null:[b,M]=_,null!==b&&sf(e,r,i,b,u,M),u&&function cE(e,r,i){if(r){const a=e.localNames=[];for(let u=0;u<r.length;u+=2){const _=i[r[u+1]];if(null==_)throw new xt(-301,!1);a.push(r[u],_)}}}(i,a,u)}i.mergedAttrs=Aa(i.mergedAttrs,i.attrs)}function sf(e,r,i,a,u,_){for(let z=0;z<a.length;z++)gi(Yt(i,r),e,a[z].type);!function Jx(e,r,i){e.flags|=1,e.directiveStart=r,e.directiveEnd=r+i,e.providerIndexes=r}(i,e.data.length,a.length);for(let z=0;z<a.length;z++){const $=a[z];$.providersResolver&&$.providersResolver($)}let b=!1,M=!1,R=eu(e,r,a.length,null);for(let z=0;z<a.length;z++){const $=a[z];i.mergedAttrs=Aa(i.mergedAttrs,$.hostAttrs),uE(e,i,r,R,$),Kx(R,$,u),null!==$.contentQueries&&(i.flags|=4),(null!==$.hostBindings||null!==$.hostAttrs||0!==$.hostVars)&&(i.flags|=64);const K=$.type.prototype;!b&&(K.ngOnChanges||K.ngOnInit||K.ngDoCheck)&&((e.preOrderHooks??=[]).push(i.index),b=!0),!M&&(K.ngOnChanges||K.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(i.index),M=!0),R++}!function Yx(e,r,i){const u=r.directiveEnd,_=e.data,b=r.attrs,M=[];let R=null,z=null;for(let $=r.directiveStart;$<u;$++){const K=_[$],ce=i?i.get(K):null,Me=ce?ce.outputs:null;R=Ng(K.inputs,$,R,ce?ce.inputs:null),z=Ng(K.outputs,$,z,Me);const ke=null===R||null===b||lo(r)?null:dE(R,$,b);M.push(ke)}null!==R&&(R.hasOwnProperty("class")&&(r.flags|=8),R.hasOwnProperty("style")&&(r.flags|=16)),r.initialInputs=M,r.inputs=R,r.outputs=z}(e,i,_)}function Xx(e,r,i){const a=i.directiveStart,u=i.directiveEnd,_=i.index,b=function Bm(){return _n.lFrame.currentDirectiveIndex}();try{x(_);for(let M=a;M<u;M++){const R=e.data[M],z=r[M];eh(M),(null!==R.hostBindings||0!==R.hostVars||null!==R.hostAttrs)&&lE(R,z)}}finally{x(-1),eh(b)}}function lE(e,r){null!==e.hostBindings&&e.hostBindings(1,r)}function lf(e,r,i){r.componentOffset=i,(e.components??=[]).push(r.index)}function Kx(e,r,i){if(i){if(r.exportAs)for(let a=0;a<r.exportAs.length;a++)i[r.exportAs[a]]=e;vo(r)&&(i[""]=e)}}function uE(e,r,i,a,u){e.data[a]=u;const _=u.factory||(u.factory=Ro(u.type)),b=new he(_,vo(u),Pt);e.blueprint[a]=b,i[a]=b,function Gp(e,r,i,a,u){const _=u.hostBindings;if(_){let b=e.hostBindingOpCodes;null===b&&(b=e.hostBindingOpCodes=[]);const M=~r.index;(function Hp(e){let r=e.length;for(;r>0;){const i=e[--r];if("number"==typeof i&&i<0)return i}return 0})(b)!=M&&b.push(M),b.push(i,a,_)}}(e,r,a,eu(e,i,u.hostVars,Zn),u)}function Cl(e,r,i,a,u,_){const b=co(e,r);!function Bg(e,r,i,a,u,_,b){if(null==_)e.removeAttribute(r,u,i);else{const M=null==b?rt(_):b(_,a||"",u);e.setAttribute(r,u,M,i)}}(r[Ln],b,_,e.value,i,a,u)}function hE(e,r,i,a,u,_){const b=_[r];if(null!==b)for(let M=0;M<b.length;)tv(a,i,b[M++],b[M++],b[M++])}function tv(e,r,i,a,u){const _=Wo(null);try{const b=e.inputTransforms;null!==b&&b.hasOwnProperty(a)&&(u=b[a].call(r,u)),null!==e.setInput?e.setInput(r,u,i,a):r[a]=u}finally{Wo(_)}}function dE(e,r,i){let a=null,u=0;for(;u<i.length;){const _=i[u];if(0!==_)if(5!==_){if("number"==typeof _)break;if(e.hasOwnProperty(_)){null===a&&(a=[]);const b=e[_];for(let M=0;M<b.length;M+=2)if(b[M]===r){a.push(_,b[M+1],i[u+1]);break}}u+=2}else u+=2;else u+=4}return a}function eb(e,r,i,a){return[e,!0,!1,r,null,0,a,i,null,null,null]}function qp(e,r){const i=e.contentQueries;if(null!==i)for(let a=0;a<i.length;a+=2){const _=i[a+1];if(-1!==_){const b=e.data[_];th(i[a]),b.contentQueries(2,r[_],_)}}}function Eh(e,r){return e[ql]?e[Zl][us]=r:e[ql]=r,e[Zl]=r,r}function cf(e,r,i){th(0);const a=Wo(null);try{r(e,i)}finally{Wo(a)}}function tb(e){return e[Ra]||(e[Ra]=[])}function Vg(e){return e.cleanup||(e.cleanup=[])}function Zp(e,r){const i=e[hs],a=i?i.get(ui,null):null;a&&a.handleError(r)}function iv(e,r,i,a,u){for(let _=0;_<i.length;){const b=i[_++],M=i[_++];tv(e.data[b],r[b],a,M,u)}}function nb(e,r){const i=$r(r,e),a=i[Gt];!function Ug(e,r){for(let i=r.length;i<e.blueprint.length;i++)r.push(e.blueprint[i])}(a,i);const u=i[Kt];null!==u&&null===i[ra]&&(i[ra]=Dg(u,i[hs])),rv(a,i,i[pr])}function rv(e,r,i){Wc(r);try{const a=e.viewQuery;null!==a&&cf(1,a,i);const u=e.template;null!==u&&Gx(e,r,u,1,i),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&qp(e,r),e.staticViewQueries&&cf(2,e.viewQuery,i);const _=e.components;null!==_&&function fE(e,r){for(let i=0;i<r.length;i++)nb(e,r[i])}(r,_)}catch(a){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),a}finally{r[qn]&=-5,s()}}let ib=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(i,a,u){const _=typeof Zone>"u"?null:Zone.current,b=function B_(e,r,i){const a=Object.create(km);i&&(a.consumerAllowSignalWrites=!0),a.fn=e,a.schedule=r;const u=b=>{a.cleanupFn=b};return a.ref={notify:()=>xo(a),run:()=>{if(a.dirty=!1,a.hasRun&&!wd(a))return;a.hasRun=!0;const b=aa(a);try{a.cleanupFn(),a.cleanupFn=Om,a.fn(u)}finally{bd(a,b)}},cleanup:()=>a.cleanupFn()},a.ref}(i,z=>{this.all.has(z)&&this.queue.set(z,_)},u);let M;this.all.add(b),b.notify();const R=()=>{b.cleanup(),M?.(),this.all.delete(b),this.queue.delete(b)};return M=a?.onDestroy(R),{destroy:R}}flush(){if(0!==this.queue.size)for(const[i,a]of this.queue)this.queue.delete(i),a?a.run(()=>i.run()):i.run()}get isQueueEmpty(){return 0===this.queue.size}static#e=this.\u0275prov=$t({token:e,providedIn:"root",factory:()=>new e})}return e})();function uf(e,r,i){let a=i?e.styles:null,u=i?e.classes:null,_=0;if(null!==r)for(let b=0;b<r.length;b++){const M=r[b];"number"==typeof M?_=M:1==_?u=$n(u,M):2==_&&(a=$n(a,M+": "+r[++b]+";"))}i?e.styles=a:e.stylesWithoutHost=a,i?e.classes=u:e.classesWithoutHost=u}function Ch(e,r,i,a,u=!1){for(;null!==i;){const _=r[i.index];null!==_&&a.push(mi(_)),Xr(_)&&Wp(_,a);const b=i.type;if(8&b)Ch(e,r,i.child,a);else if(32&b){const M=zd(i,r);let R;for(;R=M();)a.push(R)}else if(16&b){const M=py(r,i);if(Array.isArray(M))a.push(...M);else{const R=oh(r[ur]);Ch(R[Gt],R,M,a,!0)}}i=u?i.projectionNext:i.next}return a}function Wp(e,r){for(let i=Mr;i<e.length;i++){const a=e[i],u=a[Gt].firstChild;null!==u&&Ch(a[Gt],a,u,r)}e[_o]!==e[Kt]&&r.push(e[_o])}function Dh(e,r,i,a=!0){const u=r[Ps],_=u.rendererFactory,b=u.afterRenderEventManager;_.begin?.(),b?.begin();try{ov(e,r,e.template,i)}catch(R){throw a&&Zp(r,R),R}finally{_.end?.(),u.effectManager?.flush(),b?.end()}}function ov(e,r,i,a){const u=r[qn];if(256!=(256&u)){r[Ps].effectManager?.flush(),Wc(r);try{ks(r),function Jf(e){return _n.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==i&&Gx(e,r,i,2,a);const b=3==(3&u);if(b){const z=e.preOrderCheckHooks;null!==z&&G(r,z,null)}else{const z=e.preOrderHooks;null!==z&&J(r,z,0,null),re(r,0)}if(function ob(e){for(let r=ry(e);null!==r;r=oy(r)){if(!r[fl])continue;const i=r[ds];for(let a=0;a<i.length;a++){Zf(i[a])}}}(r),rb(r,2),null!==e.contentQueries&&qp(e,r),b){const z=e.contentCheckHooks;null!==z&&G(r,z)}else{const z=e.contentHooks;null!==z&&J(r,z,1),re(r,1)}!function $x(e,r){const i=e.hostBindingOpCodes;if(null===i)return;const a=Qo(r,Yl);try{for(let u=0;u<i.length;u++){const _=i[u];if(_<0)x(~_);else{const b=_,M=i[++u],R=i[++u];zm(M,b),a.dirty=!1;const z=aa(a);try{R(2,r[b])}finally{bd(a,z)}}}}finally{null===r[Yl]&&Og(r,Yl),x(-1)}}(e,r);const M=e.components;null!==M&&sv(r,M,0);const R=e.viewQuery;if(null!==R&&cf(2,R,a),b){const z=e.viewCheckHooks;null!==z&&G(r,z)}else{const z=e.viewHooks;null!==z&&J(r,z,2),re(r,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),r[qn]&=-73,Zc(r)}finally{s()}}}function rb(e,r){for(let i=ry(e);null!==i;i=oy(i))for(let a=Mr;a<i.length;a++)sb(i[a],r)}function gE(e,r,i){sb($r(r,e),i)}function sb(e,r){if(!function Wu(e){return 128==(128&e[qn])}(e))return;const i=e[Gt],a=e[qn];if(80&a&&0===r||1024&a||2===r)ov(i,e,i.template,e[pr]);else if(e[Hl]>0){rb(e,1);const u=i.components;null!==u&&sv(e,u,1)}}function sv(e,r,i){for(let a=0;a<r.length;a++)gE(e,r[a],i)}class Yp{get rootNodes(){const r=this._lView,i=r[Gt];return Ch(i,r,i.firstChild,[])}constructor(r,i){this._lView=r,this._cdRefInjectingView=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[pr]}set context(r){this._lView[pr]=r}get destroyed(){return 256==(256&this._lView[qn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const r=this._lView[Yi];if(Xr(r)){const i=r[8],a=i?i.indexOf(this):-1;a>-1&&(Jm(r,a),Ri(i,a))}this._attachedToViewContainer=!1}cy(this._lView[Gt],this._lView)}onDestroy(r){!function Rd(e,r){if(256==(256&e[qn]))throw new xt(911,!1);null===e[ia]&&(e[ia]=[]),e[ia].push(r)}(this._lView,r)}markForCheck(){Vp(this._cdRefInjectingView||this._lView)}detach(){this._lView[qn]&=-129}reattach(){this._lView[qn]|=128}detectChanges(){Dh(this._lView[Gt],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new xt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function xw(e,r){jd(e,r,r[Ln],2,null,null)}(this._lView[Gt],this._lView)}attachToAppRef(r){if(this._attachedToViewContainer)throw new xt(902,!1);this._appRef=r}}class _E extends Yp{constructor(r){super(r),this._view=r}detectChanges(){const r=this._view;Dh(r[Gt],r,r[pr],!1)}checkNoChanges(){}get context(){return null}}class ab extends gh{constructor(r){super(),this.ngModule=r}resolveComponentFactory(r){const i=ni(r);return new hf(i,this.ngModule)}}function Gg(e){const r=[];for(let i in e)e.hasOwnProperty(i)&&r.push({propName:e[i],templateName:i});return r}class lb{constructor(r,i){this.injector=r,this.parentInjector=i}get(r,i,a){a=Ru(a);const u=this.injector.get(r,zy,a);return u!==zy||i===zy?u:this.parentInjector.get(r,i,a)}}class hf extends Ix{get inputs(){const r=this.componentDef,i=r.inputTransforms,a=Gg(r.inputs);if(null!==i)for(const u of a)i.hasOwnProperty(u.propName)&&(u.transform=i[u.propName]);return a}get outputs(){return Gg(this.componentDef.outputs)}constructor(r,i){super(),this.componentDef=r,this.ngModule=i,this.componentType=r.type,this.selector=function Cm(e){return e.map(Lf).join(",")}(r.selectors),this.ngContentSelectors=r.ngContentSelectors?r.ngContentSelectors:[],this.isBoundToModule=!!i}create(r,i,a,u){let _=(u=u||this.ngModule)instanceof $s?u:u?.injector;_&&null!==this.componentDef.getStandaloneInjector&&(_=this.componentDef.getStandaloneInjector(_)||_);const b=_?new lb(r,_):r,M=b.get(Ny,null);if(null===M)throw new xt(407,!1);const K={rendererFactory:M,sanitizer:b.get($w,null),effectManager:b.get(ib,null),afterRenderEventManager:b.get(Rg,null)},ce=M.createRenderer(null,this.componentDef),me=this.componentDef.selectors[0][0]||"div",Me=a?function ev(e,r,i,a){const _=a.get(Pg,!1)||i===As.ShadowDom,b=e.selectRootElement(r,_);return function sE(e){rf(e)}(b),b}(ce,a,this.componentDef.encapsulation,b):pp(ce,me,function yE(e){const r=e.toLowerCase();return"svg"===r?"svg":"math"===r?"math":null}(me)),It=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let Ye=null;null!==Me&&(Ye=Dg(Me,b,!0));const In=Qy(0,null,null,1,0,null,null,null,null,null,null),Gn=xh(null,In,null,It,null,null,K,ce,b,null,Ye);let Ai,wa;Wc(Gn);try{const jh=this.componentDef;let M_,QD=null;jh.findHostDirectiveDefs?(M_=[],QD=new Map,jh.findHostDirectiveDefs(jh,M_,QD),M_.push(jh)):M_=[jh];const k4=function ru(e,r){const i=e[Gt],a=li;return e[a]=r,bh(i,a,2,"#host",null)}(Gn,Me),L4=function cb(e,r,i,a,u,_,b){const M=u[Gt];!function ub(e,r,i,a){for(const u of e)r.mergedAttrs=Aa(r.mergedAttrs,u.hostAttrs);null!==r.mergedAttrs&&(uf(r,r.mergedAttrs,!0),null!==i&&xp(a,i,r))}(a,e,r,b);let R=null;null!==r&&(R=Dg(r,u[hs]));const z=_.rendererFactory.createRenderer(r,i);let $=16;i.signals?$=4096:i.onPush&&($=64);const K=xh(u,Lg(i),null,$,u[e.index],e,_,z,null,null,R);return M.firstCreatePass&&lf(M,e,a.length-1),Eh(u,K),u[e.index]=K}(k4,Me,jh,M_,Gn,K,ce);wa=ka(In,li),Me&&function qg(e,r,i,a){if(a)zl(e,i,["ng-version",Gw.full]);else{const{attrs:u,classes:_}=function L_(e){const r=[],i=[];let a=1,u=2;for(;a<e.length;){let _=e[a];if("string"==typeof _)2===u?""!==_&&r.push(_,e[++a]):8===u&&i.push(_);else{if(!Zo(u))break;u=_}a++}return{attrs:r,classes:i}}(r.selectors[0]);u&&zl(e,i,u),_&&_.length>0&&_y(e,i,_.join(" "))}}(ce,jh,Me,a),void 0!==i&&function av(e,r,i){const a=e.projection=[];for(let u=0;u<r.length;u++){const _=i[u];a.push(null!=_?Array.from(_):null)}}(wa,this.ngContentSelectors,i),Ai=function hb(e,r,i,a,u,_){const b=Gr(),M=u[Gt],R=co(b,u);sf(M,u,b,i,null,a);for(let $=0;$<i.length;$++)No(Rn(u,M,b.directiveStart+$,b),u);Xx(M,u,b),R&&No(R,u);const z=Rn(u,M,b.directiveStart+b.componentOffset,b);if(e[pr]=u[pr]=z,null!==_)for(const $ of _)$(z,r);return Ky(M,b,e),z}(L4,jh,M_,QD,Gn,[db]),rv(In,Gn,null)}finally{s()}return new Hg(this.componentType,Ai,_h(wa,Gn),Gn,wa)}}class Hg extends Mx{constructor(r,i,a,u,_){super(),this.location=a,this._rootLView=u,this._tNode=_,this.previousInputValues=null,this.instance=i,this.hostView=this.changeDetectorRef=new _E(u),this.componentType=r}setInput(r,i){const a=this._tNode.inputs;let u;if(null!==a&&(u=a[r])){if(this.previousInputValues??=new Map,this.previousInputValues.has(r)&&Object.is(this.previousInputValues.get(r),i))return;const _=this._rootLView;iv(_[Gt],_,u,r,i),this.previousInputValues.set(r,i),Vp($r(this._tNode.index,_))}}get injector(){return new Ei(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(r){this.hostView.onDestroy(r)}}function db(){const e=Gr();Y(ft()[Gt],e)}function df(e){let r=function fb(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),i=!0;const a=[e];for(;r;){let u;if(vo(e))u=r.\u0275cmp||r.\u0275dir;else{if(r.\u0275cmp)throw new xt(903,!1);u=r.\u0275dir}if(u){if(i){a.push(u);const b=e;b.inputs=Zg(e.inputs),b.inputTransforms=Zg(e.inputTransforms),b.declaredInputs=Zg(e.declaredInputs),b.outputs=Zg(e.outputs);const M=u.hostBindings;M&&wE(e,M);const R=u.viewQuery,z=u.contentQueries;if(R&&xE(e,R),z&&bE(e,z),Ma(e.inputs,u.inputs),Ma(e.declaredInputs,u.declaredInputs),Ma(e.outputs,u.outputs),null!==u.inputTransforms&&(null===b.inputTransforms&&(b.inputTransforms={}),Ma(b.inputTransforms,u.inputTransforms)),vo(u)&&u.data.animation){const $=e.data;$.animation=($.animation||[]).concat(u.data.animation)}}const _=u.features;if(_)for(let b=0;b<_.length;b++){const M=_[b];M&&M.ngInherit&&M(e),M===df&&(i=!1)}}r=Object.getPrototypeOf(r)}!function vE(e){let r=0,i=null;for(let a=e.length-1;a>=0;a--){const u=e[a];u.hostVars=r+=u.hostVars,u.hostAttrs=Aa(u.hostAttrs,i=Aa(i,u.hostAttrs))}}(a)}function Zg(e){return e===qo?{}:e===wi?[]:e}function xE(e,r){const i=e.viewQuery;e.viewQuery=i?(a,u)=>{r(a,u),i(a,u)}:r}function bE(e,r){const i=e.contentQueries;e.contentQueries=i?(a,u,_)=>{r(a,u,_),i(a,u,_)}:r}function wE(e,r){const i=e.hostBindings;e.hostBindings=i?(a,u)=>{r(a,u),i(a,u)}:r}function _b(e){const r=e.inputConfig,i={};for(const a in r)if(r.hasOwnProperty(a)){const u=r[a];Array.isArray(u)&&u[2]&&(i[a]=u[2])}e.inputTransforms=i}function Th(e){return!!function uv(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function Vo(e,r,i){return!Object.is(e[r],i)&&(e[r]=i,!0)}function dc(e,r,i,a){const u=ft();return Vo(u,ha(),r)&&(yi(),Cl(C(),u,e,r,i,a)),dc}function Co(e,r,i,a,u,_,b,M){const R=ft(),z=yi(),$=e+li,K=z.firstCreatePass?function cn(e,r,i,a,u,_,b,M,R){const z=r.consts,$=bh(r,e,4,b||null,ca(z,M));wh(r,i,$,ca(z,R)),Y(r,$);const K=$.tView=Qy(2,$,a,u,_,r.directiveRegistry,r.pipeRegistry,null,r.schemas,z,null);return null!==r.queries&&(r.queries.template(r,$),K.queries=r.queries.embeddedTView($)),$}($,z,R,r,i,a,u,_,b):z.data[$];Ls(K,!1);const ce=Rb(z,R,K,e);j()&&lh(z,R,ce,K),No(ce,R),Eh(R,R[$]=eb(ce,R,ce,K)),jc(K)&&Jy(z,R,K),null!=b&&tu(R,K,M)}let Rb=function Pb(e,r,i,a){return q(!0),r[Ln].createComment("")};function Za(e,r,i){const a=ft();return Vo(a,ha(),r)&&ys(yi(),C(),a,e,r,a[Ln],i,!1),Za}function yv(e,r,i,a,u){const b=u?"class":"style";iv(e,i,r.inputs[b],b,a)}function bt(e,r,i,a){const u=ft(),_=yi(),b=li+e,M=u[Ln],R=_.firstCreatePass?function Ob(e,r,i,a,u,_){const b=r.consts,R=bh(r,e,2,a,ca(b,u));return wh(r,i,R,ca(b,_)),null!==R.attrs&&uf(R,R.attrs,!1),null!==R.mergedAttrs&&uf(R,R.mergedAttrs,!0),null!==r.queries&&r.queries.elementStart(r,R),R}(b,_,u,r,i,a):_.data[b],z=vv(_,u,R,M,r,e);u[b]=z;const $=jc(R);return Ls(R,!0),xp(M,z,R),32!=(32&R.flags)&&j()&&lh(_,u,z,R),0===function yl(){return _n.lFrame.elementDepthCount}()&&No(z,u),function Wf(){_n.lFrame.elementDepthCount++}(),$&&(Jy(_,u,R),Ky(_,R,u)),null!==a&&tu(u,R),bt}function Lt(){let e=Gr();kd()?function Ql(){_n.lFrame.isParent=!1}():(e=e.parent,Ls(e,!1));const r=e;(function Ju(e){return _n.skipHydrationRootTNode===e})(r)&&function Lm(){_n.skipHydrationRootTNode=null}(),function Ku(){_n.lFrame.elementDepthCount--}();const i=yi();return i.firstCreatePass&&(Y(i,e),Vc(e)&&i.queries.elementEnd(e)),null!=r.classesWithoutHost&&function Pe(e){return 0!=(8&e.flags)}(r)&&yv(i,r,ft(),r.classesWithoutHost,!0),null!=r.stylesWithoutHost&&function Ae(e){return 0!=(16&e.flags)}(r)&&yv(i,r,ft(),r.stylesWithoutHost,!1),Lt}function Bn(e,r,i,a){return bt(e,r,i,a),Lt(),Bn}let vv=(e,r,i,a,u,_)=>(q(!0),pp(a,u,function F(){return _n.lFrame.currentNamespace}()));function e_(e){return!!e&&"function"==typeof e.then}function t_(e){return!!e&&"function"==typeof e.subscribe}function Do(e,r,i,a){const u=ft(),_=yi(),b=Gr();return function va(e,r,i,a,u,_,b){const M=jc(a),z=e.firstCreatePass&&Vg(e),$=r[pr],K=tb(r);let ce=!0;if(3&a.type||b){const ke=co(a,r),ut=b?b(ke):ke,It=K.length,Ye=b?Gn=>b(mi(Gn[a.index])):a.index;let In=null;if(!b&&M&&(In=function BE(e,r,i,a){const u=e.cleanup;if(null!=u)for(let _=0;_<u.length-1;_+=2){const b=u[_];if(b===i&&u[_+1]===a){const M=r[Ra],R=u[_+2];return M.length>R?M[R]:null}"string"==typeof b&&(_+=2)}return null}(e,r,u,a.index)),null!==In)(In.__ngLastListenerFn__||In).__ngNextListenerFn__=_,In.__ngLastListenerFn__=_,ce=!1;else{_=Nb(a,r,$,_,!1);const Gn=i.listen(ut,u,_);K.push(_,Gn),z&&z.push(u,Ye,It,It+1)}}else _=Nb(a,r,$,_,!1);const me=a.outputs;let Me;if(ce&&null!==me&&(Me=me[u])){const ke=Me.length;if(ke)for(let ut=0;ut<ke;ut+=2){const Ai=r[Me[ut]][Me[ut+1]].subscribe(_),wa=K.length;K.push(_,Ai),z&&z.push(u,a.index,wa,-(wa+1))}}}(_,u,u[Ln],b,e,r,a),Do}function Fb(e,r,i,a){try{return ii(6,r,i),!1!==i(a)}catch(u){return Zp(e,u),!1}finally{ii(7,r,i)}}function Nb(e,r,i,a,u){return function _(b){if(b===Function)return a;Vp(e.componentOffset>-1?$r(e.index,r):r);let R=Fb(r,i,a,b),z=_.__ngNextListenerFn__;for(;z;)R=Fb(r,i,z,b)&&R,z=z.__ngNextListenerFn__;return u&&!1===R&&b.preventDefault(),R}}function xv(e=1){return function c(e){return(_n.lFrame.contextLView=function m(e,r){for(;e>0;)r=r[dl],e--;return r}(e,_n.lFrame.contextLView))[pr]}(e)}function n(e,r){return e<<17|r<<2}function t(e){return e>>17&32767}function h(e){return 2|e}function f(e){return(131068&e)>>2}function g(e,r){return-131069&e|r<<2}function w(e){return 1|e}function L(e,r,i,a,u){const _=e[i+1],b=null===r;let M=a?t(_):f(_),R=!1;for(;0!==M&&(!1===R||b);){const $=e[M+1];N(e[M],r)&&(R=!0,e[M+1]=a?w($):h($)),M=a?t($):f($)}R&&(e[i+1]=a?h(_):w(_))}function N(e,r){return null===e||null==r||(Array.isArray(e)?e[1]:e)===r||!(!Array.isArray(e)||"string"!=typeof r)&&Ko(e,r)>=0}function Ve(e,r){return function yt(e,r,i,a){const u=ft(),_=yi(),b=function ms(e){const r=_n.lFrame,i=r.bindingIndex;return r.bindingIndex=r.bindingIndex+e,i}(2);_.firstUpdatePass&&function qt(e,r,i,a){const u=e.data;if(null===u[i+1]){const _=u[y()],b=function Ze(e,r){return r>=e.expandoStartIndex}(e,i);(function jn(e,r){return 0!=(e.flags&(r?8:16))})(_,a)&&null===r&&!b&&(r=!1),r=function Ft(e,r,i,a){const u=function ec(e){const r=_n.lFrame.currentDirectiveIndex;return-1===r?null:e[r]}(e);let _=a?r.residualClasses:r.residualStyles;if(null===u)0===(a?r.classBindings:r.styleBindings)&&(i=Ht(i=un(null,e,r,i,a),r.attrs,a),_=null);else{const b=r.directiveStylingLast;if(-1===b||e[b]!==u)if(i=un(u,e,r,i,a),null===_){let R=function Tt(e,r,i){const a=i?r.classBindings:r.styleBindings;if(0!==f(a))return e[t(a)]}(e,r,a);void 0!==R&&Array.isArray(R)&&(R=un(null,e,r,R[1],a),R=Ht(R,r.attrs,a),function We(e,r,i,a){e[t(i?r.classBindings:r.styleBindings)]=a}(e,r,a,R))}else _=function jt(e,r,i){let a;const u=r.directiveEnd;for(let _=1+r.directiveStylingLast;_<u;_++)a=Ht(a,e[_].hostAttrs,i);return Ht(a,r.attrs,i)}(e,r,a)}return void 0!==_&&(a?r.residualClasses=_:r.residualStyles=_),i}(u,_,r,a),function I(e,r,i,a,u,_){let b=_?r.classBindings:r.styleBindings,M=t(b),R=f(b);e[a]=i;let $,z=!1;if(Array.isArray(i)?($=i[1],(null===$||Ko(i,$)>0)&&(z=!0)):$=i,u)if(0!==R){const ce=t(e[M+1]);e[a+1]=n(ce,M),0!==ce&&(e[ce+1]=g(e[ce+1],a)),e[M+1]=function l(e,r){return 131071&e|r<<17}(e[M+1],a)}else e[a+1]=n(M,0),0!==M&&(e[M+1]=g(e[M+1],a)),M=a;else e[a+1]=n(R,0),0===M?M=a:e[R+1]=g(e[R+1],a),R=a;z&&(e[a+1]=h(e[a+1])),L(e,$,a,!0),L(e,$,a,!1),function P(e,r,i,a,u){const _=u?e.residualClasses:e.residualStyles;null!=_&&"string"==typeof r&&Ko(_,r)>=0&&(i[a+1]=w(i[a+1]))}(r,$,e,a,_),b=n(M,R),_?r.classBindings=b:r.styleBindings=b}(u,_,r,i,b,a)}}(_,e,b,a),r!==Zn&&Vo(u,b,r)&&function _i(e,r,i,a,u,_,b,M){if(!(3&r.type))return;const R=e.data,z=R[M+1],$=function v(e){return 1==(1&e)}(z)?Vn(R,r,i,u,f(z),b):void 0;Fn($)||(Fn(_)||function o(e){return 2==(2&e)}(z)&&(_=Vn(R,null,i,u,M,b)),function vp(e,r,i,a,u){if(r)u?e.addClass(i,a):e.removeClass(i,a);else{let _=-1===a.indexOf("-")?void 0:rc.DashCase;null==u?e.removeStyle(i,a,_):("string"==typeof u&&u.endsWith("!important")&&(u=u.slice(0,-10),_|=rc.Important),e.setStyle(i,a,u,_))}}(a,b,fs(y(),i),u,_))}(_,_.data[y()],u,u[Ln],e,u[b+1]=function Jn(e,r){return null==e||""===e||("string"==typeof r?e+=r:"object"==typeof e&&(e=at(Jo(e)))),e}(r,i),a,b)}(e,r,null,!0),Ve}function un(e,r,i,a,u){let _=null;const b=i.directiveEnd;let M=i.directiveStylingLast;for(-1===M?M=i.directiveStart:M++;M<b&&(_=r[M],a=Ht(a,_.hostAttrs,u),_!==e);)M++;return null!==e&&(i.directiveStylingLast=M),a}function Ht(e,r,i){const a=i?1:2;let u=-1;if(null!==r)for(let _=0;_<r.length;_++){const b=r[_];"number"==typeof b?u=b:u===a&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),ri(e,b,!!i||r[++_]))}return void 0===e?null:e}function Vn(e,r,i,a,u,_){const b=null===r;let M;for(;u>0;){const R=e[u],z=Array.isArray(R),$=z?R[1]:R,K=null===$;let ce=i[u+1];ce===Zn&&(ce=K?wi:void 0);let me=K?sp(ce,a):$===a?ce:void 0;if(z&&!Fn(me)&&(me=sp(R,a)),Fn(me)&&(M=me,b))return M;const Me=e[u+1];u=b?t(Me):f(Me)}if(null!==r){let R=_?r.residualClasses:r.residualStyles;null!=R&&(M=sp(R,a))}return M}function Fn(e){return void 0!==e}function St(e,r=""){const i=ft(),a=yi(),u=e+li,_=a.firstCreatePass?bh(a,u,1,r,null):a.data[u],b=oi(a,i,_,r,e);i[u]=b,j()&&lh(a,i,b,_),Ls(_,!1)}let oi=(e,r,i,a,u)=>(q(!0),function fp(e,r){return e.createText(r)}(r[Ln],a));function Ar(e){return Ci("",e,""),Ar}function Ci(e,r,i){const a=ft(),u=function au(e,r,i,a){return Vo(e,ha(),i)?r+rt(i)+a:Zn}(a,e,r,i);return u!==Zn&&function Ga(e,r,i){const a=fs(r,e);!function ay(e,r,i){e.setValue(r,i)}(e[Ln],a,i)}(a,y(),u),Ci}function $E(e,r,i){const a=ft();return Vo(a,ha(),r)&&ys(yi(),C(),a,e,r,a[Ln],i,!0),$E}const u_="en-US";let TT=u_;class om{}class JT{}class XE extends om{constructor(r,i,a){super(),this._parent=i,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new ab(this);const u=or(r);this._bootstrapComponents=Gs(u.bootstrap),this._r3Injector=Px(r,i,[{provide:om,useValue:this},{provide:gh,useValue:this.componentFactoryResolver},...a],at(r),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(r)}get injector(){return this._r3Injector}destroy(){const r=this._r3Injector;!r.destroyed&&r.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(r){this.destroyCbs.push(r)}}class KE extends JT{constructor(r){super(),this.moduleType=r}create(r){return new XE(this.moduleType,r,[])}}class QT extends om{constructor(r){super(),this.componentFactoryResolver=new ab(this),this.instance=null;const i=new hh([...r.providers,{provide:om,useValue:this},{provide:gh,useValue:this.componentFactoryResolver}],r.parent||_g(),r.debugName,new Set(["environment"]));this.injector=i,r.runEnvironmentInitializers&&i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(r){this.injector.onDestroy(r)}}function JE(e,r,i=null){return new QT({providers:e,parent:r,debugName:i,runEnvironmentInitializers:!0}).injector}let jR=(()=>{class e{constructor(i){this._injector=i,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(i){if(!i.standalone)return null;if(!this.cachedInjectors.has(i)){const a=px(0,i.type),u=a.length>0?JE([a],this._injector,`Standalone[${i.type.name}]`):null;this.cachedInjectors.set(i,u)}return this.cachedInjectors.get(i)}ngOnDestroy(){try{for(const i of this.cachedInjectors.values())null!==i&&i.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=$t({token:e,providedIn:"environment",factory:()=>new e(Qe($s))})}return e})();function eM(e){e.getStandaloneInjector=r=>r.get(jR).getOrCreateStandaloneInjector(e)}function aM(e,r,i,a){return function lM(e,r,i,a,u,_){const b=r+i;return Vo(e,b,u)?function ya(e,r,i){return e[r]=i}(e,b+1,_?a.call(_,u):a(u)):function Nv(e,r){const i=e[r];return i===Zn?void 0:i}(e,b+1)}(ft(),function Qr(){const e=_n.lFrame;let r=e.bindingRootIndex;return-1===r&&(r=e.bindingRootIndex=e.tView.bindingStartIndex),r}(),e,r,i,a)}function dP(){return this._results[Symbol.iterator]()}class eC{static#e=Symbol.iterator;get changes(){return this._changes||(this._changes=new oo)}constructor(r=!1){this._emitDistinctChangesOnly=r,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const i=eC.prototype;i[Symbol.iterator]||(i[Symbol.iterator]=dP)}get(r){return this._results[r]}map(r){return this._results.map(r)}filter(r){return this._results.filter(r)}find(r){return this._results.find(r)}reduce(r,i){return this._results.reduce(r,i)}forEach(r){this._results.forEach(r)}some(r){return this._results.some(r)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(r,i){const a=this;a.dirty=!1;const u=function Bs(e){return e.flat(Number.POSITIVE_INFINITY)}(r);(this._changesDetected=!function b0(e,r,i){if(e.length!==r.length)return!1;for(let a=0;a<e.length;a++){let u=e[a],_=r[a];if(i&&(u=i(u),_=i(_)),_!==u)return!1}return!0}(a._results,u,i))&&(a._results=u,a.length=u.length,a.last=u[this.length-1],a.first=u[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function pP(e,r,i,a=!0){const u=r[Gt];if(function ww(e,r,i,a){const u=Mr+a,_=i.length;a>0&&(i[u-1][us]=r),a<_-Mr?(r[us]=i[u],w0(i,Mr+a,r)):(i.push(r),r[us]=null),r[Yi]=i;const b=r[Fu];null!==b&&i!==b&&function Ew(e,r){const i=e[ds];r[ur]!==r[Yi][Yi][ur]&&(e[fl]=!0),null===i?e[ds]=[r]:i.push(r)}(b,r);const M=r[Os];null!==M&&M.insertView(e),r[qn]|=128}(u,r,e,i),a){const _=my(i,e),b=r[Ln],M=mp(b,e[_o]);null!==M&&function ly(e,r,i,a,u,_){a[Kt]=u,a[Yr]=r,jd(e,a,i,1,u,_)}(u,e[Yr],b,r,M,_)}}let hu=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=_P}return e})();const mP=hu,gP=class extends mP{constructor(r,i,a){super(),this._declarationLView=r,this._declarationTContainer=i,this.elementRef=a}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(r,i){return this.createEmbeddedViewImpl(r,i)}createEmbeddedViewImpl(r,i,a){const u=function fP(e,r,i,a){const u=r.tView,M=xh(e,u,i,4096&e[qn]?4096:16,null,r,null,null,null,a?.injector??null,a?.hydrationInfo??null);M[Fu]=e[r.index];const z=e[Os];return null!==z&&(M[Os]=z.createEmbeddedView(u)),rv(u,M,i),M}(this._declarationLView,this._declarationTContainer,r,{injector:i,hydrationInfo:a});return new Yp(u)}};function _P(){return Kb(Gr(),ft())}function Kb(e,r){return 4&e.type?new gP(r,e,_h(e,r)):null}let Tl=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=EP}return e})();function EP(){return vM(Gr(),ft())}const CP=Tl,_M=class extends CP{constructor(r,i,a){super(),this._lContainer=r,this._hostTNode=i,this._hostLView=a}get element(){return _h(this._hostTNode,this._hostLView)}get injector(){return new Ei(this._hostTNode,this._hostLView)}get parentInjector(){const r=Dn(this._hostTNode,this._hostLView);if(Se(r)){const i=He(r,this._hostLView),a=pe(r);return new Ei(i[Gt].data[a+8],i)}return new Ei(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(r){const i=yM(this._lContainer);return null!==i&&i[r]||null}get length(){return this._lContainer.length-Mr}createEmbeddedView(r,i,a){let u,_;"number"==typeof a?u=a:null!=a&&(u=a.index,_=a.injector);const M=r.createEmbeddedViewImpl(i||{},_,null);return this.insertImpl(M,u,false),M}createComponent(r,i,a,u,_){const b=r&&!function hr(e){return"function"==typeof e}(r);let M;if(b)M=i;else{const ke=i||{};M=ke.index,a=ke.injector,u=ke.projectableNodes,_=ke.environmentInjector||ke.ngModuleRef}const R=b?r:new hf(ni(r)),z=a||this.parentInjector;if(!_&&null==R.ngModule){const ut=(b?z:this.parentInjector).get($s,null);ut&&(_=ut)}ni(R.componentType??{});const me=R.create(z,u,null,_);return this.insertImpl(me.hostView,M,false),me}insert(r,i){return this.insertImpl(r,i,!1)}insertImpl(r,i,a){const u=r._lView;if(function qf(e){return Xr(e[Yi])}(u)){const R=this.indexOf(r);if(-1!==R)this.detach(R);else{const z=u[Yi],$=new _M(z,z[Yr],z[Yi]);$.detach($.indexOf(r))}}const b=this._adjustIndex(i),M=this._lContainer;return pP(M,u,b,!a),r.attachToViewContainerRef(),w0(tC(M),b,r),r}move(r,i){return this.insert(r,i)}indexOf(r){const i=yM(this._lContainer);return null!==i?i.indexOf(r):-1}remove(r){const i=this._adjustIndex(r,-1),a=Jm(this._lContainer,i);a&&(Ri(tC(this._lContainer),i),cy(a[Gt],a))}detach(r){const i=this._adjustIndex(r,-1),a=Jm(this._lContainer,i);return a&&null!=Ri(tC(this._lContainer),i)?new Yp(a):null}_adjustIndex(r,i=0){return r??this.length+i}};function yM(e){return e[8]}function tC(e){return e[8]||(e[8]=[])}function vM(e,r){let i;const a=r[e.index];return Xr(a)?i=a:(i=eb(a,r,null,e),r[e.index]=i,Eh(r,i)),xM(i,r,e,a),new _M(i,e,r)}let xM=function bM(e,r,i,a){if(e[_o])return;let u;u=8&i.type?mi(a):function DP(e,r){const i=e[Ln],a=i.createComment(""),u=co(r,e);return sc(i,mp(i,u),a,function hy(e,r){return e.nextSibling(r)}(i,u),!1),a}(r,i),e[_o]=u};class nC{constructor(r){this.queryList=r,this.matches=null}clone(){return new nC(this.queryList)}setDirty(){this.queryList.setDirty()}}class iC{constructor(r=[]){this.queries=r}createEmbeddedView(r){const i=r.queries;if(null!==i){const a=null!==r.contentQueries?r.contentQueries[0]:i.length,u=[];for(let _=0;_<a;_++){const b=i.getByIndex(_);u.push(this.queries[b.indexInDeclarationView].clone())}return new iC(u)}return null}insertView(r){this.dirtyQueriesWithMatches(r)}detachView(r){this.dirtyQueriesWithMatches(r)}dirtyQueriesWithMatches(r){for(let i=0;i<this.queries.length;i++)null!==IM(r,i).matches&&this.queries[i].setDirty()}}class wM{constructor(r,i,a=null){this.predicate=r,this.flags=i,this.read=a}}class rC{constructor(r=[]){this.queries=r}elementStart(r,i){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(r,i)}elementEnd(r){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(r)}embeddedTView(r){let i=null;for(let a=0;a<this.length;a++){const u=null!==i?i.length:0,_=this.getByIndex(a).embeddedTView(r,u);_&&(_.indexInDeclarationView=a,null!==i?i.push(_):i=[_])}return null!==i?new rC(i):null}template(r,i){for(let a=0;a<this.queries.length;a++)this.queries[a].template(r,i)}getByIndex(r){return this.queries[r]}get length(){return this.queries.length}track(r){this.queries.push(r)}}class oC{constructor(r,i=-1){this.metadata=r,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=i}elementStart(r,i){this.isApplyingToNode(i)&&this.matchTNode(r,i)}elementEnd(r){this._declarationNodeIndex===r.index&&(this._appliesToNextNode=!1)}template(r,i){this.elementStart(r,i)}embeddedTView(r,i){return this.isApplyingToNode(r)?(this.crossesNgTemplate=!0,this.addMatch(-r.index,i),new oC(this.metadata)):null}isApplyingToNode(r){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const i=this._declarationNodeIndex;let a=r.parent;for(;null!==a&&8&a.type&&a.index!==i;)a=a.parent;return i===(null!==a?a.index:-1)}return this._appliesToNextNode}matchTNode(r,i){const a=this.metadata.predicate;if(Array.isArray(a))for(let u=0;u<a.length;u++){const _=a[u];this.matchTNodeWithReadOption(r,i,IP(i,_)),this.matchTNodeWithReadOption(r,i,vi(i,r,_,!1,!1))}else a===hu?4&i.type&&this.matchTNodeWithReadOption(r,i,-1):this.matchTNodeWithReadOption(r,i,vi(i,r,a,!1,!1))}matchTNodeWithReadOption(r,i,a){if(null!==a){const u=this.metadata.read;if(null!==u)if(u===Bo||u===Tl||u===hu&&4&i.type)this.addMatch(i.index,-2);else{const _=vi(i,r,u,!1,!1);null!==_&&this.addMatch(i.index,_)}else this.addMatch(i.index,a)}}addMatch(r,i){null===this.matches?this.matches=[r,i]:this.matches.push(r,i)}}function IP(e,r){const i=e.localNames;if(null!==i)for(let a=0;a<i.length;a+=2)if(i[a]===r)return i[a+1];return null}function AP(e,r,i,a){return-1===i?function SP(e,r){return 11&e.type?_h(e,r):4&e.type?Kb(e,r):null}(r,e):-2===i?function RP(e,r,i){return i===Bo?_h(r,e):i===hu?Kb(r,e):i===Tl?vM(r,e):void 0}(e,r,a):Rn(e,e[Gt],i,r)}function EM(e,r,i,a){const u=r[Os].queries[a];if(null===u.matches){const _=e.data,b=i.matches,M=[];for(let R=0;R<b.length;R+=2){const z=b[R];M.push(z<0?null:AP(r,_[z],b[R+1],i.metadata.read))}u.matches=M}return u.matches}function sC(e,r,i,a){const u=e.queries.getByIndex(i),_=u.matches;if(null!==_){const b=EM(e,r,u,i);for(let M=0;M<_.length;M+=2){const R=_[M];if(R>0)a.push(b[M/2]);else{const z=_[M+1],$=r[-R];for(let K=Mr;K<$.length;K++){const ce=$[K];ce[Fu]===ce[Yi]&&sC(ce[Gt],ce,z,a)}if(null!==$[ds]){const K=$[ds];for(let ce=0;ce<K.length;ce++){const me=K[ce];sC(me[Gt],me,z,a)}}}}}return a}function aC(e){const r=ft(),i=yi(),a=tp();th(a+1);const u=IM(i,a);if(e.dirty&&function Ad(e){return 4==(4&e[qn])}(r)===(2==(2&u.metadata.flags))){if(null===u.matches)e.reset([]);else{const _=u.crossesNgTemplate?sC(i,r,a,[]):EM(i,r,u,a);e.reset(_,Rx),e.notifyOnChanges()}return!0}return!1}function CM(e,r,i){const a=yi();a.firstCreatePass&&(function MM(e,r,i){null===e.queries&&(e.queries=new rC),e.queries.track(new oC(r,i))}(a,new wM(e,r,i),-1),2==(2&r)&&(a.staticViewQueries=!0)),function TM(e,r,i){const a=new eC(4==(4&i));(function Zx(e,r,i,a){const u=tb(r);u.push(i),e.firstCreatePass&&Vg(e).push(a,u.length-1)})(e,r,a,a.destroy),null===r[Os]&&(r[Os]=new iC),r[Os].queries.push(new nC(a))}(a,ft(),r)}function IM(e,r){return e.queries.getByIndex(r)}function SM(e,r){return Kb(e,r)}const pC=new Bt("Application Initializer");let mC=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,a)=>{this.resolve=i,this.reject=a}),this.appInits=Xt(pC,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const i=[];for(const u of this.appInits){const _=u();if(e_(_))i.push(_);else if(t_(_)){const b=new Promise((M,R)=>{_.subscribe({complete:M,error:R})});i.push(b)}}const a=()=>{this.done=!0,this.resolve()};Promise.all(i).then(()=>{a()}).catch(u=>{this.reject(u)}),0===i.length&&a(),this.initialized=!0}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),qM=(()=>{class e{log(i){console.log(i)}warn(i){console.warn(i)}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const du=new Bt("LocaleId",{providedIn:"root",factory:()=>Xt(du,Kn.Optional|Kn.SkipSelf)||function eO(){return typeof $localize<"u"&&$localize.locale||u_}()});let ZM=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new rn(!1)}add(){this.hasPendingTasks.next(!0);const i=this.taskId++;return this.pendingTasks.add(i),i}remove(i){this.pendingTasks.delete(i),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class iO{constructor(r,i){this.ngModuleFactory=r,this.componentFactories=i}}let WM=(()=>{class e{compileModuleSync(i){return new KE(i)}compileModuleAsync(i){return Promise.resolve(this.compileModuleSync(i))}compileModuleAndAllComponentsSync(i){const a=this.compileModuleSync(i),_=Gs(or(i).declarations).reduce((b,M)=>{const R=ni(M);return R&&b.push(new hf(R)),b},[]);return new iO(a,_)}compileModuleAndAllComponentsAsync(i){return Promise.resolve(this.compileModuleAndAllComponentsSync(i))}clearCache(){}clearCacheFor(i){}getModuleId(i){}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const JM=new Bt(""),t1=new Bt("");let xC,yC=(()=>{class e{constructor(i,a,u){this._ngZone=i,this.registry=a,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,xC||(function DO(e){xC=e}(u),u.addToWindow(a)),this._watchAngularEvents(),i.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{hi.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let i=this._callbacks.pop();clearTimeout(i.timeoutId),i.doneCb(this._didWork)}this._didWork=!1});else{let i=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(i)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(i=>({source:i.source,creationLocation:i.creationLocation,data:i.data})):[]}addCallback(i,a,u){let _=-1;a&&a>0&&(_=setTimeout(()=>{this._callbacks=this._callbacks.filter(b=>b.timeoutId!==_),i(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:i,timeoutId:_,updateCb:u})}whenStable(i,a,u){if(u&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(i,a,u),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(i){this.registry.registerApplication(i,this)}unregisterApplication(i){this.registry.unregisterApplication(i)}findProviders(i,a,u){return[]}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(hi),Qe(vC),Qe(t1))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac})}return e})(),vC=(()=>{class e{constructor(){this._applications=new Map}registerApplication(i,a){this._applications.set(i,a)}unregisterApplication(i){this._applications.delete(i)}unregisterAllApplications(){this._applications.clear()}getTestability(i){return this._applications.get(i)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(i,a=!0){return xC?.findTestabilityInTree(this,i,a)??null}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),xf=null;const QM=new Bt("AllowMultipleToken"),bC=new Bt("PlatformDestroyListeners"),wC=new Bt("appBootstrapListener");class tI{constructor(r,i){this.name=r,this.token=i}}function iI(e,r,i=[]){const a=`Platform: ${r}`,u=new Bt(a);return(_=[])=>{let b=EC();if(!b||b.injector.get(QM,!1)){const M=[...i,..._,{provide:u,useValue:!0}];e?e(M):function IO(e){if(xf&&!xf.get(QM,!1))throw new xt(400,!1);(function eI(){!function Vt(e){Gc=e}(()=>{throw new xt(600,!1)})})(),xf=e;const r=e.get(oI);(function nI(e){e.get(Ap,null)?.forEach(i=>i())})(e)}(function rI(e=[],r){return uo.create({name:r,providers:[{provide:qd,useValue:"platform"},{provide:bC,useValue:new Set([()=>xf=null])},...e]})}(M,a))}return function AO(e){const r=EC();if(!r)throw new xt(401,!1);return r}()}}function EC(){return xf?.get(oI)??null}let oI=(()=>{class e{constructor(i){this._injector=i,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(i,a){const u=function RO(e="zone.js",r){return"noop"===e?new Fx:"zone.js"===e?new hi(r):e}(a?.ngZone,function sI(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:a?.ngZoneEventCoalescing,runCoalescing:a?.ngZoneRunCoalescing}));return u.run(()=>{const _=function VR(e,r,i){return new XE(e,r,i)}(i.moduleType,this.injector,function hI(e){return[{provide:hi,useFactory:e},{provide:Mp,multi:!0,useFactory:()=>{const r=Xt(OO,{optional:!0});return()=>r.initialize()}},{provide:uI,useFactory:PO},{provide:vh,useFactory:Sg}]}(()=>u)),b=_.injector.get(ui,null);return u.runOutsideAngular(()=>{const M=u.onError.subscribe({next:R=>{b.handleError(R)}});_.onDestroy(()=>{n1(this._modules,_),M.unsubscribe()})}),function aI(e,r,i){try{const a=i();return e_(a)?a.catch(u=>{throw r.runOutsideAngular(()=>e.handleError(u)),u}):a}catch(a){throw r.runOutsideAngular(()=>e.handleError(a)),a}}(b,u,()=>{const M=_.injector.get(mC);return M.runInitializers(),M.donePromise.then(()=>(function MT(e){jr(e,"Expected localeId to be defined"),"string"==typeof e&&(TT=e.toLowerCase().replace(/_/g,"-"))}(_.injector.get(du,u_)||u_),this._moduleDoBootstrap(_),_))})})}bootstrapModule(i,a=[]){const u=lI({},a);return function TO(e,r,i){const a=new KE(i);return Promise.resolve(a)}(0,0,i).then(_=>this.bootstrapModuleFactory(_,u))}_moduleDoBootstrap(i){const a=i.injector.get(sm);if(i._bootstrapComponents.length>0)i._bootstrapComponents.forEach(u=>a.bootstrap(u));else{if(!i.instance.ngDoBootstrap)throw new xt(-403,!1);i.instance.ngDoBootstrap(a)}this._modules.push(i)}onDestroy(i){this._destroyListeners.push(i)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new xt(404,!1);this._modules.slice().forEach(a=>a.destroy()),this._destroyListeners.forEach(a=>a());const i=this._injector.get(bC,null);i&&(i.forEach(a=>a()),i.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(uo))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function lI(e,r){return Array.isArray(r)?r.reduce(lI,e):{...e,...r}}let sm=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Xt(uI),this.zoneIsStable=Xt(vh),this.componentTypes=[],this.components=[],this.isStable=Xt(ZM).hasPendingTasks.pipe(Js(i=>i?Sn(!1):this.zoneIsStable),Ds(),bu()),this._injector=Xt($s)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(i,a){const u=i instanceof Ix;if(!this._injector.get(mC).done)throw!u&&function Rs(e){const r=ni(e)||Fr(e)||Nr(e);return null!==r&&r.standalone}(i),new xt(405,!1);let b;b=u?i:this._injector.get(gh).resolveComponentFactory(i),this.componentTypes.push(b.componentType);const M=function MO(e){return e.isBoundToModule}(b)?void 0:this._injector.get(om),z=b.create(uo.NULL,[],a||b.selector,M),$=z.location.nativeElement,K=z.injector.get(JM,null);return K?.registerApplication($),z.onDestroy(()=>{this.detachView(z.hostView),n1(this.components,z),K?.unregisterApplication($)}),this._loadComponent(z),z}tick(){if(this._runningTick)throw new xt(101,!1);try{this._runningTick=!0;for(let i of this._views)i.detectChanges()}catch(i){this.internalErrorHandler(i)}finally{this._runningTick=!1}}attachView(i){const a=i;this._views.push(a),a.attachToAppRef(this)}detachView(i){const a=i;n1(this._views,a),a.detachFromAppRef()}_loadComponent(i){this.attachView(i.hostView),this.tick(),this.components.push(i);const a=this._injector.get(wC,[]);a.push(...this._bootstrapListeners),a.forEach(u=>u(i))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(i=>i()),this._views.slice().forEach(i=>i.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(i){return this._destroyListeners.push(i),()=>n1(this._destroyListeners,i)}destroy(){if(this._destroyed)throw new xt(406,!1);const i=this._injector;i.destroy&&!i.destroyed&&i.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function n1(e,r){const i=e.indexOf(r);i>-1&&e.splice(i,1)}const uI=new Bt("",{providedIn:"root",factory:()=>Xt(ui).handleError.bind(void 0)});function PO(){const e=Xt(hi),r=Xt(ui);return i=>e.runOutsideAngular(()=>r.handleError(i))}let OO=(()=>{class e{constructor(){this.zone=Xt(hi),this.applicationRef=Xt(sm)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();let CC=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=LO}return e})();function LO(e){return function FO(e,r,i){if(pl(e)&&!i){const a=$r(e.index,r);return new Yp(a,a)}return 47&e.type?new Yp(r[ur],r):null}(Gr(),ft(),16==(16&e))}class mI{constructor(){}supports(r){return Th(r)}create(r){return new UO(r)}}const jO=(e,r)=>r;class UO{constructor(r){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=r||jO}forEachItem(r){let i;for(i=this._itHead;null!==i;i=i._next)r(i)}forEachOperation(r){let i=this._itHead,a=this._removalsHead,u=0,_=null;for(;i||a;){const b=!a||i&&i.currentIndex<_I(a,u,_)?i:a,M=_I(b,u,_),R=b.currentIndex;if(b===a)u--,a=a._nextRemoved;else if(i=i._next,null==b.previousIndex)u++;else{_||(_=[]);const z=M-u,$=R-u;if(z!=$){for(let ce=0;ce<z;ce++){const me=ce<_.length?_[ce]:_[ce]=0,Me=me+ce;$<=Me&&Me<z&&(_[ce]=me+1)}_[b.previousIndex]=$-z}}M!==R&&r(b,M,R)}}forEachPreviousItem(r){let i;for(i=this._previousItHead;null!==i;i=i._nextPrevious)r(i)}forEachAddedItem(r){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)r(i)}forEachMovedItem(r){let i;for(i=this._movesHead;null!==i;i=i._nextMoved)r(i)}forEachRemovedItem(r){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)r(i)}forEachIdentityChange(r){let i;for(i=this._identityChangesHead;null!==i;i=i._nextIdentityChange)r(i)}diff(r){if(null==r&&(r=[]),!Th(r))throw new xt(900,!1);return this.check(r)?this:null}onDestroy(){}check(r){this._reset();let u,_,b,i=this._itHead,a=!1;if(Array.isArray(r)){this.length=r.length;for(let M=0;M<this.length;M++)_=r[M],b=this._trackByFn(M,_),null!==i&&Object.is(i.trackById,b)?(a&&(i=this._verifyReinsertion(i,_,b,M)),Object.is(i.item,_)||this._addIdentityChange(i,_)):(i=this._mismatch(i,_,b,M),a=!0),i=i._next}else u=0,function DE(e,r){if(Array.isArray(e))for(let i=0;i<e.length;i++)r(e[i]);else{const i=e[Symbol.iterator]();let a;for(;!(a=i.next()).done;)r(a.value)}}(r,M=>{b=this._trackByFn(u,M),null!==i&&Object.is(i.trackById,b)?(a&&(i=this._verifyReinsertion(i,M,b,u)),Object.is(i.item,M)||this._addIdentityChange(i,M)):(i=this._mismatch(i,M,b,u),a=!0),i=i._next,u++}),this.length=u;return this._truncate(i),this.collection=r,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let r;for(r=this._previousItHead=this._itHead;null!==r;r=r._next)r._nextPrevious=r._next;for(r=this._additionsHead;null!==r;r=r._nextAdded)r.previousIndex=r.currentIndex;for(this._additionsHead=this._additionsTail=null,r=this._movesHead;null!==r;r=r._nextMoved)r.previousIndex=r.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(r,i,a,u){let _;return null===r?_=this._itTail:(_=r._prev,this._remove(r)),null!==(r=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null))?(Object.is(r.item,i)||this._addIdentityChange(r,i),this._reinsertAfter(r,_,u)):null!==(r=null===this._linkedRecords?null:this._linkedRecords.get(a,u))?(Object.is(r.item,i)||this._addIdentityChange(r,i),this._moveAfter(r,_,u)):r=this._addAfter(new $O(i,a),_,u),r}_verifyReinsertion(r,i,a,u){let _=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null);return null!==_?r=this._reinsertAfter(_,r._prev,u):r.currentIndex!=u&&(r.currentIndex=u,this._addToMoves(r,u)),r}_truncate(r){for(;null!==r;){const i=r._next;this._addToRemovals(this._unlink(r)),r=i}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(r,i,a){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(r);const u=r._prevRemoved,_=r._nextRemoved;return null===u?this._removalsHead=_:u._nextRemoved=_,null===_?this._removalsTail=u:_._prevRemoved=u,this._insertAfter(r,i,a),this._addToMoves(r,a),r}_moveAfter(r,i,a){return this._unlink(r),this._insertAfter(r,i,a),this._addToMoves(r,a),r}_addAfter(r,i,a){return this._insertAfter(r,i,a),this._additionsTail=null===this._additionsTail?this._additionsHead=r:this._additionsTail._nextAdded=r,r}_insertAfter(r,i,a){const u=null===i?this._itHead:i._next;return r._next=u,r._prev=i,null===u?this._itTail=r:u._prev=r,null===i?this._itHead=r:i._next=r,null===this._linkedRecords&&(this._linkedRecords=new gI),this._linkedRecords.put(r),r.currentIndex=a,r}_remove(r){return this._addToRemovals(this._unlink(r))}_unlink(r){null!==this._linkedRecords&&this._linkedRecords.remove(r);const i=r._prev,a=r._next;return null===i?this._itHead=a:i._next=a,null===a?this._itTail=i:a._prev=i,r}_addToMoves(r,i){return r.previousIndex===i||(this._movesTail=null===this._movesTail?this._movesHead=r:this._movesTail._nextMoved=r),r}_addToRemovals(r){return null===this._unlinkedRecords&&(this._unlinkedRecords=new gI),this._unlinkedRecords.put(r),r.currentIndex=null,r._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=r,r._prevRemoved=null):(r._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=r),r}_addIdentityChange(r,i){return r.item=i,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=r:this._identityChangesTail._nextIdentityChange=r,r}}class $O{constructor(r,i){this.item=r,this.trackById=i,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class GO{constructor(){this._head=null,this._tail=null}add(r){null===this._head?(this._head=this._tail=r,r._nextDup=null,r._prevDup=null):(this._tail._nextDup=r,r._prevDup=this._tail,r._nextDup=null,this._tail=r)}get(r,i){let a;for(a=this._head;null!==a;a=a._nextDup)if((null===i||i<=a.currentIndex)&&Object.is(a.trackById,r))return a;return null}remove(r){const i=r._prevDup,a=r._nextDup;return null===i?this._head=a:i._nextDup=a,null===a?this._tail=i:a._prevDup=i,null===this._head}}class gI{constructor(){this.map=new Map}put(r){const i=r.trackById;let a=this.map.get(i);a||(a=new GO,this.map.set(i,a)),a.add(r)}get(r,i){const u=this.map.get(r);return u?u.get(r,i):null}remove(r){const i=r.trackById;return this.map.get(i).remove(r)&&this.map.delete(i),r}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function _I(e,r,i){const a=e.previousIndex;if(null===a)return a;let u=0;return i&&a<i.length&&(u=i[a]),a+r+u}function vI(){return new s1([new mI])}let s1=(()=>{class e{static#e=this.\u0275prov=$t({token:e,providedIn:"root",factory:vI});constructor(i){this.factories=i}static create(i,a){if(null!=a){const u=a.factories.slice();i=i.concat(u)}return new e(i)}static extend(i){return{provide:e,useFactory:a=>e.create(i,a||vI()),deps:[[e,new ap,new Gi]]}}find(i){const a=this.factories.find(u=>u.supports(i));if(null!=a)return a;throw new xt(901,!1)}}return e})();const YO=iI(null,"core",[]);let XO=(()=>{class e{constructor(i){}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(sm))};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({})}return e})();function AC(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}let RC=null;function f_(){return RC}class uk{}const Ji=new Bt("DocumentToken");let PC=(()=>{class e{historyGo(i){throw new Error("Not implemented")}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:function(){return Xt(dk)},providedIn:"platform"})}return e})();const hk=new Bt("Location Initialized");let dk=(()=>{class e extends PC{constructor(){super(),this._doc=Xt(Ji),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return f_().getBaseHref(this._doc)}onPopState(i){const a=f_().getGlobalEventTarget(this._doc,"window");return a.addEventListener("popstate",i,!1),()=>a.removeEventListener("popstate",i)}onHashChange(i){const a=f_().getGlobalEventTarget(this._doc,"window");return a.addEventListener("hashchange",i,!1),()=>a.removeEventListener("hashchange",i)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(i){this._location.pathname=i}pushState(i,a,u){this._history.pushState(i,a,u)}replaceState(i,a,u){this._history.replaceState(i,a,u)}forward(){this._history.forward()}back(){this._history.back()}historyGo(i=0){this._history.go(i)}getState(){return this._history.state}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:function(){return new e},providedIn:"platform"})}return e})();function OC(e,r){if(0==e.length)return r;if(0==r.length)return e;let i=0;return e.endsWith("/")&&i++,r.startsWith("/")&&i++,2==i?e+r.substring(1):1==i?e+r:e+"/"+r}function SI(e){const r=e.match(/#|\?|$/),i=r&&r.index||e.length;return e.slice(0,i-("/"===e[i-1]?1:0))+e.slice(i)}function Lh(e){return e&&"?"!==e[0]?"?"+e:e}let lm=(()=>{class e{historyGo(i){throw new Error("Not implemented")}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:function(){return Xt(RI)},providedIn:"root"})}return e})();const AI=new Bt("appBaseHref");let RI=(()=>{class e extends lm{constructor(i,a){super(),this._platformLocation=i,this._removeListenerFns=[],this._baseHref=a??this._platformLocation.getBaseHrefFromDOM()??Xt(Ji).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}prepareExternalUrl(i){return OC(this._baseHref,i)}path(i=!1){const a=this._platformLocation.pathname+Lh(this._platformLocation.search),u=this._platformLocation.hash;return u&&i?`${a}${u}`:a}pushState(i,a,u,_){const b=this.prepareExternalUrl(u+Lh(_));this._platformLocation.pushState(i,a,b)}replaceState(i,a,u,_){const b=this.prepareExternalUrl(u+Lh(_));this._platformLocation.replaceState(i,a,b)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(PC),Qe(AI,8))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),fk=(()=>{class e extends lm{constructor(i,a){super(),this._platformLocation=i,this._baseHref="",this._removeListenerFns=[],null!=a&&(this._baseHref=a)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}path(i=!1){let a=this._platformLocation.hash;return null==a&&(a="#"),a.length>0?a.substring(1):a}prepareExternalUrl(i){const a=OC(this._baseHref,i);return a.length>0?"#"+a:a}pushState(i,a,u,_){let b=this.prepareExternalUrl(u+Lh(_));0==b.length&&(b=this._platformLocation.pathname),this._platformLocation.pushState(i,a,b)}replaceState(i,a,u,_){let b=this.prepareExternalUrl(u+Lh(_));0==b.length&&(b=this._platformLocation.pathname),this._platformLocation.replaceState(i,a,b)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(PC),Qe(AI,8))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac})}return e})(),Uv=(()=>{class e{constructor(i){this._subject=new oo,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=i;const a=this._locationStrategy.getBaseHref();this._basePath=function gk(e){if(new RegExp("^(https?:)?//").test(e)){const[,i]=e.split(/\/\/[^\/]+/);return i}return e}(SI(PI(a))),this._locationStrategy.onPopState(u=>{this._subject.emit({url:this.path(!0),pop:!0,state:u.state,type:u.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(i=!1){return this.normalize(this._locationStrategy.path(i))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(i,a=""){return this.path()==this.normalize(i+Lh(a))}normalize(i){return e.stripTrailingSlash(function mk(e,r){if(!e||!r.startsWith(e))return r;const i=r.substring(e.length);return""===i||["/",";","?","#"].includes(i[0])?i:r}(this._basePath,PI(i)))}prepareExternalUrl(i){return i&&"/"!==i[0]&&(i="/"+i),this._locationStrategy.prepareExternalUrl(i)}go(i,a="",u=null){this._locationStrategy.pushState(u,"",i,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+Lh(a)),u)}replaceState(i,a="",u=null){this._locationStrategy.replaceState(u,"",i,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+Lh(a)),u)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(i=0){this._locationStrategy.historyGo?.(i)}onUrlChange(i){return this._urlChangeListeners.push(i),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(a=>{this._notifyUrlChangeListeners(a.url,a.state)})),()=>{const a=this._urlChangeListeners.indexOf(i);this._urlChangeListeners.splice(a,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(i="",a){this._urlChangeListeners.forEach(u=>u(i,a))}subscribe(i,a,u){return this._subject.subscribe({next:i,error:a,complete:u})}static#e=this.normalizeQueryParams=Lh;static#t=this.joinWithSlash=OC;static#n=this.stripTrailingSlash=SI;static#i=this.\u0275fac=function(a){return new(a||e)(Qe(lm))};static#r=this.\u0275prov=$t({token:e,factory:function(){return function pk(){return new Uv(Qe(lm))}()},providedIn:"root"})}return e})();function PI(e){return e.replace(/\/index.html$/,"")}class iL{constructor(r,i,a,u){this.$implicit=r,this.ngForOf=i,this.index=a,this.count=u}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let $I=(()=>{class e{set ngForOf(i){this._ngForOf=i,this._ngForOfDirty=!0}set ngForTrackBy(i){this._trackByFn=i}get ngForTrackBy(){return this._trackByFn}constructor(i,a,u){this._viewContainer=i,this._template=a,this._differs=u,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(i){i&&(this._template=i)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const i=this._ngForOf;!this._differ&&i&&(this._differ=this._differs.find(i).create(this.ngForTrackBy))}if(this._differ){const i=this._differ.diff(this._ngForOf);i&&this._applyChanges(i)}}_applyChanges(i){const a=this._viewContainer;i.forEachOperation((u,_,b)=>{if(null==u.previousIndex)a.createEmbeddedView(this._template,new iL(u.item,this._ngForOf,-1,-1),null===b?void 0:b);else if(null==b)a.remove(null===_?void 0:_);else if(null!==_){const M=a.get(_);a.move(M,b),GI(M,u)}});for(let u=0,_=a.length;u<_;u++){const M=a.get(u).context;M.index=u,M.count=_,M.ngForOf=this._ngForOf}i.forEachIdentityChange(u=>{GI(a.get(u.currentIndex),u)})}static ngTemplateContextGuard(i,a){return!0}static#e=this.\u0275fac=function(a){return new(a||e)(Pt(Tl),Pt(hu),Pt(s1))};static#t=this.\u0275dir=Tr({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return e})();function GI(e,r){e.context.$implicit=r.item}let GC=(()=>{class e{constructor(i,a){this._viewContainer=i,this._context=new rL,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=a}set ngIf(i){this._context.$implicit=this._context.ngIf=i,this._updateView()}set ngIfThen(i){HI("ngIfThen",i),this._thenTemplateRef=i,this._thenViewRef=null,this._updateView()}set ngIfElse(i){HI("ngIfElse",i),this._elseTemplateRef=i,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(i,a){return!0}static#e=this.\u0275fac=function(a){return new(a||e)(Pt(Tl),Pt(hu))};static#t=this.\u0275dir=Tr({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return e})();class rL{constructor(){this.$implicit=null,this.ngIf=null}}function HI(e,r){if(r&&!r.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${at(r)}'.`)}let WI=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({})}return e})();const YI="browser";function XI(e){return"server"===e}let OL=(()=>{class e{static#e=this.\u0275prov=$t({token:e,providedIn:"root",factory:()=>new kL(Qe(Ji),window)})}return e})();class kL{constructor(r,i){this.document=r,this.window=i,this.offset=()=>[0,0]}setOffset(r){this.offset=Array.isArray(r)?()=>r:r}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(r){this.supportsScrolling()&&this.window.scrollTo(r[0],r[1])}scrollToAnchor(r){if(!this.supportsScrolling())return;const i=function LL(e,r){const i=e.getElementById(r)||e.getElementsByName(r)[0];if(i)return i;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const a=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let u=a.currentNode;for(;u;){const _=u.shadowRoot;if(_){const b=_.getElementById(r)||_.querySelector(`[name="${r}"]`);if(b)return b}u=a.nextNode()}}return null}(this.document,r);i&&(this.scrollToElement(i),i.focus())}setHistoryScrollRestoration(r){this.supportsScrolling()&&(this.window.history.scrollRestoration=r)}scrollToElement(r){const i=r.getBoundingClientRect(),a=i.left+this.window.pageXOffset,u=i.top+this.window.pageYOffset,_=this.offset();this.window.scrollTo(a-_[0],u-_[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class oF extends uk{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class KC extends oF{static makeCurrent(){!function ck(e){RC||(RC=e)}(new KC)}onAndCancel(r,i,a){return r.addEventListener(i,a),()=>{r.removeEventListener(i,a)}}dispatchEvent(r,i){r.dispatchEvent(i)}remove(r){r.parentNode&&r.parentNode.removeChild(r)}createElement(r,i){return(i=i||this.getDefaultDocument()).createElement(r)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(r){return r.nodeType===Node.ELEMENT_NODE}isShadowRoot(r){return r instanceof DocumentFragment}getGlobalEventTarget(r,i){return"window"===i?window:"document"===i?r:"body"===i?r.body:null}getBaseHref(r){const i=function sF(){return qv=qv||document.querySelector("base"),qv?qv.getAttribute("href"):null}();return null==i?null:function aF(e){x1=x1||document.createElement("a"),x1.setAttribute("href",e);const r=x1.pathname;return"/"===r.charAt(0)?r:`/${r}`}(i)}resetBaseElement(){qv=null}getUserAgent(){return window.navigator.userAgent}getCookie(r){return function eL(e,r){r=encodeURIComponent(r);for(const i of e.split(";")){const a=i.indexOf("="),[u,_]=-1==a?[i,""]:[i.slice(0,a),i.slice(a+1)];if(u.trim()===r)return decodeURIComponent(_)}return null}(document.cookie,r)}}let x1,qv=null,cF=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac})}return e})();const JC=new Bt("EventManagerPlugins");let tS=(()=>{class e{constructor(i,a){this._zone=a,this._eventNameToPlugin=new Map,i.forEach(u=>{u.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,a,u){return this._findPluginFor(a).addEventListener(i,a,u)}getZone(){return this._zone}_findPluginFor(i){let a=this._eventNameToPlugin.get(i);if(a)return a;if(a=this._plugins.find(_=>_.supports(i)),!a)throw new xt(5101,!1);return this._eventNameToPlugin.set(i,a),a}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(JC),Qe(hi))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac})}return e})();class nS{constructor(r){this._doc=r}}const QC="ng-app-id";let iS=(()=>{class e{constructor(i,a,u,_={}){this.doc=i,this.appId=a,this.nonce=u,this.platformId=_,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=XI(_),this.resetHostNodes()}addStyles(i){for(const a of i)1===this.changeUsageCount(a,1)&&this.onStyleAdded(a)}removeStyles(i){for(const a of i)this.changeUsageCount(a,-1)<=0&&this.onStyleRemoved(a)}ngOnDestroy(){const i=this.styleNodesInDOM;i&&(i.forEach(a=>a.remove()),i.clear());for(const a of this.getAllStyles())this.onStyleRemoved(a);this.resetHostNodes()}addHost(i){this.hostNodes.add(i);for(const a of this.getAllStyles())this.addStyleToHost(i,a)}removeHost(i){this.hostNodes.delete(i)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(i){for(const a of this.hostNodes)this.addStyleToHost(a,i)}onStyleRemoved(i){const a=this.styleRef;a.get(i)?.elements?.forEach(u=>u.remove()),a.delete(i)}collectServerRenderedStyles(){const i=this.doc.head?.querySelectorAll(`style[${QC}="${this.appId}"]`);if(i?.length){const a=new Map;return i.forEach(u=>{null!=u.textContent&&a.set(u.textContent,u)}),a}return null}changeUsageCount(i,a){const u=this.styleRef;if(u.has(i)){const _=u.get(i);return _.usage+=a,_.usage}return u.set(i,{usage:a,elements:[]}),a}getStyleElement(i,a){const u=this.styleNodesInDOM,_=u?.get(a);if(_?.parentNode===i)return u.delete(a),_.removeAttribute(QC),_;{const b=this.doc.createElement("style");return this.nonce&&b.setAttribute("nonce",this.nonce),b.textContent=a,this.platformIsServer&&b.setAttribute(QC,this.appId),b}}addStyleToHost(i,a){const u=this.getStyleElement(i,a);i.appendChild(u);const _=this.styleRef,b=_.get(a)?.elements;b?b.push(u):_.set(a,{elements:[u],usage:1})}resetHostNodes(){const i=this.hostNodes;i.clear(),i.add(this.doc.head)}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(Ji),Qe(vg),Qe(ky,8),Qe(ga))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac})}return e})();const eD={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},tD=/%COMP%/g,fF=new Bt("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function oS(e,r){return r.map(i=>i.replace(tD,e))}let sS=(()=>{class e{constructor(i,a,u,_,b,M,R,z=null){this.eventManager=i,this.sharedStylesHost=a,this.appId=u,this.removeStylesOnCompDestroy=_,this.doc=b,this.platformId=M,this.ngZone=R,this.nonce=z,this.rendererByCompId=new Map,this.platformIsServer=XI(M),this.defaultRenderer=new nD(i,b,R,this.platformIsServer)}createRenderer(i,a){if(!i||!a)return this.defaultRenderer;this.platformIsServer&&a.encapsulation===As.ShadowDom&&(a={...a,encapsulation:As.Emulated});const u=this.getOrCreateRenderer(i,a);return u instanceof lS?u.applyToHost(i):u instanceof iD&&u.applyStyles(),u}getOrCreateRenderer(i,a){const u=this.rendererByCompId;let _=u.get(a.id);if(!_){const b=this.doc,M=this.ngZone,R=this.eventManager,z=this.sharedStylesHost,$=this.removeStylesOnCompDestroy,K=this.platformIsServer;switch(a.encapsulation){case As.Emulated:_=new lS(R,z,a,this.appId,$,b,M,K);break;case As.ShadowDom:return new _F(R,z,i,a,b,M,this.nonce,K);default:_=new iD(R,z,a,$,b,M,K)}u.set(a.id,_)}return _}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(tS),Qe(iS),Qe(vg),Qe(fF),Qe(Ji),Qe(ga),Qe(hi),Qe(ky))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac})}return e})();class nD{constructor(r,i,a,u){this.eventManager=r,this.doc=i,this.ngZone=a,this.platformIsServer=u,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(r,i){return i?this.doc.createElementNS(eD[i]||i,r):this.doc.createElement(r)}createComment(r){return this.doc.createComment(r)}createText(r){return this.doc.createTextNode(r)}appendChild(r,i){(aS(r)?r.content:r).appendChild(i)}insertBefore(r,i,a){r&&(aS(r)?r.content:r).insertBefore(i,a)}removeChild(r,i){r&&r.removeChild(i)}selectRootElement(r,i){let a="string"==typeof r?this.doc.querySelector(r):r;if(!a)throw new xt(-5104,!1);return i||(a.textContent=""),a}parentNode(r){return r.parentNode}nextSibling(r){return r.nextSibling}setAttribute(r,i,a,u){if(u){i=u+":"+i;const _=eD[u];_?r.setAttributeNS(_,i,a):r.setAttribute(i,a)}else r.setAttribute(i,a)}removeAttribute(r,i,a){if(a){const u=eD[a];u?r.removeAttributeNS(u,i):r.removeAttribute(`${a}:${i}`)}else r.removeAttribute(i)}addClass(r,i){r.classList.add(i)}removeClass(r,i){r.classList.remove(i)}setStyle(r,i,a,u){u&(rc.DashCase|rc.Important)?r.style.setProperty(i,a,u&rc.Important?"important":""):r.style[i]=a}removeStyle(r,i,a){a&rc.DashCase?r.style.removeProperty(i):r.style[i]=""}setProperty(r,i,a){r[i]=a}setValue(r,i){r.nodeValue=i}listen(r,i,a){if("string"==typeof r&&!(r=f_().getGlobalEventTarget(this.doc,r)))throw new Error(`Unsupported event target ${r} for event ${i}`);return this.eventManager.addEventListener(r,i,this.decoratePreventDefault(a))}decoratePreventDefault(r){return i=>{if("__ngUnwrap__"===i)return r;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>r(i)):r(i))&&i.preventDefault()}}}function aS(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class _F extends nD{constructor(r,i,a,u,_,b,M,R){super(r,_,b,R),this.sharedStylesHost=i,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const z=oS(u.id,u.styles);for(const $ of z){const K=document.createElement("style");M&&K.setAttribute("nonce",M),K.textContent=$,this.shadowRoot.appendChild(K)}}nodeOrShadowRoot(r){return r===this.hostEl?this.shadowRoot:r}appendChild(r,i){return super.appendChild(this.nodeOrShadowRoot(r),i)}insertBefore(r,i,a){return super.insertBefore(this.nodeOrShadowRoot(r),i,a)}removeChild(r,i){return super.removeChild(this.nodeOrShadowRoot(r),i)}parentNode(r){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(r)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class iD extends nD{constructor(r,i,a,u,_,b,M,R){super(r,_,b,M),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=u,this.styles=R?oS(R,a.styles):a.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class lS extends iD{constructor(r,i,a,u,_,b,M,R){const z=u+"-"+a.id;super(r,i,a,_,b,M,R,z),this.contentAttr=function pF(e){return"_ngcontent-%COMP%".replace(tD,e)}(z),this.hostAttr=function mF(e){return"_nghost-%COMP%".replace(tD,e)}(z)}applyToHost(r){this.applyStyles(),this.setAttribute(r,this.hostAttr,"")}createElement(r,i){const a=super.createElement(r,i);return super.setAttribute(a,this.contentAttr,""),a}}let yF=(()=>{class e extends nS{constructor(i){super(i)}supports(i){return!0}addEventListener(i,a,u){return i.addEventListener(a,u,!1),()=>this.removeEventListener(i,a,u)}removeEventListener(i,a,u){return i.removeEventListener(a,u)}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(Ji))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac})}return e})();const cS=["alt","control","meta","shift"],vF={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},xF={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let bF=(()=>{class e extends nS{constructor(i){super(i)}supports(i){return null!=e.parseEventName(i)}addEventListener(i,a,u){const _=e.parseEventName(a),b=e.eventCallback(_.fullKey,u,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>f_().onAndCancel(i,_.domEventName,b))}static parseEventName(i){const a=i.toLowerCase().split("."),u=a.shift();if(0===a.length||"keydown"!==u&&"keyup"!==u)return null;const _=e._normalizeKey(a.pop());let b="",M=a.indexOf("code");if(M>-1&&(a.splice(M,1),b="code."),cS.forEach(z=>{const $=a.indexOf(z);$>-1&&(a.splice($,1),b+=z+".")}),b+=_,0!=a.length||0===_.length)return null;const R={};return R.domEventName=u,R.fullKey=b,R}static matchEventFullKeyCode(i,a){let u=vF[i.key]||i.key,_="";return a.indexOf("code.")>-1&&(u=i.code,_="code."),!(null==u||!u)&&(u=u.toLowerCase()," "===u?u="space":"."===u&&(u="dot"),cS.forEach(b=>{b!==u&&(0,xF[b])(i)&&(_+=b+".")}),_+=u,_===a)}static eventCallback(i,a,u){return _=>{e.matchEventFullKeyCode(_,i)&&u.runGuarded(()=>a(_))}}static _normalizeKey(i){return"esc"===i?"escape":i}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(Ji))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac})}return e})();const DF=iI(YO,"browser",[{provide:ga,useValue:YI},{provide:Ap,useValue:function wF(){KC.makeCurrent()},multi:!0},{provide:Ji,useFactory:function CF(){return function Iw(e){ng=e}(document),document},deps:[]}]),TF=new Bt(""),dS=[{provide:t1,useClass:class lF{addToWindow(r){$i.getAngularTestability=(a,u=!0)=>{const _=r.findTestabilityInTree(a,u);if(null==_)throw new xt(5103,!1);return _},$i.getAllAngularTestabilities=()=>r.getAllTestabilities(),$i.getAllAngularRootElements=()=>r.getAllRootElements(),$i.frameworkStabilizers||($i.frameworkStabilizers=[]),$i.frameworkStabilizers.push(a=>{const u=$i.getAllAngularTestabilities();let _=u.length,b=!1;const M=function(R){b=b||R,_--,0==_&&a(b)};u.forEach(R=>{R.whenStable(M)})})}findTestabilityInTree(r,i,a){return null==i?null:r.getTestability(i)??(a?f_().isShadowRoot(i)?this.findTestabilityInTree(r,i.host,!0):this.findTestabilityInTree(r,i.parentElement,!0):null)}},deps:[]},{provide:JM,useClass:yC,deps:[hi,vC,t1]},{provide:yC,useClass:yC,deps:[hi,vC,t1]}],fS=[{provide:qd,useValue:"root"},{provide:ui,useFactory:function EF(){return new ui},deps:[]},{provide:JC,useClass:yF,multi:!0,deps:[Ji,hi,ga]},{provide:JC,useClass:bF,multi:!0,deps:[Ji]},sS,iS,tS,{provide:Ny,useExisting:sS},{provide:class FL{},useClass:cF,deps:[]},[]];let MF=(()=>{class e{constructor(i){}static withServerTransition(i){return{ngModule:e,providers:[{provide:vg,useValue:i.appId}]}}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(TF,12))};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({providers:[...fS,...dS],imports:[WI,XO]})}return e})(),pS=(()=>{class e{constructor(i){this._doc=i}getTitle(){return this._doc.title}setTitle(i){this._doc.title=i||""}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(Ji))};static#t=this.\u0275prov=$t({token:e,factory:function(a){let u=null;return u=a?new a:function SF(){return new pS(Qe(Ji))}(),u},providedIn:"root"})}return e})();function yS(e,r=0){return function kF(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):r}function b1(e){return Array.isArray(e)?e:[e]}function po(e){return null==e?"":"string"==typeof e?e:`${e}px`}function m_(e){return e instanceof Bo?e.nativeElement:e}typeof window<"u"&&window;const{isArray:LF}=Array;function vS(e){return ti(r=>function FF(e,r){return LF(r)?e(...r):e(r)}(e,r))}const NF=["addListener","removeListener"],zF=["addEventListener","removeEventListener"],BF=["on","off"];function oD(e,r,i,a){if(bi(i)&&(a=i,i=void 0),a)return oD(e,r,i).pipe(vS(a));const[u,_]=function UF(e){return bi(e.addEventListener)&&bi(e.removeEventListener)}(e)?zF.map(b=>M=>e[b](r,M,i)):function VF(e){return bi(e.addListener)&&bi(e.removeListener)}(e)?NF.map(xS(e,r)):function jF(e){return bi(e.on)&&bi(e.off)}(e)?BF.map(xS(e,r)):[];if(!u&&Zr(e))return Un(b=>oD(b,r,i))(tt(e));if(!u)throw new TypeError("Invalid event target");return new Di(b=>{const M=(...R)=>b.next(1<R.length?R:R[0]);return u(M),()=>_(M)})}function xS(e,r){return i=>a=>e[i](r,a)}class $F extends Zt{constructor(r,i){super()}schedule(r,i=0){return this}}const w1={setInterval(e,r,...i){const{delegate:a}=w1;return a?.setInterval?a.setInterval(e,r,...i):setInterval(e,r,...i)},clearInterval(e){const{delegate:r}=w1;return(r?.clearInterval||clearInterval)(e)},delegate:void 0};class sD extends $F{constructor(r,i){super(r,i),this.scheduler=r,this.work=i,this.pending=!1}schedule(r,i=0){var a;if(this.closed)return this;this.state=r;const u=this.id,_=this.scheduler;return null!=u&&(this.id=this.recycleAsyncId(_,u,i)),this.pending=!0,this.delay=i,this.id=null!==(a=this.id)&&void 0!==a?a:this.requestAsyncId(_,this.id,i),this}requestAsyncId(r,i,a=0){return w1.setInterval(r.flush.bind(r,this),a)}recycleAsyncId(r,i,a=0){if(null!=a&&this.delay===a&&!1===this.pending)return i;null!=i&&w1.clearInterval(i)}execute(r,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const a=this._execute(r,i);if(a)return a;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(r,i){let u,a=!1;try{this.work(r)}catch(_){a=!0,u=_||new Error("Scheduled action threw falsy error")}if(a)return this.unsubscribe(),u}unsubscribe(){if(!this.closed){const{id:r,scheduler:i}=this,{actions:a}=i;this.work=this.state=this.scheduler=null,this.pending=!1,d(a,this),null!=r&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,super.unsubscribe()}}}const Zv={schedule(e){let r=requestAnimationFrame,i=cancelAnimationFrame;const{delegate:a}=Zv;a&&(r=a.requestAnimationFrame,i=a.cancelAnimationFrame);const u=r(_=>{i=void 0,e(_)});return new Zt(()=>i?.(u))},requestAnimationFrame(...e){const{delegate:r}=Zv;return(r?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:r}=Zv;return(r?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0},bS={now:()=>(bS.delegate||Date).now(),delegate:void 0};class Wv{constructor(r,i=Wv.now){this.schedulerActionCtor=r,this.now=i}schedule(r,i=0,a){return new this.schedulerActionCtor(this,r).schedule(a,i)}}Wv.now=bS.now;class aD extends Wv{constructor(r,i=Wv.now){super(r,i),this.actions=[],this._active=!1}flush(r){const{actions:i}=this;if(this._active)return void i.push(r);let a;this._active=!0;do{if(a=r.execute(r.state,r.delay))break}while(r=i.shift());if(this._active=!1,a){for(;r=i.shift();)r.unsubscribe();throw a}}}new class HF extends aD{flush(r){this._active=!0;const i=this._scheduled;this._scheduled=void 0;const{actions:a}=this;let u;r=r||a.shift();do{if(u=r.execute(r.state,r.delay))break}while((r=a[0])&&r.id===i&&a.shift());if(this._active=!1,u){for(;(r=a[0])&&r.id===i&&a.shift();)r.unsubscribe();throw u}}}(class GF extends sD{constructor(r,i){super(r,i),this.scheduler=r,this.work=i}requestAsyncId(r,i,a=0){return null!==a&&a>0?super.requestAsyncId(r,i,a):(r.actions.push(this),r._scheduled||(r._scheduled=Zv.requestAnimationFrame(()=>r.flush(void 0))))}recycleAsyncId(r,i,a=0){var u;if(null!=a?a>0:this.delay>0)return super.recycleAsyncId(r,i,a);const{actions:_}=r;null!=i&&(null===(u=_[_.length-1])||void 0===u?void 0:u.id)!==i&&(Zv.cancelAnimationFrame(i),r._scheduled=void 0)}});let lD,ZF=1;const E1={};function wS(e){return e in E1&&(delete E1[e],!0)}const WF={setImmediate(e){const r=ZF++;return E1[r]=!0,lD||(lD=Promise.resolve()),lD.then(()=>wS(r)&&e()),r},clearImmediate(e){wS(e)}},{setImmediate:YF,clearImmediate:XF}=WF,C1={setImmediate(...e){const{delegate:r}=C1;return(r?.setImmediate||YF)(...e)},clearImmediate(e){const{delegate:r}=C1;return(r?.clearImmediate||XF)(e)},delegate:void 0},cD=(new class JF extends aD{flush(r){this._active=!0;const i=this._scheduled;this._scheduled=void 0;const{actions:a}=this;let u;r=r||a.shift();do{if(u=r.execute(r.state,r.delay))break}while((r=a[0])&&r.id===i&&a.shift());if(this._active=!1,u){for(;(r=a[0])&&r.id===i&&a.shift();)r.unsubscribe();throw u}}}(class KF extends sD{constructor(r,i){super(r,i),this.scheduler=r,this.work=i}requestAsyncId(r,i,a=0){return null!==a&&a>0?super.requestAsyncId(r,i,a):(r.actions.push(this),r._scheduled||(r._scheduled=C1.setImmediate(r.flush.bind(r,void 0))))}recycleAsyncId(r,i,a=0){var u;if(null!=a?a>0:this.delay>0)return super.recycleAsyncId(r,i,a);const{actions:_}=r;null!=i&&(null===(u=_[_.length-1])||void 0===u?void 0:u.id)!==i&&(C1.clearImmediate(i),r._scheduled===i&&(r._scheduled=void 0))}}),new aD(sD)),eN=cD;function ES(e=0,r,i=eN){let a=-1;return null!=r&&(as(r)?i=r:a=r),new Di(u=>{let _=function nN(e){return e instanceof Date&&!isNaN(e)}(e)?+e-i.now():e;_<0&&(_=0);let b=0;return i.schedule(function(){u.closed||(u.next(b++),0<=a?this.schedule(void 0,a):u.complete())},_)})}function CS(e,r=cD){return function tN(e){return Fi((r,i)=>{let a=!1,u=null,_=null,b=!1;const M=()=>{if(_?.unsubscribe(),_=null,a){a=!1;const z=u;u=null,i.next(z)}b&&i.complete()},R=()=>{_=null,b&&i.complete()};r.subscribe(si(i,z=>{a=!0,u=z,_||tt(e(z)).subscribe(_=si(i,M,R))},()=>{b=!0,(!a||!_||_.closed)&&i.complete()}))})}(()=>ES(e,r))}function Ys(e,r){return Fi((i,a)=>{let u=0;i.subscribe(si(a,_=>e.call(r,_,u++)&&a.next(_)))})}let uD;try{uD=typeof Intl<"u"&&Intl.v8BreakIterator}catch{uD=!1}let Yv,cm,hD,fu=(()=>{class e{constructor(i){this._platformId=i,this.isBrowser=this._platformId?function PL(e){return e===YI}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!uD)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(ga))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function D1(e){return function iN(){if(null==Yv&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Yv=!0}))}finally{Yv=Yv||!1}return Yv}()?e:!!e.capture}function rN(){if(null==cm){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return cm=!1,cm;if("scrollBehavior"in document.documentElement.style)cm=!0;else{const e=Element.prototype.scrollTo;cm=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return cm}function dD(){let e=typeof document<"u"&&document?document.activeElement:null;for(;e&&e.shadowRoot;){const r=e.shadowRoot.activeElement;if(r===e)break;e=r}return e}function wf(e){return e.composedPath?e.composedPath()[0]:e.target}function fD(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}const aN=new Bt("cdk-dir-doc",{providedIn:"root",factory:function lN(){return Xt(Ji)}}),cN=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let pD=(()=>{class e{constructor(i){this.value="ltr",this.change=new oo,i&&(this.value=function uN(e){const r=e?.toLowerCase()||"";return"auto"===r&&typeof navigator<"u"&&navigator?.language?cN.test(navigator.language)?"rtl":"ltr":"rtl"===r?"rtl":"ltr"}((i.body?i.body.dir:null)||(i.documentElement?i.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(aN,8))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Xv=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({})}return e})(),dN=(()=>{class e{constructor(i,a,u){this._ngZone=i,this._platform=a,this._scrolled=new Ti,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=u}register(i){this.scrollContainers.has(i)||this.scrollContainers.set(i,i.elementScrolled().subscribe(()=>this._scrolled.next(i)))}deregister(i){const a=this.scrollContainers.get(i);a&&(a.unsubscribe(),this.scrollContainers.delete(i))}scrolled(i=20){return this._platform.isBrowser?new Di(a=>{this._globalSubscription||this._addGlobalListener();const u=i>0?this._scrolled.pipe(CS(i)).subscribe(a):this._scrolled.subscribe(a);return this._scrolledCount++,()=>{u.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Sn()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((i,a)=>this.deregister(a)),this._scrolled.complete()}ancestorScrolled(i,a){const u=this.getAncestorScrollContainers(i);return this.scrolled(a).pipe(Ys(_=>!_||u.indexOf(_)>-1))}getAncestorScrollContainers(i){const a=[];return this.scrollContainers.forEach((u,_)=>{this._scrollableContainsElement(_,i)&&a.push(_)}),a}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(i,a){let u=m_(a),_=i.getElementRef().nativeElement;do{if(u==_)return!0}while(u=u.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>oD(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(hi),Qe(fu),Qe(Ji,8))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),TS=(()=>{class e{constructor(i,a,u){this._platform=i,this._change=new Ti,this._changeListener=_=>{this._change.next(_)},this._document=u,a.runOutsideAngular(()=>{if(i.isBrowser){const _=this._getWindow();_.addEventListener("resize",this._changeListener),_.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const i=this._getWindow();i.removeEventListener("resize",this._changeListener),i.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const i={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),i}getViewportRect(){const i=this.getViewportScrollPosition(),{width:a,height:u}=this.getViewportSize();return{top:i.top,left:i.left,bottom:i.top+u,right:i.left+a,height:u,width:a}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const i=this._document,a=this._getWindow(),u=i.documentElement,_=u.getBoundingClientRect();return{top:-_.top||i.body.scrollTop||a.scrollY||u.scrollTop||0,left:-_.left||i.body.scrollLeft||a.scrollX||u.scrollLeft||0}}change(i=20){return i>0?this._change.pipe(CS(i)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const i=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:i.innerWidth,height:i.innerHeight}:{width:0,height:0}}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(fu),Qe(hi),Qe(Ji,8))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),MS=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({})}return e})(),IS=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({imports:[Xv,MS,Xv,MS]})}return e})();function Sl(e){return e<=0?()=>Zi:Fi((r,i)=>{let a=0;r.subscribe(si(i,u=>{++a<=e&&(i.next(u),e<=a&&i.complete())}))})}function M1(e){return Fi((r,i)=>{tt(e).subscribe(si(i,()=>i.complete(),rs)),!i.closed&&r.subscribe(i)})}class mD{attach(r){return this._attachedHost=r,r.attach(this)}detach(){let r=this._attachedHost;null!=r&&(this._attachedHost=null,r.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(r){this._attachedHost=r}}class gD extends mD{constructor(r,i,a,u,_){super(),this.component=r,this.viewContainerRef=i,this.injector=a,this.componentFactoryResolver=u,this.projectableNodes=_}}class SS extends mD{constructor(r,i,a,u){super(),this.templateRef=r,this.viewContainerRef=i,this.context=a,this.injector=u}get origin(){return this.templateRef.elementRef}attach(r,i=this.context){return this.context=i,super.attach(r)}detach(){return this.context=void 0,super.detach()}}class pN extends mD{constructor(r){super(),this.element=r instanceof Bo?r.nativeElement:r}}class _D{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(r){return r instanceof gD?(this._attachedPortal=r,this.attachComponentPortal(r)):r instanceof SS?(this._attachedPortal=r,this.attachTemplatePortal(r)):this.attachDomPortal&&r instanceof pN?(this._attachedPortal=r,this.attachDomPortal(r)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(r){this._disposeFn=r}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class mN extends _D{constructor(r,i,a,u,_){super(),this.outletElement=r,this._componentFactoryResolver=i,this._appRef=a,this._defaultInjector=u,this.attachDomPortal=b=>{const M=b.element,R=this._document.createComment("dom-portal");M.parentNode.insertBefore(R,M),this.outletElement.appendChild(M),this._attachedPortal=b,super.setDisposeFn(()=>{R.parentNode&&R.parentNode.replaceChild(M,R)})},this._document=_}attachComponentPortal(r){const a=(r.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(r.component);let u;return r.viewContainerRef?(u=r.viewContainerRef.createComponent(a,r.viewContainerRef.length,r.injector||r.viewContainerRef.injector,r.projectableNodes||void 0),this.setDisposeFn(()=>u.destroy())):(u=a.create(r.injector||this._defaultInjector||uo.NULL),this._appRef.attachView(u.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(u.hostView),u.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(u)),this._attachedPortal=r,u}attachTemplatePortal(r){let i=r.viewContainerRef,a=i.createEmbeddedView(r.templateRef,r.context,{injector:r.injector});return a.rootNodes.forEach(u=>this.outletElement.appendChild(u)),a.detectChanges(),this.setDisposeFn(()=>{let u=i.indexOf(a);-1!==u&&i.remove(u)}),this._attachedPortal=r,a}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(r){return r.hostView.rootNodes[0]}}let yD=(()=>{class e extends _D{constructor(i,a,u){super(),this._componentFactoryResolver=i,this._viewContainerRef=a,this._isInitialized=!1,this.attached=new oo,this.attachDomPortal=_=>{const b=_.element,M=this._document.createComment("dom-portal");_.setAttachedHost(this),b.parentNode.insertBefore(M,b),this._getRootNode().appendChild(b),this._attachedPortal=_,super.setDisposeFn(()=>{M.parentNode&&M.parentNode.replaceChild(b,M)})},this._document=u}get portal(){return this._attachedPortal}set portal(i){this.hasAttached()&&!i&&!this._isInitialized||(this.hasAttached()&&super.detach(),i&&super.attach(i),this._attachedPortal=i||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(i){i.setAttachedHost(this);const a=null!=i.viewContainerRef?i.viewContainerRef:this._viewContainerRef,_=(i.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(i.component),b=a.createComponent(_,a.length,i.injector||a.injector,i.projectableNodes||void 0);return a!==this._viewContainerRef&&this._getRootNode().appendChild(b.hostView.rootNodes[0]),super.setDisposeFn(()=>b.destroy()),this._attachedPortal=i,this._attachedRef=b,this.attached.emit(b),b}attachTemplatePortal(i){i.setAttachedHost(this);const a=this._viewContainerRef.createEmbeddedView(i.templateRef,i.context,{injector:i.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=i,this._attachedRef=a,this.attached.emit(a),a}_getRootNode(){const i=this._viewContainerRef.element.nativeElement;return i.nodeType===i.ELEMENT_NODE?i:i.parentNode}static#e=this.\u0275fac=function(a){return new(a||e)(Pt(gh),Pt(Tl),Pt(Ji))};static#t=this.\u0275dir=Tr({type:e,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[df]})}return e})(),I1=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({})}return e})();const AS=rN();class gN{constructor(r,i){this._viewportRuler=r,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=i}attach(){}enable(){if(this._canBeEnabled()){const r=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=r.style.left||"",this._previousHTMLStyles.top=r.style.top||"",r.style.left=po(-this._previousScrollPosition.left),r.style.top=po(-this._previousScrollPosition.top),r.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const r=this._document.documentElement,a=r.style,u=this._document.body.style,_=a.scrollBehavior||"",b=u.scrollBehavior||"";this._isEnabled=!1,a.left=this._previousHTMLStyles.left,a.top=this._previousHTMLStyles.top,r.classList.remove("cdk-global-scrollblock"),AS&&(a.scrollBehavior=u.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),AS&&(a.scrollBehavior=_,u.scrollBehavior=b)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const i=this._document.body,a=this._viewportRuler.getViewportSize();return i.scrollHeight>a.height||i.scrollWidth>a.width}}class _N{constructor(r,i,a,u){this._scrollDispatcher=r,this._ngZone=i,this._viewportRuler=a,this._config=u,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(r){this._overlayRef=r}enable(){if(this._scrollSubscription)return;const r=this._scrollDispatcher.scrolled(0).pipe(Ys(i=>!i||!this._overlayRef.overlayElement.contains(i.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=r.subscribe(()=>{const i=this._viewportRuler.getViewportScrollPosition().top;Math.abs(i-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=r.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class RS{enable(){}disable(){}attach(){}}function vD(e,r){return r.some(i=>e.bottom<i.top||e.top>i.bottom||e.right<i.left||e.left>i.right)}function PS(e,r){return r.some(i=>e.top<i.top||e.bottom>i.bottom||e.left<i.left||e.right>i.right)}class yN{constructor(r,i,a,u){this._scrollDispatcher=r,this._viewportRuler=i,this._ngZone=a,this._config=u,this._scrollSubscription=null}attach(r){this._overlayRef=r}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const i=this._overlayRef.overlayElement.getBoundingClientRect(),{width:a,height:u}=this._viewportRuler.getViewportSize();vD(i,[{width:a,height:u,bottom:u,right:a,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let vN=(()=>{class e{constructor(i,a,u,_){this._scrollDispatcher=i,this._viewportRuler=a,this._ngZone=u,this.noop=()=>new RS,this.close=b=>new _N(this._scrollDispatcher,this._ngZone,this._viewportRuler,b),this.block=()=>new gN(this._viewportRuler,this._document),this.reposition=b=>new yN(this._scrollDispatcher,this._viewportRuler,this._ngZone,b),this._document=_}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(dN),Qe(TS),Qe(hi),Qe(Ji))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class OS{constructor(r){if(this.scrollStrategy=new RS,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,r){const i=Object.keys(r);for(const a of i)void 0!==r[a]&&(this[a]=r[a])}}}class xN{constructor(r,i){this.connectionPair=r,this.scrollableViewProperties=i}}let kS=(()=>{class e{constructor(i){this._attachedOverlays=[],this._document=i}ngOnDestroy(){this.detach()}add(i){this.remove(i),this._attachedOverlays.push(i)}remove(i){const a=this._attachedOverlays.indexOf(i);a>-1&&this._attachedOverlays.splice(a,1),0===this._attachedOverlays.length&&this.detach()}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(Ji))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),bN=(()=>{class e extends kS{constructor(i,a){super(i),this._ngZone=a,this._keydownListener=u=>{const _=this._attachedOverlays;for(let b=_.length-1;b>-1;b--)if(_[b]._keydownEvents.observers.length>0){const M=_[b]._keydownEvents;this._ngZone?this._ngZone.run(()=>M.next(u)):M.next(u);break}}}add(i){super.add(i),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(Ji),Qe(hi,8))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),wN=(()=>{class e extends kS{constructor(i,a,u){super(i),this._platform=a,this._ngZone=u,this._cursorStyleIsSet=!1,this._pointerDownListener=_=>{this._pointerDownEventTarget=wf(_)},this._clickListener=_=>{const b=wf(_),M="click"===_.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:b;this._pointerDownEventTarget=null;const R=this._attachedOverlays.slice();for(let z=R.length-1;z>-1;z--){const $=R[z];if($._outsidePointerEvents.observers.length<1||!$.hasAttached())continue;if($.overlayElement.contains(b)||$.overlayElement.contains(M))break;const K=$._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>K.next(_)):K.next(_)}}}add(i){if(super.add(i),!this._isAttached){const a=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(a)):this._addEventListeners(a),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=a.style.cursor,a.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const i=this._document.body;i.removeEventListener("pointerdown",this._pointerDownListener,!0),i.removeEventListener("click",this._clickListener,!0),i.removeEventListener("auxclick",this._clickListener,!0),i.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(i.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(i){i.addEventListener("pointerdown",this._pointerDownListener,!0),i.addEventListener("click",this._clickListener,!0),i.addEventListener("auxclick",this._clickListener,!0),i.addEventListener("contextmenu",this._clickListener,!0)}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(Ji),Qe(fu),Qe(hi,8))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),S1=(()=>{class e{constructor(i,a){this._platform=a,this._document=i}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const i="cdk-overlay-container";if(this._platform.isBrowser||fD()){const u=this._document.querySelectorAll(`.${i}[platform="server"], .${i}[platform="test"]`);for(let _=0;_<u.length;_++)u[_].remove()}const a=this._document.createElement("div");a.classList.add(i),fD()?a.setAttribute("platform","test"):this._platform.isBrowser||a.setAttribute("platform","server"),this._document.body.appendChild(a),this._containerElement=a}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(Ji),Qe(fu))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class Kv{constructor(r,i,a,u,_,b,M,R,z,$=!1){this._portalOutlet=r,this._host=i,this._pane=a,this._config=u,this._ngZone=_,this._keyboardDispatcher=b,this._document=M,this._location=R,this._outsideClickDispatcher=z,this._animationsDisabled=$,this._backdropElement=null,this._backdropClick=new Ti,this._attachments=new Ti,this._detachments=new Ti,this._locationChanges=Zt.EMPTY,this._backdropClickHandler=K=>this._backdropClick.next(K),this._backdropTransitionendHandler=K=>{this._disposeBackdrop(K.target)},this._keydownEvents=new Ti,this._outsidePointerEvents=new Ti,u.scrollStrategy&&(this._scrollStrategy=u.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=u.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(r){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const i=this._portalOutlet.attach(r);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Sl(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof i?.onDestroy&&i.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),i}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const r=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),r}dispose(){const r=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,r&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(r){r!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=r,this.hasAttached()&&(r.attach(this),this.updatePosition()))}updateSize(r){this._config={...this._config,...r},this._updateElementSize()}setDirection(r){this._config={...this._config,direction:r},this._updateElementDirection()}addPanelClass(r){this._pane&&this._toggleClasses(this._pane,r,!0)}removePanelClass(r){this._pane&&this._toggleClasses(this._pane,r,!1)}getDirection(){const r=this._config.direction;return r?"string"==typeof r?r:r.value:"ltr"}updateScrollStrategy(r){r!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=r,this.hasAttached()&&(r.attach(this),r.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const r=this._pane.style;r.width=po(this._config.width),r.height=po(this._config.height),r.minWidth=po(this._config.minWidth),r.minHeight=po(this._config.minHeight),r.maxWidth=po(this._config.maxWidth),r.maxHeight=po(this._config.maxHeight)}_togglePointerEvents(r){this._pane.style.pointerEvents=r?"":"none"}_attachBackdrop(){const r="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(r)})}):this._backdropElement.classList.add(r)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const r=this._backdropElement;if(r){if(this._animationsDisabled)return void this._disposeBackdrop(r);r.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{r.addEventListener("transitionend",this._backdropTransitionendHandler)}),r.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(r)},500))}}_toggleClasses(r,i,a){const u=b1(i||[]).filter(_=>!!_);u.length&&(a?r.classList.add(...u):r.classList.remove(...u))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const r=this._ngZone.onStable.pipe(M1(ir(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),r.unsubscribe())})})}_disposeScrollStrategy(){const r=this._scrollStrategy;r&&(r.disable(),r.detach&&r.detach())}_disposeBackdrop(r){r&&(r.removeEventListener("click",this._backdropClickHandler),r.removeEventListener("transitionend",this._backdropTransitionendHandler),r.remove(),this._backdropElement===r&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const LS="cdk-overlay-connected-position-bounding-box",EN=/([A-Za-z%]+)$/;class CN{get positions(){return this._preferredPositions}constructor(r,i,a,u,_){this._viewportRuler=i,this._document=a,this._platform=u,this._overlayContainer=_,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Ti,this._resizeSubscription=Zt.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(r)}attach(r){this._validatePositions(),r.hostElement.classList.add(LS),this._overlayRef=r,this._boundingBox=r.hostElement,this._pane=r.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const r=this._originRect,i=this._overlayRect,a=this._viewportRect,u=this._containerRect,_=[];let b;for(let M of this._preferredPositions){let R=this._getOriginPoint(r,u,M),z=this._getOverlayPoint(R,i,M),$=this._getOverlayFit(z,i,a,M);if($.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(M,R);this._canFitWithFlexibleDimensions($,z,a)?_.push({position:M,origin:R,overlayRect:i,boundingBoxRect:this._calculateBoundingBoxRect(R,M)}):(!b||b.overlayFit.visibleArea<$.visibleArea)&&(b={overlayFit:$,overlayPoint:z,originPoint:R,position:M,overlayRect:i})}if(_.length){let M=null,R=-1;for(const z of _){const $=z.boundingBoxRect.width*z.boundingBoxRect.height*(z.position.weight||1);$>R&&(R=$,M=z)}return this._isPushed=!1,void this._applyPosition(M.position,M.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(b.position,b.originPoint);this._applyPosition(b.position,b.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&um(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(LS),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const r=this._lastPosition;if(r){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const i=this._getOriginPoint(this._originRect,this._containerRect,r);this._applyPosition(r,i)}else this.apply()}withScrollableContainers(r){return this._scrollables=r,this}withPositions(r){return this._preferredPositions=r,-1===r.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(r){return this._viewportMargin=r,this}withFlexibleDimensions(r=!0){return this._hasFlexibleDimensions=r,this}withGrowAfterOpen(r=!0){return this._growAfterOpen=r,this}withPush(r=!0){return this._canPush=r,this}withLockedPosition(r=!0){return this._positionLocked=r,this}setOrigin(r){return this._origin=r,this}withDefaultOffsetX(r){return this._offsetX=r,this}withDefaultOffsetY(r){return this._offsetY=r,this}withTransformOriginOn(r){return this._transformOriginSelector=r,this}_getOriginPoint(r,i,a){let u,_;if("center"==a.originX)u=r.left+r.width/2;else{const b=this._isRtl()?r.right:r.left,M=this._isRtl()?r.left:r.right;u="start"==a.originX?b:M}return i.left<0&&(u-=i.left),_="center"==a.originY?r.top+r.height/2:"top"==a.originY?r.top:r.bottom,i.top<0&&(_-=i.top),{x:u,y:_}}_getOverlayPoint(r,i,a){let u,_;return u="center"==a.overlayX?-i.width/2:"start"===a.overlayX?this._isRtl()?-i.width:0:this._isRtl()?0:-i.width,_="center"==a.overlayY?-i.height/2:"top"==a.overlayY?0:-i.height,{x:r.x+u,y:r.y+_}}_getOverlayFit(r,i,a,u){const _=NS(i);let{x:b,y:M}=r,R=this._getOffset(u,"x"),z=this._getOffset(u,"y");R&&(b+=R),z&&(M+=z);let ce=0-M,me=M+_.height-a.height,Me=this._subtractOverflows(_.width,0-b,b+_.width-a.width),ke=this._subtractOverflows(_.height,ce,me),ut=Me*ke;return{visibleArea:ut,isCompletelyWithinViewport:_.width*_.height===ut,fitsInViewportVertically:ke===_.height,fitsInViewportHorizontally:Me==_.width}}_canFitWithFlexibleDimensions(r,i,a){if(this._hasFlexibleDimensions){const u=a.bottom-i.y,_=a.right-i.x,b=FS(this._overlayRef.getConfig().minHeight),M=FS(this._overlayRef.getConfig().minWidth);return(r.fitsInViewportVertically||null!=b&&b<=u)&&(r.fitsInViewportHorizontally||null!=M&&M<=_)}return!1}_pushOverlayOnScreen(r,i,a){if(this._previousPushAmount&&this._positionLocked)return{x:r.x+this._previousPushAmount.x,y:r.y+this._previousPushAmount.y};const u=NS(i),_=this._viewportRect,b=Math.max(r.x+u.width-_.width,0),M=Math.max(r.y+u.height-_.height,0),R=Math.max(_.top-a.top-r.y,0),z=Math.max(_.left-a.left-r.x,0);let $=0,K=0;return $=u.width<=_.width?z||-b:r.x<this._viewportMargin?_.left-a.left-r.x:0,K=u.height<=_.height?R||-M:r.y<this._viewportMargin?_.top-a.top-r.y:0,this._previousPushAmount={x:$,y:K},{x:r.x+$,y:r.y+K}}_applyPosition(r,i){if(this._setTransformOrigin(r),this._setOverlayElementStyles(i,r),this._setBoundingBoxStyles(i,r),r.panelClass&&this._addPanelClasses(r.panelClass),this._lastPosition=r,this._positionChanges.observers.length){const a=this._getScrollVisibility(),u=new xN(r,a);this._positionChanges.next(u)}this._isInitialRender=!1}_setTransformOrigin(r){if(!this._transformOriginSelector)return;const i=this._boundingBox.querySelectorAll(this._transformOriginSelector);let a,u=r.overlayY;a="center"===r.overlayX?"center":this._isRtl()?"start"===r.overlayX?"right":"left":"start"===r.overlayX?"left":"right";for(let _=0;_<i.length;_++)i[_].style.transformOrigin=`${a} ${u}`}_calculateBoundingBoxRect(r,i){const a=this._viewportRect,u=this._isRtl();let _,b,M,$,K,ce;if("top"===i.overlayY)b=r.y,_=a.height-b+this._viewportMargin;else if("bottom"===i.overlayY)M=a.height-r.y+2*this._viewportMargin,_=a.height-M+this._viewportMargin;else{const me=Math.min(a.bottom-r.y+a.top,r.y),Me=this._lastBoundingBoxSize.height;_=2*me,b=r.y-me,_>Me&&!this._isInitialRender&&!this._growAfterOpen&&(b=r.y-Me/2)}if("end"===i.overlayX&&!u||"start"===i.overlayX&&u)ce=a.width-r.x+this._viewportMargin,$=r.x-this._viewportMargin;else if("start"===i.overlayX&&!u||"end"===i.overlayX&&u)K=r.x,$=a.right-r.x;else{const me=Math.min(a.right-r.x+a.left,r.x),Me=this._lastBoundingBoxSize.width;$=2*me,K=r.x-me,$>Me&&!this._isInitialRender&&!this._growAfterOpen&&(K=r.x-Me/2)}return{top:b,left:K,bottom:M,right:ce,width:$,height:_}}_setBoundingBoxStyles(r,i){const a=this._calculateBoundingBoxRect(r,i);!this._isInitialRender&&!this._growAfterOpen&&(a.height=Math.min(a.height,this._lastBoundingBoxSize.height),a.width=Math.min(a.width,this._lastBoundingBoxSize.width));const u={};if(this._hasExactPosition())u.top=u.left="0",u.bottom=u.right=u.maxHeight=u.maxWidth="",u.width=u.height="100%";else{const _=this._overlayRef.getConfig().maxHeight,b=this._overlayRef.getConfig().maxWidth;u.height=po(a.height),u.top=po(a.top),u.bottom=po(a.bottom),u.width=po(a.width),u.left=po(a.left),u.right=po(a.right),u.alignItems="center"===i.overlayX?"center":"end"===i.overlayX?"flex-end":"flex-start",u.justifyContent="center"===i.overlayY?"center":"bottom"===i.overlayY?"flex-end":"flex-start",_&&(u.maxHeight=po(_)),b&&(u.maxWidth=po(b))}this._lastBoundingBoxSize=a,um(this._boundingBox.style,u)}_resetBoundingBoxStyles(){um(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){um(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(r,i){const a={},u=this._hasExactPosition(),_=this._hasFlexibleDimensions,b=this._overlayRef.getConfig();if(u){const $=this._viewportRuler.getViewportScrollPosition();um(a,this._getExactOverlayY(i,r,$)),um(a,this._getExactOverlayX(i,r,$))}else a.position="static";let M="",R=this._getOffset(i,"x"),z=this._getOffset(i,"y");R&&(M+=`translateX(${R}px) `),z&&(M+=`translateY(${z}px)`),a.transform=M.trim(),b.maxHeight&&(u?a.maxHeight=po(b.maxHeight):_&&(a.maxHeight="")),b.maxWidth&&(u?a.maxWidth=po(b.maxWidth):_&&(a.maxWidth="")),um(this._pane.style,a)}_getExactOverlayY(r,i,a){let u={top:"",bottom:""},_=this._getOverlayPoint(i,this._overlayRect,r);return this._isPushed&&(_=this._pushOverlayOnScreen(_,this._overlayRect,a)),"bottom"===r.overlayY?u.bottom=this._document.documentElement.clientHeight-(_.y+this._overlayRect.height)+"px":u.top=po(_.y),u}_getExactOverlayX(r,i,a){let b,u={left:"",right:""},_=this._getOverlayPoint(i,this._overlayRect,r);return this._isPushed&&(_=this._pushOverlayOnScreen(_,this._overlayRect,a)),b=this._isRtl()?"end"===r.overlayX?"left":"right":"end"===r.overlayX?"right":"left","right"===b?u.right=this._document.documentElement.clientWidth-(_.x+this._overlayRect.width)+"px":u.left=po(_.x),u}_getScrollVisibility(){const r=this._getOriginRect(),i=this._pane.getBoundingClientRect(),a=this._scrollables.map(u=>u.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:PS(r,a),isOriginOutsideView:vD(r,a),isOverlayClipped:PS(i,a),isOverlayOutsideView:vD(i,a)}}_subtractOverflows(r,...i){return i.reduce((a,u)=>a-Math.max(u,0),r)}_getNarrowedViewportRect(){const r=this._document.documentElement.clientWidth,i=this._document.documentElement.clientHeight,a=this._viewportRuler.getViewportScrollPosition();return{top:a.top+this._viewportMargin,left:a.left+this._viewportMargin,right:a.left+r-this._viewportMargin,bottom:a.top+i-this._viewportMargin,width:r-2*this._viewportMargin,height:i-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(r,i){return"x"===i?null==r.offsetX?this._offsetX:r.offsetX:null==r.offsetY?this._offsetY:r.offsetY}_validatePositions(){}_addPanelClasses(r){this._pane&&b1(r).forEach(i=>{""!==i&&-1===this._appliedPanelClasses.indexOf(i)&&(this._appliedPanelClasses.push(i),this._pane.classList.add(i))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(r=>{this._pane.classList.remove(r)}),this._appliedPanelClasses=[])}_getOriginRect(){const r=this._origin;if(r instanceof Bo)return r.nativeElement.getBoundingClientRect();if(r instanceof Element)return r.getBoundingClientRect();const i=r.width||0,a=r.height||0;return{top:r.y,bottom:r.y+a,left:r.x,right:r.x+i,height:a,width:i}}}function um(e,r){for(let i in r)r.hasOwnProperty(i)&&(e[i]=r[i]);return e}function FS(e){if("number"!=typeof e&&null!=e){const[r,i]=e.split(EN);return i&&"px"!==i?null:parseFloat(r)}return e||null}function NS(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const zS="cdk-global-overlay-wrapper";class DN{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(r){const i=r.getConfig();this._overlayRef=r,this._width&&!i.width&&r.updateSize({width:this._width}),this._height&&!i.height&&r.updateSize({height:this._height}),r.hostElement.classList.add(zS),this._isDisposed=!1}top(r=""){return this._bottomOffset="",this._topOffset=r,this._alignItems="flex-start",this}left(r=""){return this._xOffset=r,this._xPosition="left",this}bottom(r=""){return this._topOffset="",this._bottomOffset=r,this._alignItems="flex-end",this}right(r=""){return this._xOffset=r,this._xPosition="right",this}start(r=""){return this._xOffset=r,this._xPosition="start",this}end(r=""){return this._xOffset=r,this._xPosition="end",this}width(r=""){return this._overlayRef?this._overlayRef.updateSize({width:r}):this._width=r,this}height(r=""){return this._overlayRef?this._overlayRef.updateSize({height:r}):this._height=r,this}centerHorizontally(r=""){return this.left(r),this._xPosition="center",this}centerVertically(r=""){return this.top(r),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const r=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement.style,a=this._overlayRef.getConfig(),{width:u,height:_,maxWidth:b,maxHeight:M}=a,R=!("100%"!==u&&"100vw"!==u||b&&"100%"!==b&&"100vw"!==b),z=!("100%"!==_&&"100vh"!==_||M&&"100%"!==M&&"100vh"!==M),$=this._xPosition,K=this._xOffset,ce="rtl"===this._overlayRef.getConfig().direction;let me="",Me="",ke="";R?ke="flex-start":"center"===$?(ke="center",ce?Me=K:me=K):ce?"left"===$||"end"===$?(ke="flex-end",me=K):("right"===$||"start"===$)&&(ke="flex-start",Me=K):"left"===$||"start"===$?(ke="flex-start",me=K):("right"===$||"end"===$)&&(ke="flex-end",Me=K),r.position=this._cssPosition,r.marginLeft=R?"0":me,r.marginTop=z?"0":this._topOffset,r.marginBottom=this._bottomOffset,r.marginRight=R?"0":Me,i.justifyContent=ke,i.alignItems=z?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const r=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement,a=i.style;i.classList.remove(zS),a.justifyContent=a.alignItems=r.marginTop=r.marginBottom=r.marginLeft=r.marginRight=r.position="",this._overlayRef=null,this._isDisposed=!0}}let TN=(()=>{class e{constructor(i,a,u,_){this._viewportRuler=i,this._document=a,this._platform=u,this._overlayContainer=_}global(){return new DN}flexibleConnectedTo(i){return new CN(i,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(TS),Qe(Ji),Qe(fu),Qe(S1))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),MN=0,__=(()=>{class e{constructor(i,a,u,_,b,M,R,z,$,K,ce,me){this.scrollStrategies=i,this._overlayContainer=a,this._componentFactoryResolver=u,this._positionBuilder=_,this._keyboardDispatcher=b,this._injector=M,this._ngZone=R,this._document=z,this._directionality=$,this._location=K,this._outsideClickDispatcher=ce,this._animationsModuleType=me}create(i){const a=this._createHostElement(),u=this._createPaneElement(a),_=this._createPortalOutlet(u),b=new OS(i);return b.direction=b.direction||this._directionality.value,new Kv(_,a,u,b,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(i){const a=this._document.createElement("div");return a.id="cdk-overlay-"+MN++,a.classList.add("cdk-overlay-pane"),i.appendChild(a),a}_createHostElement(){const i=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(i),i}_createPortalOutlet(i){return this._appRef||(this._appRef=this._injector.get(sm)),new mN(i,this._componentFactoryResolver,this._appRef,this._injector,this._document)}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(vN),Qe(S1),Qe(gh),Qe(TN),Qe(bN),Qe(uo),Qe(hi),Qe(Ji),Qe(pD),Qe(Uv),Qe(wN),Qe(Oy,8))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const AN={provide:new Bt("cdk-connected-overlay-scroll-strategy"),deps:[__],useFactory:function SN(e){return()=>e.scrollStrategies.reposition()}};let BS=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({providers:[__,AN],imports:[Xv,I1,IS,IS]})}return e})();function jS(e,...r){return r.length?r.some(i=>e[i]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}function US(e){return Ys((r,i)=>e<=i)}let FN=(()=>{class e{create(i){return typeof MutationObserver>"u"?null:new MutationObserver(i)}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),NN=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({providers:[FN]})}return e})();const{isArray:zN}=Array,{getPrototypeOf:BN,prototype:VN,keys:jN}=Object;function A1(...e){const r=ls(e),i=function xu(e){return bi(Dr(e))?e.pop():void 0}(e),{args:a,keys:u}=function UN(e){if(1===e.length){const r=e[0];if(zN(r))return{args:r,keys:null};if(function $N(e){return e&&"object"==typeof e&&BN(e)===VN}(r)){const i=jN(r);return{args:i.map(a=>r[a]),keys:i}}}return{args:e,keys:null}}(e);if(0===a.length)return ki([],r);const _=new Di(function HN(e,r,i=on){return a=>{$S(r,()=>{const{length:u}=e,_=new Array(u);let b=u,M=u;for(let R=0;R<u;R++)$S(r,()=>{const z=ki(e[R],r);let $=!1;z.subscribe(si(a,K=>{_[R]=K,$||($=!0,M--),M||a.next(i(_.slice()))},()=>{--b||a.complete()}))},a)},a)}}(a,r,u?b=>function GN(e,r){return e.reduce((i,a,u)=>(i[a]=r[u],i),{})}(u,b):on));return i?_.pipe(vS(i)):_}function $S(e,r,i){e?Hn(i,e,r):r()}function R1(...e){return function qN(){return qi(1)}()(ki(e,ls(e)))}function P1(...e){const r=ls(e);return Fi((i,a)=>{(r?R1(e,i,r):R1(e,i)).subscribe(a)})}const GS=new Set;let hm,WN=(()=>{class e{constructor(i,a){this._platform=i,this._nonce=a,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):XN}matchMedia(i){return(this._platform.WEBKIT||this._platform.BLINK)&&function YN(e,r){if(!GS.has(e))try{hm||(hm=document.createElement("style"),r&&(hm.nonce=r),hm.setAttribute("type","text/css"),document.head.appendChild(hm)),hm.sheet&&(hm.sheet.insertRule(`@media ${e} {body{ }}`,0),GS.add(e))}catch(i){console.error(i)}}(i,this._nonce),this._matchMedia(i)}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(fu),Qe(ky,8))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function XN(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let KN=(()=>{class e{constructor(i,a){this._mediaMatcher=i,this._zone=a,this._queries=new Map,this._destroySubject=new Ti}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(i){return HS(b1(i)).some(u=>this._registerQuery(u).mql.matches)}observe(i){let _=A1(HS(b1(i)).map(b=>this._registerQuery(b).observable));return _=R1(_.pipe(Sl(1)),_.pipe(US(1),function ZN(e,r=cD){return Fi((i,a)=>{let u=null,_=null,b=null;const M=()=>{if(u){u.unsubscribe(),u=null;const z=_;_=null,a.next(z)}};function R(){const z=b+e,$=r.now();if($<z)return u=this.schedule(void 0,z-$),void a.add(u);M()}i.subscribe(si(a,z=>{_=z,b=r.now(),u||(u=r.schedule(R,e),a.add(u))},()=>{M(),a.complete()},void 0,()=>{_=u=null}))})}(0))),_.pipe(ti(b=>{const M={matches:!1,breakpoints:{}};return b.forEach(({matches:R,query:z})=>{M.matches=M.matches||R,M.breakpoints[z]=R}),M}))}_registerQuery(i){if(this._queries.has(i))return this._queries.get(i);const a=this._mediaMatcher.matchMedia(i),_={observable:new Di(b=>{const M=R=>this._zone.run(()=>b.next(R));return a.addListener(M),()=>{a.removeListener(M)}}).pipe(P1(a),ti(({matches:b})=>({query:i,matches:b})),M1(this._destroySubject)),mql:a};return this._queries.set(i,_),_}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(WN),Qe(hi))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function HS(e){return e.map(r=>r.split(",")).reduce((r,i)=>r.concat(i)).map(r=>r.trim())}let O1=(()=>{class e{constructor(i){this._platform=i}isDisabled(i){return i.hasAttribute("disabled")}isVisible(i){return function t3(e){return!!(e.offsetWidth||e.offsetHeight||"function"==typeof e.getClientRects&&e.getClientRects().length)}(i)&&"visible"===getComputedStyle(i).visibility}isTabbable(i){if(!this._platform.isBrowser)return!1;const a=function e3(e){try{return e.frameElement}catch{return null}}(function u3(e){return e.ownerDocument&&e.ownerDocument.defaultView||window}(i));if(a&&(-1===YS(a)||!this.isVisible(a)))return!1;let u=i.nodeName.toLowerCase(),_=YS(i);return i.hasAttribute("contenteditable")?-1!==_:!("iframe"===u||"object"===u||this._platform.WEBKIT&&this._platform.IOS&&!function l3(e){let r=e.nodeName.toLowerCase(),i="input"===r&&e.type;return"text"===i||"password"===i||"select"===r||"textarea"===r}(i))&&("audio"===u?!!i.hasAttribute("controls")&&-1!==_:"video"===u?-1!==_&&(null!==_||this._platform.FIREFOX||i.hasAttribute("controls")):i.tabIndex>=0)}isFocusable(i,a){return function c3(e){return!function r3(e){return function s3(e){return"input"==e.nodeName.toLowerCase()}(e)&&"hidden"==e.type}(e)&&(function n3(e){let r=e.nodeName.toLowerCase();return"input"===r||"select"===r||"button"===r||"textarea"===r}(e)||function o3(e){return function a3(e){return"a"==e.nodeName.toLowerCase()}(e)&&e.hasAttribute("href")}(e)||e.hasAttribute("contenteditable")||WS(e))}(i)&&!this.isDisabled(i)&&(a?.ignoreVisibility||this.isVisible(i))}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(fu))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function WS(e){if(!e.hasAttribute("tabindex")||void 0===e.tabIndex)return!1;let r=e.getAttribute("tabindex");return!(!r||isNaN(parseInt(r,10)))}function YS(e){if(!WS(e))return null;const r=parseInt(e.getAttribute("tabindex")||"",10);return isNaN(r)?-1:r}class h3{get enabled(){return this._enabled}set enabled(r){this._enabled=r,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(r,this._startAnchor),this._toggleAnchorTabIndex(r,this._endAnchor))}constructor(r,i,a,u,_=!1){this._element=r,this._checker=i,this._ngZone=a,this._document=u,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,_||this.attachAnchors()}destroy(){const r=this._startAnchor,i=this._endAnchor;r&&(r.removeEventListener("focus",this.startAnchorListener),r.remove()),i&&(i.removeEventListener("focus",this.endAnchorListener),i.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(r){return new Promise(i=>{this._executeOnStable(()=>i(this.focusInitialElement(r)))})}focusFirstTabbableElementWhenReady(r){return new Promise(i=>{this._executeOnStable(()=>i(this.focusFirstTabbableElement(r)))})}focusLastTabbableElementWhenReady(r){return new Promise(i=>{this._executeOnStable(()=>i(this.focusLastTabbableElement(r)))})}_getRegionBoundary(r){const i=this._element.querySelectorAll(`[cdk-focus-region-${r}], [cdkFocusRegion${r}], [cdk-focus-${r}]`);return"start"==r?i.length?i[0]:this._getFirstTabbableElement(this._element):i.length?i[i.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(r){const i=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(i){if(!this._checker.isFocusable(i)){const a=this._getFirstTabbableElement(i);return a?.focus(r),!!a}return i.focus(r),!0}return this.focusFirstTabbableElement(r)}focusFirstTabbableElement(r){const i=this._getRegionBoundary("start");return i&&i.focus(r),!!i}focusLastTabbableElement(r){const i=this._getRegionBoundary("end");return i&&i.focus(r),!!i}hasAttached(){return this._hasAttached}_getFirstTabbableElement(r){if(this._checker.isFocusable(r)&&this._checker.isTabbable(r))return r;const i=r.children;for(let a=0;a<i.length;a++){const u=i[a].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(i[a]):null;if(u)return u}return null}_getLastTabbableElement(r){if(this._checker.isFocusable(r)&&this._checker.isTabbable(r))return r;const i=r.children;for(let a=i.length-1;a>=0;a--){const u=i[a].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(i[a]):null;if(u)return u}return null}_createAnchor(){const r=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,r),r.classList.add("cdk-visually-hidden"),r.classList.add("cdk-focus-trap-anchor"),r.setAttribute("aria-hidden","true"),r}_toggleAnchorTabIndex(r,i){r?i.setAttribute("tabindex","0"):i.removeAttribute("tabindex")}toggleAnchors(r){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(r,this._startAnchor),this._toggleAnchorTabIndex(r,this._endAnchor))}_executeOnStable(r){this._ngZone.isStable?r():this._ngZone.onStable.pipe(Sl(1)).subscribe(r)}}let xD=(()=>{class e{constructor(i,a,u){this._checker=i,this._ngZone=a,this._document=u}create(i,a=!1){return new h3(i,this._checker,this._ngZone,this._document,a)}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(O1),Qe(hi),Qe(Ji))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function XS(e){return 0===e.buttons||0===e.detail}function KS(e){const r=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!r||-1!==r.identifier||null!=r.radiusX&&1!==r.radiusX||null!=r.radiusY&&1!==r.radiusY)}const d3=new Bt("cdk-input-modality-detector-options"),f3={ignoreKeys:[18,17,224,91,16]},y_=D1({passive:!0,capture:!0});let p3=(()=>{class e{get mostRecentModality(){return this._modality.value}constructor(i,a,u,_){this._platform=i,this._mostRecentTarget=null,this._modality=new rn(null),this._lastTouchMs=0,this._onKeydown=b=>{this._options?.ignoreKeys?.some(M=>M===b.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=wf(b))},this._onMousedown=b=>{Date.now()-this._lastTouchMs<650||(this._modality.next(XS(b)?"keyboard":"mouse"),this._mostRecentTarget=wf(b))},this._onTouchstart=b=>{KS(b)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=wf(b))},this._options={...f3,..._},this.modalityDetected=this._modality.pipe(US(1)),this.modalityChanged=this.modalityDetected.pipe(Ds()),i.isBrowser&&a.runOutsideAngular(()=>{u.addEventListener("keydown",this._onKeydown,y_),u.addEventListener("mousedown",this._onMousedown,y_),u.addEventListener("touchstart",this._onTouchstart,y_)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,y_),document.removeEventListener("mousedown",this._onMousedown,y_),document.removeEventListener("touchstart",this._onTouchstart,y_))}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(fu),Qe(hi),Qe(Ji),Qe(d3,8))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const g3=new Bt("cdk-focus-monitor-default-options"),k1=D1({passive:!0,capture:!0});let bD=(()=>{class e{constructor(i,a,u,_,b){this._ngZone=i,this._platform=a,this._inputModalityDetector=u,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Ti,this._rootNodeFocusAndBlurListener=M=>{for(let z=wf(M);z;z=z.parentElement)"focus"===M.type?this._onFocus(M,z):this._onBlur(M,z)},this._document=_,this._detectionMode=b?.detectionMode||0}monitor(i,a=!1){const u=m_(i);if(!this._platform.isBrowser||1!==u.nodeType)return Sn();const _=function sN(e){if(function oN(){if(null==hD){const e=typeof document<"u"?document.head:null;hD=!(!e||!e.createShadowRoot&&!e.attachShadow)}return hD}()){const r=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&r instanceof ShadowRoot)return r}return null}(u)||this._getDocument(),b=this._elementInfo.get(u);if(b)return a&&(b.checkChildren=!0),b.subject;const M={checkChildren:a,subject:new Ti,rootNode:_};return this._elementInfo.set(u,M),this._registerGlobalListeners(M),M.subject}stopMonitoring(i){const a=m_(i),u=this._elementInfo.get(a);u&&(u.subject.complete(),this._setClasses(a),this._elementInfo.delete(a),this._removeGlobalListeners(u))}focusVia(i,a,u){const _=m_(i);_===this._getDocument().activeElement?this._getClosestElementsInfo(_).forEach(([M,R])=>this._originChanged(M,a,R)):(this._setOrigin(a),"function"==typeof _.focus&&_.focus(u))}ngOnDestroy(){this._elementInfo.forEach((i,a)=>this.stopMonitoring(a))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(i){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(i)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:i&&this._isLastInteractionFromInputLabel(i)?"mouse":"program"}_shouldBeAttributedToTouch(i){return 1===this._detectionMode||!!i?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(i,a){i.classList.toggle("cdk-focused",!!a),i.classList.toggle("cdk-touch-focused","touch"===a),i.classList.toggle("cdk-keyboard-focused","keyboard"===a),i.classList.toggle("cdk-mouse-focused","mouse"===a),i.classList.toggle("cdk-program-focused","program"===a)}_setOrigin(i,a=!1){this._ngZone.runOutsideAngular(()=>{this._origin=i,this._originFromTouchInteraction="touch"===i&&a,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(i,a){const u=this._elementInfo.get(a),_=wf(i);!u||!u.checkChildren&&a!==_||this._originChanged(a,this._getFocusOrigin(_),u)}_onBlur(i,a){const u=this._elementInfo.get(a);!u||u.checkChildren&&i.relatedTarget instanceof Node&&a.contains(i.relatedTarget)||(this._setClasses(a),this._emitOrigin(u,null))}_emitOrigin(i,a){i.subject.observers.length&&this._ngZone.run(()=>i.subject.next(a))}_registerGlobalListeners(i){if(!this._platform.isBrowser)return;const a=i.rootNode,u=this._rootNodeFocusListenerCount.get(a)||0;u||this._ngZone.runOutsideAngular(()=>{a.addEventListener("focus",this._rootNodeFocusAndBlurListener,k1),a.addEventListener("blur",this._rootNodeFocusAndBlurListener,k1)}),this._rootNodeFocusListenerCount.set(a,u+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(M1(this._stopInputModalityDetector)).subscribe(_=>{this._setOrigin(_,!0)}))}_removeGlobalListeners(i){const a=i.rootNode;if(this._rootNodeFocusListenerCount.has(a)){const u=this._rootNodeFocusListenerCount.get(a);u>1?this._rootNodeFocusListenerCount.set(a,u-1):(a.removeEventListener("focus",this._rootNodeFocusAndBlurListener,k1),a.removeEventListener("blur",this._rootNodeFocusAndBlurListener,k1),this._rootNodeFocusListenerCount.delete(a))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(i,a,u){this._setClasses(i,a),this._emitOrigin(u,a),this._lastFocusOrigin=a}_getClosestElementsInfo(i){const a=[];return this._elementInfo.forEach((u,_)=>{(_===i||u.checkChildren&&_.contains(i))&&a.push([_,u])}),a}_isLastInteractionFromInputLabel(i){const{_mostRecentTarget:a,mostRecentModality:u}=this._inputModalityDetector;if("mouse"!==u||!a||a===i||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName||i.disabled)return!1;const _=i.labels;if(_)for(let b=0;b<_.length;b++)if(_[b].contains(a))return!0;return!1}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(hi),Qe(fu),Qe(p3),Qe(Ji,8),Qe(g3,8))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const QS="cdk-high-contrast-black-on-white",eA="cdk-high-contrast-white-on-black",wD="cdk-high-contrast-active";let tA=(()=>{class e{constructor(i,a){this._platform=i,this._document=a,this._breakpointSubscription=Xt(KN).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const i=this._document.createElement("div");i.style.backgroundColor="rgb(1,2,3)",i.style.position="absolute",this._document.body.appendChild(i);const a=this._document.defaultView||window,u=a&&a.getComputedStyle?a.getComputedStyle(i):null,_=(u&&u.backgroundColor||"").replace(/ /g,"");switch(i.remove(),_){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const i=this._document.body.classList;i.remove(wD,QS,eA),this._hasCheckedHighContrastMode=!0;const a=this.getHighContrastMode();1===a?i.add(wD,QS):2===a&&i.add(wD,eA)}}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(fu),Qe(Ji))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),_3=(()=>{class e{constructor(i){i._applyBodyHighContrastModeCssClasses()}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(tA))};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({imports:[NN]})}return e})();function L1(e){return new Di(r=>{tt(e()).subscribe(r)})}function y3(e,r){}class F1{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}}let nA=(()=>{class e extends _D{constructor(i,a,u,_,b,M,R,z){super(),this._elementRef=i,this._focusTrapFactory=a,this._config=_,this._interactivityChecker=b,this._ngZone=M,this._overlayRef=R,this._focusMonitor=z,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this.attachDomPortal=$=>{this._portalOutlet.hasAttached();const K=this._portalOutlet.attachDomPortal($);return this._contentAttached(),K},this._document=u,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(i){this._portalOutlet.hasAttached();const a=this._portalOutlet.attachComponentPortal(i);return this._contentAttached(),a}attachTemplatePortal(i){this._portalOutlet.hasAttached();const a=this._portalOutlet.attachTemplatePortal(i);return this._contentAttached(),a}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(i,a){this._interactivityChecker.isFocusable(i)||(i.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const u=()=>{i.removeEventListener("blur",u),i.removeEventListener("mousedown",u),i.removeAttribute("tabindex")};i.addEventListener("blur",u),i.addEventListener("mousedown",u)})),i.focus(a)}_focusByCssSelector(i,a){let u=this._elementRef.nativeElement.querySelector(i);u&&this._forceFocus(u,a)}_trapFocus(){const i=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||i.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(a=>{a||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const i=this._config.restoreFocus;let a=null;if("string"==typeof i?a=this._document.querySelector(i):"boolean"==typeof i?a=i?this._elementFocusedBeforeDialogWasOpened:null:i&&(a=i),this._config.restoreFocus&&a&&"function"==typeof a.focus){const u=dD(),_=this._elementRef.nativeElement;(!u||u===this._document.body||u===_||_.contains(u))&&(this._focusMonitor?(this._focusMonitor.focusVia(a,this._closeInteractionType),this._closeInteractionType=null):a.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const i=this._elementRef.nativeElement,a=dD();return i===a||i.contains(a)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=dD())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}static#e=this.\u0275fac=function(a){return new(a||e)(Pt(Bo),Pt(xD),Pt(Ji,8),Pt(F1),Pt(O1),Pt(hi),Pt(Kv),Pt(bD))};static#t=this.\u0275cmp=Bi({type:e,selectors:[["cdk-dialog-container"]],viewQuery:function(a,u){if(1&a&&CM(yD,7),2&a){let _;aC(_=function lC(){return function PP(e,r){return e[Os].queries[r].queryList}(ft(),tp())}())&&(u._portalOutlet=_.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(a,u){2&a&&dc("id",u._config.id||null)("role",u._config.role)("aria-modal",u._config.ariaModal)("aria-labelledby",u._config.ariaLabel?null:u._ariaLabelledByQueue[0])("aria-label",u._config.ariaLabel)("aria-describedby",u._config.ariaDescribedBy||null)},features:[df],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(a,u){1&a&&Co(0,y3,0,0,"ng-template",0)},dependencies:[yD],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2})}return e})();class ED{constructor(r,i){this.overlayRef=r,this.config=i,this.closed=new Ti,this.disableClose=i.disableClose,this.backdropClick=r.backdropClick(),this.keydownEvents=r.keydownEvents(),this.outsidePointerEvents=r.outsidePointerEvents(),this.id=i.id,this.keydownEvents.subscribe(a=>{27===a.keyCode&&!this.disableClose&&!jS(a)&&(a.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=r.detachments().subscribe(()=>{!1!==i.closeOnOverlayDetachments&&this.close()})}close(r,i){if(this.containerInstance){const a=this.closed;this.containerInstance._closeInteractionType=i?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),a.next(r),a.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(r="",i=""){return this.overlayRef.updateSize({width:r,height:i}),this}addPanelClass(r){return this.overlayRef.addPanelClass(r),this}removePanelClass(r){return this.overlayRef.removePanelClass(r),this}}const iA=new Bt("DialogScrollStrategy"),v3=new Bt("DialogData"),x3=new Bt("DefaultDialogConfig"),w3={provide:iA,deps:[__],useFactory:function b3(e){return()=>e.scrollStrategies.block()}};let E3=0,rA=(()=>{class e{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(i,a,u,_,b,M){this._overlay=i,this._injector=a,this._defaultOptions=u,this._parentDialog=_,this._overlayContainer=b,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Ti,this._afterOpenedAtThisLevel=new Ti,this._ariaHiddenElements=new Map,this.afterAllClosed=L1(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(P1(void 0))),this._scrollStrategy=M}open(i,a){(a={...this._defaultOptions||new F1,...a}).id=a.id||"cdk-dialog-"+E3++,a.id&&this.getDialogById(a.id);const _=this._getOverlayConfig(a),b=this._overlay.create(_),M=new ED(b,a),R=this._attachContainer(b,M,a);return M.containerInstance=R,this._attachDialogContent(i,M,R,a),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(M),M.closed.subscribe(()=>this._removeOpenDialog(M,!0)),this.afterOpened.next(M),M}closeAll(){CD(this.openDialogs,i=>i.close())}getDialogById(i){return this.openDialogs.find(a=>a.id===i)}ngOnDestroy(){CD(this._openDialogsAtThisLevel,i=>{!1===i.config.closeOnDestroy&&this._removeOpenDialog(i,!1)}),CD(this._openDialogsAtThisLevel,i=>i.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(i){const a=new OS({positionStrategy:i.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:i.scrollStrategy||this._scrollStrategy(),panelClass:i.panelClass,hasBackdrop:i.hasBackdrop,direction:i.direction,minWidth:i.minWidth,minHeight:i.minHeight,maxWidth:i.maxWidth,maxHeight:i.maxHeight,width:i.width,height:i.height,disposeOnNavigation:i.closeOnNavigation});return i.backdropClass&&(a.backdropClass=i.backdropClass),a}_attachContainer(i,a,u){const _=u.injector||u.viewContainerRef?.injector,b=[{provide:F1,useValue:u},{provide:ED,useValue:a},{provide:Kv,useValue:i}];let M;u.container?"function"==typeof u.container?M=u.container:(M=u.container.type,b.push(...u.container.providers(u))):M=nA;const R=new gD(M,u.viewContainerRef,uo.create({parent:_||this._injector,providers:b}),u.componentFactoryResolver);return i.attach(R).instance}_attachDialogContent(i,a,u,_){if(i instanceof hu){const b=this._createInjector(_,a,u,void 0);let M={$implicit:_.data,dialogRef:a};_.templateContext&&(M={...M,..."function"==typeof _.templateContext?_.templateContext():_.templateContext}),u.attachTemplatePortal(new SS(i,null,M,b))}else{const b=this._createInjector(_,a,u,this._injector),M=u.attachComponentPortal(new gD(i,_.viewContainerRef,b,_.componentFactoryResolver));a.componentRef=M,a.componentInstance=M.instance}}_createInjector(i,a,u,_){const b=i.injector||i.viewContainerRef?.injector,M=[{provide:v3,useValue:i.data},{provide:ED,useValue:a}];return i.providers&&("function"==typeof i.providers?M.push(...i.providers(a,i,u)):M.push(...i.providers)),i.direction&&(!b||!b.get(pD,null,{optional:!0}))&&M.push({provide:pD,useValue:{value:i.direction,change:Sn()}}),uo.create({parent:b||_,providers:M})}_removeOpenDialog(i,a){const u=this.openDialogs.indexOf(i);u>-1&&(this.openDialogs.splice(u,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((_,b)=>{_?b.setAttribute("aria-hidden",_):b.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),a&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const i=this._overlayContainer.getContainerElement();if(i.parentElement){const a=i.parentElement.children;for(let u=a.length-1;u>-1;u--){const _=a[u];_!==i&&"SCRIPT"!==_.nodeName&&"STYLE"!==_.nodeName&&!_.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(_,_.getAttribute("aria-hidden")),_.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const i=this._parentDialog;return i?i._getAfterAllClosed():this._afterAllClosedAtThisLevel}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(__),Qe(uo),Qe(x3,8),Qe(e,12),Qe(S1),Qe(iA))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac})}return e})();function CD(e,r){let i=e.length;for(;i--;)r(e[i])}let C3=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({providers:[rA,w3],imports:[BS,I1,_3,I1]})}return e})();const T3=new Bt("mat-sanity-checks",{providedIn:"root",factory:function D3(){return!0}});let aA=(()=>{class e{constructor(i,a,u){this._sanityChecks=a,this._document=u,this._hasDoneGlobalChecks=!1,i._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(i){return!fD()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[i])}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(tA),Qe(T3,8),Qe(Ji))};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({imports:[Xv,Xv]})}return e})();const lA=D1({passive:!0,capture:!0});class S3{constructor(){this._events=new Map,this._delegateEventHandler=r=>{const i=wf(r);i&&this._events.get(r.type)?.forEach((a,u)=>{(u===i||u.contains(i))&&a.forEach(_=>_.handleEvent(r))})}}addHandler(r,i,a,u){const _=this._events.get(i);if(_){const b=_.get(a);b?b.add(u):_.set(a,new Set([u]))}else this._events.set(i,new Map([[a,new Set([u])]])),r.runOutsideAngular(()=>{document.addEventListener(i,this._delegateEventHandler,lA)})}removeHandler(r,i,a){const u=this._events.get(r);if(!u)return;const _=u.get(i);_&&(_.delete(a),0===_.size&&u.delete(i),0===u.size&&(this._events.delete(r),document.removeEventListener(r,this._delegateEventHandler,lA)))}}class DD{static#e=this._eventManager=new S3;constructor(r,i,a,u){this._target=r,this._ngZone=i,this._platform=u,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,u.isBrowser&&(this._containerElement=m_(a))}fadeInRipple(r,i,a={}){const u=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),_={...cA,...a.animation},b=a.radius||function R3(e,r,i){const a=Math.max(Math.abs(e-i.left),Math.abs(e-i.right)),u=Math.max(Math.abs(r-i.top),Math.abs(r-i.bottom));return Math.sqrt(a*a+u*u)}(r,i,u),M=r-u.left,R=i-u.top,z=_.enterDuration,$=document.createElement("div");$.classList.add("mat-ripple-element"),$.style.left=M-b+"px",$.style.top=R-b+"px",$.style.height=2*b+"px",$.style.width=2*b+"px",null!=a.color&&($.style.backgroundColor=a.color),$.style.transitionDuration=`${z}ms`,this._containerElement.appendChild($);const K=window.getComputedStyle($),me=K.transitionDuration,Me="none"===K.transitionProperty||"0s"===me||"0s, 0s"===me||0===u.width&&0===u.height,ke=new I3(this,$,a,Me);$.style.transform="scale3d(1, 1, 1)",ke.state=0,a.persistent||(this._mostRecentTransientRipple=ke);return!Me&&(z||_.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const It=()=>this._finishRippleTransition(ke),Ye=()=>this._destroyRipple(ke);$.addEventListener("transitionend",It),$.addEventListener("transitioncancel",Ye)}),this._activeRipples.set(ke,null),(Me||!z)&&this._finishRippleTransition(ke),ke}fadeOutRipple(r){if(2===r.state||3===r.state)return;const i=r.element,a={...cA,...r.config.animation};i.style.transitionDuration=`${a.exitDuration}ms`,i.style.opacity="0",r.state=2,(r._animationForciblyDisabledThroughCss||!a.exitDuration)&&this._finishRippleTransition(r)}fadeOutAll(){this._getActiveRipples().forEach(r=>r.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(r=>{r.config.persistent||r.fadeOut()})}setupTriggerEvents(r){const i=m_(r);!this._platform.isBrowser||!i||i===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=i,hA.forEach(a=>{DD._eventManager.addHandler(this._ngZone,a,i,this)}))}handleEvent(r){"mousedown"===r.type?this._onMousedown(r):"touchstart"===r.type?this._onTouchStart(r):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{dA.forEach(i=>{this._triggerElement.addEventListener(i,this,uA)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(r){0===r.state?this._startFadeOutTransition(r):2===r.state&&this._destroyRipple(r)}_startFadeOutTransition(r){const i=r===this._mostRecentTransientRipple,{persistent:a}=r.config;r.state=1,!a&&(!i||!this._isPointerDown)&&r.fadeOut()}_destroyRipple(r){const i=this._activeRipples.get(r)??null;this._activeRipples.delete(r),this._activeRipples.size||(this._containerRect=null),r===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),r.state=3,null!==i&&(r.element.removeEventListener("transitionend",i.onTransitionEnd),r.element.removeEventListener("transitioncancel",i.onTransitionCancel)),r.element.remove()}_onMousedown(r){const i=XS(r),a=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!i&&!a&&(this._isPointerDown=!0,this.fadeInRipple(r.clientX,r.clientY,this._target.rippleConfig))}_onTouchStart(r){if(!this._target.rippleDisabled&&!KS(r)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const i=r.changedTouches;if(i)for(let a=0;a<i.length;a++)this.fadeInRipple(i[a].clientX,i[a].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(r=>{!r.config.persistent&&(1===r.state||r.config.terminateOnPointerUp&&0===r.state)&&r.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const r=this._triggerElement;r&&(hA.forEach(i=>DD._eventManager.removeHandler(i,r,this)),this._pointerUpEventsRegistered&&dA.forEach(i=>r.removeEventListener(i,this,uA)))}}function O3(e,r){}class z1{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}}const TD="mdc-dialog--open",vA="mdc-dialog--opening",xA="mdc-dialog--closing";let F3=(()=>{class e extends nA{constructor(i,a,u,_,b,M,R,z){super(i,a,u,_,b,M,R,z),this._animationStateChanged=new oo}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(i){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})}static#e=this.\u0275fac=function(a){return new(a||e)(Pt(Bo),Pt(xD),Pt(Ji,8),Pt(z1),Pt(O1),Pt(hi),Pt(Kv),Pt(bD))};static#t=this.\u0275cmp=Bi({type:e,selectors:[["ng-component"]],features:[df],decls:0,vars:0,template:function(a,u){},encapsulation:2})}return e})();const bA="--mat-dialog-transition-duration";function wA(e){return null==e?null:"number"==typeof e?e:e.endsWith("ms")?yS(e.substring(0,e.length-2)):e.endsWith("s")?1e3*yS(e.substring(0,e.length-1)):"0"===e?0:null}let N3=(()=>{class e extends F3{constructor(i,a,u,_,b,M,R,z,$){super(i,a,u,_,b,M,R,$),this._animationMode=z,this._animationsEnabled="NoopAnimations"!==this._animationMode,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?wA(this._config.enterAnimationDuration)??150:0,this._exitAnimationDuration=this._animationsEnabled?wA(this._config.exitAnimationDuration)??75:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}ngOnDestroy(){super.ngOnDestroy(),null!==this._animationTimer&&clearTimeout(this._animationTimer)}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(bA,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(vA,TD)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(TD),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(TD),this._animationsEnabled?(this._hostElement.style.setProperty(bA,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(xA)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_clearAnimationClasses(){this._hostElement.classList.remove(vA,xA)}_waitForAnimationToComplete(i,a){null!==this._animationTimer&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(a,i)}_requestAnimationFrame(i){this._ngZone.runOutsideAngular(()=>{"function"==typeof requestAnimationFrame?requestAnimationFrame(i):i()})}static#e=this.\u0275fac=function(a){return new(a||e)(Pt(Bo),Pt(xD),Pt(Ji,8),Pt(z1),Pt(O1),Pt(hi),Pt(Kv),Pt(Oy,8),Pt(bD))};static#t=this.\u0275cmp=Bi({type:e,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:8,hostBindings:function(a,u){2&a&&($E("id",u._config.id),dc("aria-modal",u._config.ariaModal)("role",u._config.role)("aria-labelledby",u._config.ariaLabel?null:u._ariaLabelledByQueue[0])("aria-label",u._config.ariaLabel)("aria-describedby",u._config.ariaDescribedBy||null),Ve("_mat-animation-noopable",!u._animationsEnabled))},features:[df],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(a,u){1&a&&(bt(0,"div",0)(1,"div",1),Co(2,O3,0,0,"ng-template",2),Lt()())},dependencies:[yD],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;transform:scale(0.8);opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{transform:none;opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{display:block;width:100%;height:100%}.mat-mdc-dialog-container{--mdc-dialog-container-elevation-shadow:0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12);--mdc-dialog-container-shadow-color:#000;--mdc-dialog-container-shape:4px;--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition-duration:var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container{transition:none}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-actions{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2})}return e})();class EA{constructor(r,i,a){this._ref=r,this._containerInstance=a,this._afterOpened=new Ti,this._beforeClosed=new Ti,this._state=0,this.disableClose=i.disableClose,this.id=r.id,a._animationStateChanged.pipe(Ys(u=>"opened"===u.state),Sl(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),a._animationStateChanged.pipe(Ys(u=>"closed"===u.state),Sl(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),r.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),ir(this.backdropClick(),this.keydownEvents().pipe(Ys(u=>27===u.keyCode&&!this.disableClose&&!jS(u)))).subscribe(u=>{this.disableClose||(u.preventDefault(),CA(this,"keydown"===u.type?"keyboard":"mouse"))})}close(r){this._result=r,this._containerInstance._animationStateChanged.pipe(Ys(i=>"closing"===i.state),Sl(1)).subscribe(i=>{this._beforeClosed.next(r),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),i.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(r){let i=this._ref.config.positionStrategy;return r&&(r.left||r.right)?r.left?i.left(r.left):i.right(r.right):i.centerHorizontally(),r&&(r.top||r.bottom)?r.top?i.top(r.top):i.bottom(r.bottom):i.centerVertically(),this._ref.updatePosition(),this}updateSize(r="",i=""){return this._ref.updateSize(r,i),this}addPanelClass(r){return this._ref.addPanelClass(r),this}removePanelClass(r){return this._ref.removePanelClass(r),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}function CA(e,r,i){return e._closeInteractionType=r,e.close(i)}const z3=new Bt("MatMdcDialogData"),B3=new Bt("mat-mdc-dialog-default-options"),DA=new Bt("mat-mdc-dialog-scroll-strategy"),j3={provide:DA,deps:[__],useFactory:function V3(e){return()=>e.scrollStrategies.block()}};let U3=0,$3=(()=>{class e{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const i=this._parentDialog;return i?i._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(i,a,u,_,b,M,R,z,$,K){this._overlay=i,this._defaultOptions=u,this._parentDialog=_,this._dialogRefConstructor=R,this._dialogContainerType=z,this._dialogDataToken=$,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Ti,this._afterOpenedAtThisLevel=new Ti,this._idPrefix="mat-dialog-",this.dialogConfigClass=z1,this.afterAllClosed=L1(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(P1(void 0))),this._scrollStrategy=M,this._dialog=a.get(rA)}open(i,a){let u;(a={...this._defaultOptions||new z1,...a}).id=a.id||`${this._idPrefix}${U3++}`,a.scrollStrategy=a.scrollStrategy||this._scrollStrategy();const _=this._dialog.open(i,{...a,positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:a},{provide:F1,useValue:a}]},templateContext:()=>({dialogRef:u}),providers:(b,M,R)=>(u=new this._dialogRefConstructor(b,a,R),u.updatePosition(a?.position),[{provide:this._dialogContainerType,useValue:R},{provide:this._dialogDataToken,useValue:M.data},{provide:this._dialogRefConstructor,useValue:u}])});return u.componentRef=_.componentRef,u.componentInstance=_.componentInstance,this.openDialogs.push(u),this.afterOpened.next(u),u.afterClosed().subscribe(()=>{const b=this.openDialogs.indexOf(u);b>-1&&(this.openDialogs.splice(b,1),this.openDialogs.length||this._getAfterAllClosed().next())}),u}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(i){return this.openDialogs.find(a=>a.id===i)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(i){let a=i.length;for(;a--;)i[a].close()}static#e=this.\u0275fac=function(a){El()};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac})}return e})(),MD=(()=>{class e extends $3{constructor(i,a,u,_,b,M,R,z){super(i,a,_,M,R,b,EA,N3,z3,z),this._idPrefix="mat-mdc-dialog-"}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(__),Qe(uo),Qe(Uv,8),Qe(B3,8),Qe(DA),Qe(e,12),Qe(S1),Qe(Oy,8))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac})}return e})(),TA=(()=>{class e{constructor(i,a,u){this.dialogRef=i,this._elementRef=a,this._dialog=u,this.type="button"}ngOnInit(){this.dialogRef||(this.dialogRef=function G3(e,r){let i=e.nativeElement.parentElement;for(;i&&!i.classList.contains("mat-mdc-dialog-container");)i=i.parentElement;return i?r.find(a=>a.id===i.id):null}(this._elementRef,this._dialog.openDialogs))}ngOnChanges(i){const a=i._matDialogClose||i._matDialogCloseResult;a&&(this.dialogResult=a.currentValue)}_onButtonClick(i){CA(this.dialogRef,0===i.screenX&&0===i.screenY?"keyboard":"mouse",this.dialogResult)}static#e=this.\u0275fac=function(a){return new(a||e)(Pt(EA,8),Pt(Bo),Pt(MD))};static#t=this.\u0275dir=Tr({type:e,selectors:[["","mat-dialog-close",""],["","matDialogClose",""]],hostVars:2,hostBindings:function(a,u){1&a&&Do("click",function(b){return u._onButtonClick(b)}),2&a&&dc("aria-label",u.ariaLabel||null)("type",u.type)},inputs:{ariaLabel:["aria-label","ariaLabel"],type:"type",dialogResult:["mat-dialog-close","dialogResult"],_matDialogClose:["matDialogClose","_matDialogClose"]},exportAs:["matDialogClose"],features:[la]})}return e})(),MA=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275dir=Tr({type:e,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"]})}return e})(),IA=(()=>{class e{constructor(){this.align="start"}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275dir=Tr({type:e,selectors:[["","mat-dialog-actions",""],["mat-dialog-actions"],["","matDialogActions",""]],hostAttrs:[1,"mat-mdc-dialog-actions","mdc-dialog__actions"],hostVars:4,hostBindings:function(a,u){2&a&&Ve("mat-mdc-dialog-actions-align-center","center"===u.align)("mat-mdc-dialog-actions-align-end","end"===u.align)},inputs:{align:"align"}})}return e})(),SA=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({providers:[MD,j3],imports:[C3,BS,I1,aA,aA]})}return e})();const B1=Df(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function Qv(e,r){const i=bi(e)?e:()=>e,a=u=>u.error(i());return new Di(r?u=>r.schedule(a,0,u):a)}function ID(){return Fi((e,r)=>{let i=null;e._refCount++;const a=si(r,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(i=null);const u=e._connection,_=i;i=null,u&&(!_||u===_)&&u.unsubscribe(),r.unsubscribe()});e.subscribe(a),a.closed||(i=e.connect())})}class RA extends Di{constructor(r,i){super(),this.source=r,this.subjectFactory=i,this._subject=null,this._refCount=0,this._connection=null,Ja(r)&&(this.lift=r.lift)}_subscribe(r){return this.getSubject().subscribe(r)}getSubject(){const r=this._subject;return(!r||r.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:r}=this;this._subject=this._connection=null,r?.unsubscribe()}connect(){let r=this._connection;if(!r){r=this._connection=new Zt;const i=this.getSubject();r.add(this.source.subscribe(si(i,void 0,()=>{this._teardown(),i.complete()},a=>{this._teardown(),i.error(a)},()=>this._teardown()))),r.closed&&(this._connection=null,r=Zt.EMPTY)}return r}refCount(){return ID()(this)}}function V1(e){return Fi((r,i)=>{let a=!1;r.subscribe(si(i,u=>{a=!0,i.next(u)},()=>{a||i.next(e),i.complete()}))})}function PA(e=q3){return Fi((r,i)=>{let a=!1;r.subscribe(si(i,u=>{a=!0,i.next(u)},()=>a?i.complete():i.error(e())))})}function q3(){return new B1}function dm(e,r){const i=arguments.length>=2;return a=>a.pipe(e?Ys((u,_)=>e(u,_,a)):on,Sl(1),i?V1(r):PA(()=>new B1))}function e0(e,r){return bi(r)?Un(e,r,1):Un(e,1)}function xs(e,r,i){const a=bi(e)||r||i?{next:e,error:r,complete:i}:e;return a?Fi((u,_)=>{var b;null===(b=a.subscribe)||void 0===b||b.call(a);let M=!0;u.subscribe(si(_,R=>{var z;null===(z=a.next)||void 0===z||z.call(a,R),_.next(R)},()=>{var R;M=!1,null===(R=a.complete)||void 0===R||R.call(a),_.complete()},R=>{var z;M=!1,null===(z=a.error)||void 0===z||z.call(a,R),_.error(R)},()=>{var R,z;M&&(null===(R=a.unsubscribe)||void 0===R||R.call(a)),null===(z=a.finalize)||void 0===z||z.call(a)}))}):on}function fm(e){return Fi((r,i)=>{let _,a=null,u=!1;a=r.subscribe(si(i,void 0,void 0,b=>{_=tt(e(b,fm(e)(r))),a?(a.unsubscribe(),a=null,_.subscribe(i)):u=!0})),u&&(a.unsubscribe(),a=null,_.subscribe(i))})}function SD(e){return e<=0?()=>Zi:Fi((r,i)=>{let a=[];r.subscribe(si(i,u=>{a.push(u),e<a.length&&a.shift()},()=>{for(const u of a)i.next(u);i.complete()},void 0,()=>{a=null}))})}function AD(e){return Fi((r,i)=>{try{r.subscribe(i)}finally{i.add(e)}})}const ci="primary",t0=Symbol("RouteTitle");class K3{constructor(r){this.params=r||{}}has(r){return Object.prototype.hasOwnProperty.call(this.params,r)}get(r){if(this.has(r)){const i=this.params[r];return Array.isArray(i)?i[0]:i}return null}getAll(r){if(this.has(r)){const i=this.params[r];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}}function v_(e){return new K3(e)}function J3(e,r,i){const a=i.path.split("/");if(a.length>e.length||"full"===i.pathMatch&&(r.hasChildren()||a.length<e.length))return null;const u={};for(let _=0;_<a.length;_++){const b=a[_],M=e[_];if(b.startsWith(":"))u[b.substring(1)]=M;else if(b!==M.path)return null}return{consumed:e.slice(0,a.length),posParams:u}}function pu(e,r){const i=e?Object.keys(e):void 0,a=r?Object.keys(r):void 0;if(!i||!a||i.length!=a.length)return!1;let u;for(let _=0;_<i.length;_++)if(u=i[_],!OA(e[u],r[u]))return!1;return!0}function OA(e,r){if(Array.isArray(e)&&Array.isArray(r)){if(e.length!==r.length)return!1;const i=[...e].sort(),a=[...r].sort();return i.every((u,_)=>a[_]===u)}return e===r}function kA(e){return e.length>0?e[e.length-1]:null}function Ef(e){return function H3(e){return!!e&&(e instanceof Di||bi(e.lift)&&bi(e.subscribe))}(e)?e:e_(e)?ki(Promise.resolve(e)):Sn(e)}const ez={exact:function NA(e,r,i){if(!pm(e.segments,r.segments)||!j1(e.segments,r.segments,i)||e.numberOfChildren!==r.numberOfChildren)return!1;for(const a in r.children)if(!e.children[a]||!NA(e.children[a],r.children[a],i))return!1;return!0},subset:zA},LA={exact:function tz(e,r){return pu(e,r)},subset:function nz(e,r){return Object.keys(r).length<=Object.keys(e).length&&Object.keys(r).every(i=>OA(e[i],r[i]))},ignored:()=>!0};function FA(e,r,i){return ez[i.paths](e.root,r.root,i.matrixParams)&&LA[i.queryParams](e.queryParams,r.queryParams)&&!("exact"===i.fragment&&e.fragment!==r.fragment)}function zA(e,r,i){return BA(e,r,r.segments,i)}function BA(e,r,i,a){if(e.segments.length>i.length){const u=e.segments.slice(0,i.length);return!(!pm(u,i)||r.hasChildren()||!j1(u,i,a))}if(e.segments.length===i.length){if(!pm(e.segments,i)||!j1(e.segments,i,a))return!1;for(const u in r.children)if(!e.children[u]||!zA(e.children[u],r.children[u],a))return!1;return!0}{const u=i.slice(0,e.segments.length),_=i.slice(e.segments.length);return!!(pm(e.segments,u)&&j1(e.segments,u,a)&&e.children[ci])&&BA(e.children[ci],r,_,a)}}function j1(e,r,i){return r.every((a,u)=>LA[i](e[u].parameters,a.parameters))}class x_{constructor(r=new ar([],{}),i={},a=null){this.root=r,this.queryParams=i,this.fragment=a}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=v_(this.queryParams)),this._queryParamMap}toString(){return oz.serialize(this)}}class ar{constructor(r,i){this.segments=r,this.children=i,this.parent=null,Object.values(i).forEach(a=>a.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return U1(this)}}class n0{constructor(r,i){this.path=r,this.parameters=i}get parameterMap(){return this._parameterMap||(this._parameterMap=v_(this.parameters)),this._parameterMap}toString(){return UA(this)}}function pm(e,r){return e.length===r.length&&e.every((i,a)=>i.path===r[a].path)}let r0=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:function(){return new RD},providedIn:"root"})}return e})();class RD{parse(r){const i=new gz(r);return new x_(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(r){const i=`/${o0(r.root,!0)}`,a=function lz(e){const r=Object.keys(e).map(i=>{const a=e[i];return Array.isArray(a)?a.map(u=>`${$1(i)}=${$1(u)}`).join("&"):`${$1(i)}=${$1(a)}`}).filter(i=>!!i);return r.length?`?${r.join("&")}`:""}(r.queryParams);return`${i}${a}${"string"==typeof r.fragment?`#${function sz(e){return encodeURI(e)}(r.fragment)}`:""}`}}const oz=new RD;function U1(e){return e.segments.map(r=>UA(r)).join("/")}function o0(e,r){if(!e.hasChildren())return U1(e);if(r){const i=e.children[ci]?o0(e.children[ci],!1):"",a=[];return Object.entries(e.children).forEach(([u,_])=>{u!==ci&&a.push(`${u}:${o0(_,!1)}`)}),a.length>0?`${i}(${a.join("//")})`:i}{const i=function rz(e,r){let i=[];return Object.entries(e.children).forEach(([a,u])=>{a===ci&&(i=i.concat(r(u,a)))}),Object.entries(e.children).forEach(([a,u])=>{a!==ci&&(i=i.concat(r(u,a)))}),i}(e,(a,u)=>u===ci?[o0(e.children[ci],!1)]:[`${u}:${o0(a,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[ci]?`${U1(e)}/${i[0]}`:`${U1(e)}/(${i.join("//")})`}}function VA(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function $1(e){return VA(e).replace(/%3B/gi,";")}function PD(e){return VA(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function G1(e){return decodeURIComponent(e)}function jA(e){return G1(e.replace(/\+/g,"%20"))}function UA(e){return`${PD(e.path)}${function az(e){return Object.keys(e).map(r=>`;${PD(r)}=${PD(e[r])}`).join("")}(e.parameters)}`}const cz=/^[^\/()?;#]+/;function OD(e){const r=e.match(cz);return r?r[0]:""}const uz=/^[^\/()?;=#]+/,dz=/^[^=?&#]+/,pz=/^[^&#]+/;class gz{constructor(r){this.url=r,this.remaining=r}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new ar([],{}):new ar([],this.parseChildren())}parseQueryParams(){const r={};if(this.consumeOptional("?"))do{this.parseQueryParam(r)}while(this.consumeOptional("&"));return r}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const r=[];for(this.peekStartsWith("(")||r.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),r.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let a={};return this.peekStartsWith("(")&&(a=this.parseParens(!1)),(r.length>0||Object.keys(i).length>0)&&(a[ci]=new ar(r,i)),a}parseSegment(){const r=OD(this.remaining);if(""===r&&this.peekStartsWith(";"))throw new xt(4009,!1);return this.capture(r),new n0(G1(r),this.parseMatrixParams())}parseMatrixParams(){const r={};for(;this.consumeOptional(";");)this.parseParam(r);return r}parseParam(r){const i=function hz(e){const r=e.match(uz);return r?r[0]:""}(this.remaining);if(!i)return;this.capture(i);let a="";if(this.consumeOptional("=")){const u=OD(this.remaining);u&&(a=u,this.capture(a))}r[G1(i)]=G1(a)}parseQueryParam(r){const i=function fz(e){const r=e.match(dz);return r?r[0]:""}(this.remaining);if(!i)return;this.capture(i);let a="";if(this.consumeOptional("=")){const b=function mz(e){const r=e.match(pz);return r?r[0]:""}(this.remaining);b&&(a=b,this.capture(a))}const u=jA(i),_=jA(a);if(r.hasOwnProperty(u)){let b=r[u];Array.isArray(b)||(b=[b],r[u]=b),b.push(_)}else r[u]=_}parseParens(r){const i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const a=OD(this.remaining),u=this.remaining[a.length];if("/"!==u&&")"!==u&&";"!==u)throw new xt(4010,!1);let _;a.indexOf(":")>-1?(_=a.slice(0,a.indexOf(":")),this.capture(_),this.capture(":")):r&&(_=ci);const b=this.parseChildren();i[_]=1===Object.keys(b).length?b[ci]:new ar([],b),this.consumeOptional("//")}return i}peekStartsWith(r){return this.remaining.startsWith(r)}consumeOptional(r){return!!this.peekStartsWith(r)&&(this.remaining=this.remaining.substring(r.length),!0)}capture(r){if(!this.consumeOptional(r))throw new xt(4011,!1)}}function $A(e){return e.segments.length>0?new ar([],{[ci]:e}):e}function GA(e){const r={};for(const a of Object.keys(e.children)){const _=GA(e.children[a]);if(a===ci&&0===_.segments.length&&_.hasChildren())for(const[b,M]of Object.entries(_.children))r[b]=M;else(_.segments.length>0||_.hasChildren())&&(r[a]=_)}return function _z(e){if(1===e.numberOfChildren&&e.children[ci]){const r=e.children[ci];return new ar(e.segments.concat(r.segments),r.children)}return e}(new ar(e.segments,r))}function mm(e){return e instanceof x_}function HA(e){let r;const u=$A(function i(_){const b={};for(const R of _.children){const z=i(R);b[R.outlet]=z}const M=new ar(_.url,b);return _===e&&(r=M),M}(e.root));return r??u}function qA(e,r,i,a){let u=e;for(;u.parent;)u=u.parent;if(0===r.length)return kD(u,u,u,i,a);const _=function vz(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new WA(!0,0,e);let r=0,i=!1;const a=e.reduce((u,_,b)=>{if("object"==typeof _&&null!=_){if(_.outlets){const M={};return Object.entries(_.outlets).forEach(([R,z])=>{M[R]="string"==typeof z?z.split("/"):z}),[...u,{outlets:M}]}if(_.segmentPath)return[...u,_.segmentPath]}return"string"!=typeof _?[...u,_]:0===b?(_.split("/").forEach((M,R)=>{0==R&&"."===M||(0==R&&""===M?i=!0:".."===M?r++:""!=M&&u.push(M))}),u):[...u,_]},[]);return new WA(i,r,a)}(r);if(_.toRoot())return kD(u,u,new ar([],{}),i,a);const b=function xz(e,r,i){if(e.isAbsolute)return new q1(r,!0,0);if(!i)return new q1(r,!1,NaN);if(null===i.parent)return new q1(i,!0,0);const a=H1(e.commands[0])?0:1;return function bz(e,r,i){let a=e,u=r,_=i;for(;_>u;){if(_-=u,a=a.parent,!a)throw new xt(4005,!1);u=a.segments.length}return new q1(a,!1,u-_)}(i,i.segments.length-1+a,e.numberOfDoubleDots)}(_,u,e),M=b.processChildren?a0(b.segmentGroup,b.index,_.commands):YA(b.segmentGroup,b.index,_.commands);return kD(u,b.segmentGroup,M,i,a)}function H1(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function s0(e){return"object"==typeof e&&null!=e&&e.outlets}function kD(e,r,i,a,u){let b,_={};a&&Object.entries(a).forEach(([R,z])=>{_[R]=Array.isArray(z)?z.map($=>`${$}`):`${z}`}),b=e===r?i:ZA(e,r,i);const M=$A(GA(b));return new x_(M,_,u)}function ZA(e,r,i){const a={};return Object.entries(e.children).forEach(([u,_])=>{a[u]=_===r?i:ZA(_,r,i)}),new ar(e.segments,a)}class WA{constructor(r,i,a){if(this.isAbsolute=r,this.numberOfDoubleDots=i,this.commands=a,r&&a.length>0&&H1(a[0]))throw new xt(4003,!1);const u=a.find(s0);if(u&&u!==kA(a))throw new xt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class q1{constructor(r,i,a){this.segmentGroup=r,this.processChildren=i,this.index=a}}function YA(e,r,i){if(e||(e=new ar([],{})),0===e.segments.length&&e.hasChildren())return a0(e,r,i);const a=function Ez(e,r,i){let a=0,u=r;const _={match:!1,pathIndex:0,commandIndex:0};for(;u<e.segments.length;){if(a>=i.length)return _;const b=e.segments[u],M=i[a];if(s0(M))break;const R=`${M}`,z=a<i.length-1?i[a+1]:null;if(u>0&&void 0===R)break;if(R&&z&&"object"==typeof z&&void 0===z.outlets){if(!KA(R,z,b))return _;a+=2}else{if(!KA(R,{},b))return _;a++}u++}return{match:!0,pathIndex:u,commandIndex:a}}(e,r,i),u=i.slice(a.commandIndex);if(a.match&&a.pathIndex<e.segments.length){const _=new ar(e.segments.slice(0,a.pathIndex),{});return _.children[ci]=new ar(e.segments.slice(a.pathIndex),e.children),a0(_,0,u)}return a.match&&0===u.length?new ar(e.segments,{}):a.match&&!e.hasChildren()?LD(e,r,i):a.match?a0(e,0,u):LD(e,r,i)}function a0(e,r,i){if(0===i.length)return new ar(e.segments,{});{const a=function wz(e){return s0(e[0])?e[0].outlets:{[ci]:e}}(i),u={};if(Object.keys(a).some(_=>_!==ci)&&e.children[ci]&&1===e.numberOfChildren&&0===e.children[ci].segments.length){const _=a0(e.children[ci],r,i);return new ar(e.segments,_.children)}return Object.entries(a).forEach(([_,b])=>{"string"==typeof b&&(b=[b]),null!==b&&(u[_]=YA(e.children[_],r,b))}),Object.entries(e.children).forEach(([_,b])=>{void 0===a[_]&&(u[_]=b)}),new ar(e.segments,u)}}function LD(e,r,i){const a=e.segments.slice(0,r);let u=0;for(;u<i.length;){const _=i[u];if(s0(_)){const R=Cz(_.outlets);return new ar(a,R)}if(0===u&&H1(i[0])){a.push(new n0(e.segments[r].path,XA(i[0]))),u++;continue}const b=s0(_)?_.outlets[ci]:`${_}`,M=u<i.length-1?i[u+1]:null;b&&M&&H1(M)?(a.push(new n0(b,XA(M))),u+=2):(a.push(new n0(b,{})),u++)}return new ar(a,{})}function Cz(e){const r={};return Object.entries(e).forEach(([i,a])=>{"string"==typeof a&&(a=[a]),null!==a&&(r[i]=LD(new ar([],{}),0,a))}),r}function XA(e){const r={};return Object.entries(e).forEach(([i,a])=>r[i]=`${a}`),r}function KA(e,r,i){return e==i.path&&pu(r,i.parameters)}const l0="imperative";class mu{constructor(r,i){this.id=r,this.url=i}}class Z1 extends mu{constructor(r,i,a="imperative",u=null){super(r,i),this.type=0,this.navigationTrigger=a,this.restoredState=u}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Cf extends mu{constructor(r,i,a){super(r,i),this.urlAfterRedirects=a,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class c0 extends mu{constructor(r,i,a,u){super(r,i),this.reason=a,this.code=u,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class b_ extends mu{constructor(r,i,a,u){super(r,i),this.reason=a,this.code=u,this.type=16}}class W1 extends mu{constructor(r,i,a,u){super(r,i),this.error=a,this.target=u,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class JA extends mu{constructor(r,i,a,u){super(r,i),this.urlAfterRedirects=a,this.state=u,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Dz extends mu{constructor(r,i,a,u){super(r,i),this.urlAfterRedirects=a,this.state=u,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Tz extends mu{constructor(r,i,a,u,_){super(r,i),this.urlAfterRedirects=a,this.state=u,this.shouldActivate=_,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Mz extends mu{constructor(r,i,a,u){super(r,i),this.urlAfterRedirects=a,this.state=u,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Iz extends mu{constructor(r,i,a,u){super(r,i),this.urlAfterRedirects=a,this.state=u,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Sz{constructor(r){this.route=r,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Az{constructor(r){this.route=r,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Rz{constructor(r){this.snapshot=r,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Pz{constructor(r){this.snapshot=r,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Oz{constructor(r){this.snapshot=r,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class kz{constructor(r){this.snapshot=r,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class QA{constructor(r,i,a){this.routerEvent=r,this.position=i,this.anchor=a,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class FD{}class ND{constructor(r){this.url=r}}class Lz{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new u0,this.attachRef=null}}let u0=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(i,a){const u=this.getOrCreateContext(i);u.outlet=a,this.contexts.set(i,u)}onChildOutletDestroyed(i){const a=this.getContext(i);a&&(a.outlet=null,a.attachRef=null)}onOutletDeactivated(){const i=this.contexts;return this.contexts=new Map,i}onOutletReAttached(i){this.contexts=i}getOrCreateContext(i){let a=this.getContext(i);return a||(a=new Lz,this.contexts.set(i,a)),a}getContext(i){return this.contexts.get(i)||null}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class e2{constructor(r){this._root=r}get root(){return this._root.value}parent(r){const i=this.pathFromRoot(r);return i.length>1?i[i.length-2]:null}children(r){const i=zD(r,this._root);return i?i.children.map(a=>a.value):[]}firstChild(r){const i=zD(r,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(r){const i=BD(r,this._root);return i.length<2?[]:i[i.length-2].children.map(u=>u.value).filter(u=>u!==r)}pathFromRoot(r){return BD(r,this._root).map(i=>i.value)}}function zD(e,r){if(e===r.value)return r;for(const i of r.children){const a=zD(e,i);if(a)return a}return null}function BD(e,r){if(e===r.value)return[r];for(const i of r.children){const a=BD(e,i);if(a.length)return a.unshift(r),a}return[]}class zh{constructor(r,i){this.value=r,this.children=i}toString(){return`TreeNode(${this.value})`}}function w_(e){const r={};return e&&e.children.forEach(i=>r[i.value.outlet]=i),r}class t2 extends e2{constructor(r,i){super(r),this.snapshot=i,VD(this,r)}toString(){return this.snapshot.toString()}}function n2(e,r){const i=function Fz(e,r){const b=new Y1([],{},{},"",{},ci,r,null,{});return new o2("",new zh(b,[]))}(0,r),a=new rn([new n0("",{})]),u=new rn({}),_=new rn({}),b=new rn({}),M=new rn(""),R=new Bh(a,u,b,M,_,ci,r,i.root);return R.snapshot=i.root,new t2(new zh(R,[]),i)}class Bh{constructor(r,i,a,u,_,b,M,R){this.urlSubject=r,this.paramsSubject=i,this.queryParamsSubject=a,this.fragmentSubject=u,this.dataSubject=_,this.outlet=b,this.component=M,this._futureSnapshot=R,this.title=this.dataSubject?.pipe(ti(z=>z[t0]))??Sn(void 0),this.url=r,this.params=i,this.queryParams=a,this.fragment=u,this.data=_}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(ti(r=>v_(r)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(ti(r=>v_(r)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function r2(e,r="emptyOnly"){const i=e.pathFromRoot;let a=0;if("always"!==r)for(a=i.length-1;a>=1;){const u=i[a],_=i[a-1];if(u.routeConfig&&""===u.routeConfig.path)a--;else{if(_.component)break;a--}}return function Nz(e){return e.reduce((r,i)=>({params:{...r.params,...i.params},data:{...r.data,...i.data},resolve:{...i.data,...r.resolve,...i.routeConfig?.data,...i._resolvedData}}),{params:{},data:{},resolve:{}})}(i.slice(a))}class Y1{get title(){return this.data?.[t0]}constructor(r,i,a,u,_,b,M,R,z){this.url=r,this.params=i,this.queryParams=a,this.fragment=u,this.data=_,this.outlet=b,this.component=M,this.routeConfig=R,this._resolve=z}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=v_(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=v_(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(a=>a.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class o2 extends e2{constructor(r,i){super(i),this.url=r,VD(this,i)}toString(){return s2(this._root)}}function VD(e,r){r.value._routerState=e,r.children.forEach(i=>VD(e,i))}function s2(e){const r=e.children.length>0?` { ${e.children.map(s2).join(", ")} } `:"";return`${e.value}${r}`}function jD(e){if(e.snapshot){const r=e.snapshot,i=e._futureSnapshot;e.snapshot=i,pu(r.queryParams,i.queryParams)||e.queryParamsSubject.next(i.queryParams),r.fragment!==i.fragment&&e.fragmentSubject.next(i.fragment),pu(r.params,i.params)||e.paramsSubject.next(i.params),function Q3(e,r){if(e.length!==r.length)return!1;for(let i=0;i<e.length;++i)if(!pu(e[i],r[i]))return!1;return!0}(r.url,i.url)||e.urlSubject.next(i.url),pu(r.data,i.data)||e.dataSubject.next(i.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function UD(e,r){const i=pu(e.params,r.params)&&function iz(e,r){return pm(e,r)&&e.every((i,a)=>pu(i.parameters,r[a].parameters))}(e.url,r.url);return i&&!(!e.parent!=!r.parent)&&(!e.parent||UD(e.parent,r.parent))}let $D=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=ci,this.activateEvents=new oo,this.deactivateEvents=new oo,this.attachEvents=new oo,this.detachEvents=new oo,this.parentContexts=Xt(u0),this.location=Xt(Tl),this.changeDetector=Xt(CC),this.environmentInjector=Xt($s),this.inputBinder=Xt(X1,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(i){if(i.name){const{firstChange:a,previousValue:u}=i.name;if(a)return;this.isTrackedInParentContexts(u)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(u)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(i){return this.parentContexts.getContext(i)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const i=this.parentContexts.getContext(this.name);i?.route&&(i.attachRef?this.attach(i.attachRef,i.route):this.activateWith(i.route,i.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new xt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new xt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new xt(4012,!1);this.location.detach();const i=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(i.instance),i}attach(i,a){this.activated=i,this._activatedRoute=a,this.location.insert(i.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(i.instance)}deactivate(){if(this.activated){const i=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(i)}}activateWith(i,a){if(this.isActivated)throw new xt(4013,!1);this._activatedRoute=i;const u=this.location,b=i.snapshot.component,M=this.parentContexts.getOrCreateContext(this.name).children,R=new zz(i,M,u.injector);this.activated=u.createComponent(b,{index:u.length,injector:R,environmentInjector:a??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275dir=Tr({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[la]})}return e})();class zz{constructor(r,i,a){this.route=r,this.childContexts=i,this.parent=a}get(r,i){return r===Bh?this.route:r===u0?this.childContexts:this.parent.get(r,i)}}const X1=new Bt("");let a2=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(i){this.unsubscribeFromRouteData(i),this.subscribeToRouteData(i)}unsubscribeFromRouteData(i){this.outletDataSubscriptions.get(i)?.unsubscribe(),this.outletDataSubscriptions.delete(i)}subscribeToRouteData(i){const{activatedRoute:a}=i,u=A1([a.queryParams,a.params,a.data]).pipe(Js(([_,b,M],R)=>(M={..._,...b,...M},0===R?Sn(M):Promise.resolve(M)))).subscribe(_=>{if(!i.isActivated||!i.activatedComponentRef||i.activatedRoute!==a||null===a.component)return void this.unsubscribeFromRouteData(i);const b=function lk(e){const r=ni(e);if(!r)return null;const i=new hf(r);return{get selector(){return i.selector},get type(){return i.componentType},get inputs(){return i.inputs},get outputs(){return i.outputs},get ngContentSelectors(){return i.ngContentSelectors},get isStandalone(){return r.standalone},get isSignal(){return r.signals}}}(a.component);if(b)for(const{templateName:M}of b.inputs)i.activatedComponentRef.setInput(M,_[M]);else this.unsubscribeFromRouteData(i)});this.outletDataSubscriptions.set(i,u)}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac})}return e})();function h0(e,r,i){if(i&&e.shouldReuseRoute(r.value,i.value.snapshot)){const a=i.value;a._futureSnapshot=r.value;const u=function Vz(e,r,i){return r.children.map(a=>{for(const u of i.children)if(e.shouldReuseRoute(a.value,u.value.snapshot))return h0(e,a,u);return h0(e,a)})}(e,r,i);return new zh(a,u)}{if(e.shouldAttach(r.value)){const _=e.retrieve(r.value);if(null!==_){const b=_.route;return b.value._futureSnapshot=r.value,b.children=r.children.map(M=>h0(e,M)),b}}const a=function jz(e){return new Bh(new rn(e.url),new rn(e.params),new rn(e.queryParams),new rn(e.fragment),new rn(e.data),e.outlet,e.component,e)}(r.value),u=r.children.map(_=>h0(e,_));return new zh(a,u)}}const GD="ngNavigationCancelingError";function l2(e,r){const{redirectTo:i,navigationBehaviorOptions:a}=mm(r)?{redirectTo:r,navigationBehaviorOptions:void 0}:r,u=c2(!1,0,r);return u.url=i,u.navigationBehaviorOptions=a,u}function c2(e,r,i){const a=new Error("NavigationCancelingError: "+(e||""));return a[GD]=!0,a.cancellationCode=r,i&&(a.url=i),a}function u2(e){return e&&e[GD]}let h2=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275cmp=Bi({type:e,selectors:[["ng-component"]],standalone:!0,features:[eM],decls:1,vars:0,template:function(a,u){1&a&&Bn(0,"router-outlet")},dependencies:[$D],encapsulation:2})}return e})();function HD(e){const r=e.children&&e.children.map(HD),i=r?{...e,children:r}:{...e};return!i.component&&!i.loadComponent&&(r||i.loadChildren)&&i.outlet&&i.outlet!==ci&&(i.component=h2),i}function vc(e){return e.outlet||ci}function d0(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let r=e.parent;r;r=r.parent){const i=r.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}class Yz{constructor(r,i,a,u,_){this.routeReuseStrategy=r,this.futureState=i,this.currState=a,this.forwardEvent=u,this.inputBindingEnabled=_}activate(r){const i=this.futureState._root,a=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,a,r),jD(this.futureState.root),this.activateChildRoutes(i,a,r)}deactivateChildRoutes(r,i,a){const u=w_(i);r.children.forEach(_=>{const b=_.value.outlet;this.deactivateRoutes(_,u[b],a),delete u[b]}),Object.values(u).forEach(_=>{this.deactivateRouteAndItsChildren(_,a)})}deactivateRoutes(r,i,a){const u=r.value,_=i?i.value:null;if(u===_)if(u.component){const b=a.getContext(u.outlet);b&&this.deactivateChildRoutes(r,i,b.children)}else this.deactivateChildRoutes(r,i,a);else _&&this.deactivateRouteAndItsChildren(i,a)}deactivateRouteAndItsChildren(r,i){r.value.component&&this.routeReuseStrategy.shouldDetach(r.value.snapshot)?this.detachAndStoreRouteSubtree(r,i):this.deactivateRouteAndOutlet(r,i)}detachAndStoreRouteSubtree(r,i){const a=i.getContext(r.value.outlet),u=a&&r.value.component?a.children:i,_=w_(r);for(const b of Object.keys(_))this.deactivateRouteAndItsChildren(_[b],u);if(a&&a.outlet){const b=a.outlet.detach(),M=a.children.onOutletDeactivated();this.routeReuseStrategy.store(r.value.snapshot,{componentRef:b,route:r,contexts:M})}}deactivateRouteAndOutlet(r,i){const a=i.getContext(r.value.outlet),u=a&&r.value.component?a.children:i,_=w_(r);for(const b of Object.keys(_))this.deactivateRouteAndItsChildren(_[b],u);a&&(a.outlet&&(a.outlet.deactivate(),a.children.onOutletDeactivated()),a.attachRef=null,a.route=null)}activateChildRoutes(r,i,a){const u=w_(i);r.children.forEach(_=>{this.activateRoutes(_,u[_.value.outlet],a),this.forwardEvent(new kz(_.value.snapshot))}),r.children.length&&this.forwardEvent(new Pz(r.value.snapshot))}activateRoutes(r,i,a){const u=r.value,_=i?i.value:null;if(jD(u),u===_)if(u.component){const b=a.getOrCreateContext(u.outlet);this.activateChildRoutes(r,i,b.children)}else this.activateChildRoutes(r,i,a);else if(u.component){const b=a.getOrCreateContext(u.outlet);if(this.routeReuseStrategy.shouldAttach(u.snapshot)){const M=this.routeReuseStrategy.retrieve(u.snapshot);this.routeReuseStrategy.store(u.snapshot,null),b.children.onOutletReAttached(M.contexts),b.attachRef=M.componentRef,b.route=M.route.value,b.outlet&&b.outlet.attach(M.componentRef,M.route.value),jD(M.route.value),this.activateChildRoutes(r,null,b.children)}else{const M=d0(u.snapshot);b.attachRef=null,b.route=u,b.injector=M,b.outlet&&b.outlet.activateWith(u,b.injector),this.activateChildRoutes(r,null,b.children)}}else this.activateChildRoutes(r,null,a)}}class d2{constructor(r){this.path=r,this.route=this.path[this.path.length-1]}}class K1{constructor(r,i){this.component=r,this.route=i}}function Xz(e,r,i){const a=e._root;return f0(a,r?r._root:null,i,[a.value])}function E_(e,r){const i=Symbol(),a=r.get(e,i);return a===i?"function"!=typeof e||function kn(e){return null!==Du(e)}(e)?r.get(e):e:a}function f0(e,r,i,a,u={canDeactivateChecks:[],canActivateChecks:[]}){const _=w_(r);return e.children.forEach(b=>{(function Jz(e,r,i,a,u={canDeactivateChecks:[],canActivateChecks:[]}){const _=e.value,b=r?r.value:null,M=i?i.getContext(e.value.outlet):null;if(b&&_.routeConfig===b.routeConfig){const R=function Qz(e,r,i){if("function"==typeof i)return i(e,r);switch(i){case"pathParamsChange":return!pm(e.url,r.url);case"pathParamsOrQueryParamsChange":return!pm(e.url,r.url)||!pu(e.queryParams,r.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!UD(e,r)||!pu(e.queryParams,r.queryParams);default:return!UD(e,r)}}(b,_,_.routeConfig.runGuardsAndResolvers);R?u.canActivateChecks.push(new d2(a)):(_.data=b.data,_._resolvedData=b._resolvedData),f0(e,r,_.component?M?M.children:null:i,a,u),R&&M&&M.outlet&&M.outlet.isActivated&&u.canDeactivateChecks.push(new K1(M.outlet.component,b))}else b&&p0(r,M,u),u.canActivateChecks.push(new d2(a)),f0(e,null,_.component?M?M.children:null:i,a,u)})(b,_[b.value.outlet],i,a.concat([b.value]),u),delete _[b.value.outlet]}),Object.entries(_).forEach(([b,M])=>p0(M,i.getContext(b),u)),u}function p0(e,r,i){const a=w_(e),u=e.value;Object.entries(a).forEach(([_,b])=>{p0(b,u.component?r?r.children.getContext(_):null:r,i)}),i.canDeactivateChecks.push(new K1(u.component&&r&&r.outlet&&r.outlet.isActivated?r.outlet.component:null,u))}function m0(e){return"function"==typeof e}function f2(e){return e instanceof B1||"EmptyError"===e?.name}const J1=Symbol("INITIAL_VALUE");function C_(){return Js(e=>A1(e.map(r=>r.pipe(Sl(1),P1(J1)))).pipe(ti(r=>{for(const i of r)if(!0!==i){if(i===J1)return J1;if(!1===i||i instanceof x_)return i}return!0}),Ys(r=>r!==J1),Sl(1)))}function p2(e){return function xc(...e){return Da(e)}(xs(r=>{if(mm(r))throw l2(0,r)}),ti(r=>!0===r))}class Q1{constructor(r){this.segmentGroup=r||null}}class m2{constructor(r){this.urlTree=r}}function D_(e){return Qv(new Q1(e))}function g2(e){return Qv(new m2(e))}class vB{constructor(r,i){this.urlSerializer=r,this.urlTree=i}noMatchError(r){return new xt(4002,!1)}lineralizeSegments(r,i){let a=[],u=i.root;for(;;){if(a=a.concat(u.segments),0===u.numberOfChildren)return Sn(a);if(u.numberOfChildren>1||!u.children[ci])return Qv(new xt(4e3,!1));u=u.children[ci]}}applyRedirectCommands(r,i,a){return this.applyRedirectCreateUrlTree(i,this.urlSerializer.parse(i),r,a)}applyRedirectCreateUrlTree(r,i,a,u){const _=this.createSegmentGroup(r,i.root,a,u);return new x_(_,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(r,i){const a={};return Object.entries(r).forEach(([u,_])=>{if("string"==typeof _&&_.startsWith(":")){const M=_.substring(1);a[u]=i[M]}else a[u]=_}),a}createSegmentGroup(r,i,a,u){const _=this.createSegments(r,i.segments,a,u);let b={};return Object.entries(i.children).forEach(([M,R])=>{b[M]=this.createSegmentGroup(r,R,a,u)}),new ar(_,b)}createSegments(r,i,a,u){return i.map(_=>_.path.startsWith(":")?this.findPosParam(r,_,u):this.findOrReturn(_,a))}findPosParam(r,i,a){const u=a[i.path.substring(1)];if(!u)throw new xt(4001,!1);return u}findOrReturn(r,i){let a=0;for(const u of i){if(u.path===r.path)return i.splice(a),u;a++}return r}}const qD={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function xB(e,r,i,a,u){const _=ZD(e,r,i);return _.matched?(a=function $z(e,r){return e.providers&&!e._injector&&(e._injector=JE(e.providers,r,`Route: ${e.path}`)),e._injector??r}(r,a),function gB(e,r,i,a){const u=r.canMatch;return u&&0!==u.length?Sn(u.map(b=>{const M=E_(b,e);return Ef(function oB(e){return e&&m0(e.canMatch)}(M)?M.canMatch(r,i):e.runInContext(()=>M(r,i)))})).pipe(C_(),p2()):Sn(!0)}(a,r,i).pipe(ti(b=>!0===b?_:{...qD}))):Sn(_)}function ZD(e,r,i){if(""===r.path)return"full"===r.pathMatch&&(e.hasChildren()||i.length>0)?{...qD}:{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};const u=(r.matcher||J3)(i,e,r);if(!u)return{...qD};const _={};Object.entries(u.posParams??{}).forEach(([M,R])=>{_[M]=R.path});const b=u.consumed.length>0?{..._,...u.consumed[u.consumed.length-1].parameters}:_;return{matched:!0,consumedSegments:u.consumed,remainingSegments:i.slice(u.consumed.length),parameters:b,positionalParamSegments:u.posParams??{}}}function _2(e,r,i,a){return i.length>0&&function EB(e,r,i){return i.some(a=>ew(e,r,a)&&vc(a)!==ci)}(e,i,a)?{segmentGroup:new ar(r,wB(a,new ar(i,e.children))),slicedSegments:[]}:0===i.length&&function CB(e,r,i){return i.some(a=>ew(e,r,a))}(e,i,a)?{segmentGroup:new ar(e.segments,bB(e,0,i,a,e.children)),slicedSegments:i}:{segmentGroup:new ar(e.segments,e.children),slicedSegments:i}}function bB(e,r,i,a,u){const _={};for(const b of a)if(ew(e,i,b)&&!u[vc(b)]){const M=new ar([],{});_[vc(b)]=M}return{...u,..._}}function wB(e,r){const i={};i[ci]=r;for(const a of e)if(""===a.path&&vc(a)!==ci){const u=new ar([],{});i[vc(a)]=u}return i}function ew(e,r,i){return(!(e.hasChildren()||r.length>0)||"full"!==i.pathMatch)&&""===i.path}class IB{constructor(r,i,a,u,_,b,M){this.injector=r,this.configLoader=i,this.rootComponentType=a,this.config=u,this.urlTree=_,this.paramsInheritanceStrategy=b,this.urlSerializer=M,this.allowRedirects=!0,this.applyRedirects=new vB(this.urlSerializer,this.urlTree)}noMatchError(r){return new xt(4002,!1)}recognize(){const r=_2(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,r,ci).pipe(fm(i=>{if(i instanceof m2)return this.allowRedirects=!1,this.urlTree=i.urlTree,this.match(i.urlTree);throw i instanceof Q1?this.noMatchError(i):i}),ti(i=>{const a=new Y1([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},ci,this.rootComponentType,null,{}),u=new zh(a,i),_=new o2("",u),b=function yz(e,r,i=null,a=null){return qA(HA(e),r,i,a)}(a,[],this.urlTree.queryParams,this.urlTree.fragment);return b.queryParams=this.urlTree.queryParams,_.url=this.urlSerializer.serialize(b),this.inheritParamsAndData(_._root),{state:_,tree:b}}))}match(r){return this.processSegmentGroup(this.injector,this.config,r.root,ci).pipe(fm(a=>{throw a instanceof Q1?this.noMatchError(a):a}))}inheritParamsAndData(r){const i=r.value,a=r2(i,this.paramsInheritanceStrategy);i.params=Object.freeze(a.params),i.data=Object.freeze(a.data),r.children.forEach(u=>this.inheritParamsAndData(u))}processSegmentGroup(r,i,a,u){return 0===a.segments.length&&a.hasChildren()?this.processChildren(r,i,a):this.processSegment(r,i,a,a.segments,u,!0)}processChildren(r,i,a){const u=[];for(const _ of Object.keys(a.children))"primary"===_?u.unshift(_):u.push(_);return ki(u).pipe(e0(_=>{const b=a.children[_],M=function Zz(e,r){const i=e.filter(a=>vc(a)===r);return i.push(...e.filter(a=>vc(a)!==r)),i}(i,_);return this.processSegmentGroup(r,M,b,_)}),function W3(e,r){return Fi(function Z3(e,r,i,a,u){return(_,b)=>{let M=i,R=r,z=0;_.subscribe(si(b,$=>{const K=z++;R=M?e(R,$,K):(M=!0,$),a&&b.next(R)},u&&(()=>{M&&b.next(R),b.complete()})))}}(e,r,arguments.length>=2,!0))}((_,b)=>(_.push(...b),_)),V1(null),function Y3(e,r){const i=arguments.length>=2;return a=>a.pipe(e?Ys((u,_)=>e(u,_,a)):on,SD(1),i?V1(r):PA(()=>new B1))}(),Un(_=>{if(null===_)return D_(a);const b=y2(_);return function SB(e){e.sort((r,i)=>r.value.outlet===ci?-1:i.value.outlet===ci?1:r.value.outlet.localeCompare(i.value.outlet))}(b),Sn(b)}))}processSegment(r,i,a,u,_,b){return ki(i).pipe(e0(M=>this.processSegmentAgainstRoute(M._injector??r,i,M,a,u,_,b).pipe(fm(R=>{if(R instanceof Q1)return Sn(null);throw R}))),dm(M=>!!M),fm(M=>{if(f2(M))return function TB(e,r,i){return 0===r.length&&!e.children[i]}(a,u,_)?Sn([]):D_(a);throw M}))}processSegmentAgainstRoute(r,i,a,u,_,b,M){return function DB(e,r,i,a){return!!(vc(e)===a||a!==ci&&ew(r,i,e))&&("**"===e.path||ZD(r,e,i).matched)}(a,u,_,b)?void 0===a.redirectTo?this.matchSegmentAgainstRoute(r,u,a,_,b,M):M&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(r,u,i,a,_,b):D_(u):D_(u)}expandSegmentAgainstRouteUsingRedirect(r,i,a,u,_,b){return"**"===u.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(r,a,u,b):this.expandRegularSegmentAgainstRouteUsingRedirect(r,i,a,u,_,b)}expandWildCardWithParamsAgainstRouteUsingRedirect(r,i,a,u){const _=this.applyRedirects.applyRedirectCommands([],a.redirectTo,{});return a.redirectTo.startsWith("/")?g2(_):this.applyRedirects.lineralizeSegments(a,_).pipe(Un(b=>{const M=new ar(b,{});return this.processSegment(r,i,M,b,u,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(r,i,a,u,_,b){const{matched:M,consumedSegments:R,remainingSegments:z,positionalParamSegments:$}=ZD(i,u,_);if(!M)return D_(i);const K=this.applyRedirects.applyRedirectCommands(R,u.redirectTo,$);return u.redirectTo.startsWith("/")?g2(K):this.applyRedirects.lineralizeSegments(u,K).pipe(Un(ce=>this.processSegment(r,a,i,ce.concat(z),b,!1)))}matchSegmentAgainstRoute(r,i,a,u,_,b){let M;if("**"===a.path){const R=u.length>0?kA(u).parameters:{};M=Sn({snapshot:new Y1(u,R,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,v2(a),vc(a),a.component??a._loadedComponent??null,a,x2(a)),consumedSegments:[],remainingSegments:[]}),i.children={}}else M=xB(i,a,u,r).pipe(ti(({matched:R,consumedSegments:z,remainingSegments:$,parameters:K})=>R?{snapshot:new Y1(z,K,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,v2(a),vc(a),a.component??a._loadedComponent??null,a,x2(a)),consumedSegments:z,remainingSegments:$}:null));return M.pipe(Js(R=>null===R?D_(i):this.getChildConfig(r=a._injector??r,a,u).pipe(Js(({routes:z})=>{const $=a._loadedInjector??r,{snapshot:K,consumedSegments:ce,remainingSegments:me}=R,{segmentGroup:Me,slicedSegments:ke}=_2(i,ce,me,z);if(0===ke.length&&Me.hasChildren())return this.processChildren($,z,Me).pipe(ti(It=>null===It?null:[new zh(K,It)]));if(0===z.length&&0===ke.length)return Sn([new zh(K,[])]);const ut=vc(a)===_;return this.processSegment($,z,Me,ke,ut?ci:_,!0).pipe(ti(It=>[new zh(K,It)]))}))))}getChildConfig(r,i,a){return i.children?Sn({routes:i.children,injector:r}):i.loadChildren?void 0!==i._loadedRoutes?Sn({routes:i._loadedRoutes,injector:i._loadedInjector}):function mB(e,r,i,a){const u=r.canLoad;return void 0===u||0===u.length?Sn(!0):Sn(u.map(b=>{const M=E_(b,e);return Ef(function tB(e){return e&&m0(e.canLoad)}(M)?M.canLoad(r,i):e.runInContext(()=>M(r,i)))})).pipe(C_(),p2())}(r,i,a).pipe(Un(u=>u?this.configLoader.loadChildren(r,i).pipe(xs(_=>{i._loadedRoutes=_.routes,i._loadedInjector=_.injector})):function yB(e){return Qv(c2(!1,3))}())):Sn({routes:[],injector:r})}}function AB(e){const r=e.value.routeConfig;return r&&""===r.path}function y2(e){const r=[],i=new Set;for(const a of e){if(!AB(a)){r.push(a);continue}const u=r.find(_=>a.value.routeConfig===_.value.routeConfig);void 0!==u?(u.children.push(...a.children),i.add(u)):r.push(a)}for(const a of i){const u=y2(a.children);r.push(new zh(a.value,u))}return r.filter(a=>!i.has(a))}function v2(e){return e.data||{}}function x2(e){return e.resolve||{}}function b2(e){return"string"==typeof e.title||null===e.title}function WD(e){return Js(r=>{const i=e(r);return i?ki(i).pipe(ti(()=>r)):Sn(r)})}const T_=new Bt("ROUTES");let YD=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Xt(WM)}loadComponent(i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return Sn(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);const a=Ef(i.loadComponent()).pipe(ti(w2),xs(_=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=_}),AD(()=>{this.componentLoaders.delete(i)})),u=new RA(a,()=>new Ti).pipe(ID());return this.componentLoaders.set(i,u),u}loadChildren(i,a){if(this.childrenLoaders.get(a))return this.childrenLoaders.get(a);if(a._loadedRoutes)return Sn({routes:a._loadedRoutes,injector:a._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(a);const _=function NB(e,r,i,a){return Ef(e.loadChildren()).pipe(ti(w2),Un(u=>u instanceof JT||Array.isArray(u)?Sn(u):ki(r.compileModuleAsync(u))),ti(u=>{a&&a(e);let _,b,M=!1;return Array.isArray(u)?(b=u,!0):(_=u.create(i).injector,b=_.get(T_,[],{optional:!0,self:!0}).flat()),{routes:b.map(HD),injector:_}}))}(a,this.compiler,i,this.onLoadEndListener).pipe(AD(()=>{this.childrenLoaders.delete(a)})),b=new RA(_,()=>new Ti).pipe(ID());return this.childrenLoaders.set(a,b),b}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function w2(e){return function zB(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let tw=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Ti,this.transitionAbortSubject=new Ti,this.configLoader=Xt(YD),this.environmentInjector=Xt($s),this.urlSerializer=Xt(r0),this.rootContexts=Xt(u0),this.inputBindingEnabled=null!==Xt(X1,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Sn(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=u=>this.events.next(new Az(u)),this.configLoader.onLoadStartListener=u=>this.events.next(new Sz(u))}complete(){this.transitions?.complete()}handleNavigationRequest(i){const a=++this.navigationId;this.transitions?.next({...this.transitions.value,...i,id:a})}setupNavigations(i,a,u){return this.transitions=new rn({id:0,currentUrlTree:a,currentRawUrl:a,currentBrowserUrl:a,extractedUrl:i.urlHandlingStrategy.extract(a),urlAfterRedirects:i.urlHandlingStrategy.extract(a),rawUrl:a,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:l0,restoredState:null,currentSnapshot:u.snapshot,targetSnapshot:null,currentRouterState:u,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ys(_=>0!==_.id),ti(_=>({..._,extractedUrl:i.urlHandlingStrategy.extract(_.rawUrl)})),Js(_=>{this.currentTransition=_;let b=!1,M=!1;return Sn(_).pipe(xs(R=>{this.currentNavigation={id:R.id,initialUrl:R.rawUrl,extractedUrl:R.extractedUrl,trigger:R.source,extras:R.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Js(R=>{const z=R.currentBrowserUrl.toString(),$=!i.navigated||R.extractedUrl.toString()!==z||z!==R.currentUrlTree.toString();if(!$&&"reload"!==(R.extras.onSameUrlNavigation??i.onSameUrlNavigation)){const ce="";return this.events.next(new b_(R.id,this.urlSerializer.serialize(R.rawUrl),ce,0)),R.resolve(null),Zi}if(i.urlHandlingStrategy.shouldProcessUrl(R.rawUrl))return Sn(R).pipe(Js(ce=>{const me=this.transitions?.getValue();return this.events.next(new Z1(ce.id,this.urlSerializer.serialize(ce.extractedUrl),ce.source,ce.restoredState)),me!==this.transitions?.getValue()?Zi:Promise.resolve(ce)}),function RB(e,r,i,a,u,_){return Un(b=>function MB(e,r,i,a,u,_,b="emptyOnly"){return new IB(e,r,i,a,u,b,_).recognize()}(e,r,i,a,b.extractedUrl,u,_).pipe(ti(({state:M,tree:R})=>({...b,targetSnapshot:M,urlAfterRedirects:R}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,i.config,this.urlSerializer,i.paramsInheritanceStrategy),xs(ce=>{_.targetSnapshot=ce.targetSnapshot,_.urlAfterRedirects=ce.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:ce.urlAfterRedirects};const me=new JA(ce.id,this.urlSerializer.serialize(ce.extractedUrl),this.urlSerializer.serialize(ce.urlAfterRedirects),ce.targetSnapshot);this.events.next(me)}));if($&&i.urlHandlingStrategy.shouldProcessUrl(R.currentRawUrl)){const{id:ce,extractedUrl:me,source:Me,restoredState:ke,extras:ut}=R,It=new Z1(ce,this.urlSerializer.serialize(me),Me,ke);this.events.next(It);const Ye=n2(0,this.rootComponentType).snapshot;return this.currentTransition=_={...R,targetSnapshot:Ye,urlAfterRedirects:me,extras:{...ut,skipLocationChange:!1,replaceUrl:!1}},Sn(_)}{const ce="";return this.events.next(new b_(R.id,this.urlSerializer.serialize(R.extractedUrl),ce,1)),R.resolve(null),Zi}}),xs(R=>{const z=new Dz(R.id,this.urlSerializer.serialize(R.extractedUrl),this.urlSerializer.serialize(R.urlAfterRedirects),R.targetSnapshot);this.events.next(z)}),ti(R=>(this.currentTransition=_={...R,guards:Xz(R.targetSnapshot,R.currentSnapshot,this.rootContexts)},_)),function aB(e,r){return Un(i=>{const{targetSnapshot:a,currentSnapshot:u,guards:{canActivateChecks:_,canDeactivateChecks:b}}=i;return 0===b.length&&0===_.length?Sn({...i,guardsResult:!0}):function lB(e,r,i,a){return ki(e).pipe(Un(u=>function pB(e,r,i,a,u){const _=r&&r.routeConfig?r.routeConfig.canDeactivate:null;return _&&0!==_.length?Sn(_.map(M=>{const R=d0(r)??u,z=E_(M,R);return Ef(function rB(e){return e&&m0(e.canDeactivate)}(z)?z.canDeactivate(e,r,i,a):R.runInContext(()=>z(e,r,i,a))).pipe(dm())})).pipe(C_()):Sn(!0)}(u.component,u.route,i,r,a)),dm(u=>!0!==u,!0))}(b,a,u,e).pipe(Un(M=>M&&function eB(e){return"boolean"==typeof e}(M)?function cB(e,r,i,a){return ki(r).pipe(e0(u=>R1(function hB(e,r){return null!==e&&r&&r(new Rz(e)),Sn(!0)}(u.route.parent,a),function uB(e,r){return null!==e&&r&&r(new Oz(e)),Sn(!0)}(u.route,a),function fB(e,r,i){const a=r[r.length-1],_=r.slice(0,r.length-1).reverse().map(b=>function Kz(e){const r=e.routeConfig?e.routeConfig.canActivateChild:null;return r&&0!==r.length?{node:e,guards:r}:null}(b)).filter(b=>null!==b).map(b=>L1(()=>Sn(b.guards.map(R=>{const z=d0(b.node)??i,$=E_(R,z);return Ef(function iB(e){return e&&m0(e.canActivateChild)}($)?$.canActivateChild(a,e):z.runInContext(()=>$(a,e))).pipe(dm())})).pipe(C_())));return Sn(_).pipe(C_())}(e,u.path,i),function dB(e,r,i){const a=r.routeConfig?r.routeConfig.canActivate:null;if(!a||0===a.length)return Sn(!0);const u=a.map(_=>L1(()=>{const b=d0(r)??i,M=E_(_,b);return Ef(function nB(e){return e&&m0(e.canActivate)}(M)?M.canActivate(r,e):b.runInContext(()=>M(r,e))).pipe(dm())}));return Sn(u).pipe(C_())}(e,u.route,i))),dm(u=>!0!==u,!0))}(a,_,e,r):Sn(M)),ti(M=>({...i,guardsResult:M})))})}(this.environmentInjector,R=>this.events.next(R)),xs(R=>{if(_.guardsResult=R.guardsResult,mm(R.guardsResult))throw l2(0,R.guardsResult);const z=new Tz(R.id,this.urlSerializer.serialize(R.extractedUrl),this.urlSerializer.serialize(R.urlAfterRedirects),R.targetSnapshot,!!R.guardsResult);this.events.next(z)}),Ys(R=>!!R.guardsResult||(this.cancelNavigationTransition(R,"",3),!1)),WD(R=>{if(R.guards.canActivateChecks.length)return Sn(R).pipe(xs(z=>{const $=new Mz(z.id,this.urlSerializer.serialize(z.extractedUrl),this.urlSerializer.serialize(z.urlAfterRedirects),z.targetSnapshot);this.events.next($)}),Js(z=>{let $=!1;return Sn(z).pipe(function PB(e,r){return Un(i=>{const{targetSnapshot:a,guards:{canActivateChecks:u}}=i;if(!u.length)return Sn(i);let _=0;return ki(u).pipe(e0(b=>function OB(e,r,i,a){const u=e.routeConfig,_=e._resolve;return void 0!==u?.title&&!b2(u)&&(_[t0]=u.title),function kB(e,r,i,a){const u=function LB(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===u.length)return Sn({});const _={};return ki(u).pipe(Un(b=>function FB(e,r,i,a){const u=d0(r)??a,_=E_(e,u);return Ef(_.resolve?_.resolve(r,i):u.runInContext(()=>_(r,i)))}(e[b],r,i,a).pipe(dm(),xs(M=>{_[b]=M}))),SD(1),function X3(e){return ti(()=>e)}(_),fm(b=>f2(b)?Zi:Qv(b)))}(_,e,r,a).pipe(ti(b=>(e._resolvedData=b,e.data=r2(e,i).resolve,u&&b2(u)&&(e.data[t0]=u.title),null)))}(b.route,a,e,r)),xs(()=>_++),SD(1),Un(b=>_===u.length?Sn(i):Zi))})}(i.paramsInheritanceStrategy,this.environmentInjector),xs({next:()=>$=!0,complete:()=>{$||this.cancelNavigationTransition(z,"",2)}}))}),xs(z=>{const $=new Iz(z.id,this.urlSerializer.serialize(z.extractedUrl),this.urlSerializer.serialize(z.urlAfterRedirects),z.targetSnapshot);this.events.next($)}))}),WD(R=>{const z=$=>{const K=[];$.routeConfig?.loadComponent&&!$.routeConfig._loadedComponent&&K.push(this.configLoader.loadComponent($.routeConfig).pipe(xs(ce=>{$.component=ce}),ti(()=>{})));for(const ce of $.children)K.push(...z(ce));return K};return A1(z(R.targetSnapshot.root)).pipe(V1(),Sl(1))}),WD(()=>this.afterPreactivation()),ti(R=>{const z=function Bz(e,r,i){const a=h0(e,r._root,i?i._root:void 0);return new t2(a,r)}(i.routeReuseStrategy,R.targetSnapshot,R.currentRouterState);return this.currentTransition=_={...R,targetRouterState:z},_}),xs(()=>{this.events.next(new FD)}),((e,r,i,a)=>ti(u=>(new Yz(r,u.targetRouterState,u.currentRouterState,i,a).activate(e),u)))(this.rootContexts,i.routeReuseStrategy,R=>this.events.next(R),this.inputBindingEnabled),Sl(1),xs({next:R=>{b=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Cf(R.id,this.urlSerializer.serialize(R.extractedUrl),this.urlSerializer.serialize(R.urlAfterRedirects))),i.titleStrategy?.updateTitle(R.targetRouterState.snapshot),R.resolve(!0)},complete:()=>{b=!0}}),M1(this.transitionAbortSubject.pipe(xs(R=>{throw R}))),AD(()=>{b||M||this.cancelNavigationTransition(_,"",1),this.currentNavigation?.id===_.id&&(this.currentNavigation=null)}),fm(R=>{if(M=!0,u2(R))this.events.next(new c0(_.id,this.urlSerializer.serialize(_.extractedUrl),R.message,R.cancellationCode)),function Uz(e){return u2(e)&&mm(e.url)}(R)?this.events.next(new ND(R.url)):_.resolve(!1);else{this.events.next(new W1(_.id,this.urlSerializer.serialize(_.extractedUrl),R,_.targetSnapshot??void 0));try{_.resolve(i.errorHandler(R))}catch(z){_.reject(z)}}return Zi}))}))}cancelNavigationTransition(i,a,u){const _=new c0(i.id,this.urlSerializer.serialize(i.extractedUrl),a,u);this.events.next(_),i.resolve(!1)}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function E2(e){return e!==l0}let C2=(()=>{class e{buildTitle(i){let a,u=i.root;for(;void 0!==u;)a=this.getResolvedTitleForRoute(u)??a,u=u.children.find(_=>_.outlet===ci);return a}getResolvedTitleForRoute(i){return i.data[t0]}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:function(){return Xt(BB)},providedIn:"root"})}return e})(),BB=(()=>{class e extends C2{constructor(i){super(),this.title=i}updateTitle(i){const a=this.buildTitle(i);void 0!==a&&this.title.setTitle(a)}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(pS))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),VB=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:function(){return Xt(UB)},providedIn:"root"})}return e})();class jB{shouldDetach(r){return!1}store(r,i){}shouldAttach(r){return!1}retrieve(r){return null}shouldReuseRoute(r,i){return r.routeConfig===i.routeConfig}}let UB=(()=>{class e extends jB{static#e=this.\u0275fac=function(){let i;return function(u){return(i||(i=function to(e){return na(()=>{const r=e.prototype.constructor,i=r[go]||no(r),a=Object.prototype;let u=Object.getPrototypeOf(e.prototype).constructor;for(;u&&u!==a;){const _=u[go]||no(u);if(_&&_!==i)return _;u=Object.getPrototypeOf(u)}return _=>new _})}(e)))(u||e)}}();static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const nw=new Bt("",{providedIn:"root",factory:()=>({})});let $B=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:function(){return Xt(GB)},providedIn:"root"})}return e})(),GB=(()=>{class e{shouldProcessUrl(i){return!0}extract(i){return i}merge(i,a){return i}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var g0=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(g0||{});function D2(e,r){e.events.pipe(Ys(i=>i instanceof Cf||i instanceof c0||i instanceof W1||i instanceof b_),ti(i=>i instanceof Cf||i instanceof b_?g0.COMPLETE:i instanceof c0&&(0===i.code||1===i.code)?g0.REDIRECTING:g0.FAILED),Ys(i=>i!==g0.REDIRECTING),Sl(1)).subscribe(()=>{r()})}function HB(e){throw e}function qB(e,r,i){return r.parse("/")}const ZB={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},WB={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Ya=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=Xt(qM),this.isNgZoneEnabled=!1,this._events=new Ti,this.options=Xt(nw,{optional:!0})||{},this.pendingTasks=Xt(ZM),this.errorHandler=this.options.errorHandler||HB,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||qB,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=Xt($B),this.routeReuseStrategy=Xt(VB),this.titleStrategy=Xt(C2),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Xt(T_,{optional:!0})?.flat()??[],this.navigationTransitions=Xt(tw),this.urlSerializer=Xt(r0),this.location=Xt(Uv),this.componentInputBindingEnabled=!!Xt(X1,{optional:!0}),this.eventsSubscription=new Zt,this.isNgZoneEnabled=Xt(hi)instanceof hi&&hi.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new x_,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=n2(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(i=>{this.lastSuccessfulId=i.id,this.currentPageId=this.browserPageId},i=>{this.console.warn(`Unhandled Navigation Error: ${i}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const i=this.navigationTransitions.events.subscribe(a=>{try{const{currentTransition:u}=this.navigationTransitions;if(null===u)return void(T2(a)&&this._events.next(a));if(a instanceof Z1)E2(u.source)&&(this.browserUrlTree=u.extractedUrl);else if(a instanceof b_)this.rawUrlTree=u.rawUrl;else if(a instanceof JA){if("eager"===this.urlUpdateStrategy){if(!u.extras.skipLocationChange){const _=this.urlHandlingStrategy.merge(u.urlAfterRedirects,u.rawUrl);this.setBrowserUrl(_,u)}this.browserUrlTree=u.urlAfterRedirects}}else if(a instanceof FD)this.currentUrlTree=u.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(u.urlAfterRedirects,u.rawUrl),this.routerState=u.targetRouterState,"deferred"===this.urlUpdateStrategy&&(u.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,u),this.browserUrlTree=u.urlAfterRedirects);else if(a instanceof c0)0!==a.code&&1!==a.code&&(this.navigated=!0),(3===a.code||2===a.code)&&this.restoreHistory(u);else if(a instanceof ND){const _=this.urlHandlingStrategy.merge(a.url,u.currentRawUrl),b={skipLocationChange:u.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||E2(u.source)};this.scheduleNavigation(_,l0,null,b,{resolve:u.resolve,reject:u.reject,promise:u.promise})}a instanceof W1&&this.restoreHistory(u,!0),a instanceof Cf&&(this.navigated=!0),T2(a)&&this._events.next(a)}catch(u){this.navigationTransitions.transitionAbortSubject.next(u)}});this.eventsSubscription.add(i)}resetRootComponentType(i){this.routerState.root.component=i,this.navigationTransitions.rootComponentType=i}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const i=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),l0,i)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(i=>{const a="popstate"===i.type?"popstate":"hashchange";"popstate"===a&&setTimeout(()=>{this.navigateToSyncWithBrowser(i.url,a,i.state)},0)}))}navigateToSyncWithBrowser(i,a,u){const _={replaceUrl:!0},b=u?.navigationId?u:null;if(u){const R={...u};delete R.navigationId,delete R.\u0275routerPageId,0!==Object.keys(R).length&&(_.state=R)}const M=this.parseUrl(i);this.scheduleNavigation(M,a,b,_)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(i){this.config=i.map(HD),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(i,a={}){const{relativeTo:u,queryParams:_,fragment:b,queryParamsHandling:M,preserveFragment:R}=a,z=R?this.currentUrlTree.fragment:b;let K,$=null;switch(M){case"merge":$={...this.currentUrlTree.queryParams,..._};break;case"preserve":$=this.currentUrlTree.queryParams;break;default:$=_||null}null!==$&&($=this.removeEmptyProps($));try{K=HA(u?u.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof i[0]||!i[0].startsWith("/"))&&(i=[]),K=this.currentUrlTree.root}return qA(K,i,$,z??null)}navigateByUrl(i,a={skipLocationChange:!1}){const u=mm(i)?i:this.parseUrl(i),_=this.urlHandlingStrategy.merge(u,this.rawUrlTree);return this.scheduleNavigation(_,l0,null,a)}navigate(i,a={skipLocationChange:!1}){return function YB(e){for(let r=0;r<e.length;r++)if(null==e[r])throw new xt(4008,!1)}(i),this.navigateByUrl(this.createUrlTree(i,a),a)}serializeUrl(i){return this.urlSerializer.serialize(i)}parseUrl(i){let a;try{a=this.urlSerializer.parse(i)}catch(u){a=this.malformedUriErrorHandler(u,this.urlSerializer,i)}return a}isActive(i,a){let u;if(u=!0===a?{...ZB}:!1===a?{...WB}:a,mm(i))return FA(this.currentUrlTree,i,u);const _=this.parseUrl(i);return FA(this.currentUrlTree,_,u)}removeEmptyProps(i){return Object.keys(i).reduce((a,u)=>{const _=i[u];return null!=_&&(a[u]=_),a},{})}scheduleNavigation(i,a,u,_,b){if(this.disposed)return Promise.resolve(!1);let M,R,z;b?(M=b.resolve,R=b.reject,z=b.promise):z=new Promise((K,ce)=>{M=K,R=ce});const $=this.pendingTasks.add();return D2(this,()=>{queueMicrotask(()=>this.pendingTasks.remove($))}),this.navigationTransitions.handleNavigationRequest({source:a,restoredState:u,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:i,extras:_,resolve:M,reject:R,promise:z,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),z.catch(K=>Promise.reject(K))}setBrowserUrl(i,a){const u=this.urlSerializer.serialize(i);if(this.location.isCurrentPathEqualTo(u)||a.extras.replaceUrl){const b={...a.extras.state,...this.generateNgRouterState(a.id,this.browserPageId)};this.location.replaceState(u,"",b)}else{const _={...a.extras.state,...this.generateNgRouterState(a.id,this.browserPageId+1)};this.location.go(u,"",_)}}restoreHistory(i,a=!1){if("computed"===this.canceledNavigationResolution){const _=this.currentPageId-this.browserPageId;0!==_?this.location.historyGo(_):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===_&&(this.resetState(i),this.browserUrlTree=i.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(a&&this.resetState(i),this.resetUrlToCurrentUrlTree())}resetState(i){this.routerState=i.currentRouterState,this.currentUrlTree=i.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,i.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(i,a){return"computed"===this.canceledNavigationResolution?{navigationId:i,\u0275routerPageId:a}:{navigationId:i}}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function T2(e){return!(e instanceof FD||e instanceof ND)}let iw=(()=>{class e{constructor(i,a,u,_,b,M){this.router=i,this.route=a,this.tabIndexAttribute=u,this.renderer=_,this.el=b,this.locationStrategy=M,this.href=null,this.commands=null,this.onChanges=new Ti,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const R=b.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===R||"area"===R,this.isAnchorElement?this.subscription=i.events.subscribe(z=>{z instanceof Cf&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(i){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",i)}ngOnChanges(i){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(i){null!=i?(this.commands=Array.isArray(i)?i:[i],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(i,a,u,_,b){return!!(null===this.urlTree||this.isAnchorElement&&(0!==i||a||u||_||b||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const i=null===this.href?null:function dx(e,r,i){return function Pw(e,r){return"src"===r&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===r&&("base"===e||"link"===e)?hg:hx}(r,i)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(i,a){const u=this.renderer,_=this.el.nativeElement;null!==a?u.setAttribute(_,i,a):u.removeAttribute(_,i)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static#e=this.\u0275fac=function(a){return new(a||e)(Pt(Ya),Pt(Bh),function Ns(e){return function En(e,r){if("class"===r)return e.classes;if("style"===r)return e.styles;const i=e.attrs;if(i){const a=i.length;let u=0;for(;u<a;){const _=i[u];if(Bl(_))break;if(0===_)u+=2;else if("number"==typeof _)for(u++;u<a&&"string"==typeof i[u];)u++;else{if(_===r)return i[u+1];u+=2}}}return null}(Gr(),e)}("tabindex"),Pt(Fp),Pt(Bo),Pt(lm))};static#t=this.\u0275dir=Tr({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(a,u){1&a&&Do("click",function(b){return u.onClick(b.button,b.ctrlKey,b.shiftKey,b.altKey,b.metaKey)}),2&a&&dc("target",u.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",AC],skipLocationChange:["skipLocationChange","skipLocationChange",AC],replaceUrl:["replaceUrl","replaceUrl",AC],routerLink:"routerLink"},standalone:!0,features:[_b,la]})}return e})();class M2{}let JB=(()=>{class e{constructor(i,a,u,_,b){this.router=i,this.injector=u,this.preloadingStrategy=_,this.loader=b}setUpPreloading(){this.subscription=this.router.events.pipe(Ys(i=>i instanceof Cf),e0(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(i,a){const u=[];for(const _ of a){_.providers&&!_._injector&&(_._injector=JE(_.providers,i,`Route: ${_.path}`));const b=_._injector??i,M=_._loadedInjector??b;(_.loadChildren&&!_._loadedRoutes&&void 0===_.canLoad||_.loadComponent&&!_._loadedComponent)&&u.push(this.preloadConfig(b,_)),(_.children||_._loadedRoutes)&&u.push(this.processRoutes(M,_.children??_._loadedRoutes))}return ki(u).pipe(qi())}preloadConfig(i,a){return this.preloadingStrategy.preload(a,()=>{let u;u=a.loadChildren&&void 0===a.canLoad?this.loader.loadChildren(i,a):Sn(null);const _=u.pipe(Un(b=>null===b?Sn(void 0):(a._loadedRoutes=b.routes,a._loadedInjector=b.injector,this.processRoutes(b.injector??i,b.routes))));return a.loadComponent&&!a._loadedComponent?ki([_,this.loader.loadComponent(a)]).pipe(qi()):_})}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(Ya),Qe(WM),Qe($s),Qe(M2),Qe(YD))};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const XD=new Bt("");let I2=(()=>{class e{constructor(i,a,u,_,b={}){this.urlSerializer=i,this.transitions=a,this.viewportScroller=u,this.zone=_,this.options=b,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},b.scrollPositionRestoration=b.scrollPositionRestoration||"disabled",b.anchorScrolling=b.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof Z1?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=i.navigationTrigger,this.restoredId=i.restoredState?i.restoredState.navigationId:0):i instanceof Cf?(this.lastId=i.id,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.urlAfterRedirects).fragment)):i instanceof b_&&0===i.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof QA&&(i.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(i.position):i.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(i.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(i,a){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new QA(i,"popstate"===this.lastSource?this.store[this.restoredId]:null,a))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(a){El()};static#t=this.\u0275prov=$t({token:e,factory:e.\u0275fac})}return e})();function Vh(e,r){return{\u0275kind:e,\u0275providers:r}}function A2(){const e=Xt(uo);return r=>{const i=e.get(sm);if(r!==i.components[0])return;const a=e.get(Ya),u=e.get(R2);1===e.get(KD)&&a.initialNavigation(),e.get(P2,null,Kn.Optional)?.setUpPreloading(),e.get(XD,null,Kn.Optional)?.init(),a.resetRootComponentType(i.componentTypes[0]),u.closed||(u.next(),u.complete(),u.unsubscribe())}}const R2=new Bt("",{factory:()=>new Ti}),KD=new Bt("",{providedIn:"root",factory:()=>1}),P2=new Bt("");function n4(e){return Vh(0,[{provide:P2,useExisting:JB},{provide:M2,useExisting:e}])}const O2=new Bt("ROUTER_FORROOT_GUARD"),r4=[Uv,{provide:r0,useClass:RD},Ya,u0,{provide:Bh,useFactory:function S2(e){return e.routerState.root},deps:[Ya]},YD,[]];function o4(){return new tI("Router",Ya)}let JD=(()=>{class e{constructor(i){}static forRoot(i,a){return{ngModule:e,providers:[r4,[],{provide:T_,multi:!0,useValue:i},{provide:O2,useFactory:c4,deps:[[Ya,new Gi,new ap]]},{provide:nw,useValue:a||{}},a?.useHash?{provide:lm,useClass:fk}:{provide:lm,useClass:RI},{provide:XD,useFactory:()=>{const e=Xt(OL),r=Xt(hi),i=Xt(nw),a=Xt(tw),u=Xt(r0);return i.scrollOffset&&e.setOffset(i.scrollOffset),new I2(u,a,e,r,i)}},a?.preloadingStrategy?n4(a.preloadingStrategy).\u0275providers:[],{provide:tI,multi:!0,useFactory:o4},a?.initialNavigation?u4(a):[],a?.bindToComponentInputs?Vh(8,[a2,{provide:X1,useExisting:a2}]).\u0275providers:[],[{provide:k2,useFactory:A2},{provide:wC,multi:!0,useExisting:k2}]]}}static forChild(i){return{ngModule:e,providers:[{provide:T_,multi:!0,useValue:i}]}}static#e=this.\u0275fac=function(a){return new(a||e)(Qe(O2,8))};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({})}return e})();function c4(e){return"guarded"}function u4(e){return["disabled"===e.initialNavigation?Vh(3,[{provide:pC,multi:!0,useFactory:()=>{const r=Xt(Ya);return()=>{r.setUpLocationChangeListener()}}},{provide:KD,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Vh(2,[{provide:KD,useValue:0},{provide:pC,multi:!0,deps:[uo],useFactory:r=>{const i=r.get(hk,Promise.resolve());return()=>i.then(()=>new Promise(a=>{const u=r.get(Ya),_=r.get(R2);D2(u,()=>{a(!0)}),r.get(tw).afterPreactivation=()=>(a(!0),_.closed?Sn(void 0):_),u.initialNavigation()}))}}]).\u0275providers:[]]}const k2=new Bt("");let d4=(()=>{class e{constructor(){this.title="my-wedding"}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275cmp=Bi({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(a,u){1&a&&Bn(0,"router-outlet")},dependencies:[$D]})}return e})(),f4=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({imports:[WI,JD,SA]})}return e})();const p4=function(e){return{ID:e}};let m4=(()=>{class e{constructor(i,a){this.router=i,this._activatedRoute=a,this.category="",this.category=this._activatedRoute.snapshot.queryParamMap.get("ID"),console.log(this.category)}static#e=this.\u0275fac=function(a){return new(a||e)(Pt(Ya),Pt(Bh))};static#t=this.\u0275cmp=Bi({type:e,selectors:[["page-envelope"]],decls:15,vars:3,consts:[[1,"container-fluid","bgimg","d-flex","align-items-center","justify-content-center"],[1,"row"],[1,"col"],[1,"text-center","text-light","title","txtcolor","display-1","fw-bolder"],[1,"text-center","text-light","txtcolor","title","display-1","fw-bolder"],[1,"text-center","text-light","title","display-5","fw-bolder"],[1,"row","p-0"],[1,"col","mt-5","d-flex","p-0","justify-content-center"],["routerLink","../invitation",1,"btn","fw-bolder","body","btn-lg","text-light","btncolor",3,"queryParams"]],template:function(a,u){1&a&&(bt(0,"div",0)(1,"div",1)(2,"div",2)(3,"p",3),St(4," Carlos "),Lt(),bt(5,"p",3),St(6,"&"),Lt(),bt(7,"p",4),St(8," Carolina "),Lt(),bt(9,"p",5),St(10," Sabado 25 de Mayo del 2024 "),Lt()(),bt(11,"div",6)(12,"div",7)(13,"button",8),St(14," Ir a la invitacion "),Lt()()()()()),2&a&&(Eo(13),Za("queryParams",aM(1,p4,u.category)))},dependencies:[iw],styles:[".bgimg[_ngcontent-%COMP%]{background-image:linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)),url(/assets/photos/portada.jpg);background-size:cover;height:100vh;width:100vw;background-repeat:no-repeat;position:relative;background-position:50% 45%;-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px)}.body[_ngcontent-%COMP%]{font-family:Times New Roman,Times,serif}.btncolor[_ngcontent-%COMP%]{background:#7F9B84}@media (max-width: 728px){img[_ngcontent-%COMP%]{margin-top:20px;width:75%;height:220px}}@font-face{font-family:HarryPotter;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/harry-potter/Harry-Potter.ttf)}.txtcolor[_ngcontent-%COMP%]{background:linear-gradient(to bottom,#cfc09f 27%,#ffecb3 40%,#3a2c0f 78%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}"]})}return e})();const L2=JSON.parse('[{"ID":"506faad4-9533-4307-a719-17814880ff1c","Invitados":["Norma Castro","Raul Rodriguez","Itzel Rodriguez","Javier Alba"]},{"ID":"785f15fb-e6bf-4231-b431-2850eff1e3d4","Invitados":["Raul Rodriguez","Selena Torres"]},{"ID":"9716710b-bd05-48c8-8642-b2d4761a08ce","Invitados":["Rebeca Rodriguez","Orlando Pereida"]},{"ID":"7b76ab98-641f-4262-b44d-cdddc014d99e","Invitados":["Astrid Pereida"]},{"ID":"cf25bf7d-0282-41f3-b30a-6ead4124f53d","Invitados":["Oralia Ruiz"]},{"ID":"502e9376-4c49-46a7-ab2f-667474014430","Invitados":["Juan Pereida","Gabriela Guerrero"]},{"ID":"050f011c-9b8c-4286-a3ec-c9df577e53a5","Invitados":["Rogelio Rodriguez","Luz Perez"]},{"ID":"1dec50e3-11bb-4f29-a38e-99e96226d925","Invitados":["Rogelio Rodriguez"]},{"ID":"ab4a7e13-b700-4a50-ba2b-d7b03f40dd02","Invitados":["Eduardo Rodriguez","Valeria"]},{"ID":"2f1b2689-e5df-4337-b71d-336a81133bfc","Invitados":["Christian Rodriguez","Valeria Olivares"]},{"ID":"6c2f9f08-6fc5-4a6d-849b-3c02c998121a","Invitados":["Alberto Rodriguez","Ines Alvarez"]},{"ID":"05a1e977-047f-41c2-95d3-7c9c1d7893ae","Invitados":["Ricardo Rodriguez","Yaneth Hernandez","Rodrigo Rodriguez","Ricardo Rodriguez"]},{"ID":"f59fdf07-efa2-45c0-93c7-341d6dc0e29b","Invitados":["Paola Rodriguez","Rodolfo Sanchez"]},{"ID":"ee62cbf6-2c76-4843-a356-2c9e3f82b1c0","Invitados":["Fela Castro","Maricela Hernandez"]},{"ID":"45c00fda-aa97-4d22-8794-c731035ea07a","Invitados":["Raquel Rodriguez","Pedro"]},{"ID":"0db8a36d-92b8-415d-ad71-54a18f12f77d","Invitados":["Ericka Castro","Itsamara Contreras","Erick Ontiveros","Leslie"]},{"ID":"2311b9ce-6396-4e81-9a55-5e3810c1a35f","Invitados":["Antonio Castro","Nora ","Michel Castro"]},{"ID":"bc1a04dc-eccb-4075-a5b9-296248116299","Invitados":["Karime Castro","Acompa\xf1ante"]},{"ID":"da3c4b05-680c-4427-aa61-eaa59223292b","Invitados":["Raul Castro","Alicia Carranza","Raul Castro","Varinia Castro"]},{"ID":"be37e20b-2da4-45fc-8a9b-8ffdfb8d90a6","Invitados":["Veronica Castro","Jesus Gonzalez"]},{"ID":"f7865712-b1e6-46e3-92ed-d2ab0b1d9257","Invitados":["Priscila Gonzalez","Acompa\xf1ante"]},{"ID":"79c4a984-782a-4096-8f9d-273654f31b22","Invitados":["Andres Martinez","Brenda Alvarado"]},{"ID":"30db733d-3214-476a-b344-a9c108f01118","Invitados":["Omar Mancillas"]},{"ID":"e6d9dc8e-a258-447f-88a3-fcdcf0c962d5","Invitados":["Elvia Resendiz","Jose Garcia","Micaela Carrizales","Josue Garcia","David Garcia","Edith Garcia","Ericka Garcia"]},{"ID":"5c320eae-2f2f-4c22-a9b4-aab395f21fda","Invitados":["Nohemi Resendiz","Fernando Casares","Fernanda Casares"]},{"ID":"987ec374-472a-4b6d-8db0-bf25dcb276d4","Invitados":["Mayra Casares","Luis Delgado"]},{"ID":"c2fd8843-147d-4f00-8b61-d8ace031b139","Invitados":["Alberta Resendiz","Sergio Hernandez","Carlos Resendiz"]},{"ID":"4212f0f1-520c-447c-b833-ac4eae8fd2e5","Invitados":["Aureliano Resendiz","Nancy Urbina","Alexandra Ramirez","Angel Resendiz","Daniel Resendiz"]},{"ID":"66ec785a-f191-475f-abbd-e82d85c8ffa5","Invitados":["Blanca Ayala","Sergio Arroyo","Angeles Alcala"]},{"ID":"b9bcf90f-ba69-433f-8675-48b4a9e0930a","Invitados":["Abel Rodriguez","Maria Vazquez"]},{"ID":"a190333a-baed-4508-acf0-22c66cec7ec6","Invitados":["Blanca Alvarez","Jose Ayala"]},{"ID":"f4ac1c7b-fb4c-4cc9-a6b2-c17f71a487f6","Invitados":["Anilu Ayala"]},{"ID":"90d28834-2478-4f33-a062-d93d8b0a723b","Invitados":["Alejandra Davila","Acompa\xf1ante"]},{"ID":"0663f137-1cb0-47c5-aef4-07bf20938bd5","Invitados":["Cesia Rosales","Cristian Mendoza"]},{"ID":"c70e7515-1922-4a58-9bfc-9a2b91219b4d","Invitados":["Roberto Barco","Acompa\xf1ante"]},{"ID":"19447ac9-00a5-4573-b627-98479f1ab3b2","Invitados":["Angela Pool","Alfredo Camargo"]},{"ID":"c5fb2b04-85ed-4a78-a6de-f7e7800dacd2","Invitados":["Montserrat Silva","Acompa\xf1ante"]},{"ID":"9ea2c1dd-7503-4bc8-a95c-a861b9e80e8e","Invitados":["Daniela Barrera","Acompa\xf1ante"]},{"ID":"a121eed5-38b2-4774-8888-707aed478c3f","Invitados":["Manuel Zapata","Acompa\xf1ante"]},{"ID":"89c0f350-e9c1-44e6-9f9d-d6c138e01e91","Invitados":["Chena Morales","Alejandro Casta\xf1o"]},{"ID":"2d8b989a-1031-40e8-8912-312f49a882e6","Invitados":["Jesus Ramirez","Acompa\xf1ante"]},{"ID":"fd350b72-b84f-4845-b519-ba0fd981b2d9","Invitados":["Diana Hernandez","Acompa\xf1ante"]}]');let g4=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275cmp=Bi({type:e,selectors:[["wedding-our-photo"]],decls:10,vars:0,consts:[[1,"center","justify-content-around"],[1,"center","fadeout","animate__animated","animate__fadeIn","animate__delay-1s"],["src","assets/photos/us4.jpg","alt","Novio",1,"card-img","image-photo","animate__animated","animate__fadeIn"],[1,"card-img-overlay","d-flex","justify-content-center","animate__animated","animate__slideInDown"],[1,"text-light","fw-bolder","txtcolor","p-2","display-1"],[1,"mt-4","text-center","txtcolor"]],template:function(a,u){1&a&&(bt(0,"div",0)(1,"div",1),Bn(2,"img",2),Lt(),bt(3,"div",3)(4,"div",4)(5,"p",5),St(6,"Nuestra Boda"),Lt(),bt(7,"p",5),St(8,"Carlos & Carolina"),Lt(),Bn(9,"p"),Lt()()())},styles:[".image-photo[_ngcontent-%COMP%]{width:100vw;background-repeat:no-repeat;filter:brightness(60%)}.textsize[_ngcontent-%COMP%]{height:100px;width:100px}.glass[_ngcontent-%COMP%]{-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);border-radius:30px;width:-moz-fit-content;width:fit-content;background-color:#0003}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}*[_ngcontent-%COMP%]{font-family:GreatVibes}@media screen and (max-width: 767px){.image-photo[_ngcontent-%COMP%]{height:100vh;background-repeat:no-repeat;-webkit-backdrop-filter:brightness(20%);backdrop-filter:brightness(20%)}}.txtcolor[_ngcontent-%COMP%]{background:linear-gradient(to bottom,#cfc09f 27%,#ffecb3 40%,#3a2c0f 78%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}@keyframes _ngcontent-%COMP%_fade-out{20%{opacity:1}85%,to{opacity:0}}.fadeout[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-out linear forwards;animation-timeline:view();animation-range:exit}.txtcolor[_ngcontent-%COMP%]{color:#cdb77c}"]})}return e})(),_4=(()=>{class e{constructor(){this.audio=new Audio("assets/audio/todocambio.mpeg")}ngOnInit(){this.audio.load(),this.audio.play()}playSound(i){this.audio.muted=!1,this.audio.paused?(this.audio.play(),i.textContent="Pause"):(this.audio.pause(),i.textContent="Play")}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275cmp=Bi({type:e,selectors:[["wedding-fab"]],decls:4,vars:0,consts:[[1,"title","position-absolute","bottom-0","end-0","rounded-circle","m-5"],["id","sonido","type","button",1,"fw-bolder","body","btncolor","btn","btn-lg","float",3,"click"],[1,"icon","body","text-light"]],template:function(a,u){1&a&&(bt(0,"div",0)(1,"button",1),Do("click",function(b){return u.playSound(b.target)}),bt(2,"i",2),St(3,"Pause"),Lt()()())},styles:[".float[_ngcontent-%COMP%]{position:fixed;bottom:1rem;right:1rem}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}.body[_ngcontent-%COMP%]{font-family:Times New Roman,Times,serif}.btncolor[_ngcontent-%COMP%]{background:#7F9B84}"]})}return e})();ES(0,1e3);let y4=(()=>{class e{ngOnInit(){const i=new Date("2024-05-25 17:00:00");function u($,K,ce){$.textContent=ce,K.textContent=ce}function _($,K){const ce=function a($){const K=$.querySelector(".segment-display"),ce=K.querySelector(".segment-display__top"),me=K.querySelector(".segment-display__bottom"),Me=K.querySelector(".segment-overlay"),ke=Me.querySelector(".segment-overlay__top"),ut=Me.querySelector(".segment-overlay__bottom");return{segmentDisplayTop:ce,segmentDisplayBottom:me,segmentOverlay:Me,segmentOverlayTop:ke,segmentOverlayBottom:ut}}($);parseInt(ce.segmentDisplayTop.textContent,10)!==K&&(ce.segmentOverlay.classList.add("flip"),u(ce.segmentDisplayTop,ce.segmentOverlayBottom,K),ce.segmentOverlay.addEventListener("animationend",function me(){ce.segmentOverlay.classList.remove("flip"),u(ce.segmentDisplayBottom,ce.segmentOverlayTop,K),removeEventListener("animationend",me)}))}function b($,K){const ce=Math.floor(K/10)||0,me=K%10||0,ke=document.getElementById($).querySelectorAll(".time-segment");_(ke[0],ce),_(ke[1],me)}function R(){const $=function M($){let K=0,ce=0,me=0,Me=0;const ke=new Date,ut=ke>=$;return ut?{complete:ut,seconds:0,minutes:0,hours:0,days:0}:(K=Math.abs(Date.UTC($.getFullYear(),$.getMonth(),$.getDate(),$.getHours(),$.getMinutes(),$.getSeconds())-Date.UTC(ke.getFullYear(),ke.getMonth(),ke.getDate(),ke.getHours(),ke.getMinutes(),ke.getSeconds()))/1e3,ce=Math.floor(K/60),me=Math.floor(ce/60),Me=Math.floor(me/24),me-=24*Me,ce=ce-24*Me*60-60*me,K=K-24*Me*60*60-60*me*60-60*ce,{complete:ut,seconds:K,minutes:ce,hours:me,days:Me})}(i);return b("seconds",$.seconds),b("minutes",$.minutes),b("hours",$.hours),b("days",$.days),$.complete}const z=setInterval(()=>{R()&&clearInterval(z)},1e3);R()}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275cmp=Bi({type:e,selectors:[["wedding-invitacion"]],decls:83,vars:0,consts:[[1,"col","showup","text-justify","text-center","p-4"],[1,"title","fw-bolder","display-3","font-weight-bold","txtcolor"],[1,"body","display-6","fs-2"],[1,"container"],[1,"row"],[1,"countdown","d-flex","justify-content-center","col"],["id","days",1,"time-section"],[1,"time-group"],[1,"time-segment"],[1,"segment-display"],[1,"segment-display__top"],[1,"segment-display__bottom"],[1,"segment-overlay"],[1,"segment-overlay__top"],[1,"segment-overlay__bottom"],[1,"body"],["id","hours",1,"time-section"],["id","minutes",1,"time-section"],["id","seconds",1,"time-section"]],template:function(a,u){1&a&&(bt(0,"div",0)(1,"div")(2,"p",1),St(3," Te invitamos a nuestra boda "),Lt()(),Bn(4,"br"),bt(5,"div")(6,"p",2),St(7,"Faltan"),Lt()(),bt(8,"div",3)(9,"div",4)(10,"div",5)(11,"div",6)(12,"div",7)(13,"div",8)(14,"div",9),Bn(15,"div",10)(16,"div",11),bt(17,"div",12),Bn(18,"div",13)(19,"div",14),Lt()()(),bt(20,"div",8)(21,"div",9),Bn(22,"div",10)(23,"div",11),bt(24,"div",12),Bn(25,"div",13)(26,"div",14),Lt()()()(),bt(27,"p",15),St(28,"Dias"),Lt()(),bt(29,"div",16)(30,"div",7)(31,"div",8)(32,"div",9),Bn(33,"div",10)(34,"div",11),bt(35,"div",12),Bn(36,"div",13)(37,"div",14),Lt()()(),bt(38,"div",8)(39,"div",9),Bn(40,"div",10)(41,"div",11),bt(42,"div",12),Bn(43,"div",13)(44,"div",14),Lt()()()(),bt(45,"p",15),St(46,"Horas"),Lt()(),bt(47,"div",17)(48,"div",7)(49,"div",8)(50,"div",9),Bn(51,"div",10)(52,"div",11),bt(53,"div",12),Bn(54,"div",13)(55,"div",14),Lt()()(),bt(56,"div",8)(57,"div",9),Bn(58,"div",10)(59,"div",11),bt(60,"div",12),Bn(61,"div",13)(62,"div",14),Lt()()()(),bt(63,"p",15),St(64,"Minutos"),Lt()(),bt(65,"div",18)(66,"div",7)(67,"div",8)(68,"div",9),Bn(69,"div",10)(70,"div",11),bt(71,"div",12),Bn(72,"div",13)(73,"div",14),Lt()()(),bt(74,"div",8)(75,"div",9),Bn(76,"div",10)(77,"div",11),bt(78,"div",12),Bn(79,"div",13)(80,"div",14),Lt()()()(),bt(81,"p",15),St(82,"Segundos"),Lt()()()()()())},styles:["@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.body[_ngcontent-%COMP%]{font-family:Times New Roman,Times,serif}@keyframes _ngcontent-%COMP%_show{0%{opacity:0;scale:25%}to{opacity:1;scale:100%}}.showup[_ngcontent-%COMP%]{view-timeline-name:--div;view-timeline-axis:block;animation-timeline:--div;animation-name:_ngcontent-%COMP%_show;animation-range:entry 10% cover 80%;animation-fill-mode:both}.txtcolor[_ngcontent-%COMP%]{color:#cdb77c}.title[_ngcontent-%COMP%]{font-family:GreatVibes}.bg[_ngcontent-%COMP%]{background-image:url(https://carlosrdzcas.github.io/MyWedding/assets/photos/bgpapiro.jpg);background-size:cover}*[_ngcontent-%COMP%]{box-sizing:border-box}.countdown[_ngcontent-%COMP%]{margin:80px auto;width:50%;display:flex;gap:30px;font-family:Monteserrat}.time-section[_ngcontent-%COMP%]{font-size:30px}.time-group[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:10px}.time-segment[_ngcontent-%COMP%]{display:block;font-size:100px;font-weight:900;width:70px}.segment-display[_ngcontent-%COMP%]{position:relative;height:100%}.segment-display__top[_ngcontent-%COMP%], .segment-display__bottom[_ngcontent-%COMP%]{overflow:hidden;text-align:center;width:100%;height:50%;position:relative}.segment-display__top[_ngcontent-%COMP%]{line-height:1.5;color:#eee;background-color:#cdb77c}.segment-display__bottom[_ngcontent-%COMP%]{line-height:0;color:#fff;background-color:#cdb77c}.segment-overlay[_ngcontent-%COMP%]{position:absolute;display:block;top:0;perspective:400px;height:100%;width:70px}.segment-overlay__top[_ngcontent-%COMP%], .segment-overlay__bottom[_ngcontent-%COMP%]{position:absolute;overflow:hidden;display:block;text-align:center;width:100%;height:50%}.segment-overlay__top[_ngcontent-%COMP%]{top:0;display:block;line-height:1.5;color:#fff;background-color:#cdb77c;transform-origin:bottom}.segment-overlay__bottom[_ngcontent-%COMP%]{display:block;bottom:0;line-height:0;color:#eee;background-color:#cdb77c;border-top:2px solid #CDB77C;transform-origin:top}.segment-overlay.flip[_ngcontent-%COMP%]   .segment-overlay__top[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_flip-top .8s linear}.segment-overlay.flip[_ngcontent-%COMP%]   .segment-overlay__bottom[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_flip-bottom .8s linear}@keyframes _ngcontent-%COMP%_flip-top{0%{transform:rotateX(0)}50%,to{transform:rotateX(-90deg)}}@keyframes _ngcontent-%COMP%_flip-bottom{0%,50%{transform:rotateX(90deg)}to{transform:rotateX(0)}}@media screen and (max-width: 800px){.countdown[_ngcontent-%COMP%]{margin:4px auto;width:50%;display:flex;gap:10px;font-family:Monteserrat}.time-section[_ngcontent-%COMP%]{font-size:15px}.time-group[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:3px}.time-segment[_ngcontent-%COMP%]{display:block;font-size:50px;font-weight:900;width:40px}.segment-overlay[_ngcontent-%COMP%]{position:absolute;top:0;perspective:400px;height:100%;width:40px}}"]})}return e})();var rw=$h(574);let v4=(()=>{class e{ngOnInit(){this.mapa=new rw.Map({accessToken:"pk.eyJ1IjoiY2FybG9zOTg1NiIsImEiOiJjbDQzNHIyamMxaTJoM2pweDE1dGdsODZ6In0.F8JVwEIzHcWD8XTnzV3JPw",container:"mapa",style:"mapbox://styles/mapbox/streets-v12",center:[-99.5396777,27.4561691],zoom:16.6}),this.crearMarcador(-99.5396777,27.4561691)}crearMarcador(i,a){new rw.Marker({draggable:!1,color:"#FF0000"}).setLngLat([i,a]).addTo(this.mapa)}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275cmp=Bi({type:e,selectors:[["wedding-dialog-iglesia"]],decls:7,vars:0,consts:[[1,"tam"],[1,"title","fw-bolder","p-3","fw-bold","fs-1","txtcolor"],["id","mapa"],["mat-button","","mat-dialog-close","",1,"body","btn","btn-danger"]],template:function(a,u){1&a&&(bt(0,"div",0)(1,"h3",1),St(2,"Ubicacion de la Iglesia"),Lt(),Bn(3,"mat-dialog-content",2),bt(4,"mat-dialog-actions")(5,"button",3),St(6,"Cerrar"),Lt()()())},dependencies:[TA,MA,IA],styles:["[_nghost-%COMP%]{display:block}.tam[_ngcontent-%COMP%]{height:85vh;width:100vw}#mapa[_ngcontent-%COMP%]{height:80vh;width:100vw}*[_ngcontent-%COMP%]{z-index:1}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}.body[_ngcontent-%COMP%]{font-family:Times New Roman,Times,serif}.txtcolor[_ngcontent-%COMP%]{color:#cdb77c}"]})}return e})(),x4=(()=>{class e{ngOnInit(){this.mapa=new rw.Map({accessToken:"pk.eyJ1IjoiY2FybG9zOTg1NiIsImEiOiJjbDQzNHIyamMxaTJoM2pweDE1dGdsODZ6In0.F8JVwEIzHcWD8XTnzV3JPw",container:"mapa",style:"mapbox://styles/mapbox/streets-v12",center:[-99.5163921,27.4663813],zoom:16.6}),this.crearMarcador(-99.5163921,27.4663813)}crearMarcador(i,a){new rw.Marker({draggable:!1,color:"#FF0000"}).setLngLat([i,a]).addTo(this.mapa)}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275cmp=Bi({type:e,selectors:[["wedding-dialog-salon"]],decls:7,vars:0,consts:[[1,"tam"],[1,"title","fw-bolder","p-3","fs-1","fw-bold","txtcolor"],["id","mapa"],["mat-button","","mat-dialog-close","",1,"body","btn","btn-danger"]],template:function(a,u){1&a&&(bt(0,"div",0)(1,"h3",1),St(2,"Ubicacion de la Recepcion"),Lt(),Bn(3,"mat-dialog-content",2),bt(4,"mat-dialog-actions")(5,"button",3),St(6,"Cerrar"),Lt()()())},dependencies:[TA,MA,IA],styles:["[_nghost-%COMP%]{display:block}.tam[_ngcontent-%COMP%]{height:85vh;width:100vw}#mapa[_ngcontent-%COMP%]{height:80vh;width:100vw}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}.body[_ngcontent-%COMP%]{font-family:Times New Roman,Times,serif}.txtcolor[_ngcontent-%COMP%]{color:#cdb77c}"]})}return e})(),b4=(()=>{class e{constructor(i){this.dialog=i}openDialogIglesia(){this.dialog.open(v4).afterClosed().subscribe(a=>{})}openDialogSalon(){this.dialog.open(x4).afterClosed().subscribe(a=>{})}static#e=this.\u0275fac=function(a){return new(a||e)(Pt(MD))};static#t=this.\u0275cmp=Bi({type:e,selectors:[["wedding-lugares"]],decls:50,vars:0,consts:[[1,"container-fluid","mb-5","mt-4"],[1,"row"],[1,"col-sm-6","p-0","slidein","text-justify","text-center"],[1,"col"],[1,"title","fw-bolder","display-3","txtcolor"],["src","assets/photos/iglesia.png","alt","",1,"icon"],[1,"container"],[1,"body","row","mt-5"],[1,"col-4","p-0"],[1,"fs-5"],[1,"col-4","p-0","mb-1"],["src","https://carlosrdzcas.github.io/MyWedding/assets/photos/footprints.png","alt","",1,"footprints"],[1,"body","col-4","p-0"],[1,"fw-bolder","fs-5"],[1,"mb-4","body","btn","center","fw-bolder","btncolor",3,"click"],[1,"text-light"],[1,"col-sm-6","slidein","p-0","text-justify","text-center"],["src","assets/photos/copas.png","alt","",1,"icon"],[1,"body","row","mt-5","m-0","p-0"],[1,"body","mt-3"],[1,"fw-bolder","btncolor","body","btn",3,"click"]],template:function(a,u){1&a&&(bt(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"p",4),St(5,"Ceremonia Religiosa"),Lt(),Bn(6,"img",5),Lt(),bt(7,"div",6)(8,"div",7)(9,"div",8)(10,"p",9),St(11,"25 Mayo"),Lt()(),bt(12,"div",10),Bn(13,"img",11),Lt(),bt(14,"div",12)(15,"p",9),St(16,"05:00 PM"),Lt()()()(),Bn(17,"br"),bt(18,"div",7)(19,"p",13),St(20,"Iglesia Santa Elena"),Lt()(),bt(21,"div")(22,"button",14),Do("click",function(){return u.openDialogIglesia()}),bt(23,"span",15),St(24,"Ver Ubicacion"),Lt()()()(),bt(25,"div",16)(26,"div",3)(27,"p",4),St(28,"Recepcion"),Lt(),Bn(29,"img",17),Lt(),bt(30,"div",6)(31,"div",18)(32,"div",8),Bn(33,"br"),bt(34,"p",9),St(35,"25 Mayo"),Lt()(),bt(36,"div",8),Bn(37,"img",11),Lt(),bt(38,"div",8)(39,"p",9),St(40,"07:30 PM"),Lt(),bt(41,"p",9),St(42,"01:00 AM"),Lt()()()(),bt(43,"div",19)(44,"p",13),St(45,"ARA Salon Terraza Alberca"),Lt()(),bt(46,"div")(47,"button",20),Do("click",function(){return u.openDialogSalon()}),bt(48,"span",15),St(49,"Ver Ubicacion"),Lt()()()()()())},styles:[".icon[_ngcontent-%COMP%]{height:85px;width:85px}.txtcolor[_ngcontent-%COMP%]{color:#cdb77c}.fs[_ngcontent-%COMP%]{font-size:15px}.btncolor[_ngcontent-%COMP%]{background:#7F9B84}.footprints[_ngcontent-%COMP%]{height:30px;transform:rotate(90deg)}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}.body[_ngcontent-%COMP%]{font-family:Times New Roman,Times,serif}button[_ngcontent-%COMP%]{position:relative}@keyframes _ngcontent-%COMP%_slidein{0%{transform:translate(-150%)}to{transform:translate(0)}}.slidein[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slidein linear both;animation-timeline:view();animation-range:10% cover 40%}"]})}return e})(),w4=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275cmp=Bi({type:e,selectors:[["wedding-us"]],decls:12,vars:0,consts:[[1,"p-4","heroscroll","bg-color","mt-3","text-center"],[1,"title","fw-bolder","display-3","txtcolor"],["src","assets/photos/us.jpg","alt","",1,"rounded-circle","img-size"],[1,"body","mt-3"],[1,"fs-5","text-justify"],[1,"fs-5"]],template:function(a,u){1&a&&(bt(0,"div",0)(1,"p",1),St(2,"Nosotros"),Lt(),bt(3,"div"),Bn(4,"img",2),Lt(),bt(5,"div",3)(6,"p",4),St(7," Esta es una historia de amor. "),Lt(),bt(8,"p",4),St(9," Una historia de amor, de c\xf3mo dos personas se encontraron, de c\xf3mo se enamoraron y llegaron a compartir una vida juntos. Sab\xedamos que suceder\xeda, pero no sab\xedamos cu\xe1ndo, c\xf3mo o por qu\xe9, as\xed que dejamos que sucediera cuando sucediera, sin expectativas ni suposiciones. "),Lt(),bt(10,"p",5),St(11," Solo podemos decir que nuestra vida en este momento est\xe1 completa y estamos listos para compartir el resto de nuestras vidas juntos. "),Lt()()())},styles:['.img-size[_ngcontent-%COMP%]{height:180px;width:180px}.bg-color[_ngcontent-%COMP%]{max-width:100vw;position:relative}.bg-color[_ngcontent-%COMP%]:before{content:"";opacity:.7;inset:0;position:absolute;z-index:-1;background:rgba(127,155,132,.4);box-shadow:0 4px 30px #0000001a;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}.body[_ngcontent-%COMP%]{font-family:Times New Roman,Times,serif}.txtcolor[_ngcontent-%COMP%]{color:#cdb77c}@keyframes _ngcontent-%COMP%_hero{0%{opacity:0}to{opacity:1}}.heroscroll[_ngcontent-%COMP%]{view-timeline-name:--div2;view-timeline-axis:block;animation-timeline:--div2;animation-name:_ngcontent-%COMP%_hero;animation-range:15% cover 50%;animation-fill-mode:backwards}']})}return e})(),E4=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275cmp=Bi({type:e,selectors:[["weeding-dresscode"]],decls:19,vars:0,consts:[[1,"bg-color","showup","col","p-4","text-justify","text-center"],[1,"display-3","title","fw-bolder","txtcolor"],[1,"display-5","body","pt-2","fs-2","fw-bolder"],[1,"container"],[1,"row","justify-content-evenly"],[1,"col"],["src","assets/photos/suite.png","alt","",1,"imgsize"],[1,"mt-4","body","fs-3"],[1,"mt-4","body","fs-5"],["src","assets/photos/dress.png","alt","",1,"imgsize"]],template:function(a,u){1&a&&(bt(0,"div",0)(1,"p",1),St(2,"Codigo de Vestimenta"),Lt(),bt(3,"h4",2),St(4,"Formal"),Lt(),bt(5,"div",3)(6,"div",4)(7,"div",5),Bn(8,"img",6),bt(9,"p",7),St(10,"Hombres"),Lt(),bt(11,"p",8),St(12,"Traje"),Lt()(),bt(13,"div",5),Bn(14,"img",9),bt(15,"p",7),St(16,"Mujeres"),Lt(),bt(17,"p",8),St(18,"Vestido largo"),Lt()()()()())},styles:['.icon[_ngcontent-%COMP%]{height:85px;width:85px}.bg-color[_ngcontent-%COMP%]{width:100vw;position:relative}.bg-color[_ngcontent-%COMP%]:before{content:"";opacity:.7;inset:0;position:absolute;z-index:-1;background:rgba(127,155,132,.4);box-shadow:0 4px 30px #0000001a;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}.imgsize[_ngcontent-%COMP%]{height:200px;width:250px;border-radius:20px}.circleRed[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:25px;border-style:ridge;border-width:1px;border-color:#505050;background:red}.circleWhite[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:25px;border-style:ridge;border-width:1px;border-color:#505050;background:rgb(255,255,255)}.circleNude[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:25px;border-style:ridge;border-width:1px;border-color:#505050;background:#ebc8b2}.circleTag[_ngcontent-%COMP%]{justify-content:center}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}.body[_ngcontent-%COMP%]{font-family:Times New Roman,Times,serif}.txtcolor[_ngcontent-%COMP%]{color:#cdb77c}@keyframes _ngcontent-%COMP%_show{0%{opacity:0;scale:25%}to{opacity:1;scale:100%}}.showup[_ngcontent-%COMP%]{view-timeline-name:--div;view-timeline-axis:block;animation-timeline:--div;animation-name:_ngcontent-%COMP%_show;animation-range:entry 20% cover 50%;animation-fill-mode:both}@media (max-width: 767px){.imgsize[_ngcontent-%COMP%]{height:60px;width:100px;margin-top:20px;border-radius:20px}}']})}return e})(),C4=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275cmp=Bi({type:e,selectors:[["weeding-gift"]],decls:21,vars:0,consts:[[1,"col","p-4","slidein","text-justify","text-center"],[1,"display-3","title","fw-bolder","txtcolor"],["src","assets/photos/gift.png","alt","",1,"icon"],[1,"fs-3","fw-semibold","body","pt-5"],[1,"row","mt-3","justify-content-evenly"],[1,"col-sm","body"],[1,"fs-5"],[1,"body","col-sm"],[1,"mt-sm-3","display-3","title","fw-bolder","txtcolor"]],template:function(a,u){1&a&&(bt(0,"div",0)(1,"h4",1),St(2,"Regalos"),Lt(),Bn(3,"img",2),bt(4,"p",3),St(5,"El mejor regalo es su presencia en este dia tan especial, pero si gustan dejar un obsequio aqui les dejamos los datos"),Lt(),bt(6,"div",4)(7,"div",5)(8,"h1",1),St(9,"Lluvia de sobres"),Lt(),bt(10,"span",6),St(11,"En la recepcion podran dejar su sobre"),Lt()(),bt(12,"div",7)(13,"h1",8),St(14,"Transferencia"),Lt(),bt(15,"p",6),St(16,"Banco: Banorte"),Lt(),bt(17,"p",6),St(18,"Clabe: 072821012180261870"),Lt(),bt(19,"p",6),St(20,"Nombre: Carlos Daniel Rodriguez Castro"),Lt()()()())},styles:['.icon[_ngcontent-%COMP%]{height:85px;width:85px}.bg-color[_ngcontent-%COMP%]{width:100vw;position:relative}.bg-color[_ngcontent-%COMP%]:before{content:"";opacity:.7;inset:0;position:absolute;z-index:-1;background:rgba(113,143,62,.3);box-shadow:0 4px 30px #0000001a;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}.divider[_ngcontent-%COMP%]{border-left:2.5px solid rgb(26,26,26);height:45px;width:3px;position:absolute;left:50%;margin-left:-3px;margin-top:-12px}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}.body[_ngcontent-%COMP%]{font-family:Times New Roman,Times,serif}.txtcolor[_ngcontent-%COMP%]{color:#cdb77c}@keyframes _ngcontent-%COMP%_slidein{0%{transform:translate(-150%)}to{transform:translate(0)}}.slidein[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slidein linear both;animation-timeline:view();animation-range:0% cover 40%}']})}return e})();function D4(e,r){if(1&e&&(bt(0,"h1",8),St(1),Lt()),2&e){const i=xv();Eo(1),Ci(" Invitaci\xf3n para: ",i.invitados.length," personas ")}}function T4(e,r){if(1&e&&(bt(0,"h1",9),St(1),Lt()),2&e){const i=r.$implicit;Eo(1),Ar(i)}}function M4(e,r){if(1&e&&(bt(0,"h1",8),St(1),Lt()),2&e){const i=xv();Eo(1),Ci(" Invitaci\xf3n para: ",i.invitados.length," persona ")}}let I4=(()=>{class e{constructor(i){this.route=i,this.param="",this.json="",this.invitados=[],this.param=this.route.snapshot.queryParamMap.get("ID"),L2.filter(u=>u.ID===this.param).forEach(u=>{this.invitados=u.Invitados})}static#e=this.\u0275fac=function(a){return new(a||e)(Pt(Bh))};static#t=this.\u0275cmp=Bi({type:e,selectors:[["wedding-confirmation"]],decls:15,vars:3,consts:[[1,"col","p-4","heroscroll","text-justify","text-center"],[1,"title","fw-bolder","display-3","txtcolor"],["class","body fw-bold fs-2",4,"ngIf","ngIfElse"],["class","body fs-4",4,"ngFor","ngForOf"],[1,"body","fs-6","fw-bolder"],["src","assets/photos/confirmation.png","alt","",1,"icon"],["type","button","onclick","location.href='https://api.whatsapp.com/send?phone=528671138572'",1,"body","mt-4","btn","fw-bolder","btncolor","btn-lg","text-light"],["invitado",""],[1,"body","fw-bold","fs-2"],[1,"body","fs-4"]],template:function(a,u){if(1&a&&(bt(0,"div",0)(1,"h4",1),St(2,"Confirma tu asistencia"),Lt(),Co(3,D4,2,1,"h1",2),Co(4,T4,2,1,"h1",3),bt(5,"h1",4),St(6,"Favor de confirmar antes del 15 de Mayo"),Lt(),Bn(7,"br")(8,"img",5),bt(9,"div"),Bn(10,"br"),bt(11,"button",6),St(12," Whatsapp "),Lt()()(),Co(13,M4,2,1,"ng-template",null,7,SM)),2&a){const _=function vs(e){return function Xo(e,r){return e[r]}(function V_(){return _n.lFrame.contextLView}(),li+e)}(14);Eo(3),Za("ngIf",u.invitados.length>1)("ngIfElse",_),Eo(1),Za("ngForOf",u.invitados)}},dependencies:[$I,GC],styles:[".icon[_ngcontent-%COMP%]{height:85px;width:85px}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}.body[_ngcontent-%COMP%]{font-family:Times New Roman,Times,serif}.txtcolor[_ngcontent-%COMP%]{color:#cdb77c}.btncolor[_ngcontent-%COMP%]{background:#7F9B84}@keyframes _ngcontent-%COMP%_hero{0%{opacity:0}to{opacity:1}}.heroscroll[_ngcontent-%COMP%]{view-timeline-name:--div2;view-timeline-axis:block;animation-timeline:--div2;animation-name:_ngcontent-%COMP%_hero;animation-range:10% cover 30%;animation-fill-mode:backwards}"]})}return e})(),S4=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275cmp=Bi({type:e,selectors:[["wedding-intinerario"]],decls:39,vars:0,consts:[[1,"timeline-section"],[1,""],[1,"fadeinscroll","justify-content-center","title","d-flex","fw-bold","display-3","txtcolor"],[1,"quidditchdiv"],["src","assets/photos/quidditch.png","alt","",1,"fadeinscroll","quidditch"],[1,"timeline-items"],[1,"showup","timeline-item"],[1,"timeline-dot"],[1,"body","fs-3","fw-bolder","timeline-date"],[1,"timeline-content"],[1,"title","fw-bolder"],["src","assets/photos/iglesia.png","alt",""],["src","assets/photos/copas.png","alt",""],["src","assets/photos/cena.png","alt",""],["src","assets/photos/carro.png","alt",""]],template:function(a,u){1&a&&(bt(0,"section",0)(1,"div",1)(2,"h1",2),St(3,"Itinerario"),Lt(),bt(4,"div",3),Bn(5,"img",4),Lt(),bt(6,"div",5)(7,"div",6),Bn(8,"div",7),bt(9,"div",8),St(10,"5:00 PM"),Lt(),bt(11,"div",9)(12,"h1",10),St(13,"Ceremonia Religiosa"),Lt(),Bn(14,"img",11),Lt()(),bt(15,"div",6),Bn(16,"div",7),bt(17,"div",8),St(18,"7:30 PM"),Lt(),bt(19,"div",9)(20,"h1",10),St(21,"Apertura de Recepcion"),Lt(),Bn(22,"img",12),Lt()(),bt(23,"div",6),Bn(24,"div",7),bt(25,"div",8),St(26,"9:00 PM"),Lt(),bt(27,"div",9)(28,"h1",10),St(29,"Cena"),Lt(),Bn(30,"img",13),Lt()(),bt(31,"div",6),Bn(32,"div",7),bt(33,"div",8),St(34,"01:00 AM"),Lt(),bt(35,"div",9)(36,"h1",10),St(37,"Cierre de Recepcion"),Lt(),Bn(38,"img",14),Lt()()()()())},styles:['*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box}.bg-color[_ngcontent-%COMP%]{width:100vw;position:relative}.bg-color[_ngcontent-%COMP%]:before{content:"";opacity:.7;inset:0;position:absolute;z-index:-1;background:rgba(113,143,62,.3);box-shadow:0 4px 30px #0000001a;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}.txtcolor[_ngcontent-%COMP%]{color:#cdb77c}.quidditchdiv[_ngcontent-%COMP%]{display:flex;justify-content:center}.quidditch[_ngcontent-%COMP%]{height:100px}.timeline-section[_ngcontent-%COMP%]{min-height:100vh;padding:20px 15px}.timeline-items[_ngcontent-%COMP%]{max-width:1000px;margin:auto;display:flex;flex-wrap:wrap;position:relative}.timeline-items[_ngcontent-%COMP%]:before{content:"";position:absolute;height:100%;background-color:#2f363e;left:calc(50% - 1px)}.timeline-item[_ngcontent-%COMP%]{background:url(https://carlosrdzcas.github.io/MyWedding/assets/photos/footprints90.png) no-repeat;background-position:center;background-size:55px;margin-bottom:15px;width:100%;position:relative}.timeline-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}.timeline-item[_ngcontent-%COMP%]:nth-child(odd){padding-right:calc(50% + 30px);text-align:right}.timeline-item[_ngcontent-%COMP%]:nth-child(2n){padding-left:calc(50% + 30px)}.timeline-dot[_ngcontent-%COMP%]{height:16px;width:16px;position:absolute;left:calc(50% - 8px);border-radius:50%;top:10px}.timeline-date[_ngcontent-%COMP%]{font-size:18px;color:#cdb77c;font-weight:bolder;margin:6px 0 15px}.timeline-content[_ngcontent-%COMP%]{padding:5px;border-radius:5px}.timeline-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:20px;color:#000;margin:0 0 10px;text-transform:capitalize;font-weight:500}.timeline-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:70px}@media (max-width: 767px){.esquina[_ngcontent-%COMP%]{position:absolute;left:0;height:100px;transform:rotate(90deg)}.esquina2[_ngcontent-%COMP%]{position:absolute;right:0;margin-top:10px;height:100px;transform:rotate(180deg)}.timeline-item[_ngcontent-%COMP%]{background:url(https://carlosrdzcas.github.io/MyWedding/assets/photos/footprints90.png) no-repeat;background-position:left;background-size:55px;margin-bottom:15px;width:100%;position:relative}.quidditchdiv[_ngcontent-%COMP%]{display:flex;justify-content:center;left:0}.timeline-items[_ngcontent-%COMP%]:before{left:7px}.timeline-item[_ngcontent-%COMP%]:nth-child(odd){padding-right:0;text-align:left}.timeline-item[_ngcontent-%COMP%]:nth-child(odd), .timeline-item[_ngcontent-%COMP%]:nth-child(2n){padding-left:50px}.timeline-dot[_ngcontent-%COMP%]{left:0}}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}.body[_ngcontent-%COMP%]{font-family:Times New Roman,Times,serif}@keyframes _ngcontent-%COMP%_fadein{0%{opacity:0}80%,to{opacity:1}}.fadeinscroll[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadein linear;animation-timeline:view()}@keyframes _ngcontent-%COMP%_show{0%{opacity:0;scale:25%}to{opacity:1;scale:100%}}.showup[_ngcontent-%COMP%]{view-timeline-name:--div;view-timeline-axis:block;animation-timeline:--div;animation-name:_ngcontent-%COMP%_show;animation-range:entry 25% cover 60%;animation-fill-mode:both}']})}return e})();function A4(e,r){1&e&&(bt(0,"div",1),Bn(1,"wedding-our-photo")(2,"wedding-invitacion",2)(3,"wedding-us")(4,"wedding-lugares")(5,"wedding-intinerario")(6,"wedding-fab")(7,"weeding-dresscode")(8,"weeding-gift")(9,"wedding-confirmation"),Lt())}const R4=[{path:"envelope",component:m4},{path:"invitation",component:(()=>{class e{constructor(i){this.route=i,this.param="",this.json="",this.invitados=[],this.existe="",this.isLoading=!0,this.param=this.route.snapshot.queryParamMap.get("ID"),L2.filter(u=>u.ID===this.param).forEach(u=>{this.existe=u.ID})}ngAfterViewInit(){this.isLoading=!1}static#e=this.\u0275fac=function(a){return new(a||e)(Pt(Bh))};static#t=this.\u0275cmp=Bi({type:e,selectors:[["page-invitation"]],decls:1,vars:1,consts:[["class","parallax",4,"ngIf"],[1,"parallax"],[1,"animate__animated","animate__fadeIn","animate__delay-1s"]],template:function(a,u){1&a&&Co(0,A4,10,0,"div",0),2&a&&Za("ngIf",!1===u.isLoading&&""!=u.existe)},dependencies:[GC,g4,_4,y4,b4,w4,E4,C4,I4,S4],styles:['[_nghost-%COMP%]{display:block}.parallax[_ngcontent-%COMP%]{width:100vw;min-height:500px;position:relative}.parallax[_ngcontent-%COMP%]:before{content:"";background:url(/assets/photos/marauders.jpg);background-attachment:fixed;background-position:center;background-repeat:no-repeat;background-size:cover;opacity:.2;inset:0;position:absolute;z-index:-1}']})}return e})()},{path:"**",redirectTo:"envelope"}];let P4=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275mod=br({type:e});static#n=this.\u0275inj=rr({imports:[JD.forRoot(R4),JD]})}return e})(),O4=(()=>{class e{static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275mod=br({type:e,bootstrap:[d4]});static#n=this.\u0275inj=rr({imports:[MF,P4,f4,SA]})}return e})();DF().bootstrapModule(O4).catch(e=>console.error(e))},574:function(I_){I_.exports=function(){"use strict";var Uh,$h,bi;function Df(d,Zt){if(Uh)if($h){var is="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Uh+")(sharedChunk); ("+$h+")(sharedChunk); self.onerror = null;",fn={};Uh(fn),bi=Zt(fn),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(bi.workerUrl=window.URL.createObjectURL(new Blob([is],{type:"text/javascript"})))}else $h=Zt;else Uh=Zt}return Df(0,function(d){var Zt="3.3.0";let is;const fn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==is){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{is=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch{is=n}}return is},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!fn.API_URL)return null;try{const n=new URL(fn.API_URL);return"api.mapbox.cn"===n.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===n.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function Ea(n){return fn.API_URL_REGEX.test(n)}function bn(n){return 0===n.indexOf("mapbox:")}function ao(n){return fn.API_CDN_URL_REGEX.test(n)}function bs(n){return fn.API_SPRITE_REGEX.test(n)}function rs(n){return fn.API_STYLE_REGEX.test(n)&&!bs(n)}const Al={create:"create",load:"load",fullLoad:"fullLoad"};function Gh(n){const t=n.name.split("?")[0];return ao(t)&&t.includes("mapbox-gl.js")?"javascript":ao(t)&&t.includes("mapbox-gl.css")?"css":fn.API_FONTS_REGEX.test(t)?"fontRange":bs(t)?"sprite":rs(t)?"style":fn.API_TILEJSON_REGEX.test(t)?"tilejson":"other"}function $o(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Xa=Go;function Go(n,t,o,l){this.cx=3*n,this.bx=3*(o-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=o,this.p2y=l}Go.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(void 0===t&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var o=n,l=0;l<8;l++){var h=this.sampleCurveX(o)-n;if(Math.abs(h)<t)return o;var f=this.sampleCurveDerivativeX(o);if(Math.abs(f)<1e-6)break;o-=h/f}var g=0,v=1;for(o=n,l=0;l<20&&(h=this.sampleCurveX(o),!(Math.abs(h-n)<t));l++)n>h?g=o:v=o,o=.5*(v-g)+g;return o},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var ws=$o(Xa),Ka=Es;function Es(n,t){this.x=n,this.y=t}Es.prototype={clone:function(){return new Es(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,o=n.y-this.y;return t*t+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),o=Math.sin(n),l=o*this.x+t*this.y;return this.x=t*this.x-o*this.y,this.y=l,this},_rotateAround:function(n,t){var o=Math.cos(n),l=Math.sin(n),h=t.y+l*(this.x-t.x)+o*(this.y-t.y);return this.x=t.x+o*(this.x-t.x)-l*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Es.convert=function(n){return n instanceof Es?n:Array.isArray(n)?new Es(n[0],n[1]):n};var ht=$o(Ka);const Ca=Math.PI/180,gu=180/Math.PI;function Cn(n){return n*Ca}function Er(n){return n*gu}const Hh=[[0,0],[1,0],[1,1],[0,1]];function _t(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,o=t*n;return 4*(n<.5?o:3*(n-t)+o-.75)}function Cs(n,t,o,l){const h=new ws(n,t,o,l);return function(f){return h.solve(f)}}const qr=Cs(.25,.1,.25,1);function on(n,t,o){return Math.min(o,Math.max(t,n))}function xc(n,t,o){return(o=on((o-n)/(t-n),0,1))*o*(3-2*o)}function Da(n,t,o){const l=o-t,h=((n-t)%l+l)%l+t;return h===t?o:h}function Di(n,t,o){if(!n.length)return o(null,[]);let l=n.length;const h=new Array(n.length);let f=null;n.forEach((g,v)=>{t(g,(w,E)=>{w&&(f=w),h[v]=E,0==--l&&o(f,h)})})}function Vr(n,...t){for(const o of t)for(const l in o)n[l]=o[l];return n}let Rl=1;function bc(){return Rl++}function _u(){return function n(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function Ti(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function wc(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Ja(n,t){n.forEach(o=>{t[o]&&(t[o]=t[o].bind(t))})}function Fi(n,t){return-1!==n.indexOf(t,n.length-t.length)}function si(n,t,o){const l={};for(const h in n)l[h]=t.call(o||this,n[h],h,n);return l}function os(n,t,o){const l={};for(const h in n)t.call(o||this,n[h],h,n)&&(l[h]=n[h]);return l}function ti(n){return Array.isArray(n)?n.map(ti):"object"==typeof n&&n?si(n,ti):n}const Ec={};function tr(n){Ec[n]||(typeof console<"u"&&console.warn(n),Ec[n]=!0)}function Io(n,t,o){return(o.y-n.y)*(t.x-n.x)>(t.y-n.y)*(o.x-n.x)}function Pl(n){let t=0;for(let o,l,h=0,f=n.length,g=f-1;h<f;g=h++)o=n[h],l=n[g],t+=(l.x-o.x)*(o.y+l.y);return t}function Ta([n,t,o]){const l=Cn(t+90),h=Cn(o);return{x:n*Math.cos(l)*Math.sin(h),y:n*Math.sin(l)*Math.sin(h),z:n*Math.cos(h),azimuthal:t,polar:o}}function Xs(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Cc(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,l,h,f)=>{const g=h||f;return t[l]=!g||g.toLowerCase(),""}),t["max-age"]){const o=parseInt(t["max-age"],10);isNaN(o)?delete t["max-age"]:t["max-age"]=o}return t}let fr,yu,vu,ss,Ks,Qa,Ue=null;function te(n){try{const t=self[n];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function le(n,t){return[n[4*t],n[4*t+1],n[4*t+2],n[4*t+3]]}function _e(n,t,o,l){for(;t<o;){const h=t+o>>1;n[h]<l?t=h+1:o=h}return t}function Fe(n,t,o,l){for(;t<o;){const h=t+o>>1;n[h]<=l?t=h+1:o=h}return t}function $e(){return null==fr&&(fr=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),fr}const Xe={now:()=>void 0!==ss?ss:performance.now(),setNow(n){ss=n},restoreNow(){ss=void 0},frame(n){const t=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(n,t=0){const{width:o,height:l}=n;Ks||(Ks=document.createElement("canvas"));const h=Ks.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(o>Ks.width||l>Ks.height)&&(Ks.width=o,Ks.height=l),h.clearRect(-t,-t,o+2*t,l+2*t),h.drawImage(n,0,0,o,l),h.getImageData(-t,-t,o+2*t,l+2*t)},resolveURL:n=>(yu||(yu=document.createElement("a")),yu.href=n,yu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==vu&&(vu=window.matchMedia("(prefers-reduced-motion: reduce)")),vu.matches)},hasCanvasFingerprintNoise(){if(void 0!==Qa)return Qa;if(!$e())return Qa=!1,!1;const n=new OffscreenCanvas(85,1),t=n.getContext("2d",{willReadFrequently:!0});let o=0;for(let h=0;h<n.width;++h)t.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,t.fillRect(h,0,1,1);const l=t.getImageData(0,0,n.width,n.height);o=0;for(let h=0;h<l.data.length;++h)if(h%4!=3&&o++!==l.data[h])return Qa=!0,!0;return Qa=!1,!1}},wt="mapbox-tiles";let Et,kt,Ne=500,Rt=50;function pn(){try{return caches}catch{}}function di(){const n=pn();n&&!Et&&(Et=n.open(wt))}function Pi(n){const t=n.indexOf("?");if(t<0)return n;const o=["language","worldview"],l=new URLSearchParams,h=new URLSearchParams(n.slice(t));for(const f of o){const g=h.get(f);g&&l.set(f,g)}return`${n.slice(0,t)}?${l.toString()}`}function fi(n,t){const o=n.indexOf("?");if(o<0)return`${n}?${new URLSearchParams(t).toString()}`;const l=new URLSearchParams(n.slice(o));for(const h in t)l.set(h,t[h]);return`${n.slice(0,o)}?${l.toString()}`}let Qn=1/0;const Wn={supported:!1,testSupport:function(n){!Cr&&Si&&(Oi?Wr(n):ai=n)}};let ai,Si,Cr=!1,Oi=!1;const Zr=typeof self<"u"?self:{};function Wr(n){const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Si),n.isContextLost())return;Wn.supported=!0}catch{}n.deleteTexture(t),Cr=!0}Zr.document&&(Si=Zr.document.createElement("img"),Si.onload=function(){ai&&Wr(ai),ai=null,Oi=!0},Si.onerror=function(){Cr=!0,ai=null},Si.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const mo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(mo);class cr extends Error{constructor(t,o,l){401===o&&Ea(l)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=o,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const lr=Xs()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Le=function(n,t){if(!(/^file:/.test(o=n.url)||/^file:/.test(lr())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(l,h){const f=new AbortController,g=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:lr(),referrerPolicy:l.referrerPolicy,signal:f.signal});let v=!1,w=!1;const E=(D=g.url).indexOf("sku=")>0&&Ea(D);var D;"json"===l.type&&g.headers.set("Accept","application/json");const I=(L,N,B)=>{if(w)return;if(L&&"SecurityError"!==L.message&&tr(L.toString()),N&&B)return P(N);const U=Date.now();fetch(g).then(H=>{if(H.ok){const Q=E?H.clone():null;return P(H,Q,U)}return h(new cr(H.statusText,H.status,l.url))}).catch(H=>{"AbortError"!==H.name&&h(new Error(`${H.message} ${l.url}`))})},P=(L,N,B)=>{("arrayBuffer"===l.type?L.arrayBuffer():"json"===l.type?L.json():L.text()).then(U=>{w||(N&&B&&function(H,Q,ne){if(di(),!Et)return;const ie=Cc(Q.headers.get("Cache-Control")||"");if(ie["no-store"])return;const ue={status:Q.status,statusText:Q.statusText,headers:new Headers};Q.headers.forEach((ye,be)=>ue.headers.set(be,ye)),ie["max-age"]&&ue.headers.set("Expires",new Date(ne+1e3*ie["max-age"]).toUTCString());const ae=ue.headers.get("Expires");if(!ae||new Date(ae).getTime()-ne<42e4)return;let de=Pi(H.url);if(206===Q.status){const ye=H.headers.get("Range");if(!ye)return;ue.status=200,de=fi(de,{range:ye})}!function(ye,be){if(void 0===kt)try{new Response(new ReadableStream),kt=!0}catch{kt=!1}kt?be(ye.body):ye.blob().then(be)}(Q,ye=>{const be=new Response(ye,ue);di(),Et&&Et.then(Te=>Te.put(de,be)).catch(Te=>tr(Te.message))})}(g,N,B),v=!0,h(null,U,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(U=>{w||h(new Error(U.message))})};return E?function(L,N){if(di(),!Et)return N(null);Et.then(B=>{let U=Pi(L.url);const H=L.headers.get("Range");H&&(U=fi(U,{range:H})),B.match(U).then(Q=>{const ne=function(ie){if(!ie)return!1;const ue=new Date(ie.headers.get("Expires")||0),ae=Cc(ie.headers.get("Cache-Control")||"");return ue>Date.now()&&!ae["no-cache"]}(Q);B.delete(U),ne&&B.put(U,Q.clone()),N(null,Q,ne)}).catch(N)}).catch(N)}(g,I):I(null,null),{cancel:()=>{w=!0,v||f.abort()}}}(n,t);if(Xs()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,t,void 0,!0)}var o;return function(l,h){const f=new XMLHttpRequest;f.open(l.method||"GET",l.url,!0),"arrayBuffer"===l.type&&(f.responseType="arraybuffer");for(const g in l.headers)f.setRequestHeader(g,l.headers[g]);return"json"===l.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===l.credentials,f.onerror=()=>{h(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let g=f.response;if("json"===l.type)try{g=JSON.parse(f.response)}catch(v){return h(v)}h(null,g,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else h(new cr(f.statusText,f.status,l.url))},f.send(l.body),{cancel:()=>f.abort()}}(n,t)},ze=function(n,t){return Le(Vr(n,{type:"arrayBuffer"}),t)};function Ke(n){const t=document.createElement("a");return t.href=n,t.protocol===location.protocol&&t.host===location.host}const ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let it,tt;it=[],tt=0;const mt=function(n,t){if(Wn.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),tt>=fn.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:n,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return it.push(f),f}tt++;let o=!1;const l=()=>{if(!o)for(o=!0,tt--;it.length&&tt<fn.MAX_PARALLEL_IMAGE_REQUESTS;){const f=it.shift(),{requestParameters:g,callback:v,cancelled:w}=f;w||(f.cancel=mt(g,v).cancel)}},h=ze(n,(f,g,v,w)=>{l(),f?t(f):g&&(self.createImageBitmap?function(E,D){const I=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(I).then(P=>{D(null,P)}).catch(P=>{D(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(E,D)=>t(E,D,v,w)):function(E,D){const I=new Image;I.onload=()=>{D(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=ot})},I.onerror=()=>D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(E)],{type:"image/png"});I.src=E.byteLength?URL.createObjectURL(P):ot}(g,(E,D)=>t(E,D,v,w)))});return{cancel:()=>{h.cancel(),l()}}},st="01",vt="NO_ACCESS_TOKEN",ct=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Wt(n){const t=n.match(ct);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function An(n){const t=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${t}`}const Nt="mapbox.eventData";function Hn(n){if(!n)return null;const t=n.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(atob(t[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ni{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const o=Hn(fn.ACCESS_TOKEN);let l="";return l=o&&o.u?btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(h,f)=>String.fromCharCode(+("0x"+f)))):fn.ACCESS_TOKEN||"",t?`${Nt}.${t}:${l}`:`${Nt}:${l}`}fetchEventData(){const t=te("localStorage"),o=this.getStorageKey(),l=this.getStorageKey("uuid");if(t)try{const h=localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));const f=localStorage.getItem(l);f&&(this.anonId=f)}catch{tr("Unable to read from LocalStorage")}}saveEventData(){const t=te("localStorage"),o=this.getStorageKey(),l=this.getStorageKey("uuid"),h=this.anonId;if(t&&h)try{localStorage.setItem(l,h),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{tr("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,o,l,h){if(!fn.EVENTS_URL)return;const f=Wt(fn.EVENTS_URL);f.params.push(`access_token=${h||fn.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(t).toISOString()},v=o?Vr(g,o):g,w={url:An(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};var D;this.pendingRequest=(D=E=>{this.pendingRequest=null,l(E),this.saveEventData(),this.processRequests(h)},Le(Vr(w,{method:"POST"}),D))}queueRequest(t,o){this.queue.push(t),this.processRequests(o)}}const Un=new class extends Ni{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,t){fn.EVENTS_URL&&fn.ACCESS_TOKEN&&Array.isArray(n)&&n.some(o=>bn(o)||Ea(o))&&this.queueRequest(Date.now(),t)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Hn(fn.ACCESS_TOKEN),o=t?t.u:fn.ACCESS_TOKEN;let l=o!==this.eventData.tokenU;wc(this.anonId)||(this.anonId=_u(),l=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),g=new Date(h),v=(h-this.eventData.lastSuccess)/864e5;l=l||v>=1||v<-1||f.getDate()!==g.getDate()}else l=!0;l?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Zt,skuId:st,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=h,this.eventData.tokenU=o)},n):this.processRequests()}},qi=Un.postTurnstileEvent.bind(Un),Zi=new class extends Ni{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,t,o,l){this.skuToken=t,this.errorCb=l,fn.EVENTS_URL&&(o||fn.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},o):this.errorCb(new Error(vt)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),wc(this.anonId)||(this.anonId=_u()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Zt,skuId:st,skuToken:this.skuToken,userId:this.anonId},l=>{l?this.errorCb(l):t&&(this.success[t]=!0)},n))}remove(){this.errorCb=null}},Yn=Zi.postMapLoadEvent.bind(Zi),Ho=new class extends Ni{constructor(){super("gljs.performance")}postPerformanceEvent(n,t){fn.EVENTS_URL&&(n||fn.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},n)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,performanceData:o}=this.queue.shift(),l=function(h){const f=performance.getEntriesByType("resource"),g=performance.getEntriesByType("mark"),v=function(L){const N={};if(L)for(const B in L)if("other"!==B)for(const U of L[B]){const H=`${B}ResolveRangeMin`,Q=`${B}ResolveRangeMax`,ne=`${B}RequestCount`,ie=`${B}RequestCachedCount`;N[H]=Math.min(N[H]||1/0,U.startTime),N[Q]=Math.max(N[Q]||-1/0,U.responseEnd);const ue=ae=>{void 0===N[ae]&&(N[ae]=0),++N[ae]};void 0!==U.transferSize&&0===U.transferSize&&ue(ie),ue(ne)}return N}(function(L,N){const B={};if(L)for(const U of L){const H=N(U);void 0===B[H]&&(B[H]=[]),B[H].push(U)}return B}(f,Gh)),w=window.devicePixelRatio,E=navigator.connection||navigator.mozConnection||navigator.webkitConnection,D=E?E.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},P=(L,N,B)=>{null!=B&&L.push({name:N,value:B.toString()})};for(const L in v)P(I.counters,L,v[L]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(P(I.counters,"interactionRangeMin",h.interactionRange[0]),P(I.counters,"interactionRangeMax",h.interactionRange[1])),g)for(const L of Object.keys(Al)){const N=Al[L],B=g.find(U=>U.name===N);B&&P(I.counters,N,B.startTime)}return P(I.counters,"visibilityHidden",h.visibilityHidden),P(I.attributes,"style",function(L){if(L)for(const N of L){const B=N.name.split("?")[0];if(rs(B)){const U=B.split("/").slice(-2);if(2===U.length)return`mapbox://styles/${U[0]}/${U[1]}`}}}(f)),P(I.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),P(I.attributes,"fogEnabled",h.fogEnabled?"true":"false"),P(I.attributes,"projection",h.projection),P(I.attributes,"zoom",h.zoom),P(I.metadata,"devicePixelRatio",w),P(I.metadata,"connectionEffectiveType",D),P(I.metadata,"navigatorUserAgent",navigator.userAgent),P(I.metadata,"screenWidth",window.screen.width),P(I.metadata,"screenHeight",window.screen.height),P(I.metadata,"windowWidth",window.innerWidth),P(I.metadata,"windowHeight",window.innerHeight),P(I.metadata,"mapWidth",h.width/w),P(I.metadata,"mapHeight",h.height/w),P(I.metadata,"webglRenderer",h.renderer),P(I.metadata,"webglVendor",h.vendor),P(I.metadata,"sdkVersion",Zt),P(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(o);for(const h of l.metadata);for(const h of l.counters);for(const h of l.attributes);this.postEvent(t,l,()=>{},n)}},as=Ho.postPerformanceEvent.bind(Ho),Dr=new class extends Ni{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,t,o,l){if(!fn.API_URL||!fn.SESSION_PATH)return;const h=Wt(fn.API_URL+fn.SESSION_PATH);h.params.push(`sku=${t||""}`),h.params.push(`access_token=${l||fn.ACCESS_TOKEN||""}`);const f={url:An(h),headers:{"Content-Type":"text/plain"}};var v;this.pendingRequest=(v=g=>{this.pendingRequest=null,o(g),this.saveEventData(),this.processRequests(l)},Le(Vr(f,{method:"GET"}),v))}getSessionAPI(n,t,o,l){this.skuToken=t,this.errorCb=l,fn.SESSION_PATH&&fn.API_URL&&(o||fn.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},o):this.errorCb(new Error(vt)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||this.getSession(o,this.skuToken,l=>{l?this.errorCb(l):t&&(this.success[t]=!0)},n)}remove(){this.errorCb=null}},xu=Dr.getSessionAPI.bind(Dr),ls=new Set;function Dc(n,t,o){o[n]&&-1!==o[n].indexOf(t)||(o[n]=o[n]||[],o[n].push(t))}function qh(n,t,o){if(o&&o[n]){const l=o[n].indexOf(t);-1!==l&&o[n].splice(l,1)}}class el{constructor(t,o={}){Vr(this,o),this.type=t}}class Tf extends el{constructor(t,o={}){super("error",Vr({error:t},o))}}class Tc{on(t,o){return this._listeners=this._listeners||{},Dc(t,o,this._listeners),this}off(t,o){return qh(t,o,this._listeners),qh(t,o,this._oneTimeListeners),this}once(t,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Dc(t,o,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,o){"string"==typeof t&&(t=new el(t,o||{}));const l=t.type;if(this.listens(l)){t.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const v of h)v.call(this,t);const f=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const v of f)qh(l,v,this._oneTimeListeners),v.call(this,t);const g=this._eventedParent;g&&(Vr(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof Tf&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,o){return this._eventedParent=t,this._eventedParentData=o,this}}d.y=void 0;var gm={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Zh(n){return(n=Math.round(n))<0?0:n>255?255:n}function Wh(n){return Zh("%"===n[n.length-1]?parseFloat(n)/100*255:parseInt(n))}function Yh(n){return(t="%"===n[n.length-1]?parseFloat(n)/100:parseFloat(n))<0?0:t>1?1:t;var t}function Mf(n,t,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?n+(t-n)*o*6:2*o<1?t:3*o<2?n+(t-n)*(2/3-o)*6:n}try{d.y={}.parseCSSColor=function(n){var t,o=n.replace(/ /g,"").toLowerCase();if(o in gm)return gm[o].slice();if("#"===o[0])return 4===o.length?(t=parseInt(o.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===o.length&&(t=parseInt(o.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=o.indexOf("("),h=o.indexOf(")");if(-1!==l&&h+1===o.length){var f=o.substr(0,l),g=o.substr(l+1,h-(l+1)).split(","),v=1;switch(f){case"rgba":if(4!==g.length)return null;v=Yh(g.pop());case"rgb":return 3!==g.length?null:[Wh(g[0]),Wh(g[1]),Wh(g[2]),v];case"hsla":if(4!==g.length)return null;v=Yh(g.pop());case"hsl":if(3!==g.length)return null;var w=(parseFloat(g[0])%360+360)%360/360,E=Yh(g[1]),D=Yh(g[2]),I=D<=.5?D*(E+1):D+E-D*E,P=2*D-I;return[Zh(255*Mf(P,I,w+1/3)),Zh(255*Mf(P,I,w)),Zh(255*Mf(P,I,w-1/3)),v];default:return null}}return null}}catch{}class ki{constructor(t,o,l,h=1){this.r=t,this.g=o,this.b=l,this.a=h}static parse(t){if(!t)return;if(t instanceof ki)return t;if("string"!=typeof t)return;const o=d.y(t);return o?new ki(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[t,o,l,h]=this.toArray();return`rgba(${Math.round(t)},${Math.round(o)},${Math.round(l)},${h})`}toArray(){const{r:t,g:o,b:l,a:h}=this;return 0===h?[0,0,0,0]:[255*t/h,255*o/h,255*l/h,h]}toArray01(){const{r:t,g:o,b:l,a:h}=this;return 0===h?[0,0,0,0]:[t/h,o/h,l/h,h]}toArray01Scaled(t){const{r:o,g:l,b:h,a:f}=this;return 0===f?[0,0,0]:[o/f*t,l/f*t,h/f*t]}toArray01PremultipliedAlpha(){const{r:t,g:o,b:l,a:h}=this;return[t,o,l,h]}toArray01Linear(){const{r:t,g:o,b:l,a:h}=this;return 0===h?[0,0,0,0]:[Math.pow(t/h,2.2),Math.pow(o/h,2.2),Math.pow(l/h,2.2),h]}}ki.black=new ki(0,0,0,1),ki.white=new ki(1,1,1,1),ki.transparent=new ki(0,0,0,0),ki.red=new ki(1,0,0,1),ki.blue=new ki(0,0,1,1);var ir=ki;function rn(n,t,o){return n*(1-o)+t*o}function Sn(n,t,o){return n.map((l,h)=>rn(l,t[h],o))}var bu=Object.freeze({__proto__:null,array:Sn,color:function(n,t,o){return new ir(rn(n.r,t.r,o),rn(n.g,t.g,o),rn(n.b,t.b,o),rn(n.a,t.a,o))},number:rn});function wu(n,...t){for(const o of t)for(const l in o)n[l]=o[l];return n}class Js extends Error{constructor(t,o){super(o),this.message=o,this.key=t}}var Ds=Js;class If{constructor(t,o=[]){this.parent=t,this.bindings={};for(const[l,h]of o)this.bindings[l]=h}concat(t){return new If(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var zi=If;const Ma={kind:"null"},at={kind:"number"},$n={kind:"string"},Xn={kind:"boolean"},So={kind:"color"},wn={kind:"object"},On={kind:"value"},Mc={kind:"collator"},Eu={kind:"formatted"},Ic={kind:"resolvedImage"};function xt(n,t){return{kind:"array",itemType:n,N:t}}function Wi(n){if("array"===n.kind){const t=Wi(n.itemType);return"number"==typeof n.N?`array<${t}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${t}>`}return n.kind}const rt=[Ma,at,$n,Xn,So,Eu,wn,xt(On),Ic];function pi(n,t){if("error"===t.kind)return null;if("array"===n.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!pi(n.itemType,t.itemType))&&("number"!=typeof n.N||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if("value"===n.kind)for(const o of rt)if(!pi(o,t))return null}return`Expected ${Wi(n)} but found ${Wi(t)} instead.`}function Qt(n,t){return t.some(o=>o.kind===n.kind)}function Ol(n,t){return t.some(o=>"null"===o?null===n:"array"===o?Array.isArray(n):"object"===o?n&&!Array.isArray(n)&&"object"==typeof n:o===typeof n)}class mn{constructor(t,o,l){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,o){return this.collator.compare(t,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class tl{constructor(t,o,l,h,f){this.text=t.normalize?t.normalize():t,this.image=o,this.scale=l,this.fontStack=h,this.textColor=f}}class Li{constructor(t){this.sections=t}static fromString(t){return new Li([new tl(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.namePrimary.length)}static factory(t){return t instanceof Li?t:Li.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const o of this.sections){if(o.image){t.push(["image",o.image.namePrimary]);continue}t.push(o.text);const l={};o.fontStack&&(l["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(l["font-scale"]=o.scale),o.textColor&&(l["text-color"]=["rgba"].concat(o.textColor.toArray())),t.push(l)}return t}}class Ut{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,o){return t?new Ut({namePrimary:t,nameSecondary:o,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function _m(n,t,o,l){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof o&&o>=0&&o<=255?void 0===l||"number"==typeof l&&l>=0&&l<=1?null:`Invalid rgba value [${[n,t,o,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof l?[n,t,o,l]:[n,t,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Sc(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof ir||n instanceof mn||n instanceof Li||n instanceof Ut)return!0;if(Array.isArray(n)){for(const t of n)if(!Sc(t))return!1;return!0}if("object"==typeof n){for(const t in n)if(!Sc(n[t]))return!1;return!0}return!1}function Ui(n){if(null===n)return Ma;if("string"==typeof n)return $n;if("boolean"==typeof n)return Xn;if("number"==typeof n)return at;if(n instanceof ir)return So;if(n instanceof mn)return Mc;if(n instanceof Li)return Eu;if(n instanceof Ut)return Ic;if(Array.isArray(n)){const t=n.length;let o;for(const l of n){const h=Ui(l);if(o){if(o===h)continue;o=On;break}o=h}return xt(o||On,t)}return wn}function Ts(n){const t=typeof n;return null===n?"":"string"===t||"number"===t||"boolean"===t?String(n):n instanceof ir||n instanceof Li||n instanceof Ut?n.toString():JSON.stringify(n)}class kl{constructor(t,o){this.type=t,this.value=o}static parse(t,o){if(2!==t.length)return o.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Sc(t[1]))return o.error("invalid value");const l=t[1];let h=Ui(l);const f=o.expectedType;return"array"!==h.kind||0!==h.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(h=f),new kl(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ir?["rgba"].concat(this.value.toArray()):this.value instanceof Li?this.value.serialize():this.value}}var nl=kl,vr=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const Sf={string:$n,number:at,boolean:Xn,object:wn};class ym{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");let l,h=1;const f=t[0];if("array"===f){let v,w;if(t.length>2){const E=t[1];if("string"!=typeof E||!(E in Sf)||"object"===E)return o.error('The item type argument of "array" must be one of string, number, boolean',1);v=Sf[E],h++}else v=On;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);w=t[2],h++}l=xt(v,w)}else l=Sf[f];const g=[];for(;h<t.length;h++){const v=o.parse(t[h],h,On);if(!v)return null;g.push(v)}return new ym(l,g)}evaluate(t){for(let o=0;o<this.args.length;o++){const l=this.args[o].evaluate(t);if(!pi(this.type,Ui(l)))return l;if(o===this.args.length-1)throw new vr(`Expected value to be of type ${Wi(this.type)}, but found ${Wi(Ui(l))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,o=[t.kind];if("array"===t.kind){const l=t.itemType;if("string"===l.kind||"number"===l.kind||"boolean"===l.kind){o.push(l.kind);const h=t.N;("number"==typeof h||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(l=>l.serialize()))}}var Ia=ym;class Cu{constructor(t){this.type=Eu,this.sections=t}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&"object"==typeof l)return o.error("First argument must be an image or text section.");const h=[];let f=!1;for(let g=1;g<=t.length-1;++g){const v=t[g];if(f&&"object"==typeof v&&!Array.isArray(v)){f=!1;let w=null;if(v["font-scale"]&&(w=o.parse(v["font-scale"],1,at),!w))return null;let E=null;if(v["text-font"]&&(E=o.parse(v["text-font"],1,xt($n)),!E))return null;let D=null;if(v["text-color"]&&(D=o.parse(v["text-color"],1,So),!D))return null;const I=h[h.length-1];I.scale=w,I.font=E,I.textColor=D}else{const w=o.parse(t[g],1,On);if(!w)return null;const E=w.type.kind;if("string"!==E&&"value"!==E&&"null"!==E&&"resolvedImage"!==E)return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new Cu(h)}evaluate(t){return new Li(this.sections.map(o=>{const l=o.content.evaluate(t);return Ui(l)===Ic?new tl("",l,null,null,null):new tl(Ts(l),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))}eachChild(t){for(const o of this.sections)t(o.content),o.scale&&t(o.scale),o.font&&t(o.font),o.textColor&&t(o.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const o of this.sections){t.push(o.content.serialize());const l={};o.scale&&(l["font-scale"]=o.scale.serialize()),o.font&&(l["text-font"]=o.font.serialize()),o.textColor&&(l["text-color"]=o.textColor.serialize()),t.push(l)}return t}}class jr{constructor(t,o){this.type=Ic,this.inputPrimary=t,this.inputSecondary=o}static parse(t,o){if(t.length<2)return o.error("Expected two or more arguments.");const l=o.parse(t[1],1,$n);if(!l)return o.error("No image name provided.");if(2===t.length)return new jr(l);const h=o.parse(t[2],1,$n);return h?new jr(l,h):o.error("Secondary image variant is not a string.")}evaluate(t){const o=Ut.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(o.namePrimary)>-1,o.nameSecondary&&o.available&&t.availableImages&&(o.available=t.availableImages.indexOf(o.nameSecondary)>-1)),o}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function gn(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}const Qs={"to-boolean":Xn,"to-color":So,"to-number":at,"to-string":$n};class Af{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const l=t[0],h=[];let f=Ma;if("to-array"===l){if(!Array.isArray(t[1]))return null;const g=t[1].length;if(o.expectedType){if("array"!==o.expectedType.kind)return o.error(`Expected ${o.expectedType.kind} but found array.`);f=xt(o.expectedType.itemType,g)}else{if(!(g>0&&Sc(t[1][0])))return null;f=xt(Ui(t[1][0]),g)}for(let v=0;v<g;v++){const w=t[1][v];let E;if("array"===gn(w))E=o.parse(w,void 0,f.itemType);else{const D=gn(w);if(D!==f.itemType.kind)return o.error(`Expected ${f.itemType.kind} but found ${D}.`);E=o.registry.literal.parse(["literal",void 0===w?null:w],o)}if(!E)return null;h.push(E)}}else{if(("to-boolean"===l||"to-string"===l)&&2!==t.length)return o.error("Expected one argument.");f=Qs[l];for(let g=1;g<t.length;g++){const v=o.parse(t[g],g,On);if(!v)return null;h.push(v)}}return new Af(f,h)}evaluate(t){if("boolean"===this.type.kind)return!!this.args[0].evaluate(t);if("color"===this.type.kind){let o,l;for(const h of this.args){if(o=h.evaluate(t),l=null,o instanceof ir)return o;if("string"==typeof o){const f=t.parseColor(o);if(f)return f}else if(Array.isArray(o)&&(l=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:_m(o[0],o[1],o[2],o[3]),!l))return new ir(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new vr(l||`Could not parse color from value '${"string"==typeof o?o:String(JSON.stringify(o))}'`)}if("number"===this.type.kind){let o=null;for(const l of this.args){if(o=l.evaluate(t),null===o)return 0;const h=Number(o);if(!isNaN(h))return h}throw new vr(`Could not convert ${JSON.stringify(o)} to number.`)}return"formatted"===this.type.kind?Li.fromString(Ts(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Ut.fromString(Ts(this.args[0].evaluate(t))):"array"===this.type.kind?this.args.map(o=>o.evaluate(t)):Ts(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Cu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new jr(this.args[0]).serialize();const t="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{t.push(o.serialize())}),t}}var il=Af;const $t=["Unknown","Point","LineString","Polygon"];var A_=class{constructor(n,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?$t[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:o,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*t-n[0])+this.featureDistanceData.bearing[1]*(l*t-n[1])}return 0}parseColor(n){let t=this._parseColorCache[n];return t||(t=this._parseColorCache[n]=ir.parse(n)),t}getConfig(n){return this.options?this.options.get(n):null}};class rr{constructor(t,o,l,h,f){this.name=t,this.type=o,this._evaluate=l,this.args=h,this._overloadIndex=f}evaluate(t){if(!this._evaluate){const o=rr.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,o){const l=t[0],h=rr.definitions[l];if(!h)return o.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=[];let w=null,E=-1;for(const[D,I]of g){if(Array.isArray(D)&&D.length!==t.length-1)continue;v.push(D),E++,w=new bm(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const P=[];let L=!1;for(let N=1;N<t.length;N++){const B=t[N],U=Array.isArray(D)?D[N-1]:D.type,H=w.parse(B,1+P.length,U);if(!H){L=!0;break}P.push(H)}if(!L)if(Array.isArray(D)&&D.length!==P.length)w.error(`Expected ${D.length} arguments, but found ${P.length} instead.`);else{for(let N=0;N<P.length;N++){const B=Array.isArray(D)?D[N]:D.type,U=P[N];w.concat(N+1).checkSubtype(B,U.type)}if(0===w.errors.length)return new rr(l,f,I,P,E)}}if(1===v.length)o.errors.push(...w.errors);else{const D=(v.length?v:g.map(([P])=>P)).map(Du).join(" | "),I=[];for(let P=1;P<t.length;P++){const L=o.parse(t[P],1+I.length);if(!L)return null;I.push(Wi(L.type))}o.error(`Expected arguments of type ${D}, but found (${I.join(", ")}) instead.`)}return null}static register(t,o){rr.definitions=o;for(const l in o)t[l]=rr}}function Du(n){return Array.isArray(n)?`(${n.map(Wi).join(", ")})`:`(${Wi(n.type)}...)`}var kn=rr;class Ac{constructor(t,o,l){this.type=Mc,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=o}static parse(t,o){if(2!==t.length)return o.error("Expected one argument.");const l=t[1];if("object"!=typeof l||Array.isArray(l))return o.error("Collator options argument must be an object.");const h=o.parse(void 0!==l["case-sensitive"]&&l["case-sensitive"],1,Xn);if(!h)return null;const f=o.parse(void 0!==l["diacritic-sensitive"]&&l["diacritic-sensitive"],1,Xn);if(!f)return null;let g=null;return l.locale&&(g=o.parse(l.locale,1,$n),!g)?null:new Ac(h,f,g)}evaluate(t){return new mn(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var Rf={exports:{}};Rf.exports=function(){function n(l,h,f,g,v){for(;g>f;){if(g-f>600){var w=g-f+1,E=h-f+1,D=Math.log(w),I=.5*Math.exp(2*D/3),P=.5*Math.sqrt(D*I*(w-I)/w)*(E-w/2<0?-1:1);n(l,h,Math.max(f,Math.floor(h-E*I/w+P)),Math.min(g,Math.floor(h+(w-E)*I/w+P)),v)}var L=l[h],N=f,B=g;for(t(l,f,h),v(l[g],L)>0&&t(l,f,g);N<B;){for(t(l,N,B),N++,B--;v(l[N],L)<0;)N++;for(;v(l[B],L)>0;)B--}0===v(l[f],L)?t(l,f,B):t(l,++B,g),B<=h&&(f=B+1),h<=B&&(g=B-1)}}function t(l,h,f){var g=l[h];l[h]=l[f],l[f]=g}function o(l,h){return l<h?-1:l>h?1:0}return function(l,h,f,g,v){n(l,h,f||0,g||l.length-1,v||o)}}();var Xh=$o(Rf.exports);function Kh(n){let t=0;for(let o,l,h=0,f=n.length,g=f-1;h<f;g=h++)o=n[h],l=n[g],t+=(l.x-o.x)*(o.y+l.y);return t}function ea(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function Sa(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Jh(n,t,o){const l=n[0]-t[0],h=n[1]-t[1],f=n[0]-o[0],g=n[1]-o[1];return l*g-f*h==0&&l*f<=0&&h*g<=0}function Kn(n,t,o=!1){let l=!1;for(let v=0,w=t.length;v<w;v++){const E=t[v];for(let D=0,I=E.length,P=I-1;D<I;P=D++){const L=E[P],N=E[D];if(Jh(n,L,N))return o;(f=L)[1]>(h=n)[1]!=(g=N)[1]>h[1]&&h[0]<(g[0]-f[0])*(h[1]-f[1])/(g[1]-f[1])+f[0]&&(l=!l)}}var h,f,g;return l}function Tu(n,t,o,l){const h=l[0]-o[0],f=l[1]-o[1],g=(n[0]-o[0])*f-h*(n[1]-o[1]),v=(t[0]-o[0])*f-h*(t[1]-o[1]);return g>0&&v<0||g<0&&v>0}function ta(n,t,o,l){return(h=[l[0]-o[0],l[1]-o[1]])[0]*(f=[t[0]-n[0],t[1]-n[1]])[1]-h[1]*f[0]!=0&&!(!Tu(n,t,o,l)||!Tu(o,l,n,t));var h,f}const xr=8192;function Rc(n,t){const o=(180+n[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(o*h*xr),Math.round(l*h*xr)]}function vm(n,t){for(let o=0;o<t.length;o++)if(Kn(n,t[o]))return!0;return!1}function $i(n,t,o){for(const l of o)for(let h=0,f=l.length,g=f-1;h<f;g=h++)if(ta(n,t,l[g],l[h]))return!0;return!1}function Ms(n,t){for(let o=0;o<n.length;++o)if(!Kn(n[o],t))return!1;for(let o=0;o<n.length-1;++o)if($i(n[o],n[o+1],t))return!1;return!0}function R_(n,t){for(let o=0;o<t.length;o++)if(Ms(n,t[o]))return!0;return!1}function Bt(n,t,o){const l=[];for(let h=0;h<n.length;h++){const f=[];for(let g=0;g<n[h].length;g++){const v=Rc(n[h][g],o);ea(t,v),f.push(v)}l.push(f)}return l}function Mu(n,t,o){const l=[];for(let h=0;h<n.length;h++){const f=Bt(n[h],t,o);l.push(f)}return l}function Iu(n,t,o,l){if(n[0]<o[0]||n[0]>o[2]){const h=.5*l;let f=n[0]-o[0]>h?-l:o[0]-n[0]>h?l:0;0===f&&(f=n[0]-o[2]>h?-l:o[2]-n[0]>h?l:0),n[0]+=f}ea(t,n)}function Qh(n,t,o,l){const h=Math.pow(2,l.z)*xr,f=[l.x*xr,l.y*xr],g=[];if(!n)return g;for(const v of n)for(const w of v){const E=[w.x+f[0],w.y+f[1]];Iu(E,t,o,h),g.push(E)}return g}function Su(n,t,o,l){const h=Math.pow(2,l.z)*xr,f=[l.x*xr,l.y*xr],g=[];if(!n)return g;for(const w of n){const E=[];for(const D of w){const I=[D.x+f[0],D.y+f[1]];ea(t,I),E.push(I)}g.push(E)}if(t[2]-t[0]<=h/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of g)for(const E of w)Iu(E,t,o,h)}var v;return g}class Pc{constructor(t,o){this.type=Xn,this.geojson=t,this.geometries=o}static parse(t,o){if(2!==t.length)return o.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Sc(t[1])){const l=t[1];if("FeatureCollection"===l.type)for(let h=0;h<l.features.length;++h){const f=l.features[h].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new Pc(l,l.features[h].geometry)}else if("Feature"===l.type){const h=l.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new Pc(l,l.geometry)}else if("Polygon"===l.type||"MultiPolygon"===l.type)return new Pc(l,l)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(o,l){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=o.canonicalID();if(!g)return!1;if("Polygon"===l.type){const v=Bt(l.coordinates,f,g),w=Qh(o.geometry(),h,f,g);if(!Sa(h,f))return!1;for(const E of w)if(!Kn(E,v))return!1}if("MultiPolygon"===l.type){const v=Mu(l.coordinates,f,g),w=Qh(o.geometry(),h,f,g);if(!Sa(h,f))return!1;for(const E of w)if(!vm(E,v))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(o,l){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=o.canonicalID();if(!g)return!1;if("Polygon"===l.type){const v=Bt(l.coordinates,f,g),w=Su(o.geometry(),h,f,g);if(!Sa(h,f))return!1;for(const E of w)if(!Ms(E,v))return!1}if("MultiPolygon"===l.type){const v=Mu(l.coordinates,f,g),w=Su(o.geometry(),h,f,g);if(!Sa(h,f))return!1;for(const E of w)if(!R_(E,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Oc=Pc,ed={exports:{}};ed.exports=function(){var n={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},t=1/298.257223563,o=t*(2-t),l=Math.PI/180,h=function(E,D){if(void 0===E)throw new Error("No latitude given.");if(D&&!n[D])throw new Error("Unknown unit "+D+". Use one of: "+Object.keys(n).join(", "));var I=6378.137*l*(D?n[D]:1),P=Math.cos(E*l),L=1/(1-o*(1-P*P)),N=Math.sqrt(L);this.kx=I*N*P,this.ky=I*N*L*(1-o)},f={units:{configurable:!0}};function g(E,D){return E[0]===D[0]&&E[1]===D[1]}function v(E,D,I){var P=w(D[0]-E[0]);return[E[0]+P*I,E[1]+(D[1]-E[1])*I]}function w(E){for(;E<-180;)E+=360;for(;E>180;)E-=360;return E}return h.fromTile=function(E,D,I){var P=Math.PI*(1-2*(E+.5)/Math.pow(2,D)),L=Math.atan(.5*(Math.exp(P)-Math.exp(-P)))/l;return new h(L,I)},f.units.get=function(){return n},h.prototype.distance=function(E,D){var I=w(E[0]-D[0])*this.kx,P=(E[1]-D[1])*this.ky;return Math.sqrt(I*I+P*P)},h.prototype.bearing=function(E,D){var I=w(D[0]-E[0])*this.kx;return Math.atan2(I,(D[1]-E[1])*this.ky)/l},h.prototype.destination=function(E,D,I){var P=I*l;return this.offset(E,Math.sin(P)*D,Math.cos(P)*D)},h.prototype.offset=function(E,D,I){return[E[0]+D/this.kx,E[1]+I/this.ky]},h.prototype.lineDistance=function(E){for(var D=0,I=0;I<E.length-1;I++)D+=this.distance(E[I],E[I+1]);return D},h.prototype.area=function(E){for(var D=0,I=0;I<E.length;I++)for(var P=E[I],L=0,N=P.length,B=N-1;L<N;B=L++)D+=w(P[L][0]-P[B][0])*(P[L][1]+P[B][1])*(I?-1:1);return Math.abs(D)/2*this.kx*this.ky},h.prototype.along=function(E,D){var I=0;if(D<=0)return E[0];for(var P=0;P<E.length-1;P++){var L=E[P],N=E[P+1],B=this.distance(L,N);if((I+=B)>D)return v(L,N,(D-(I-B))/B)}return E[E.length-1]},h.prototype.pointToSegmentDistance=function(E,D,I){var P=D[0],L=D[1],N=w(I[0]-P)*this.kx,B=(I[1]-L)*this.ky,U=0;return 0===N&&0===B||((U=(w(E[0]-P)*this.kx*N+(E[1]-L)*this.ky*B)/(N*N+B*B))>1?(P=I[0],L=I[1]):U>0&&(P+=N/this.kx*U,L+=B/this.ky*U)),N=w(E[0]-P)*this.kx,B=(E[1]-L)*this.ky,Math.sqrt(N*N+B*B)},h.prototype.pointOnLine=function(E,D){for(var I,P,L,N,B=1/0,U=0;U<E.length-1;U++){var H=E[U][0],Q=E[U][1],ne=w(E[U+1][0]-H)*this.kx,ie=(E[U+1][1]-Q)*this.ky,ue=0;0===ne&&0===ie||((ue=(w(D[0]-H)*this.kx*ne+(D[1]-Q)*this.ky*ie)/(ne*ne+ie*ie))>1?(H=E[U+1][0],Q=E[U+1][1]):ue>0&&(H+=ne/this.kx*ue,Q+=ie/this.ky*ue));var ae=(ne=w(D[0]-H)*this.kx)*ne+(ie=(D[1]-Q)*this.ky)*ie;ae<B&&(B=ae,I=H,P=Q,L=U,N=ue)}return{point:[I,P],index:L,t:Math.max(0,Math.min(1,N))}},h.prototype.lineSlice=function(E,D,I){var P=this.pointOnLine(I,E),L=this.pointOnLine(I,D);if(P.index>L.index||P.index===L.index&&P.t>L.t){var N=P;P=L,L=N}var B=[P.point],U=P.index+1,H=L.index;!g(I[U],B[0])&&U<=H&&B.push(I[U]);for(var Q=U+1;Q<=H;Q++)B.push(I[Q]);return g(I[H],L.point)||B.push(L.point),B},h.prototype.lineSliceAlong=function(E,D,I){for(var P=0,L=[],N=0;N<I.length-1;N++){var B=I[N],U=I[N+1],H=this.distance(B,U);if((P+=H)>E&&0===L.length&&L.push(v(B,U,(E-(P-H))/H)),P>=D)return L.push(v(B,U,(D-(P-H))/H)),L;P>E&&L.push(U)}return L},h.prototype.bufferPoint=function(E,D){var I=D/this.ky,P=D/this.kx;return[E[0]-P,E[1]-I,E[0]+P,E[1]+I]},h.prototype.bufferBBox=function(E,D){var I=D/this.ky,P=D/this.kx;return[E[0]-P,E[1]-I,E[2]+P,E[3]+I]},h.prototype.insideBBox=function(E,D){return w(E[0]-D[0])>=0&&w(E[0]-D[2])<=0&&E[1]>=D[1]&&E[1]<=D[3]},Object.defineProperties(h,f),h}();var Ll=$o(ed.exports),xm={exports:{}};xm.exports=function(){var n=function(o,l){if(void 0===o&&(o=[]),void 0===l&&(l=t),this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(var h=(this.length>>1)-1;h>=0;h--)this._down(h)};function t(o,l){return o<l?-1:o>l?1:0}return n.prototype.push=function(o){this.data.push(o),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(0!==this.length){var o=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),o}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(o){for(var l=this.data,h=this.compare,f=l[o];o>0;){var g=o-1>>1,v=l[g];if(h(f,v)>=0)break;l[o]=v,o=g}l[o]=f},n.prototype._down=function(o){for(var l=this.data,h=this.compare,f=this.length>>1,g=l[o];o<f;){var v=1+(o<<1),w=l[v],E=v+1;if(E<this.length&&h(l[E],w)<0&&(v=E,w=l[E]),h(w,g)>=0)break;l[o]=w,o=v}l[o]=g},n}();var Is=$o(xm.exports),gt=8192;function rl(n,t){return t.dist-n.dist}const Au=100,ol=50;function Pf(n){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(t[o]!==n[o])return!1;return!0}function sl(n){return n[1]-n[0]+1}function Ss(n,t){const o=n[1]>=n[0]&&n[1]<t;return o||console.warn("Distance Expression: Index is out of range"),o}function td(n,t){if(n[0]>n[1])return[null,null];const o=sl(n);if(t){if(2===o)return[n,null];const l=Math.floor(o/2);return[[n[0],n[0]+l],[n[0]+l,n[1]]]}{if(1===o)return[n,null];const l=Math.floor(o/2)-1;return[[n[0],n[0]+l],[n[0]+l+1,n[1]]]}}function cs(n,t){const o=[1/0,1/0,-1/0,-1/0];if(!Ss(t,n.length))return o;for(let l=t[0];l<=t[1];++l)ea(o,n[l]);return o}function nd(n){const t=[1/0,1/0,-1/0,-1/0];for(let o=0;o<n.length;++o)for(let l=0;l<n[o].length;++l)ea(t,n[o][l]);return t}function Ao(n,t,o){if(Pf(n)||Pf(t))return NaN;let l=0,h=0;return n[2]<t[0]&&(l=t[0]-n[2]),n[0]>t[2]&&(l=n[0]-t[2]),n[1]>t[3]&&(h=n[1]-t[3]),n[3]<t[1]&&(h=t[1]-n[3]),o.distance([0,0],[l,h])}function Of(n){return 360*n-180}function Qe(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Fl(n,t){const o=Math.pow(2,t.z),l=(n.y/gt+t.y)/o;return[Of((n.x/gt+t.x)/o),Qe(l)]}function Xt(n,t){const o=[];for(let l=0;l<n.length;++l)o.push(Fl(n[l],t));return o}function Ru(n,t,o){const l=o.pointOnLine(t,n).point;return o.distance(n,l)}function id(n,t,o,l,h){const f=o.slice(l[0],l[1]+1);let g=1/0;for(let v=t[0];v<=t[1];++v)if(0===(g=Math.min(g,Ru(n[v],f,h))))return 0;return g}function Nl(n,t,o,l,h){const f=Math.min(h.pointToSegmentDistance(n,o,l),h.pointToSegmentDistance(t,o,l)),g=Math.min(h.pointToSegmentDistance(o,n,t),h.pointToSegmentDistance(l,n,t));return Math.min(f,g)}function P_(n,t,o,l,h){if(!Ss(t,n.length)||!Ss(l,o.length))return NaN;let f=1/0;for(let g=t[0];g<t[1];++g)for(let v=l[0];v<l[1];++v){if(ta(n[g],n[g+1],o[v],o[v+1]))return 0;f=Math.min(f,Nl(n[g],n[g+1],o[v],o[v+1],h))}return f}function O_(n,t,o,l,h){if(!Ss(t,n.length)||!Ss(l,o.length))return NaN;let f=1/0;for(let g=t[0];g<=t[1];++g)for(let v=l[0];v<=l[1];++v)if(0===(f=Math.min(f,h.distance(n[g],o[v]))))return f;return f}function k_(n,t,o){if(Kn(n,t,!0))return 0;let l=1/0;for(const h of t){const f=h.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[f-1]&&0===(l=Math.min(l,o.pointToSegmentDistance(n,h[f-1],h[0])))||0===(l=Math.min(l,Ru(n,h,o))))return l}return l}function na(n,t,o,l){if(!Ss(t,n.length))return NaN;for(let f=t[0];f<=t[1];++f)if(Kn(n[f],o,!0))return 0;let h=1/0;for(let f=t[0];f<t[1];++f)for(const g of o)for(let v=0,w=g.length,E=w-1;v<w;E=v++){if(ta(n[f],n[f+1],g[E],g[v]))return 0;h=Math.min(h,Nl(n[f],n[f+1],g[E],g[v],l))}return h}function al(n,t){for(const o of n)for(let l=0;l<=o.length-1;++l)if(Kn(o[l],t,!0))return!0;return!1}function As(n,t,o,l=1/0){const h=nd(n),f=nd(t);if(l!==1/0&&Ao(h,f,o)>=l)return l;if(Sa(h,f)){if(al(n,t))return 0}else if(al(t,n))return 0;let g=l;for(const v of n)for(let w=0,E=v.length,D=E-1;w<E;D=w++)for(const I of t)for(let P=0,L=I.length,N=L-1;P<L;N=P++){if(ta(v[D],v[w],I[N],I[P]))return 0;g=Math.min(g,Nl(v[D],v[w],I[N],I[P],o))}return g}function qo(n,t,o,l,h,f,g){if(null===f||null===g)return;const v=Ao(cs(l,f),cs(h,g),o);v<t&&n.push({dist:v,range1:f,range2:g})}function wi(n,t,o,l,h=1/0){let f=Math.min(l.distance(n[0],o[0][0]),h);if(0===f)return f;const g=new Is([{dist:0,range1:[0,n.length-1],range2:[0,0]}],rl),v=t?ol:Au,w=nd(o);for(;g.length;){const E=g.pop();if(E.dist>=f)continue;const D=E.range1;if(sl(D)<=v){if(!Ss(D,n.length))return NaN;if(t){const I=na(n,D,o,l);if(0===(f=Math.min(f,I)))return f}else for(let I=D[0];I<=D[1];++I){const P=k_(n[I],o,l);if(0===(f=Math.min(f,P)))return f}}else{const I=td(D,t);if(null!==I[0]){const P=Ao(cs(n,I[0]),w,l);P<f&&g.push({dist:P,range1:I[0],range2:[0,0]})}if(null!==I[1]){const P=Ao(cs(n,I[1]),w,l);P<f&&g.push({dist:P,range1:I[1],range2:[0,0]})}}}return f}function Pu(n,t,o,l,h,f=1/0){let g=Math.min(f,h.distance(n[0],o[0]));if(0===g)return g;const v=new Is([{dist:0,range1:[0,n.length-1],range2:[0,o.length-1]}],rl),w=t?ol:Au,E=l?ol:Au;for(;v.length;){const D=v.pop();if(D.dist>=g)continue;const I=D.range1,P=D.range2;if(sl(I)<=w&&sl(P)<=E){if(!Ss(I,n.length)||!Ss(P,o.length))return NaN;if(t&&l?g=Math.min(g,P_(n,I,o,P,h)):t||l?t&&!l?g=Math.min(g,id(o,P,n,I,h)):!t&&l&&(g=Math.min(g,id(n,I,o,P,h))):g=Math.min(g,O_(n,I,o,P,h)),0===g)return g}else{const L=td(I,t),N=td(P,l);qo(v,g,h,n,o,L[0],N[0]),qo(v,g,h,n,o,L[0],N[1]),qo(v,g,h,n,o,L[1],N[0]),qo(v,g,h,n,o,L[1],N[1])}}return g}function Ou(n,t,o,l,h=1/0){let f=h;const g=cs(n,[0,n.length-1]);for(const v of o)if(!(f!==1/0&&Ao(g,cs(v,[0,v.length-1]),l)>=f)&&(f=Math.min(f,Pu(n,t,v,!0,l,f)),0===f))return f;return f}function kc(n,t,o,l,h=1/0){let f=h;const g=cs(n,[0,n.length-1]);for(const v of o){if(f!==1/0&&Ao(g,nd(v),l)>=f)continue;const w=wi(n,t,v,l,f);if(isNaN(w))return w;if(0===(f=Math.min(f,w)))return f}return f}function rd(n){return"Point"===n||"MultiPoint"===n||"LineString"===n||"MultiLineString"===n||"Polygon"===n||"MultiPolygon"===n}class go{constructor(t,o){this.type=at,this.geojson=t,this.geometries=o}static parse(t,o){if(2!==t.length)return o.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Sc(t[1])){const l=t[1];if("FeatureCollection"===l.type){for(let h=0;h<l.features.length;++h)if(rd(l.features[h].geometry.type))return new go(l,l.features[h].geometry)}else if("Feature"===l.type){if(rd(l.geometry.type))return new go(l,l.geometry)}else if(rd(l.type))return new go(l,l)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const o=t.geometry(),l=t.canonicalID();if(null!=o&&null!=l){if("Point"===t.geometryType())return function(h,f,g){const v=[];for(const E of h)for(const D of E)v.push(Fl(D,f));const w=new Ll(v[0][1],"meters");return"Point"===g.type||"MultiPoint"===g.type||"LineString"===g.type?Pu(v,!1,"Point"===g.type?[g.coordinates]:g.coordinates,"LineString"===g.type,w):"MultiLineString"===g.type?Ou(v,!1,g.coordinates,w):"Polygon"===g.type||"MultiPolygon"===g.type?kc(v,!1,"Polygon"===g.type?[g.coordinates]:g.coordinates,w):null}(o,l,this.geometries);if("LineString"===t.geometryType())return function(h,f,g){const v=[];for(const E of h){const D=[];for(const I of E)D.push(Fl(I,f));v.push(D)}const w=new Ll(v[0][0][1],"meters");if("Point"===g.type||"MultiPoint"===g.type||"LineString"===g.type)return Ou("Point"===g.type?[g.coordinates]:g.coordinates,"LineString"===g.type,v,w);if("MultiLineString"===g.type){let E=1/0;for(let D=0;D<g.coordinates.length;D++){const I=Ou(g.coordinates[D],!0,v,w,E);if(isNaN(I))return I;if(0===(E=Math.min(E,I)))return E}return E}if("Polygon"===g.type||"MultiPolygon"===g.type){let E=1/0;for(let D=0;D<v.length;D++){const I=kc(v[D],!0,"Polygon"===g.type?[g.coordinates]:g.coordinates,w,E);if(isNaN(I))return I;if(0===(E=Math.min(E,I)))return E}return E}return null}(o,l,this.geometries);if("Polygon"===t.geometryType())return function(h,f,g){const v=[];for(const E of function(D,I){const P=D.length;if(P<=1)return[D];const L=[];let N,B;for(let U=0;U<P;U++){const H=Kh(D[U]);0!==H&&(D[U].area=Math.abs(H),void 0===B&&(B=H<0),B===H<0?(N&&L.push(N),N=[D[U]]):N.push(D[U]))}return N&&L.push(N),L}(h)){const D=[];for(let I=0;I<E.length;++I)D.push(Xt(E[I],f));v.push(D)}const w=new Ll(v[0][0][0][1],"meters");if("Point"===g.type||"MultiPoint"===g.type||"LineString"===g.type)return kc("Point"===g.type?[g.coordinates]:g.coordinates,"LineString"===g.type,v,w);if("MultiLineString"===g.type){let E=1/0;for(let D=0;D<g.coordinates.length;D++){const I=kc(g.coordinates[D],!0,v,w,E);if(isNaN(I))return I;if(0===(E=Math.min(E,I)))return E}return E}return"Polygon"===g.type||"MultiPolygon"===g.type?function(E,D,I){let P=1/0;for(const L of E)for(const N of D){const B=As(L,N,I,P);if(isNaN(B))return B;if(0===(P=Math.min(P,B)))return P}return P}("Polygon"===g.type?[g.coordinates]:g.coordinates,v,w):null}(o,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var ll=go;function Lc(n,t){switch(n){case"string":return Ts(t);case"number":return+t;case"boolean":return!!t;case"color":return ir.parse(t);case"formatted":return Li.fromString(Ts(t));case"resolvedImage":return Ut.fromString(Ts(t))}return t}function od(n,t,o,l){return void 0!==l&&(n=l*Math.round(n/l)),void 0!==t&&n<t&&(n=t),void 0!==o&&n>o&&(n=o),n}class zl{constructor(t,o,l){this.type=t,this.key=o,this.scope=l}static parse(t,o){let l=o.expectedType;if(null==l&&(l=On),t.length<2||t.length>3)return o.error("Invalid number of arguments for 'config' expression.");const h=o.parse(t[1],1);if(!(h instanceof nl))return o.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const f=o.parse(t[2],2);return f instanceof nl?new zl(l,Ts(h.value),Ts(f.value)):o.error("Scope of 'config' expression must be a string literal.")}return new zl(l,Ts(h.value))}evaluate(t){const o=[this.key,this.scope,t.scope].filter(Boolean).join("\x1f"),l=t.getConfig(o);if(!l)return null;const{type:h,value:f,values:g,minValue:v,maxValue:w,stepValue:E}=l,D=l.default.evaluate(t);let I=D;if(f){const P=t.scope;t.scope=(P||"").split("\x1f").slice(1).join("\x1f"),I=f.evaluate(t),t.scope=P}return h&&(I=Lc(h,I)),void 0===I||void 0===v&&void 0===w&&void 0===E||("number"==typeof I?I=od(I,v,w,E):Array.isArray(I)&&(I=I.map(P=>"number"==typeof P?od(P,v,w,E):P))),void 0!==f&&void 0!==I&&g&&!g.includes(I)&&(I=D,h&&(I=Lc(h,I))),(h&&h!==this.type||void 0!==I&&Ui(I)!==this.type)&&(I=Lc(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}var Bl=zl;function Vl(n){if(n instanceof kn&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof Oc||n instanceof ll)return!1;let t=!0;return n.eachChild(o=>{t&&!Vl(o)&&(t=!1)}),t}function Aa(n){if(n instanceof kn&&"feature-state"===n.name)return!1;let t=!0;return n.eachChild(o=>{t&&!Aa(o)&&(t=!1)}),t}function Fc(n){if(n instanceof Bl)return!1;let t=!0;return n.eachChild(o=>{t&&!Fc(o)&&(t=!1)}),t}function kr(n,t){if(n instanceof kn&&t.indexOf(n.name)>=0)return!1;let o=!0;return n.eachChild(l=>{o&&!kr(l,t)&&(o=!1)}),o}class cl{constructor(t,o){this.type=o.type,this.name=t,this.boundExpression=o}static parse(t,o){if(2!==t.length||"string"!=typeof t[1])return o.error("'var' expression requires exactly one string literal argument.");const l=t[1];return o.scope.has(l)?new cl(l,o.scope.get(l)):o.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var lo=cl;class kf{constructor(t,o=[],l,h=new zi,f=[],g,v){this.registry=t,this.path=o,this.key=o.map(w=>`[${w}]`).join(""),this.scope=h,this.errors=f,this.expectedType=l,this._scope=g,this.options=v}parse(t,o,l,h,f={}){return o||l?this.concat(o,l,h)._parse(t,f):this._parse(t,f)}_parse(t,o){function l(h,f,g){return"assert"===g?new Ia(f,[h]):"coerce"===g?new il(f,[h]):h}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h="string"==typeof t[0]?this.registry[t[0]]:void 0;if(h){let f=h.parse(t,this);if(!f)return null;if(this.expectedType){const g=this.expectedType,v=f.type;if("string"!==g.kind&&"number"!==g.kind&&"boolean"!==g.kind&&"object"!==g.kind&&"array"!==g.kind||"value"!==v.kind)if("color"!==g.kind&&"formatted"!==g.kind&&"resolvedImage"!==g.kind||"value"!==v.kind&&"string"!==v.kind){if(this.checkSubtype(g,v))return null}else f=l(f,g,o.typeAnnotation||"coerce");else f=l(f,g,o.typeAnnotation||"assert")}if(!(f instanceof nl)&&"resolvedImage"!==f.type.kind&&Zo(f)){const g=new A_(this._scope,this.options);try{f=new nl(f.type,f.evaluate(g))}catch(v){return this.error(v.message),null}}return f}return il.parse(["to-array",t],this)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,o,l){const h="number"==typeof t?this.path.concat(t):this.path,f=l?this.scope.concat(l):this.scope;return new kf(this.registry,h,o||null,f,this.errors,this._scope,this.options)}error(t,...o){const l=`${this.key}${o.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ds(l,t))}checkSubtype(t,o){const l=pi(t,o);return l&&this.error(l),l}}var bm=kf;function Zo(n){if(n instanceof lo)return Zo(n.boundExpression);if(n instanceof kn&&"error"===n.name||n instanceof Ac||n instanceof Oc||n instanceof ll||n instanceof Bl)return!1;const t=n instanceof il||n instanceof Ia;let o=!0;return n.eachChild(l=>{o=t?o&&Zo(l):o&&l instanceof nl}),!!o&&Vl(n)&&kr(n,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function jl(n,t){const o=n.length-1;let l,h,f=0,g=o,v=0;for(;f<=g;)if(v=Math.floor((f+g)/2),l=n[v],h=n[v+1],l<=t){if(v===o||t<h)return v;f=v+1}else{if(!(l>t))throw new vr("Input is not a number.");g=v-1}return 0}class ku{constructor(t,o,l){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(const[h,f]of l)this.labels.push(h),this.outputs.push(f)}static parse(t,o){if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");const l=o.parse(t[1],1,at);if(!l)return null;const h=[];let f=null;o.expectedType&&"value"!==o.expectedType.kind&&(f=o.expectedType);for(let g=1;g<t.length;g+=2){const v=1===g?-1/0:t[g],w=t[g+1],E=g,D=g+1;if("number"!=typeof v)return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=v)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const I=o.parse(w,D,f);if(!I)return null;f=f||I.type,h.push([v,I])}return new ku(f,l,h)}evaluate(t){const o=this.labels,l=this.outputs;if(1===o.length)return l[0].evaluate(t);const h=this.input.evaluate(t);if(h<=o[0])return l[0].evaluate(t);const f=o.length;return h>=o[f-1]?l[f-1].evaluate(t):l[jl(o,h)].evaluate(t)}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t}}var Lu=ku;const Em=4/29,Ul=6/29,Lf=3*Ul*Ul,Cm=Ul*Ul*Ul,L_=Math.PI/180,Bi=180/Math.PI;function sd(n){return n>Cm?Math.pow(n,1/3):n/Lf+Em}function ad(n){return n>Ul?n*n*n:Lf*(n-Em)}function ld(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function br(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Ff(n){const t=br(n.r),o=br(n.g),l=br(n.b),h=sd((.4124564*t+.3575761*o+.1804375*l)/.95047),f=sd((.2126729*t+.7151522*o+.072175*l)/1);return{l:116*f-16,a:500*(h-f),b:200*(f-sd((.0193339*t+.119192*o+.9503041*l)/1.08883)),alpha:n.a}}function cd(n){let t=(n.l+16)/116,o=isNaN(n.a)?t:t+n.a/500,l=isNaN(n.b)?t:t-n.b/200;return t=1*ad(t),o=.95047*ad(o),l=1.08883*ad(l),new ir(ld(3.2404542*o-1.5371385*t-.4985314*l),ld(-.969266*o+1.8760108*t+.041556*l),ld(.0556434*o-.2040259*t+1.0572252*l),n.alpha)}function Tr(n,t,o){const l=t-n;return n+o*(l>180||l<-180?l-360*Math.round(l/360):l)}const Lr={forward:Ff,reverse:cd,interpolate:function(n,t,o){return{l:rn(n.l,t.l,o),a:rn(n.a,t.a,o),b:rn(n.b,t.b,o),alpha:rn(n.alpha,t.alpha,o)}}},ni={forward:function(n){const{l:t,a:o,b:l}=Ff(n),h=Math.atan2(l,o)*Bi;return{h:h<0?h+360:h,c:Math.sqrt(o*o+l*l),l:t,alpha:n.a}},reverse:function(n){const t=n.h*L_,o=n.c;return cd({l:n.l,a:Math.cos(t)*o,b:Math.sin(t)*o,alpha:n.alpha})},interpolate:function(n,t,o){return{h:Tr(n.h,t.h,o),c:rn(n.c,t.c,o),l:rn(n.l,t.l,o),alpha:rn(n.alpha,t.alpha,o)}}};var Fr=Object.freeze({__proto__:null,hcl:ni,lab:Lr});class Nr{constructor(t,o,l,h,f){this.type=t,this.operator=o,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[g,v]of f)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(t,o,l,h){let f=0;if("exponential"===t.name)f=Rs(o,t.base,l,h);else if("linear"===t.name)f=Rs(o,1,l,h);else if("cubic-bezier"===t.name){const g=t.controlPoints;f=new ws(g[0],g[1],g[2],g[3]).solve(Rs(o,1,l,h))}return f}static parse(t,o){let[l,h,f,...g]=t;if(!Array.isArray(h)||0===h.length)return o.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const E=h[1];if("number"!=typeof E)return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if("cubic-bezier"!==h[0])return o.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(4!==E.length||E.some(D=>"number"!=typeof D||D<0||D>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(f=o.parse(f,2,at),!f)return null;const v=[];let w=null;"interpolate-hcl"===l||"interpolate-lab"===l?w=So:o.expectedType&&"value"!==o.expectedType.kind&&(w=o.expectedType);for(let E=0;E<g.length;E+=2){const D=g[E],I=g[E+1],P=E+3,L=E+4;if("number"!=typeof D)return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(v.length&&v[v.length-1][0]>=D)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const N=o.parse(I,L,w);if(!N)return null;w=w||N.type,v.push([D,N])}return"number"===w.kind||"color"===w.kind||"array"===w.kind&&"number"===w.itemType.kind&&"number"==typeof w.N?new Nr(w,l,h,f,v):o.error(`Type ${Wi(w)} is not interpolatable.`)}evaluate(t){const o=this.labels,l=this.outputs;if(1===o.length)return l[0].evaluate(t);const h=this.input.evaluate(t);if(h<=o[0])return l[0].evaluate(t);const f=o.length;if(h>=o[f-1])return l[f-1].evaluate(t);const g=jl(o,h),v=Nr.interpolationFactor(this.interpolation,h,o[g],o[g+1]),w=l[g].evaluate(t),E=l[g+1].evaluate(t);return"interpolate"===this.operator?bu[this.type.kind.toLowerCase()](w,E,v):"interpolate-hcl"===this.operator?ni.reverse(ni.interpolate(ni.forward(w),ni.forward(E),v)):Lr.reverse(Lr.interpolate(Lr.forward(w),Lr.forward(E),v))}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,t,this.input.serialize()];for(let l=0;l<this.labels.length;l++)o.push(this.labels[l],this.outputs[l].serialize());return o}}function Rs(n,t,o,l){const h=l-o,f=n-o;return 0===h?0:1===t?f/h:(Math.pow(t,f)-1)/(Math.pow(t,h)-1)}var or=Nr;class $l{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expectected at least one argument.");let l=null;const h=o.expectedType;h&&"value"!==h.kind&&(l=h);const f=[];for(const v of t.slice(1)){const w=o.parse(v,1+f.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,f.push(w)}const g=h&&f.some(v=>pi(h,v.type));return new $l(g?On:l,f)}evaluate(t){let o,l=null,h=0;for(const f of this.args){if(h++,l=f.evaluate(t),l&&l instanceof Ut&&!l.available&&(o||(o=l),l=null,h===this.args.length))return o;if(null!==l)break}return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(o=>{t.push(o.serialize())}),t}}var ud=$l;class Gl{constructor(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const o of this.bindings)t(o[1]);t(this.result)}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let f=1;f<t.length-1;f+=2){const g=t[f];if("string"!=typeof g)return o.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return o.error("Variable names must contain only alphanumeric characters or '_'.",f);const v=o.parse(t[f+1],f+1);if(!v)return null;l.push([g,v])}const h=o.parse(t[t.length-1],t.length-1,o.expectedType,l);return h?new Gl(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[o,l]of this.bindings)t.push(o,l.serialize());return t.push(this.result.serialize()),t}}var Nf=Gl;class hl{constructor(t,o,l){this.type=t,this.index=o,this.input=l}static parse(t,o){if(3!==t.length)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,at),h=o.parse(t[2],2,xt(o.expectedType||On));return l&&h?new hl(h.type.itemType,l,h):null}evaluate(t){const o=this.index.evaluate(t),l=this.input.evaluate(t);if(o<0)throw new vr(`Array index out of bounds: ${o} < 0.`);if(o>=l.length)throw new vr(`Array index out of bounds: ${o} > ${l.length-1}.`);if(o!==Math.floor(o))throw new vr(`Array index must be an integer, but found ${o} instead.`);return l[o]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Kt=hl;class Gt{constructor(t,o){this.type=Xn,this.needle=t,this.haystack=o}static parse(t,o){if(3!==t.length)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,On),h=o.parse(t[2],2,On);return l&&h?Qt(l.type,[Xn,$n,at,Ma,On])?new Gt(l,h):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(l.type)} instead`):null}evaluate(t){const o=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(null==l)return!1;if(!Ol(o,["boolean","string","number","null"]))throw new vr(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(Ui(o))} instead.`);if(!Ol(l,["string","array"]))throw new vr(`Expected second argument to be of type array or string, but found ${Wi(Ui(l))} instead.`);return l.indexOf(o)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var qn=Gt;class Yi{constructor(t,o,l){this.type=at,this.needle=t,this.haystack=o,this.fromIndex=l}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,On),h=o.parse(t[2],2,On);if(!l||!h)return null;if(!Qt(l.type,[Xn,$n,at,Ma,On]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(l.type)} instead`);if(4===t.length){const f=o.parse(t[3],3,at);return f?new Yi(l,h,f):null}return new Yi(l,h)}evaluate(t){const o=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!Ol(o,["boolean","string","number","null"]))throw new vr(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(Ui(o))} instead.`);if(!Ol(l,["string","array"]))throw new vr(`Expected second argument to be of type array or string, but found ${Wi(Ui(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(t);return l.indexOf(o,h)}return l.indexOf(o)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var us=Yi;class Hl{constructor(t,o,l,h,f,g){this.inputType=t,this.type=o,this.input=l,this.cases=h,this.outputs=f,this.otherwise=g}static parse(t,o){if(t.length<5)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return o.error("Expected an even number of arguments.");let l,h;o.expectedType&&"value"!==o.expectedType.kind&&(h=o.expectedType);const f={},g=[];for(let E=2;E<t.length-1;E+=2){let D=t[E];const I=t[E+1];Array.isArray(D)||(D=[D]);const P=o.concat(E);if(0===D.length)return P.error("Expected at least one branch label.");for(const N of D){if("number"!=typeof N&&"string"!=typeof N)return P.error("Branch labels must be numbers or strings.");if("number"==typeof N&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof N&&Math.floor(N)!==N)return P.error("Numeric branch labels must be integer values.");if(l){if(P.checkSubtype(l,Ui(N)))return null}else l=Ui(N);if(void 0!==f[String(N)])return P.error("Branch labels must be unique.");f[String(N)]=g.length}const L=o.parse(I,E,h);if(!L)return null;h=h||L.type,g.push(L)}const v=o.parse(t[1],1,On);if(!v)return null;const w=o.parse(t[t.length-1],t.length-1,h);return w?"value"!==v.type.kind&&o.concat(1).checkSubtype(l,v.type)?null:new Hl(l,h,v,f,g,w):null}evaluate(t){const o=this.input.evaluate(t);return(Ui(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),l=[],h={};for(const g of o){const v=h[this.cases[g]];void 0===v?(h[this.cases[g]]=l.length,l.push([this.cases[g],[g]])):l[v][1].push(g)}const f=g=>"number"===this.inputType.kind?Number(g):g;for(const[g,v]of l)t.push(1===v.length?f(v[0]):v.map(f)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}var Yr=Hl;class Ra{constructor(t,o,l){this.type=t,this.branches=o,this.otherwise=l}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return o.error("Expected an odd number of arguments.");let l;o.expectedType&&"value"!==o.expectedType.kind&&(l=o.expectedType);const h=[];for(let g=1;g<t.length-1;g+=2){const v=o.parse(t[g],g,Xn);if(!v)return null;const w=o.parse(t[g+1],g+1,l);if(!w)return null;h.push([v,w]),l=l||w.type}const f=o.parse(t[t.length-1],t.length-1,l);return f?new Ra(l,h,f):null}evaluate(t){for(const[o,l]of this.branches)if(o.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[o,l]of this.branches)t(o),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(o=>{t.push(o.serialize())}),t}}var pr=Ra;class hs{constructor(t,o,l,h){this.type=t,this.input=o,this.beginIndex=l,this.endIndex=h}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,On),h=o.parse(t[2],2,at);if(!l||!h)return null;if(!Qt(l.type,[xt(On),$n,On]))return o.error(`Expected first argument to be of type array or string, but found ${Wi(l.type)} instead`);if(4===t.length){const f=o.parse(t[3],3,at);return f?new hs(l.type,l,h,f):null}return new hs(l.type,l,h)}evaluate(t){const o=this.input.evaluate(t),l=this.beginIndex.evaluate(t);if(!Ol(o,["string","array"]))throw new vr(`Expected first argument to be of type array or string, but found ${Wi(Ui(o))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(t);return o.slice(l,h)}return o.slice(l)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ps=hs;function Ln(n,t){return"=="===n||"!="===n?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function ql(n,t,o,l){return 0===l.compare(t,o)}function Zl(n,t,o){const l="=="!==n&&"!="!==n;return class F2{constructor(f,g,v){this.type=Xn,this.lhs=f,this.rhs=g,this.collator=v,this.hasUntypedArgument="value"===f.type.kind||"value"===g.type.kind}static parse(f,g){if(3!==f.length&&4!==f.length)return g.error("Expected two or three arguments.");const v=f[0];let w=g.parse(f[1],1,On);if(!w)return null;if(!Ln(v,w.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${Wi(w.type)}'.`);let E=g.parse(f[2],2,On);if(!E)return null;if(!Ln(v,E.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${Wi(E.type)}'.`);if(w.type.kind!==E.type.kind&&"value"!==w.type.kind&&"value"!==E.type.kind)return g.error(`Cannot compare types '${Wi(w.type)}' and '${Wi(E.type)}'.`);l&&("value"===w.type.kind&&"value"!==E.type.kind?w=new Ia(E.type,[w]):"value"!==w.type.kind&&"value"===E.type.kind&&(E=new Ia(w.type,[E])));let D=null;if(4===f.length){if("string"!==w.type.kind&&"string"!==E.type.kind&&"value"!==w.type.kind&&"value"!==E.type.kind)return g.error("Cannot use collator to compare non-string types.");if(D=g.parse(f[3],3,Mc),!D)return null}return new F2(w,E,D)}evaluate(f){const g=this.lhs.evaluate(f),v=this.rhs.evaluate(f);if(l&&this.hasUntypedArgument){const w=Ui(g),E=Ui(v);if(w.kind!==E.kind||"string"!==w.kind&&"number"!==w.kind)throw new vr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=Ui(g),E=Ui(v);if("string"!==w.kind||"string"!==E.kind)return t(f,g,v)}return this.collator?o(f,g,v,this.collator.evaluate(f)):t(f,g,v)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[n];return this.eachChild(g=>{f.push(g.serialize())}),f}}}const dl=Zl("==",function(n,t,o){return t===o},ql),ur=Zl("!=",function(n,t,o){return t!==o},function(n,t,o,l){return!ql(0,t,o,l)}),Fu=Zl("<",function(n,t,o){return t<o},function(n,t,o,l){return l.compare(t,o)<0}),Nc=Zl(">",function(n,t,o){return t>o},function(n,t,o,l){return l.compare(t,o)>0}),Os=Zl("<=",function(n,t,o){return t<=o},function(n,t,o,l){return l.compare(t,o)<=0}),Nu=Zl(">=",function(n,t,o){return t>=o},function(n,t,o,l){return l.compare(t,o)>=0});class hd{constructor(t,o,l,h,f,g){this.type=$n,this.number=t,this.locale=o,this.currency=l,this.unit=h,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(t,o){if(3!==t.length)return o.error("Expected two arguments.");const l=o.parse(t[1],1,at);if(!l)return null;const h=t[2];if("object"!=typeof h||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=o.parse(h.locale,1,$n),!f))return null;let g=null;if(h.currency&&(g=o.parse(h.currency,1,$n),!g))return null;let v=null;if(h.unit&&(v=o.parse(h.unit,1,$n),!v))return null;let w=null;if(h["min-fraction-digits"]&&(w=o.parse(h["min-fraction-digits"],1,at),!w))return null;let E=null;return h["max-fraction-digits"]&&(E=o.parse(h["max-fraction-digits"],1,at),!E)?null:new hd(l,f,g,v,w,E)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class ia{constructor(t){this.type=at,this.input=t}static parse(t,o){if(2!==t.length)return o.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=o.parse(t[1],1);return l?"array"!==l.type.kind&&"string"!==l.type.kind&&"value"!==l.type.kind?o.error(`Expected argument of type string or array, but found ${Wi(l.type)} instead.`):new ia(l):null}evaluate(t){const o=this.input.evaluate(t);if("string"==typeof o||Array.isArray(o))return o.length;throw new vr(`Expected value to be of type string or array, but found ${Wi(Ui(o))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(o=>{t.push(o.serialize())}),t}}function ra(n){return function(){n=1831565813+(n|=0)|0;let t=Math.imul(n^n>>>15,1|n);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Wl={"==":dl,"!=":ur,">":Nc,"<":Fu,">=":Nu,"<=":Os,array:Ia,at:Kt,boolean:Ia,case:pr,coalesce:ud,collator:Ac,format:Cu,image:jr,in:qn,"index-of":us,interpolate:or,"interpolate-hcl":or,"interpolate-lab":or,length:ia,let:Nf,literal:nl,match:Yr,number:Ia,"number-format":hd,object:Ia,slice:Ps,step:Lu,string:Ia,"to-boolean":il,"to-color":il,"to-number":il,"to-string":il,var:lo,within:Oc,distance:ll,config:Bl};function Yl(n,[t,o,l,h]){t=t.evaluate(n),o=o.evaluate(n),l=l.evaluate(n);const f=h?h.evaluate(n):1,g=_m(t,o,l,f);if(g)throw new vr(g);return new ir(t/255*f,o/255*f,l/255*f,f)}function li(n,[t,o,l,h]){t=t.evaluate(n),o=o.evaluate(n),l=l.evaluate(n);const f=h?h.evaluate(n):1,g=(D=o,I=l,P=f,"number"==typeof(E=t)&&E>=0&&E<=360?"number"==typeof D&&D>=0&&D<=100&&"number"==typeof I&&I>=0&&I<=100?void 0===P||"number"==typeof P&&P>=0&&P<=1?null:`Invalid hsla value [${[E,D,I,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof P?[E,D,I,P]:[E,D,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof P?[E,D,I,P]:[E,D,I]).join(", ")}]: 'h' must be between 0 and 360.`);var E,D,I,P;if(g)throw new vr(g);const v=`hsla(${t}, ${o}%, ${l}%, ${f})`,w=ir.parse(v);if(!w)throw new vr(`Failed to parse HSLA color: ${v}`);return w}function Dm(n,t){return n in t}function zu(n,t){const o=t[n];return void 0===o?null:o}function fl(n){return{type:n}}kn.register(Wl,{error:[{kind:"error"},[$n],(n,[t])=>{throw new vr(t.evaluate(n))}],typeof:[$n,[On],(n,[t])=>Wi(Ui(t.evaluate(n)))],"to-rgba":[xt(at,4),[So],(n,[t])=>t.evaluate(n).toArray()],rgb:[So,[at,at,at],Yl],rgba:[So,[at,at,at,at],Yl],hsl:[So,[at,at,at],li],hsla:[So,[at,at,at,at],li],has:{type:Xn,overloads:[[[$n],(n,[t])=>Dm(t.evaluate(n),n.properties())],[[$n,wn],(n,[t,o])=>Dm(t.evaluate(n),o.evaluate(n))]]},get:{type:On,overloads:[[[$n],(n,[t])=>zu(t.evaluate(n),n.properties())],[[$n,wn],(n,[t,o])=>zu(t.evaluate(n),o.evaluate(n))]]},"feature-state":[On,[$n],(n,[t])=>zu(t.evaluate(n),n.featureState||{})],properties:[wn,[],n=>n.properties()],"geometry-type":[$n,[],n=>n.geometryType()],id:[On,[],n=>n.id()],zoom:[at,[],n=>n.globals.zoom],pitch:[at,[],n=>n.globals.pitch||0],"distance-from-center":[at,[],n=>n.distanceFromCenter()],"measure-light":[at,[$n],(n,[t])=>n.measureLight(t.evaluate(n))],"heatmap-density":[at,[],n=>n.globals.heatmapDensity||0],"line-progress":[at,[],n=>n.globals.lineProgress||0],"raster-value":[at,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[at,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[at,[],n=>n.globals.skyRadialProgress||0],accumulated:[On,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[at,fl(at),(n,t)=>{let o=0;for(const l of t)o+=l.evaluate(n);return o}],"*":[at,fl(at),(n,t)=>{let o=1;for(const l of t)o*=l.evaluate(n);return o}],"-":{type:at,overloads:[[[at,at],(n,[t,o])=>t.evaluate(n)-o.evaluate(n)],[[at],(n,[t])=>-t.evaluate(n)]]},"/":[at,[at,at],(n,[t,o])=>t.evaluate(n)/o.evaluate(n)],"%":[at,[at,at],(n,[t,o])=>t.evaluate(n)%o.evaluate(n)],ln2:[at,[],()=>Math.LN2],pi:[at,[],()=>Math.PI],e:[at,[],()=>Math.E],"^":[at,[at,at],(n,[t,o])=>Math.pow(t.evaluate(n),o.evaluate(n))],sqrt:[at,[at],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[at,[at],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[at,[at],(n,[t])=>Math.log(t.evaluate(n))],log2:[at,[at],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[at,[at],(n,[t])=>Math.sin(t.evaluate(n))],cos:[at,[at],(n,[t])=>Math.cos(t.evaluate(n))],tan:[at,[at],(n,[t])=>Math.tan(t.evaluate(n))],asin:[at,[at],(n,[t])=>Math.asin(t.evaluate(n))],acos:[at,[at],(n,[t])=>Math.acos(t.evaluate(n))],atan:[at,[at],(n,[t])=>Math.atan(t.evaluate(n))],min:[at,fl(at),(n,t)=>Math.min(...t.map(o=>o.evaluate(n)))],max:[at,fl(at),(n,t)=>Math.max(...t.map(o=>o.evaluate(n)))],abs:[at,[at],(n,[t])=>Math.abs(t.evaluate(n))],round:[at,[at],(n,[t])=>{const o=t.evaluate(n);return o<0?-Math.round(-o):Math.round(o)}],floor:[at,[at],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[at,[at],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Xn,[$n,On],(n,[t,o])=>n.properties()[t.value]===o.value],"filter-id-==":[Xn,[On],(n,[t])=>n.id()===t.value],"filter-type-==":[Xn,[$n],(n,[t])=>n.geometryType()===t.value],"filter-<":[Xn,[$n,On],(n,[t,o])=>{const l=n.properties()[t.value],h=o.value;return typeof l==typeof h&&l<h}],"filter-id-<":[Xn,[On],(n,[t])=>{const o=n.id(),l=t.value;return typeof o==typeof l&&o<l}],"filter->":[Xn,[$n,On],(n,[t,o])=>{const l=n.properties()[t.value],h=o.value;return typeof l==typeof h&&l>h}],"filter-id->":[Xn,[On],(n,[t])=>{const o=n.id(),l=t.value;return typeof o==typeof l&&o>l}],"filter-<=":[Xn,[$n,On],(n,[t,o])=>{const l=n.properties()[t.value],h=o.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[Xn,[On],(n,[t])=>{const o=n.id(),l=t.value;return typeof o==typeof l&&o<=l}],"filter->=":[Xn,[$n,On],(n,[t,o])=>{const l=n.properties()[t.value],h=o.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[Xn,[On],(n,[t])=>{const o=n.id(),l=t.value;return typeof o==typeof l&&o>=l}],"filter-has":[Xn,[On],(n,[t])=>t.value in n.properties()],"filter-has-id":[Xn,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[Xn,[xt($n)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Xn,[xt(On)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Xn,[$n,xt(On)],(n,[t,o])=>o.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Xn,[$n,xt(On)],(n,[t,o])=>function(l,h,f,g){for(;f<=g;){const v=f+g>>1;if(h[v]===l)return!0;h[v]>l?g=v-1:f=v+1}return!1}(n.properties()[t.value],o.value,0,o.value.length-1)],all:{type:Xn,overloads:[[[Xn,Xn],(n,[t,o])=>t.evaluate(n)&&o.evaluate(n)],[fl(Xn),(n,t)=>{for(const o of t)if(!o.evaluate(n))return!1;return!0}]]},any:{type:Xn,overloads:[[[Xn,Xn],(n,[t,o])=>t.evaluate(n)||o.evaluate(n)],[fl(Xn),(n,t)=>{for(const o of t)if(o.evaluate(n))return!0;return!1}]]},"!":[Xn,[Xn],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Xn,[$n],(n,[t])=>{const o=n.globals&&n.globals.isSupportedScript;return!o||o(t.evaluate(n))}],upcase:[$n,[$n],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[$n,[$n],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[$n,fl(On),(n,t)=>t.map(o=>Ts(o.evaluate(n))).join("")],"resolved-locale":[$n,[Mc],(n,[t])=>t.evaluate(n).resolvedLocale()],random:[at,[at,at,On],(n,t)=>{const[o,l,h]=t.map(g=>g.evaluate(n));if(o>l||o===l)return o;let f;if("string"==typeof h)f=function(g){let v=0;if(0===g.length)return v;for(let w=0;w<g.length;w++)v=(v<<5)-v+g.charCodeAt(w),v|=0;return v}(h);else{if("number"!=typeof h)throw new vr(`Invalid seed input: ${h}`);f=h}return o+ra(f)()*(l-o)}]});var _o=Wl;function zc(n){return{result:"success",value:n}}function ds(n){return{result:"error",value:n}}function Bc(n,t){return!!n&&!!n.parameters&&n.parameters.indexOf(t)>-1}function Mr(n){return"data-driven"===n["property-type"]}function Tm(n){return Bc(n.expression,"measure-light")}function yo(n){return Bc(n.expression,"zoom")}function Xr(n){return!!n.expression&&n.expression.interpolated}function Vc(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function pl(n){return n}function jc(n,t){const o="color"===t.type,l=n.stops&&"object"==typeof n.stops[0][0],h=l||!(l||void 0!==n.property),f=n.type||(Xr(t)?"exponential":"interval");if(o&&((n=wu({},n)).stops&&(n.stops=n.stops.map(E=>[E[0],ir.parse(E[1])])),n.default=ir.parse(n.default?n.default:t.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!Fr[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,v,w;if("exponential"===f)g=Mm;else if("interval"===f)g=F_;else if("categorical"===f){g=zf,v=Object.create(null);for(const E of n.stops)v[E[0]]=E[1];w=typeof n.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);g=N_}if(l){const E={},D=[];for(let L=0;L<n.stops.length;L++){const N=n.stops[L],B=N[0].zoom;void 0===E[B]&&(E[B]={zoom:B,type:n.type,property:n.property,default:n.default,stops:[]},D.push(B)),E[B].stops.push([N[0].value,N[1]])}const I=[];for(const L of D)I.push([E[L].zoom,jc(E[L],t)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:or.interpolationFactor.bind(void 0,P),zoomStops:I.map(L=>L[0]),evaluate:({zoom:L},N)=>Mm({stops:I,base:n.base},t,L).evaluate(L,N)}}if(h){const E="exponential"===f?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:or.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map(D=>D[0]),evaluate:({zoom:D})=>g(n,t,D,v,w)}}return{kind:"source",evaluate(E,D){const I=D&&D.properties?D.properties[n.property]:void 0;return void 0===I?vo(n.default,t.default):g(n,t,I,v,w)}}}function vo(n,t,o){return void 0!==n?n:void 0!==t?t:void 0!==o?o:void 0}function zf(n,t,o,l,h){return vo(typeof o===h?l[o]:void 0,n.default,t.default)}function F_(n,t,o){if("number"!==gn(o))return vo(n.default,t.default);const l=n.stops.length;if(1===l||o<=n.stops[0][0])return n.stops[0][1];if(o>=n.stops[l-1][0])return n.stops[l-1][1];const h=jl(n.stops.map(f=>f[0]),o);return n.stops[h][1]}function Mm(n,t,o){const l=void 0!==n.base?n.base:1;if("number"!==gn(o))return vo(n.default,t.default);const h=n.stops.length;if(1===h||o<=n.stops[0][0])return n.stops[0][1];if(o>=n.stops[h-1][0])return n.stops[h-1][1];const f=jl(n.stops.map(D=>D[0]),o),g=function(D,I,P,L){const N=L-P,B=D-P;return 0===N?0:1===I?B/N:(Math.pow(I,B)-1)/(Math.pow(I,N)-1)}(o,l,n.stops[f][0],n.stops[f+1][0]),v=n.stops[f][1],w=n.stops[f+1][1];let E=bu[t.type]||pl;if(n.colorSpace&&"rgb"!==n.colorSpace){const D=Fr[n.colorSpace];E=(I,P)=>D.reverse(D.interpolate(D.forward(I),D.forward(P),g))}return"function"==typeof v.evaluate?{evaluate(...D){const I=v.evaluate.apply(void 0,D),P=w.evaluate.apply(void 0,D);if(void 0!==I&&void 0!==P)return E(I,P,g)}}:E(v,w,g)}function N_(n,t,o){return"color"===t.type?o=ir.parse(o):"formatted"===t.type?o=Li.fromString(o.toString()):"resolvedImage"===t.type?o=Ut.fromString(o.toString()):gn(o)===t.type||"enum"===t.type&&t.values[o]||(o=void 0),vo(o,n.default,t.default)}class dd{constructor(t,o,l,h){var f;this.expression=t,this._warningHistory={},this._evaluator=new A_(l,h),this._defaultValue=o?"color"===(f=o).type&&(Vc(f.default)||Array.isArray(f.default))?new ir(0,0,0,0):"color"===f.type?ir.parse(f.default)||null:void 0===f.default?null:f.default:null,this._enumValues=o&&"enum"===o.type?o.values:null}evaluateWithoutErrorHandling(t,o,l,h,f,g,v,w){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=l,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(t,o,l,h,f,g,v,w){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(null==E||"number"==typeof E&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new vr(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Bu(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in _o}function Bf(n,t,o,l){const h=new bm(_o,[],t?function(g){const v={color:So,string:$n,number:at,enum:$n,boolean:Xn,formatted:Eu,resolvedImage:Ic};return"array"===g.type?xt(v[g.value]||On,g.length):v[g.type]}(t):void 0,void 0,void 0,o,l),f=h.parse(n,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return f?zc(new dd(f,t,o,l)):ds(h.errors)}class Im{constructor(t,o,l){this.kind=t,this._styleExpression=o,this.isLightConstant=l,this.isStateDependent="constant"!==t&&!Aa(o.expression),this.isConfigDependent=!Fc(o.expression)}evaluateWithoutErrorHandling(t,o,l,h,f,g){return this._styleExpression.evaluateWithoutErrorHandling(t,o,l,h,f,g)}evaluate(t,o,l,h,f,g){return this._styleExpression.evaluate(t,o,l,h,f,g)}}class fd{constructor(t,o,l,h,f){this.kind=t,this.zoomStops=l,this._styleExpression=o,this.isStateDependent="camera"!==t&&!Aa(o.expression),this.isLightConstant=f,this.isConfigDependent=!Fc(o.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,o,l,h,f,g){return this._styleExpression.evaluateWithoutErrorHandling(t,o,l,h,f,g)}evaluate(t,o,l,h,f,g){return this._styleExpression.evaluate(t,o,l,h,f,g)}interpolationFactor(t,o,l){return this.interpolationType?or.interpolationFactor(this.interpolationType,t,o,l):0}}function Vf(n,t,o,l){if("error"===(n=Bf(n,t,o,l)).result)return n;const h=n.value.expression,f=Vl(h);if(!f&&!Mr(t))return ds([new Ds("","data expressions not supported")]);const g=kr(h,["zoom","pitch","distance-from-center"]);if(!g&&!yo(t))return ds([new Ds("","zoom expressions not supported")]);const v=kr(h,["measure-light"]);if(!v&&!Tm(t))return ds([new Ds("","measure-light expression not supported")]);const w=t.expression&&t.expression.relaxZoomRestriction,E=md(h);return E||g||w?E instanceof Ds?ds([E]):E instanceof or&&!Xr(t)?ds([new Ds("",'"interpolate" expressions cannot be used with this property')]):zc(E?new fd(f?"camera":"composite",n.value,E.labels,E instanceof or?E.interpolation:void 0,v):new Im(f?"constant":"source",n.value,v)):ds([new Ds("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class pd{constructor(t,o){this._parameters=t,this._specification=o,wu(this,jc(this._parameters,this._specification))}static deserialize(t){return new pd(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function md(n){let t=null;if(n instanceof Nf)t=md(n.result);else if(n instanceof ud){for(const o of n.args)if(t=md(o),t)break}else(n instanceof Lu||n instanceof or)&&n.input instanceof kn&&"zoom"===n.input.name&&(t=n);return t instanceof Ds||n.eachChild(o=>{const l=md(o);l instanceof Ds?t=l:t&&l&&t!==l&&(t=new Ds("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var _0=sa,oa=3;function sa(n,t,o){var l=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var h=new Int32Array(this.arrayBuffer);n=h[0],this.d=(t=h[1])+2*(o=h[2]);for(var f=0;f<this.d*this.d;f++){var g=h[oa+f],v=h[oa+f+1];l.push(g===v?null:h.subarray(g,v))}var w=h[oa+l.length+1];this.keys=h.subarray(h[oa+l.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=t+2*o;for(var E=0;E<this.d*this.d;E++)l.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=n,this.padding=o,this.scale=t/n,this.uid=0;var D=o/t*n;this.min=-D,this.max=n+D}sa.prototype.insert=function(n,t,o,l,h){this._forEachCell(t,o,l,h,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(t),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(h)},sa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},sa.prototype._insertCell=function(n,t,o,l,h,f){this.cells[h].push(f)},sa.prototype.query=function(n,t,o,l,h){var f=this.min,g=this.max;if(n<=f&&t<=f&&g<=o&&g<=l&&!h)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(n,t,o,l,this._queryCell,v,{},h),v},sa.prototype._queryCell=function(n,t,o,l,h,f,g,v){var w=this.cells[h];if(null!==w)for(var E=this.keys,D=this.bboxes,I=0;I<w.length;I++){var P=w[I];if(void 0===g[P]){var L=4*P;(v?v(D[L+0],D[L+1],D[L+2],D[L+3]):n<=D[L+2]&&t<=D[L+3]&&o>=D[L+0]&&l>=D[L+1])?(g[P]=!0,f.push(E[P])):g[P]=!1}}},sa.prototype._forEachCell=function(n,t,o,l,h,f,g,v){for(var w=this._convertToCellCoord(n),E=this._convertToCellCoord(t),D=this._convertToCellCoord(o),I=this._convertToCellCoord(l),P=w;P<=D;P++)for(var L=E;L<=I;L++){var N=this.d*L+P;if((!v||v(this._convertFromCellCoord(P),this._convertFromCellCoord(L),this._convertFromCellCoord(P+1),this._convertFromCellCoord(L+1)))&&h.call(this,n,t,o,l,N,f,g,v))return}},sa.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},sa.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},sa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,t=oa+this.cells.length+1+1,o=0,l=0;l<this.cells.length;l++)o+=this.cells[l].length;var h=new Int32Array(t+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var f=t,g=0;g<n.length;g++){var v=n[g];h[oa+g]=f,h.set(v,f),f+=v.length}return h[oa+n.length]=f,h.set(this.keys,f),h[oa+n.length+1]=f+=this.keys.length,h.set(this.bboxes,f),f+=this.bboxes.length,h.buffer};var ml=$o(_0);const gd={};function Ct(n,t,o={}){Object.defineProperty(n,"_classRegistryKey",{value:t,writeable:!1}),gd[t]={klass:n,omit:o.omit||[]}}Ct(Object,"Object"),ml.serialize=function(n,t){const o=n.toArrayBuffer();return t&&t.add(o),{buffer:o}},ml.deserialize=function(n){return new ml(n.buffer)},Object.defineProperty(ml,"name",{value:"Grid"}),Ct(ml,"Grid"),Ct(ir,"Color"),Ct(Error,"Error"),Ct(Li,"Formatted"),Ct(tl,"FormattedSection"),Ct(cr,"AJAXError"),Ct(Ut,"ResolvedImage"),Ct(pd,"StylePropertyFunction"),Ct(dd,"StyleExpression",{omit:["_evaluator"]}),Ct(fd,"ZoomDependentExpression"),Ct(Im,"ZoomConstantExpression"),Ct(kn,"CompoundExpression",{omit:["_evaluate"]});for(const n in _o)gd[_o[n]._classRegistryKey]||Ct(_o[n],`Expression${n}`);function jf(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function Vu(n){return self.ImageBitmap&&n instanceof ImageBitmap}function Xl(n,t){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(jf(n)||Vu(n))return t&&t.add(n),n;if(ArrayBuffer.isView(n)){const o=n;return t&&t.add(o.buffer),o}if(n instanceof ImageData)return t&&t.add(n.data.buffer),n;if(Array.isArray(n)){const o=[];for(const l of n)o.push(Xl(l,t));return o}if(n instanceof Map){const o={$name:"Map"};for(const[l,h]of n.entries())o[l]=Xl(h);return o}if("object"==typeof n){const o=n.constructor,l=o._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);const h=o.serialize?o.serialize(n,t):{};if(!o.serialize){for(const f in n)n.hasOwnProperty(f)&&(gd[l].omit.indexOf(f)>=0||(h[f]=Xl(n[f],t)));n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof n)}function Uc(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||jf(n)||Vu(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Uc);if("object"==typeof n){const t=n.$name||"Object";if("Map"===t){const h=new Map;for(const f of Object.keys(n))"$name"!==f&&h.set(f,Uc(n[f]));return h}const{klass:o}=gd[t];if(!o)throw new Error(`can't deserialize unregistered class ${t}`);if(o.deserialize)return o.deserialize(n);const l=Object.create(o.prototype);for(const h of Object.keys(n))"$name"!==h&&(l[h]=Uc(n[h]));return l}throw new Error("can't deserialize object of type "+typeof n)}const At={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function Ro(n){for(const t of n)if(Sm(t.charCodeAt(0)))return!0;return!1}function gl(n){for(const t of n)if(!y0(t.charCodeAt(0)))return!1;return!0}function y0(n){return!(At.Arabic(n)||At["Arabic Supplement"](n)||At["Arabic Extended-A"](n)||At["Arabic Presentation Forms-A"](n)||At["Arabic Presentation Forms-B"](n))}function Sm(n){return!(746!==n&&747!==n&&(n<4352||!(At["Bopomofo Extended"](n)||At.Bopomofo(n)||At["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||At["CJK Compatibility Ideographs"](n)||At["CJK Compatibility"](n)||At["CJK Radicals Supplement"](n)||At["CJK Strokes"](n)||!(!At["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||At["CJK Unified Ideographs Extension A"](n)||At["CJK Unified Ideographs"](n)||At["Enclosed CJK Letters and Months"](n)||At["Hangul Compatibility Jamo"](n)||At["Hangul Jamo Extended-A"](n)||At["Hangul Jamo Extended-B"](n)||At["Hangul Jamo"](n)||At["Hangul Syllables"](n)||At.Hiragana(n)||At["Ideographic Description Characters"](n)||At.Kanbun(n)||At["Kangxi Radicals"](n)||At["Katakana Phonetic Extensions"](n)||At.Katakana(n)&&12540!==n||!(!At["Halfwidth and Fullwidth Forms"](n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!At["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||At["Unified Canadian Aboriginal Syllabics"](n)||At["Unified Canadian Aboriginal Syllabics Extended"](n)||At["Vertical Forms"](n)||At["Yijing Hexagram Symbols"](n)||At["Yi Syllables"](n)||At["Yi Radicals"](n))))}function Ur(n){return!(Sm(n)||(t=n,At["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||At["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||At["Letterlike Symbols"](t)||At["Number Forms"](t)||At["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||At["Control Pictures"](t)&&9251!==t||At["Optical Character Recognition"](t)||At["Enclosed Alphanumerics"](t)||At["Geometric Shapes"](t)||At["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||At["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||At["CJK Symbols and Punctuation"](t)||At.Katakana(t)||At["Private Use Area"](t)||At["CJK Compatibility Forms"](t)||At["Small Form Variants"](t)||At["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t}function ju(n){return n>=1424&&n<=2303||At["Arabic Presentation Forms-A"](n)||At["Arabic Presentation Forms-B"](n)}function Wo(n,t){return!(!t&&ju(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||At.Khmer(n))}function _d(n){for(const t of n)if(ju(t.charCodeAt(0)))return!0;return!1}const yd="deferred",vd="loading",xd="loaded";let Uu=null,xo="unavailable",aa=null;const bd=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(xo="error"),Uu&&Uu(n)};function wd(){Ed.fire(new el("pluginStateChange",{pluginStatus:xo,pluginURL:aa}))}const Ed=new Tc,Pa=function(){return xo},$c=function(){if(xo!==yd||!aa)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");xo=vd,wd(),aa&&ze({url:aa},n=>{n?bd(n):(xo=xd,wd())})},Kr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>xo===xd||null!=Kr.applyArabicShaping,isLoading:()=>xo===vd,setState(n){xo=n.pluginStatus,aa=n.pluginURL},isParsed:()=>null!=Kr.applyArabicShaping&&null!=Kr.processBidirectionalText&&null!=Kr.processStyledBidirectionalText,getPluginURL:()=>aa};class Mi{constructor(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(o,l){for(const h of o)if(!Wo(h.charCodeAt(0),l))return!1;return!0}(t,Kr.isLoaded())}}class $u{constructor(t,o,l,h){this.property=t,this.value=o,this.expression=function(f,g,v,w){if(Vc(f))return new pd(f,g);if(Bu(f)||Array.isArray(f)&&f.length>0){const E=Vf(f,g,v,w);if("error"===E.result)throw new Error(E.value.map(D=>`${D.key}: ${D.message}`).join(", "));return E.value}{let E=f;return"string"==typeof f&&"color"===g.type&&(E=ir.parse(f)),{kind:"constant",isConfigDependent:!1,evaluate:()=>E}}}(void 0===o?t.specification.default:o,t.specification,l,h)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,o,l){return this.property.possiblyEvaluate(this,t,o,l)}}class Am{constructor(t,o,l){this.property=t,this.value=new $u(t,void 0,o,l)}transitioned(t,o){return new Rm(this.property,this.value,o,Vr({},t.transition,this.transition),t.now)}untransitioned(){return new Rm(this.property,this.value,null,{},0)}}class _l{constructor(t,o,l){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=o,this._options=l,this.isConfigDependent=!1}getValue(t){return ti(this._values[t].value.value)}setValue(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new Am(this._values[t].property,this._scope,this._options)),this._values[t].value=new $u(this._values[t].property,null===o?void 0:ti(o),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,o){o&&(this._options=o);const l=this._properties.properties;if(t)for(const h in t){const f=t[h];if(Fi(h,"-transition")){const g=h.slice(0,-11);l[g]&&this.setTransition(g,f)}else l[h]&&this.setValue(h,f)}}getTransition(t){return ti(this._values[t].transition)}setTransition(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new Am(this._values[t].property)),this._values[t].transition=ti(o)||void 0}serialize(){const t={};for(const o of Object.keys(this._values)){const l=this.getValue(o);void 0!==l&&(t[o]=l);const h=this.getTransition(o);void 0!==h&&(t[`${o}-transition`]=h)}return t}transitioned(t,o){const l=new Kl(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(t,o._values[h]);return l}untransitioned(){const t=new Kl(this._properties);for(const o of Object.keys(this._values))t._values[o]=this._values[o].untransitioned();return t}}class Rm{constructor(t,o,l,h,f){const g=h.delay||0,v=h.duration||0;f=f||0,this.property=t,this.value=o,this.begin=f+g,this.end=this.begin+v,t.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(t,o,l){const h=t.now||0,f=this.value.possiblyEvaluate(t,o,l),g=this.prior;if(g){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return g.possiblyEvaluate(t,o,l);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,o,l),f,_t(v))}}return f}}class Kl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,o,l){const h=new Gc(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(t,o,l);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class z_{constructor(t,o,l){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=o,this._options=l,this.isConfigDependent=!1}getValue(t){return ti(this._values[t].value)}setValue(t,o){this._values[t]=new $u(this._values[t].property,null===o?void 0:ti(o),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const o of Object.keys(this._values)){const l=this.getValue(o);void 0!==l&&(t[o]=l)}return t}possiblyEvaluate(t,o,l){const h=new Gc(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(t,o,l);return h}}class Gu{constructor(t,o,l){this.property=t,this.value=o,this.parameters=l}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,o,l,h){return this.property.evaluate(this.value,this.parameters,t,o,l,h)}}class Gc{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class nt{constructor(t){this.specification=t}possiblyEvaluate(t,o){return t.expression.evaluate(o)}interpolate(t,o,l){const h=bu[this.specification.type];return h?h(t,o,l):t}}class Vt{constructor(t,o){this.specification=t,this.overrides=o}possiblyEvaluate(t,o,l,h){return new Gu(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(o,null,{},l,h)}:t.expression,o)}interpolate(t,o,l){if("constant"!==t.value.kind||"constant"!==o.value.kind)return t;if(void 0===t.value.value||void 0===o.value.value)return new Gu(this,{kind:"constant",value:void 0},t.parameters);const h=bu[this.specification.type];return h?new Gu(this,{kind:"constant",value:h(t.value.value,o.value.value,l)},t.parameters):t}evaluate(t,o,l,h,f,g){return"constant"===t.kind?t.value:t.evaluate(o,l,h,f,g)}}class Oa{constructor(t){this.specification=t}possiblyEvaluate(t,o,l,h){return!!t.expression.evaluate(o,null,{},l,h)}interpolate(){return!1}}class Xi{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new Mi(0,{});for(const l in t){const h=t[l];h.specification.overridable&&this.overridableProperties.push(l);const f=this.defaultPropertyValues[l]=new $u(h,void 0),g=this.defaultTransitionablePropertyValues[l]=new Am(h);this.defaultTransitioningPropertyValues[l]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=f.possiblyEvaluate(o)}}}function Cd(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Hu(n){if(Array.isArray(n))return n.map(Hu);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const o in n)t[o]=Hu(n[o]);return t}return Cd(n)}Ct(Vt,"DataDrivenProperty"),Ct(nt,"DataConstantProperty"),Ct(Oa,"ColorRampProperty");var Ce=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Dd(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!Dd(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Yo(n,t="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Dd(n)||(n=Td(n));const o=n;let l=!0;try{l=function(E){if(!Jl(E))return E;let D=Hu(E);return Uf(D),D=Pm(D),D}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(o,null,2)}\n        `)}const h=Ce[`filter_${t}`],f=Bf(l,h);let g=null;if("error"===f.result)throw new Error(f.value.map(E=>`${E.key}: ${E.message}`).join(", "));g=(E,D,I)=>f.value.evaluate(E,D,{},I);let v=null,w=null;if(l!==o){const E=Bf(o,h);if("error"===E.result)throw new Error(E.value.map(D=>`${D.key}: ${D.message}`).join(", "));v=(D,I,P,L,N)=>E.value.evaluate(D,I,{},P,void 0,void 0,L,N),w=!Vl(E.value.expression)}return{filter:g,dynamicFilter:v||void 0,needGeometry:km(l),needFeature:!!w}}function Pm(n){if(!Array.isArray(n))return n;const t=function(o){if(B_.has(o[0]))for(let l=1;l<o.length;l++)if(Jl(o[l]))return!0;return o}(n);return!0===t?t:t.map(o=>Pm(o))}function Uf(n){let t=!1;const o=[];if("case"===n[0]){for(let l=1;l<n.length-1;l+=2)t=t||Jl(n[l]),o.push(n[l+1]);o.push(n[n.length-1])}else if("match"===n[0]){t=t||Jl(n[1]);for(let l=2;l<n.length-1;l+=2)o.push(n[l+1]);o.push(n[n.length-1])}else if("step"===n[0]){t=t||Jl(n[1]);for(let l=1;l<n.length-1;l+=2)o.push(n[l+1])}t&&(n.length=0,n.push("any",...o));for(let l=1;l<n.length;l++)Uf(n[l])}function Jl(n){if(!Array.isArray(n))return!1;if("pitch"===(t=n[0])||"distance-from-center"===t)return!0;var t;for(let o=1;o<n.length;o++)if(Jl(n[o]))return!0;return!1}const B_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Om(n,t){return n<t?-1:n>t?1:0}function km(n){if(!Array.isArray(n))return!1;if("within"===n[0]||"distance"===n[0])return!0;for(let t=1;t<n.length;t++)if(km(n[t]))return!0;return!1}function Td(n){if(!n)return!0;const t=n[0];return n.length<=1?"any"!==t:"=="===t?qu(n[1],n[2],"=="):"!="===t?Zu(qu(n[1],n[2],"==")):"<"===t||">"===t||"<="===t||">="===t?qu(n[1],n[2],t):"any"===t?(o=n.slice(1),["any"].concat(o.map(Td))):"all"===t?["all"].concat(n.slice(1).map(Td)):"none"===t?["all"].concat(n.slice(1).map(Td).map(Zu)):"in"===t?la(n[1],n.slice(2)):"!in"===t?Zu(la(n[1],n.slice(2))):"has"===t?$f(n[1]):"!has"!==t||Zu($f(n[1]));var o}function qu(n,t,o){switch(n){case"$type":return[`filter-type-${o}`,t];case"$id":return[`filter-id-${o}`,t];default:return[`filter-${o}`,n,t]}}function la(n,t){if(0===t.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(o=>typeof o!=typeof t[0])?["filter-in-large",n,["literal",t.sort(Om)]]:["filter-in-small",n,["literal",t]]}}function $f(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Zu(n){return["!",n]}function Id(n,t){return t?`${n}\x1f${t}`:n}const Hc="-transition";class Po extends Tc{constructor(t,o,l,h){if(super(),this.id=t.id,this.fqid=Id(this.id,l),this.type=t.type,this.scope=l,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&"slot"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),t.slot&&(this.slot=t.slot),o.layout&&(this._unevaluatedLayout=new z_(o.layout,this.scope,h),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),o.paint)){this._transitionablePaint=new _l(o.paint,this.scope,h);for(const f in t.paint)this.setPaintProperty(f,t.paint[f]);for(const f in t.layout)this.setLayoutProperty(f,t.layout[f]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Gc(o.paint)}}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,o){if("custom"===this.type&&"visibility"===t)return void(this.visibility=o);const l=this._unevaluatedLayout;l._properties.properties[t]&&(l.setValue(t,o),this.isConfigDependent=this.isConfigDependent||l.isConfigDependent,"visibility"===t&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return Fi(t,Hc)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,o){const l=this._transitionablePaint,h=l._properties.properties;if(Fi(t,Hc)){const I=t.slice(0,-11);return h[I]&&l.setTransition(I,o||void 0),!1}if(!h[t])return!1;const f=l._values[t],g=f.value.isDataDriven(),v=f.value;l.setValue(t,o),this.isConfigDependent=this.isConfigDependent||l.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const w=l._values[t].value,E=w.isDataDriven(),D=Fi(t,"pattern")||"line-dasharray"===t;return E||g||D||this._handleOverridablePaintPropertyUpdate(t,v,w)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,o){return null}_handleOverridablePaintPropertyUpdate(t,o,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,o)}serialize(){return os({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,o)=>!(void 0===t||"layout"===o&&!Object.keys(t).length||"paint"===o&&!Object.keys(t).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const o=this.paint.get(t);if(o instanceof Gu&&Mr(o.property.specification)&&("source"===o.value.kind||"composite"===o.value.kind)&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Yo(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&("shadow"===t.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}const Gf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Sd{constructor(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ii{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,o){return t._trim(),o&&(t.isTransferred=!0,o.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ei(n,t=1){let o=0,l=0;return{members:n.map(h=>{const f=Gf[h.type].BYTES_PER_ELEMENT,g=o=qc(o,Math.max(t,f)),v=h.components||1;return l=Math.max(l,f),o+=f*v,{name:h.name,type:h.type,components:v,offset:g}}),size:qc(o,Math.max(l,t)),alignment:t}}function qc(n,t){return Math.ceil(n/t)*t}class mi extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,o)}emplace(t,o,l){const h=2*t;return this.int16[h+0]=o,this.int16[h+1]=l,t}}mi.prototype.bytesPerElement=4,Ct(mi,"StructArrayLayout2i4");class Jr extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,o,l)}emplace(t,o,l,h){const f=3*t;return this.int16[f+0]=o,this.int16[f+1]=l,this.int16[f+2]=h,t}}Jr.prototype.bytesPerElement=6,Ct(Jr,"StructArrayLayout3i6");class fs extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,l,h)}emplace(t,o,l,h,f){const g=4*t;return this.int16[g+0]=o,this.int16[g+1]=l,this.int16[g+2]=h,this.int16[g+3]=f,t}}fs.prototype.bytesPerElement=8,Ct(fs,"StructArrayLayout4i8");class co extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,o,l,h,f)}emplace(t,o,l,h,f,g){const v=5*t;return this.int16[v+0]=o,this.int16[v+1]=l,this.int16[v+2]=h,this.int16[v+3]=f,this.int16[v+4]=g,t}}co.prototype.bytesPerElement=10,Ct(co,"StructArrayLayout5i10");class Hf extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,o,l,h,f,g,v)}emplace(t,o,l,h,f,g,v,w){const E=6*t,D=12*t,I=3*t;return this.int16[E+0]=o,this.int16[E+1]=l,this.uint8[D+4]=h,this.uint8[D+5]=f,this.uint8[D+6]=g,this.uint8[D+7]=v,this.float32[I+2]=w,t}}Hf.prototype.bytesPerElement=12,Ct(Hf,"StructArrayLayout2i4ub1f12");class ka extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,l,h)}emplace(t,o,l,h,f){const g=4*t;return this.float32[g+0]=o,this.float32[g+1]=l,this.float32[g+2]=h,this.float32[g+3]=f,t}}ka.prototype.bytesPerElement=16,Ct(ka,"StructArrayLayout4f16");class Xo extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,o,l,h,f)}emplace(t,o,l,h,f,g){const v=6*t,w=3*t;return this.uint16[v+0]=o,this.uint16[v+1]=l,this.uint16[v+2]=h,this.uint16[v+3]=f,this.float32[w+2]=g,t}}Xo.prototype.bytesPerElement=12,Ct(Xo,"StructArrayLayout4ui1f12");class $r extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,l,h)}emplace(t,o,l,h,f){const g=4*t;return this.uint16[g+0]=o,this.uint16[g+1]=l,this.uint16[g+2]=h,this.uint16[g+3]=f,t}}$r.prototype.bytesPerElement=8,Ct($r,"StructArrayLayout4ui8");class Ad extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,t,o,l,h,f,g)}emplace(t,o,l,h,f,g,v){const w=6*t;return this.int16[w+0]=o,this.int16[w+1]=l,this.int16[w+2]=h,this.int16[w+3]=f,this.int16[w+4]=g,this.int16[w+5]=v,t}}Ad.prototype.bytesPerElement=12,Ct(Ad,"StructArrayLayout6i12");class Wu extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f,g,v,w,E,D,I,P){const L=this.length;return this.resize(L+1),this.emplace(L,t,o,l,h,f,g,v,w,E,D,I,P)}emplace(t,o,l,h,f,g,v,w,E,D,I,P,L){const N=12*t;return this.int16[N+0]=o,this.int16[N+1]=l,this.int16[N+2]=h,this.int16[N+3]=f,this.uint16[N+4]=g,this.uint16[N+5]=v,this.uint16[N+6]=w,this.uint16[N+7]=E,this.int16[N+8]=D,this.int16[N+9]=I,this.int16[N+10]=P,this.int16[N+11]=L,t}}Wu.prototype.bytesPerElement=24,Ct(Wu,"StructArrayLayout4i4ui4i24");class qf extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,t,o,l,h,f,g)}emplace(t,o,l,h,f,g,v){const w=10*t,E=5*t;return this.int16[w+0]=o,this.int16[w+1]=l,this.int16[w+2]=h,this.float32[E+2]=f,this.float32[E+3]=g,this.float32[E+4]=v,t}}qf.prototype.bytesPerElement=20,Ct(qf,"StructArrayLayout3i3f20");class ca extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint32[1*t+0]=o,t}}ca.prototype.bytesPerElement=4,Ct(ca,"StructArrayLayout1ul4");class ks extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,o)}emplace(t,o,l){const h=2*t;return this.uint16[h+0]=o,this.uint16[h+1]=l,t}}ks.prototype.bytesPerElement=4,Ct(ks,"StructArrayLayout2ui4");class Zf extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f,g,v,w,E,D,I,P,L){const N=this.length;return this.resize(N+1),this.emplace(N,t,o,l,h,f,g,v,w,E,D,I,P,L)}emplace(t,o,l,h,f,g,v,w,E,D,I,P,L,N){const B=20*t,U=10*t;return this.int16[B+0]=o,this.int16[B+1]=l,this.int16[B+2]=h,this.int16[B+3]=f,this.int16[B+4]=g,this.float32[U+3]=v,this.float32[U+4]=w,this.float32[U+5]=E,this.float32[U+6]=D,this.int16[B+14]=I,this.uint32[U+8]=P,this.uint16[B+18]=L,this.uint16[B+19]=N,t}}Zf.prototype.bytesPerElement=40,Ct(Zf,"StructArrayLayout5i4f1i1ul2ui40");class Zc extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,o,l,h,f,g,v)}emplace(t,o,l,h,f,g,v,w){const E=8*t;return this.int16[E+0]=o,this.int16[E+1]=l,this.int16[E+2]=h,this.int16[E+4]=f,this.int16[E+5]=g,this.int16[E+6]=v,this.int16[E+7]=w,t}}Zc.prototype.bytesPerElement=16,Ct(Zc,"StructArrayLayout3i2i2i16");class Yu extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,o,l,h,f)}emplace(t,o,l,h,f,g){const v=4*t,w=8*t;return this.float32[v+0]=o,this.float32[v+1]=l,this.float32[v+2]=h,this.int16[w+6]=f,this.int16[w+7]=g,t}}Yu.prototype.bytesPerElement=16,Ct(Yu,"StructArrayLayout2f1f2i16");class Rd extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,l,h)}emplace(t,o,l,h,f){const g=12*t,v=3*t;return this.uint8[g+0]=o,this.uint8[g+1]=l,this.float32[v+1]=h,this.float32[v+2]=f,t}}Rd.prototype.bytesPerElement=12,Ct(Rd,"StructArrayLayout2ub2f12");class Ir extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,o,l)}emplace(t,o,l,h){const f=3*t;return this.uint16[f+0]=o,this.uint16[f+1]=l,this.uint16[f+2]=h,t}}Ir.prototype.bytesPerElement=6,Ct(Ir,"StructArrayLayout3ui6");class _n extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f,g,v,w,E,D,I,P,L,N,B,U,H,Q,ne,ie,ue){const ae=this.length;return this.resize(ae+1),this.emplace(ae,t,o,l,h,f,g,v,w,E,D,I,P,L,N,B,U,H,Q,ne,ie,ue)}emplace(t,o,l,h,f,g,v,w,E,D,I,P,L,N,B,U,H,Q,ne,ie,ue,ae){const de=30*t,ye=15*t,be=60*t;return this.int16[de+0]=o,this.int16[de+1]=l,this.int16[de+2]=h,this.float32[ye+2]=f,this.float32[ye+3]=g,this.uint16[de+8]=v,this.uint16[de+9]=w,this.uint32[ye+5]=E,this.uint32[ye+6]=D,this.uint32[ye+7]=I,this.uint16[de+16]=P,this.uint16[de+17]=L,this.uint16[de+18]=N,this.float32[ye+10]=B,this.float32[ye+11]=U,this.uint8[be+48]=H,this.uint8[be+49]=Q,this.uint8[be+50]=ne,this.uint32[ye+13]=ie,this.int16[de+28]=ue,this.uint8[be+58]=ae,t}}_n.prototype.bytesPerElement=60,Ct(_n,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Xu extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f,g,v,w,E,D,I,P,L,N,B,U,H,Q,ne,ie,ue,ae,de,ye,be,Te,we,Oe,Ge,Re,Ve,Ie){const je=this.length;return this.resize(je+1),this.emplace(je,t,o,l,h,f,g,v,w,E,D,I,P,L,N,B,U,H,Q,ne,ie,ue,ae,de,ye,be,Te,we,Oe,Ge,Re,Ve,Ie)}emplace(t,o,l,h,f,g,v,w,E,D,I,P,L,N,B,U,H,Q,ne,ie,ue,ae,de,ye,be,Te,we,Oe,Ge,Re,Ve,Ie,je){const lt=20*t,Be=40*t,yt=80*t;return this.float32[lt+0]=o,this.float32[lt+1]=l,this.int16[Be+4]=h,this.int16[Be+5]=f,this.int16[Be+6]=g,this.int16[Be+7]=v,this.int16[Be+8]=w,this.int16[Be+9]=E,this.int16[Be+10]=D,this.int16[Be+11]=I,this.int16[Be+12]=P,this.uint16[Be+13]=L,this.uint16[Be+14]=N,this.uint16[Be+15]=B,this.uint16[Be+16]=U,this.uint16[Be+17]=H,this.uint16[Be+18]=Q,this.uint16[Be+19]=ne,this.uint16[Be+20]=ie,this.uint16[Be+21]=ue,this.uint16[Be+22]=ae,this.uint16[Be+23]=de,this.uint16[Be+24]=ye,this.uint16[Be+25]=be,this.uint16[Be+26]=Te,this.uint16[Be+27]=we,this.uint32[lt+14]=Oe,this.float32[lt+15]=Ge,this.float32[lt+16]=Re,this.float32[lt+17]=Ve,this.float32[lt+18]=Ie,this.uint8[yt+76]=je,t}}Xu.prototype.bytesPerElement=80,Ct(Xu,"StructArrayLayout2f9i15ui1ul4f1ub80");class Pd extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.float32[1*t+0]=o,t}}Pd.prototype.bytesPerElement=4,Ct(Pd,"StructArrayLayout1f4");class yl extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,o,l,h,f)}emplace(t,o,l,h,f,g){const v=5*t;return this.float32[v+0]=o,this.float32[v+1]=l,this.float32[v+2]=h,this.float32[v+3]=f,this.float32[v+4]=g,t}}yl.prototype.bytesPerElement=20,Ct(yl,"StructArrayLayout5f20");class Wf extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,o,l,h,f,g,v)}emplace(t,o,l,h,f,g,v,w){const E=7*t;return this.float32[E+0]=o,this.float32[E+1]=l,this.float32[E+2]=h,this.float32[E+3]=f,this.float32[E+4]=g,this.float32[E+5]=v,this.float32[E+6]=w,t}}Wf.prototype.bytesPerElement=28,Ct(Wf,"StructArrayLayout7f28");class Ku extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,l,h)}emplace(t,o,l,h,f){const g=6*t;return this.uint32[3*t+0]=o,this.uint16[g+2]=l,this.uint16[g+3]=h,this.uint16[g+4]=f,t}}Ku.prototype.bytesPerElement=12,Ct(Ku,"StructArrayLayout1ul3ui12");class Od extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint16[1*t+0]=o,t}}Od.prototype.bytesPerElement=2,Ct(Od,"StructArrayLayout1ui2");class ps extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,o,l)}emplace(t,o,l,h){const f=3*t;return this.float32[f+0]=o,this.float32[f+1]=l,this.float32[f+2]=h,t}}ps.prototype.bytesPerElement=12,Ct(ps,"StructArrayLayout3f12");class Ju extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,o)}emplace(t,o,l){const h=2*t;return this.float32[h+0]=o,this.float32[h+1]=l,t}}Ju.prototype.bytesPerElement=8,Ct(Ju,"StructArrayLayout2f8");class Yf extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f,g,v,w,E,D,I,P,L,N,B,U){const H=this.length;return this.resize(H+1),this.emplace(H,t,o,l,h,f,g,v,w,E,D,I,P,L,N,B,U)}emplace(t,o,l,h,f,g,v,w,E,D,I,P,L,N,B,U,H){const Q=16*t;return this.float32[Q+0]=o,this.float32[Q+1]=l,this.float32[Q+2]=h,this.float32[Q+3]=f,this.float32[Q+4]=g,this.float32[Q+5]=v,this.float32[Q+6]=w,this.float32[Q+7]=E,this.float32[Q+8]=D,this.float32[Q+9]=I,this.float32[Q+10]=P,this.float32[Q+11]=L,this.float32[Q+12]=N,this.float32[Q+13]=B,this.float32[Q+14]=U,this.float32[Q+15]=H,t}}Yf.prototype.bytesPerElement=64,Ct(Yf,"StructArrayLayout16f64");class Qu extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,h,f,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,o,l,h,f,g,v)}emplace(t,o,l,h,f,g,v,w){const E=10*t,D=5*t;return this.uint16[E+0]=o,this.uint16[E+1]=l,this.uint16[E+2]=h,this.uint16[E+3]=f,this.float32[D+2]=g,this.float32[D+3]=v,this.float32[D+4]=w,t}}Qu.prototype.bytesPerElement=20,Ct(Qu,"StructArrayLayout4ui3f20");class Xf extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint8[1*t+0]=o,t}}Xf.prototype.bytesPerElement=1,Ct(Xf,"StructArrayLayout1ub1");class Lm extends Sd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Lm.prototype.size=40;class ft extends Zf{get(t){return new Lm(this,t)}}Ct(ft,"CollisionBoxArray");class yi extends Sd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}yi.prototype.size=60;class Fm extends _n{get(t){return new yi(this,t)}}Ct(Fm,"PlacedSymbolArray");class Nm extends Sd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Nm.prototype.size=80;class Gr extends Xu{get(t){return new Nm(this,t)}}Ct(Gr,"SymbolInstanceArray");class Kf extends Pd{getoffsetX(t){return this.float32[1*t+0]}}Ct(Kf,"GlyphOffsetArray");class La extends mi{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Ct(La,"SymbolLineVertexArray");class Ls extends Sd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ls.prototype.size=12;class kd extends Ku{get(t){return new Ls(this,t)}}Ct(kd,"FeatureIndexArray");class Ql extends ks{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Ct(Ql,"FillExtrusionCentroidArray");const V_=ei([{name:"a_pos",components:2,type:"Int16"}],4),j_=ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ki{constructor(t=[]){this.segments=t}_prepareSegment(t,o,l,h){let f=this.segments[this.segments.length-1];return t>Ki.MAX_VERTEX_ARRAY_LENGTH&&tr(`Max vertices per segment is ${Ki.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!f||f.vertexLength+t>Ki.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h)&&(f={vertexOffset:o,primitiveOffset:l,vertexLength:0,primitiveLength:0},void 0!==h&&(f.sortKey=h),this.segments.push(f)),f}prepareSegment(t,o,l,h){return this._prepareSegment(t,o.length,l.length,h)}get(){return this.segments}destroy(){for(const t of this.segments)for(const o in t.vaos)t.vaos[o].destroy()}static simpleSegment(t,o,l,h){return new Ki([{vertexOffset:t,primitiveOffset:o,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}function Qr(n,t){return 256*(n=on(Math.floor(n),0,255))+on(Math.floor(t),0,255)}Ki.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ct(Ki,"SegmentVector");const ua=ei([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Jf=ei([{name:"a_dash",components:4,type:"Uint16"}]);var ha={exports:{}},Qf={exports:function(t,o){var l,h,f,g,v,w,E,D;for(h=t.length-(l=3&t.length),f=o,v=3432918353,w=461845907,D=0;D<h;)E=255&t.charCodeAt(D)|(255&t.charCodeAt(++D))<<8|(255&t.charCodeAt(++D))<<16|(255&t.charCodeAt(++D))<<24,++D,f=27492+(65535&(g=5*(65535&(f=(f^=E=(65535&(E=(E=(65535&E)*v+(((E>>>16)*v&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(E=0,l){case 3:E^=(255&t.charCodeAt(D+2))<<16;case 2:E^=(255&t.charCodeAt(D+1))<<8;case 1:f^=E=(65535&(E=(E=(65535&(E^=255&t.charCodeAt(D)))*v+(((E>>>16)*v&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295}return f^=t.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}.exports,ep={exports:{}};ep.exports=function(t,o){for(var l,h=t.length,f=o^h,g=0;h>=4;)l=1540483477*(65535&(l=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++g;switch(h){case 3:f^=(255&t.charCodeAt(g+2))<<16;case 2:f^=(255&t.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&t.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var zm=Qf,Bm=ep.exports;ha.exports=zm,ha.exports.murmur3=zm,ha.exports.murmur2=Bm;var eh=$o(ha.exports);class ec{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,o,l,h){this.ids.push(tp(t)),this.positions.push(o,l,h)}eachPosition(t,o){const l=tp(t);let h=0,f=this.ids.length-1;for(;h<f;){const g=h+f>>1;this.ids[g]>=l?f=g:h=g+1}for(;this.ids[h]===l;)o(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(t,o){const l=new Float64Array(t.ids),h=new Uint32Array(t.positions);return th(l,h,0,l.length-1),o&&(o.add(l.buffer),o.add(h.buffer)),{ids:l,positions:h}}static deserialize(t){const o=new ec;let l;o.ids=t.ids,o.positions=t.positions;for(const h of o.ids)h!==l&&o.uniqueIds.push(h),l=h;return o.indexed=!0,o}}function tp(n){const t=+n;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:eh(String(n))}function th(n,t,o,l){for(;o<l;){const h=n[o+l>>1];let f=o-1,g=l+1;for(;;){do{f++}while(n[f]<h);do{g--}while(n[g]>h);if(f>=g)break;Ld(n,f,g),Ld(t,3*f,3*g),Ld(t,3*f+1,3*g+1),Ld(t,3*f+2,3*g+2)}g-o<l-g?(th(n,t,o,g),o=g+1):(th(n,t,g+1,l),l=g)}}function Ld(n,t,o){const l=n[t];n[t]=n[o],n[o]=l}Ct(ec,"FeaturePositionMap");class da{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,o),this.initialized=!0),!!this.location}}class Wc extends da{constructor(t){super(t),this.current=0}set(t,o,l){this.fetchUniformLocation(t,o)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class eo extends da{constructor(t){super(t),this.current=0}set(t,o,l){this.fetchUniformLocation(t,o)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Fa extends da{constructor(t){super(t),this.current=[0,0]}set(t,o,l){this.fetchUniformLocation(t,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class np extends da{constructor(t){super(t),this.current=[0,0,0]}set(t,o,l){this.fetchUniformLocation(t,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class p extends da{constructor(t){super(t),this.current=[0,0,0,0]}set(t,o,l){this.fetchUniformLocation(t,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class s extends da{constructor(t){super(t),this.current=ir.transparent}set(t,o,l){this.fetchUniformLocation(t,o)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const c=new Float32Array(16);class m extends da{constructor(t){super(t),this.current=c}set(t,o,l){if(this.fetchUniformLocation(t,o)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const y=new Float32Array(9),x=new Float32Array(4);class C extends da{constructor(t){super(t),this.current=x}set(t,o,l){if(this.fetchUniformLocation(t,o))for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}function T(n){return[Qr(255*n.r,255*n.g),Qr(255*n.b,255*n.a)]}class S{constructor(t,o,l){this.value=t,this.uniformNames=o.map(h=>`u_${h}`),this.type=l}setUniform(t,o,l,h,f){o.set(t,f,h.constantOr(this.value))}getBinding(t,o){return"color"===this.type?new s(t):new eo(t)}}class O{constructor(t,o){this.uniformNames=o.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,o,l,h,f){const g="u_pattern"===f||"u_dash"===f?this.pattern:"u_pixel_ratio"===f?this.pixelRatio:null;g&&o.set(t,f,g)}getBinding(t,o){return"u_pattern"===o||"u_dash"===o?new p(t):new eo(t)}}class k{constructor(t,o,l,h){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=o.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===l?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,o,l,h,f,g,v){const w=this.paintVertexArray.length,E=this.expression.evaluate(new Mi(0,{brightness:g}),o,{},f,h,v);this.paintVertexArray.resize(t),this._setPaintValue(w,t,E)}updatePaintArray(t,o,l,h,f,g,v){const w=this.expression.evaluate({zoom:0,brightness:v},l,h,void 0,f);this._setPaintValue(t,o,w)}_setPaintValue(t,o,l){if("color"===this.type){const h=T(l);for(let f=t;f<o;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=t;h<o;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class F{constructor(t,o,l,h,f,g){this.expression=t,this.uniformNames=o.map(v=>`u_${v}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=o.map(v=>({name:`a_${v}`,type:"Float32",components:"color"===l?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,o,l,h,f,g,v){const w=this.expression.evaluate(new Mi(this.zoom,{brightness:g}),o,{},f,h,v),E=this.expression.evaluate(new Mi(this.zoom+1,{brightness:g}),o,{},f,h,v),D=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(D,t,w,E)}updatePaintArray(t,o,l,h,f,g,v){const w=this.expression.evaluate({zoom:this.zoom,brightness:v},l,h,void 0,f),E=this.expression.evaluate({zoom:this.zoom+1,brightness:v},l,h,void 0,f);this._setPaintValue(t,o,w,E)}_setPaintValue(t,o,l,h){if("color"===this.type){const f=T(l),g=T(h);for(let v=t;v<o;v++)this.paintVertexArray.emplace(v,f[0],f[1],g[0],g[1])}else{for(let f=t;f<o;f++)this.paintVertexArray.emplace(f,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,o,l,h,f){const g=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,v=on(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);o.set(t,f,v)}getBinding(t,o){return new eo(t)}}class V{constructor(t,o,l,h,f){this.expression=t,this.layerId=f,this.paintVertexAttributes=("array"===l?Jf:ua).members;for(let g=0;g<o.length;++g);this.paintVertexArray=new h}populatePaintArray(t,o,l){const h=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(h,t,o.patterns&&o.patterns[this.layerId],l)}updatePaintArray(t,o,l,h,f,g,v){this._setPaintValues(t,o,l.patterns&&l.patterns[this.layerId],g)}_setPaintValues(t,o,l,h){if(!h||!l)return;const f=h[l];if(!f)return;const{tl:g,br:v,pixelRatio:w}=f;for(let E=t;E<o;E++)this.paintVertexArray.emplace(E,g[0],g[1],v[0],v[1],w)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class j{constructor(t,o,l=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const f in t.paint._values){const g=t.paint.get(f);if(!l(f)||!(g instanceof Gu&&Mr(g.property.specification)))continue;const v=Y(f,t.type),w=g.value,E=g.property.specification.type,D=!!g.property.useIntegerZoom,I="line-dasharray"===f||f.endsWith("pattern"),P="line-dasharray"===f&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==w.kind||P)if("source"===w.kind||P||I){const L=re(f,E,"source");this.binders[f]=I?new V(w,v,E,L,t.id):new k(w,v,E,L),h.push(`/a_${f}`)}else{const L=re(f,E,"composite");this.binders[f]=new F(w,v,E,D,o,L),h.push(`/z_${f}`)}else this.binders[f]=I?new O(w.value,v):new S(w.value,v,E),h.push(`/u_${f}`)}this.cacheKey=h.sort().join("")}getMaxValue(t){const o=this.binders[t];return o instanceof k||o instanceof F?o.maxValue:0}populatePaintArrays(t,o,l,h,f,g,v){for(const w in this.binders){const E=this.binders[w];(E instanceof k||E instanceof F||E instanceof V)&&E.populatePaintArray(t,o,l,h,f,g,v)}}setConstantPatternPositions(t){for(const o in this.binders){const l=this.binders[o];l instanceof O&&l.setConstantPatternPositions(t)}}updatePaintArrays(t,o,l,h,f,g,v,w){let E=!1;const D=Object.keys(t),I=0!==D.length,P=I?D:o.uniqueIds;for(const L in this.binders){const N=this.binders[L];if((N instanceof k||N instanceof F||N instanceof V)&&(!0===N.expression.isStateDependent||!1===N.expression.isLightConstant)){const B=f.paint.get(L);N.expression=B.value;for(const U of P){const H=t[U.toString()];o.eachPosition(U,(Q,ne,ie)=>{const ue=h.feature(Q);N.updatePaintArray(ne,ie,ue,H,g,v,w)})}if(!I)for(const U of l.uniqueIds){const H=t[U.toString()];l.eachPosition(U,(Q,ne,ie)=>{const ue=h.feature(Q);N.updatePaintArray(ne,ie,ue,H,g,v,w)})}E=!0}}return E}defines(){const t=[];for(const o in this.binders){const l=this.binders[o];(l instanceof S||l instanceof O)&&t.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof k||l instanceof F||l instanceof V)for(let h=0;h<l.paintVertexAttributes.length;h++)t.push(l.paintVertexAttributes[h].name)}return t}getBinderUniforms(){const t=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof S||l instanceof O||l instanceof F)for(const h of l.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const o=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof S||h instanceof O||h instanceof F)for(const f of h.uniformNames)o.push({name:f,property:l,binding:h.getBinding(t,f)})}return o}setUniforms(t,o,l,h,f){for(const{name:g,property:v,binding:w}of l)this.binders[v].setUniform(t,w,f,h.get(v),g)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const o=this.binders[t];(o instanceof k||o instanceof F||o instanceof V)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const o in this.binders){const l=this.binders[o];(l instanceof k||l instanceof F||l instanceof V)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const o=this.binders[t];(o instanceof k||o instanceof F||o instanceof V)&&o.destroy()}}}class q{constructor(t,o,l=(()=>!0)){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new j(h,o,l);this.needsUpload=!1,this._featureMap=new ec,this._featureMapWithoutIds=new ec,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,o,l,h,f,g,v,w){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(t,o,h,f,g,v,w);void 0!==o.id?this._featureMap.add(o.id,l,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,o,l,h,f,g){for(const v of l)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,o,v,h,f,g||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const W={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Y(n,t){return W[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}const G={"line-pattern":{source:Xo,composite:Xo},"fill-pattern":{source:Xo,composite:Xo},"fill-extrusion-pattern":{source:Xo,composite:Xo},"line-dasharray":{source:$r,composite:$r}},J={color:{source:Ju,composite:ka},number:{source:Pd,composite:Ju}};function re(n,t,o){const l=G[n];return l&&l[o]||J[t][o]}Ct(S,"ConstantBinder"),Ct(O,"PatternConstantBinder"),Ct(k,"SourceExpressionBinder"),Ct(V,"PatternCompositeBinder"),Ct(F,"CompositeExpressionBinder"),Ct(j,"ProgramConfiguration",{omit:["_buffers"]}),Ct(q,"ProgramConfigurationSet");const ee=gt/Math.PI/2,oe=5,X=6,se=16383,fe=[64,32,16],ge=-ee,De=ee;function ve(n,t,o,l=ee){return o=Cn(o),[n*Math.sin(o)*l,-t*l,n*Math.cos(o)*l]}function Pe(n,t,o){return ve(Math.cos(Cn(n)),Math.sin(Cn(n)),t,o)}const Ae=6371008.8,qe=2*Math.PI*Ae;class xe{constructor(t,o){if(isNaN(t)||isNaN(o))throw new Error(`Invalid LngLat object: (${t}, ${o})`);if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xe(Da(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const o=Math.PI/180,l=this.lat*o,h=t.lat*o,f=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((t.lng-this.lng)*o);return Ae*Math.acos(Math.min(f,1))}toBounds(t=0){const o=360*t/40075017,l=o/Math.cos(Math.PI/180*this.lat);return new Se({lng:this.lng-l,lat:this.lat-o},{lng:this.lng+l,lat:this.lat+o})}toEcef(t){return Pe(this.lat,this.lng,ee+t*ee/Ae)}static convert(t){if(t instanceof xe)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new xe(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new xe(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Se{constructor(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof xe?new xe(t.lng,t.lat):xe.convert(t),this}setSouthWest(t){return this._sw=t instanceof xe?new xe(t.lng,t.lat):xe.convert(t),this}extend(t){const o=this._sw,l=this._ne;let h,f;if(t instanceof xe)h=t,f=t;else{if(!(t instanceof Se))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Se.convert(t)):this.extend(xe.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(xe.convert(t)):this;if(h=t._sw,f=t._ne,!h||!f)return this}return o||l?(o.lng=Math.min(h.lng,o.lng),o.lat=Math.min(h.lat,o.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new xe(h.lng,h.lat),this._ne=new xe(f.lng,f.lat)),this}getCenter(){return new xe((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new xe(this.getWest(),this.getNorth())}getSouthEast(){return new xe(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:o,lat:l}=xe.convert(t);let h=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(t){return!t||t instanceof Se?t:new Se(t)}}var pe={};!function(o){function l(f,g,v){var w=h(256*f,256*(g=Math.pow(2,v)-g-1),v),E=h(256*(f+1),256*(g+1),v);return w[0]+","+w[1]+","+E[0]+","+E[1]}function h(f,g,v){var w=2*Math.PI*6378137/256/Math.pow(2,v);return[f*w-2*Math.PI*6378137/2,g*w-2*Math.PI*6378137/2]}o.getURL=function(f,g,v,w,E,D){return D=D||{},f+"?"+["bbox="+l(v,w,E),"format="+(D.format||"image/png"),"service="+(D.service||"WMS"),"version="+(D.version||"1.1.1"),"request="+(D.request||"GetMap"),"srs="+(D.srs||"EPSG:3857"),"width="+(D.width||256),"height="+(D.height||256),"layers="+g].join("&")},o.getTileBBox=l,o.getMercCoords=h,Object.defineProperty(o,"__esModule",{value:!0})}(pe);var Ee=pe;class He{constructor(t,o,l){this.z=t,this.x=o,this.y=l,this.key=pt(0,t,t,o,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,o){const l=Ee.getTileBBox(this.x,this.y,this.z),h=function(f,g,v){let w,E="";for(let D=f;D>0;D--)w=1<<D-1,E+=(g&w?1:0)+(v&w?2:0);return E}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===o?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class et{constructor(t,o){this.wrap=t,this.canonical=o,this.key=pt(t,o.z,o.z,o.x,o.y)}}class Je{constructor(t,o,l,h,f){this.overscaledZ=t,this.wrap=o,this.canonical=new He(l,+h,+f),this.key=0===o&&t===l?this.canonical.key:pt(o,t,l,h,f)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const o=this.canonical.z-t;return t>this.canonical.z?new Je(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Je(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(t,o=!0){if(this.overscaledZ===t&&o)return this.key;if(t>this.canonical.z)return pt(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-t;return pt(this.wrap*+o,t,t,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const o=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o}children(t){if(this.overscaledZ>=t)return[new Je(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new Je(o,this.wrap,o,l,h),new Je(o,this.wrap,o,l+1,h),new Je(o,this.wrap,o,l,h+1),new Je(o,this.wrap,o,l+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Je(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Je(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new et(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function pt(n,t,o,l,h){const f=1<<Math.min(o,22);let g=f*(h%f)+l%f;return n&&o<22&&(g+=f*f*((n<0?-2*n-1:2*n)%(1<<2*(22-o)))),16*(32*g+o)+(t-o)}const Mt=[n=>{let t=n.canonical.x-1,o=n.wrap;return t<0&&(t=(1<<n.canonical.z)-1,o--),new Je(n.overscaledZ,o,n.canonical.z,t,n.canonical.y)},n=>{let t=n.canonical.x+1,o=n.wrap;return t===1<<n.canonical.z&&(t=0,o++),new Je(n.overscaledZ,o,n.canonical.z,t,n.canonical.y)},n=>new Je(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(0===n.canonical.y?1<<n.canonical.z:n.canonical.y)-1),n=>new Je(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];Ct(He,"CanonicalTileID"),Ct(Je,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const zt=0,Ot=25.5;function Dt(n){return qe*Math.cos(n*Math.PI/180)}function hn(n){return(180+n)/360}function Yt(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function en(n,t){return n/Dt(t)}function tn(n){return 360*n-180}function Dn(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function gi(n,t){return n*Dt(Dn(t))}const En=85.051129;function Vi(n){return Math.cos(Cn(on(n,-En,En)))}function yn(n,t){const o=on(t,zt,Ot),l=Math.pow(2,o);return Vi(n)*qe/(512*l)}function Nn(n){return 1/Math.cos(n*Math.PI/180)}function vn(n,t=0){const o=Math.exp(Math.PI*(1-(n.y+t/gt)/(1<<n.z)*2));return 80150034*o/(o*o+1)/gt/(1<<n.z)}class zn{constructor(t,o,l=0){this.x=+t,this.y=+o,this.z=+l}static fromLngLat(t,o=0){const l=xe.convert(t);return new zn(hn(l.lng),Yt(l.lat),en(o,l.lat))}toLngLat(){return new xe(tn(this.x),Dn(this.y))}toAltitude(){return gi(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/qe*Nn(Dn(this.y))}}function vi(n,t,o,l,h,f,g,v,w){const E=(t+l)/2,D=(o+h)/2,I=new ht(E,D);v(I),function(P,L,N,B,U,H){const Q=N-U,ne=B-H;return Math.abs((B-L)*Q-(N-P)*ne)/Math.hypot(Q,ne)}(I.x,I.y,f.x,f.y,g.x,g.y)>=w?(vi(n,t,o,E,D,f,I,v,w),vi(n,E,D,l,h,I,g,v,w)):n.push(g)}function Rn(n,t,o){let l=n[0],h=l.x,f=l.y;t(l);const g=[l];for(let v=1;v<n.length;v++){const w=n[v],{x:E,y:D}=w;t(w),vi(g,h,f,E,D,l,w,t,o),h=E,f=D,l=w}return g}function Sr(n,t,o,l){if(l(t,o)){const h=t.add(o)._mult(.5);Sr(n,t,h,l),Sr(n,h,o,l)}else n.push(o)}function zr(n,t){let o=n[0];const l=[o];for(let h=1;h<n.length;h++){const f=n[h];Sr(l,o,f,t),o=f}return l}const bo=Math.pow(2,14)-1,Oo=-bo-1;function ko(n,t){const o=Math.round(n.x*t),l=Math.round(n.y*t);return n.x=on(o,Oo,bo),n.y=on(l,Oo,bo),(o<n.x||o>n.x+1||l<n.y||l>n.y+1)&&tr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Ei(n,t,o){const l=n.loadGeometry(),h=n.extent,f=gt/h;if(t&&o&&o.projection.isReprojectedInTileSpace){const g=1<<t.z,{scale:v,x:w,y:E,projection:D}=o,I=P=>{const L=tn((t.x+P.x/h)/g),N=Dn((t.y+P.y/h)/g),B=D.project(L,N);P.x=(B.x*v-w)*h,P.y=(B.y*v-E)*h};for(let P=0;P<l.length;P++)if(1!==n.type)l[P]=Rn(l[P],I,1);else{const L=[];for(const N of l[P])N.x<0||N.x>=h||N.y<0||N.y>=h||(I(N),L.push(N));l[P]=L}}for(const g of l)for(const v of g)ko(v,f);return l}function mr(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?Ei(n):[]}}function to(n,t,o,l,h){n.emplaceBack(2*t+(l+1)/2,2*o+(h+1)/2)}function no(n,t,o){n.emplaceBack(t.x,t.y,t.z,16384*o[0],16384*o[1],16384*o[2])}class Lo{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new mi,this.indexArray=new Ir,this.segments=new Ki,this.programConfigurations=new q(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,l,h){const f=this.layers[0],g=[];let v=null;"circle"===f.type&&(v=f.layout.get("circle-sort-key"));for(const{feature:E,id:D,index:I,sourceLayerIndex:P}of t){const L=this.layers[0]._featureFilter.needGeometry,N=mr(E,L);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),N,l))continue;const B=v?v.evaluate(N,{},l):void 0,U={id:D,properties:E.properties,type:E.type,sourceLayerIndex:P,index:I,geometry:L?N.geometry:Ei(E,l,h),patterns:{},sortKey:B};g.push(U)}v&&g.sort((E,D)=>E.sortKey-D.sortKey);let w=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new Ad,w=h.projection);for(const E of g){const{geometry:D,index:I,sourceLayerIndex:P}=E,L=t[I].feature;this.addFeature(E,D,I,o.availableImages,l,w,o.brightness),o.featureIndex.insert(L,D,I,P,this.index)}}update(t,o,l,h,f){const g=0!==Object.keys(t).length;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,o,g?this.stateDependentLayers:this.layers,l,h,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,V_.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,j_.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,o,l,h,f,g,v){for(const w of o)for(const E of w){const D=E.x,I=E.y;if(D<0||D>=gt||I<0||I>=gt)continue;if(g){const N=g.projectTilePoint(D,I,f),B=g.upVector(f,D,I),U=this.globeExtVertexArray;no(U,N,B),no(U,N,B),no(U,N,B),no(U,N,B)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),L=P.vertexLength;to(this.layoutVertexArray,D,I,-1,-1),to(this.layoutVertexArray,D,I,1,-1),to(this.layoutVertexArray,D,I,1,1),to(this.layoutVertexArray,D,I,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},h,f,v)}}function Fs(n,t){for(let o=0;o<n.length;o++)if(Na(t,n[o]))return!0;for(let o=0;o<t.length;o++)if(Na(n,t[o]))return!0;return!!pa(n,t)}function Ns(n,t,o){return!!Na(n,t)||!!tc(t,n,o)}function gs(n,t){if(1===n.length)return ip(t,n[0]);for(let o=0;o<t.length;o++){const l=t[o];for(let h=0;h<l.length;h++)if(Na(n,l[h]))return!0}for(let o=0;o<n.length;o++)if(ip(t,n[o]))return!0;for(let o=0;o<t.length;o++)if(pa(n,t[o]))return!0;return!1}function fa(n,t,o){if(n.length>1){if(pa(n,t))return!0;for(let l=0;l<t.length;l++)if(tc(t[l],n,o))return!0}for(let l=0;l<n.length;l++)if(tc(n[l],t,o))return!0;return!1}function pa(n,t){if(0===n.length||0===t.length)return!1;for(let o=0;o<n.length-1;o++){const l=n[o],h=n[o+1];for(let f=0;f<t.length-1;f++)if(Fd(l,h,t[f],t[f+1]))return!0}return!1}function Fd(n,t,o,l){return Io(n,o,l)!==Io(t,o,l)&&Io(n,t,o)!==Io(n,t,l)}function tc(n,t,o){const l=o*o;if(1===t.length)return n.distSqr(t[0])<l;for(let h=1;h<t.length;h++)if(zs(n,t[h-1],t[h])<l)return!0;return!1}function zs(n,t,o){const l=t.distSqr(o);if(0===l)return n.distSqr(t);const h=((n.x-t.x)*(o.x-t.x)+(n.y-t.y)*(o.y-t.y))/l;return n.distSqr(h<0?t:h>1?o:o.sub(t)._mult(h)._add(t))}function ip(n,t){let o,l,h,f=!1;for(let g=0;g<n.length;g++){o=n[g];for(let v=0,w=o.length-1;v<o.length;w=v++)l=o[v],h=o[w],l.y>t.y!=h.y>t.y&&t.x<(h.x-l.x)*(t.y-l.y)/(h.y-l.y)+l.x&&(f=!f)}return f}function Na(n,t){let o=!1;for(let l=0,h=n.length-1;l<n.length;h=l++){const f=n[l],g=n[h];f.y>t.y!=g.y>t.y&&t.x<(g.x-f.x)*(t.y-f.y)/(g.y-f.y)+f.x&&(o=!o)}return o}function ow(n,t,o,l,h){for(const g of n)if(t<=g.x&&o<=g.y&&l>=g.x&&h>=g.y)return!0;const f=[new ht(t,o),new ht(t,h),new ht(l,h),new ht(l,o)];if(n.length>2)for(const g of f)if(Na(n,g))return!0;for(let g=0;g<n.length-1;g++)if(eT(n[g],n[g+1],f))return!0;return!1}function eT(n,t,o){const l=o[0],h=o[2];if(n.x<l.x&&t.x<l.x||n.x>h.x&&t.x>h.x||n.y<l.y&&t.y<l.y||n.y>h.y&&t.y>h.y)return!1;const f=Io(n,t,o[0]);return f!==Io(n,t,o[1])||f!==Io(n,t,o[2])||f!==Io(n,t,o[3])}function rp(n,t,o,l,h,f){let g=t.y-n.y,v=n.x-t.x;if(f=f||0){const w=g*g+v*v;if(0===w)return!0;const E=Math.sqrt(w);g/=E,v/=E}return!((o.x-n.x)*g+(o.y-n.y)*v-f<0||(l.x-n.x)*g+(l.y-n.y)*v-f<0||(h.x-n.x)*g+(h.y-n.y)*v-f<0)}function v0(n,t,o,l,h,f,g){return!(rp(n,t,l,h,f,g)||rp(t,o,l,h,f,g)||rp(o,n,l,h,f,g)||rp(l,h,n,t,o,g)||rp(h,f,n,t,o,g)||rp(f,l,n,t,o,g))}function op(n,t,o){const l=t.paint.get(n).value;return"constant"===l.kind?l.value:o.programConfigurations.get(t.id).getMaxValue(n)}function U_(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function nh(n,t,o,l,h){if(!t[0]&&!t[1])return n;const f=ht.convert(t)._mult(h);"viewport"===o&&f._rotate(-l);const g=[];for(let v=0;v<n.length;v++)g.push(n[v].sub(f));return g}function x0(n,t,o,l){const h=ht.convert(n)._mult(l);return"viewport"===t&&h._rotate(-o),h}Ct(Lo,"CircleBucket",{omit:["layers"]});const sw=new Xi({"circle-sort-key":new Vt(Ce.layout_circle["circle-sort-key"]),visibility:new nt(Ce.layout_circle.visibility)});var io={paint:new Xi({"circle-radius":new Vt(Ce.paint_circle["circle-radius"]),"circle-color":new Vt(Ce.paint_circle["circle-color"]),"circle-blur":new Vt(Ce.paint_circle["circle-blur"]),"circle-opacity":new Vt(Ce.paint_circle["circle-opacity"]),"circle-translate":new nt(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new nt(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nt(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nt(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Vt(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Vt(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Vt(Ce.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new nt(Ce.paint_circle["circle-emissive-strength"])}),layout:sw},Br={},hr={};Object.defineProperty(hr,"__esModule",{value:!0}),hr.setMatrixArrayType=function(n){hr.ARRAY_TYPE=Bs=n},hr.toRadian=function(n){return n*w0},hr.equals=function(n,t){return Math.abs(n-t)<=b0*Math.max(1,Math.abs(n),Math.abs(t))},hr.RANDOM=hr.ARRAY_TYPE=hr.EPSILON=void 0;var b0=1e-6;hr.EPSILON=b0;var Bs=typeof Float32Array<"u"?Float32Array:Array;hr.ARRAY_TYPE=Bs;var Nd=Math.random;hr.RANDOM=Nd;var w0=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Ri={};function ih(n){return(ih="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.create=function(){var n=new Yc.ARRAY_TYPE(4);return Yc.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},Ri.clone=function(n){var t=new Yc.ARRAY_TYPE(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},Ri.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},Ri.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n},Ri.fromValues=function(n,t,o,l){var h=new Yc.ARRAY_TYPE(4);return h[0]=n,h[1]=t,h[2]=o,h[3]=l,h},Ri.set=function(n,t,o,l,h){return n[0]=t,n[1]=o,n[2]=l,n[3]=h,n},Ri.transpose=function(n,t){if(n===t){var o=t[1];n[1]=t[2],n[2]=o}else n[0]=t[0],n[1]=t[2],n[2]=t[1],n[3]=t[3];return n},Ri.invert=function(n,t){var o=t[0],l=t[1],h=t[2],f=t[3],g=o*f-h*l;return g?(n[0]=f*(g=1/g),n[1]=-l*g,n[2]=-h*g,n[3]=o*g,n):null},Ri.adjoint=function(n,t){var o=t[0];return n[0]=t[3],n[1]=-t[1],n[2]=-t[2],n[3]=o,n},Ri.determinant=function(n){return n[0]*n[3]-n[2]*n[1]},Ri.multiply=E0,Ri.rotate=function(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3],v=Math.sin(o),w=Math.cos(o);return n[0]=l*w+f*v,n[1]=h*w+g*v,n[2]=l*-v+f*w,n[3]=h*-v+g*w,n},Ri.scale=function(n,t,o){var l=t[1],h=t[2],f=t[3],g=o[0],v=o[1];return n[0]=t[0]*g,n[1]=l*g,n[2]=h*v,n[3]=f*v,n},Ri.fromRotation=function(n,t){var o=Math.sin(t),l=Math.cos(t);return n[0]=l,n[1]=o,n[2]=-o,n[3]=l,n},Ri.fromScaling=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=t[1],n},Ri.str=function(n){return"mat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},Ri.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},Ri.LDU=function(n,t,o,l){return n[2]=l[2]/l[0],o[0]=l[0],o[1]=l[1],o[3]=l[3]-n[2]*o[1],[n,t,o]},Ri.add=function(n,t,o){return n[0]=t[0]+o[0],n[1]=t[1]+o[1],n[2]=t[2]+o[2],n[3]=t[3]+o[3],n},Ri.subtract=lw,Ri.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]},Ri.equals=function(n,t){var o=n[0],l=n[1],h=n[2],f=n[3],g=t[0],v=t[1],w=t[2],E=t[3];return Math.abs(o-g)<=Yc.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(l-v)<=Yc.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(h-w)<=Yc.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(f-E)<=Yc.EPSILON*Math.max(1,Math.abs(f),Math.abs(E))},Ri.multiplyScalar=function(n,t,o){return n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n[3]=t[3]*o,n},Ri.multiplyScalarAndAdd=function(n,t,o,l){return n[0]=t[0]+o[0]*l,n[1]=t[1]+o[1]*l,n[2]=t[2]+o[2]*l,n[3]=t[3]+o[3]*l,n},Ri.sub=Ri.mul=void 0;var Yc=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==ih(n)&&"function"!=typeof n)return{default:n};var o=aw(void 0);if(o&&o.has(n))return o.get(n);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in n)if("default"!==f&&Object.prototype.hasOwnProperty.call(n,f)){var g=h?Object.getOwnPropertyDescriptor(n,f):null;g&&(g.get||g.set)?Object.defineProperty(l,f,g):l[f]=n[f]}return l.default=n,o&&o.set(n,l),l}(hr);function aw(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(aw=function(l){return l?o:t})(n)}function E0(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3],v=o[0],w=o[1],E=o[2],D=o[3];return n[0]=l*v+f*w,n[1]=h*v+g*w,n[2]=l*E+f*D,n[3]=h*E+g*D,n}function lw(n,t,o){return n[0]=t[0]-o[0],n[1]=t[1]-o[1],n[2]=t[2]-o[2],n[3]=t[3]-o[3],n}Ri.mul=E0,Ri.sub=lw;var ri={};function sp(n){return(sp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(ri,"__esModule",{value:!0}),ri.create=function(){var n=new Ko.ARRAY_TYPE(6);return Ko.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[4]=0,n[5]=0),n[0]=1,n[3]=1,n},ri.clone=function(n){var t=new Ko.ARRAY_TYPE(6);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t},ri.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n},ri.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n},ri.fromValues=function(n,t,o,l,h,f){var g=new Ko.ARRAY_TYPE(6);return g[0]=n,g[1]=t,g[2]=o,g[3]=l,g[4]=h,g[5]=f,g},ri.set=function(n,t,o,l,h,f,g){return n[0]=t,n[1]=o,n[2]=l,n[3]=h,n[4]=f,n[5]=g,n},ri.invert=function(n,t){var o=t[0],l=t[1],h=t[2],f=t[3],g=t[4],v=t[5],w=o*f-l*h;return w?(n[0]=f*(w=1/w),n[1]=-l*w,n[2]=-h*w,n[3]=o*w,n[4]=(h*v-f*g)*w,n[5]=(l*g-o*v)*w,n):null},ri.determinant=function(n){return n[0]*n[3]-n[1]*n[2]},ri.multiply=$_,ri.rotate=function(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3],v=t[4],w=t[5],E=Math.sin(o),D=Math.cos(o);return n[0]=l*D+f*E,n[1]=h*D+g*E,n[2]=l*-E+f*D,n[3]=h*-E+g*D,n[4]=v,n[5]=w,n},ri.scale=function(n,t,o){var l=t[1],h=t[2],f=t[3],g=t[4],v=t[5],w=o[0],E=o[1];return n[0]=t[0]*w,n[1]=l*w,n[2]=h*E,n[3]=f*E,n[4]=g,n[5]=v,n},ri.translate=function(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3],v=t[4],w=t[5],E=o[0],D=o[1];return n[0]=l,n[1]=h,n[2]=f,n[3]=g,n[4]=l*E+f*D+v,n[5]=h*E+g*D+w,n},ri.fromRotation=function(n,t){var o=Math.sin(t),l=Math.cos(t);return n[0]=l,n[1]=o,n[2]=-o,n[3]=l,n[4]=0,n[5]=0,n},ri.fromScaling=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=t[1],n[4]=0,n[5]=0,n},ri.fromTranslation=function(n,t){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=t[0],n[5]=t[1],n},ri.str=function(n){return"mat2d("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+")"},ri.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],1)},ri.add=function(n,t,o){return n[0]=t[0]+o[0],n[1]=t[1]+o[1],n[2]=t[2]+o[2],n[3]=t[3]+o[3],n[4]=t[4]+o[4],n[5]=t[5]+o[5],n},ri.subtract=C0,ri.multiplyScalar=function(n,t,o){return n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n[3]=t[3]*o,n[4]=t[4]*o,n[5]=t[5]*o,n},ri.multiplyScalarAndAdd=function(n,t,o,l){return n[0]=t[0]+o[0]*l,n[1]=t[1]+o[1]*l,n[2]=t[2]+o[2]*l,n[3]=t[3]+o[3]*l,n[4]=t[4]+o[4]*l,n[5]=t[5]+o[5]*l,n},ri.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]},ri.equals=function(n,t){var o=n[0],l=n[1],h=n[2],f=n[3],g=n[4],v=n[5],w=t[0],E=t[1],D=t[2],I=t[3],P=t[4],L=t[5];return Math.abs(o-w)<=Ko.EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(l-E)<=Ko.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(h-D)<=Ko.EPSILON*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(f-I)<=Ko.EPSILON*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(g-P)<=Ko.EPSILON*Math.max(1,Math.abs(g),Math.abs(P))&&Math.abs(v-L)<=Ko.EPSILON*Math.max(1,Math.abs(v),Math.abs(L))},ri.sub=ri.mul=void 0;var Ko=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==sp(n)&&"function"!=typeof n)return{default:n};var o=cw(void 0);if(o&&o.has(n))return o.get(n);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in n)if("default"!==f&&Object.prototype.hasOwnProperty.call(n,f)){var g=h?Object.getOwnPropertyDescriptor(n,f):null;g&&(g.get||g.set)?Object.defineProperty(l,f,g):l[f]=n[f]}return l.default=n,o&&o.set(n,l),l}(hr);function cw(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(cw=function(l){return l?o:t})(n)}function $_(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3],v=t[4],w=t[5],E=o[0],D=o[1],I=o[2],P=o[3],L=o[4],N=o[5];return n[0]=l*E+f*D,n[1]=h*E+g*D,n[2]=l*I+f*P,n[3]=h*I+g*P,n[4]=l*L+f*N+v,n[5]=h*L+g*N+w,n}function C0(n,t,o){return n[0]=t[0]-o[0],n[1]=t[1]-o[1],n[2]=t[2]-o[2],n[3]=t[3]-o[3],n[4]=t[4]-o[4],n[5]=t[5]-o[5],n}ri.mul=$_,ri.sub=C0;var xi={};function G_(n){return(G_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(xi,"__esModule",{value:!0}),xi.create=function(){var n=new Vs.ARRAY_TYPE(9);return Vs.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n},xi.fromMat4=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[4],n[4]=t[5],n[5]=t[6],n[6]=t[8],n[7]=t[9],n[8]=t[10],n},xi.clone=function(n){var t=new Vs.ARRAY_TYPE(9);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},xi.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},xi.fromValues=function(n,t,o,l,h,f,g,v,w){var E=new Vs.ARRAY_TYPE(9);return E[0]=n,E[1]=t,E[2]=o,E[3]=l,E[4]=h,E[5]=f,E[6]=g,E[7]=v,E[8]=w,E},xi.set=function(n,t,o,l,h,f,g,v,w,E){return n[0]=t,n[1]=o,n[2]=l,n[3]=h,n[4]=f,n[5]=g,n[6]=v,n[7]=w,n[8]=E,n},xi.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},xi.transpose=function(n,t){if(n===t){var o=t[1],l=t[2],h=t[5];n[1]=t[3],n[2]=t[6],n[3]=o,n[5]=t[7],n[6]=l,n[7]=h}else n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8];return n},xi.invert=function(n,t){var o=t[0],l=t[1],h=t[2],f=t[3],g=t[4],v=t[5],w=t[6],E=t[7],D=t[8],I=D*g-v*E,P=-D*f+v*w,L=E*f-g*w,N=o*I+l*P+h*L;return N?(n[0]=I*(N=1/N),n[1]=(-D*l+h*E)*N,n[2]=(v*l-h*g)*N,n[3]=P*N,n[4]=(D*o-h*w)*N,n[5]=(-v*o+h*f)*N,n[6]=L*N,n[7]=(-E*o+l*w)*N,n[8]=(g*o-l*f)*N,n):null},xi.adjoint=function(n,t){var o=t[0],l=t[1],h=t[2],f=t[3],g=t[4],v=t[5],w=t[6],E=t[7],D=t[8];return n[0]=g*D-v*E,n[1]=h*E-l*D,n[2]=l*v-h*g,n[3]=v*w-f*D,n[4]=o*D-h*w,n[5]=h*f-o*v,n[6]=f*E-g*w,n[7]=l*w-o*E,n[8]=o*g-l*f,n},xi.determinant=function(n){var t=n[3],o=n[4],l=n[5],h=n[6],f=n[7],g=n[8];return n[0]*(g*o-l*f)+n[1]*(-g*t+l*h)+n[2]*(f*t-o*h)},xi.multiply=T0,xi.translate=function(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3],v=t[4],w=t[5],E=t[6],D=t[7],I=t[8],P=o[0],L=o[1];return n[0]=l,n[1]=h,n[2]=f,n[3]=g,n[4]=v,n[5]=w,n[6]=P*l+L*g+E,n[7]=P*h+L*v+D,n[8]=P*f+L*w+I,n},xi.rotate=function(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3],v=t[4],w=t[5],E=t[6],D=t[7],I=t[8],P=Math.sin(o),L=Math.cos(o);return n[0]=L*l+P*g,n[1]=L*h+P*v,n[2]=L*f+P*w,n[3]=L*g-P*l,n[4]=L*v-P*h,n[5]=L*w-P*f,n[6]=E,n[7]=D,n[8]=I,n},xi.scale=function(n,t,o){var l=o[0],h=o[1];return n[0]=l*t[0],n[1]=l*t[1],n[2]=l*t[2],n[3]=h*t[3],n[4]=h*t[4],n[5]=h*t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},xi.fromTranslation=function(n,t){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=t[0],n[7]=t[1],n[8]=1,n},xi.fromRotation=function(n,t){var o=Math.sin(t),l=Math.cos(t);return n[0]=l,n[1]=o,n[2]=0,n[3]=-o,n[4]=l,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},xi.fromScaling=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=t[1],n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},xi.fromMat2d=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=0,n[3]=t[2],n[4]=t[3],n[5]=0,n[6]=t[4],n[7]=t[5],n[8]=1,n},xi.fromQuat=function(n,t){var o=t[0],l=t[1],h=t[2],f=t[3],g=o+o,v=l+l,w=h+h,E=o*g,D=l*g,I=l*v,P=h*g,L=h*v,N=h*w,B=f*g,U=f*v,H=f*w;return n[0]=1-I-N,n[3]=D-H,n[6]=P+U,n[1]=D+H,n[4]=1-E-N,n[7]=L-B,n[2]=P-U,n[5]=L+B,n[8]=1-E-I,n},xi.normalFromMat4=function(n,t){var o=t[0],l=t[1],h=t[2],f=t[3],g=t[4],v=t[5],w=t[6],E=t[7],D=t[8],I=t[9],P=t[10],L=t[11],N=t[12],B=t[13],U=t[14],H=t[15],Q=o*v-l*g,ne=o*w-h*g,ie=o*E-f*g,ue=l*w-h*v,ae=l*E-f*v,de=h*E-f*w,ye=D*B-I*N,be=D*U-P*N,Te=D*H-L*N,we=I*U-P*B,Oe=I*H-L*B,Ge=P*H-L*U,Re=Q*Ge-ne*Oe+ie*we+ue*Te-ae*be+de*ye;return Re?(n[0]=(v*Ge-w*Oe+E*we)*(Re=1/Re),n[1]=(w*Te-g*Ge-E*be)*Re,n[2]=(g*Oe-v*Te+E*ye)*Re,n[3]=(h*Oe-l*Ge-f*we)*Re,n[4]=(o*Ge-h*Te+f*be)*Re,n[5]=(l*Te-o*Oe-f*ye)*Re,n[6]=(B*de-U*ae+H*ue)*Re,n[7]=(U*ie-N*de-H*ne)*Re,n[8]=(N*ae-B*ie+H*Q)*Re,n):null},xi.projection=function(n,t,o){return n[0]=2/t,n[1]=0,n[2]=0,n[3]=0,n[4]=-2/o,n[5]=0,n[6]=-1,n[7]=1,n[8]=1,n},xi.str=function(n){return"mat3("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+")"},xi.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])},xi.add=function(n,t,o){return n[0]=t[0]+o[0],n[1]=t[1]+o[1],n[2]=t[2]+o[2],n[3]=t[3]+o[3],n[4]=t[4]+o[4],n[5]=t[5]+o[5],n[6]=t[6]+o[6],n[7]=t[7]+o[7],n[8]=t[8]+o[8],n},xi.subtract=Vm,xi.multiplyScalar=function(n,t,o){return n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n[3]=t[3]*o,n[4]=t[4]*o,n[5]=t[5]*o,n[6]=t[6]*o,n[7]=t[7]*o,n[8]=t[8]*o,n},xi.multiplyScalarAndAdd=function(n,t,o,l){return n[0]=t[0]+o[0]*l,n[1]=t[1]+o[1]*l,n[2]=t[2]+o[2]*l,n[3]=t[3]+o[3]*l,n[4]=t[4]+o[4]*l,n[5]=t[5]+o[5]*l,n[6]=t[6]+o[6]*l,n[7]=t[7]+o[7]*l,n[8]=t[8]+o[8]*l,n},xi.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]},xi.equals=function(n,t){var o=n[0],l=n[1],h=n[2],f=n[3],g=n[4],v=n[5],w=n[6],E=n[7],D=n[8],I=t[0],P=t[1],L=t[2],N=t[3],B=t[4],U=t[5],H=t[6],Q=t[7],ne=t[8];return Math.abs(o-I)<=Vs.EPSILON*Math.max(1,Math.abs(o),Math.abs(I))&&Math.abs(l-P)<=Vs.EPSILON*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(h-L)<=Vs.EPSILON*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(f-N)<=Vs.EPSILON*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(g-B)<=Vs.EPSILON*Math.max(1,Math.abs(g),Math.abs(B))&&Math.abs(v-U)<=Vs.EPSILON*Math.max(1,Math.abs(v),Math.abs(U))&&Math.abs(w-H)<=Vs.EPSILON*Math.max(1,Math.abs(w),Math.abs(H))&&Math.abs(E-Q)<=Vs.EPSILON*Math.max(1,Math.abs(E),Math.abs(Q))&&Math.abs(D-ne)<=Vs.EPSILON*Math.max(1,Math.abs(D),Math.abs(ne))},xi.sub=xi.mul=void 0;var Vs=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==G_(n)&&"function"!=typeof n)return{default:n};var o=D0(void 0);if(o&&o.has(n))return o.get(n);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in n)if("default"!==f&&Object.prototype.hasOwnProperty.call(n,f)){var g=h?Object.getOwnPropertyDescriptor(n,f):null;g&&(g.get||g.set)?Object.defineProperty(l,f,g):l[f]=n[f]}return l.default=n,o&&o.set(n,l),l}(hr);function D0(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(D0=function(l){return l?o:t})(n)}function T0(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3],v=t[4],w=t[5],E=t[6],D=t[7],I=t[8],P=o[0],L=o[1],N=o[2],B=o[3],U=o[4],H=o[5],Q=o[6],ne=o[7],ie=o[8];return n[0]=P*l+L*g+N*E,n[1]=P*h+L*v+N*D,n[2]=P*f+L*w+N*I,n[3]=B*l+U*g+H*E,n[4]=B*h+U*v+H*D,n[5]=B*f+U*w+H*I,n[6]=Q*l+ne*g+ie*E,n[7]=Q*h+ne*v+ie*D,n[8]=Q*f+ne*w+ie*I,n}function Vm(n,t,o){return n[0]=t[0]-o[0],n[1]=t[1]-o[1],n[2]=t[2]-o[2],n[3]=t[3]-o[3],n[4]=t[4]-o[4],n[5]=t[5]-o[5],n[6]=t[6]-o[6],n[7]=t[7]-o[7],n[8]=t[8]-o[8],n}xi.mul=T0,xi.sub=Vm;var an={};function H_(n){return(H_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(an,"__esModule",{value:!0}),an.create=function(){var n=new Gi.ARRAY_TYPE(16);return Gi.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},an.clone=function(n){var t=new Gi.ARRAY_TYPE(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},an.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},an.fromValues=function(n,t,o,l,h,f,g,v,w,E,D,I,P,L,N,B){var U=new Gi.ARRAY_TYPE(16);return U[0]=n,U[1]=t,U[2]=o,U[3]=l,U[4]=h,U[5]=f,U[6]=g,U[7]=v,U[8]=w,U[9]=E,U[10]=D,U[11]=I,U[12]=P,U[13]=L,U[14]=N,U[15]=B,U},an.set=function(n,t,o,l,h,f,g,v,w,E,D,I,P,L,N,B,U){return n[0]=t,n[1]=o,n[2]=l,n[3]=h,n[4]=f,n[5]=g,n[6]=v,n[7]=w,n[8]=E,n[9]=D,n[10]=I,n[11]=P,n[12]=L,n[13]=N,n[14]=B,n[15]=U,n},an.identity=ap,an.transpose=function(n,t){if(n===t){var o=t[1],l=t[2],h=t[3],f=t[6],g=t[7],v=t[11];n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=o,n[6]=t[9],n[7]=t[13],n[8]=l,n[9]=f,n[11]=t[14],n[12]=h,n[13]=g,n[14]=v}else n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=t[1],n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=t[2],n[9]=t[6],n[10]=t[10],n[11]=t[14],n[12]=t[3],n[13]=t[7],n[14]=t[11],n[15]=t[15];return n},an.invert=function(n,t){var o=t[0],l=t[1],h=t[2],f=t[3],g=t[4],v=t[5],w=t[6],E=t[7],D=t[8],I=t[9],P=t[10],L=t[11],N=t[12],B=t[13],U=t[14],H=t[15],Q=o*v-l*g,ne=o*w-h*g,ie=o*E-f*g,ue=l*w-h*v,ae=l*E-f*v,de=h*E-f*w,ye=D*B-I*N,be=D*U-P*N,Te=D*H-L*N,we=I*U-P*B,Oe=I*H-L*B,Ge=P*H-L*U,Re=Q*Ge-ne*Oe+ie*we+ue*Te-ae*be+de*ye;return Re?(n[0]=(v*Ge-w*Oe+E*we)*(Re=1/Re),n[1]=(h*Oe-l*Ge-f*we)*Re,n[2]=(B*de-U*ae+H*ue)*Re,n[3]=(P*ae-I*de-L*ue)*Re,n[4]=(w*Te-g*Ge-E*be)*Re,n[5]=(o*Ge-h*Te+f*be)*Re,n[6]=(U*ie-N*de-H*ne)*Re,n[7]=(D*de-P*ie+L*ne)*Re,n[8]=(g*Oe-v*Te+E*ye)*Re,n[9]=(l*Te-o*Oe-f*ye)*Re,n[10]=(N*ae-B*ie+H*Q)*Re,n[11]=(I*ie-D*ae-L*Q)*Re,n[12]=(v*be-g*we-w*ye)*Re,n[13]=(o*we-l*be+h*ye)*Re,n[14]=(B*ne-N*ue-U*Q)*Re,n[15]=(D*ue-I*ne+P*Q)*Re,n):null},an.adjoint=function(n,t){var o=t[0],l=t[1],h=t[2],f=t[3],g=t[4],v=t[5],w=t[6],E=t[7],D=t[8],I=t[9],P=t[10],L=t[11],N=t[12],B=t[13],U=t[14],H=t[15];return n[0]=v*(P*H-L*U)-I*(w*H-E*U)+B*(w*L-E*P),n[1]=-(l*(P*H-L*U)-I*(h*H-f*U)+B*(h*L-f*P)),n[2]=l*(w*H-E*U)-v*(h*H-f*U)+B*(h*E-f*w),n[3]=-(l*(w*L-E*P)-v*(h*L-f*P)+I*(h*E-f*w)),n[4]=-(g*(P*H-L*U)-D*(w*H-E*U)+N*(w*L-E*P)),n[5]=o*(P*H-L*U)-D*(h*H-f*U)+N*(h*L-f*P),n[6]=-(o*(w*H-E*U)-g*(h*H-f*U)+N*(h*E-f*w)),n[7]=o*(w*L-E*P)-g*(h*L-f*P)+D*(h*E-f*w),n[8]=g*(I*H-L*B)-D*(v*H-E*B)+N*(v*L-E*I),n[9]=-(o*(I*H-L*B)-D*(l*H-f*B)+N*(l*L-f*I)),n[10]=o*(v*H-E*B)-g*(l*H-f*B)+N*(l*E-f*v),n[11]=-(o*(v*L-E*I)-g*(l*L-f*I)+D*(l*E-f*v)),n[12]=-(g*(I*U-P*B)-D*(v*U-w*B)+N*(v*P-w*I)),n[13]=o*(I*U-P*B)-D*(l*U-h*B)+N*(l*P-h*I),n[14]=-(o*(v*U-w*B)-g*(l*U-h*B)+N*(l*w-h*v)),n[15]=o*(v*P-w*I)-g*(l*P-h*I)+D*(l*w-h*v),n},an.determinant=function(n){var t=n[0],o=n[1],l=n[2],h=n[3],f=n[4],g=n[5],v=n[6],w=n[7],E=n[8],D=n[9],I=n[10],P=n[11],L=n[12],N=n[13],B=n[14],U=n[15];return(t*g-o*f)*(I*U-P*B)-(t*v-l*f)*(D*U-P*N)+(t*w-h*f)*(D*B-I*N)+(o*v-l*g)*(E*U-P*L)-(o*w-h*g)*(E*B-I*L)+(l*w-h*v)*(E*N-D*L)},an.multiply=I0,an.translate=function(n,t,o){var l,h,f,g,v,w,E,D,I,P,L,N,B=o[0],U=o[1],H=o[2];return t===n?(n[12]=t[0]*B+t[4]*U+t[8]*H+t[12],n[13]=t[1]*B+t[5]*U+t[9]*H+t[13],n[14]=t[2]*B+t[6]*U+t[10]*H+t[14],n[15]=t[3]*B+t[7]*U+t[11]*H+t[15]):(h=t[1],f=t[2],g=t[3],v=t[4],w=t[5],E=t[6],D=t[7],I=t[8],P=t[9],L=t[10],N=t[11],n[0]=l=t[0],n[1]=h,n[2]=f,n[3]=g,n[4]=v,n[5]=w,n[6]=E,n[7]=D,n[8]=I,n[9]=P,n[10]=L,n[11]=N,n[12]=l*B+v*U+I*H+t[12],n[13]=h*B+w*U+P*H+t[13],n[14]=f*B+E*U+L*H+t[14],n[15]=g*B+D*U+N*H+t[15]),n},an.scale=function(n,t,o){var l=o[0],h=o[1],f=o[2];return n[0]=t[0]*l,n[1]=t[1]*l,n[2]=t[2]*l,n[3]=t[3]*l,n[4]=t[4]*h,n[5]=t[5]*h,n[6]=t[6]*h,n[7]=t[7]*h,n[8]=t[8]*f,n[9]=t[9]*f,n[10]=t[10]*f,n[11]=t[11]*f,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},an.rotate=function(n,t,o,l){var h,f,g,v,w,E,D,I,P,L,N,B,U,H,Q,ne,ie,ue,ae,de,ye,be,Te,we,Oe=l[0],Ge=l[1],Re=l[2],Ve=Math.hypot(Oe,Ge,Re);return Ve<Gi.EPSILON?null:(Oe*=Ve=1/Ve,Ge*=Ve,Re*=Ve,h=Math.sin(o),f=Math.cos(o),w=t[1],E=t[2],D=t[3],P=t[5],L=t[6],N=t[7],U=t[9],H=t[10],Q=t[11],ne=Oe*Oe*(g=1-f)+f,ae=Oe*Ge*g-Re*h,de=Ge*Ge*g+f,ye=Re*Ge*g+Oe*h,be=Oe*Re*g+Ge*h,Te=Ge*Re*g-Oe*h,we=Re*Re*g+f,n[0]=(v=t[0])*ne+(I=t[4])*(ie=Ge*Oe*g+Re*h)+(B=t[8])*(ue=Re*Oe*g-Ge*h),n[1]=w*ne+P*ie+U*ue,n[2]=E*ne+L*ie+H*ue,n[3]=D*ne+N*ie+Q*ue,n[4]=v*ae+I*de+B*ye,n[5]=w*ae+P*de+U*ye,n[6]=E*ae+L*de+H*ye,n[7]=D*ae+N*de+Q*ye,n[8]=v*be+I*Te+B*we,n[9]=w*be+P*Te+U*we,n[10]=E*be+L*Te+H*we,n[11]=D*be+N*Te+Q*we,t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n)},an.rotateX=function(n,t,o){var l=Math.sin(o),h=Math.cos(o),f=t[4],g=t[5],v=t[6],w=t[7],E=t[8],D=t[9],I=t[10],P=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=f*h+E*l,n[5]=g*h+D*l,n[6]=v*h+I*l,n[7]=w*h+P*l,n[8]=E*h-f*l,n[9]=D*h-g*l,n[10]=I*h-v*l,n[11]=P*h-w*l,n},an.rotateY=function(n,t,o){var l=Math.sin(o),h=Math.cos(o),f=t[0],g=t[1],v=t[2],w=t[3],E=t[8],D=t[9],I=t[10],P=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=f*h-E*l,n[1]=g*h-D*l,n[2]=v*h-I*l,n[3]=w*h-P*l,n[8]=f*l+E*h,n[9]=g*l+D*h,n[10]=v*l+I*h,n[11]=w*l+P*h,n},an.rotateZ=function(n,t,o){var l=Math.sin(o),h=Math.cos(o),f=t[0],g=t[1],v=t[2],w=t[3],E=t[4],D=t[5],I=t[6],P=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=f*h+E*l,n[1]=g*h+D*l,n[2]=v*h+I*l,n[3]=w*h+P*l,n[4]=E*h-f*l,n[5]=D*h-g*l,n[6]=I*h-v*l,n[7]=P*h-w*l,n},an.fromTranslation=function(n,t){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},an.fromScaling=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},an.fromRotation=function(n,t,o){var l,h,f,g=o[0],v=o[1],w=o[2],E=Math.hypot(g,v,w);return E<Gi.EPSILON?null:(g*=E=1/E,v*=E,w*=E,l=Math.sin(t),h=Math.cos(t),n[0]=g*g*(f=1-h)+h,n[1]=v*g*f+w*l,n[2]=w*g*f-v*l,n[3]=0,n[4]=g*v*f-w*l,n[5]=v*v*f+h,n[6]=w*v*f+g*l,n[7]=0,n[8]=g*w*f+v*l,n[9]=v*w*f-g*l,n[10]=w*w*f+h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)},an.fromXRotation=function(n,t){var o=Math.sin(t),l=Math.cos(t);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=l,n[6]=o,n[7]=0,n[8]=0,n[9]=-o,n[10]=l,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},an.fromYRotation=function(n,t){var o=Math.sin(t),l=Math.cos(t);return n[0]=l,n[1]=0,n[2]=-o,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=o,n[9]=0,n[10]=l,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},an.fromZRotation=function(n,t){var o=Math.sin(t),l=Math.cos(t);return n[0]=l,n[1]=o,n[2]=0,n[3]=0,n[4]=-o,n[5]=l,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},an.fromRotationTranslation=q_,an.fromQuat2=function(n,t){var o=new Gi.ARRAY_TYPE(3),l=-t[0],h=-t[1],f=-t[2],g=t[3],v=t[4],w=t[5],E=t[6],D=t[7],I=l*l+h*h+f*f+g*g;return I>0?(o[0]=2*(v*g+D*l+w*f-E*h)/I,o[1]=2*(w*g+D*h+E*l-v*f)/I,o[2]=2*(E*g+D*f+v*h-w*l)/I):(o[0]=2*(v*g+D*l+w*f-E*h),o[1]=2*(w*g+D*h+E*l-v*f),o[2]=2*(E*g+D*f+v*h-w*l)),q_(n,t,o),n},an.getTranslation=function(n,t){return n[0]=t[12],n[1]=t[13],n[2]=t[14],n},an.getScaling=jm,an.getRotation=function(n,t){var o=new Gi.ARRAY_TYPE(3);jm(o,t);var l=1/o[0],h=1/o[1],f=1/o[2],g=t[0]*l,v=t[1]*h,w=t[2]*f,E=t[4]*l,D=t[5]*h,I=t[6]*f,P=t[8]*l,L=t[9]*h,N=t[10]*f,B=g+D+N,U=0;return B>0?(U=2*Math.sqrt(B+1),n[3]=.25*U,n[0]=(I-L)/U,n[1]=(P-w)/U,n[2]=(v-E)/U):g>D&&g>N?(U=2*Math.sqrt(1+g-D-N),n[3]=(I-L)/U,n[0]=.25*U,n[1]=(v+E)/U,n[2]=(P+w)/U):D>N?(U=2*Math.sqrt(1+D-g-N),n[3]=(P-w)/U,n[0]=(v+E)/U,n[1]=.25*U,n[2]=(I+L)/U):(U=2*Math.sqrt(1+N-g-D),n[3]=(v-E)/U,n[0]=(P+w)/U,n[1]=(I+L)/U,n[2]=.25*U),n},an.fromRotationTranslationScale=function(n,t,o,l){var h=t[0],f=t[1],g=t[2],v=t[3],w=h+h,E=f+f,D=g+g,I=h*w,P=h*E,L=h*D,N=f*E,B=f*D,U=g*D,H=v*w,Q=v*E,ne=v*D,ie=l[0],ue=l[1],ae=l[2];return n[0]=(1-(N+U))*ie,n[1]=(P+ne)*ie,n[2]=(L-Q)*ie,n[3]=0,n[4]=(P-ne)*ue,n[5]=(1-(I+U))*ue,n[6]=(B+H)*ue,n[7]=0,n[8]=(L+Q)*ae,n[9]=(B-H)*ae,n[10]=(1-(I+N))*ae,n[11]=0,n[12]=o[0],n[13]=o[1],n[14]=o[2],n[15]=1,n},an.fromRotationTranslationScaleOrigin=function(n,t,o,l,h){var f=t[0],g=t[1],v=t[2],w=t[3],E=f+f,D=g+g,I=v+v,P=f*E,L=f*D,N=f*I,B=g*D,U=g*I,H=v*I,Q=w*E,ne=w*D,ie=w*I,ue=l[0],ae=l[1],de=l[2],ye=h[0],be=h[1],Te=h[2],we=(1-(B+H))*ue,Oe=(L+ie)*ue,Ge=(N-ne)*ue,Re=(L-ie)*ae,Ve=(1-(P+H))*ae,Ie=(U+Q)*ae,je=(N+ne)*de,lt=(U-Q)*de,Be=(1-(P+B))*de;return n[0]=we,n[1]=Oe,n[2]=Ge,n[3]=0,n[4]=Re,n[5]=Ve,n[6]=Ie,n[7]=0,n[8]=je,n[9]=lt,n[10]=Be,n[11]=0,n[12]=o[0]+ye-(we*ye+Re*be+je*Te),n[13]=o[1]+be-(Oe*ye+Ve*be+lt*Te),n[14]=o[2]+Te-(Ge*ye+Ie*be+Be*Te),n[15]=1,n},an.fromQuat=function(n,t){var o=t[0],l=t[1],h=t[2],f=t[3],g=o+o,v=l+l,w=h+h,E=o*g,D=l*g,I=l*v,P=h*g,L=h*v,N=h*w,B=f*g,U=f*v,H=f*w;return n[0]=1-I-N,n[1]=D+H,n[2]=P-U,n[3]=0,n[4]=D-H,n[5]=1-E-N,n[6]=L+B,n[7]=0,n[8]=P+U,n[9]=L-B,n[10]=1-E-I,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},an.frustum=function(n,t,o,l,h,f,g){var v=1/(o-t),w=1/(h-l),E=1/(f-g);return n[0]=2*f*v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*f*w,n[6]=0,n[7]=0,n[8]=(o+t)*v,n[9]=(h+l)*w,n[10]=(g+f)*E,n[11]=-1,n[12]=0,n[13]=0,n[14]=g*f*2*E,n[15]=0,n},an.perspectiveNO=lp,an.perspectiveZO=function(n,t,o,l,h){var f,g=1/Math.tan(t/2);return n[0]=g/o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=h&&h!==1/0?(n[10]=h*(f=1/(l-h)),n[14]=h*l*f):(n[10]=-1,n[14]=-l),n},an.perspectiveFromFieldOfView=function(n,t,o,l){var h=Math.tan(t.upDegrees*Math.PI/180),f=Math.tan(t.downDegrees*Math.PI/180),g=Math.tan(t.leftDegrees*Math.PI/180),v=Math.tan(t.rightDegrees*Math.PI/180),w=2/(g+v),E=2/(h+f);return n[0]=w,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=E,n[6]=0,n[7]=0,n[8]=-(g-v)*w*.5,n[9]=(h-f)*E*.5,n[10]=l/(o-l),n[11]=-1,n[12]=0,n[13]=0,n[14]=l*o/(o-l),n[15]=0,n},an.orthoNO=Z_,an.orthoZO=function(n,t,o,l,h,f,g){var v=1/(t-o),w=1/(l-h),E=1/(f-g);return n[0]=-2*v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=E,n[11]=0,n[12]=(t+o)*v,n[13]=(h+l)*w,n[14]=f*E,n[15]=1,n},an.lookAt=function(n,t,o,l){var h,f,g,v,w,E,D,I,P,L,N=t[0],B=t[1],U=t[2],H=l[0],Q=l[1],ne=l[2],ie=o[0],ue=o[1],ae=o[2];return Math.abs(N-ie)<Gi.EPSILON&&Math.abs(B-ue)<Gi.EPSILON&&Math.abs(U-ae)<Gi.EPSILON?ap(n):(D=N-ie,I=B-ue,P=U-ae,h=Q*(P*=L=1/Math.hypot(D,I,P))-ne*(I*=L),f=ne*(D*=L)-H*P,g=H*I-Q*D,(L=Math.hypot(h,f,g))?(h*=L=1/L,f*=L,g*=L):(h=0,f=0,g=0),v=I*g-P*f,w=P*h-D*g,E=D*f-I*h,(L=Math.hypot(v,w,E))?(v*=L=1/L,w*=L,E*=L):(v=0,w=0,E=0),n[0]=h,n[1]=v,n[2]=D,n[3]=0,n[4]=f,n[5]=w,n[6]=I,n[7]=0,n[8]=g,n[9]=E,n[10]=P,n[11]=0,n[12]=-(h*N+f*B+g*U),n[13]=-(v*N+w*B+E*U),n[14]=-(D*N+I*B+P*U),n[15]=1,n)},an.targetTo=function(n,t,o,l){var h=t[0],f=t[1],g=t[2],v=l[0],w=l[1],E=l[2],D=h-o[0],I=f-o[1],P=g-o[2],L=D*D+I*I+P*P;L>0&&(D*=L=1/Math.sqrt(L),I*=L,P*=L);var N=w*P-E*I,B=E*D-v*P,U=v*I-w*D;return(L=N*N+B*B+U*U)>0&&(N*=L=1/Math.sqrt(L),B*=L,U*=L),n[0]=N,n[1]=B,n[2]=U,n[3]=0,n[4]=I*U-P*B,n[5]=P*N-D*U,n[6]=D*B-I*N,n[7]=0,n[8]=D,n[9]=I,n[10]=P,n[11]=0,n[12]=h,n[13]=f,n[14]=g,n[15]=1,n},an.str=function(n){return"mat4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+", "+n[9]+", "+n[10]+", "+n[11]+", "+n[12]+", "+n[13]+", "+n[14]+", "+n[15]+")"},an.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])},an.add=function(n,t,o){return n[0]=t[0]+o[0],n[1]=t[1]+o[1],n[2]=t[2]+o[2],n[3]=t[3]+o[3],n[4]=t[4]+o[4],n[5]=t[5]+o[5],n[6]=t[6]+o[6],n[7]=t[7]+o[7],n[8]=t[8]+o[8],n[9]=t[9]+o[9],n[10]=t[10]+o[10],n[11]=t[11]+o[11],n[12]=t[12]+o[12],n[13]=t[13]+o[13],n[14]=t[14]+o[14],n[15]=t[15]+o[15],n},an.subtract=S0,an.multiplyScalar=function(n,t,o){return n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n[3]=t[3]*o,n[4]=t[4]*o,n[5]=t[5]*o,n[6]=t[6]*o,n[7]=t[7]*o,n[8]=t[8]*o,n[9]=t[9]*o,n[10]=t[10]*o,n[11]=t[11]*o,n[12]=t[12]*o,n[13]=t[13]*o,n[14]=t[14]*o,n[15]=t[15]*o,n},an.multiplyScalarAndAdd=function(n,t,o,l){return n[0]=t[0]+o[0]*l,n[1]=t[1]+o[1]*l,n[2]=t[2]+o[2]*l,n[3]=t[3]+o[3]*l,n[4]=t[4]+o[4]*l,n[5]=t[5]+o[5]*l,n[6]=t[6]+o[6]*l,n[7]=t[7]+o[7]*l,n[8]=t[8]+o[8]*l,n[9]=t[9]+o[9]*l,n[10]=t[10]+o[10]*l,n[11]=t[11]+o[11]*l,n[12]=t[12]+o[12]*l,n[13]=t[13]+o[13]*l,n[14]=t[14]+o[14]*l,n[15]=t[15]+o[15]*l,n},an.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},an.equals=function(n,t){var o=n[0],l=n[1],h=n[2],f=n[3],g=n[4],v=n[5],w=n[6],E=n[7],D=n[8],I=n[9],P=n[10],L=n[11],N=n[12],B=n[13],U=n[14],H=n[15],Q=t[0],ne=t[1],ie=t[2],ue=t[3],ae=t[4],de=t[5],ye=t[6],be=t[7],Te=t[8],we=t[9],Oe=t[10],Ge=t[11],Re=t[12],Ve=t[13],Ie=t[14],je=t[15];return Math.abs(o-Q)<=Gi.EPSILON*Math.max(1,Math.abs(o),Math.abs(Q))&&Math.abs(l-ne)<=Gi.EPSILON*Math.max(1,Math.abs(l),Math.abs(ne))&&Math.abs(h-ie)<=Gi.EPSILON*Math.max(1,Math.abs(h),Math.abs(ie))&&Math.abs(f-ue)<=Gi.EPSILON*Math.max(1,Math.abs(f),Math.abs(ue))&&Math.abs(g-ae)<=Gi.EPSILON*Math.max(1,Math.abs(g),Math.abs(ae))&&Math.abs(v-de)<=Gi.EPSILON*Math.max(1,Math.abs(v),Math.abs(de))&&Math.abs(w-ye)<=Gi.EPSILON*Math.max(1,Math.abs(w),Math.abs(ye))&&Math.abs(E-be)<=Gi.EPSILON*Math.max(1,Math.abs(E),Math.abs(be))&&Math.abs(D-Te)<=Gi.EPSILON*Math.max(1,Math.abs(D),Math.abs(Te))&&Math.abs(I-we)<=Gi.EPSILON*Math.max(1,Math.abs(I),Math.abs(we))&&Math.abs(P-Oe)<=Gi.EPSILON*Math.max(1,Math.abs(P),Math.abs(Oe))&&Math.abs(L-Ge)<=Gi.EPSILON*Math.max(1,Math.abs(L),Math.abs(Ge))&&Math.abs(N-Re)<=Gi.EPSILON*Math.max(1,Math.abs(N),Math.abs(Re))&&Math.abs(B-Ve)<=Gi.EPSILON*Math.max(1,Math.abs(B),Math.abs(Ve))&&Math.abs(U-Ie)<=Gi.EPSILON*Math.max(1,Math.abs(U),Math.abs(Ie))&&Math.abs(H-je)<=Gi.EPSILON*Math.max(1,Math.abs(H),Math.abs(je))},an.sub=an.mul=an.ortho=an.perspective=void 0;var Gi=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==H_(n)&&"function"!=typeof n)return{default:n};var o=M0(void 0);if(o&&o.has(n))return o.get(n);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in n)if("default"!==f&&Object.prototype.hasOwnProperty.call(n,f)){var g=h?Object.getOwnPropertyDescriptor(n,f):null;g&&(g.get||g.set)?Object.defineProperty(l,f,g):l[f]=n[f]}return l.default=n,o&&o.set(n,l),l}(hr);function M0(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(M0=function(l){return l?o:t})(n)}function ap(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function I0(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3],v=t[4],w=t[5],E=t[6],D=t[7],I=t[8],P=t[9],L=t[10],N=t[11],B=t[12],U=t[13],H=t[14],Q=t[15],ne=o[0],ie=o[1],ue=o[2],ae=o[3];return n[0]=ne*l+ie*v+ue*I+ae*B,n[1]=ne*h+ie*w+ue*P+ae*U,n[2]=ne*f+ie*E+ue*L+ae*H,n[3]=ne*g+ie*D+ue*N+ae*Q,n[4]=(ne=o[4])*l+(ie=o[5])*v+(ue=o[6])*I+(ae=o[7])*B,n[5]=ne*h+ie*w+ue*P+ae*U,n[6]=ne*f+ie*E+ue*L+ae*H,n[7]=ne*g+ie*D+ue*N+ae*Q,n[8]=(ne=o[8])*l+(ie=o[9])*v+(ue=o[10])*I+(ae=o[11])*B,n[9]=ne*h+ie*w+ue*P+ae*U,n[10]=ne*f+ie*E+ue*L+ae*H,n[11]=ne*g+ie*D+ue*N+ae*Q,n[12]=(ne=o[12])*l+(ie=o[13])*v+(ue=o[14])*I+(ae=o[15])*B,n[13]=ne*h+ie*w+ue*P+ae*U,n[14]=ne*f+ie*E+ue*L+ae*H,n[15]=ne*g+ie*D+ue*N+ae*Q,n}function q_(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3],v=l+l,w=h+h,E=f+f,D=l*v,I=l*w,P=l*E,L=h*w,N=h*E,B=f*E,U=g*v,H=g*w,Q=g*E;return n[0]=1-(L+B),n[1]=I+Q,n[2]=P-H,n[3]=0,n[4]=I-Q,n[5]=1-(D+B),n[6]=N+U,n[7]=0,n[8]=P+H,n[9]=N-U,n[10]=1-(D+L),n[11]=0,n[12]=o[0],n[13]=o[1],n[14]=o[2],n[15]=1,n}function jm(n,t){var o=t[4],l=t[5],h=t[6],f=t[8],g=t[9],v=t[10];return n[0]=Math.hypot(t[0],t[1],t[2]),n[1]=Math.hypot(o,l,h),n[2]=Math.hypot(f,g,v),n}function lp(n,t,o,l,h){var f,g=1/Math.tan(t/2);return n[0]=g/o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=h&&h!==1/0?(n[10]=(h+l)*(f=1/(l-h)),n[14]=2*h*l*f):(n[10]=-1,n[14]=-2*l),n}function Z_(n,t,o,l,h,f,g){var v=1/(t-o),w=1/(l-h),E=1/(f-g);return n[0]=-2*v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*E,n[11]=0,n[12]=(t+o)*v,n[13]=(h+l)*w,n[14]=(g+f)*E,n[15]=1,n}function S0(n,t,o){return n[0]=t[0]-o[0],n[1]=t[1]-o[1],n[2]=t[2]-o[2],n[3]=t[3]-o[3],n[4]=t[4]-o[4],n[5]=t[5]-o[5],n[6]=t[6]-o[6],n[7]=t[7]-o[7],n[8]=t[8]-o[8],n[9]=t[9]-o[9],n[10]=t[10]-o[10],n[11]=t[11]-o[11],n[12]=t[12]-o[12],n[13]=t[13]-o[13],n[14]=t[14]-o[14],n[15]=t[15]-o[15],n}an.perspective=lp,an.ortho=Z_,an.mul=I0,an.sub=S0;var ln={},nn={};function rh(n){return(rh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(nn,"__esModule",{value:!0}),nn.create=W_,nn.clone=function(n){var t=new nc.ARRAY_TYPE(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},nn.length=A0,nn.fromValues=function(n,t,o){var l=new nc.ARRAY_TYPE(3);return l[0]=n,l[1]=t,l[2]=o,l},nn.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},nn.set=function(n,t,o,l){return n[0]=t,n[1]=o,n[2]=l,n},nn.add=function(n,t,o){return n[0]=t[0]+o[0],n[1]=t[1]+o[1],n[2]=t[2]+o[2],n},nn.subtract=hw,nn.multiply=R0,nn.divide=P0,nn.ceil=function(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n},nn.floor=function(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n},nn.min=function(n,t,o){return n[0]=Math.min(t[0],o[0]),n[1]=Math.min(t[1],o[1]),n[2]=Math.min(t[2],o[2]),n},nn.max=function(n,t,o){return n[0]=Math.max(t[0],o[0]),n[1]=Math.max(t[1],o[1]),n[2]=Math.max(t[2],o[2]),n},nn.round=function(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n},nn.scale=function(n,t,o){return n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n},nn.scaleAndAdd=function(n,t,o,l){return n[0]=t[0]+o[0]*l,n[1]=t[1]+o[1]*l,n[2]=t[2]+o[2]*l,n},nn.distance=O0,nn.squaredDistance=cp,nn.squaredLength=Y_,nn.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n},nn.inverse=function(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n},nn.normalize=function(n,t){var o=t[0],l=t[1],h=t[2],f=o*o+l*l+h*h;return f>0&&(f=1/Math.sqrt(f)),n[0]=t[0]*f,n[1]=t[1]*f,n[2]=t[2]*f,n},nn.dot=k0,nn.cross=function(n,t,o){var l=t[0],h=t[1],f=t[2],g=o[0],v=o[1],w=o[2];return n[0]=h*w-f*v,n[1]=f*g-l*w,n[2]=l*v-h*g,n},nn.lerp=function(n,t,o,l){var h=t[0],f=t[1],g=t[2];return n[0]=h+l*(o[0]-h),n[1]=f+l*(o[1]-f),n[2]=g+l*(o[2]-g),n},nn.hermite=function(n,t,o,l,h,f){var g=f*f,v=g*(2*f-3)+1,w=g*(f-2)+f,E=g*(f-1),D=g*(3-2*f);return n[0]=t[0]*v+o[0]*w+l[0]*E+h[0]*D,n[1]=t[1]*v+o[1]*w+l[1]*E+h[1]*D,n[2]=t[2]*v+o[2]*w+l[2]*E+h[2]*D,n},nn.bezier=function(n,t,o,l,h,f){var g=1-f,v=g*g,w=f*f,E=v*g,D=3*f*v,I=3*w*g,P=w*f;return n[0]=t[0]*E+o[0]*D+l[0]*I+h[0]*P,n[1]=t[1]*E+o[1]*D+l[1]*I+h[1]*P,n[2]=t[2]*E+o[2]*D+l[2]*I+h[2]*P,n},nn.random=function(n,t){t=t||1;var o=2*nc.RANDOM()*Math.PI,l=2*nc.RANDOM()-1,h=Math.sqrt(1-l*l)*t;return n[0]=Math.cos(o)*h,n[1]=Math.sin(o)*h,n[2]=l*t,n},nn.transformMat4=function(n,t,o){var l=t[0],h=t[1],f=t[2],g=o[3]*l+o[7]*h+o[11]*f+o[15];return n[0]=(o[0]*l+o[4]*h+o[8]*f+o[12])/(g=g||1),n[1]=(o[1]*l+o[5]*h+o[9]*f+o[13])/g,n[2]=(o[2]*l+o[6]*h+o[10]*f+o[14])/g,n},nn.transformMat3=function(n,t,o){var l=t[0],h=t[1],f=t[2];return n[0]=l*o[0]+h*o[3]+f*o[6],n[1]=l*o[1]+h*o[4]+f*o[7],n[2]=l*o[2]+h*o[5]+f*o[8],n},nn.transformQuat=function(n,t,o){var l=o[0],h=o[1],f=o[2],g=t[0],v=t[1],w=t[2],E=h*w-f*v,D=f*g-l*w,I=l*v-h*g,P=h*I-f*D,L=f*E-l*I,N=l*D-h*E,B=2*o[3];return D*=B,I*=B,L*=2,N*=2,n[0]=g+(E*=B)+(P*=2),n[1]=v+D+L,n[2]=w+I+N,n},nn.rotateX=function(n,t,o,l){var h=[],f=[];return h[0]=t[0]-o[0],h[1]=t[1]-o[1],h[2]=t[2]-o[2],f[0]=h[0],f[1]=h[1]*Math.cos(l)-h[2]*Math.sin(l),f[2]=h[1]*Math.sin(l)+h[2]*Math.cos(l),n[0]=f[0]+o[0],n[1]=f[1]+o[1],n[2]=f[2]+o[2],n},nn.rotateY=function(n,t,o,l){var h=[],f=[];return h[0]=t[0]-o[0],h[1]=t[1]-o[1],h[2]=t[2]-o[2],f[0]=h[2]*Math.sin(l)+h[0]*Math.cos(l),f[1]=h[1],f[2]=h[2]*Math.cos(l)-h[0]*Math.sin(l),n[0]=f[0]+o[0],n[1]=f[1]+o[1],n[2]=f[2]+o[2],n},nn.rotateZ=function(n,t,o,l){var h=[],f=[];return h[0]=t[0]-o[0],h[1]=t[1]-o[1],h[2]=t[2]-o[2],f[0]=h[0]*Math.cos(l)-h[1]*Math.sin(l),f[1]=h[0]*Math.sin(l)+h[1]*Math.cos(l),f[2]=h[2],n[0]=f[0]+o[0],n[1]=f[1]+o[1],n[2]=f[2]+o[2],n},nn.angle=function(n,t){var o=n[0],l=n[1],h=n[2],f=t[0],g=t[1],v=t[2],w=Math.sqrt(o*o+l*l+h*h)*Math.sqrt(f*f+g*g+v*v),E=w&&k0(n,t)/w;return Math.acos(Math.min(Math.max(E,-1),1))},nn.zero=function(n){return n[0]=0,n[1]=0,n[2]=0,n},nn.str=function(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"},nn.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]},nn.equals=function(n,t){var o=n[0],l=n[1],h=n[2],f=t[0],g=t[1],v=t[2];return Math.abs(o-f)<=nc.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(l-g)<=nc.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(h-v)<=nc.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))},nn.forEach=nn.sqrLen=nn.len=nn.sqrDist=nn.dist=nn.div=nn.mul=nn.sub=void 0;var nc=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==rh(n)&&"function"!=typeof n)return{default:n};var o=uw(void 0);if(o&&o.has(n))return o.get(n);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in n)if("default"!==f&&Object.prototype.hasOwnProperty.call(n,f)){var g=h?Object.getOwnPropertyDescriptor(n,f):null;g&&(g.get||g.set)?Object.defineProperty(l,f,g):l[f]=n[f]}return l.default=n,o&&o.set(n,l),l}(hr);function uw(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(uw=function(l){return l?o:t})(n)}function W_(){var n=new nc.ARRAY_TYPE(3);return nc.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function A0(n){return Math.hypot(n[0],n[1],n[2])}function hw(n,t,o){return n[0]=t[0]-o[0],n[1]=t[1]-o[1],n[2]=t[2]-o[2],n}function R0(n,t,o){return n[0]=t[0]*o[0],n[1]=t[1]*o[1],n[2]=t[2]*o[2],n}function P0(n,t,o){return n[0]=t[0]/o[0],n[1]=t[1]/o[1],n[2]=t[2]/o[2],n}function O0(n,t){return Math.hypot(t[0]-n[0],t[1]-n[1],t[2]-n[2])}function cp(n,t){var o=t[0]-n[0],l=t[1]-n[1],h=t[2]-n[2];return o*o+l*l+h*h}function Y_(n){var t=n[0],o=n[1],l=n[2];return t*t+o*o+l*l}function k0(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}nn.sub=hw,nn.mul=R0,nn.div=P0,nn.dist=O0,nn.sqrDist=cp,nn.len=A0,nn.sqrLen=Y_;var vl,tT=(vl=W_(),function(n,t,o,l,h,f){var g,v;for(t||(t=3),o||(o=0),v=l?Math.min(l*t+o,n.length):n.length,g=o;g<v;g+=t)vl[0]=n[g],vl[1]=n[g+1],vl[2]=n[g+2],h(vl,vl,f),n[g]=vl[0],n[g+1]=vl[1],n[g+2]=vl[2];return n});nn.forEach=tT;var Tn={};function L0(n){return(L0="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.create=Um,Tn.clone=function(n){var t=new ma.ARRAY_TYPE(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},Tn.fromValues=function(n,t,o,l){var h=new ma.ARRAY_TYPE(4);return h[0]=n,h[1]=t,h[2]=o,h[3]=l,h},Tn.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},Tn.set=function(n,t,o,l,h){return n[0]=t,n[1]=o,n[2]=l,n[3]=h,n},Tn.add=function(n,t,o){return n[0]=t[0]+o[0],n[1]=t[1]+o[1],n[2]=t[2]+o[2],n[3]=t[3]+o[3],n},Tn.subtract=dw,Tn.multiply=fw,Tn.divide=$m,Tn.ceil=function(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n[3]=Math.ceil(t[3]),n},Tn.floor=function(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n[3]=Math.floor(t[3]),n},Tn.min=function(n,t,o){return n[0]=Math.min(t[0],o[0]),n[1]=Math.min(t[1],o[1]),n[2]=Math.min(t[2],o[2]),n[3]=Math.min(t[3],o[3]),n},Tn.max=function(n,t,o){return n[0]=Math.max(t[0],o[0]),n[1]=Math.max(t[1],o[1]),n[2]=Math.max(t[2],o[2]),n[3]=Math.max(t[3],o[3]),n},Tn.round=function(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n[3]=Math.round(t[3]),n},Tn.scale=function(n,t,o){return n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n[3]=t[3]*o,n},Tn.scaleAndAdd=function(n,t,o,l){return n[0]=t[0]+o[0]*l,n[1]=t[1]+o[1]*l,n[2]=t[2]+o[2]*l,n[3]=t[3]+o[3]*l,n},Tn.distance=pw,Tn.squaredDistance=mw,Tn.length=gw,Tn.squaredLength=_w,Tn.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n},Tn.inverse=function(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n[3]=1/t[3],n},Tn.normalize=function(n,t){var o=t[0],l=t[1],h=t[2],f=t[3],g=o*o+l*l+h*h+f*f;return g>0&&(g=1/Math.sqrt(g)),n[0]=o*g,n[1]=l*g,n[2]=h*g,n[3]=f*g,n},Tn.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},Tn.cross=function(n,t,o,l){var h=o[0]*l[1]-o[1]*l[0],f=o[0]*l[2]-o[2]*l[0],g=o[0]*l[3]-o[3]*l[0],v=o[1]*l[2]-o[2]*l[1],w=o[1]*l[3]-o[3]*l[1],E=o[2]*l[3]-o[3]*l[2],D=t[0],I=t[1],P=t[2],L=t[3];return n[0]=I*E-P*w+L*v,n[1]=-D*E+P*g-L*f,n[2]=D*w-I*g+L*h,n[3]=-D*v+I*f-P*h,n},Tn.lerp=function(n,t,o,l){var h=t[0],f=t[1],g=t[2],v=t[3];return n[0]=h+l*(o[0]-h),n[1]=f+l*(o[1]-f),n[2]=g+l*(o[2]-g),n[3]=v+l*(o[3]-v),n},Tn.random=function(n,t){var o,l,h,f,g,v;t=t||1;do{g=(o=2*ma.RANDOM()-1)*o+(l=2*ma.RANDOM()-1)*l}while(g>=1);do{v=(h=2*ma.RANDOM()-1)*h+(f=2*ma.RANDOM()-1)*f}while(v>=1);var w=Math.sqrt((1-g)/v);return n[0]=t*o,n[1]=t*l,n[2]=t*h*w,n[3]=t*f*w,n},Tn.transformMat4=function(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3];return n[0]=o[0]*l+o[4]*h+o[8]*f+o[12]*g,n[1]=o[1]*l+o[5]*h+o[9]*f+o[13]*g,n[2]=o[2]*l+o[6]*h+o[10]*f+o[14]*g,n[3]=o[3]*l+o[7]*h+o[11]*f+o[15]*g,n},Tn.transformQuat=function(n,t,o){var l=t[0],h=t[1],f=t[2],g=o[0],v=o[1],w=o[2],E=o[3],D=E*l+v*f-w*h,I=E*h+w*l-g*f,P=E*f+g*h-v*l,L=-g*l-v*h-w*f;return n[0]=D*E+L*-g+I*-w-P*-v,n[1]=I*E+L*-v+P*-g-D*-w,n[2]=P*E+L*-w+D*-v-I*-g,n[3]=t[3],n},Tn.zero=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n},Tn.str=function(n){return"vec4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},Tn.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]},Tn.equals=function(n,t){var o=n[0],l=n[1],h=n[2],f=n[3],g=t[0],v=t[1],w=t[2],E=t[3];return Math.abs(o-g)<=ma.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(l-v)<=ma.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(h-w)<=ma.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(f-E)<=ma.EPSILON*Math.max(1,Math.abs(f),Math.abs(E))},Tn.forEach=Tn.sqrLen=Tn.len=Tn.sqrDist=Tn.dist=Tn.div=Tn.mul=Tn.sub=void 0;var ma=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==L0(n)&&"function"!=typeof n)return{default:n};var o=F0(void 0);if(o&&o.has(n))return o.get(n);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in n)if("default"!==f&&Object.prototype.hasOwnProperty.call(n,f)){var g=h?Object.getOwnPropertyDescriptor(n,f):null;g&&(g.get||g.set)?Object.defineProperty(l,f,g):l[f]=n[f]}return l.default=n,o&&o.set(n,l),l}(hr);function F0(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(F0=function(l){return l?o:t})(n)}function Um(){var n=new ma.ARRAY_TYPE(4);return ma.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function dw(n,t,o){return n[0]=t[0]-o[0],n[1]=t[1]-o[1],n[2]=t[2]-o[2],n[3]=t[3]-o[3],n}function fw(n,t,o){return n[0]=t[0]*o[0],n[1]=t[1]*o[1],n[2]=t[2]*o[2],n[3]=t[3]*o[3],n}function $m(n,t,o){return n[0]=t[0]/o[0],n[1]=t[1]/o[1],n[2]=t[2]/o[2],n[3]=t[3]/o[3],n}function pw(n,t){return Math.hypot(t[0]-n[0],t[1]-n[1],t[2]-n[2],t[3]-n[3])}function mw(n,t){var o=t[0]-n[0],l=t[1]-n[1],h=t[2]-n[2],f=t[3]-n[3];return o*o+l*l+h*h+f*f}function gw(n){return Math.hypot(n[0],n[1],n[2],n[3])}function _w(n){var t=n[0],o=n[1],l=n[2],h=n[3];return t*t+o*o+l*l+h*h}Tn.sub=dw,Tn.mul=fw,Tn.div=$m,Tn.dist=pw,Tn.sqrDist=mw,Tn.len=gw,Tn.sqrLen=_w;var nT=function(){var n=Um();return function(t,o,l,h,f,g){var v,w;for(o||(o=4),l||(l=0),w=h?Math.min(h*o+l,t.length):t.length,v=l;v<w;v+=o)n[0]=t[v],n[1]=t[v+1],n[2]=t[v+2],n[3]=t[v+3],f(n,n,g),t[v]=n[0],t[v+1]=n[1],t[v+2]=n[2],t[v+3]=n[3];return t}}();function X_(n){return(X_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Tn.forEach=nT,Object.defineProperty(ln,"__esModule",{value:!0}),ln.create=Hm,ln.identity=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n},ln.setAxisAngle=J_,ln.getAxisAngle=function(n,t){var o=2*Math.acos(t[3]),l=Math.sin(o/2);return l>xl.EPSILON?(n[0]=t[0]/l,n[1]=t[1]/l,n[2]=t[2]/l):(n[0]=1,n[1]=0,n[2]=0),o},ln.getAngle=function(n,t){var o=Q_(n,t);return Math.acos(2*o*o-1)},ln.multiply=up,ln.rotateX=function(n,t,o){o*=.5;var l=t[0],h=t[1],f=t[2],g=t[3],v=Math.sin(o),w=Math.cos(o);return n[0]=l*w+g*v,n[1]=h*w+f*v,n[2]=f*w-h*v,n[3]=g*w-l*v,n},ln.rotateY=function(n,t,o){o*=.5;var l=t[0],h=t[1],f=t[2],g=t[3],v=Math.sin(o),w=Math.cos(o);return n[0]=l*w-f*v,n[1]=h*w+g*v,n[2]=f*w+l*v,n[3]=g*w-h*v,n},ln.rotateZ=function(n,t,o){o*=.5;var l=t[0],h=t[1],f=t[2],g=t[3],v=Math.sin(o),w=Math.cos(o);return n[0]=l*w+h*v,n[1]=h*w-l*v,n[2]=f*w+g*v,n[3]=g*w-f*v,n},ln.calculateW=function(n,t){var o=t[0],l=t[1],h=t[2];return n[0]=o,n[1]=l,n[2]=h,n[3]=Math.sqrt(Math.abs(1-o*o-l*l-h*h)),n},ln.exp=hp,ln.ln=rc,ln.pow=function(n,t,o){return rc(n,t),z0(n,n,o),hp(n,n),n},ln.slerp=qm,ln.random=function(n){var t=xl.RANDOM(),o=xl.RANDOM(),l=xl.RANDOM(),h=Math.sqrt(1-t),f=Math.sqrt(t);return n[0]=h*Math.sin(2*Math.PI*o),n[1]=h*Math.cos(2*Math.PI*o),n[2]=f*Math.sin(2*Math.PI*l),n[3]=f*Math.cos(2*Math.PI*l),n},ln.invert=function(n,t){var o=t[0],l=t[1],h=t[2],f=t[3],g=o*o+l*l+h*h+f*f,v=g?1/g:0;return n[0]=-o*v,n[1]=-l*v,n[2]=-h*v,n[3]=f*v,n},ln.conjugate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n},ln.fromMat3=N0,ln.fromEuler=function(n,t,o,l){var h=.5*Math.PI/180;t*=h,o*=h,l*=h;var f=Math.sin(t),g=Math.cos(t),v=Math.sin(o),w=Math.cos(o),E=Math.sin(l),D=Math.cos(l);return n[0]=f*w*D-g*v*E,n[1]=g*v*D+f*w*E,n[2]=g*w*E-f*v*D,n[3]=g*w*D+f*v*E,n},ln.str=function(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},ln.setAxes=ln.sqlerp=ln.rotationTo=ln.equals=ln.exactEquals=ln.normalize=ln.sqrLen=ln.squaredLength=ln.len=ln.length=ln.lerp=ln.dot=ln.scale=ln.mul=ln.add=ln.set=ln.copy=ln.fromValues=ln.clone=void 0;var xl=ic(hr),Gm=ic(xi),bl=ic(nn),_s=ic(Tn);function K_(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(K_=function(l){return l?o:t})(n)}function ic(n,t){if(!t&&n&&n.__esModule)return n;if(null===n||"object"!==X_(n)&&"function"!=typeof n)return{default:n};var o=K_(t);if(o&&o.has(n))return o.get(n);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in n)if("default"!==f&&Object.prototype.hasOwnProperty.call(n,f)){var g=h?Object.getOwnPropertyDescriptor(n,f):null;g&&(g.get||g.set)?Object.defineProperty(l,f,g):l[f]=n[f]}return l.default=n,o&&o.set(n,l),l}function Hm(){var n=new xl.ARRAY_TYPE(4);return xl.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function J_(n,t,o){o*=.5;var l=Math.sin(o);return n[0]=l*t[0],n[1]=l*t[1],n[2]=l*t[2],n[3]=Math.cos(o),n}function up(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3],v=o[0],w=o[1],E=o[2],D=o[3];return n[0]=l*D+g*v+h*E-f*w,n[1]=h*D+g*w+f*v-l*E,n[2]=f*D+g*E+l*w-h*v,n[3]=g*D-l*v-h*w-f*E,n}function hp(n,t){var o=t[0],l=t[1],h=t[2],f=t[3],g=Math.sqrt(o*o+l*l+h*h),v=Math.exp(f),w=g>0?v*Math.sin(g)/g:0;return n[0]=o*w,n[1]=l*w,n[2]=h*w,n[3]=v*Math.cos(g),n}function rc(n,t){var o=t[0],l=t[1],h=t[2],f=t[3],g=Math.sqrt(o*o+l*l+h*h),v=g>0?Math.atan2(g,f)/g:0;return n[0]=o*v,n[1]=l*v,n[2]=h*v,n[3]=.5*Math.log(o*o+l*l+h*h+f*f),n}function qm(n,t,o,l){var h,f,g,v,w,E=t[0],D=t[1],I=t[2],P=t[3],L=o[0],N=o[1],B=o[2],U=o[3];return(f=E*L+D*N+I*B+P*U)<0&&(f=-f,L=-L,N=-N,B=-B,U=-U),1-f>xl.EPSILON?(h=Math.acos(f),g=Math.sin(h),v=Math.sin((1-l)*h)/g,w=Math.sin(l*h)/g):(v=1-l,w=l),n[0]=v*E+w*L,n[1]=v*D+w*N,n[2]=v*I+w*B,n[3]=v*P+w*U,n}function N0(n,t){var o,l=t[0]+t[4]+t[8];if(l>0)o=Math.sqrt(l+1),n[3]=.5*o,n[0]=(t[5]-t[7])*(o=.5/o),n[1]=(t[6]-t[2])*o,n[2]=(t[1]-t[3])*o;else{var h=0;t[4]>t[0]&&(h=1),t[8]>t[3*h+h]&&(h=2);var f=(h+1)%3,g=(h+2)%3;o=Math.sqrt(t[3*h+h]-t[3*f+f]-t[3*g+g]+1),n[h]=.5*o,n[3]=(t[3*f+g]-t[3*g+f])*(o=.5/o),n[f]=(t[3*f+h]+t[3*h+f])*o,n[g]=(t[3*g+h]+t[3*h+g])*o}return n}ln.clone=_s.clone,ln.fromValues=_s.fromValues,ln.copy=_s.copy,ln.set=_s.set,ln.add=_s.add,ln.mul=up;var z0=_s.scale;ln.scale=z0;var Q_=_s.dot;ln.dot=Q_,ln.lerp=_s.lerp;var Zm=_s.length;ln.length=Zm,ln.len=Zm;var B0=_s.squaredLength;ln.squaredLength=B0,ln.sqrLen=B0;var ey=_s.normalize;ln.normalize=ey,ln.exactEquals=_s.exactEquals,ln.equals=_s.equals;var za,ty,V0,yw=(za=bl.create(),ty=bl.fromValues(1,0,0),V0=bl.fromValues(0,1,0),function(n,t,o){var l=bl.dot(t,o);return l<-.999999?(bl.cross(za,ty,t),bl.len(za)<1e-6&&bl.cross(za,V0,t),bl.normalize(za,za),J_(n,za,Math.PI),n):l>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(bl.cross(za,t,o),n[0]=za[0],n[1]=za[1],n[2]=za[2],n[3]=1+l,ey(n,n))});ln.rotationTo=yw;var Fo,dp,j0=(Fo=Hm(),dp=Hm(),function(n,t,o,l,h,f){return qm(Fo,t,h,f),qm(dp,o,l,f),qm(n,Fo,dp,2*f*(1-f)),n});ln.sqlerp=j0;var js,No=(js=Gm.create(),function(n,t,o,l){return js[0]=o[0],js[3]=o[1],js[6]=o[2],js[1]=l[0],js[4]=l[1],js[7]=l[2],js[2]=-t[0],js[5]=-t[1],js[8]=-t[2],ey(n,N0(n,js))});ln.setAxes=No;var Mn={};function Wm(n){return(Wm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.create=function(){var n=new zo.ARRAY_TYPE(8);return zo.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[4]=0,n[5]=0,n[6]=0,n[7]=0),n[3]=1,n},Mn.clone=function(n){var t=new zo.ARRAY_TYPE(8);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t},Mn.fromValues=function(n,t,o,l,h,f,g,v){var w=new zo.ARRAY_TYPE(8);return w[0]=n,w[1]=t,w[2]=o,w[3]=l,w[4]=h,w[5]=f,w[6]=g,w[7]=v,w},Mn.fromRotationTranslationValues=function(n,t,o,l,h,f,g){var v=new zo.ARRAY_TYPE(8);v[0]=n,v[1]=t,v[2]=o,v[3]=l;var w=.5*h,E=.5*f,D=.5*g;return v[4]=w*l+E*o-D*t,v[5]=E*l+D*n-w*o,v[6]=D*l+w*t-E*n,v[7]=-w*n-E*t-D*o,v},Mn.fromRotationTranslation=$0,Mn.fromTranslation=function(n,t){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n[4]=.5*t[0],n[5]=.5*t[1],n[6]=.5*t[2],n[7]=0,n},Mn.fromRotation=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=0,n[5]=0,n[6]=0,n[7]=0,n},Mn.fromMat4=function(n,t){var o=oc.create();ny.getRotation(o,t);var l=new zo.ARRAY_TYPE(3);return ny.getTranslation(l,t),$0(n,o,l),n},Mn.copy=iy,Mn.identity=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n[6]=0,n[7]=0,n},Mn.set=function(n,t,o,l,h,f,g,v,w){return n[0]=t,n[1]=o,n[2]=l,n[3]=h,n[4]=f,n[5]=g,n[6]=v,n[7]=w,n},Mn.getDual=function(n,t){return n[0]=t[4],n[1]=t[5],n[2]=t[6],n[3]=t[7],n},Mn.setDual=function(n,t){return n[4]=t[0],n[5]=t[1],n[6]=t[2],n[7]=t[3],n},Mn.getTranslation=function(n,t){var o=t[4],l=t[5],h=t[6],f=t[7],g=-t[0],v=-t[1],w=-t[2],E=t[3];return n[0]=2*(o*E+f*g+l*w-h*v),n[1]=2*(l*E+f*v+h*g-o*w),n[2]=2*(h*E+f*w+o*v-l*g),n},Mn.translate=function(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3],v=.5*o[0],w=.5*o[1],E=.5*o[2],D=t[4],I=t[5],P=t[6],L=t[7];return n[0]=l,n[1]=h,n[2]=f,n[3]=g,n[4]=g*v+h*E-f*w+D,n[5]=g*w+f*v-l*E+I,n[6]=g*E+l*w-h*v+P,n[7]=-l*v-h*w-f*E+L,n},Mn.rotateX=function(n,t,o){var l=-t[0],h=-t[1],f=-t[2],g=t[3],v=t[4],w=t[5],E=t[6],D=t[7],I=v*g+D*l+w*f-E*h,P=w*g+D*h+E*l-v*f,L=E*g+D*f+v*h-w*l,N=D*g-v*l-w*h-E*f;return oc.rotateX(n,t,o),n[4]=I*(g=n[3])+N*(l=n[0])+P*(f=n[2])-L*(h=n[1]),n[5]=P*g+N*h+L*l-I*f,n[6]=L*g+N*f+I*h-P*l,n[7]=N*g-I*l-P*h-L*f,n},Mn.rotateY=function(n,t,o){var l=-t[0],h=-t[1],f=-t[2],g=t[3],v=t[4],w=t[5],E=t[6],D=t[7],I=v*g+D*l+w*f-E*h,P=w*g+D*h+E*l-v*f,L=E*g+D*f+v*h-w*l,N=D*g-v*l-w*h-E*f;return oc.rotateY(n,t,o),n[4]=I*(g=n[3])+N*(l=n[0])+P*(f=n[2])-L*(h=n[1]),n[5]=P*g+N*h+L*l-I*f,n[6]=L*g+N*f+I*h-P*l,n[7]=N*g-I*l-P*h-L*f,n},Mn.rotateZ=function(n,t,o){var l=-t[0],h=-t[1],f=-t[2],g=t[3],v=t[4],w=t[5],E=t[6],D=t[7],I=v*g+D*l+w*f-E*h,P=w*g+D*h+E*l-v*f,L=E*g+D*f+v*h-w*l,N=D*g-v*l-w*h-E*f;return oc.rotateZ(n,t,o),n[4]=I*(g=n[3])+N*(l=n[0])+P*(f=n[2])-L*(h=n[1]),n[5]=P*g+N*h+L*l-I*f,n[6]=L*g+N*f+I*h-P*l,n[7]=N*g-I*l-P*h-L*f,n},Mn.rotateByQuatAppend=function(n,t,o){var l=o[0],h=o[1],f=o[2],g=o[3],v=t[0],w=t[1],E=t[2],D=t[3];return n[0]=v*g+D*l+w*f-E*h,n[1]=w*g+D*h+E*l-v*f,n[2]=E*g+D*f+v*h-w*l,n[3]=D*g-v*l-w*h-E*f,n[4]=(v=t[4])*g+(D=t[7])*l+(w=t[5])*f-(E=t[6])*h,n[5]=w*g+D*h+E*l-v*f,n[6]=E*g+D*f+v*h-w*l,n[7]=D*g-v*l-w*h-E*f,n},Mn.rotateByQuatPrepend=function(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3],v=o[0],w=o[1],E=o[2],D=o[3];return n[0]=l*D+g*v+h*E-f*w,n[1]=h*D+g*w+f*v-l*E,n[2]=f*D+g*E+l*w-h*v,n[3]=g*D-l*v-h*w-f*E,n[4]=l*(D=o[7])+g*(v=o[4])+h*(E=o[6])-f*(w=o[5]),n[5]=h*D+g*w+f*v-l*E,n[6]=f*D+g*E+l*w-h*v,n[7]=g*D-l*v-h*w-f*E,n},Mn.rotateAroundAxis=function(n,t,o,l){if(Math.abs(l)<zo.EPSILON)return iy(n,t);var h=Math.hypot(o[0],o[1],o[2]);l*=.5;var f=Math.sin(l),g=f*o[0]/h,v=f*o[1]/h,w=f*o[2]/h,E=Math.cos(l),D=t[0],I=t[1],P=t[2],L=t[3];n[0]=D*E+L*g+I*w-P*v,n[1]=I*E+L*v+P*g-D*w,n[2]=P*E+L*w+D*v-I*g,n[3]=L*E-D*g-I*v-P*w;var N=t[4],B=t[5],U=t[6],H=t[7];return n[4]=N*E+H*g+B*w-U*v,n[5]=B*E+H*v+U*g-N*w,n[6]=U*E+H*w+N*v-B*g,n[7]=H*E-N*g-B*v-U*w,n},Mn.add=function(n,t,o){return n[0]=t[0]+o[0],n[1]=t[1]+o[1],n[2]=t[2]+o[2],n[3]=t[3]+o[3],n[4]=t[4]+o[4],n[5]=t[5]+o[5],n[6]=t[6]+o[6],n[7]=t[7]+o[7],n},Mn.multiply=G0,Mn.scale=function(n,t,o){return n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n[3]=t[3]*o,n[4]=t[4]*o,n[5]=t[5]*o,n[6]=t[6]*o,n[7]=t[7]*o,n},Mn.lerp=function(n,t,o,l){var h=1-l;return H0(t,o)<0&&(l=-l),n[0]=t[0]*h+o[0]*l,n[1]=t[1]*h+o[1]*l,n[2]=t[2]*h+o[2]*l,n[3]=t[3]*h+o[3]*l,n[4]=t[4]*h+o[4]*l,n[5]=t[5]*h+o[5]*l,n[6]=t[6]*h+o[6]*l,n[7]=t[7]*h+o[7]*l,n},Mn.invert=function(n,t){var o=zd(t);return n[0]=-t[0]/o,n[1]=-t[1]/o,n[2]=-t[2]/o,n[3]=t[3]/o,n[4]=-t[4]/o,n[5]=-t[5]/o,n[6]=-t[6]/o,n[7]=t[7]/o,n},Mn.conjugate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n[4]=-t[4],n[5]=-t[5],n[6]=-t[6],n[7]=t[7],n},Mn.normalize=function(n,t){var o=zd(t);if(o>0){o=Math.sqrt(o);var l=t[0]/o,h=t[1]/o,f=t[2]/o,g=t[3]/o,v=t[4],w=t[5],E=t[6],D=t[7],I=l*v+h*w+f*E+g*D;n[0]=l,n[1]=h,n[2]=f,n[3]=g,n[4]=(v-l*I)/o,n[5]=(w-h*I)/o,n[6]=(E-f*I)/o,n[7]=(D-g*I)/o}return n},Mn.str=function(n){return"quat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+")"},Mn.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]},Mn.equals=function(n,t){var o=n[0],l=n[1],h=n[2],f=n[3],g=n[4],v=n[5],w=n[6],E=n[7],D=t[0],I=t[1],P=t[2],L=t[3],N=t[4],B=t[5],U=t[6],H=t[7];return Math.abs(o-D)<=zo.EPSILON*Math.max(1,Math.abs(o),Math.abs(D))&&Math.abs(l-I)<=zo.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(h-P)<=zo.EPSILON*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(f-L)<=zo.EPSILON*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(g-N)<=zo.EPSILON*Math.max(1,Math.abs(g),Math.abs(N))&&Math.abs(v-B)<=zo.EPSILON*Math.max(1,Math.abs(v),Math.abs(B))&&Math.abs(w-U)<=zo.EPSILON*Math.max(1,Math.abs(w),Math.abs(U))&&Math.abs(E-H)<=zo.EPSILON*Math.max(1,Math.abs(E),Math.abs(H))},Mn.sqrLen=Mn.squaredLength=Mn.len=Mn.length=Mn.dot=Mn.mul=Mn.setReal=Mn.getReal=void 0;var zo=Ym(hr),oc=Ym(ln),ny=Ym(an);function U0(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(U0=function(l){return l?o:t})(n)}function Ym(n,t){if(!t&&n&&n.__esModule)return n;if(null===n||"object"!==Wm(n)&&"function"!=typeof n)return{default:n};var o=U0(t);if(o&&o.has(n))return o.get(n);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in n)if("default"!==f&&Object.prototype.hasOwnProperty.call(n,f)){var g=h?Object.getOwnPropertyDescriptor(n,f):null;g&&(g.get||g.set)?Object.defineProperty(l,f,g):l[f]=n[f]}return l.default=n,o&&o.set(n,l),l}function $0(n,t,o){var l=.5*o[0],h=.5*o[1],f=.5*o[2],g=t[0],v=t[1],w=t[2],E=t[3];return n[0]=g,n[1]=v,n[2]=w,n[3]=E,n[4]=l*E+h*w-f*v,n[5]=h*E+f*g-l*w,n[6]=f*E+l*v-h*g,n[7]=-l*g-h*v-f*w,n}function iy(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n}function G0(n,t,o){var l=t[0],h=t[1],f=t[2],g=t[3],v=o[4],w=o[5],E=o[6],D=o[7],I=t[4],P=t[5],L=t[6],N=t[7],B=o[0],U=o[1],H=o[2],Q=o[3];return n[0]=l*Q+g*B+h*H-f*U,n[1]=h*Q+g*U+f*B-l*H,n[2]=f*Q+g*H+l*U-h*B,n[3]=g*Q-l*B-h*U-f*H,n[4]=l*D+g*v+h*E-f*w+I*Q+N*B+P*H-L*U,n[5]=h*D+g*w+f*v-l*E+P*Q+N*U+L*B-I*H,n[6]=f*D+g*E+l*w-h*v+L*Q+N*H+I*U-P*B,n[7]=g*D-l*v-h*w-f*E+N*Q-I*B-P*U-L*H,n}Mn.getReal=oc.copy,Mn.setReal=oc.copy,Mn.mul=G0;var H0=oc.dot;Mn.dot=H0;var Xm=oc.length;Mn.length=Xm,Mn.len=Xm;var zd=oc.squaredLength;Mn.squaredLength=zd,Mn.sqrLen=zd;var xn={};function oh(n){return(oh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(xn,"__esModule",{value:!0}),xn.create=ry,xn.clone=function(n){var t=new sh.ARRAY_TYPE(2);return t[0]=n[0],t[1]=n[1],t},xn.fromValues=function(n,t){var o=new sh.ARRAY_TYPE(2);return o[0]=n,o[1]=t,o},xn.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n},xn.set=function(n,t,o){return n[0]=t,n[1]=o,n},xn.add=function(n,t,o){return n[0]=t[0]+o[0],n[1]=t[1]+o[1],n},xn.subtract=oy,xn.multiply=sy,xn.divide=ah,xn.ceil=function(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n},xn.floor=function(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n},xn.min=function(n,t,o){return n[0]=Math.min(t[0],o[0]),n[1]=Math.min(t[1],o[1]),n},xn.max=function(n,t,o){return n[0]=Math.max(t[0],o[0]),n[1]=Math.max(t[1],o[1]),n},xn.round=function(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n},xn.scale=function(n,t,o){return n[0]=t[0]*o,n[1]=t[1]*o,n},xn.scaleAndAdd=function(n,t,o,l){return n[0]=t[0]+o[0]*l,n[1]=t[1]+o[1]*l,n},xn.distance=fp,xn.squaredDistance=ay,xn.length=Km,xn.squaredLength=pp,xn.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n},xn.inverse=function(n,t){return n[0]=1/t[0],n[1]=1/t[1],n},xn.normalize=function(n,t){var o=t[0],l=t[1],h=o*o+l*l;return h>0&&(h=1/Math.sqrt(h)),n[0]=t[0]*h,n[1]=t[1]*h,n},xn.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]},xn.cross=function(n,t,o){var l=t[0]*o[1]-t[1]*o[0];return n[0]=n[1]=0,n[2]=l,n},xn.lerp=function(n,t,o,l){var h=t[0],f=t[1];return n[0]=h+l*(o[0]-h),n[1]=f+l*(o[1]-f),n},xn.random=function(n,t){t=t||1;var o=2*sh.RANDOM()*Math.PI;return n[0]=Math.cos(o)*t,n[1]=Math.sin(o)*t,n},xn.transformMat2=function(n,t,o){var l=t[0],h=t[1];return n[0]=o[0]*l+o[2]*h,n[1]=o[1]*l+o[3]*h,n},xn.transformMat2d=function(n,t,o){var l=t[0],h=t[1];return n[0]=o[0]*l+o[2]*h+o[4],n[1]=o[1]*l+o[3]*h+o[5],n},xn.transformMat3=function(n,t,o){var l=t[0],h=t[1];return n[0]=o[0]*l+o[3]*h+o[6],n[1]=o[1]*l+o[4]*h+o[7],n},xn.transformMat4=function(n,t,o){var l=t[0],h=t[1];return n[0]=o[0]*l+o[4]*h+o[12],n[1]=o[1]*l+o[5]*h+o[13],n},xn.rotate=function(n,t,o,l){var h=t[0]-o[0],f=t[1]-o[1],g=Math.sin(l),v=Math.cos(l);return n[0]=h*v-f*g+o[0],n[1]=h*g+f*v+o[1],n},xn.angle=function(n,t){var o=n[0],l=n[1],h=t[0],f=t[1],g=Math.sqrt(o*o+l*l)*Math.sqrt(h*h+f*f);return Math.acos(Math.min(Math.max(g&&(o*h+l*f)/g,-1),1))},xn.zero=function(n){return n[0]=0,n[1]=0,n},xn.str=function(n){return"vec2("+n[0]+", "+n[1]+")"},xn.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]},xn.equals=function(n,t){var o=n[0],l=n[1],h=t[0],f=t[1];return Math.abs(o-h)<=sh.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(l-f)<=sh.EPSILON*Math.max(1,Math.abs(l),Math.abs(f))},xn.forEach=xn.sqrLen=xn.sqrDist=xn.dist=xn.div=xn.mul=xn.sub=xn.len=void 0;var sh=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==oh(n)&&"function"!=typeof n)return{default:n};var o=q0(void 0);if(o&&o.has(n))return o.get(n);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in n)if("default"!==f&&Object.prototype.hasOwnProperty.call(n,f)){var g=h?Object.getOwnPropertyDescriptor(n,f):null;g&&(g.get||g.set)?Object.defineProperty(l,f,g):l[f]=n[f]}return l.default=n,o&&o.set(n,l),l}(hr);function q0(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(q0=function(l){return l?o:t})(n)}function ry(){var n=new sh.ARRAY_TYPE(2);return sh.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0),n}function oy(n,t,o){return n[0]=t[0]-o[0],n[1]=t[1]-o[1],n}function sy(n,t,o){return n[0]=t[0]*o[0],n[1]=t[1]*o[1],n}function ah(n,t,o){return n[0]=t[0]/o[0],n[1]=t[1]/o[1],n}function fp(n,t){return Math.hypot(t[0]-n[0],t[1]-n[1])}function ay(n,t){var o=t[0]-n[0],l=t[1]-n[1];return o*o+l*l}function Km(n){return Math.hypot(n[0],n[1])}function pp(n){var t=n[0],o=n[1];return t*t+o*o}xn.len=Km,xn.sub=oy,xn.mul=sy,xn.div=ah,xn.dist=fp,xn.sqrDist=ay,xn.sqrLen=pp;var vw=function(){var n=ry();return function(t,o,l,h,f,g){var v,w;for(o||(o=2),l||(l=0),w=h?Math.min(h*o+l,t.length):t.length,v=l;v<w;v+=o)n[0]=t[v],n[1]=t[v+1],f(n,n,g),t[v]=n[0],t[v+1]=n[1];return t}}();function ly(n){return(ly="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}xn.forEach=vw,Object.defineProperty(Br,"__esModule",{value:!0}),d.a7=Br.vec4=d.N=Br.vec3=Br.vec2=Br.quat2=d.bi=Br.quat=d.a6=Br.mat4=d.co=Br.mat3=Br.mat2d=d.b4=Br.mat2=Br.glMatrix=void 0;var xw=Ba(hr);Br.glMatrix=xw;var bw=Ba(Ri);d.b4=Br.mat2=bw;var ww=Ba(ri);Br.mat2d=ww;var Ew=Ba(xi);d.co=Br.mat3=Ew;var Z0=Ba(an);d.a6=Br.mat4=Z0;var Jm=Ba(ln);d.bi=Br.quat=Jm;var cy=Ba(Mn);Br.quat2=cy;var uy=Ba(xn);Br.vec2=uy;var Cw=Ba(nn);d.N=Br.vec3=Cw;var Dw=Ba(Tn);function Qm(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(Qm=function(l){return l?o:t})(n)}function Ba(n,t){if(!t&&n&&n.__esModule)return n;if(null===n||"object"!==ly(n)&&"function"!=typeof n)return{default:n};var o=Qm(t);if(o&&o.has(n))return o.get(n);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in n)if("default"!==f&&Object.prototype.hasOwnProperty.call(n,f)){var g=h?Object.getOwnPropertyDescriptor(n,f):null;g&&(g.get||g.set)?Object.defineProperty(l,f,g):l[f]=n[f]}return l.default=n,o&&o.set(n,l),l}d.a7=Br.vec4=Dw;class sc{constructor(t,o){this.pos=t,this.dir=o}intersectsPlane(t,o,l){const h=d.N.dot(o,this.dir);if(Math.abs(h)<1e-6)return!1;const f=((t[0]-this.pos[0])*o[0]+(t[1]-this.pos[1])*o[1]+(t[2]-this.pos[2])*o[2])/h;return l[0]=this.pos[0]+this.dir[0]*f,l[1]=this.pos[1]+this.dir[1]*f,l[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(t,o,l){if(d.N.equals(this.pos,t)||0===o)return l[0]=l[1]=l[2]=0,!1;const[h,f,g]=this.dir,v=this.pos[0]-t[0],w=this.pos[1]-t[1],E=this.pos[2]-t[2],D=h*h+f*f+g*g,I=2*(v*h+w*f+E*g),P=I*I-4*D*(v*v+w*w+E*E-o*o);if(P<0){const L=Math.max(-I/2,0),N=v+h*L,B=w+f*L,U=E+g*L,H=Math.hypot(N,B,U);return l[0]=N*o/H,l[1]=B*o/H,l[2]=U*o/H,!1}{const L=(-I-Math.sqrt(P))/(2*D);if(L<0){const N=Math.hypot(v,w,E);return l[0]=v*o/N,l[1]=w*o/N,l[2]=E*o/N,!1}return l[0]=v+h*L,l[1]=w+f*L,l[2]=E+g*L,!0}}}class eg{constructor(t,o,l,h,f){this.TL=t,this.TR=o,this.BR=l,this.BL=h,this.horizon=f}static fromInvProjectionMatrix(t,o,l){const h=[-1,1,1],f=[1,1,1],g=[1,-1,1],v=[-1,-1,1],w=d.N.transformMat4(h,h,t),E=d.N.transformMat4(f,f,t),D=d.N.transformMat4(g,g,t),I=d.N.transformMat4(v,v,t);return new eg(w,E,D,I,o/l)}}function Bd(n,t,o){let l=1/0,h=-1/0;const f=[];for(const g of n){d.N.sub(f,g,t);const v=d.N.dot(f,o);l=Math.min(l,v),h=Math.max(h,v)}return[l,h]}function W0(n,t){let o=!0;for(let l=0;l<n.planes.length;l++){const h=n.planes[l];let f=0;for(let g=0;g<t.length;g++)f+=d.N.dot(h,t[g])+h[3]>=0;if(0===f)return 0;f!==t.length&&(o=!1)}return o?2:1}function Tw(n,t){for(const o of n.projections){const l=Bd(t,n.points[0],o.axis);if(o.projection[1]<l[0]||o.projection[0]>l[1])return 0}return 1}function mp(n,t){let o=0;const l=[0,0,0,0];for(let h=0;h<n.length;h++)l[0]=n[h][0],l[1]=n[h][1],l[2]=n[h][2],l[3]=1,d.a7.dot(l,t)>=0&&o++;return o}class hy{constructor(t,o){this.points=t||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=Hi.fromPoints(this.points),this.projections=[],this.frustumEdges=[d.N.sub([],this.points[2],this.points[3]),d.N.sub([],this.points[0],this.points[3]),d.N.sub([],this.points[4],this.points[0]),d.N.sub([],this.points[5],this.points[1]),d.N.sub([],this.points[6],this.points[2]),d.N.sub([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const h=[0,-l[2],l[1]],f=[l[2],0,-l[0]];this.projections.push({axis:h,projection:Bd(this.points,this.points[0],h)}),this.projections.push({axis:f,projection:Bd(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(t,o,l,h){const f=Math.pow(2,l),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const D=d.a7.transformMat4([],E,t),I=1/D[3]/o*f;return d.a7.mul(D,D,[I,I,h?1/D[3]:I,I])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const D=d.N.sub([],g[E[0]],g[E[1]]),I=d.N.sub([],g[E[2]],g[E[1]]),P=d.N.normalize([],d.N.cross([],D,I)),L=-d.N.dot(P,g[E[1]]);return P.concat(L)}),w=[];for(let E=0;E<g.length;E++)w.push([g[E][0],g[E][1],g[E][2]]);return new hy(w,v)}intersectsPrecise(t,o,l){for(let h=0;h<o.length;h++)if(!mp(t,o[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!mp(t,this.planes[h]))return 0;for(const h of l)for(const f of this.frustumEdges){const g=d.N.cross([],h,f),v=d.N.length(g);if(0===v)continue;d.N.scale(g,g,1/v);const w=Bd(this.points,this.points[0],g),E=Bd(t,this.points[0],g);if(w[0]>E[1]||E[0]>w[1])return 0}return 1}}class Hi{static fromPoints(t){const o=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const h of t)d.N.min(o,o,h),d.N.max(l,l,h);return new Hi(o,l)}static fromTileIdAndHeight(t,o,l){const h=1<<t.canonical.z,f=t.canonical.x,g=t.canonical.y;return new Hi([f/h,g/h,o],[(f+1)/h,(g+1)/h,l])}static applyTransform(t,o){const l=t.getCorners();for(let h=0;h<l.length;++h)d.N.transformMat4(l[h],l[h],o);return Hi.fromPoints(l)}static projectAabbCorners(t,o){const l=t.getCorners();for(let h=0;h<l.length;++h)d.N.transformMat4(l[h],l[h],o);return l}constructor(t,o){this.min=t,this.max=o,this.center=d.N.scale([],d.N.add([],this.min,this.max),.5)}quadrant(t){const o=[t%2==0,t<2],l=d.N.clone(this.min),h=d.N.clone(this.max);for(let f=0;f<o.length;f++)l[f]=o[f]?this.min[f]:this.center[f],h[f]=o[f]?this.center[f]:this.max[f];return h[2]=this.max[2],new Hi(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,o=this.max;return[[t[0],t[1],t[2]],[o[0],t[1],t[2]],[o[0],o[1],t[2]],[t[0],o[1],t[2]],[t[0],t[1],o[2]],[o[0],t[1],o[2]],[o[0],o[1],o[2]],[t[0],o[1],o[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?W0(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?W0(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,o){return o||this.intersects(t)?Tw(t,this.getCorners()):0}intersectsPreciseFlat(t,o){return o||this.intersectsFlat(t)?Tw(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let o=0;o<3;++o)if(this.min[o]>t.max[o]||t.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],t.min[o]),this.max[o]=Math.max(this.max[o],t.max[o])}encapsulatePoint(t){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],t[o]),this.max[o]=Math.max(this.max[o],t[o])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}Ct(Hi,"Aabb");const Y0=ei([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:gp}=Y0,dy=ei([{name:"a_pos_3",components:3,type:"Int16"}]);var fy=ei([{name:"a_pos",type:"Int16",components:2}]);function lh(n){return n*ee/Ae}const _p=[new Hi([ge,ge,ge],[De,De,De]),new Hi([ge,ge,ge],[0,0,De]),new Hi([0,ge,ge],[De,0,De]),new Hi([ge,0,ge],[0,De,De]),new Hi([0,0,ge],[De,De,De])];function py(n,t,o,l=!0){const h=d.N.scale([],n._camera.position,n.worldSize),f=[t,o,1,1];d.a7.transformMat4(f,f,n.pixelMatrixInverse),d.a7.scale(f,f,1/f[3]);const g=d.N.sub([],f,h),v=d.N.normalize([],g),w=n.globeMatrix,E=[w[12],w[13],w[14]],D=d.N.sub([],E,h),I=d.N.length(D),P=d.N.normalize([],D),L=n.worldSize/(2*Math.PI),N=d.N.dot(P,v),B=Math.asin(L/I);if(B<Math.acos(N)){if(!l)return null;const we=[],Oe=[];d.N.scale(we,v,I/N),d.N.normalize(Oe,d.N.sub(Oe,we,D)),d.N.normalize(v,d.N.add(v,D,d.N.scale(v,Oe,Math.tan(B)*I)))}const U=[];new sc(h,v).closestPointOnSphere(E,L,U);const H=d.N.normalize([],le(w,0)),Q=d.N.normalize([],le(w,1)),ne=d.N.normalize([],le(w,2)),ie=d.N.dot(H,U),ue=d.N.dot(Q,U),ae=d.N.dot(ne,U),de=Er(Math.asin(-ue/L));let ye=Er(Math.atan2(ie,ae));ye=n.center.lng+function(we,Oe){const Ge=(Oe-we+180)%360-180;return Ge<-180?Ge+360:Ge}(n.center.lng,ye);const be=hn(ye),Te=on(Yt(de),0,1);return new zn(be,Te)}class my{constructor(t,o,l){this.a=d.N.sub([],t,l),this.b=d.N.sub([],o,l),this.center=l;const h=d.N.normalize([],this.a),f=d.N.normalize([],this.b);this.angle=Math.acos(d.N.dot(h,f))}}function Vd(n,t){if(0===n.angle)return null;let o;return o=0===n.a[t]?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[t]/n.a[t]/Math.sin(n.angle)-1/Math.tan(n.angle)),o<0||o>1?null:function(l,h,f,g){const v=Math.sin(f);return l*(Math.sin((1-g)*f)/v)+h*(Math.sin(g*f)/v)}(n.a[t],n.b[t],n.angle,on(o,0,1))+n.center[t]}function Va(n){if(n.z<=1)return _p[n.z+2*n.y+n.x];const t=gy(yp(n));return Hi.fromPoints(t)}function ja(n,t,o){return d.N.scale(n,n,1-o),d.N.scaleAndAdd(n,n,t,o)}function jd(n,t,o){for(const l of n)d.N.transformMat4(l,l,t),d.N.scale(l,l,o)}function X0(n,t,o,l){const h=t/n.worldSize,f=n.globeMatrix;if(o.z<=1){const be=Va(o).getCorners();return jd(be,f,h),Hi.fromPoints(be)}const g=yp(o,l),v=gy(g,ee+lh(n._tileCoverLift));jd(v,f,h);const w=Number.MAX_VALUE,E=[-w,-w,-w],D=[w,w,w];if(g.contains(n.center)){for(const we of v)d.N.min(D,D,we),d.N.max(E,E,we);E[2]=0;const be=n.point,Te=[be.x*h,be.y*h,0];return d.N.min(D,D,Te),d.N.max(E,E,Te),new Hi(D,E)}if(n._tileCoverLift>0){for(const be of v)d.N.min(D,D,be),d.N.max(E,E,be);return new Hi(D,E)}const I=[f[12]*h,f[13]*h,f[14]*h],P=g.getCenter(),L=on(n.center.lat,-En,En),N=on(P.lat,-En,En),B=hn(n.center.lng),U=Yt(L);let H=B-hn(P.lng);const Q=U-Yt(N);H>.5?H-=1:H<-.5&&(H+=1);let ne=0;if(Math.abs(H)>Math.abs(Q))ne=H>=0?1:3;else{ne=Q>=0?0:2;const be=[f[4]*h,f[5]*h,f[6]*h],Te=-Math.sin(Cn(Q>=0?g.getSouth():g.getNorth()))*ee;d.N.scaleAndAdd(I,I,be,Te)}const ie=v[ne],ue=v[(ne+1)%4],ae=new my(ie,ue,I),de=[Vd(ae,0)||ie[0],Vd(ae,1)||ie[1],Vd(ae,2)||ie[2]],ye=Xc(n.zoom);if(ye>0){const be=function({x:we,y:Oe,z:Ge},Re,Ve,Ie,je){const lt=1/(1<<Ge);let Be=we*lt,yt=Be+lt,dt=Oe*lt,Ze=dt+lt,qt=0;const Ft=(Be+yt)/2-Ie;return Ft>.5?qt=-1:Ft<-.5&&(qt=1),Be=((Be+qt)*Re-(Ie*=Re))*Ve+Ie,yt=((yt+qt)*Re-Ie)*Ve+Ie,dt=(dt*Re-(je*=Re))*Ve+je,Ze=(Ze*Re-je)*Ve+je,[[Be,Ze,0],[yt,Ze,0],[yt,dt,0],[Be,dt,0]]}(o,t,n._pixelsPerMercatorPixel,B,U);for(let we=0;we<v.length;we++)ja(v[we],be[we],ye);const Te=d.N.add([],be[ne],be[(ne+1)%4]);d.N.scale(Te,Te,.5),ja(de,Te,ye)}for(const be of v)d.N.min(D,D,be),d.N.max(E,E,be);return D[2]=Math.min(ie[2],ue[2]),d.N.min(D,D,de),d.N.max(E,E,de),new Hi(D,E)}function yp({x:n,y:t,z:o},l=!1){const h=1/(1<<o),f=new xe(tn(n*h),t===(1<<o)-1&&l?-90:Dn((t+1)*h)),g=new xe(tn((n+1)*h),0===t&&l?90:Dn(t*h));return new Se(f,g)}function gy(n,t=ee){const o=Cn(n.getNorth()),l=Cn(n.getSouth()),h=Math.cos(o),f=Math.cos(l),g=Math.sin(o),v=Math.sin(l),w=n.getWest(),E=n.getEast();return[ve(f,v,w,t),ve(f,v,E,t),ve(h,g,E,t),ve(h,g,w,t)]}function vp(n,t,o,l){const h=1<<o.z,f=(n/gt+o.x)/h;return Pe(Dn((t/gt+o.y)/h),tn(f),l)}function tg({min:n,max:t}){return se/Math.max(t[0]-n[0],t[1]-n[1],t[2]-n[2])}const _y=new Float64Array(16);function xp(n){const t=tg(n),o=d.a6.fromScaling(_y,[t,t,t]);return d.a6.translate(o,o,d.N.negate([],n.min))}function Ud(n){const t=d.a6.fromTranslation(_y,n.min),o=1/tg(n);return d.a6.scale(t,t,[o,o,o])}function bp(n){const t=gt/(2*Math.PI);return n/(2*Math.PI)/t}function ch(n,t){return gt/(512*Math.pow(2,n))*tg(Va(t))}function K0(n,t,o,l,h){const f=bp(o),g=[n,t,-o/(2*Math.PI)],v=d.a6.identity(new Float64Array(16));return d.a6.translate(v,v,g),d.a6.scale(v,v,[f,f,f]),d.a6.rotateX(v,v,Cn(-h)),d.a6.rotateY(v,v,Cn(-l)),v}function Xc(n){return xc(oe,X,n)}function Mw(n,t){const o=Pe(t.lat,t.lng),l=function(f){const g=Pe(f._center.lat,f._center.lng),v=d.N.fromValues(0,1,0);let w=d.N.cross([],v,g);const E=d.a6.fromRotation([],-f.angle,g);w=d.N.transformMat4(w,w,E),d.a6.fromRotation(E,-f._pitch,w);const D=d.N.normalize([],g);return d.N.scale(D,D,lh(f.cameraToCenterDistance/f.pixelsPerMeter)),d.N.transformMat4(D,D,E),d.N.add([],g,D)}(n),h=d.N.subtract([],l,o);return d.N.angle(h,o)}function yy(n,t){return Mw(n,t)>Math.PI/2*1.01}const ng=Cn(85),Iw=Math.cos(ng),$d=Math.sin(ng),ig=d.a6.create(),rg=n=>{const t=[];return"map"===n.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===n.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function vy(n,t,o,l,h,f,g,v,w){if(f&&n.queryGeometry.isAboveHorizon)return!1;f&&(w*=n.pixelToTileUnitsFactor);const E=n.tileID.canonical,D=o.projection.upVectorScale(E,o.center.lat,o.worldSize).metersToTile;for(const I of t)for(const P of I){const L=P.add(v),N=h&&o.elevation?o.elevation.exaggeration()*h.getElevationAt(L.x,L.y,!0):0,B=o.projection.projectTilePoint(L.x,L.y,E);if(N>0){const ne=o.projection.upVector(E,L.x,L.y);B.x+=ne[0]*D*N,B.y+=ne[1]*D*N,B.z+=ne[2]*D*N}const U=f?L:J0(B.x,B.y,B.z,l),H=f?n.tilespaceRays.map(ne=>Sw(ne,N)):n.queryGeometry.screenGeometry,Q=d.a7.transformMat4([],[B.x,B.y,B.z,1],l);if(!g&&f?w*=Q[3]/o.cameraToCenterDistance:g&&!f&&(w*=o.cameraToCenterDistance/Q[3]),f){const ne=Dn((P.y/gt+E.y)/(1<<E.z));w/=o.projection.pixelsPerMeter(ne,1)/en(1,ne)}if(Ns(H,U,w))return!0}return!1}function J0(n,t,o,l){const h=d.a7.transformMat4([],[n,t,o,1],l);return new ht(h[0]/h[3],h[1]/h[3])}const xy=d.N.fromValues(0,0,0),Q0=d.N.fromValues(0,0,1);function Sw(n,t){const o=d.N.create();return xy[2]=t,n.intersectsPlane(xy,Q0,o),new ht(o[0],o[1])}class ex extends Lo{}function tx(n,{width:t,height:o},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*o*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(t*o*l);return n.width=t,n.height=o,n.data=h,n}function nx(n,t,o){const{width:l,height:h}=t;l===n.width&&h===n.height||(by(n,t,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,l),height:Math.min(n.height,h)},o),n.width=l,n.height=h,n.data=t.data)}function by(n,t,o,l,h,f,g){if(0===h.width||0===h.height)return t;if(h.width>n.width||h.height>n.height||o.x>n.width-h.width||o.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||l.x>t.width-h.width||l.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const v=n.data,w=t.data,E=4===f&&g;for(let D=0;D<h.height;D++){const I=((o.y+D)*n.width+o.x)*f,P=((l.y+D)*t.width+l.x)*f;if(E)for(let L=0;L<h.width;L++){const N=I+L*f+3,B=P+L*f;w[B+0]=255,w[B+1]=255,w[B+2]=255,w[B+3]=v[N]}else for(let L=0;L<h.width*f;L++)w[P+L]=v[I+L]}return t}Ct(ex,"HeatmapBucket",{omit:["layers"]});class Jo{constructor(t,o){tx(this,t,1,o)}resize(t){nx(this,new Jo(t),1)}clone(){return new Jo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,l,h,f){by(t,o,l,h,f,1)}}class wo{constructor(t,o){tx(this,t,4,o)}resize(t){nx(this,new wo(t),4)}replace(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new wo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,l,h,f,g){by(t,o,l,h,f,4,g)}}class ix{constructor(t,o){this.width=t.width,this.height=t.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}Ct(Jo,"AlphaImage"),Ct(wo,"RGBAImage");const iT=new Xi({visibility:new nt(Ce.layout_heatmap.visibility)});var rT={paint:new Xi({"heatmap-radius":new Vt(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Vt(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nt(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Oa(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nt(Ce.paint_heatmap["heatmap-opacity"])}),layout:iT};function og(n){const t={},o=n.resolution||256,l=n.clips?n.clips.length:1,h=n.image||new wo({width:o,height:l}),f=(g,v,w)=>{t[n.evaluationKey]=w;const E=n.expression.evaluate(t);E&&(h.data[g+v+0]=Math.floor(255*E.r/E.a),h.data[g+v+1]=Math.floor(255*E.g/E.a),h.data[g+v+2]=Math.floor(255*E.b/E.a),h.data[g+v+3]=Math.floor(255*E.a))};if(n.clips)for(let g=0,v=0;g<l;++g,v+=4*o)for(let w=0,E=0;w<o;w++,E+=4){const D=w/(o-1),{start:I,end:P}=n.clips[g];f(v,E,I*(1-D)+P*D)}else for(let g=0,v=0;g<o;g++,v+=4)f(0,v,g/(o-1));return h}const oT=new Xi({visibility:new nt(Ce.layout_hillshade.visibility)});var sT={paint:new Xi({"hillshade-illumination-direction":new nt(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nt(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nt(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nt(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nt(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nt(Ce.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new nt(Ce.paint_hillshade["hillshade-emissive-strength"])}),layout:oT};const rx=ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:Aw}=rx;var wy={exports:{}};function sg(n,t,o){o=o||2;var l,h,f,g,v,w,E,D=t&&t.length,I=D?t[0]*o:n.length,P=ox(n,0,I,o,!0),L=[];if(!P||P.next===P.prev)return L;if(D&&(P=function(B,U,H,Q){var ne,ie,ue,ae=[];for(ne=0,ie=U.length;ne<ie;ne++)(ue=ox(B,U[ne]*Q,ne<ie-1?U[ne+1]*Q:B.length,Q,!1))===ue.next&&(ue.steiner=!0),ae.push(Ey(ue));for(ae.sort(aT),ne=0;ne<ae.length;ne++)H=lT(ae[ne],H);return H}(n,t,P,o)),n.length>80*o){l=f=n[0],h=g=n[1];for(var N=o;N<I;N+=o)(v=n[N])<l&&(l=v),(w=n[N+1])<h&&(h=w),v>f&&(f=v),w>g&&(g=w);E=0!==(E=Math.max(f-l,g-h))?32767/E:0}return Us(P,L,o,l,h,E,0),L}function ox(n,t,o,l,h){var f,g;if(h===Kc(n,t,o,l)>0)for(f=t;f<o;f+=l)g=ux(f,n[f],n[f+1],g);else for(f=o-l;f>=t;f-=l)g=ux(f,n[f],n[f+1],g);return g&&ag(g,g.next)&&(uh(g),g=g.next),g}function ac(n,t){if(!n)return n;t||(t=n);var o,l=n;do{if(o=!1,l.steiner||!ag(l,l.next)&&0!==gr(l.prev,l,l.next))l=l.next;else{if(uh(l),(l=t=l.prev)===l.next)break;o=!0}}while(o||l!==t);return t}function Us(n,t,o,l,h,f,g){if(n){!g&&f&&function(D,I,P,L){var N=D;do{0===N.z&&(N.z=Ep(N.x,N.y,I,P,L)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next}while(N!==D);N.prevZ.nextZ=null,N.prevZ=null,function(B){var U,H,Q,ne,ie,ue,ae,de,ye=1;do{for(H=B,B=null,ie=null,ue=0;H;){for(ue++,Q=H,ae=0,U=0;U<ye&&(ae++,Q=Q.nextZ);U++);for(de=ye;ae>0||de>0&&Q;)0!==ae&&(0===de||!Q||H.z<=Q.z)?(ne=H,H=H.nextZ,ae--):(ne=Q,Q=Q.nextZ,de--),ie?ie.nextZ=ne:B=ne,ne.prevZ=ie,ie=ne;H=Q}ie.nextZ=null,ye*=2}while(ue>1)}(N)}(n,l,h,f);for(var v,w,E=n;n.prev!==n.next;)if(v=n.prev,w=n.next,f?sx(n,l,h,f):wp(n))t.push(v.i/o|0),t.push(n.i/o|0),t.push(w.i/o|0),uh(n),n=w.next,E=w.next;else if((n=w)===E){g?1===g?Us(n=ax(ac(n),t,o),t,o,l,h,f,2):2===g&&lx(n,t,o,l,h,f):Us(ac(n),t,o,l,h,f,1);break}}}function wp(n){var t=n.prev,o=n,l=n.next;if(gr(t,o,l)>=0)return!1;for(var h=t.x,f=o.x,g=l.x,v=t.y,w=o.y,E=l.y,D=h<f?h<g?h:g:f<g?f:g,I=v<w?v<E?v:E:w<E?w:E,P=h>f?h>g?h:g:f>g?f:g,L=v>w?v>E?v:E:w>E?w:E,N=l.next;N!==t;){if(N.x>=D&&N.x<=P&&N.y>=I&&N.y<=L&&Cp(h,v,f,w,g,E,N.x,N.y)&&gr(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function sx(n,t,o,l){var h=n.prev,f=n,g=n.next;if(gr(h,f,g)>=0)return!1;for(var v=h.x,w=f.x,E=g.x,D=h.y,I=f.y,P=g.y,L=v<w?v<E?v:E:w<E?w:E,N=D<I?D<P?D:P:I<P?I:P,B=v>w?v>E?v:E:w>E?w:E,U=D>I?D>P?D:P:I>P?I:P,H=Ep(L,N,t,o,l),Q=Ep(B,U,t,o,l),ne=n.prevZ,ie=n.nextZ;ne&&ne.z>=H&&ie&&ie.z<=Q;){if(ne.x>=L&&ne.x<=B&&ne.y>=N&&ne.y<=U&&ne!==h&&ne!==g&&Cp(v,D,w,I,E,P,ne.x,ne.y)&&gr(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,ie.x>=L&&ie.x<=B&&ie.y>=N&&ie.y<=U&&ie!==h&&ie!==g&&Cp(v,D,w,I,E,P,ie.x,ie.y)&&gr(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;ne&&ne.z>=H;){if(ne.x>=L&&ne.x<=B&&ne.y>=N&&ne.y<=U&&ne!==h&&ne!==g&&Cp(v,D,w,I,E,P,ne.x,ne.y)&&gr(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;ie&&ie.z<=Q;){if(ie.x>=L&&ie.x<=B&&ie.y>=N&&ie.y<=U&&ie!==h&&ie!==g&&Cp(v,D,w,I,E,P,ie.x,ie.y)&&gr(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function ax(n,t,o){var l=n;do{var h=l.prev,f=l.next.next;!ag(h,f)&&cx(h,l,l.next,f)&&Gd(h,f)&&Gd(f,h)&&(t.push(h.i/o|0),t.push(l.i/o|0),t.push(f.i/o|0),uh(l),uh(l.next),l=n=f),l=l.next}while(l!==n);return ac(l)}function lx(n,t,o,l,h,f){var g=n;do{for(var v=g.next.next;v!==g.prev;){if(g.i!==v.i&&uT(g,v)){var w=Dp(g,v);return g=ac(g,g.next),w=ac(w,w.next),Us(g,t,o,l,h,f,0),void Us(w,t,o,l,h,f,0)}v=v.next}g=g.next}while(g!==n)}function aT(n,t){return n.x-t.x}function lT(n,t){var o=function(h,f){var g,v=f,w=h.x,E=h.y,D=-1/0;do{if(E<=v.y&&E>=v.next.y&&v.next.y!==v.y){var I=v.x+(E-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(I<=w&&I>D&&(D=I,g=v.x<v.next.x?v:v.next,I===w))return g}v=v.next}while(v!==f);if(!g)return null;var P,L=g,N=g.x,B=g.y,U=1/0;v=g;do{w>=v.x&&v.x>=N&&w!==v.x&&Cp(E<B?w:D,E,N,B,E<B?D:w,E,v.x,v.y)&&(P=Math.abs(E-v.y)/(w-v.x),Gd(v,h)&&(P<U||P===U&&(v.x>g.x||v.x===g.x&&cT(g,v)))&&(g=v,U=P)),v=v.next}while(v!==L);return g}(n,t);if(!o)return t;var l=Dp(o,n);return ac(l,l.next),ac(o,o.next)}function cT(n,t){return gr(n.prev,n,t.prev)<0&&gr(t.next,n,n.next)<0}function Ep(n,t,o,l,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-o)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ey(n){var t=n,o=n;do{(t.x<o.x||t.x===o.x&&t.y<o.y)&&(o=t),t=t.next}while(t!==n);return o}function Cp(n,t,o,l,h,f,g,v){return(h-g)*(t-v)>=(n-g)*(f-v)&&(n-g)*(l-v)>=(o-g)*(t-v)&&(o-g)*(f-v)>=(h-g)*(l-v)}function uT(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(o,l){var h=o;do{if(h.i!==o.i&&h.next.i!==o.i&&h.i!==l.i&&h.next.i!==l.i&&cx(h,h.next,o,l))return!0;h=h.next}while(h!==o);return!1}(n,t)&&(Gd(n,t)&&Gd(t,n)&&function(o,l){var h=o,f=!1,g=(o.x+l.x)/2,v=(o.y+l.y)/2;do{h.y>v!=h.next.y>v&&h.next.y!==h.y&&g<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next}while(h!==o);return f}(n,t)&&(gr(n.prev,n,t.prev)||gr(n,t.prev,t))||ag(n,t)&&gr(n.prev,n,n.next)>0&&gr(t.prev,t,t.next)>0)}function gr(n,t,o){return(t.y-n.y)*(o.x-t.x)-(t.x-n.x)*(o.y-t.y)}function ag(n,t){return n.x===t.x&&n.y===t.y}function cx(n,t,o,l){var h=cg(gr(n,t,o)),f=cg(gr(n,t,l)),g=cg(gr(o,l,n)),v=cg(gr(o,l,t));return h!==f&&g!==v||!(0!==h||!lg(n,o,t))||!(0!==f||!lg(n,l,t))||!(0!==g||!lg(o,n,l))||!(0!==v||!lg(o,t,l))}function lg(n,t,o){return t.x<=Math.max(n.x,o.x)&&t.x>=Math.min(n.x,o.x)&&t.y<=Math.max(n.y,o.y)&&t.y>=Math.min(n.y,o.y)}function cg(n){return n>0?1:n<0?-1:0}function Gd(n,t){return gr(n.prev,n,n.next)<0?gr(n,t,n.next)>=0&&gr(n,n.prev,t)>=0:gr(n,t,n.prev)<0||gr(n,n.next,t)<0}function Dp(n,t){var o=new Cy(n.i,n.x,n.y),l=new Cy(t.i,t.x,t.y),h=n.next,f=t.prev;return n.next=t,t.prev=n,o.next=h,h.prev=o,l.next=o,o.prev=l,f.next=l,l.prev=f,l}function ux(n,t,o,l){var h=new Cy(n,t,o);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function uh(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Cy(n,t,o){this.i=n,this.x=t,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Kc(n,t,o,l){for(var h=0,f=t,g=o-l;f<o;f+=l)h+=(n[g]-n[f])*(n[f+1]+n[g+1]),g=f;return h}wy.exports=sg,wy.exports.default=sg,sg.deviation=function(n,t,o,l){var h=t&&t.length,f=Math.abs(Kc(n,0,h?t[0]*o:n.length,o));if(h)for(var g=0,v=t.length;g<v;g++)f-=Math.abs(Kc(n,t[g]*o,g<v-1?t[g+1]*o:n.length,o));var w=0;for(g=0;g<l.length;g+=3){var E=l[g]*o,D=l[g+1]*o,I=l[g+2]*o;w+=Math.abs((n[E]-n[I])*(n[D+1]-n[E+1])-(n[E]-n[D])*(n[I+1]-n[E+1]))}return 0===f&&0===w?0:Math.abs((w-f)/f)},sg.flatten=function(n){for(var t=n[0][0].length,o={vertices:[],holes:[],dimensions:t},l=0,h=0;h<n.length;h++){for(var f=0;f<n[h].length;f++)for(var g=0;g<t;g++)o.vertices.push(n[h][f][g]);h>0&&o.holes.push(l+=n[h-1].length)}return o};var ug=$o(wy.exports);function Dy(n,t){const o=n.length;if(o<=1)return[n];const l=[];let h,f;for(let g=0;g<o;g++){const v=Pl(n[g]);0!==v&&(n[g].area=Math.abs(v),void 0===f&&(f=v<0),f===v<0?(h&&l.push(h),h=[n[g]]):h.push(n[g]))}if(h&&l.push(h),t>1)for(let g=0;g<l.length;g++)l[g].length<=t||(Xh(l[g],t,1,l[g].length-1,hx),l[g]=l[g].slice(0,t));return l}function hx(n,t){return t.area-n.area}function hg(n,t,o){const l=o.patternDependencies;let h=!1;for(const f of t){const g=f.paint.get(`${n}-pattern`);g.isConstant()||(h=!0);const v=g.constantOr(null);v&&(h=!0,l[v]=!0)}return h}function Ty(n,t,o,l,h){const f=h.patternDependencies;for(const g of t){const v=g.paint.get(`${n}-pattern`).value;if("constant"!==v.kind){let w=v.evaluate({zoom:l},o,{},h.availableImages);w=w&&w.name?w.name:w,f[w]=!0,o.patterns[g.id]=w}}return o}class My{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new mi,this.indexArray=new Ir,this.indexArray2=new ks,this.programConfigurations=new q(t.layers,t.zoom),this.segments=new Ki,this.segments2=new Ki,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=t.projection}populate(t,o,l,h){this.hasPattern=hg("fill",this.layers,o);const f=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:v,id:w,index:E,sourceLayerIndex:D}of t){const I=this.layers[0]._featureFilter.needGeometry,P=mr(v,I);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),P,l))continue;const L=f?f.evaluate(P,{},l,o.availableImages):void 0,N={id:w,properties:v.properties,type:v.type,sourceLayerIndex:D,index:E,geometry:I?P.geometry:Ei(v,l,h),patterns:{},sortKey:L};g.push(N)}f&&g.sort((v,w)=>v.sortKey-w.sortKey);for(const v of g){const{geometry:w,index:E,sourceLayerIndex:D}=v;if(this.hasPattern){const I=Ty("fill",this.layers,v,this.zoom,o);this.patternFeatures.push(I)}else this.addFeature(v,w,E,l,{},o.availableImages,o.brightness);o.featureIndex.insert(t[E].feature,w,E,D,this.index)}}update(t,o,l,h,f){const g=0!==Object.keys(t).length;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,o,g?this.stateDependentLayers:this.layers,l,h,f)}addFeatures(t,o,l,h,f,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,o,l,h,g)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Aw),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,o,l,h,f,g=[],v){for(const w of Dy(o,500)){let E=0;for(const B of w)E+=B.length;const D=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),I=D.vertexLength,P=[],L=[];for(const B of w){if(0===B.length)continue;B!==w[0]&&L.push(P.length/2);const U=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),H=U.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(H+B.length-1,H),P.push(B[0].x),P.push(B[0].y);for(let Q=1;Q<B.length;Q++)this.layoutVertexArray.emplaceBack(B[Q].x,B[Q].y),this.indexArray2.emplaceBack(H+Q-1,H+Q),P.push(B[Q].x),P.push(B[Q].y);U.vertexLength+=B.length,U.primitiveLength+=B.length}const N=ug(P,L);for(let B=0;B<N.length;B+=3)this.indexArray.emplaceBack(I+N[B],I+N[B+1],I+N[B+2]);D.vertexLength+=E,D.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,f,g,h,v)}}Ct(My,"FillBucket",{omit:["layers","patternFeatures"]});const Rw=new Xi({"fill-sort-key":new Vt(Ce.layout_fill["fill-sort-key"]),visibility:new nt(Ce.layout_fill.visibility)});var Pw={paint:new Xi({"fill-antialias":new nt(Ce.paint_fill["fill-antialias"]),"fill-opacity":new Vt(Ce.paint_fill["fill-opacity"]),"fill-color":new Vt(Ce.paint_fill["fill-color"]),"fill-outline-color":new Vt(Ce.paint_fill["fill-outline-color"]),"fill-translate":new nt(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new nt(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new Vt(Ce.paint_fill["fill-pattern"]),"fill-emissive-strength":new nt(Ce.paint_fill["fill-emissive-strength"])}),layout:Rw};const dx=ei([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),hT=ei([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),dT=ei([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Tp=ei([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Mp=ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:fx}=dx;var Ip={},Iy=Ka,Sy=Hd;function Hd(n,t,o,l,h){this.properties={},this.extent=o,this.type=0,this._pbf=n,this._geometry=-1,this._keys=l,this._values=h,n.readFields(px,this,t)}function px(n,t,o){1==n?t.id=o.readVarint():2==n?function(l,h){for(var f=l.readVarint()+l.pos;l.pos<f;){var g=h._keys[l.readVarint()],v=h._values[l.readVarint()];h.properties[g]=v}}(o,t):3==n?t.type=o.readVarint():4==n&&(t._geometry=o.pos)}function mx(n){for(var t,o,l=0,h=0,f=n.length,g=f-1;h<f;g=h++)l+=((o=n[g]).x-(t=n[h]).x)*(t.y+o.y);return l}Hd.types=["Unknown","Point","LineString","Polygon"],Hd.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,o=n.readVarint()+n.pos,l=1,h=0,f=0,g=0,v=[];n.pos<o;){if(h<=0){var w=n.readVarint();l=7&w,h=w>>3}if(h--,1===l||2===l)f+=n.readSVarint(),g+=n.readSVarint(),1===l&&(t&&v.push(t),t=[]),t.push(new Iy(f,g));else{if(7!==l)throw new Error("unknown command "+l);t&&t.push(t[0].clone())}}return t&&v.push(t),v},Hd.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,o=1,l=0,h=0,f=0,g=1/0,v=-1/0,w=1/0,E=-1/0;n.pos<t;){if(l<=0){var D=n.readVarint();o=7&D,l=D>>3}if(l--,1===o||2===o)(h+=n.readSVarint())<g&&(g=h),h>v&&(v=h),(f+=n.readSVarint())<w&&(w=f),f>E&&(E=f);else if(7!==o)throw new Error("unknown command "+o)}return[g,w,v,E]},Hd.prototype.toGeoJSON=function(n,t,o){var l,h,f=this.extent*Math.pow(2,o),g=this.extent*n,v=this.extent*t,w=this.loadGeometry(),E=Hd.types[this.type];function D(L){for(var N=0;N<L.length;N++){var B=L[N];L[N]=[360*(B.x+g)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+v)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(l=0;l<w.length;l++)I[l]=w[l][0];D(w=I);break;case 2:for(l=0;l<w.length;l++)D(w[l]);break;case 3:for(w=function(L){var N=L.length;if(N<=1)return[L];for(var B,U,H=[],Q=0;Q<N;Q++){var ne=mx(L[Q]);0!==ne&&(void 0===U&&(U=ne<0),U===ne<0?(B&&H.push(B),B=[L[Q]]):B.push(L[Q]))}return B&&H.push(B),H}(w),l=0;l<w.length;l++)for(h=0;h<w[l].length;h++)D(w[l][h])}1===w.length?w=w[0]:E="Multi"+E;var P={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(P.id=this.id),P};var dg=Sy,Ow=fg;function fg(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(kw,this,t),this.length=this._features.length}function kw(n,t,o){15===n?t.version=o.readVarint():1===n?t.name=o.readString():5===n?t.extent=o.readVarint():2===n?t._features.push(o.pos):3===n?t._keys.push(o.readString()):4===n&&t._values.push(function(l){for(var h=null,f=l.readVarint()+l.pos;l.pos<f;){var g=l.readVarint()>>3;h=1===g?l.readString():2===g?l.readFloat():3===g?l.readDouble():4===g?l.readVarint64():5===g?l.readVarint():6===g?l.readSVarint():7===g?l.readBoolean():null}return h}(o))}fg.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new dg(this._pbf,t,this.extent,this._keys,this._values)};var Ay=Ow;function gx(n,t,o){if(3===n){var l=new Ay(o,o.readVarint()+o.pos);l.length&&(t[l.name]=l)}}var pg=Ip.VectorTile=function(n,t){this.layers=n.readFields(gx,{},t)},wl=Ip.VectorTileFeature=Sy;function mg(n,t,o,l){const h=[],f=0===l?(g,v,w,E,D,I)=>{g.push(new ht(I,w+(I-v)/(E-v)*(D-w)))}:(g,v,w,E,D,I)=>{g.push(new ht(v+(I-w)/(D-w)*(E-v),I))};for(const g of n){const v=[];for(const w of g){if(w.length<=2)continue;const E=[];for(let P=0;P<w.length-1;P++){const L=w[P].x,N=w[P].y,B=w[P+1].x,U=w[P+1].y,H=0===l?L:N,Q=0===l?B:U;H<t?Q>t&&f(E,L,N,B,U,t):H>o?Q<o&&f(E,L,N,B,U,o):E.push(w[P]),Q<t&&H>=t&&f(E,L,N,B,U,t),Q>o&&H<=o&&f(E,L,N,B,U,o)}let D=w[w.length-1];const I=0===l?D.x:D.y;I>=t&&I<=o&&E.push(D),E.length&&(D=E[E.length-1],E[0].x===D.x&&E[0].y===D.y||E.push(E[0]),v.push(E))}v.length&&h.push(v)}return h}function qd(n,t){return n.x-t.x||n.y-t.y}function Sp(n,t){return 0===qd(n.min,t.min)&&0===qd(n.max,t.max)}function _x(n,t){return!(n.min.x>t.max.x||n.max.x<t.min.x||n.min.y>t.max.y||n.max.y<t.min.y)}function gg(n,t,o){const l=1/gt,h=1/(1<<o.canonical.z),f=(t.x*l+o.canonical.x)*h+o.wrap,g=(t.y*l+o.canonical.y)*h;return{min:new ht((n.x*l+o.canonical.x)*h+o.wrap,(n.y*l+o.canonical.y)*h),max:new ht(f,g)}}function _g(n,t,o){const l=1<<o.canonical.z,h=((t.x-o.wrap)*l-o.canonical.x)*gt,f=(t.y*l-o.canonical.y)*gt;return{min:new ht(((n.x-o.wrap)*l-o.canonical.x)*gt,(n.y*l-o.canonical.y)*gt),max:new ht(h,f)}}function $s(n,t,o,l,h,f,g){const v=n.indices,w=n.vertices,E=[];for(let D=l;D<l+h;D+=3){const I=t[o[D+0]+f],P=t[o[D+1]+f],L=t[o[D+2]+f],N=Math.min(I.x,P.x,L.x),B=Math.max(I.x,P.x,L.x),U=Math.min(I.y,P.y,L.y),H=Math.max(I.y,P.y,L.y);E.length=0,n.grid.query(new ht(N,U),new ht(B,H),E);for(let Q=0;Q<E.length;Q++){const ne=E[Q];if(v0(w[v[3*ne+0]],w[v[3*ne+1]],w[v[3*ne+2]],I,P,L,g))return!0}}return!1}function hh(n,t,o,l){if(!n||!o)return!1;let h=n.vertices;if(!t.canonical.equals(l.canonical)||t.wrap!==l.wrap){if(o.vertices.length<n.vertices.length)return hh(o,l,n,t);const f=t.canonical,g=l.canonical,v=Math.pow(2,g.z-f.z);h=n.vertices.map(w=>new ht(w.x*f.x*gt*v-g.x*gt,w.y*f.y*gt*v-g.y*gt))}return $s(o,h,n.indices,0,n.indices.length,0,0)}Ip.VectorTileLayer=Ow;class yg{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,o){const l=this.toIdx(t,o);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(t,o){return this.leaves[this.toIdx(t,o)]}toIdx(t,o){return o*this.size+t}}function yx(n,t,o,l){let h=0,f=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(l[g])<1e-15){if(o[g]<n[g]||o[g]>t[g])return null}else{const v=1/l[g];let w=(n[g]-o[g])*v,E=(t[g]-o[g])*v;if(w>E){const D=w;w=E,E=D}if(w>h&&(h=w),E<f&&(f=E),h>f)return null}return h}function vx(n,t,o,l,h,f,g,v,w,E,D){const I=l-n,P=h-t,L=f-o,N=g-n,B=v-t,U=w-o,H=D[1]*U-D[2]*B,Q=D[2]*N-D[0]*U,ne=D[0]*B-D[1]*N,ie=I*H+P*Q+L*ne;if(Math.abs(ie)<1e-15)return null;const ue=1/ie,ae=E[0]-n,de=E[1]-t,ye=E[2]-o,be=(ae*H+de*Q+ye*ne)*ue;if(be<0||be>1)return null;const Te=de*L-ye*P,we=ye*I-ae*L,Oe=ae*P-de*I,Ge=(D[0]*Te+D[1]*we+D[2]*Oe)*ue;return Ge<0||be+Ge>1?null:(N*Te+B*we+U*Oe)*ue}function Ry(n,t,o){return(n-t)/(o-t)}function dh(n,t,o,l,h,f,g,v,w){const E=1<<o,D=f-l,I=g-h,P=(n+1)/E*D+l,L=(t+0)/E*I+h,N=(t+1)/E*I+h;v[0]=(n+0)/E*D+l,v[1]=L,w[0]=P,w[1]=N}class xx{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(f){const g=Math.ceil(Math.log2(f.dim/8)),v=[];let w=Math.ceil(Math.pow(2,g));const E=1/w,D=(L,N,B,U,H)=>{const Q=U?1:0,ne=(L+1)*B-Q,ie=N*B,ue=(N+1)*B-Q;H[0]=L*B,H[1]=ie,H[2]=ne,H[3]=ue};let I=new yg(w);const P=[];for(let L=0;L<w*w;L++){D(L%w,Math.floor(L/w),E,!1,P);const N=Jc(P[0],P[1],f),B=Jc(P[2],P[1],f),U=Jc(P[2],P[3],f),H=Jc(P[0],P[3],f);I.minimums.push(Math.min(N,B,U,H)),I.maximums.push(Math.max(N,B,U,H)),I.leaves.push(1)}for(v.push(I),w/=2;w>=1;w/=2){const L=v[v.length-1];I=new yg(w);for(let N=0;N<w*w;N++){D(N%w,Math.floor(N/w),2,!0,P);const B=L.getElevation(P[0],P[1]),U=L.getElevation(P[2],P[1]),H=L.getElevation(P[2],P[3]),Q=L.getElevation(P[0],P[3]),ne=L.isLeaf(P[0],P[1]),ie=L.isLeaf(P[2],P[1]),ue=L.isLeaf(P[2],P[3]),ae=L.isLeaf(P[0],P[3]),de=Math.min(B.min,U.min,H.min,Q.min),ye=Math.max(B.max,U.max,H.max,Q.max),be=ne&&ie&&ue&&ae;I.maximums.push(ye),I.minimums.push(de),I.leaves.push(ye-de<=5&&be?1:0)}v.push(I)}return v}(this.dem),l=o.length-1,h=o[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(o,0,0,l,0)}raycastRoot(t,o,l,h,f,g,v=1){return yx([t,o,-100],[l,h,this.maximums[0]*v],f,g)}raycast(t,o,l,h,f,g,v=1){if(!this.nodeCount)return null;const w=this.raycastRoot(t,o,l,h,f,g,v);if(null==w)return null;const E=[],D=[],I=[],P=[],L=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:N,t:B,nodex:U,nodey:H,depth:Q}=L.pop();if(this.leaves[N]){dh(U,H,Q,t,o,l,h,I,P);const ie=1<<Q,ue=(U+0)/ie,ae=(U+1)/ie,de=(H+0)/ie,ye=(H+1)/ie,be=Jc(ue,de,this.dem)*v,Te=Jc(ae,de,this.dem)*v,we=Jc(ae,ye,this.dem)*v,Oe=Jc(ue,ye,this.dem)*v,Ge=vx(I[0],I[1],be,P[0],I[1],Te,P[0],P[1],we,f,g),Re=vx(P[0],P[1],we,I[0],P[1],Oe,I[0],I[1],be,f,g),Ve=Math.min(null!==Ge?Ge:Number.MAX_VALUE,null!==Re?Re:Number.MAX_VALUE);if(Ve!==Number.MAX_VALUE)return Ve;{const Ie=d.N.scaleAndAdd([],f,g,B);if(bx(be,Te,Oe,we,Ry(Ie[0],I[0],P[0]),Ry(Ie[1],I[1],P[1]))>=Ie[2])return B}continue}let ne=0;for(let ie=0;ie<this._siblingOffset.length;ie++){dh((U<<1)+this._siblingOffset[ie][0],(H<<1)+this._siblingOffset[ie][1],Q+1,t,o,l,h,I,P),I[2]=-100,P[2]=this.maximums[this.childOffsets[N]+ie]*v;const ue=yx(I,P,f,g);if(null!=ue){const ae=ue;E[ie]=ae;let de=!1;for(let ye=0;ye<ne&&!de;ye++)ae>=E[D[ye]]&&(D.splice(ye,0,ie),de=!0);de||(D[ne]=ie),ne++}}for(let ie=0;ie<ne;ie++){const ue=D[ie];L.push({idx:this.childOffsets[N]+ue,t:E[ue],nodex:(U<<1)+this._siblingOffset[ue][0],nodey:(H<<1)+this._siblingOffset[ue][1],depth:Q+1})}}return null}_addNode(t,o,l){return this.minimums.push(t),this.maximums.push(o),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(t,o,l,h,f){if(1===t[h].isLeaf(o,l))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const g=h-1,v=t[g];let w=0,E=0;for(let D=0;D<this._siblingOffset.length;D++){const I=2*o+this._siblingOffset[D][0],P=2*l+this._siblingOffset[D][1],L=v.getElevation(I,P),N=v.isLeaf(I,P),B=this._addNode(L.min,L.max,N);N&&(w|=1<<D),E||(E=B)}for(let D=0;D<this._siblingOffset.length;D++)w&1<<D||this._construct(t,2*o+this._siblingOffset[D][0],2*l+this._siblingOffset[D][1],g,E+D)}}function bx(n,t,o,l,h,f){return rn(rn(n,o,f),rn(t,l,f),h)}function Jc(n,t,o){const l=o.dim,h=on(n*l-.5,0,l-1),f=on(t*l-.5,0,l-1),g=Math.floor(h),v=Math.floor(f),w=Math.min(g+1,l-1),E=Math.min(v+1,l-1);return bx(o.get(g,v),o.get(w,v),o.get(g,E),o.get(w,E),h-g,f-v)}const Py={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function vg(n,t,o){return(256*n*256+256*t+o)/10-1e4}function Lw(n,t,o){return 256*n+t+o/256-32768}class Ap{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,o,l,h=!1){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(l&&"mapbox"!==l&&"terrarium"!==l)return tr(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const f=this.dim=o.height-2,g=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let w=0;w<f;w++)g[this._idx(-1,w)]=g[this._idx(0,w)],g[this._idx(f,w)]=g[this._idx(f-1,w)],g[this._idx(w,-1)]=g[this._idx(w,0)],g[this._idx(w,f)]=g[this._idx(w,f-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(f,-1)]=g[this._idx(f-1,0)],g[this._idx(-1,f)]=g[this._idx(0,f-1)],g[this._idx(f,f)]=g[this._idx(f-1,f-1)]}const v="terrarium"===l?Lw:vg;for(let w=0;w<g.length;++w){const E=4*w;this.floatView[w]=v(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=Xe.now()}_buildQuadTree(){this._tree=new xx(this)}get(t,o,l=!1){l&&(t=on(t,-1,this.dim),o=on(o,-1,this.dim));const h=this._idx(t,o);return this.floatView[h]}set(t,o,l){const h=this._idx(t,o),f=this.floatView[h];return this.floatView[h]=l,l-f}static getUnpackVector(t){return Py[t]}_idx(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)}static pack(t,o){const l=[0,0,0,0],h=Ap.getUnpackVector(o);let f=Math.floor((t+h[3])/h[2]);return l[2]=f%256,f=Math.floor(f/256),l[1]=f%256,f=Math.floor(f/256),l[0]=f,l}getPixels(){return new ix({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,o,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=o*this.dim,f=o*this.dim+this.dim,g=l*this.dim,v=l*this.dim+this.dim;switch(o){case-1:h=f-1;break;case 1:f=h+1}switch(l){case-1:g=v-1;break;case 1:v=g+1}const w=-o*this.dim,E=-l*this.dim;for(let D=g;D<v;D++)for(let I=h;I<f;I++){const P=4*this._idx(I,D),L=4*this._idx(I+w,D+E);this.pixels[P+0]=t.pixels[L+0],this.pixels[P+1]=t.pixels[L+1],this.pixels[P+2]=t.pixels[L+2],this.pixels[P+3]=t.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ct(Ap,"DEMData"),Ct(xx,"DemMinMaxQuadTree",{omit:["dem"]});class ga{constructor(t,o,l){this._demTile=t,this._dem=this._demTile.dem,this._scale=o,this._offset=l}static create(t,o,l){const h=l||t.findDEMTileFor(o);if(!h||!h.dem)return;const f=h.dem,g=h.tileID,v=1<<o.canonical.z-g.canonical.z;return new ga(h,f.dim/gt/v,[(o.canonical.x/v-g.canonical.x)*f.dim,(o.canonical.y/v-g.canonical.y)*f.dim])}tileCoordToPixel(t,o){const l=o*this._scale+this._offset[1],h=Math.floor(t*this._scale+this._offset[0]),f=Math.floor(l);return new ht(h,f)}getElevationAt(t,o,l,h){const f=t*this._scale+this._offset[0],g=o*this._scale+this._offset[1],v=Math.floor(f),w=Math.floor(g),E=this._dem;return h=!!h,l?rn(rn(E.get(v,w,h),E.get(v,w+1,h),g-w),rn(E.get(v+1,w,h),E.get(v+1,w+1,h),g-w),f-v):E.get(v,w,h)}getElevationAtPixel(t,o,l){return this._dem.get(t,o,!!l)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*en(1,t)*this._dem.stride}}const fT=wl.types,Oy=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],ky=["fill-extrusion-flood-light-ground-radius"],Fw=Math.pow(2,13),pT=Math.pow(2,15)-1,Nw=new ht(0,1),Ua=2147483648;function Rp(n,t,o,l,h,f,g,v){n.emplaceBack((t<<1)+g,(o<<1)+f,(Math.floor(l*Fw)<<1)+h,Math.round(v))}function Zd(n,t,o,l,h,f){n.emplaceBack(t.x,t.y,(o.x<<1)+l,(o.y<<1)+h,f)}function fh(n,t,o){n.emplaceBack(t.x,t.y,t.z,16384*o[0],16384*o[1],16384*o[2])}class ph{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class xg{constructor(){this.centroidXY=new ht(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ht(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ht(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ht(this.max.x-this.min.x,this.max.y-this.min.y)}}class bg{constructor(){this.acc=new ht(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,o){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=o.x,t.min.y=t.max.y=o.y)}appendEdge(t,o,l){this.accCount++,this.acc._add(o);let h=!!this.borders;o.x<t.min.x?(t.min.x=o.x,h=!0):o.x>t.max.x&&(t.max.x=o.x,h=!0),o.y<t.min.y?(t.min.y=o.y,h=!0):o.y>t.max.y&&(t.max.y=o.y,h=!0),((0===o.x||o.x===gt)&&o.x===l.x)!=((0===o.y||o.y===gt)&&o.y===l.y)&&this.processBorderOverlap(o,l),h&&this.checkBorderIntersection(o,l)}checkBorderIntersection(t,o){o.x<0!=t.x<0&&this.addBorderIntersection(0,rn(o.y,t.y,(0-o.x)/(t.x-o.x))),o.x>gt!=t.x>gt&&this.addBorderIntersection(1,rn(o.y,t.y,(gt-o.x)/(t.x-o.x))),o.y<0!=t.y<0&&this.addBorderIntersection(2,rn(o.x,t.x,(0-o.y)/(t.y-o.y))),o.y>gt!=t.y>gt&&this.addBorderIntersection(3,rn(o.x,t.x,(gt-o.y)/(t.y-o.y)))}addBorderIntersection(t,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[t];o<l[0]&&(l[0]=o),o>l[1]&&(l[1]=o)}processBorderOverlap(t,o){if(t.x===o.x){if(t.y===o.y)return;const l=0===t.x?0:1;this.addBorderIntersection(l,o.y),this.addBorderIntersection(l,t.y)}else{const l=0===t.y?2:3;this.addBorderIntersection(l,o.x),this.addBorderIntersection(l,t.x)}}centroid(){return 0===this.accCount?new ht(0,0):new ht(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,o)=>t+ +(o[0]!==Number.MAX_VALUE),0):0}}function Wd(n,t){const o=n.add(t)._unit(),l=on(n.x*o.x+n.y*o.y,-1,1);var h,f,g;return h=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(h)))/4*pT*((f=n).x*(g=t).y-f.y*g.x<0?-1:1)}const wg=[n=>n.x<0,n=>n.x>gt,n=>n.y<0,n=>n.y>gt];function Yd(n,t,o,l){const h=[4];if(0===l)return h;o._mult(l);const f=n.sub(o),g=t.sub(o),v=[n,t,f,g];for(let w=0;w<4;w++)for(const E of v)if(wg[w](E)){h.push(w);break}return h}class Eg{constructor(t){this.vertexArray=new co,this.indexArray=new Ir,this.programConfigurations=new q(t.layers,t.zoom,o=>ky.includes(o)),this._segments=new Ki,this.hiddenByLandmarkVertexArray=new Xf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ki}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(t,o,l,h=!1){const f=t.length;if(f>2){let g=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let w;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const E=t[0],D=t[1];w=Wd(E.sub(t[f-1])._perp()._unit(),D.sub(E)._perp()._unit())}for(let E=0;E<f;E++){const D=E===f-1?0:E+1,I=t[E],P=t[D],L=t[D===f-1?0:D+1],N=P.sub(I)._perp()._unit(),B=Wd(N,L.sub(P)._perp()._unit()),U=w,H=B;if(mh(I,P,o)||h&&wx(I,o)&&wx(P,o)){w=B;continue}const Q=v.vertexLength;Zd(this.vertexArray,I,P,1,1,U),Zd(this.vertexArray,I,P,1,0,U),Zd(this.vertexArray,I,P,0,1,H),Zd(this.vertexArray,I,P,0,0,H),v.vertexLength+=4;const ne=Yd(I,P,N,l);for(const ie of ne)this._segmentToGroundQuads[g].push({id:Q,region:ie}),this._segmentToRegionTriCounts[g][ie]+=2,v.primitiveLength+=2;w=B}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),o=t.length;for(let l=0;l<o;l++)this._segmentToGroundQuads[l].sort((h,f)=>h.region-f.region);for(let l=0;l<o;l++){const h=this._segmentToGroundQuads[l],f=t[l],g=this._segmentToRegionTriCounts[l];g.reduce((w,E)=>w+E,0);let v=0;for(let w=0;w<=4;w++){const E=g[w];if(0!==E){let D=this.regionSegments[w];D||(D=this.regionSegments[w]=new Ki);const I={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+v,vertexLength:f.vertexLength,primitiveLength:E};D.get().push(I)}v+=E}for(let w=0;w<h.length;w++){const E=h[w].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,o,l,h,f,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,o,l,h,f,g)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,hT.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,o,l,h,f,g){this.hasData()&&this.programConfigurations.updatePaintArrays(t,o,l,h,f,g)}updateHiddenByLandmark(t){if(!this.hasData())return;const o=t.groundVertexCount+t.groundVertexArrayOffset;if(0===t.groundVertexCount)return;const l=t.flags&Ua?1:0;for(let h=t.groundVertexArrayOffset;h<o;++h)this.hiddenByLandmarkVertexArray.emplace(h,l);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,Tp.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const o=this.regionSegments[t];o&&o.destroy()}}}}class Xd{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ir,this.footprintVertices=new mi,this.footprintSegments=[],this.layoutVertexArray=new fs,this.centroidVertexArray=new Ql,this.indexArray=new Ir,this.programConfigurations=new q(t.layers,t.zoom,o=>Oy.includes(o)),this.segments=new Ki,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new Eg(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,o,l,h){this.features=[],this.hasPattern=hg("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=vn(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:g,index:v,sourceLayerIndex:w}of t){const E=this.layers[0]._featureFilter.needGeometry,D=mr(f,E);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),D,l))continue;const I={id:g,sourceLayerIndex:w,index:v,geometry:E?D.geometry:Ei(f,l,h),properties:f.properties,type:f.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ty("fill-extrusion",this.layers,I,this.zoom,o)):this.addFeature(I,I.geometry,v,l,{},o.availableImages,h,o.brightness),o.featureIndex.insert(f,I.geometry,v,w,this.index,P)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,o,l,h,f,g){for(const v of this.features){const{geometry:w}=v;this.addFeature(v,w,v.index,o,l,h,f,g)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(t,o,l,h,f){const g=0!==Object.keys(t).length;if(g&&!this.stateDependentLayers.length)return;const v=g?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,o,v,l,h,f),this.groundEffect.update(t,o,v,l,h,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fx),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Mp.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,dT.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,o,l,h,f,g,v,w){const E=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,D=[new ht(0,0),new ht(gt,gt)],I=v.projection,P="globe"===I.name,L="Polygon"===fT[t.type],N=new bg;N.centroidDataIndex=this.centroidData.length;const B=new xg,U=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},h)<=0,H=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},h);B.height=H,B.vertexArrayOffset=this.layoutVertexArray.length,B.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ad);const Q=Dy(o,500);for(let ye=Q.length-1;ye>=0;ye--){const be=Q[ye];(0===be.length||(ne=be[0]).every(Te=>Te.x<=0)||ne.every(Te=>Te.x>=gt)||ne.every(Te=>Te.y<=0)||ne.every(Te=>Te.y>=gt))&&Q.splice(ye,1)}var ne;let ie;if(P)ie=Dg(Q,D,h);else{ie=[];for(const ye of Q)ie.push({polygon:ye,bounds:D})}const ue=L?this.edgeRadius:0,ae=ue>0&&this.zoom<17,de=(ye,be)=>{if(0===ye.length)return!1;const Te=ye[ye.length-1];return be.x===Te.x&&be.y===Te.y};for(const{polygon:ye,bounds:be}of ie){let Te=0,we=0;for(const Ve of ye)L&&!Ve[0].equals(Ve[Ve.length-1])&&Ve.push(Ve[0]),we+=L?Ve.length-1:Ve.length;const Oe=this.segments.prepareSegment((L?5:4)*we,this.layoutVertexArray,this.indexArray);B.footprintSegIdx<0&&(B.footprintSegIdx=this.footprintSegments.length),B.polygonSegIdx<0&&(B.polygonSegIdx=this.polygonSegments.length);const Ge={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Re=new ph;if(Re.vertexOffset=this.footprintVertices.length,Re.indexOffset=3*this.footprintIndices.length,Re.ringIndices=[],L){const Ve=[],Ie=[];Te=Oe.vertexLength;for(let lt=0;lt<ye.length;lt++){const Be=ye[lt];Be.length&&0!==lt&&Ie.push(Ve.length/2);const yt=[];let dt,Ze;dt=Be[1].sub(Be[0])._perp()._unit(),Re.ringIndices.push(Be.length-1);for(let qt=1;qt<Be.length;qt++){const Ft=Be[qt],Tt=Be[qt===Be.length-1?1:qt+1],We=Ft.clone();if(ue){Ze=Tt.sub(Ft)._perp()._unit();const jt=dt.add(Ze)._unit(),un=ue*Math.min(4,1/(dt.x*jt.x+dt.y*jt.y));We.x+=un*jt.x,We.y+=un*jt.y,We.x=Math.round(We.x),We.y=Math.round(We.y),dt=Ze}!U||0!==ue&&!ae||de(yt,We)||yt.push(We),Rp(this.layoutVertexArray,We.x,We.y,0,0,1,1,0),Oe.vertexLength++,this.footprintVertices.emplaceBack(Ft.x,Ft.y),Ve.push(Ft.x,Ft.y),P&&fh(this.layoutVertexExtArray,I.projectTilePoint(We.x,We.y,h),I.upVector(h,We.x,We.y))}U&&(0===ue||ae)&&(0!==yt.length&&de(yt,yt[0])&&yt.pop(),this.groundEffect.addData(yt,be,E))}const je=ug(Ve,Ie);for(let lt=0;lt<je.length;lt+=3)this.footprintIndices.emplaceBack(Re.vertexOffset+je[lt+0],Re.vertexOffset+je[lt+1],Re.vertexOffset+je[lt+2]),this.indexArray.emplaceBack(Te+je[lt],Te+je[lt+2],Te+je[lt+1]),Oe.primitiveLength++;Re.indexCount+=je.length,Re.vertexCount+=this.footprintVertices.length-Re.vertexOffset}for(let Ve=0;Ve<ye.length;Ve++){const Ie=ye[Ve];N.startRing(B,Ie[0]);let je=Ie.length>4&&Ly(Ie[Ie.length-2],Ie[0],Ie[1]),lt=ue?mT(Ie[Ie.length-2],Ie[0],Ie[1],ue):0;const Be=[];let yt,dt,Ze;dt=Ie[1].sub(Ie[0])._perp()._unit();let qt=!0;for(let Ft=1,Tt=0;Ft<Ie.length;Ft++){let We=Ie[Ft-1],jt=Ie[Ft];const un=Ie[Ft===Ie.length-1?1:Ft+1];if(N.appendEdge(B,jt,We),mh(jt,We,be)){ue&&(dt=un.sub(jt)._perp()._unit(),qt=!qt);continue}const Ht=jt.sub(We)._perp(),dn=Ht.x/(Math.abs(Ht.x)+Math.abs(Ht.y)),Jt=Ht.y>0?1:0,Pn=We.dist(jt);if(Tt+Pn>32768&&(Tt=0),ue){Ze=un.sub(jt)._perp()._unit();let Fn=Cg(We,jt,un,Pp(dt,Ze),ue);isNaN(Fn)&&(Fn=0);const Jn=jt.sub(We)._unit();We=We.add(Jn.mult(lt))._round(),jt=jt.add(Jn.mult(-Fn))._round(),lt=Fn,dt=Ze,U&&this.zoom>=17&&(de(Be,We)||Be.push(We),de(Be,jt)||Be.push(jt))}const sn=Oe.vertexLength,_i=Ie.length>4&&Ly(We,jt,un);let Vn=Ex(Tt,je,qt);if(Rp(this.layoutVertexArray,We.x,We.y,dn,Jt,0,0,Vn),Rp(this.layoutVertexArray,We.x,We.y,dn,Jt,0,1,Vn),Tt+=Pn,Vn=Ex(Tt,_i,!qt),je=_i,Rp(this.layoutVertexArray,jt.x,jt.y,dn,Jt,0,0,Vn),Rp(this.layoutVertexArray,jt.x,jt.y,dn,Jt,0,1,Vn),Oe.vertexLength+=4,this.indexArray.emplaceBack(sn+0,sn+1,sn+2),this.indexArray.emplaceBack(sn+1,sn+3,sn+2),Oe.primitiveLength+=2,ue){const Fn=Te+(1===Ft?Ie.length-2:Ft-2),Jn=1===Ft?Te:Fn+1;if(this.indexArray.emplaceBack(sn+1,Fn,sn+3),this.indexArray.emplaceBack(Fn,Jn,sn+3),Oe.primitiveLength+=2,void 0===yt&&(yt=sn),!mh(un,Ie[Ft],be)){const jn=Ft===Ie.length-1?yt:Oe.vertexLength;this.indexArray.emplaceBack(sn+2,sn+3,jn),this.indexArray.emplaceBack(sn+3,jn+1,jn),this.indexArray.emplaceBack(sn+3,Jn,jn+1),Oe.primitiveLength+=3}qt=!qt}if(P){const Fn=this.layoutVertexExtArray,Jn=I.projectTilePoint(We.x,We.y,h),jn=I.projectTilePoint(jt.x,jt.y,h),St=I.upVector(h,We.x,We.y),oi=I.upVector(h,jt.x,jt.y);fh(Fn,Jn,St),fh(Fn,Jn,St),fh(Fn,jn,oi),fh(Fn,jn,oi)}}L&&(Te+=Ie.length-1),U&&ue&&this.zoom>=17&&(0!==Be.length&&de(Be,Be[0])&&Be.pop(),this.groundEffect.addData(Be,be,E,ue>0))}this.footprintSegments.push(Re),Ge.triangleCount=this.indexArray.length-Ge.triangleArrayOffset,this.polygonSegments.push(Ge),++B.footprintSegLen,++B.polygonSegLen}if(B.vertexCount=this.layoutVertexArray.length-B.vertexArrayOffset,B.groundVertexCount=this.groundEffect.vertexArray.length-B.groundVertexArrayOffset,0!==B.vertexCount){if(B.centroidXY=N.borders?Nw:this.encodeCentroid(N,B),this.centroidData.push(B),N.borders){this.featuresOnBorder.push(N);const ye=this.featuresOnBorder.length-1;for(let be=0;be<N.borders.length;be++)N.borders[be][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[be].push(ye)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,f,g,h,w),this.groundEffect.addPaintPropertiesData(t,l,f,g,h,w),this.maxHeight=Math.max(this.maxHeight,H)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((o,l)=>this.featuresOnBorder[o].borders[t][0]-this.featuresOnBorder[l].borders[t][0])}splitToSubtiles(){const t=[];for(let v=0;v<this.centroidData.length;v++){const w=this.centroidData[v],E=+(w.min.y+w.max.y>gt),D=2*E+(+(w.min.x+w.max.x>gt)^E);for(let I=0;I<w.polygonSegLen;I++){const P=w.polygonSegIdx+I;t.push({centroidIdx:v,subtile:D,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const o=new Ir;t.sort((v,w)=>v.triangleSegmentIdx===w.triangleSegmentIdx?v.subtile-w.subtile:v.triangleSegmentIdx-w.triangleSegmentIdx);let l=0,h=0,f=0;for(const v of t){if(v.triangleSegmentIdx!==l)break;f++}const g=t.length;for(;h!==t.length;){l=t[h].triangleSegmentIdx;let v=0,w=h,E=h;for(let D=w;D<f&&t[D].subtile===v;D++)E++;for(;w!==f;){const D=t[w];v=D.subtile;const I=this.centroidData[D.centroidIdx].min.clone(),P=this.centroidData[D.centroidIdx].max.clone(),L={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let N=w;N<E;N++){const B=t[N],U=this.polygonSegments[B.polygonSegmentIdx],H=this.centroidData[B.centroidIdx].min,Q=this.centroidData[B.centroidIdx].max,ne=this.indexArray.uint16;for(let ie=U.triangleArrayOffset;ie<U.triangleArrayOffset+U.triangleCount;ie++)o.emplaceBack(ne[3*ie],ne[3*ie+1],ne[3*ie+2]);L.primitiveLength+=U.triangleCount,I.x=Math.min(I.x,H.x),I.y=Math.min(I.y,H.y),P.x=Math.max(P.x,Q.x),P.y=Math.max(P.y,Q.y)}L.primitiveLength>0&&this.triangleSubSegments.push({segment:L,min:I,max:P}),w=E;for(let N=w;N<f&&t[N].subtile===t[w].subtile;N++)E++}h=f;for(let D=h;D<g&&t[D].triangleSegmentIdx===t[h].triangleSegmentIdx;D++)f++}o._trim(),this.indexArray=o}getVisibleSegments(t,o,l){let h=0,f=0;const g=1<<t.canonical.z;if(o){const B=o.getMinMaxForTile(t);B&&(h=B.min,f=B.max)}f+=this.maxHeight;const v=t.toUnwrapped();let w;const E=[v.canonical.x/g+v.wrap,v.canonical.y/g],D=[(v.canonical.x+1)/g+v.wrap,(v.canonical.y+1)/g],I=new Ki,P=(B,U,H)=>[B[0]*(1-H[0])+U[0]*H[0],B[1]*(1-H[1])+U[1]*H[1]],L=[],N=[];for(const B of this.triangleSubSegments){L[0]=B.min.x/gt,L[1]=B.min.y/gt,N[0]=B.max.x/gt,N[1]=B.max.y/gt;const U=P(E,D,L),H=P(E,D,N);if(0===new Hi([U[0],U[1],h],[H[0],H[1],f]).intersectsPrecise(l)){w&&(I.segments.push(w),w=void 0);continue}const Q=B.segment;w&&w.vertexOffset!==Q.vertexOffset&&(I.segments.push(w),w=void 0),w?(w.vertexLength+=Q.vertexLength,w.primitiveLength+=Q.primitiveLength):w={vertexOffset:Q.vertexOffset,primitiveLength:Q.primitiveLength,vertexLength:Q.vertexLength,primitiveOffset:Q.primitiveOffset,sortKey:void 0,vaos:{}}}return w&&I.segments.push(w),I}encodeCentroid(t,o){const l=t.centroid(),h=o.span(),f=Math.min(7,Math.round(h.x*this.tileToMeter/10)),g=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new ht(on(l.x,1,gt-1)<<3|f,on(l.y,1,gt-1)<<3|g)}encodeBorderCentroid(t){if(!t.borders)return new ht(0,0);const o=t.borders,l=Number.MAX_VALUE;if(o[0][0]!==l||o[1][0]!==l){const h=o[0][0]!==l?0:1;return new ht(6|(o[0][0]!==l?0:65528),(o[h][0]+o[h][1])/2<<3|6)}{const h=o[2][0]!==l?2:3;return new ht((o[h][0]+o[h][1])/2<<3|6,6|(o[2][0]!==l?0:65528))}}showCentroid(t){const o=this.centroidData[t.centroidDataIndex];o.flags&=Ua,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const o=t.vertexArrayOffset,l=t.vertexCount+t.vertexArrayOffset,h=t.flags&Ua?Nw:t.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==h.y||f!==h.x){for(let g=o;g<l;++g)this.centroidVertexArray.emplace(g,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const l=o.getReplacementRegionsForTile(t.toUnwrapped());if(function(f,g){if(f.length!==g.length)return!1;for(let v=0;v<f.length;v++)if(f[v].sourceId!==g[v].sourceId||!Sp(f[v],g[v]))return!1;return!0}(this.activeReplacements,l))return;if(this.activeReplacements=l,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const h=[];for(const f of this.activeReplacements){const g=Math.pow(2,f.footprintTileId.canonical.z-t.canonical.z);for(const v of this.centroidData)if(!(v.flags&Ua||f.min.x>v.max.x||v.min.x>f.max.x||f.min.y>v.max.y||v.min.y>f.max.y))for(let w=0;w<v.footprintSegLen;w++){const E=this.footprintSegments[v.footprintSegIdx+w];if(h.length=0,Dx(this.footprintVertices,E.vertexOffset,E.vertexCount,f.footprintTileId.canonical,t.canonical,h),$s(f.footprint,h,this.footprintIndices.uint16,E.indexOffset,E.indexCount,-E.vertexOffset,-g)){v.flags|=Ua;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,o,l){let h=!1;for(let f=0;f<l.footprintSegLen;f++){const g=this.footprintSegments[l.footprintSegIdx+f];let v=0;for(const w of g.ringIndices){for(let E=v,D=w+v-1;E<w+v;D=E++){const I=this.footprintVertices.int16[2*(E+g.vertexOffset)+0],P=this.footprintVertices.int16[2*(E+g.vertexOffset)+1],L=this.footprintVertices.int16[2*(D+g.vertexOffset)+1];P>o!=L>o&&t<(this.footprintVertices.int16[2*(D+g.vertexOffset)+0]-I)*(o-P)/(L-P)+I&&(h=!h)}v=w}}return h}getHeightAtTileCoord(t,o){let l=Number.NEGATIVE_INFINITY,h=!0;const f=4*(t+gt)*gt+(o+gt);if(this.partLookup.hasOwnProperty(f)){const g=this.partLookup[f];return g?{height:g.height,hidden:!!(g.flags&Ua)}:void 0}for(const g of this.centroidData)t>g.max.x||g.min.x>t||o>g.max.y||g.min.y>o||this.footprintContainsPoint(t,o,g)&&g&&g.height>l&&(l=g.height,this.partLookup[f]=g,h=!!(g.flags&Ua));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:h};this.partLookup[f]=void 0}}function Pp(n,t){const o=n.add(t)._unit();return n.x*o.x+n.y*o.y}function mT(n,t,o,l){const h=t.sub(n)._perp()._unit(),f=o.sub(t)._perp()._unit();return Cg(n,t,o,Pp(h,f),l)}function Cg(n,t,o,l,h){const f=Math.sqrt(1-l*l);return Math.min(n.dist(t)/3,t.dist(o)/3,h*f/l)}function mh(n,t,o){return n.x<o[0].x&&t.x<o[0].x||n.x>o[1].x&&t.x>o[1].x||n.y<o[0].y&&t.y<o[0].y||n.y>o[1].y&&t.y>o[1].y}function wx(n,t){return n.x<t[0].x||n.x>t[1].x||n.y<t[0].y||n.y>t[1].y}function Ly(n,t,o){if(n.x<0||n.x>=gt||t.x<0||t.x>=gt||o.x<0||o.x>=gt)return!1;const l=o.sub(t),h=l.perp(),f=n.sub(t);return(l.x*f.x+l.y*f.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(f.x*f.x+f.y*f.y))>-.866&&h.x*f.x+h.y*f.y<0}function Ex(n,t,o){const l=t?2|n:-3&n;return o?1|l:-2&l}function Cx(){const n=Math.PI/32,t=Math.tan(n),o=Ae;return o*Math.sqrt(1+2*t*t)-o}function Dg(n,t,o){const l=1<<o.z,h=tn(o.x/l),f=tn((o.x+1)/l),g=Dn(o.y/l),v=Dn((o.y+1)/l);return function(w,E,D,I,P=0,L){const N=[];if(!w.length||!D||!I)return N;const B=(ae,de)=>{for(const ye of ae)N.push({polygon:ye,bounds:de})},U=Math.ceil(Math.log2(D)),H=Math.ceil(Math.log2(I)),Q=U-H,ne=[];for(let ae=0;ae<Math.abs(Q);ae++)ne.push(Q>0?0:1);for(let ae=0;ae<Math.min(U,H);ae++)ne.push(0),ne.push(1);let ie=w;if(ie=mg(ie,E[0].y-P,E[1].y+P,1),ie=mg(ie,E[0].x-P,E[1].x+P,0),!ie.length)return N;const ue=[];for(ne.length?ue.push({polygons:ie,bounds:E,depth:0}):B(ie,E);ue.length;){const ae=ue.pop(),de=ae.depth,ye=ne[de],be=ae.bounds[0],Te=ae.bounds[1],we=0===ye?be.x:be.y,Oe=0===ye?Te.x:Te.y,Ge=L?L(ye,we,Oe):.5*(we+Oe),Re=mg(ae.polygons,we-P,Ge+P,ye),Ve=mg(ae.polygons,Ge-P,Oe+P,ye);if(Re.length){const Ie=[be,new ht(0===ye?Ge:Te.x,1===ye?Ge:Te.y)];ne.length>de+1?ue.push({polygons:Re,bounds:Ie,depth:de+1}):B(Re,Ie)}if(Ve.length){const Ie=[new ht(0===ye?Ge:be.x,1===ye?Ge:be.y),Te];ne.length>de+1?ue.push({polygons:Ve,bounds:Ie,depth:de+1}):B(Ve,Ie)}}return N}(n,t,Math.ceil((f-h)/11.25),Math.ceil((g-v)/11.25),1,(w,E,D)=>{if(0===w)return.5*(E+D);{const I=Dn((o.y+E/gt)/l);return(Yt(.5*(Dn((o.y+D/gt)/l)+I))*l-o.y)*gt}})}function Dx(n,t,o,l,h,f){const g=Math.pow(2,l.z-h.z);for(let v=0;v<o;v++){let w=n.int16[2*(v+t)+0],E=n.int16[2*(v+t)+1];w=(w+h.x*gt)*g-l.x*gt,E=(E+h.y*gt)*g-l.y*gt,f.push(new ht(w,E))}}Ct(Xd,"FillExtrusionBucket",{omit:["layers","features"]}),Ct(xg,"PartData"),Ct(ph,"FootprintSegment"),Ct(bg,"BorderCentroidData"),Ct(Eg,"GroundEffect");const zw=new Xi({visibility:new nt(Ce["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new nt(Ce["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Bw={paint:new Xi({"fill-extrusion-opacity":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Vt(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Vt(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Vt(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Vt(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Vt(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Vt(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new nt(Ce["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:zw};class Op extends ht{constructor(t,o,l){super(t,o),this.z=l}}function kp(n,t){return n.x*t.x+n.y*t.y}function Lp(n,t){if(1===n.length){let o=0;const l=t[o++];let h;for(;!h||l.equals(h);)if(h=t[o++],!h)return 1/0;for(;o<t.length;o++){const f=t[o],g=n[0],v=h.sub(l),w=f.sub(l),E=g.sub(l),D=kp(v,v),I=kp(v,w),P=kp(w,w),L=kp(E,v),N=kp(E,w),B=D*P-I*I,U=(P*L-I*N)/B,H=(D*N-I*L)/B,Q=l.z*(1-U-H)+h.z*U+f.z*H;if(isFinite(Q))return Q}return 1/0}{let o=1/0;for(const l of t)o=Math.min(o,l.z);return o}}function Tg(n,t,o,l,h,f,g,v){const w=g*h.getElevationAt(n,t,!0,!0),E=0!==f[0],D=E?0===f[1]?g*(f[0]/7-450):g*function(I,P,L){const N=Math.floor(P[0]/8),B=Math.floor(P[1]/8),U=10*(P[0]-8*N),H=10*(P[1]-8*B),Q=I.getElevationAt(N,B,!0,!0),ne=I.getMeterToDEM(L),ie=Math.floor(.5*(U*ne-1)),ue=Math.floor(.5*(H*ne-1)),ae=I.tileCoordToPixel(N,B),de=2*ie+1,ye=2*ue+1,be=(lt=de,Be=ye,[(Ve=I).getElevationAtPixel(Ie=ae.x-ie,je=ae.y-ue,!0),Ve.getElevationAtPixel(Ie+Be,je,!0),Ve.getElevationAtPixel(Ie,je+Be,!0),Ve.getElevationAtPixel(Ie+lt,je+Be,!0)]),Te=Math.abs(be[0]-be[1]),we=Math.abs(be[2]-be[3]),Oe=Math.abs(be[0]-be[2])+Math.abs(be[1]-be[3]),Ge=Math.min(.25,.5*ne*(Te+we)/de),Re=Math.min(.25,.5*ne*Oe/ye);var Ve,Ie,je,lt,Be;return Q+Math.max(Ge*U,Re*H)}(h,f,v):w;return{base:w+(0===o)?-1:o,top:E?Math.max(D+l,w+o+2):w+l}}const Vw=ei([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Tx}=Vw,Fy=ei([{name:"a_packed",components:4,type:"Float32"}]),{members:Mg}=Fy;class Mx{constructor(t,o){this.width=t,this.height=o,this.nextRow=0,this.image=new Jo({width:t,height:o}),this.positions={},this.uploaded=!1}getDash(t,o){const l=this.getKey(t,o);return this.positions[l]}trim(){const t=this.width,o=this.height=Ti(this.nextRow);this.image.resize({width:t,height:o})}getKey(t,o){return t.join(",")+o}getDashRanges(t,o,l){const h=[];let f=t.length%2==1?-t[t.length-1]*l:0,g=t[0]*l,v=!0;h.push({left:f,right:g,isDash:v,zeroLength:0===t[0]});let w=t[0];for(let E=1;E<t.length;E++){v=!v;const D=t[E];f=w*l,w+=D,g=w*l,h.push({left:f,right:g,isDash:v,zeroLength:0===D})}return h}addRoundDash(t,o,l){const h=o/2;for(let f=-l;f<=l;f++){const g=this.width*(this.nextRow+l+f);let v=0,w=t[v];for(let E=0;E<this.width;E++){E/w.right>1&&(w=t[++v]);const D=Math.abs(E-w.left),I=Math.abs(E-w.right),P=Math.min(D,I);let L;const N=f/l*(h+1);if(w.isDash){const B=h-Math.abs(N);L=Math.sqrt(P*P+B*B)}else L=h-Math.sqrt(P*P+N*N);this.image.data[g+E]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(t,o){for(let w=t.length-1;w>=0;--w){const E=t[w],D=t[w+1];E.zeroLength?t.splice(w,1):D&&D.isDash===E.isDash&&(D.left=E.left,t.splice(w,1))}const l=t[0],h=t[t.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const f=this.width*this.nextRow;let g=0,v=t[g];for(let w=0;w<this.width;w++){w/v.right>1&&(v=t[++g]);const E=Math.abs(w-v.left),D=Math.abs(w-v.right),I=Math.min(E,D);this.image.data[f+w]=Math.max(0,Math.min(255,(v.isDash?I:-I)+o+128))}}addDash(t,o){const l=this.getKey(t,o);if(this.positions[l])return this.positions[l];const h="round"===o,f=h?7:0,g=2*f+1;if(this.nextRow+g>this.height)return tr("LineAtlas out of space"),null;0===t.length&&t.push(1);let v=0;for(let D=0;D<t.length;D++)t[D]<0&&(tr("Negative value is found in line dasharray, replacing values with 0"),t[D]=0),v+=t[D];if(0!==v){const D=this.width/v,I=this.getDashRanges(t,this.width,D);h?this.addRoundDash(I,D,f):this.addRegularDash(I,"square"===o?.5*D:0)}const w=this.nextRow+f;this.nextRow+=g;const E={tl:[w,f],br:[v,0]};return this.positions[l]=E,E}}Ct(Mx,"LineAtlas");const Ix=wl.types,jw=Math.cos(Math.PI/180*37.5);class Ig{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Hf,this.layoutVertexArray2=new ka,this.indexArray=new Ir,this.programConfigurations=new q(t.layers,t.zoom),this.segments=new Ki,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,l,h){this.hasPattern=hg("line",this.layers,o);const f=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:D,id:I,index:P,sourceLayerIndex:L}of t){const N=this.layers[0]._featureFilter.needGeometry,B=mr(D,N);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),B,l))continue;const U=f?f.evaluate(B,{},l):void 0,H={id:I,properties:D.properties,type:D.type,sourceLayerIndex:L,index:P,geometry:N?B.geometry:Ei(D,l,h),patterns:{},sortKey:U};g.push(H)}f&&g.sort((D,I)=>D.sortKey-I.sortKey);const{lineAtlas:v,featureIndex:w}=o,E=this.addConstantDashes(v);for(const D of g){const{geometry:I,index:P,sourceLayerIndex:L}=D;if(E&&this.addFeatureDashes(D,v),this.hasPattern){const N=Ty("line",this.layers,D,this.zoom,o);this.patternFeatures.push(N)}else this.addFeature(D,I,P,l,v.positions,o.availableImages,o.brightness);w.insert(t[P].feature,I,P,L,this.index)}}addConstantDashes(t){let o=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==f.kind)o=!0;else{const g=f.value,v=h.value;if(!v)continue;t.addDash(v,g)}}return o}addFeatureDashes(t,o){const l=this.zoom;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===g.kind)continue;let v,w;if("constant"===f.kind){if(v=f.value,!v)continue}else v=f.evaluate({zoom:l},t);w="constant"===g.kind?g.value:g.evaluate({zoom:l},t),o.addDash(v,w),t.patterns[h.id]=o.getKey(v,w)}}update(t,o,l,h,f){const g=0!==Object.keys(t).length;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,o,g?this.stateDependentLayers:this.layers,l,h,f)}addFeatures(t,o,l,h,f,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,o,l,h,g)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Mg)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Tx),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,o,l,h,f,g,v){const w=this.layers[0].layout,E=w.get("line-join").evaluate(t,{}),D=w.get("line-cap").evaluate(t,{}),I=w.get("line-miter-limit"),P=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const L of o)this.addLine(L,t,E,D,I,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,f,g,h,v)}addLine(t,o,l,h,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let H=0;H<t.length-1;H++)this.totalDistance+=t[H].dist(t[H+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v="Polygon"===Ix[o.type];let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let E=0;for(;E<w-1&&t[E].equals(t[E+1]);)E++;if(w<(v?3:2))return;"bevel"===l&&(f=1.05);const D=this.overscaling<=16?15*gt/(512*this.overscaling):0,I=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let P,L,N,B,U;this.e1=this.e2=-1,v&&(P=t[w-2],U=t[E].sub(P)._unit()._perp());for(let H=E;H<w;H++){if(N=H===w-1?v?t[E+1]:void 0:t[H+1],N&&t[H].equals(N))continue;U&&(B=U),P&&(L=P),P=t[H],U=N?N.sub(P)._unit()._perp():B,B=B||U;let Q=B.add(U);0===Q.x&&0===Q.y||Q._unit();const ne=B.x*U.x+B.y*U.y,ie=Q.x*U.x+Q.y*U.y,ue=0!==ie?1/ie:1/0,ae=2*Math.sqrt(2-2*ie),de=ie<jw&&L&&N,ye=B.x*U.y-B.y*U.x>0;if(de&&H>E){const we=P.dist(L);if(we>2*D){const Oe=P.sub(P.sub(L)._mult(D/we)._round());this.updateDistance(L,Oe),this.addCurrentVertex(Oe,B,0,0,I),L=Oe}}const be=L&&N;let Te=be?l:v?"butt":h;if(be&&"round"===Te&&(ue<g?Te="miter":ue<=2&&(Te="fakeround")),"miter"===Te&&ue>f&&(Te="bevel"),"bevel"===Te&&(ue>2&&(Te="flipbevel"),ue<f&&(Te="miter")),L&&this.updateDistance(L,P),"miter"===Te)Q._mult(ue),this.addCurrentVertex(P,Q,0,0,I);else if("flipbevel"===Te){if(ue>100)Q=U.mult(-1);else{const we=ue*B.add(U).mag()/B.sub(U).mag();Q._perp()._mult(we*(ye?-1:1))}this.addCurrentVertex(P,Q,0,0,I),this.addCurrentVertex(P,Q.mult(-1),0,0,I)}else if("bevel"===Te||"fakeround"===Te){const we=-Math.sqrt(ue*ue-1),Oe=ye?we:0,Ge=ye?0:we;if(L&&this.addCurrentVertex(P,B,Oe,Ge,I),"fakeround"===Te){const Re=Math.round(180*ae/Math.PI/20);for(let Ve=1;Ve<Re;Ve++){let Ie=Ve/Re;if(.5!==Ie){const lt=Ie-.5;Ie+=Ie*lt*(Ie-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*lt*lt+(.848013+ne*(.215638*ne-1.06021)))}const je=U.sub(B)._mult(Ie)._add(B)._unit()._mult(ye?-1:1);this.addHalfVertex(P,je.x,je.y,!1,ye,0,I)}}N&&this.addCurrentVertex(P,U,-Oe,-Ge,I)}else if("butt"===Te)this.addCurrentVertex(P,Q,0,0,I);else if("square"===Te){const we=L?1:-1;L||this.addCurrentVertex(P,Q,we,we,I),this.addCurrentVertex(P,Q,0,0,I),L&&this.addCurrentVertex(P,Q,we,we,I)}else"round"===Te&&(L&&(this.addCurrentVertex(P,B,0,0,I),this.addCurrentVertex(P,B,1,1,I,!0)),N&&(this.addCurrentVertex(P,U,-1,-1,I,!0),this.addCurrentVertex(P,U,0,0,I)));if(de&&H<w-1){const we=P.dist(N);if(we>2*D){const Oe=P.add(N.sub(P)._mult(D/we)._round());this.updateDistance(P,Oe),this.addCurrentVertex(Oe,U,0,0,I),P=Oe}}}}addCurrentVertex(t,o,l,h,f,g=!1){const v=o.y*h-o.x,w=-o.y-o.x*h;this.addHalfVertex(t,o.x+o.y*l,o.y-o.x*l,g,!1,l,f),this.addHalfVertex(t,v,w,g,!0,-h,f)}addHalfVertex({x:t,y:o},l,h,f,g,v,w){this.layoutVertexArray.emplaceBack((t<<1)+(f?1:0),(o<<1)+(g?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(0===v?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),g?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,o){this.distance+=t.dist(o),this.updateScaledDistance()}}Ct(Ig,"LineBucket",{omit:["layers","patternFeatures"]});const gT=new Xi({"line-cap":new Vt(Ce.layout_line["line-cap"]),"line-join":new Vt(Ce.layout_line["line-join"]),"line-miter-limit":new nt(Ce.layout_line["line-miter-limit"]),"line-round-limit":new nt(Ce.layout_line["line-round-limit"]),"line-sort-key":new Vt(Ce.layout_line["line-sort-key"]),visibility:new nt(Ce.layout_line.visibility)});var Sx={paint:new Xi({"line-opacity":new Vt(Ce.paint_line["line-opacity"]),"line-color":new Vt(Ce.paint_line["line-color"]),"line-translate":new nt(Ce.paint_line["line-translate"]),"line-translate-anchor":new nt(Ce.paint_line["line-translate-anchor"]),"line-width":new Vt(Ce.paint_line["line-width"]),"line-gap-width":new Vt(Ce.paint_line["line-gap-width"]),"line-offset":new Vt(Ce.paint_line["line-offset"]),"line-blur":new Vt(Ce.paint_line["line-blur"]),"line-dasharray":new Vt(Ce.paint_line["line-dasharray"]),"line-pattern":new Vt(Ce.paint_line["line-pattern"]),"line-gradient":new Oa(Ce.paint_line["line-gradient"]),"line-trim-offset":new nt(Ce.paint_line["line-trim-offset"]),"line-emissive-strength":new nt(Ce.paint_line["line-emissive-strength"]),"line-border-width":new Vt(Ce.paint_line["line-border-width"]),"line-border-color":new Vt(Ce.paint_line["line-border-color"])}),layout:gT};function gh(n,t,o){return t*(gt/(n.tileSize*Math.pow(2,o-n.tileID.overscaledZ)))}function Ax(n,t){return 1/gh(n,1,t.tileZoom)}function _h(n,t,o,l){return n.translatePosMatrix(l||t.tileID.projMatrix,t,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const Bo=n=>{const t=[];Rx(n)&&t.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const o=n.paint.get("line-trim-offset");return 0===o[0]&&0===o[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==n.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER"),t};function Rx(n){const t=n.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Ny=new class extends Vt{possiblyEvaluate(n,t){return t=new Mi(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(n,t)}evaluate(n,t,o,l){return t=Vr({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(n,t,o,l)}}(Sx.paint.properties["line-width"].specification);function Fp(n,t){return t>0?t+2*n:n}Ny.useIntegerZoom=!0;const Uw=ei([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$w=ei([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Kd=ei([{name:"a_projected_pos",components:4,type:"Float32"}],4);ei([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Gw=ei([{name:"a_z_offset",components:1,type:"Float32"}],4),zy=ei([{name:"a_texb",components:2,type:"Uint16"}]),_T=ei([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),By=ei([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Vy=ei([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Hw=ei([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ei([{name:"triangle",components:3,type:"Uint16"}]),ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ei([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),ei([{type:"Float32",name:"offsetX"}]),ei([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ro=24;const _a=128;function jy(n,t){const{expression:o}=t;if("constant"===o.kind)return{kind:"constant",layoutSize:o.evaluate(new Mi(n+1))};if("source"===o.kind)return{kind:"source"};{const{zoomStops:l,interpolationType:h}=o;let f=0;for(;f<l.length&&l[f]<=n;)f++;f=Math.max(0,f-1);let g=f;for(;g<l.length&&l[g]<n+1;)g++;g=Math.min(l.length-1,g);const v=l[f],w=l[g];return"composite"===o.kind?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:w,minSize:o.evaluate(new Mi(v)),maxSize:o.evaluate(new Mi(w)),interpolationType:h}}}function Np(n,{uSize:t,uSizeT:o},{lowerSize:l,upperSize:h}){return"source"===n.kind?l/_a:"composite"===n.kind?rn(l/_a,h/_a,o):t}function Jd(n,t){let o=0,l=0;if("constant"===n.kind)l=n.layoutSize;else if("source"!==n.kind){const{interpolationType:h,minZoom:f,maxZoom:g}=n,v=h?on(or.interpolationFactor(h,t,f,g),0,1):0;"camera"===n.kind?l=rn(n.minSize,n.maxSize,v):o=v}return{uSizeT:o,uSize:l}}var qw=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:_a,evaluateSizeForFeature:Np,evaluateSizeForZoom:Jd,getSizeData:jy});function yT(n,t,o){return n.sections.forEach(l=>{l.text=function(h,f,g){const v=f.layout.get("text-transform").evaluate(g,{});return"uppercase"===v?h=h.toLocaleUpperCase():"lowercase"===v&&(h=h.toLocaleLowerCase()),Kr.applyArabicShaping&&(h=Kr.applyArabicShaping(h)),h}(l.text,t,o)}),n}const Qd={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Px(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function uo(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}var Ox={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(n,t,o,l,h){var f,g,v=8*h-l-1,w=(1<<v)-1,E=w>>1,D=-7,I=o?h-1:0,P=o?-1:1,L=n[t+I];for(I+=P,f=L&(1<<-D)-1,L>>=-D,D+=v;D>0;f=256*f+n[t+I],I+=P,D-=8);for(g=f&(1<<-D)-1,f>>=-D,D+=l;D>0;g=256*g+n[t+I],I+=P,D-=8);if(0===f)f=1-E;else{if(f===w)return g?NaN:1/0*(L?-1:1);g+=Math.pow(2,l),f-=E}return(L?-1:1)*g*Math.pow(2,f-l)},write:function(n,t,o,l,h,f){var g,v,w,E=8*f-h-1,D=(1<<E)-1,I=D>>1,P=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,L=l?0:f-1,N=l?1:-1,B=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,g=D):(g=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-g))<1&&(g--,w*=2),(t+=g+I>=1?P/w:P*Math.pow(2,1-I))*w>=2&&(g++,w/=2),g+I>=D?(v=0,g=D):g+I>=1?(v=(t*w-1)*Math.pow(2,h),g+=I):(v=t*Math.pow(2,I-1)*Math.pow(2,h),g=0));h>=8;n[o+L]=255&v,L+=N,v/=256,h-=8);for(g=g<<h|v,E+=h;E>0;n[o+L]=255&g,L+=N,g/=256,E-=8);n[o+L-N]|=128*B}},Zw=ui,ef=Ox;function ui(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}ui.Varint=0,ui.Fixed64=1,ui.Bytes=2,ui.Fixed32=5;var zp=4294967296,kx=1/zp,Ww=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function lc(n){return n.type===ui.Bytes?n.readVarint()+n.pos:n.pos+1}function oo(n,t,o){var l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));o.realloc(l);for(var h=o.pos-1;h>=n;h--)o.buf[h+l]=o.buf[h]}function Lx(n,t){for(var o=0;o<n.length;o++)t.writeVarint(n[o])}function Yw(n,t){for(var o=0;o<n.length;o++)t.writeSVarint(n[o])}function vT(n,t){for(var o=0;o<n.length;o++)t.writeFloat(n[o])}function hi(n,t){for(var o=0;o<n.length;o++)t.writeDouble(n[o])}function Xw(n,t){for(var o=0;o<n.length;o++)t.writeBoolean(n[o])}function Uy(n,t){for(var o=0;o<n.length;o++)t.writeFixed32(n[o])}function Kw(n,t){for(var o=0;o<n.length;o++)t.writeSFixed32(n[o])}function Jw(n,t){for(var o=0;o<n.length;o++)t.writeFixed64(n[o])}function $y(n,t){for(var o=0;o<n.length;o++)t.writeSFixed64(n[o])}function Bp(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function yh(n,t,o){n[o]=t,n[o+1]=t>>>8,n[o+2]=t>>>16,n[o+3]=t>>>24}function Fx(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}ui.prototype={destroy:function(){this.buf=null},readFields:function(n,t,o){for(o=o||this.length;this.pos<o;){var l=this.readVarint(),h=l>>3,f=this.pos;this.type=7&l,n(h,t,this),this.pos===f&&this.skip(l)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=Bp(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Fx(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Bp(this.buf,this.pos)+Bp(this.buf,this.pos+4)*zp;return this.pos+=8,n},readSFixed64:function(){var n=Bp(this.buf,this.pos)+Fx(this.buf,this.pos+4)*zp;return this.pos+=8,n},readFloat:function(){var n=ef.read(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=ef.read(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,o,l=this.buf;return t=127&(o=l[this.pos++]),o<128?t:(t|=(127&(o=l[this.pos++]))<<7,o<128?t:(t|=(127&(o=l[this.pos++]))<<14,o<128?t:(t|=(127&(o=l[this.pos++]))<<21,o<128?t:function(h,f,g){var v,w,E=g.buf;if(v=(112&(w=E[g.pos++]))>>4,w<128||(v|=(127&(w=E[g.pos++]))<<3,w<128)||(v|=(127&(w=E[g.pos++]))<<10,w<128)||(v|=(127&(w=E[g.pos++]))<<17,w<128)||(v|=(127&(w=E[g.pos++]))<<24,w<128)||(v|=(1&(w=E[g.pos++]))<<31,w<128))return function Qc(n,t,o){return o?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}(h,v,f);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(o=l[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&Ww?Ww.decode(this.buf.subarray(t,n)):function(o,l,h){for(var f="",g=l;g<h;){var v,w,E,D=o[g],I=null,P=D>239?4:D>223?3:D>191?2:1;if(g+P>h)break;1===P?D<128&&(I=D):2===P?128==(192&(v=o[g+1]))&&(I=(31&D)<<6|63&v)<=127&&(I=null):3===P?(w=o[g+2],128==(192&(v=o[g+1]))&&128==(192&w)&&((I=(15&D)<<12|(63&v)<<6|63&w)<=2047||I>=55296&&I<=57343)&&(I=null)):4===P&&(w=o[g+2],E=o[g+3],128==(192&(v=o[g+1]))&&128==(192&w)&&128==(192&E)&&((I=(15&D)<<18|(63&v)<<12|(63&w)<<6|63&E)<=65535||I>=1114112)&&(I=null)),null===I?(I=65533,P=1):I>65535&&(I-=65536,f+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),f+=String.fromCharCode(I),g+=P}return f}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==ui.Bytes)return n.push(this.readVarint(t));var o=lc(this);for(n=n||[];this.pos<o;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==ui.Bytes)return n.push(this.readSVarint());var t=lc(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==ui.Bytes)return n.push(this.readBoolean());var t=lc(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==ui.Bytes)return n.push(this.readFloat());var t=lc(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==ui.Bytes)return n.push(this.readDouble());var t=lc(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==ui.Bytes)return n.push(this.readFixed32());var t=lc(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==ui.Bytes)return n.push(this.readSFixed32());var t=lc(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==ui.Bytes)return n.push(this.readFixed64());var t=lc(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==ui.Bytes)return n.push(this.readSFixed64());var t=lc(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===ui.Varint)for(;this.buf[this.pos++]>127;);else if(t===ui.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ui.Fixed32)this.pos+=4;else{if(t!==ui.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var o=new Uint8Array(t);o.set(this.buf),this.buf=o,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),yh(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),yh(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),yh(this.buf,-1&n,this.pos),yh(this.buf,Math.floor(n*kx),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),yh(this.buf,-1&n,this.pos),yh(this.buf,Math.floor(n*kx),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,o){var l,h,f,v;if(t>=0?(l=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(l=~(-t%4294967296))?l=l+1|0:(l=0,h=h+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),f=l,(v=o).buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,v.buf[v.pos]=127&(f>>>=7),function(f,g){var v=(7&f)<<4;g.buf[g.pos++]|=v|((f>>>=3)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f)))))}(h,o)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(l,h,f){for(var g,v,w=0;w<h.length;w++){if((g=h.charCodeAt(w))>55295&&g<57344){if(!v){g>56319||w+1===h.length?(l[f++]=239,l[f++]=191,l[f++]=189):v=g;continue}if(g<56320){l[f++]=239,l[f++]=191,l[f++]=189,v=g;continue}g=v-55296<<10|g-56320|65536,v=null}else v&&(l[f++]=239,l[f++]=191,l[f++]=189,v=null);g<128?l[f++]=g:(g<2048?l[f++]=g>>6|192:(g<65536?l[f++]=g>>12|224:(l[f++]=g>>18|240,l[f++]=g>>12&63|128),l[f++]=g>>6&63|128),l[f++]=63&g|128)}return f}(this.buf,n,this.pos);var o=this.pos-t;o>=128&&oo(t,o,this),this.pos=t-1,this.writeVarint(o),this.pos+=o},writeFloat:function(n){this.realloc(4),ef.write(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),ef.write(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var o=0;o<t;o++)this.buf[this.pos++]=n[o]},writeRawMessage:function(n,t){this.pos++;var o=this.pos;n(t,this);var l=this.pos-o;l>=128&&oo(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeMessage:function(n,t,o){this.writeTag(n,ui.Bytes),this.writeRawMessage(t,o)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,Lx,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,Yw,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,Xw,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,vT,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,hi,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,Uy,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,Kw,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,Jw,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,$y,t)},writeBytesField:function(n,t){this.writeTag(n,ui.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,ui.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,ui.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,ui.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,ui.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,ui.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,ui.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,ui.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,ui.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,ui.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var vh=$o(Zw);const Sg=3;function Qw(n,t,o){t.glyphs=[],1===n&&o.readMessage(eE,t)}function eE(n,t,o){if(3===n){const{id:l,bitmap:h,width:f,height:g,left:v,top:w,advance:E}=o.readMessage(tE,{});t.glyphs.push({id:l,bitmap:new Jo({width:f+2*Sg,height:g+2*Sg},h),metrics:{width:f,height:g,left:v,top:w,advance:E}})}else 4===n?t.ascender=o.readSVarint():5===n&&(t.descender=o.readSVarint())}function tE(n,t,o){1===n?t.id=o.readVarint():2===n?t.bitmap=o.readBytes():3===n?t.width=o.readVarint():4===n?t.height=o.readVarint():5===n?t.left=o.readSVarint():6===n?t.top=o.readSVarint():7===n&&(t.advance=o.readVarint())}const Gy=Sg,ho={horizontal:1,vertical:2,horizontalOnly:3};class Gs{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,o){const l=new Gs;return l.scale=t||1,l.fontStack=o,l}static forImage(t){const o=new Gs;return o.imageName=t,o}}class $a{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,o){const l=new $a;for(let h=0;h<t.sections.length;h++){const f=t.sections[h];f.image?l.addImageSection(f):l.addTextSection(f,o)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(o,l){let h="";for(let f=0;f<o.length;f++){const g=o.charCodeAt(f+1)||null,v=o.charCodeAt(f-1)||null;h+=!l&&(g&&Ur(g)&&!Qd[o[f+1]]||v&&Ur(v)&&!Qd[o[f-1]])||!Qd[o[f]]?o[f]:Qd[o[f]]}return h}(this.text,t)}trim(){let t=0;for(let l=0;l<this.text.length&&Ag[this.text.charCodeAt(l)];l++)t++;let o=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&Ag[this.text.charCodeAt(l)];l--)o--;this.text=this.text.substring(t,o),this.sectionIndex=this.sectionIndex.slice(t,o)}substring(t,o){const l=new $a;return l.text=this.text.substring(t,o),l.sectionIndex=this.sectionIndex.slice(t,o),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,o)=>Math.max(t,this.sections[o].scale),0)}addTextSection(t,o){this.text+=t.text,this.sections.push(Gs.forText(t.scale,t.fontStack||o));const l=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(l)}addImageSection(t){const o=t.image?t.image.namePrimary:"";if(0===o.length)return void tr("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCodePoint(l),this.sections.push(Gs.forImage(o)),this.sectionIndex.push(this.sections.length-1)):tr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Hy(n,t,o,l,h,f,g,v,w,E,D,I,P,L,N){const B=$a.fromFeature(n,h);I===ho.vertical&&B.verticalizePunctuation(P);let U=[];const H=function(ae,de,ye,be,Te,we){if(!ae)return[];const Oe=[],Ge=function(je,lt,Be,yt,dt,Ze){let qt=0;for(let Ft=0;Ft<je.length();Ft++){const Tt=je.getSection(Ft);qt+=qy(je.getCodePoint(Ft),Tt,yt,dt,lt,Ze)}return qt/Math.max(1,Math.ceil(qt/Be))}(ae,de,ye,be,Te,we),Re=ae.text.indexOf("\u200b")>=0;let Ve=0;for(let je=0;je<ae.length();je++){const lt=ae.getSection(je),Be=ae.getCodePoint(je);if(Ag[Be]||(Ve+=qy(Be,lt,be,Te,de,we)),je<ae.length()-1){const yt=!((Ie=Be)<11904||!(At["Bopomofo Extended"](Ie)||At.Bopomofo(Ie)||At["CJK Compatibility Forms"](Ie)||At["CJK Compatibility Ideographs"](Ie)||At["CJK Compatibility"](Ie)||At["CJK Radicals Supplement"](Ie)||At["CJK Strokes"](Ie)||At["CJK Symbols and Punctuation"](Ie)||At["CJK Unified Ideographs Extension A"](Ie)||At["CJK Unified Ideographs"](Ie)||At["Enclosed CJK Letters and Months"](Ie)||At["Halfwidth and Fullwidth Forms"](Ie)||At.Hiragana(Ie)||At["Ideographic Description Characters"](Ie)||At["Kangxi Radicals"](Ie)||At["Katakana Phonetic Extensions"](Ie)||At.Katakana(Ie)||At["Vertical Forms"](Ie)||At["Yi Radicals"](Ie)||At["Yi Syllables"](Ie)));(Nx[Be]||yt||lt.imageName)&&Oe.push(jp(je+1,Ve,Ge,Oe,Vp(Be,ae.getCodePoint(je+1),yt&&Re),!1))}}var Ie;return Zy(jp(ae.length(),Ve,Ge,Oe,0,!0))}(B,E,f,t,l,L),{processBidirectionalText:Q,processStyledBidirectionalText:ne}=Kr;if(Q&&1===B.sections.length){const ae=Q(B.toString(),H);for(const de of ae){const ye=new $a;ye.text=de,ye.sections=B.sections;for(let be=0;be<de.length;be++)ye.sectionIndex.push(0);U.push(ye)}}else if(ne){const ae=ne(B.text,B.sectionIndex,H);for(const de of ae){const ye=new $a;ye.text=de[0],ye.sectionIndex=de[1],ye.sections=B.sections,U.push(ye)}}else U=function(ae,de){const ye=[],be=ae.text;let Te=0;for(const we of de)ye.push(ae.substring(Te,we)),Te=we;return Te<be.length&&ye.push(ae.substring(Te,be.length)),ye}(B,H);const ie=[],ue={positionedLines:ie,text:B.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ae,de,ye,be,Te,we,Oe,Ge,Re,Ve,Ie,je){let lt=0,Be=0,yt=0;const dt="right"===Ge?1:"left"===Ge?0:.5;let Ze=!1;for(const un of Te){const Ht=un.getSections();for(const dn of Ht){if(dn.imageName)continue;const Jt=de[dn.fontStack];if(Jt&&(Ze=void 0!==Jt.ascender&&void 0!==Jt.descender,!Ze))break}if(!Ze)break}let qt=0;for(const un of Te){un.trim();const Ht=un.getMaxScale(),dn=(Ht-1)*ro,Jt={positionedGlyphs:[],lineOffset:0};ae.positionedLines[qt]=Jt;const Pn=Jt.positionedGlyphs;let sn=0;if(!un.length()){Be+=we,++qt;continue}let _i=0,Vn=0;for(let Jn=0;Jn<un.length();Jn++){const jn=un.getSection(Jn),St=un.getSectionIndex(Jn),oi=un.getCodePoint(Jn);let nr=jn.scale,wr=null,Ar=null,Ci=null,ji=ro,Rr=0;const Pr=!(Re===ho.horizontal||!Ie&&!Sm(oi)||Ie&&(Ag[oi]||(Ft=oi,At.Arabic(Ft)||At["Arabic Supplement"](Ft)||At["Arabic Extended-A"](Ft)||At["Arabic Presentation Forms-A"](Ft)||At["Arabic Presentation Forms-B"](Ft))));if(jn.imageName){const Or=be[jn.imageName];if(!Or)continue;Ci=jn.imageName,ae.iconsInText=ae.iconsInText||!0,Ar=Or.paddedRect;const Ii=Or.displaySize;nr=nr*ro/je,wr={width:Ii[0],height:Ii[1],left:0,top:-Gy,advance:Pr?Ii[1]:Ii[0],localGlyph:!1},Rr=Ze?-wr.height*nr:Ht*ro-17-Ii[1]*nr,ji=wr.advance;const es=(Pr?Ii[0]:Ii[1])*nr-ro*Ht;es>0&&es>sn&&(sn=es)}else{const Or=ye[jn.fontStack];if(!Or)continue;Or[oi]&&(Ar=Or[oi]);const Ii=de[jn.fontStack];if(!Ii)continue;const es=Ii.glyphs[oi];if(!es)continue;if(wr=es.metrics,ji=8203!==oi?ro:0,Ze){const mc=void 0!==Ii.ascender?Math.abs(Ii.ascender):0,To=void 0!==Ii.descender?Math.abs(Ii.descender):0,Mo=(mc+To)*nr;_i<Mo&&(_i=Mo,Vn=(mc-To)/2*nr),Rr=-mc*nr}else Rr=(Ht-nr)*ro-17}Pr?(ae.verticalizable=!0,Pn.push({glyph:oi,imageName:Ci,x:lt,y:Be+Rr,vertical:Pr,scale:nr,localGlyph:wr.localGlyph,fontStack:jn.fontStack,sectionIndex:St,metrics:wr,rect:Ar}),lt+=ji*nr+Ve):(Pn.push({glyph:oi,imageName:Ci,x:lt,y:Be+Rr,vertical:Pr,scale:nr,localGlyph:wr.localGlyph,fontStack:jn.fontStack,sectionIndex:St,metrics:wr,rect:Ar}),lt+=wr.advance*nr+Ve)}0!==Pn.length&&(yt=Math.max(lt-Ve,yt),Ze?zx(Pn,dt,sn,Vn,we*Ht/2):zx(Pn,dt,sn,0,we/2)),lt=0;const Fn=we*Ht+sn;Jt.lineOffset=Math.max(sn,dn),Be+=Fn,++qt}var Ft;const Tt=Be,{horizontalAlign:We,verticalAlign:jt}=Pg(Oe);(function(un,Ht,dn,Jt,Pn,sn){const _i=(Ht-dn)*Pn,Vn=-sn*Jt;for(const Fn of un)for(const Jn of Fn.positionedGlyphs)Jn.x+=_i,Jn.y+=Vn})(ae.positionedLines,dt,We,jt,yt,Tt),ae.top+=-jt*Tt,ae.bottom=ae.top+Tt,ae.left+=-We*yt,ae.right=ae.left+yt,ae.hasBaseline=Ze}(ue,t,o,l,U,g,v,w,I,E,P,N),!function(ae){for(const de of ae)if(0!==de.positionedGlyphs.length)return!1;return!0}(ie)&&ue}const Ag={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Nx={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function qy(n,t,o,l,h,f){if(t.imageName){const g=l[t.imageName];return g?g.displaySize[0]*t.scale*ro/f+h:0}{const g=o[t.fontStack],v=g&&g.glyphs[n];return v?v.metrics.advance*t.scale+h:0}}function Rg(n,t,o,l){const h=Math.pow(n-t,2);return l?n<t?h/2:2*h:h+Math.abs(o)*o}function Vp(n,t,o){let l=0;return 10===n&&(l-=1e4),o&&(l+=150),40!==n&&65288!==n||(l+=50),41!==t&&65289!==t||(l+=50),l}function jp(n,t,o,l,h,f){let g=null,v=Rg(t,o,h,f);for(const w of l){const E=Rg(t-w.x,o,h,f)+w.badness;E<=v&&(g=w,v=E)}return{index:n,x:t,priorBreak:g,badness:v}}function Zy(n){return n?Zy(n.priorBreak).concat(n.index):[]}function Pg(n){let t=.5,o=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:t,verticalAlign:o}}function zx(n,t,o,l,h){if(!(t||o||l||h))return;const f=n.length-1,g=n[f],v=(g.x+g.metrics.advance*g.scale)*t;for(let w=0;w<=f;w++)n[w].x-=v,n[w].y+=o+l+h}function nE(n,t,o,l){const{horizontalAlign:h,verticalAlign:f}=Pg(l),g=o[0]-n.displaySize[0]*h,v=o[1]-n.displaySize[1]*f;return{imagePrimary:n,imageSecondary:t,top:v,bottom:v+n.displaySize[1],left:g,right:g+n.displaySize[0]}}function Bx(n,t,o,l,h,f){const g=n.imagePrimary;let v;if(g.content){const U=g.content,H=g.pixelRatio||1;v=[U[0]/H,U[1]/H,g.displaySize[0]-U[2]/H,g.displaySize[1]-U[3]/H]}const w=t.left*f,E=t.right*f;let D,I,P,L;"width"===o||"both"===o?(L=h[0]+w-l[3],I=h[0]+E+l[1]):(L=h[0]+(w+E-g.displaySize[0])/2,I=L+g.displaySize[0]);const N=t.top*f,B=t.bottom*f;return"height"===o||"both"===o?(D=h[1]+N-l[0],P=h[1]+B+l[2]):(D=h[1]+(N+B-g.displaySize[1])/2,P=D+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:D,right:I,bottom:P,left:L,collisionPadding:v}}class cc extends ht{constructor(t,o,l,h,f){super(t,o),this.angle=h,this.z=l,void 0!==f&&(this.segment=f)}clone(){return new cc(this.x,this.y,this.z,this.angle,this.segment)}}function Wy(n,t,o,l,h){if(void 0===t.segment)return!0;let f=t,g=t.segment+1,v=0;for(;v>-o/2;){if(g--,g<0)return!1;v-=n[g].dist(f),f=n[g]}v+=n[g].dist(n[g+1]),g++;const w=[];let E=0;for(;v<o/2;){const D=n[g],I=n[g+1];if(!I)return!1;let P=n[g-1].angleTo(D)-D.angleTo(I);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:P}),E+=P;v-w[0].distance>l;)E-=w.shift().angleDelta;if(E>h)return!1;g++,v+=D.dist(I)}return!0}function iE(n){let t=0;for(let o=0;o<n.length-1;o++)t+=n[o].dist(n[o+1]);return t}function Vx(n,t,o){return n?.6*t*o:0}function rE(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function xT(n,t,o,l,h,f){const g=Vx(o,h,f),v=rE(o,l)*f;let w=0;const E=iE(n)/2;for(let D=0;D<n.length-1;D++){const I=n[D],P=n[D+1],L=I.dist(P);if(w+L>E){const N=(E-w)/L,B=rn(I.x,P.x,N),U=rn(I.y,P.y,N),H=new cc(B,U,0,P.angleTo(I),D);return!g||Wy(n,H,v,g,t)?H:void 0}w+=L}}function jx(n,t,o,l,h,f,g,v,w){const E=Vx(l,f,g),D=rE(l,h),I=D*g,P=0===n[0].x||n[0].x===w||0===n[0].y||n[0].y===w;return t-I<t/4&&(t=I+t/4),Yy(n,P?t/2*v%t:(D/2+2*f)*g*v%t,t,E,o,I,P,!1,w)}function Yy(n,t,o,l,h,f,g,v,w){const E=f/2,D=iE(n);let I=0,P=t-o,L=[];for(let N=0;N<n.length-1;N++){const B=n[N],U=n[N+1],H=B.dist(U),Q=U.angleTo(B);for(;P+o<I+H;){P+=o;const ne=(P-I)/H,ie=rn(B.x,U.x,ne),ue=rn(B.y,U.y,ne);if(ie>=0&&ie<w&&ue>=0&&ue<w&&P-E>=0&&P+E<=D){const ae=new cc(ie,ue,0,Q,N);l&&!Wy(n,ae,f,l,h)||L.push(ae)}}I+=H}return v||L.length||g||(L=Yy(n,I/2,o,l,h,f,g,!0,w)),L}function oE(n,t,o,l,h){const f=[];for(let g=0;g<n.length;g++){const v=n[g];let w;for(let E=0;E<v.length-1;E++){let D=v[E],I=v[E+1];D.x<t&&I.x<t||(D.x<t?D=new ht(t,D.y+(t-D.x)/(I.x-D.x)*(I.y-D.y))._round():I.x<t&&(I=new ht(t,D.y+(t-D.x)/(I.x-D.x)*(I.y-D.y))._round()),D.y<o&&I.y<o||(D.y<o?D=new ht(D.x+(o-D.y)/(I.y-D.y)*(I.x-D.x),o)._round():I.y<o&&(I=new ht(D.x+(o-D.y)/(I.y-D.y)*(I.x-D.x),o)._round()),D.x>=l&&I.x>=l||(D.x>=l?D=new ht(l,D.y+(l-D.x)/(I.x-D.x)*(I.y-D.y))._round():I.x>=l&&(I=new ht(l,D.y+(l-D.x)/(I.x-D.x)*(I.y-D.y))._round()),D.y>=h&&I.y>=h||(D.y>=h?D=new ht(D.x+(h-D.y)/(I.y-D.y)*(I.x-D.x),h)._round():I.y>=h&&(I=new ht(D.x+(h-D.y)/(I.y-D.y)*(I.x-D.x),h)._round()),w&&D.equals(w[w.length-1])||(w=[D],f.push(w)),w.push(I)))))}}return f}function Up(n){let t=0,o=0;for(const g of n)t+=g.w*g.h,o=Math.max(o,g.w);n.sort((g,v)=>v.h-g.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),o),h:1/0}];let h=0,f=0;for(const g of n)for(let v=l.length-1;v>=0;v--){const w=l[v];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,f=Math.max(f,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===w.w&&g.h===w.h){const E=l.pop();v<l.length&&(l[v]=E)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(l.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:h,h:f,fill:t/(h*f)||0}}Ct(cc,"Anchor");const Qo=1;class Og{constructor(t,{pixelRatio:o,version:l,stretchX:h,stretchY:f,content:g}){this.paddedRect=t,this.pixelRatio=o,this.stretchX=h,this.stretchY=f,this.content=g,this.version=l}get tl(){return[this.paddedRect.x+Qo,this.paddedRect.y+Qo]}get br(){return[this.paddedRect.x+this.paddedRect.w-Qo,this.paddedRect.y+this.paddedRect.h-Qo]}get displaySize(){return[(this.paddedRect.w-2*Qo)/this.pixelRatio,(this.paddedRect.h-2*Qo)/this.pixelRatio]}}class Ux{constructor(t,o){const l={},h={};this.haveRenderCallbacks=[];const f=[];this.addImages(t,l,f),this.addImages(o,h,f);const{w:g,h:v}=Up(f),w=new wo({width:g||1,height:v||1});for(const E in t){const D=t[E],I=l[E].paddedRect;wo.copy(D.data,w,{x:0,y:0},{x:I.x+Qo,y:I.y+Qo},D.data,D.sdf)}for(const E in o){const D=o[E],I=h[E].paddedRect,P=I.x+Qo,L=I.y+Qo,N=D.data.width,B=D.data.height;wo.copy(D.data,w,{x:0,y:0},{x:P,y:L},D.data),wo.copy(D.data,w,{x:0,y:B-1},{x:P,y:L-1},{width:N,height:1}),wo.copy(D.data,w,{x:0,y:0},{x:P,y:L+B},{width:N,height:1}),wo.copy(D.data,w,{x:N-1,y:0},{x:P-1,y:L},{width:1,height:B}),wo.copy(D.data,w,{x:0,y:0},{x:P+N,y:L},{width:1,height:B})}this.image=w,this.iconPositions=l,this.patternPositions=h}addImages(t,o,l){for(const h in t){const f=t[h],g={x:0,y:0,w:f.data.width+2*Qo,h:f.data.height+2*Qo};l.push(g),o[h]=new Og(g,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,o,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>t.hasImage(h,l)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const h in t.getUpdatedImages(l))this.patchUpdatedImage(this.iconPositions[h],t.getImage(h,l),o),this.patchUpdatedImage(this.patternPositions[h],t.getImage(h,l),o)}patchUpdatedImage(t,o,l){if(!t||!o||t.version===o.version)return;t.version=o.version;const[h,f]=t.tl,g=!!Object.keys(this.patternPositions).length;l.update(o.data,{useMipmap:g},{x:h,y:f})}}Ct(Og,"ImagePosition"),Ct(Ux,"ImageAtlas");const tf=1e20;function Xy(n,t,o,l,h,f,g,v,w){for(let E=t;E<t+l;E++)Zn(n,o*f+E,f,h,g,v,w);for(let E=o;E<o+h;E++)Zn(n,E*f+t,1,l,g,v,w)}function Zn(n,t,o,l,h,f,g){f[0]=0,g[0]=-tf,g[1]=tf,h[0]=n[t];for(let v=1,w=0,E=0;v<l;v++){h[v]=n[t+v*o];const D=v*v;do{const I=f[w];E=(h[v]-h[I]+D-I*I)/(v-I)/2}while(E<=g[w]&&--w>-1);w++,f[w]=v,g[w]=E,g[w+1]=tf}for(let v=0,w=0;v<l;v++){for(;g[w+1]<v;)w++;const E=f[w],D=v-E;n[t+v*o]=h[E]+D*D}}const Eo=2,kg={none:0,ideographs:1,all:2};class Pt{constructor(t,o,l){this.requestManager=t,this.localGlyphMode=o,this.localFontFamily=l,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,o){this.urls[o]=t}getGlyphs(t,o,l){const h=[],f=this.urls[o]||fn.GLYPHS_URL;for(const g in t)for(const v of t[g])h.push({stack:g,id:v});Di(h,({stack:g,id:v},w)=>{let E=this.entries[g];E||(E=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=E.glyphs[v];if(void 0!==D)return void w(null,{stack:g,id:v,glyph:D});if(D=this._tinySDF(E,g,v),D)return E.glyphs[v]=D,void w(null,{stack:g,id:v,glyph:D});const I=Math.floor(v/256);if(256*I>65535)return void w(new Error("glyphs > 65535 not supported"));if(E.ranges[I])return void w(null,{stack:g,id:v,glyph:D});let P=E.requests[I];P||(P=E.requests[I]=[],Pt.loadGlyphRange(g,I,f,this.requestManager,(L,N)=>{if(N){E.ascender=N.ascender,E.descender=N.descender;for(const B in N.glyphs)this._doesCharSupportLocalGlyph(+B)||(E.glyphs[+B]=N.glyphs[+B]);E.ranges[I]=!0}for(const B of P)B(L,N);delete E.requests[I]})),P.push((L,N)=>{L?w(L):N&&w(null,{stack:g,id:v,glyph:N.glyphs[v]||null})})},(g,v)=>{if(g)l(g);else if(v){const w={};for(const{stack:E,id:D,glyph:I}of v)void 0===w[E]&&(w[E]={}),void 0===w[E].glyphs&&(w[E].glyphs={}),w[E].glyphs[D]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},w[E].ascender=this.entries[E].ascender,w[E].descender=this.entries[E].descender;l(null,w)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==kg.none&&(this.localGlyphMode===kg.all?!!this.localFontFamily:!!this.localFontFamily&&(At["CJK Unified Ideographs"](t)||At["Hangul Syllables"](t)||At.Hiragana(t)||At.Katakana(t)||At["CJK Symbols and Punctuation"](t)||At["CJK Unified Ideographs Extension A"](t)||At["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,o,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let f=t.tinySDF;if(!f){let B="400";/bold/i.test(o)?B="900":/medium/i.test(o)?B="500":/light/i.test(o)&&(B="200"),f=t.tinySDF=new Pt.TinySDF({fontFamily:h,fontWeight:B,fontSize:24*Eo,buffer:3*Eo,radius:8*Eo}),f.fontWeight=B}if(this.localGlyphs[f.fontWeight][l])return this.localGlyphs[f.fontWeight][l];const g=String.fromCodePoint(l),{data:v,width:w,height:E,glyphWidth:D,glyphHeight:I,glyphLeft:P,glyphTop:L,glyphAdvance:N}=f.draw(g);return this.localGlyphs[f.fontWeight][l]={id:l,bitmap:new Jo({width:w,height:E},v),metrics:{width:D/Eo,height:I/Eo,left:P/Eo,top:L/Eo-27,advance:N/Eo,localGlyph:!0}}}}Pt.loadGlyphRange=function(n,t,o,l,h){const f=256*t,g=f+255,v=l.transformRequest(l.normalizeGlyphsURL(o).replace("{fontstack}",n).replace("{range}",`${f}-${g}`),mo.Glyphs);ze(v,(w,E)=>{if(w)h(w);else if(E){const D={},I=new vh(E).readFields(Qw,{});for(const P of I.glyphs)D[P.id]=P;h(null,{glyphs:D,ascender:I.ascender,descender:I.descender})}})},Pt.TinySDF=class{constructor({fontSize:n=24,buffer:t=3,radius:o=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=o;const v=this.size=n+4*t,w=this._createCanvas(v),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${g} ${f} ${n}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(n){const t=document.createElement("canvas");return t.width=t.height=n,t}draw(n){const{width:t,actualBoundingBoxAscent:o,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(n),g=Math.ceil(o),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-h))),w=Math.min(this.size-this.buffer,g+Math.ceil(l)),E=v+2*this.buffer,D=w+2*this.buffer,I=Math.max(E*D,0),P=new Uint8ClampedArray(I),L={data:P,width:E,height:D,glyphWidth:v,glyphHeight:w,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(0===v||0===w)return L;const{ctx:N,buffer:B,gridInner:U,gridOuter:H}=this;N.clearRect(B,B,v,w),N.fillText(n,B,B+g);const Q=N.getImageData(B,B,v,w);H.fill(tf,0,I),U.fill(0,0,I);for(let ne=0;ne<w;ne++)for(let ie=0;ie<v;ie++){const ue=Q.data[4*(ne*v+ie)+3]/255;if(0===ue)continue;const ae=(ne+B)*E+ie+B;if(1===ue)H[ae]=0,U[ae]=tf;else{const de=.5-ue;H[ae]=de>0?de*de:0,U[ae]=de<0?de*de:0}}Xy(H,0,0,E,D,E,this.f,this.v,this.z),Xy(U,B,B,v,w,E,this.f,this.v,this.z);for(let ne=0;ne<I;ne++){const ie=Math.sqrt(H[ne])-Math.sqrt(U[ne]);P[ne]=Math.round(255-255*(ie/this.radius+this.cutoff))}return L}};const El=Qo;function $x(n,t,o,l){const h=[],f=n.imagePrimary,g=f.pixelRatio,v=f.paddedRect.w-2*El,w=f.paddedRect.h-2*El,E=n.right-n.left,D=n.bottom-n.top,I=f.stretchX||[[0,v]],P=f.stretchY||[[0,w]],L=(we,Oe)=>we+Oe[1]-Oe[0],N=I.reduce(L,0),B=P.reduce(L,0),U=v-N,H=w-B;let Q=0,ne=N,ie=0,ue=B,ae=0,de=U,ye=0,be=H;if(f.content&&l){const we=f.content;Q=xh(I,0,we[0]),ie=xh(P,0,we[1]),ne=xh(I,we[0],we[2]),ue=xh(P,we[1],we[3]),ae=we[0]-Q,ye=we[1]-ie,de=we[2]-we[0]-ne,be=we[3]-we[1]-ue}const Te=(we,Oe,Ge,Re)=>{const Ve=nf(we.stretch-Q,ne,E,n.left),Ie=eu(we.fixed-ae,de,we.stretch,N),je=nf(Oe.stretch-ie,ue,D,n.top),lt=eu(Oe.fixed-ye,be,Oe.stretch,B),Be=nf(Ge.stretch-Q,ne,E,n.left),yt=eu(Ge.fixed-ae,de,Ge.stretch,N),dt=nf(Re.stretch-ie,ue,D,n.top),Ze=eu(Re.fixed-ye,be,Re.stretch,B),qt=new ht(Ve,je),Ft=new ht(Be,je),Tt=new ht(Be,dt),We=new ht(Ve,dt),jt=new ht(Ie/g,lt/g),un=new ht(yt/g,Ze/g),Ht=t*Math.PI/180;if(Ht){const Vn=Math.sin(Ht),Fn=Math.cos(Ht),Jn=[Fn,-Vn,Vn,Fn];qt._matMult(Jn),Ft._matMult(Jn),We._matMult(Jn),Tt._matMult(Jn)}const dn=we.stretch+we.fixed,Jt=Ge.stretch+Ge.fixed,Pn=Oe.stretch+Oe.fixed,sn=Re.stretch+Re.fixed,_i=n.imageSecondary;return{tl:qt,tr:Ft,bl:We,br:Tt,texPrimary:{x:f.paddedRect.x+El+dn,y:f.paddedRect.y+El+Pn,w:Jt-dn,h:sn-Pn},texSecondary:_i?{x:_i.paddedRect.x+El+dn,y:_i.paddedRect.y+El+Pn,w:Jt-dn,h:sn-Pn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:jt,pixelOffsetBR:un,minFontScaleX:de/g/E,minFontScaleY:be/g/D,isSDF:o}};if(l&&(f.stretchX||f.stretchY)){const we=bh(I,U,N),Oe=bh(P,H,B);for(let Ge=0;Ge<we.length-1;Ge++){const Re=we[Ge],Ve=we[Ge+1];for(let Ie=0;Ie<Oe.length-1;Ie++)h.push(Te(Re,Oe[Ie],Ve,Oe[Ie+1]))}}else h.push(Te({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return h}function xh(n,t,o){let l=0;for(const h of n)l+=Math.max(t,Math.min(o,h[1]))-Math.max(t,Math.min(o,h[0]));return l}function bh(n,t,o){const l=[{fixed:-El,stretch:0}];for(const[h,f]of n){const g=l[l.length-1];l.push({fixed:h-g.stretch,stretch:g.stretch}),l.push({fixed:h-g.stretch,stretch:g.stretch+(f-h)})}return l.push({fixed:t+El,stretch:o}),l}function nf(n,t,o,l){return n/t*o+l}function eu(n,t,o,l){return n-t*o/l}function Gx(n,t,o,l){const h=t+n.positionedLines[l].lineOffset;return 0===l?o+h/2:o+(h+(t+n.positionedLines[l-1].lineOffset))/2}function Ky(n,t=1,o=!1){let l=1/0,h=1/0,f=-1/0,g=-1/0;const v=n[0];for(let L=0;L<v.length;L++){const N=v[L];(!L||N.x<l)&&(l=N.x),(!L||N.y<h)&&(h=N.y),(!L||N.x>f)&&(f=N.x),(!L||N.y>g)&&(g=N.y)}const w=Math.min(f-l,g-h);let E=w/2;const D=new Is([],Jy);if(0===w)return new ht(l,h);for(let L=l;L<f;L+=w)for(let N=h;N<g;N+=w)D.push(new tu(L+E,N+E,E,n));let I=function(L){let N=0,B=0,U=0;const H=L[0];for(let Q=0,ne=H.length,ie=ne-1;Q<ne;ie=Q++){const ue=H[Q],ae=H[ie],de=ue.x*ae.y-ae.x*ue.y;B+=(ue.x+ae.x)*de,U+=(ue.y+ae.y)*de,N+=3*de}return new tu(B/N,U/N,0,L)}(n),P=D.length;for(;D.length;){const L=D.pop();(L.d>I.d||!I.d)&&(I=L,o&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,P)),L.max-I.d<=t||(E=L.h/2,D.push(new tu(L.p.x-E,L.p.y-E,E,n)),D.push(new tu(L.p.x+E,L.p.y-E,E,n)),D.push(new tu(L.p.x-E,L.p.y+E,E,n)),D.push(new tu(L.p.x+E,L.p.y+E,E,n)),P+=4)}return o&&(console.log(`num probes: ${P}`),console.log(`best distance: ${I.d}`)),I.p}function Jy(n,t){return t.max-n.max}class tu{constructor(t,o,l,h){this.p=new ht(t,o),this.h=l,this.d=function(f,g){let v=!1,w=1/0;for(let E=0;E<g.length;E++){const D=g[E];for(let I=0,P=D.length,L=P-1;I<P;L=I++){const N=D[I],B=D[L];N.y>f.y!=B.y>f.y&&f.x<(B.x-N.x)*(f.y-N.y)/(B.y-N.y)+N.x&&(v=!v),w=Math.min(w,zs(f,N,B))}}return(v?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const Lg=Number.POSITIVE_INFINITY,Qy=Math.sqrt(2);function Hx(n,[t,o]){let l=0,h=0;if(o===Lg){t<0&&(t=0);const f=t/Qy;switch(n){case"top-right":case"top-left":h=f-7;break;case"bottom-right":case"bottom-left":h=7-f;break;case"bottom":h=7-t;break;case"top":h=t-7}switch(n){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=t;break;case"right":l=-t}}else{switch(t=Math.abs(t),o=Math.abs(o),n){case"top-right":case"top-left":case"top":h=o-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-o}switch(n){case"top-right":case"bottom-right":case"right":l=-t;break;case"top-left":case"bottom-left":case"left":l=t}}return[l,h]}function ev(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sE(n,t,o,l,h,f,g,v,w,E,D,I,P,L,N){let B=f.textMaxSize.evaluate(t,{},I);void 0===B&&(B=g);const U=n.layers[0].layout,H=U.get("icon-offset").evaluate(t,{},I),Q=Zx(o.horizontal)||o.vertical,ne="globe"===P.name,ie=ro,ue=g/ie,ae=n.tilePixelRatio*B/ie,de=(Ve=n.overscaling,n.zoom>18&&Ve>2&&(Ve>>=1),Math.max(gt/(512*Ve),1)*U.get("symbol-spacing")),ye=U.get("text-padding")*n.tilePixelRatio,be=U.get("icon-padding")*n.tilePixelRatio,Te=Cn(U.get("text-max-angle")),we="map"===U.get("text-rotation-alignment")&&"point"!==U.get("symbol-placement"),Oe="map"===U.get("icon-rotation-alignment")&&"point"!==U.get("symbol-placement"),Ge=U.get("symbol-placement"),Re=de/2;var Ve;const Ie=U.get("icon-text-fit").evaluate(t,{},I),je=U.get("icon-text-fit-padding").evaluate(t,{},I),lt="none"!==Ie;let Be;!1===n.hasAnyIconTextFit&&lt&&(n.hasAnyIconTextFit=!0),l&&lt&&(n.allowVerticalPlacement&&o.vertical&&(Be=Bx(l,o.vertical,Ie,je,H,ue)),Q&&(l=Bx(l,Q,Ie,je,H,ue)));const yt=(dt,Ze,qt)=>{if(Ze.x<0||Ze.x>=gt||Ze.y<0||Ze.y>=gt)return;let Ft=null;if(ne){const{x:Tt,y:We,z:jt}=P.projectTilePoint(Ze.x,Ze.y,qt);Ft={anchor:new cc(Tt,We,jt,0,void 0),up:P.upVector(qt,Ze.x,Ze.y)}}!function(Tt,We,jt,un,Ht,dn,Jt,Pn,sn,_i,Vn,Fn,Jn,jn,St,oi,nr,wr,Ar,Ci,ji,Rr,Pr,Or,Ii,es,mc){const To=Tt.addToLineVertexArray(We,un);let Mo,Hs,im,s_,zb,Bb,Vb,jb=0,Ub=0,$b=0,Gb=0,Mv=-1,Iv=-1;const Dl={};let Hb=eh("");const Oh=jt?jt.anchor:We,Sv="none"!==sn.layout.get("icon-text-fit").evaluate(ji,{},Ii);let Av=0,a_=0;if(void 0===sn._unevaluatedLayout.getValue("text-radial-offset")?[Av,a_]=sn.layout.get("text-offset").evaluate(ji,{},Ii).map(ts=>ts*ro):(Av=sn.layout.get("text-radial-offset").evaluate(ji,{},Ii)*ro,a_=Lg),Tt.allowVerticalPlacement&&Ht.vertical){const ts=Ht.vertical;if(St)Bb=Ng(ts),Pn&&(Vb=Ng(Pn));else{const ns=sn.layout.get("text-rotate").evaluate(ji,{},Ii)+90;im=Fg(_i,Oh,We,Vn,Fn,Jn,ts,jn,ns,oi),Pn&&(s_=Fg(_i,Oh,We,Vn,Fn,Jn,Pn,wr,ns))}}if(dn){const ts=sn.layout.get("icon-rotate").evaluate(ji,{},Ii),ns=$x(dn,ts,Pr,Sv),kh=Pn?$x(Pn,ts,Pr,Sv):void 0;Hs=Fg(_i,Oh,We,Vn,Fn,Jn,dn,wr,ts),jb=4*ns.length;const Rv=Tt.iconSizeData;let uu=null;"source"===Rv.kind?(uu=[_a*sn.layout.get("icon-size").evaluate(ji,{},Ii)],uu[0]>nu&&tr(`${Tt.layerIds[0]}: Value for "icon-size" is >= ${rf}. Reduce your "icon-size".`)):"composite"===Rv.kind&&(uu=[_a*Rr.compositeIconSizes[0].evaluate(ji,{},Ii),_a*Rr.compositeIconSizes[1].evaluate(ji,{},Ii)],(uu[0]>nu||uu[1]>nu)&&tr(`${Tt.layerIds[0]}: Value for "icon-size" is >= ${rf}. Reduce your "icon-size".`)),Tt.addSymbols(Tt.icon,ns,uu,Ci,Ar,ji,!1,jt,We,To.lineStartIndex,To.lineLength,-1,Or,Ii,es,mc),Mv=Tt.icon.placedSymbolArray.length-1,kh&&(Ub=4*kh.length,Tt.addSymbols(Tt.icon,kh,uu,Ci,Ar,ji,ho.vertical,jt,We,To.lineStartIndex,To.lineLength,-1,Or,Ii,es,mc),Iv=Tt.icon.placedSymbolArray.length-1)}for(const ts in Ht.horizontal){const ns=Ht.horizontal[ts];Mo||(Hb=eh(ns.text),St?zb=Ng(ns):Mo=Fg(_i,Oh,We,Vn,Fn,Jn,ns,jn,sn.layout.get("text-rotate").evaluate(ji,{},Ii),oi));const kh=1===ns.positionedLines.length;if($b+=qx(Tt,jt,We,ns,Jt,sn,St,ji,oi,To,Ht.vertical?ho.horizontal:ho.horizontalOnly,kh?Object.keys(Ht.horizontal):[ts],Dl,Mv,Rr,Or,Ii,es),kh)break}Ht.vertical&&(Gb+=qx(Tt,jt,We,Ht.vertical,Jt,sn,St,ji,oi,To,ho.vertical,["vertical"],Dl,Iv,Rr,Or,Ii,es));let gc=-1;const l_=(ts,ns)=>ts?Math.max(ts,ns):ns;gc=l_(zb,gc),gc=l_(Bb,gc),gc=l_(Vb,gc);const qb=gc>-1?1:0;Tt.glyphOffsetArray.length>=65535&&tr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ji.sortKey&&Tt.addToSortKeyRanges(Tt.symbolInstances.length,ji.sortKey),Tt.symbolInstances.emplaceBack(We.x,We.y,Oh.x,Oh.y,Oh.z,Dl.right>=0?Dl.right:-1,Dl.center>=0?Dl.center:-1,Dl.left>=0?Dl.left:-1,Dl.vertical>=0?Dl.vertical:-1,Mv,Iv,Hb,void 0!==Mo?Mo:Tt.collisionBoxArray.length,void 0!==Mo?Mo+1:Tt.collisionBoxArray.length,void 0!==im?im:Tt.collisionBoxArray.length,void 0!==im?im+1:Tt.collisionBoxArray.length,void 0!==Hs?Hs:Tt.collisionBoxArray.length,void 0!==Hs?Hs+1:Tt.collisionBoxArray.length,s_||Tt.collisionBoxArray.length,s_?s_+1:Tt.collisionBoxArray.length,Vn,$b,Gb,jb,Ub,qb,0,Av,a_,gc,0,Sv?1:0)}(n,Ze,Ft,dt,o,l,h,Be,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,ye,we,w,0,be,Oe,H,t,f,E,D,I,L,N)};if("line"===Ge)for(const dt of oE(t.geometry,0,0,gt,gt)){const Ze=jx(dt,de,Te,o.vertical||Q,l,ie,ae,n.overscaling,gt);for(const qt of Ze)Q&&Wx(n,Q.text,Re,qt)||yt(dt,qt,I)}else if("line-center"===Ge){for(const dt of t.geometry)if(dt.length>1){const Ze=xT(dt,Te,o.vertical||Q,l,ie,ae);Ze&&yt(dt,Ze,I)}}else if("Polygon"===t.type)for(const dt of Dy(t.geometry,0)){const Ze=Ky(dt,16);yt(dt[0],new cc(Ze.x,Ze.y,0,0,void 0),I)}else if("LineString"===t.type)for(const dt of t.geometry)yt(dt,new cc(dt[0].x,dt[0].y,0,0,void 0),I);else if("Point"===t.type)for(const dt of t.geometry)for(const Ze of dt)yt([Ze],new cc(Ze.x,Ze.y,0,0,void 0),I)}const rf=255,nu=rf*_a;function qx(n,t,o,l,h,f,g,v,w,E,D,I,P,L,N,B,U,H){const Q=function(ue,ae,de,ye,be,Te,we,Oe){const Ge=[];if(0===ae.positionedLines.length)return Ge;const Re=ye.layout.get("text-rotate").evaluate(Te,{})*Math.PI/180,Ve=function(yt){const dt=yt[0],Ze=yt[1],qt=dt*Ze;return qt>0?[dt,-Ze]:qt<0?[-dt,Ze]:0===dt?[Ze,dt]:[Ze,-dt]}(de);let Ie=Math.abs(ae.top-ae.bottom);for(const yt of ae.positionedLines)Ie-=yt.lineOffset;const je=ae.positionedLines.length,lt=Ie/je;let Be=ae.top-de[1];for(let yt=0;yt<je;++yt){const dt=ae.positionedLines[yt];Be=Gx(ae,lt,Be,yt);for(const Ze of dt.positionedGlyphs){if(!Ze.rect)continue;const qt=Ze.rect||{};let Ft=Gy+1,Tt=!0,We=1,jt=0;if(Ze.imageName){const Ci=we[Ze.imageName];if(!Ci)continue;if(Ci.sdf){tr("SDF images are not supported in formatted text and will be ignored.");continue}Tt=!1,We=Ci.pixelRatio,Ft=Qo/We}const un=(be||Oe)&&Ze.vertical,Ht=Ze.metrics.advance*Ze.scale/2,dn=Ze.metrics,Jt=Ze.rect;if(null===Jt)continue;Oe&&ae.verticalizable&&(jt=Ze.imageName?Ht-Ze.metrics.width*Ze.scale/2:0);const Pn=be?[Ze.x+Ht,Ze.y]:[0,0];let sn=[0,0],_i=[0,0],Vn=!1;be||(un?(_i=[Ze.x+Ht+Ve[0],Ze.y+Ve[1]-jt],Vn=!0):sn=[Ze.x+Ht+de[0],Ze.y+de[1]-jt]);const Fn=Jt.w*Ze.scale/(We*(Ze.localGlyph?Eo:1)),Jn=Jt.h*Ze.scale/(We*(Ze.localGlyph?Eo:1));let jn,St,oi,nr;if(un){const Ci=Ze.y-Be,ji=new ht(-Ht,Ht-Ci),Rr=-Math.PI/2,Pr=new ht(..._i);jn=new ht(-Ht+sn[0],sn[1]),jn._rotateAround(Rr,ji)._add(Pr),jn.x+=-Ci+Ht,jn.y-=(dn.left-Ft)*Ze.scale;const Or=Ze.imageName?dn.advance*Ze.scale:ro*Ze.scale,Ii=String.fromCodePoint(Ze.glyph);Px(Ii)?jn.x+=(1-Ft)*Ze.scale:uo(Ii)?jn.x+=Or-dn.height*Ze.scale+(-Ft-1)*Ze.scale:jn.x+=Ze.imageName||dn.width+2*Ft===Jt.w&&dn.height+2*Ft===Jt.h?(Or-Jn)/2:(Or-(dn.height+2*Ft)*Ze.scale)/2,St=new ht(jn.x,jn.y-Fn),oi=new ht(jn.x+Jn,jn.y),nr=new ht(jn.x+Jn,jn.y-Fn)}else{const Ci=(dn.left-Ft)*Ze.scale-Ht+sn[0],ji=(-dn.top-Ft)*Ze.scale+sn[1],Rr=Ci+Fn,Pr=ji+Jn;jn=new ht(Ci,ji),St=new ht(Rr,ji),oi=new ht(Ci,Pr),nr=new ht(Rr,Pr)}if(Re){let Ci;Ci=be?new ht(0,0):Vn?new ht(Ve[0],Ve[1]):new ht(de[0],de[1]),jn._rotateAround(Re,Ci),St._rotateAround(Re,Ci),oi._rotateAround(Re,Ci),nr._rotateAround(Re,Ci)}const wr=new ht(0,0),Ar=new ht(0,0);Ge.push({tl:jn,tr:St,bl:oi,br:nr,texPrimary:qt,texSecondary:void 0,writingMode:ae.writingMode,glyphOffset:Pn,sectionIndex:Ze.sectionIndex,isSDF:Tt,pixelOffsetTL:wr,pixelOffsetBR:Ar,minFontScaleX:0,minFontScaleY:0})}}return Ge}(0,l,w,f,g,v,h,n.allowVerticalPlacement),ne=n.textSizeData;let ie=null;"source"===ne.kind?(ie=[_a*f.layout.get("text-size").evaluate(v,{},U)],ie[0]>nu&&tr(`${n.layerIds[0]}: Value for "text-size" is >= ${rf}. Reduce your "text-size".`)):"composite"===ne.kind&&(ie=[_a*N.compositeTextSizes[0].evaluate(v,{},U),_a*N.compositeTextSizes[1].evaluate(v,{},U)],(ie[0]>nu||ie[1]>nu)&&tr(`${n.layerIds[0]}: Value for "text-size" is >= ${rf}. Reduce your "text-size".`)),n.addSymbols(n.text,Q,ie,w,g,v,D,t,o,E.lineStartIndex,E.lineLength,L,B,U,H,!1);for(const ue of I)P[ue]=n.text.placedSymbolArray.length-1;return 4*Q.length}function Zx(n){for(const t in n)return n[t];return null}function Fg(n,t,o,l,h,f,g,v,w,E){let D=g.top,I=g.bottom,P=g.left,L=g.right;const N=g.collisionPadding;if(N&&(P-=N[0],D-=N[1],L+=N[2],I+=N[3]),w){const B=new ht(P,D),U=new ht(L,D),H=new ht(P,I),Q=new ht(L,I),ne=Cn(w);let ie=new ht(0,0);E&&(ie=new ht(E[0],E[1])),B._rotateAround(ne,ie),U._rotateAround(ne,ie),H._rotateAround(ne,ie),Q._rotateAround(ne,ie),P=Math.min(B.x,U.x,H.x,Q.x),L=Math.max(B.x,U.x,H.x,Q.x),D=Math.min(B.y,U.y,H.y,Q.y),I=Math.max(B.y,U.y,H.y,Q.y)}return n.emplaceBack(t.x,t.y,t.z,o.x,o.y,P,D,L,I,v,l,h,f),n.length-1}function Ng(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const t=n.bottom-n.top;return t>0?Math.max(10,t):null}function Wx(n,t,o,l){const h=n.compareText;if(t in h){const f=h[t];for(let g=f.length-1;g>=0;g--)if(l.dist(f[g])<o)return!0}else h[t]=[];return h[t].push(l),!1}function Yx(n,t){const o=n.fovAboveCenter,l=n.elevation?n.elevation.getMinElevationBelowMSL()*t:0,h=(n._camera.position[2]*n.worldSize-l)/Math.cos(n._pitch),f=Math.sin(o)*h/Math.sin(Math.max(Math.PI/2-n._pitch-o,.01)),g=Math.sin(n._pitch)*f+h;return Math.min(1.01*g,h*(1/n._horizonShift))}function $p(n,t){if(!t.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:t};const o=Math.pow(2,-n.z),l=n.x*o,h=(n.x+1)*o,f=n.y*o,g=(n.y+1)*o,v=tn(l),w=tn(h),E=Dn(f),D=Dn(g),I=t.project(v,E),P=t.project(w,E),L=t.project(w,D),N=t.project(v,D);let B=Math.min(I.x,P.x,L.x,N.x),U=Math.min(I.y,P.y,L.y,N.y),H=Math.max(I.x,P.x,L.x,N.x),Q=Math.max(I.y,P.y,L.y,N.y);const ne=o/16;function ie(ae,de,ye,be,Te,we){const Oe=(ye+Te)/2,Ge=(be+we)/2,Re=t.project(tn(Oe),Dn(Ge)),Ve=Math.max(0,B-Re.x,U-Re.y,Re.x-H,Re.y-Q);B=Math.min(B,Re.x),H=Math.max(H,Re.x),U=Math.min(U,Re.y),Q=Math.max(Q,Re.y),Ve>ne&&(ie(ae,Re,ye,be,Oe,Ge),ie(Re,de,Oe,Ge,Te,we))}ie(I,P,l,f,h,f),ie(P,L,h,f,h,g),ie(L,N,h,g,l,g),ie(N,I,l,g,l,f),B-=ne,U-=ne,H+=ne,Q+=ne;const ue=1/Math.max(H-B,Q-U);return{scale:ue,x:B*ue,y:U*ue,x2:H*ue,y2:Q*ue,projection:t}}function ys(n,{x:t,y:o},l=0){return new ht(((t-l)*n.scale-n.x)*gt,(o*n.scale-n.y)*gt)}const aE=d.a6.identity(new Float32Array(16));class iu{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,o){return{x:0,y:0,z:0}}unproject(t,o){return new xe(0,0)}projectTilePoint(t,o,l){return{x:t,y:o,z:0}}locationPoint(t,o,l=!0){return t._coordinatePoint(t.locationCoordinate(o),l)}pixelsPerMeter(t,o){return en(1,t)*o}pixelSpaceConversion(t,o,l){return 1}farthestPixelDistance(t){return Yx(t,t.pixelsPerMeter)}pointCoordinate(t,o,l,h){const f=t.horizonLineFromTop(!1),g=new ht(o,Math.max(f,l));return t.rayIntersectionCoordinate(t.pointRayIntersection(g,h))}pointCoordinate3D(t,o,l){const h=new ht(o,l);if(t.elevation)return t.elevation.pointCoordinate(h);{const f=this.pointCoordinate(t,h.x,h.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(t,o){if(t.elevation)return!this.pointCoordinate3D(t,o.x,o.y);const l=t.horizonLineFromTop();return o.y<l}createInversionMatrix(t,o){return aE}createTileMatrix(t,o,l){let h,f,g;const v=l.canonical,w=d.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=$p(v,this);h=1,f=E.x+l.wrap*E.scale,g=E.y,d.a6.scale(w,w,[h/E.scale,h/E.scale,t.pixelsPerMeter/o])}else h=o/t.zoomScale(v.z),f=(v.x+Math.pow(2,v.z)*l.wrap)*h,g=v.y*h;return d.a6.translate(w,w,[f,g,0]),d.a6.scale(w,w,[h/gt,h/gt,1]),w}upVector(t,o,l){return[0,0,1]}upVectorScale(t,o,l){return{metersToTile:1}}}class bT extends iu{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[o,l]=this.parallels=t.parallels||[29.5,45.5],h=Math.sin(Cn(o));this.n=(h+Math.sin(Cn(l)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(t,o){const{n:l,c:h,r0:f}=this,g=Cn(t-this.center[0]),v=Cn(o),w=Math.sqrt(h-2*l*Math.sin(v))/l;return{x:w*Math.sin(g*l),y:w*Math.cos(g*l)-f,z:0}}unproject(t,o){const{n:l,c:h,r0:f}=this,g=f+o;let v=Math.atan2(t,Math.abs(g))*Math.sign(g);g*l<0&&(v-=Math.PI*Math.sign(t)*Math.sign(g));const w=Cn(this.center[0])*l;v=Da(v,-Math.PI-w,Math.PI-w);const E=on(Er(v/l)+this.center[0],-180,180),D=Math.asin(on((h-(t*t+g*g)*l*l)/(2*l),-1,1)),I=on(Er(D),-En,En);return new xe(E,I)}}const wh=1.340264,sf=-.081106,Gp=893e-6,Hp=.003796,zg=Math.sqrt(3)/2;class Xx extends iu{project(t,o){o=o/180*Math.PI,t=t/180*Math.PI;const l=Math.asin(zg*Math.sin(o)),h=l*l,f=h*h*h;return{x:.5*(t*Math.cos(l)/(zg*(wh+3*sf*h+f*(7*Gp+9*Hp*h)))/Math.PI+.5),y:1-.5*(l*(wh+sf*h+f*(Gp+Hp*h))/Math.PI+1),z:0}}unproject(t,o){t=(2*t-.5)*Math.PI;let l=o=(2*(1-o)-1)*Math.PI,h=l*l,f=h*h*h;for(let D,I,P,L=0;L<12&&(I=l*(wh+sf*h+f*(Gp+Hp*h))-o,P=wh+3*sf*h+f*(7*Gp+9*Hp*h),D=I/P,l=on(l-D,-Math.PI/3,Math.PI/3),h=l*l,f=h*h*h,!(Math.abs(D)<1e-12));++L);const g=zg*t*(wh+3*sf*h+f*(7*Gp+9*Hp*h))/Math.cos(l),v=Math.asin(Math.sin(l)/zg),w=on(180*g/Math.PI,-180,180),E=on(180*v/Math.PI,-En,En);return new xe(w,E)}}class lE extends iu{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,o){return{x:.5+t/360,y:.5-o/360,z:0}}unproject(t,o){const l=360*(t-.5),h=on(360*(.5-o),-En,En);return new xe(l,h)}}const af=Math.PI/2;function lf(n){return Math.tan((af+n)/2)}class cE extends iu{constructor(t){super(t),this.center=t.center||[0,30];const[o,l]=this.parallels=t.parallels||[30,30];let h=Cn(o),f=Cn(l);this.southernCenter=h+f<0,this.southernCenter&&(h=-h,f=-f);const g=Math.cos(h),v=lf(h);this.n=h===f?Math.sin(h):Math.log(g/Math.cos(f))/Math.log(lf(f)/v),this.f=g*Math.pow(lf(h),this.n)/this.n}project(t,o){o=Cn(o),this.southernCenter&&(o=-o),t=Cn(t-this.center[0]);const l=1e-6,{n:h,f}=this;f>0?o<-af+l&&(o=-af+l):o>af-l&&(o=af-l);const g=f/Math.pow(lf(o),h);let v=g*Math.sin(h*t),w=f-g*Math.cos(h*t);return v=.5*(v/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:v,y:this.southernCenter?w:1-w,z:0}}unproject(t,o){t=(2*t-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:l,f:h}=this,f=h-o,g=Math.sign(f),v=Math.sign(l)*Math.sqrt(t*t+f*f);let w=Math.atan2(t,Math.abs(f))*g;f*l<0&&(w-=Math.PI*Math.sign(t)*g);const E=on(Er(w/l)+this.center[0],-180,180),D=on(Er(2*Math.atan(Math.pow(h/v,1/l))-af),-En,En);return new xe(E,this.southernCenter?-D:D)}}class Kx extends iu{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,o){return{x:hn(t),y:Yt(o),z:0}}unproject(t,o){const l=tn(t),h=Dn(o);return new xe(l,h)}}const Jx=Cn(En);class uE extends iu{project(t,o){const l=(o=Cn(o))*o,h=l*l;return{x:.5*((t=Cn(t))*(.8707-.131979*l+h*(h*(.003971*l-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+l*(.015085+h*(.028874*l-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(t,o){t=(2*t-.5)*Math.PI;let l=o=(2*(1-o)-1)*Math.PI,h=25,f=0,g=l*l;do{g=l*l;const E=g*g;f=(l*(1.007226+g*(.015085+E*(.028874*g-.044475-.005916*E)))-o)/(1.007226+g*(.045255+E*(.259866*g-.311325-.005916*11*E))),l=on(l-f,-Jx,Jx)}while(Math.abs(f)>1e-6&&--h>0);g=l*l;const v=on(Er(t/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),w=Er(l);return new xe(v,w)}}const Qx=Cn(En);class Cl extends iu{project(t,o){o=Cn(o),t=Cn(t);const l=Math.cos(o),h=2/Math.PI,f=Math.acos(l*Math.cos(t/2)),g=Math.sin(f)/f,v=.5*(t*h+2*l*Math.sin(t/2)/g)||0,w=.5*(o+Math.sin(o)/g)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(t,o){let l=t=(2*t-.5)*Math.PI,h=o=(2*(1-o)-1)*Math.PI,f=25;const g=1e-6;let v=0,w=0;do{const E=Math.cos(h),D=Math.sin(h),I=2*D*E,P=D*D,L=E*E,N=Math.cos(l/2),B=Math.sin(l/2),U=2*N*B,H=B*B,Q=1-L*N*N,ne=Q?1/Q:0,ie=Q?Math.acos(E*N)*Math.sqrt(1/Q):0,ue=.5*(2*ie*E*B+2*l/Math.PI)-t,ae=.5*(ie*D+h)-o,de=.5*ne*(L*H+ie*E*N*P)+1/Math.PI,ye=ne*(U*I/4-ie*D*B),be=.125*ne*(I*B-ie*D*L*U),Te=.5*ne*(P*N+ie*H*E)+.5,we=ye*be-Te*de;v=(ae*ye-ue*Te)/we,w=(ue*be-ae*de)/we,l=on(l-v,-Math.PI,Math.PI),h=on(h-w,-Qx,Qx)}while((Math.abs(v)>g||Math.abs(w)>g)&&--f>0);return new xe(Er(l),Er(h))}}class Bg extends iu{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Cn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,o){const{scale:l,cosPhi:h}=this;return{x:Cn(t)*h*l+.5,y:-Math.sin(Cn(o))/h*l+.5,z:0}}unproject(t,o){const{scale:l,cosPhi:h}=this,f=-(o-.5)/l,g=on(Er((t-.5)/l)/h,-180,180),v=Math.asin(on(f*h,-1,1)),w=on(Er(v),-En,En);return new xe(g,w)}}class hE extends Kx{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,o,l){const h=vp(t,o,l),f=xp(Va(l));return d.N.transformMat4(h,h,f),{x:h[0],y:h[1],z:h[2]}}locationPoint(t,o){const l=Pe(o.lat,o.lng),h=d.N.normalize([],l),f=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(o),t._centerAltitude):t._centerAltitude,g=en(1,0)*gt*f;d.N.scaleAndAdd(l,l,h,g);const v=d.a6.identity(new Float64Array(16));return d.a6.multiply(v,t.pixelMatrix,t.globeMatrix),d.N.transformMat4(l,l,v),new ht(l[0],l[1])}pixelsPerMeter(t,o){return en(1,0)*o}pixelSpaceConversion(t,o,l){const h=en(1,t)*o,f=rn(en(1,45)*o,h,l);return this.pixelsPerMeter(t,o)/f}createTileMatrix(t,o,l){const h=Ud(Va(l.canonical));return d.a6.multiply(new Float64Array(16),t.globeMatrix,h)}createInversionMatrix(t,o){const{center:l}=t,h=xp(Va(o));return d.a6.rotateY(h,h,Cn(l.lng)),d.a6.rotateX(h,h,Cn(l.lat)),d.a6.scale(h,h,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(t,o,l,h){return py(t,o,l,!0)||new zn(0,0)}pointCoordinate3D(t,o,l){const h=this.pointCoordinate(t,o,l,0);return[h.x,h.y,h.z]}isPointAboveHorizon(t,o){return!py(t,o.x,o.y,!1)}farthestPixelDistance(t){const o=function(h,f){const g=h.cameraToCenterDistance,v=h._centerAltitude*f,w=h._camera,E=h._camera.forward(),D=d.N.add([],d.N.scale([],E,-g),[0,0,v]),I=h.worldSize/(2*Math.PI),P=[0,0,-I],L=h.width/h.height,N=Math.tan(h.fovAboveCenter),B=d.N.scale([],w.up(),N),U=d.N.scale([],w.right(),N*L),H=d.N.normalize([],d.N.add([],d.N.add([],E,B),U)),Q=[];let ne;if(new sc(D,H).closestPointOnSphere(P,I,Q)){const ie=d.N.add([],Q,P),ue=d.N.sub([],ie,D);ne=Math.cos(h.fovAboveCenter)*d.N.length(ue)}else{const ie=d.N.sub([],D,P),ue=d.N.sub([],P,D);d.N.normalize(ue,ue);const ae=d.N.length(ie)-I;ne=Math.sqrt(ae*(ae+2*I));const de=Math.acos(ne/(I+ae))-Math.acos(d.N.dot(E,ue));ne*=Math.cos(de)}return 1.01*ne}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),l=Xc(t.zoom);if(l>0){const h=Yx(t,en(1,t.center.lat)*t.worldSize),f=t.worldSize/(2*Math.PI),g=Math.max(t.width,t.height)/t.worldSize*Math.PI;return rn(o,h+f*(1-Math.cos(g)),Math.pow(l,10))}return o}upVector(t,o,l){return vp(o,l,t,1)}upVectorScale(t){return{metersToTile:lh(tg(Va(t)))}}}function tv(n){const t=n.parallels,o=!!t&&Math.abs(t[0]+t[1])<.01;switch(n.name){case"mercator":return new Kx(n);case"equirectangular":return new lE(n);case"naturalEarth":return new uE(n);case"equalEarth":return new Xx(n);case"winkelTripel":return new Cl(n);case"albers":return o?new Bg(n):new bT(n);case"lambertConformalConic":return o?new Bg(n):new cE(n);case"globe":return new hE(n)}throw new Error(`Invalid projection name: ${n.name}`)}const dE=wl.types,eb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qp(n,t,o,l,h,f,g,v,w,E,D,I,P){const L=v?Math.min(nu,Math.round(v[0])):0,N=v?Math.min(nu,Math.round(v[1])):0;n.emplaceBack(t,o,Math.round(32*l),Math.round(32*h),f,g,(L<<1)+(w?1:0),N,16*E,16*D,256*I,256*P)}function Eh(n,t,o){n.emplaceBack(t,o)}function cf(n,t,o,l,h,f,g){n.emplaceBack(t,o,l,h,f,g)}function nv(n,t,o,l,h){n.emplaceBack(t,o,l,h),n.emplaceBack(t,o,l,h),n.emplaceBack(t,o,l,h),n.emplaceBack(t,o,l,h)}function tb(n){for(const t of n.sections)if(_d(t.text))return!0;return!1}class Vg{constructor(t){this.layoutVertexArray=new Wu,this.indexArray=new Ir,this.programConfigurations=t,this.segments=new Ki,this.dynamicLayoutVertexArray=new ka,this.opacityVertexArray=new ca,this.placedSymbolArray=new Fm,this.iconTransitioningVertexArray=new ks,this.globeExtVertexArray=new qf,this.zOffsetVertexArray=new Pd}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(t,o,l,h,f){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Uw.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Kd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,eb,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,zy.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,$w.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Gw.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ct(Vg,"SymbolBuffers");class jg{constructor(t,o,l){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new l,this.segments=new Ki,this.collisionVertexArray=new Rd,this.collisionVertexArrayExt=new ka}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,_T.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,By.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ct(jg,"CollisionBuffers");class Zp{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=d.a6.identity([]),this.placementViewportMatrix=d.a6.identity([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jy(this.zoom,o["text-size"]),this.iconSizeData=jy(this.zoom,o["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),f=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(g=>ho[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=l.get("symbol-z-elevate")}createArrays(){this.text=new Vg(new q(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Vg(new q(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Kf,this.lineVertexArray=new La,this.symbolInstances=new Gr}calculateGlyphDependencies(t,o,l,h,f){for(let g=0;g<t.length;g++){const v=t.codePointAt(g);if(void 0===v)break;if(o[v]=!0,h&&f&&v<=65535){const w=Qd[t.charAt(g)];w&&(o[w.charCodeAt(0)]=!0)}}}populate(t,o,l,h){const f=this.layers[0],g=f.layout,v="globe"===this.projection.name,w=g.get("text-font"),E=g.get("text-field"),D=g.get("icon-image"),I=("constant"!==E.value.kind||E.value.value instanceof Li&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==w.value.kind||w.value.value.length>0),P="constant"!==D.value.kind||!!D.value.value||Object.keys(D.parameters).length>0,L=g.get("symbol-sort-key");if(this.features=[],!I&&!P)return;const N=o.iconDependencies,B=o.glyphDependencies,U=o.availableImages,H=new Mi(this.zoom);for(const{feature:Q,id:ne,index:ie,sourceLayerIndex:ue}of t){const ae=f._featureFilter.needGeometry,de=mr(Q,ae);if(!f._featureFilter.filter(H,de,l))continue;if(ae||(de.geometry=Ei(Q,l,h)),v&&1!==Q.type&&l.z<=5){const we=de.geometry,Oe=.98078528056,Ge=(Re,Ve)=>{const Ie=vp(Re.x,Re.y,l,1),je=vp(Ve.x,Ve.y,l,1);return d.N.dot(Ie,je)<Oe};for(let Re=0;Re<we.length;Re++)we[Re]=zr(we[Re],Ge)}let ye,be;if(I){const we=f.getValueAndResolveTokens("text-field",de,l,U),Oe=Li.factory(we);tb(Oe)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Pa()||this.hasRTLText&&Kr.isParsed())&&(ye=yT(Oe,f,de))}if(P){const we=f.getValueAndResolveTokens("icon-image",de,l,U);be=we instanceof Ut?we:Ut.fromString(we)}if(!ye&&!be)continue;const Te=this.sortFeaturesByKey?L.evaluate(de,{},l):void 0;if(this.features.push({id:ne,text:ye,icon:be,index:ie,sourceLayerIndex:ue,geometry:de.geometry,properties:Q.properties,type:dE[Q.type],sortKey:Te}),be&&(N[be.namePrimary]=!0,be.nameSecondary&&(N[be.nameSecondary]=!0)),ye){const we=w.evaluate(de,{},l).join(","),Oe="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ho.vertical)>=0;for(const Ge of ye.sections)if(Ge.image)N[Ge.image.namePrimary]=!0;else{const Re=Ro(ye.toString()),Ve=Ge.fontStack||we,Ie=B[Ve]=B[Ve]||{};this.calculateGlyphDependencies(Ge.text,Ie,Oe,this.allowVerticalPlacement,Re)}}}"line"===g.get("symbol-placement")&&(this.features=function(Q){const ne={},ie={},ue=[];let ae=0;function de(we){ue.push(Q[we]),ae++}function ye(we,Oe,Ge){const Re=ie[we];return delete ie[we],ie[Oe]=Re,ue[Re].geometry[0].pop(),ue[Re].geometry[0]=ue[Re].geometry[0].concat(Ge[0]),Re}function be(we,Oe,Ge){const Re=ne[Oe];return delete ne[Oe],ne[we]=Re,ue[Re].geometry[0].shift(),ue[Re].geometry[0]=Ge[0].concat(ue[Re].geometry[0]),Re}function Te(we,Oe,Ge){const Re=Ge?Oe[0][Oe[0].length-1]:Oe[0][0];return`${we}:${Re.x}:${Re.y}`}for(let we=0;we<Q.length;we++){const Oe=Q[we],Ge=Oe.geometry,Re=Oe.text?Oe.text.toString():null;if(!Re){de(we);continue}const Ve=Te(Re,Ge),Ie=Te(Re,Ge,!0);if(Ve in ie&&Ie in ne&&ie[Ve]!==ne[Ie]){const je=be(Ve,Ie,Ge),lt=ye(Ve,Ie,ue[je].geometry);delete ne[Ve],delete ie[Ie],ie[Te(Re,ue[lt].geometry,!0)]=lt,ue[je].geometry=null}else Ve in ie?ye(Ve,Ie,Ge):Ie in ne?be(Ve,Ie,Ge):(de(we),ne[Ve]=ae-1,ie[Ie]=ae-1)}return ue.filter(we=>we.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Q,ne)=>Q.sortKey-ne.sortKey)}update(t,o,l,h,f){const g=0!==Object.keys(t).length;if(g&&!this.stateDependentLayers.length)return;const v=g?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,o,v,l,h,f),this.icon.programConfigurations.updatePaintArrays(t,o,v,l,h,f)}updateZOffset(){const t=(f,g,v)=>{l+=g,l>f.length&&f.resize(l);for(let w=-g;w<0;w++)f.emplace(w+l,v)},o=(f,g,v)=>{h+=g,h>f.length&&f.resize(h);for(let w=-g;w<0;w++)f.emplace(w+h,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,h=0;for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:w,numIconVertices:E}=g,D=g.zOffset,I=E>0;if((v>0||w>0)&&(t(this.text.zOffsetVertexArray,v,D),t(this.text.zOffsetVertexArray,w,D)),I){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:L}=g;P>=0&&o(this.icon.zOffsetVertexArray,E,D),L>=0&&o(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,D)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=tv(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,o){const l=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:h,y:f}of o)this.lineVertexArray.emplaceBack(h,f);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,o,l,h,f,g,v,w,E,D,I,P,L,N,B,U){const H=t.indexArray,Q=t.layoutVertexArray,ne=t.globeExtVertexArray,ie=t.segments.prepareSegment(4*o.length,Q,H,this.canOverlap?g.sortKey:void 0),ue=this.glyphOffsetArray.length,ae=ie.vertexLength,de=this.allowVerticalPlacement&&v===ho.vertical?Math.PI/2:0,ye=g.text&&g.text.sections;for(let Te=0;Te<o.length;Te++){const{tl:we,tr:Oe,bl:Ge,br:Re,texPrimary:Ve,texSecondary:Ie,pixelOffsetTL:je,pixelOffsetBR:lt,minFontScaleX:Be,minFontScaleY:yt,glyphOffset:dt,isSDF:Ze,sectionIndex:qt}=o[Te],Ft=ie.vertexLength,Tt=dt[1];if(qp(Q,E.x,E.y,we.x,Tt+we.y,Ve.x,Ve.y,l,Ze,je.x,je.y,Be,yt),qp(Q,E.x,E.y,Oe.x,Tt+Oe.y,Ve.x+Ve.w,Ve.y,l,Ze,lt.x,je.y,Be,yt),qp(Q,E.x,E.y,Ge.x,Tt+Ge.y,Ve.x,Ve.y+Ve.h,l,Ze,je.x,lt.y,Be,yt),qp(Q,E.x,E.y,Re.x,Tt+Re.y,Ve.x+Ve.w,Ve.y+Ve.h,l,Ze,lt.x,lt.y,Be,yt),w){const{x:We,y:jt,z:un}=w.anchor,[Ht,dn,Jt]=w.up;cf(ne,We,jt,un,Ht,dn,Jt),cf(ne,We,jt,un,Ht,dn,Jt),cf(ne,We,jt,un,Ht,dn,Jt),cf(ne,We,jt,un,Ht,dn,Jt),nv(t.dynamicLayoutVertexArray,We,jt,un,de)}else nv(t.dynamicLayoutVertexArray,E.x,E.y,E.z,de);if(U){const We=Ie||Ve;Eh(t.iconTransitioningVertexArray,We.x,We.y),Eh(t.iconTransitioningVertexArray,We.x+We.w,We.y),Eh(t.iconTransitioningVertexArray,We.x,We.y+We.h),Eh(t.iconTransitioningVertexArray,We.x+We.w,We.y+We.h)}H.emplaceBack(Ft,Ft+1,Ft+2),H.emplaceBack(Ft+1,Ft+2,Ft+3),ie.vertexLength+=4,ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),Te!==o.length-1&&qt===o[Te+1].sectionIndex||t.programConfigurations.populatePaintArrays(Q.length,g,g.index,{},L,N,B,ye&&ye[qt])}const be=w?w.anchor:E;t.placedSymbolArray.emplaceBack(be.x,be.y,be.z,E.x,E.y,ue,this.glyphOffsetArray.length-ue,ae,D,I,E.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],v,0,!1,0,P,0)}_commitLayoutVertex(t,o,l,h,f,g,v){t.emplaceBack(o,l,h,f,g,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(t,o,l,h,f,g,v){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),E=w.vertexLength,D=v.tileAnchorX,I=v.tileAnchorY;for(let L=0;L<4;L++)l.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,o,t.padding,v.zOffset),this._commitLayoutVertex(l.layoutVertexArray,h,f,g,D,I,new ht(t.x1,t.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,f,g,D,I,new ht(t.x2,t.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,f,g,D,I,new ht(t.x2,t.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,f,g,D,I,new ht(t.x1,t.y2)),w.vertexLength+=4;const P=l.indexArray;P.emplaceBack(E,E+1),P.emplaceBack(E+1,E+2),P.emplaceBack(E+2,E+3),P.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(t,o,l,h,f,g){for(let v=h;v<f;v++){const w=l.get(v),E=this.getSymbolInstanceTextSize(t,g,o,v);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(t,o,l,h,f,g){for(let v=h;v<f;v++){const w=l.get(v),E=this.getSymbolInstanceIconSize(t,o,g.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}generateCollisionDebugBuffers(t,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new jg(Zc,Vy.members,ks),this.iconCollisionBox=new jg(Zc,Vy.members,ks);const l=Jd(this.iconSizeData,t),h=Jd(this.textSizeData,t);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(h,t,o,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(h,t,o,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,t,o,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,t,o,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(t,o,l,h){const f=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:h),g=Np(this.textSizeData,t,f)/ro;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,o,l){const h=this.icon.placedSymbolArray.get(l),f=Np(this.iconSizeData,t,h);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(t,o,l,h){t.emplaceBack(o,-l,-l,h),t.emplaceBack(o,l,-l,h),t.emplaceBack(o,l,l,h),t.emplaceBack(o,-l,l,h)}_updateTextDebugCollisionBoxes(t,o,l,h,f,g){for(let v=h;v<f;v++){const w=l.get(v),E=this.getSymbolInstanceTextSize(t,g,o,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(t,o,l,h,f,g){for(let v=h;v<f;v++){const w=l.get(v),E=this.getSymbolInstanceIconSize(t,o,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding,g.zOffset)}}updateCollisionDebugBuffers(t,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=Jd(this.iconSizeData,t),h=Jd(this.textSizeData,t);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(h,t,o,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(h,t,o,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(l,t,o,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._updateIconDebugCollisionBoxes(l,t,o,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,o,l,h,f,g,v,w,E){const D={};if(o<l){const{x1:I,y1:P,x2:L,y2:N,padding:B,projectedAnchorX:U,projectedAnchorY:H,projectedAnchorZ:Q,tileAnchorX:ne,tileAnchorY:ie,featureIndex:ue}=t.get(o);D.textBox={x1:I,y1:P,x2:L,y2:N,padding:B,projectedAnchorX:U,projectedAnchorY:H,projectedAnchorZ:Q,tileAnchorX:ne,tileAnchorY:ie},D.textFeatureIndex=ue}if(h<f){const{x1:I,y1:P,x2:L,y2:N,padding:B,projectedAnchorX:U,projectedAnchorY:H,projectedAnchorZ:Q,tileAnchorX:ne,tileAnchorY:ie,featureIndex:ue}=t.get(h);D.verticalTextBox={x1:I,y1:P,x2:L,y2:N,padding:B,projectedAnchorX:U,projectedAnchorY:H,projectedAnchorZ:Q,tileAnchorX:ne,tileAnchorY:ie},D.verticalTextFeatureIndex=ue}if(g<v){const{x1:I,y1:P,x2:L,y2:N,padding:B,projectedAnchorX:U,projectedAnchorY:H,projectedAnchorZ:Q,tileAnchorX:ne,tileAnchorY:ie,featureIndex:ue}=t.get(g);D.iconBox={x1:I,y1:P,x2:L,y2:N,padding:B,projectedAnchorX:U,projectedAnchorY:H,projectedAnchorZ:Q,tileAnchorX:ne,tileAnchorY:ie},D.iconFeatureIndex=ue}if(w<E){const{x1:I,y1:P,x2:L,y2:N,padding:B,projectedAnchorX:U,projectedAnchorY:H,projectedAnchorZ:Q,tileAnchorX:ne,tileAnchorY:ie,featureIndex:ue}=t.get(w);D.verticalIconBox={x1:I,y1:P,x2:L,y2:N,padding:B,projectedAnchorX:U,projectedAnchorY:H,projectedAnchorZ:Q,tileAnchorX:ne,tileAnchorY:ie},D.verticalIconFeatureIndex=ue}return D}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const l=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,o){const l=t.placedSymbolArray.get(o),h=l.vertexStartIndex+4*l.numGlyphs;for(let f=l.vertexStartIndex;f<h;f+=4)t.indexArray.emplaceBack(f,f+1,f+2),t.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const o=Math.sin(t),l=Math.cos(t),h=[],f=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);const w=this.symbolInstances.get(v);h.push(0|Math.round(o*w.tileAnchorX+l*w.tileAnchorY)),f.push(w.featureIndex)}return g.sort((v,w)=>h[v]-h[w]||f[w]-f[v]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,o){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===o?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const l=this.symbolInstances.get(o);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=l;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),f>=0&&f!==h&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&g!==f&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ct(Zp,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Zp.addDynamicAttributes=nv;const iv=new Xi({"symbol-placement":new nt(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new nt(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nt(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Vt(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nt(Ce.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new nt(Ce.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new nt(Ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new nt(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new nt(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nt(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Vt(Ce.layout_symbol["icon-size"]),"icon-text-fit":new Vt(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Vt(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Vt(Ce.layout_symbol["icon-image"]),"icon-rotate":new Vt(Ce.layout_symbol["icon-rotate"]),"icon-padding":new nt(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new nt(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Vt(Ce.layout_symbol["icon-offset"]),"icon-anchor":new Vt(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nt(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nt(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nt(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new Vt(Ce.layout_symbol["text-field"]),"text-font":new Vt(Ce.layout_symbol["text-font"]),"text-size":new Vt(Ce.layout_symbol["text-size"]),"text-max-width":new Vt(Ce.layout_symbol["text-max-width"]),"text-line-height":new Vt(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Vt(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new Vt(Ce.layout_symbol["text-justify"]),"text-radial-offset":new Vt(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nt(Ce.layout_symbol["text-variable-anchor"]),"text-anchor":new Vt(Ce.layout_symbol["text-anchor"]),"text-max-angle":new nt(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new nt(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new Vt(Ce.layout_symbol["text-rotate"]),"text-padding":new nt(Ce.layout_symbol["text-padding"]),"text-keep-upright":new nt(Ce.layout_symbol["text-keep-upright"]),"text-transform":new Vt(Ce.layout_symbol["text-transform"]),"text-offset":new Vt(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new nt(Ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new nt(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new nt(Ce.layout_symbol["text-optional"]),visibility:new nt(Ce.layout_symbol.visibility)});var Ga={paint:new Xi({"icon-opacity":new Vt(Ce.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Vt(Ce.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Vt(Ce.paint_symbol["text-emissive-strength"]),"icon-color":new Vt(Ce.paint_symbol["icon-color"]),"icon-halo-color":new Vt(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Vt(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Vt(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new nt(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new nt(Ce.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Vt(Ce.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Vt(Ce.paint_symbol["text-opacity"]),"text-color":new Vt(Ce.paint_symbol["text-color"],{runtimeType:So,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Vt(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new Vt(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Vt(Ce.paint_symbol["text-halo-blur"]),"text-translate":new nt(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new nt(Ce.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new nt(Ce.paint_symbol["icon-color-saturation"])}),layout:iv};class nb{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ma,this.defaultValue=t}evaluate(t){if(t.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ct(nb,"FormatSectionOverride",{omit:["defaultValue"]});class Ug extends Po{constructor(t,o,l){super(t,Ga,o,l)}recalculate(t,o){super.recalculate(t,o),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const f of l)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,o,l,h){const f=this.layout.get(t).evaluate(o,{},l,h),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Bu(g.value)||!f?f:(v=o.properties,f.replace(/{([^{}]+)}/g,(E,D)=>D in v?String(v[D]):""));var v}createBucket(t){return new Zp(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Ga.paint.overridableProperties){if(!Ug.hasPaintOverride(this.layout,t))continue;const o=this.paint.get(t),l=new nb(o),h=new dd(l,o.property.specification,this.scope,this.options);let f=null;f="constant"===o.value.kind||"source"===o.value.kind?new Im("source",h):new fd("composite",h,o.value.zoomStops,o.value._interpolationType),this.paint._values[t]=new Gu(o.property,f,o.parameters)}}_handleOverridablePaintPropertyUpdate(t,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven())&&Ug.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,o){const l=t.get("text-field"),h=Ga.paint.properties[o];let f=!1;const g=v=>{for(const w of v)if(h.overrides&&h.overrides.hasOverride(w))return void(f=!0)};if("constant"===l.value.kind&&l.value.value instanceof Li)g(l.value.value.sections);else if("source"===l.value.kind){const v=E=>{f||(E instanceof nl&&Ui(E.value)===Eu?g(E.value.sections):E instanceof Cu?g(E.sections):E.eachChild(v))},w=l.value;w._styleExpression&&v(w._styleExpression.expression)}return f}getProgramIds(){const t=0!==this.paint.get("icon-opacity").constantOr(1),o=0!==this.paint.get("text-opacity").constantOr(1),l=[];return t&&l.push("symbolIcon"),o&&l.push("symbolSDF"),l}getDefaultProgramParams(t,o){return{config:new j(this,o),overrideFog:!1}}}const rv=new Xi({visibility:new nt(Ce.layout_background.visibility)});var fE={paint:new Xi({"background-color":new nt(Ce.paint_background["background-color"]),"background-pattern":new nt(Ce.paint_background["background-pattern"]),"background-opacity":new nt(Ce.paint_background["background-opacity"]),"background-emissive-strength":new nt(Ce.paint_background["background-emissive-strength"])}),layout:rv};const ib=new Xi({visibility:new nt(Ce.layout_raster.visibility)});var pE={paint:new Xi({"raster-opacity":new nt(Ce.paint_raster["raster-opacity"]),"raster-color":new Oa(Ce.paint_raster["raster-color"]),"raster-color-mix":new nt(Ce.paint_raster["raster-color-mix"]),"raster-color-range":new nt(Ce.paint_raster["raster-color-range"]),"raster-hue-rotate":new nt(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nt(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nt(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new nt(Ce.paint_raster["raster-saturation"]),"raster-contrast":new nt(Ce.paint_raster["raster-contrast"]),"raster-resampling":new nt(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new nt(Ce.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new nt(Ce.paint_raster["raster-emissive-strength"]),"raster-array-band":new nt(Ce.paint_raster["raster-array-band"]),"raster-elevation":new nt(Ce.paint_raster["raster-elevation"])}),layout:ib},uf=ei([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ch{constructor(t,o,l,h){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(o,h)}update(t,o,l){const{width:h,height:f}=t,{context:g}=this,{gl:v}=g;if(v.bindTexture(v.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!o||!1!==o.premultiply)),l||this.size&&this.size[0]===h&&this.size[1]===f){const{x:w,y:E}=l||{x:0,y:0};if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap)v.texSubImage2D(v.TEXTURE_2D,0,w,E,v.RGBA,v.UNSIGNED_BYTE,t);else{let D=this.format,I=v.UNSIGNED_BYTE;this.format===v.R32F&&(D=v.RED,I=v.FLOAT),v.texSubImage2D(v.TEXTURE_2D,0,w,E,h,f,D,I,t.data)}}else if(this.size=[h,f],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap){let w=this.format;this.format===v.R8&&(w=v.RED),v.texImage2D(v.TEXTURE_2D,0,this.format,w,v.UNSIGNED_BYTE,t)}else{let w=this.format,E=this.format,D=v.UNSIGNED_BYTE;this.format===v.DEPTH_COMPONENT&&(w=v.DEPTH_COMPONENT16,D=v.UNSIGNED_SHORT),this.format===v.R8&&(E=v.RED),this.format===v.R32F&&(D=v.FLOAT,E=v.RED),v.texImage2D(v.TEXTURE_2D,0,w,h,f,0,E,D,t.data)}this.useMipmap=!(!o||!o.useMipmap),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(t,o,l=!1){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),t!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!l?t===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),o!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(t,o,l,h){const{context:f}=this,{gl:g}=f;g.bindTexture(g.TEXTURE_2D,this.texture),o!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,o),this.magFilter=o),t!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?t===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),l!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,l),this.wrapS=l),h!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Wp{constructor(t,o){this.context=t,this.texture=o}bind(t,o){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,t),this.minFilter=t),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrapS=o)}}function Dh(n,t,o,l,h,f,g,v){const w=[n,t,1,o,l,1,h,f,1],E=[g,v,1],D=d.co.adjoint([],w),[I,P,L]=d.N.transformMat3(E,E,D);return d.co.multiply(w,w,[I,0,0,0,P,0,0,0,L])}function mE(n,t,o,l,h,f,g,v){const w=function(E,D,I,P,L,N,B,U){const H=Dh(0,0,1,0,1,1,0,1),Q=Dh(E,D,I,P,L,N,B,U),ne=d.co.adjoint([],H);return d.co.multiply(Q,Q,ne)}(n,t,o,l,h,f,g,v);return[w[2]/w[8]/gt,w[5]/w[8]/gt]}function $g(n){return[n[0],Math.min(Math.max(n[1],-En),En)]}class ov extends Tc{constructor(t,o,l,h){super(),this.id=t,this.dispatcher=l,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=o,this._dirty=!1}load(t,o){if(this._loaded=o||!1,this.fire(new el("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=mt(this.map._requestManager.transformRequest(this.url,mo.Image),(l,h)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new Tf(l)):h&&(this.image=h instanceof HTMLImageElement?Xe.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Wp(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new el("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Wp||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=t[0][1],l=t[0][1];for(const f of t)f[1]>l&&(l=f[1]),f[1]<o&&(o=f[1]);const h=(l+o)/2;if(h>En?this.onNorthPole=!0:h<-En&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=t.map(zn.fromLngLat);this.tileID=function(g){let v=1/0,w=1/0,E=-1/0,D=-1/0;for(const B of g)v=Math.min(v,B.x),w=Math.min(w,B.y),E=Math.max(E,B.x),D=Math.max(D,B.y);const I=Math.max(E-v,D-w),P=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),L=Math.pow(2,P);let N=Math.floor((v+E)/2*L);return N>1&&(N-=1),new He(P,N,Math.floor((w+D)/2*L))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new el("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const H in this.tiles){const Q=this.tiles[H];"loaded"!==Q.state&&(Q.state="loaded",Q.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=$p(new He(0,0,0),this.map.transform.projection),l=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(H){const Q=H[1].x-H[0].x,ne=H[1].y-H[0].y,ie=H[2].x-H[1].x,ue=H[2].y-H[1].y,ae=H[3].x-H[2].x,de=H[3].y-H[2].y,ye=H[0].x-H[3].x,be=H[0].y-H[3].y,Te=Q*ue-ie*ne,we=ie*de-ae*ue,Oe=ae*be-ye*de,Ge=ye*ne-Q*be;return Te>0&&we>0&&Oe>0&&Ge>0||Te<0&&we<0&&Oe<0&&Ge<0}(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=$p(this.tileID,this.map.transform.projection),[f,g,v,w]=this.coordinates.map(H=>{const Q=h.projection.project(H[0],H[1]);return ys(h,Q)._round()});this.perspectiveTransform=mE(f.x,f.y,g.x,g.y,v.x,v.y,w.x,w.y);const E=this._boundsArray=new fs;E.emplaceBack(f.x,f.y,0,0),E.emplaceBack(g.x,g.y,gt,0),E.emplaceBack(w.x,w.y,0,gt),E.emplaceBack(v.x,v.y,gt,gt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(E,uf.members),this.boundsSegments=Ki.simpleSegment(0,0,4,2);const D=[],I=[$g((P=this.coordinates)[0]),$g(P[1]),$g(P[2]),$g(P[3])];var P;const[L,N,B,U]=function(H){let Q=H[0][0],ne=Q,ie=H[0][1],ue=ie;for(let ae=1;ae<H.length;ae++)H[ae][0]<Q?Q=H[ae][0]:H[ae][0]>ne&&(ne=H[ae][0]),H[ae][1]<ie?ie=H[ae][1]:H[ae][1]>ue&&(ue=H[ae][1]);return[Q,ie,ne-Q,ue-ie]}(I);{const H=new fs,[Q,ne,ie,ue]=function(je){let lt=je[0].x,Be=lt,yt=je[0].y,dt=yt;for(let Ze=1;Ze<je.length;Ze++)je[Ze].x<lt?lt=je[Ze].x:je[Ze].x>Be&&(Be=je[Ze].x),je[Ze].y<yt?yt=je[Ze].y:je[Ze].y>dt&&(dt=je[Ze].y);return[lt,yt,Be-lt,dt-yt]}(l),ae=je=>[(je.x-Q)/ie,(je.y-ne)/ue],[de,ye,be,Te]=l.map(ae),we=function(je,lt,Be,yt,dt,Ze,qt,Ft){const Tt=Dh(0,0,1,0,1,1,0,1),We=Dh(je,lt,Be,yt,dt,Ze,qt,Ft),jt=d.co.adjoint([],We);return d.co.multiply(Tt,Tt,jt)}(de[0],de[1],ye[0],ye[1],be[0],be[1],Te[0],Te[1]);this.elevatedGlobePerspectiveTransform=mE(de[0],de[1],ye[0],ye[1],be[0],be[1],Te[0],Te[1]);const Oe=(je,lt)=>{D.push(je.lng);const Be=Math.round((je.lng-L)/B*gt),yt=Math.round((je.lat-N)/U*gt),dt=ae(lt),Ze=d.N.transformMat3([],[dt[0],dt[1],1],we),qt=Math.round(Ze[0]/Ze[2]*gt),Ft=Math.round(Ze[1]/Ze[2]*gt);H.emplaceBack(Be,yt,qt,Ft)},Ge=l[3].x-l[0].x,Re=l[3].y-l[0].y,Ve=l[2].x-l[1].x,Ie=l[2].y-l[1].y;for(let je=0;je<65;je++){const lt=je/64,Be=[l[0].x+lt*Ge,l[0].y+lt*Re],yt=[l[1].x+lt*Ve,l[1].y+lt*Ie],dt=yt[0]-Be[0],Ze=yt[1]-Be[1];for(let qt=0;qt<65;qt++){const Ft=qt/64,Tt={x:Be[0]+dt*Ft,y:Be[1]+Ze*Ft,z:0};Oe(o.projection.unproject(Tt.x,Tt.y),Tt)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(H,uf.members)}{this.maxLongitudeTriangleSize=0;let H=[],Q=new Ir;const ne=(ie,ue,ae)=>{Q.emplaceBack(ie,ue,ae);const de=D[ie],ye=D[ue],be=D[ae],Te=Math.min(Math.min(de,ye),be),we=Math.max(Math.max(de,ye),be)-Te;we>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=we),H.push(Te+we/2)};for(let ie=0;ie<64;ie++)for(let ue=0;ue<64;ue++){const ae=65*ie+ue,de=ae+1,ye=ae+65,be=ye+1;ne(ae,ye,de),ne(de,ye,be)}[H,Q]=function(ie,ue){const ae=Array.from({length:ie.length},(be,Te)=>Te);ae.sort((be,Te)=>ie[be]-ie[Te]);const de=[],ye=new Ir;for(let be=0;be<ae.length;be++){const Te=ae[be];de.push(ie[Te]);const we=3*Te,Oe=we+1;ye.emplaceBack(ue.uint16[we],ue.uint16[Oe],ue.uint16[Oe+1])}return[de,ye]}(H,Q),this.elevatedGlobeTrianglesCenterLongitudes=H,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(Q)}this.elevatedGlobeSegments=Ki.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,B/gt,0,U/gt,0,0,N,L,0])}prepare(){const t=0!==Object.keys(this.tiles).length;if(this.tileID&&!t)return;const o=this.map.painter.context,l=o.gl;!this._dirty||this.texture instanceof Wp||(this.texture?this.texture.update(this.image):(this.texture=new Ch(o,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(o)}loadTile(t,o){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},o(null)):(t.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let h=(D=t+180)+360*Math.round((l[0]-D)/360);var D;const f=new Ki,g=(D,I)=>{f.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:o.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},v=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-h)<=v){const D=Fe(l,0,l.length,h+v);return D===l.length||g(D,_e(l,D+1,l.length,h+360-v)-D),f}h<l[0]&&(h+=360);const w=_e(l,0,l.length,h-v);if(w===l.length)return g(0,l.length),f;g(0,w-0);const E=Fe(l,w+1,l.length,h+v);return E!==l.length&&g(E,l.length-E),f}}const rb=(Math.pow(256,2)-1)/16907520;class ob extends Po{constructor(t,o,l){super(t,pE,o,l),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(t){return!(t&&t._source instanceof ov&&(t._source.onNorthPole||t._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(t){"raster-color"!==t&&"raster-color-range"!==t||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[l,h]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(h)||l===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=og({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,h])}}const gE=new Xi({visibility:new nt(Ce["layout_raster-particle"].visibility)});var sb={paint:new Xi({"raster-particle-array-band":new nt(Ce["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new nt(Ce["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Oa(Ce["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new nt(Ce["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new nt(Ce["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new nt(Ce["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new nt(Ce["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:gE};class sv extends Po{constructor(t,o,l){super(t,sb,o,l),this._updateColorRamp(),this.onRemove=h=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&h.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=Xe.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isLayerDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){"raster-particle-color"!==t&&"raster-particle-max-speed"!==t||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===t&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=og({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Xe.now()}}class Yp extends Po{constructor(t,o){super(t,{},o),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(t){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const _E=new Xi({visibility:new nt(Ce.layout_sky.visibility)});var ab={paint:new Xi({"sky-type":new nt(Ce.paint_sky["sky-type"]),"sky-atmosphere-sun":new nt(Ce.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new nt(Ce.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new nt(Ce.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new nt(Ce.paint_sky["sky-gradient-radius"]),"sky-gradient":new Oa(Ce.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new nt(Ce.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new nt(Ce.paint_sky["sky-atmosphere-color"]),"sky-opacity":new nt(Ce.paint_sky["sky-opacity"])}),layout:_E};function Gg(n,t,o){const l=[0,0,1],h=d.bi.identity([]);return d.bi.rotateY(h,h,o?-Cn(n)+Math.PI:Cn(n)),d.bi.rotateX(h,h,-Cn(t)),d.N.transformQuat(l,l,h),d.N.normalize(l,l)}var yE={paint:new Xi({})};function lb(n,t){const o=Hg(n.projection,n.zoom,n.width,n.height),l=function(f,g,v,w,E){const D=new xe(v.lng-180*ru,v.lat),I=new xe(v.lng+180*ru,v.lat),P=f.project(D.lng,D.lat),L=f.project(I.lng,I.lat),N=-Math.atan2(L.y-P.y,L.x-P.x),B=zn.fromLngLat(v);B.y=on(B.y,-1+ru,1-ru);const U=B.toLngLat(),H=f.project(U.lng,U.lat),Q=zn.fromLngLat(U);Q.x+=ru;const ne=Q.toLngLat(),ie=f.project(ne.lng,ne.lat),ue=ub(ie.x-H.x,ie.y-H.y,N),ae=zn.fromLngLat(U);ae.y+=ru;const de=ae.toLngLat(),ye=f.project(de.lng,de.lat),be=ub(ye.x-H.x,ye.y-H.y,N),Te=Math.abs(ue.x)/Math.abs(be.y),we=d.a6.identity([]);d.a6.rotateZ(we,we,-N*(1-(E?0:w)));const Oe=d.a6.identity([]);return d.a6.scale(Oe,Oe,[1,1-(1-Te)*w,1]),Oe[4]=-be.x/be.y*w,d.a6.rotateZ(Oe,Oe,N),d.a6.multiply(Oe,we,Oe),Oe}(n.projection,0,n.center,o,t),h=hf(n);return d.a6.scale(l,l,[h,h,1]),l}function hf(n){const t=n.projection,o=Hg(n.projection,n.zoom,n.width,n.height),l=cb(t,n.center),h=cb(t,xe.convert(t.center));return Math.pow(2,l*o+(1-o)*h)}function Hg(n,t,o,l,h=1/0){const f=n.range;if(!f)return 0;const g=Math.min(h,Math.max(o,l)),v=Math.log(g/1024)/Math.LN2;return xc(f[0]+v,f[1]+v,t)}const ru=1/4e4;function cb(n,t){const o=on(t.lat,-En,En),l=new xe(t.lng-180*ru,o),h=new xe(t.lng+180*ru,o),f=n.project(l.lng,o),g=n.project(h.lng,o),v=zn.fromLngLat(l),w=zn.fromLngLat(h),E=g.x-f.x,D=g.y-f.y,I=w.x-v.x,P=w.y-v.y,L=Math.sqrt((I*I+P*P)/(E*E+D*D));return Math.log(L)/Math.LN2}function ub(n,t,o){const l=Math.cos(o),h=Math.sin(o);return{x:n*l-t*h,y:n*h+t*l}}function hb(n,t,o){d.a6.identity(n),d.a6.rotateZ(n,n,Cn(t[2])),d.a6.rotateX(n,n,Cn(t[0])),d.a6.rotateY(n,n,Cn(t[1])),d.a6.scale(n,n,o),d.a6.multiply(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function qg(n,t,o,l,h,f,g,v){const w=[o[0]-t[0],o[1]-t[1],0],E=[l[0]-t[0],l[1]-t[1],0];if(d.N.length(w)<1e-12||d.N.length(E)<1e-12)return d.bi.identity(n);const D=d.N.cross([],w,E);d.N.normalize(D,D),d.N.subtract(E,l,t),w[2]=(f-h)*v,E[2]=(g-h)*v;const I=w;return d.N.cross(I,w,E),d.N.normalize(I,I),d.bi.rotationTo(n,D,I)}function av(n,t,o=!1){const l=Xc(t.zoom),h=function(f,g,v){const w=g.worldSize,E=[f[12],f[13],f[14]],D=Dn(E[1]/w),I=tn(E[0]/w),P=d.a6.identity([]),L=en(1,D)*w,N=en(1,0)*w*yn(D,g.zoom),B=1/bp(w);let U=N*B;if(v){const ie=Hg(g.projection,g.zoom,g.width,g.height,1024);U=B*g.projection.pixelSpaceConversion(g.center.lat,w,ie)}const H=Pe(D,I);d.N.add(H,H,d.N.scale([],d.N.normalize([],H),L*U*E[2]));const Q=function(ie){const ue=[ie[0],ie[1],ie[2]];let ae=[0,1,0];const de=d.N.cross([],ae,ue);return d.N.cross(ae,ue,de),0===d.N.squaredLength(ae)&&(ae=[0,1,0],d.N.cross(de,ue,ae)),d.N.normalize(de,de),d.N.normalize(ae,ae),d.N.normalize(ue,ue),[de[0],de[1],de[2],0,ae[0],ae[1],ae[2],0,ue[0],ue[1],ue[2],0,ie[0],ie[1],ie[2],1]}(H);d.a6.scale(P,P,[U,U,U*L]),d.a6.translate(P,P,[-E[0],-E[1],-E[2]]);const ne=d.a6.multiply([],g.globeMatrix,Q);return d.a6.multiply(ne,ne,P),d.a6.multiply(ne,ne,f),ne}(n,t,o);return l>0?function(g,v,w){const E=(N,B,U)=>{const H=d.N.length(N),Q=d.N.length(B),ne=ja(N,B,U);return d.N.scale(ne,ne,1/d.N.length(ne)*rn(H,Q,U))},D=E([g[0],g[1],g[2]],[v[0],v[1],v[2]],w),I=E([g[4],g[5],g[6]],[v[4],v[5],v[6]],w),P=E([g[8],g[9],g[10]],[v[8],v[9],v[10]],w),L=ja([g[12],g[13],g[14]],[v[12],v[13],v[14]],w);return[D[0],D[1],D[2],0,I[0],I[1],I[2],0,P[0],P[1],P[2],0,L[0],L[1],L[2],1]}(h,function(g,v){const w=v.worldSize,E=en(1,0)*w*yn(v.center.lat,v.zoom)/bp(w),D=en(1,v.center.lat)*w,I=d.a6.identity([]);return d.a6.rotateY(I,I,Cn(v.center.lng)),d.a6.rotateX(I,I,Cn(v.center.lat)),d.a6.translate(I,I,[0,0,ee]),d.a6.scale(I,I,[E,E,E*D]),d.a6.translate(I,I,[v.point.x-.5*w,v.point.y-.5*w,0]),d.a6.multiply(I,I,g),d.a6.multiply(I,v.globeMatrix,I)}(n,t),l):h}function db(n,t,o,l){const h=Hi.projectAabbCorners(l,o);let f=Number.MAX_VALUE,g=-1;for(let E=0;E<h.length;++E){const D=h[E];D[0]=(.5*D[0]+.5)*t.width,D[1]=(.5-.5*D[1])*t.height,D[2]<f&&(g=E,f=D[2])}const v=E=>new ht(h[E][0],h[E][1]);let w;switch(g){case 0:case 6:w=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:w=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:w=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:w=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(Fs(n,w))return f}const fb=ei([{name:"a_pos_3f",components:3,type:"Float32"}]),df=ei([{name:"a_color_3f",components:3,type:"Float32"}]),vE=ei([{name:"a_color_4f",components:4,type:"Float32"}]),Zg=ei([{name:"a_uv_2f",components:2,type:"Float32"}]),xE=ei([{name:"a_normal_3f",components:3,type:"Float32"}]),bE=ei([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),wE=ei([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class pb{constructor(t,o){this.feature=t,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class mb{constructor(){this.instancedDataArray=new Yf,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class lv{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,o,l,h){this.tileToMeter=vn(l);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:v,index:w,sourceLayerIndex:E}of t){const D=mr(g,f);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),D,l))continue;const I={id:v,sourceLayerIndex:E,index:w,geometry:f?D.geometry:Ei(g,l,h),properties:g.properties,type:g.type,patterns:{}},P=this.addFeature(I,I.geometry,D);P&&o.featureIndex.insert(g,I.geometry,w,E,this.index,this.instancesPerModel[P].instancedDataArray.length,gt/32)}this.lookup=null}update(t,o,l,h){for(const f in this.instancesPerModel){const g=this.instancesPerModel[f];for(const v in t)g.idToFeaturesIndex.hasOwnProperty(v)&&this.evaluate(g.features[g.idToFeaturesIndex[v]],t[v],g,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const o in this.instancesPerModel){const l=this.instancesPerModel[o];for(const h of l.features){const f=this.layers[0],g=h.feature,v=this.canonical,w=f.paint.get("model-rotation").evaluate(g,{},v),E=f.paint.get("model-scale").evaluate(g,{},v),D=f.paint.get("model-translation").evaluate(g,{},v);d.N.exactEquals(h.rotation,w)&&d.N.exactEquals(h.scale,E)&&d.N.exactEquals(h.translation,D)||(this.evaluate(h,h.featureStates,l,!0),t=!0)}}return t}isEmpty(){for(const t in this.instancesPerModel)if(0!==this.instancesPerModel[t].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const o in this.instancesPerModel){const l=this.instancesPerModel[o];l.instancedDataArray.length<0||0===l.instancedDataArray.length||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=t.createVertexBuffer(l.instancedDataArray,bE.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const o=this.instancesPerModel[t];0!==o.instancedDataArray.length&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}}addFeature(t,o,l){const h=this.layers[0],f=h.layout.get("model-id").evaluate(l,{},this.canonical);if(!f)return tr(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),f;this.instancesPerModel[f]||(this.instancesPerModel[f]=new mb);const g=this.instancesPerModel[f],v=g.instancedDataArray,w=new pb(l,v.length);for(const E of o)for(const D of E){if(D.x<0||D.x>=gt||D.y<0||D.y>=gt)continue;const I=(this.lookupDim-1)/gt,P=this.lookupDim*(D.y*I|0)+D.x*I|0;if(this.lookup){if(0!==this.lookup[P])continue;this.lookup[P]=1}this.instanceCount++;const L=v.length;v.resize(L+1),g.instancesEvaluatedElevation.push(0),v.float32[16*L]=D.x,v.float32[16*L+1]=D.y}return w.instancedDataCount=g.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(t.id&&(g.idToFeaturesIndex[t.id]=g.features.length),g.features.push(w),this.evaluate(w,{},g,!1)),f}evaluate(t,o,l,h){const f=this.layers[0],g=t.feature,v=this.canonical,w=t.rotation=f.paint.get("model-rotation").evaluate(g,o,v),E=t.scale=f.paint.get("model-scale").evaluate(g,o,v),D=t.translation=f.paint.get("model-translation").evaluate(g,o,v),I=f.paint.get("model-color").evaluate(g,o,v);I.a=f.paint.get("model-color-mix-intensity").evaluate(g,o,v);const P=[];this.maxVerticalOffset<D[2]&&(this.maxVerticalOffset=D[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),hb(P,w,E);const L=Math.round(100*I.a)+I.b/1.05;for(let N=0;N<t.instancedDataCount;++N){const B=t.instancedDataOffset+N,U=16*B,H=l.instancedDataArray.float32;let Q=0;h&&(Q=H[U+6]-l.instancesEvaluatedElevation[B]);const ne=0|H[U+1];H[U]=(0|H[U])+I.r/1.05,H[U+1]=ne+I.g/1.05,H[U+2]=L,H[U+3]=1/(v.z>10?this.tileToMeter:vn(v,ne)),H[U+4]=D[0],H[U+5]=D[1],H[U+6]=D[2]+Q,H[U+7]=P[0],H[U+8]=P[1],H[U+9]=P[2],H[U+10]=P[4],H[U+11]=P[5],H[U+12]=P[6],H[U+13]=P[8],H[U+14]=P[9],H[U+15]=P[10],l.instancesEvaluatedElevation[B]=D[2]}}}Ct(lv,"ModelBucket",{omit:["layers"]}),Ct(mb,"PerModelAttributes"),Ct(pb,"ModelFeature");const EE=new Xi({visibility:new nt(Ce.layout_model.visibility),"model-id":new Vt(Ce.layout_model["model-id"])});var gb={paint:new Xi({"model-opacity":new nt(Ce.paint_model["model-opacity"]),"model-rotation":new Vt(Ce.paint_model["model-rotation"]),"model-scale":new Vt(Ce.paint_model["model-scale"]),"model-translation":new Vt(Ce.paint_model["model-translation"]),"model-color":new Vt(Ce.paint_model["model-color"]),"model-color-mix-intensity":new Vt(Ce.paint_model["model-color-mix-intensity"]),"model-type":new nt(Ce.paint_model["model-type"]),"model-cast-shadows":new nt(Ce.paint_model["model-cast-shadows"]),"model-receive-shadows":new nt(Ce.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new nt(Ce.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Vt(Ce.paint_model["model-emissive-strength"]),"model-roughness":new Vt(Ce.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Vt(Ce.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new nt(Ce.paint_model["model-cutoff-fade-range"])}),layout:EE};const ff={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function CE(n,t,o,l,h,f,g,v,w,E=!1){const D=o.zoom,I=o.project(l),P=yn(l.lat,D),L=1/P;d.a6.identity(n),d.a6.translate(n,n,[I.x+g[0]*L,I.y+g[1]*L,g[2]]);let N=1,B=1;const U=o.worldSize;if(E){if("mercator"===o.projection.name){let ie=0;o.elevation&&(ie=o.elevation.getAtPointOrZero(new zn(I.x/U,I.y/U),0));const ue=d.a7.transformMat4([],[I.x,I.y,ie,1],o.projMatrix)[3]/o.cameraToCenterDistance;N=ue,B=ue*yn(o.center.lat,D)}else if("globe"===o.projection.name){const ie=av(n,o),ue=d.a6.multiply([],o.projMatrix,ie),ae=[0,0,0,1];d.a7.transformMat4(ae,ae,ue);const de=ae[3]/o.cameraToCenterDistance,ye=Xc(D),be=o.projection.pixelsPerMeter(l.lat,U)*yn(l.lat,D),Te=o.projection.pixelsPerMeter(o.center.lat,U)*yn(o.center.lat,D);N=de/rn(be,Vi(o.center.lat),ye),B=de*P/be,N*=Te,B*=Te}}else N=L;d.a6.scale(n,n,[N,N,B]);const H=[...n],Q=t.orientation,ne=[];if(hb(ne,[Q[0]+h[0],Q[1]+h[1],Q[2]+h[2]],f),d.a6.multiply(n,H,ne),v&&o.elevation){let ie=0;const ue=[];if(w&&o.elevation){ie=function(ye,be,Te,we,Oe){const Ge=be.elevation;if(!Ge)return 0;const Re=Hi.projectAabbCorners(Te,we),Ve=en(1,Oe.lat)*be.worldSize,Ie=function(jt,un){const Ht=[0,0,1],dn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Jt of dn){const Pn=jt[Jt.corners[0]],sn=jt[Jt.corners[1]],_i=jt[Jt.corners[2]],Vn=[sn[0]-Pn[0],sn[1]-Pn[1],un*(sn[2]-Pn[2])],Fn=d.N.cross(Vn,Vn,[_i[0]-Pn[0],_i[1]-Pn[1],un*(_i[2]-Pn[2])]);d.N.normalize(Fn,Fn),Jt.dotProductWithUp=d.N.dot(Fn,Ht)}return dn.sort((Jt,Pn)=>Jt.dotProductWithUp-Pn.dotProductWithUp),dn[0].corners}(Re,Ve),je=Re[Ie[0]],lt=Re[Ie[1]],Be=Re[Ie[2]],yt=Re[Ie[3]],dt=Ge.getAtPointOrZero(new zn(je[0]/be.worldSize,je[1]/be.worldSize),0),Ze=Ge.getAtPointOrZero(new zn(lt[0]/be.worldSize,lt[1]/be.worldSize),0),qt=Ge.getAtPointOrZero(new zn(Be[0]/be.worldSize,Be[1]/be.worldSize),0),Ft=Ge.getAtPointOrZero(new zn(yt[0]/be.worldSize,yt[1]/be.worldSize),0),Tt=(dt+Ft)/2,We=(Ze+qt)/2;return Tt>We?Ze<qt?qg(ye,lt,yt,je,Ze,Ft,dt,Ve):qg(ye,Be,je,yt,qt,dt,Ft,Ve):dt<Ft?qg(ye,je,lt,Be,dt,Ze,qt,Ve):qg(ye,yt,Be,lt,Ft,qt,Ze,Ve),Math.max(Tt,We)}(ue,o,t.aabb,n,l);const ae=d.a6.fromQuat([],ue),de=d.a6.multiply([],ae,ne);d.a6.multiply(n,H,de)}else ie=o.elevation.getAtPointOrZero(new zn(I.x/U,I.y/U),0);0!==ie&&(n[14]+=ie)}}function pf(n,t,o=!1){n.uploaded||(n.gfxTexture=new Ch(t,n.image,o?t.gl.R8:t.gl.RGBA,{useMipmap:n.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function _b(n,t,o){n.indexBuffer=t.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=t.createVertexBuffer(n.vertexArray,fb.members,!1,!0),n.normalArray&&(n.normalBuffer=t.createVertexBuffer(n.normalArray,xE.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=t.createVertexBuffer(n.texcoordArray,Zg.members,!1,!0)),n.colorArray&&(n.colorBuffer=t.createVertexBuffer(n.colorArray,(12===n.colorArray.bytesPerElement?df:vE).members,!1,!0)),n.featureArray&&(n.pbrBuffer=t.createVertexBuffer(n.featureArray,wE.members,!0)),n.segments=Ki.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const l=n.material;l.pbrMetallicRoughness.baseColorTexture&&pf(l.pbrMetallicRoughness.baseColorTexture,t),l.pbrMetallicRoughness.metallicRoughnessTexture&&pf(l.pbrMetallicRoughness.metallicRoughnessTexture,t),l.normalTexture&&pf(l.normalTexture,t),l.occlusionTexture&&pf(l.occlusionTexture,t,o),l.emissionTexture&&pf(l.emissionTexture,t)}function yb(n,t,o){if(n.meshes)for(const l of n.meshes)_b(l,t,o);if(n.children)for(const l of n.children)yb(l,t,o)}function Th(n){if(n.meshes)for(const t of n.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(n.children)for(const t of n.children)Th(t)}function cv(n){if(n.meshes)for(const o of n.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((t=o.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(n.children)for(const o of n.children)cv(o)}class DE{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class uv{constructor(){this.tasks={},this.taskQueue=[],Ja(["process"],this),this.invoker=new DE(this.process),this.nextId=0}add(t,o){const l=this.nextId++,h=function({type:f,isSymbolTile:g,zoom:v}){return v=v||0,"message"===f?0:"maybePrepare"!==f||g?"parseTile"!==f||g?"parseTile"===f&&g?300-v:"maybePrepare"===f&&g?400-v:500:200-v:100-v}(o);if(0===h){Xs();try{t()}finally{}return null}return this.tasks[l]={fn:t,metadata:o,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){Xs();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const o=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let t=null,o=1/0;for(let h=0;h<this.taskQueue.length;h++){const f=this.tasks[this.taskQueue[h]];f.priority<o&&(o=f.priority,t=h)}if(null===t)return null;const l=this.taskQueue[t];return this.taskQueue.splice(t,1),l}remove(){this.invoker.remove()}}class vb{constructor(t,o,l){this.target=t,this.parent=o,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Ja(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new uv}send(t,o,l,h,f=!1,g){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=g,this.callbacks[v]=l);const w=new Set;return this.target.postMessage({id:v,type:t,hasCallback:!!l,targetMapId:h,mustQueue:f,sourceMapId:this.mapId,data:Xl(o,w)},w),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(t){const o=t.data,l=o.id;if(l&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(o.mustQueue||Xs()){const h=this.callbacks[l],f=this.scheduler.add(()=>this.processTask(l,o),h&&h.metadata||{type:"message"});f&&(this.cancelCallbacks[l]=f)}else this.processTask(l,o)}processTask(t,o){if(delete this.cancelCallbacks[t],"<response>"===o.type){const l=this.callbacks[t];delete this.callbacks[t],l&&(o.error?l(Uc(o.error)):l(null,Uc(o.data)))}else{const l=new Set,h=o.hasCallback?(g,v)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:g?Xl(g):null,data:Xl(v,l)},l)}:g=>{},f=Uc(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,f,h);else if(this.parent.getWorkerSource){const g=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,g[0],f.source,f.scope)[g[1]](f,h)}else h(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let ya=(()=>{class n{constructor(o,l){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=bc();const h=this.workerPool.acquire(this.id);for(let f=0;f<h.length;f++){const g=new n.Actor(h[f],l,this.id);g.name=`Worker ${f}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,l,h){Di(this.actors,(f,g)=>{f.send(o,l,g)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}return n.Actor=vb,n})();var uc={workerUrl:"",workerClass:null,workerParams:void 0};function Vo(){return null!=uc.workerClass?new uc.workerClass:new self.Worker(uc.workerUrl,uc.workerParams)}const hc="mapboxgl_preloaded_worker_pool";class su{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<su.workerCount;)this.workers.push(new Vo);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&0===this.numActive()&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[hc]}numActive(){return Object.keys(this.active).length}}let jo;function dc(){return jo||(jo=new su),jo}su.workerCount=2;let fc,au,Uo,Ha,lu,qa=null;function Mh(){return Xs()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:au||fn.DRACO_URL}function Ih(){if(Xs()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Ha)return Ha;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Ha=WebAssembly.validate(n)?fn.MESHOPT_SIMD_URL:fn.MESHOPT_URL,Ha}const pc={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},xb={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},mf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function hv(n,t,o){const l=o.json.bufferViews.length,h=o.buffers.length;t.bufferView=l,o.json.bufferViews[l]={buffer:h,byteLength:n.byteLength},o.buffers[h]=n}const Wg="KHR_draco_mesh_compression";function bb(n,t){const o=n.extensions&&n.extensions[Wg];if(!o)return;const l=new Uo.Decoder,h=ME(t,o.bufferView),f=new Uo.Mesh;if(!l.DecodeArrayToMesh(h,h.byteLength,f))throw new Error("Failed to decode Draco mesh");const g=t.json.accessors[n.indices],v=pc[g.componentType],w=g.count*v.BYTES_PER_ELEMENT,E=Uo._malloc(w);v===Uint16Array?l.GetTrianglesUInt16Array(f,w,E):l.GetTrianglesUInt32Array(f,w,E),hv(Uo.memory.buffer.slice(E,E+w),g,t),Uo._free(E);for(const D of Object.keys(o.attributes)){const I=l.GetAttributeByUniqueId(f,o.attributes[D]),P=t.json.accessors[n.attributes[D]],L=xb[P.componentType],N=P.count*mf[P.type]*pc[P.componentType].BYTES_PER_ELEMENT,B=Uo._malloc(N);l.GetAttributeDataArrayForAllPoints(f,I,Uo[L],N,B),hv(Uo.memory.buffer.slice(B,B+N),P,t),Uo._free(B)}l.destroy(),f.destroy(),delete n.extensions[Wg]}const Xp="EXT_meshopt_compression";function wb(n,t){if(!n.extensions||!n.extensions[Xp])return;const o=n.extensions[Xp],l=new Uint8Array(t.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),h=new Uint8Array(o.count*o.byteStride);lu.decodeGltfBuffer(h,o.count,o.byteStride,l,o.mode,o.filter),n.buffer=t.buffers.length,n.byteOffset=0,t.buffers[n.buffer]=h.buffer,delete n.extensions[Xp]}const dv=1179937895,fv=new TextDecoder("utf8");function Yg(n,t){return new URL(n,t).href}function TE(n,t,o,l){return fetch(Yg(n.uri,l)).then(h=>h.arrayBuffer()).then(h=>{t.buffers[o]=h})}function ME(n,t){const o=n.json.bufferViews[t];return new Uint8Array(n.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function wT(n,t,o,l){if(n.uri){const h=Yg(n.uri,l);return fetch(h).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{t.images[o]=f})}if(void 0!==n.bufferView){const h=ME(t,n.bufferView),f=new Blob([h],{type:n.mimeType});return createImageBitmap(f).then(g=>{t.images[o]=g})}}function Eb(n,t=0,o){const l={json:null,images:[],buffers:[]};if(new Uint32Array(n,t,1)[0]===dv){const D=new Uint32Array(n,t);let I=2;const P=(D[I++]>>2)-3,L=D[I++]>>2;if(I++,l.json=JSON.parse(fv.decode(D.subarray(I,I+L))),I+=L,I<P){const N=D[I++];I++;const B=t+(I<<2);l.buffers[0]=n.slice(B,B+N)}}else l.json=JSON.parse(fv.decode(new Uint8Array(n,t)));const{buffers:h,images:f,meshes:g,extensionsUsed:v,bufferViews:w}=l.json;let E=Promise.resolve();if(h){const D=[];for(let I=0;I<h.length;I++){const P=h[I];P.uri?D.push(TE(P,l,I,o)):l.buffers[I]||(l.buffers[I]=null)}E=Promise.all(D)}return E.then(()=>{const D=[],I=v&&v.includes(Wg),P=v&&v.includes(Xp);if(I&&D.push(function(){if(!Uo)return fc||(fc=function(L){let N,B=null;function U(){N=new Uint8Array(B.buffer)}function H(){throw new Error("Unexpected Draco error.")}const Q={a:{a:H,d:function(ne,ie,ue){return N.copyWithin(ne,ie,ie+ue)},c:function(ne){const ie=N.length,ue=Math.max(ne>>>0,Math.ceil(1.2*ie)),ae=Math.ceil((ue-ie)/65536);try{return B.grow(ae),U(),!0}catch{return!1}},b:H}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(L,Q):L.then(ne=>ne.arrayBuffer()).then(ne=>WebAssembly.instantiate(ne,Q))).then(ne=>{const{Rb:ie,Qb:ue,P:ae,T:de,X:ye,Ja:be,La:Te,Qa:we,Va:Oe,Wa:Ge,eb:Re,jb:Ve,f:Ie,e:je,yb:lt,zb:Be,Ab:yt,Bb:dt,Db:Ze,Gb:qt}=ne.instance.exports;B=je;const Ft=(()=>{let Tt=0,We=0,jt=0,un=0;return Ht=>{jt&&(ie(un),ie(Tt),We+=jt,jt=Tt=0),Tt||(We+=128,Tt=ue(We));const dn=Ht.length+7&-8;let Jt=Tt;dn>=We&&(jt=dn,Jt=un=ue(dn));for(let Pn=0;Pn<Ht.length;Pn++)N[Jt+Pn]=Ht[Pn];return Jt}})();return U(),Ie(),{memory:je,_free:ie,_malloc:ue,Mesh:class{constructor(){this.ptr=ae()}destroy(){de(this.ptr)}},Decoder:class{constructor(){this.ptr=be()}destroy(){Ve(this.ptr)}DecodeArrayToMesh(Tt,We,jt){const un=Ft(Tt),Ht=Te(this.ptr,un,We,jt.ptr);return!!ye(Ht)}GetAttributeByUniqueId(Tt,We){return{ptr:we(this.ptr,Tt.ptr,We)}}GetTrianglesUInt16Array(Tt,We,jt){Oe(this.ptr,Tt.ptr,We,jt)}GetTrianglesUInt32Array(Tt,We,jt){Ge(this.ptr,Tt.ptr,We,jt)}GetAttributeDataArrayForAllPoints(Tt,We,jt,un,Ht){Re(this.ptr,Tt.ptr,We.ptr,jt,un,Ht)}},DT_INT8:lt(),DT_UINT8:Be(),DT_INT16:yt(),DT_UINT16:dt(),DT_UINT32:Ze(),DT_FLOAT32:qt()}})}(fetch(Mh())),fc.then(L=>{Uo=L,fc=void 0}))}()),P&&D.push(function(){if(lu)return;const L=function(N){let B;const U=WebAssembly.instantiateStreaming(N,{}).then(ne=>{B=ne.instance,B.exports.__wasm_call_ctors()}),H={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Q={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:U,supported:!0,decodeGltfBuffer(ne,ie,ue,ae,de,ye){!function(be,Te,we,Oe,Ge,Re,Ve){const Ie=be.exports.sbrk,je=Oe+3&-4,lt=Ie(je*Ge),Be=Ie(Re.length),yt=new Uint8Array(be.exports.memory.buffer);yt.set(Re,Be);const dt=Te(lt,Oe,Ge,Be,Re.length);if(0===dt&&Ve&&Ve(lt,je,Ge),we.set(yt.subarray(lt,lt+Oe*Ge)),Ie(lt-Ie(0)),0!==dt)throw new Error(`Malformed buffer data: ${dt}`)}(B,B.exports[Q[de]],ne,ie,ue,ae,B.exports[H[ye]])}}}(fetch(Ih()));return L.ready.then(()=>{lu=L})}()),f)for(let L=0;L<f.length;L++)D.push(wT(f[L],l,L,o));return(D.length?Promise.all(D):Promise.resolve()).then(()=>{if(I&&g)for(const{primitives:L}of g)for(const N of L)bb(N,l);if(P&&g&&w)for(const L of w)wb(L,l);return l})})}class Cb{constructor(t,o,l){if(this.triangleCount=o.length/3,this.min=new ht(0,0),this.max=new ht(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===t.length||0===l)return;const h=t.map(D=>D.x),f=t.map(D=>D.y);this.min=new ht(Math.min(...h),Math.min(...f)),this.max=new ht(Math.max(...h),Math.max(...f));const g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);const v=Math.max(g.x,g.y)/l;this.cellsX=Math.max(1,Math.ceil(g.x/v)),this.cellsY=Math.max(1,Math.ceil(g.y/v)),this.xScale=1/v,this.yScale=1/v;const w=[];for(let D=0;D<this.triangleCount;D++){const I=t[o[3*D+0]].sub(this.min),P=t[o[3*D+1]].sub(this.min),L=t[o[3*D+2]].sub(this.min),N=Sh(Math.floor(Math.min(I.x,P.x,L.x)),this.xScale,this.cellsX),B=Sh(Math.floor(Math.max(I.x,P.x,L.x)),this.xScale,this.cellsX),U=Sh(Math.floor(Math.min(I.y,P.y,L.y)),this.yScale,this.cellsY),H=Sh(Math.floor(Math.max(I.y,P.y,L.y)),this.yScale,this.cellsY),Q=new ht(0,0),ne=new ht(0,0),ie=new ht(0,0),ue=new ht(0,0);for(let ae=U;ae<=H;++ae){Q.y=ne.y=ae*v,ie.y=ue.y=(ae+1)*v;for(let de=N;de<=B;++de)Q.x=ie.x=de*v,ne.x=ue.x=(de+1)*v,(v0(I,P,L,Q,ne,ue)||v0(I,P,L,Q,ue,ie))&&w.push({cellIdx:ae*this.cellsX+de,triIdx:D})}}if(0===w.length)return;w.sort((D,I)=>D.cellIdx-I.cellIdx||D.triIdx-I.triIdx);let E=0;for(;E<w.length;){const D=w[E].cellIdx,I={start:this.payload.length,len:0};for(;E<w.length&&w[E].cellIdx===D;)++I.len,this.payload.push(w[E++].triIdx);this.cells[D]=I}}query(t,o,l){if(0===this.triangleCount||0===this.cells.length||t.x>this.max.x||this.min.x>o.x||t.y>this.max.y||this.min.y>o.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let w=0;w<this.lookup.length;w++)this.lookup[w]=0;const h=Sh(t.x-this.min.x,this.xScale,this.cellsX),f=Sh(o.x-this.min.x,this.xScale,this.cellsX),g=Sh(t.y-this.min.y,this.yScale,this.cellsY),v=Sh(o.y-this.min.y,this.yScale,this.cellsY);for(let w=g;w<=v;w++)for(let E=h;E<=f;E++){const D=this.cells[w*this.cellsX+E];if(D)for(let I=0;I<D.len;I++){const P=this.payload[D.start+I],L=Math.floor(P/8),N=1<<P%8;if(!(this.lookup[L]&N)&&(this.lookup[L]|=N,l.push(P),l.length===this.triangleCount))return}}}}function Sh(n,t,o){return Math.max(0,Math.min(o-1,Math.floor(n*t)))}function Ah(n,t){const o=n.json.bufferViews[t.bufferView],l=pc[t.componentType];return new l(n.buffers[o.buffer],(t.byteOffset||0)+(o.byteOffset||0),t.count*(o.byteStride&&o.byteStride!==mf[t.type]*l.BYTES_PER_ELEMENT?o.byteStride/l.BYTES_PER_ELEMENT:mf[t.type]))}function Db(n,t,o,l){const h=pc[t.componentType],f=function(D){switch(D){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),g=n.json.bufferViews[t.bufferView],v=g.byteStride?g.byteStride/h.BYTES_PER_ELEMENT:mf[t.type],w=o.float32,E=w.length/o.capacity;for(let D=0,I=0;D<t.count*v;D+=v,I+=E)for(let P=0;P<E;P++)w[I+P]=l[D+P]*f;o._trim()}function IE(n,t,o){const l=n.indices,h=n.attributes,f={};f.indexArray=new Ir;const g=t.json.accessors[l],v=g.count/3;f.indexArray.reserve(v);const w=Ah(t,g);for(let P=0;P<v;P++)f.indexArray.emplaceBack(w[3*P],w[3*P+1],w[3*P+2]);f.indexArray._trim(),f.vertexArray=new ps;const E=t.json.accessors[h.POSITION];f.vertexArray.reserve(E.count);const D=Ah(t,E);for(let P=0;P<E.count;P++)f.vertexArray.emplaceBack(D[3*P],D[3*P+1],D[3*P+2]);if(f.vertexArray._trim(),f.aabb=new Hi(E.min,E.max),f.centroid=function(P,L){const N=[0,0,0],B=P.length;if(B>0){for(let U=0;U<B;U++){const H=3*P[U];N[0]+=L[H],N[1]+=L[H+1],N[2]+=L[H+2]}N[0]/=B,N[1]/=B,N[2]/=B}return N}(w,D),void 0!==h.COLOR_0){const P=t.json.accessors[h.COLOR_0],L=mf[P.type],N=Ah(t,P);f.colorArray=3===L?new ps:new ka,f.colorArray.resize(P.count),Db(t,P,f.colorArray,N)}if(void 0!==h.NORMAL){f.normalArray=new ps;const P=t.json.accessors[h.NORMAL];f.normalArray.resize(P.count);const L=Ah(t,P);Db(t,P,f.normalArray,L)}if(void 0!==h.TEXCOORD_0&&o.length>0){f.texcoordArray=new Ju;const P=t.json.accessors[h.TEXCOORD_0];f.texcoordArray.resize(P.count);const L=Ah(t,P);Db(t,P,f.texcoordArray,L)}if(void 0!==h._FEATURE_ID_RGBA4444){const P=t.json.accessors[h._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=Ah(t,P))}void 0!==h._FEATURE_RGBA4444&&(f.featureData=new Uint32Array(Ah(t,t.json.accessors[h._FEATURE_RGBA4444]).buffer));const I=n.material;return f.material=function(P,L){const{emissiveFactor:N=[0,0,0],alphaMode:B="OPAQUE",alphaCutoff:U=.5,normalTexture:H,occlusionTexture:Q,emissiveTexture:ne,doubleSided:ie}=P,{baseColorFactor:ue=[1,1,1,1],metallicFactor:ae=1,roughnessFactor:de=1,baseColorTexture:ye,metallicRoughnessTexture:be}=P.pbrMetallicRoughness||{},Te=Q?L[Q.index]:void 0;if(Q&&Q.extensions&&Q.extensions.KHR_texture_transform&&Te){const we=Q.extensions.KHR_texture_transform;Te.offsetScale=[we.offset[0],we.offset[1],we.scale[0],we.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new ir(...ue),metallicFactor:ae,roughnessFactor:de,baseColorTexture:ye?L[ye.index]:void 0,metallicRoughnessTexture:be?L[be.index]:void 0},doubleSided:ie,emissiveFactor:N,alphaMode:B,alphaCutoff:U,normalTexture:H?L[H.index]:void 0,occlusionTexture:Te,emissionTexture:ne?L[ne.index]:void 0,defined:void 0===P.defined}}(void 0!==I?t.json.materials[I]:{defined:!1},o),f}function Tb(n,t,o){const{matrix:l,rotation:h,translation:f,scale:g,mesh:v,extras:w,children:E}=n,D={};if(D.matrix=l||d.a6.fromRotationTranslationScale([],h||[0,0,0,1],f||[0,0,0],g||[1,1,1]),void 0!==v){D.meshes=o[v];const I=D.anchor=[0,0];for(const P of D.meshes){const{min:L,max:N}=P.aabb;I[0]+=L[0]+N[0],I[1]+=L[1]+N[1]}I[0]=Math.floor(I[0]/D.meshes.length/2),I[1]=Math.floor(I[1]/D.meshes.length/2)}if(w&&(w.id&&(D.id=w.id),w.lights&&(D.lights=function(I){if(!I.length)return[];const P=function(H){const Q=atob(H),ne=new Uint8Array(Q.length);for(let ie=0;ie<Q.length;ie++)ne[ie]=Q.codePointAt(ie);return ne}(I),L=[],N=P.length/24,B=new Uint16Array(P.buffer),U=new Float32Array(P.buffer);for(let H=0;H<N;H++){const Q=B[2*H*6]/30,ne=B[2*H*6+1]/30,ie=B[2*H*6+10]/100,ue=U[6*H+1],ae=U[6*H+2],de=U[6*H+3],ye=U[6*H+4],be=de-ue,Te=ye-ae,we=Math.hypot(be,Te);L.push({pos:[ue+.5*be,ae+.5*Te,ne],normal:[Te/we,-be/we,0],width:we,height:Q,depth:ie,points:[ue,ae,de,ye]})}return L}(w.lights))),E){const I=[];for(const P of E)I.push(Tb(t.json.nodes[P],t,o));D.children=I}return D}function SE(n){if(0===n.vertices.length||0===n.indices.length)return null;const[t,o]=[n.vertices[0].clone(),n.vertices[0].clone()];for(let g=1;g<n.vertices.length;++g){const v=n.vertices[g];t.x=Math.min(t.x,v.x),t.y=Math.min(t.y,v.y),o.x=Math.max(o.x,v.x),o.y=Math.max(o.y,v.y)}const l=Math.ceil(Math.max(o.x-t.x,o.y-t.y)/256),h=Math.max(8,l),f=new Cb(n.vertices,n.indices,h);return{vertices:n.vertices,indices:n.indices,grid:f,min:t,max:o}}function pv(n){if(!n.extras||!n.extras.ground)return null;const t=n.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const o=t[0];if(!o||!Array.isArray(o)||0===o.length)return null;const l=[];for(const g of o){if(!Array.isArray(g)||2!==g.length)continue;const v=g[0],w=g[1];"number"==typeof v&&"number"==typeof w&&l.push(new ht(v,w))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let h=0;for(let g=0;g<l.length;g++){const v=l[g],w=l[(g+1)%l.length],E=l[(g+2)%l.length];h+=(v.x-w.x)*(E.y-w.y)-(E.x-w.x)*(v.y-w.y)}h>0&&l.reverse();const f=ug(l.flatMap(g=>[g.x,g.y]),[]);return 0===f.length?null:{vertices:l,indices:f}}function Kp(n){const t=[],o=[];let l=0;for(const h of n){l=t.length;const f=h.vertexArray.float32,g=h.indexArray.uint16;for(let v=0;v<h.vertexArray.length;v++)t.push(new ht(f[3*v+0],f[3*v+1]));for(let v=0;v<3*h.indexArray.length;v++)o.push(g[v]+l)}if(o.length%3!=0)return null;for(let h=0;h<o.length;h+=3){const f=t[o[h+0]],g=t[o[h+1]],v=t[o[h+2]];(f.x-g.x)*(v.y-g.y)-(v.x-g.x)*(f.y-g.y)>0&&([o[h+1],o[h+2]]=[o[h+2],o[h+1]])}return{vertices:t,indices:o}}function Xg(n){const o=function(w,E){const D=[];for(const I of w.json.meshes){const P=[];for(const L of I.primitives)P.push(IE(L,w,E));D.push(P)}return D}(n,function(w,E){const D=[],I=WebGL2RenderingContext;if(w.json.textures)for(const P of w.json.textures){const L={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};void 0!==P.sampler&&Object.assign(L,w.json.samplers[P.sampler]),D.push({image:E[P.source],sampler:L,uploaded:!1})}return D}(n,n.images)),{scenes:l,scene:h,nodes:f}=n.json,g=l?l[h||0].nodes:f,v=[];for(const w of g)v.push(Tb(f[w],n,o));return function(w,E,D){const I={},P=new Set;for(let L=0;L<w.length;L++){const N=D[E[L]];if(!N.extras)continue;const B=N.extras["mapbox:footprint:version"],U=N.extras["mapbox:footprint:id"];(B||U)&&P.add(L),"1.0.0"===B&&U&&(I[U]=L)}for(let L=0;L<w.length;L++){if(P.has(L))continue;const N=w[L],B=D[E[L]];if(!B.extras)continue;let U=null;N.id in I&&(U=Kp(w[I[N.id]].meshes)),U||(U=pv(B)),U&&(N.footprint=SE(U))}if(P.size>0){const L=Array.from(P.values()).sort((N,B)=>N-B);for(let N=L.length-1;N>=0;N--)w.splice(L[N],1)}}(v,g,n.json.nodes),v}function Kg(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const t=n.vertexArray.float32,o=n.aabb.min[0]-1,l=n.aabb.min[1]-1,h=64/(n.aabb.max[0]-o+2),f=64/(n.aabb.max[1]-l+2);for(let g=0;g<t.length;g+=3){const v=t[g+2],w=(t[g+0]-o)*h|0,E=(t[g+1]-l)*f|0;v>n.heightmap[64*E+w]&&(n.heightmap[64*E+w]=v)}}function Mb(n,t){const o={};o.indexArray=new Ir,o.indexArray.reserve(4*n.length),o.vertexArray=new ps,o.vertexArray.reserve(10*n.length),o.colorArray=new ka,o.vertexArray.reserve(10*n.length);let l=0;for(const g of n){const v=Math.min(10,Math.max(4,1.3*g.height))*t,w=[-g.normal[1],g.normal[0],0],E=Math.min(.29,.1*g.width/g.depth),D=g.width-2*g.depth*t*(E+.01),I=d.N.scaleAndAdd([],g.pos,w,D/2),P=d.N.scaleAndAdd([],g.pos,w,-D/2),L=[I[0],I[1],I[2]+g.height],N=[P[0],P[1],P[2]+g.height],B=d.N.scaleAndAdd([],g.normal,w,E);d.N.scale(B,B,v);const U=d.N.scaleAndAdd([],g.normal,w,-E);d.N.scale(U,U,v),d.N.add(B,I,B),d.N.add(U,P,U),I[2]+=.1,P[2]+=.1,o.vertexArray.emplaceBack(B[0],B[1],B[2]),o.vertexArray.emplaceBack(U[0],U[1],U[2]),o.vertexArray.emplaceBack(I[0],I[1],I[2]),o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(L[0],L[1],L[2]),o.vertexArray.emplaceBack(N[0],N[1],N[2]),o.vertexArray.emplaceBack(I[0],I[1],I[2]),o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(B[0],B[1],B[2]),o.vertexArray.emplaceBack(U[0],U[1],U[2]);const H=D/v/2;o.colorArray.emplaceBack(-H-E,-1,H,.8),o.colorArray.emplaceBack(H+E,-1,H,.8),o.colorArray.emplaceBack(-H,0,H,1.3),o.colorArray.emplaceBack(H,0,H,1.3),o.colorArray.emplaceBack(H+E,-.8,H,.7),o.colorArray.emplaceBack(H+E,-.8,H,.7),o.colorArray.emplaceBack(0,0,H,1.3),o.colorArray.emplaceBack(0,0,H,1.3),o.colorArray.emplaceBack(H+E,-1.2,H,.8),o.colorArray.emplaceBack(H+E,-1.2,H,.8),o.indexArray.emplaceBack(6+l,4+l,8+l),o.indexArray.emplaceBack(7+l,9+l,5+l),o.indexArray.emplaceBack(0+l,1+l,2+l),o.indexArray.emplaceBack(1+l,3+l,2+l),l+=10}const h={defined:!0,emissiveFactor:[0,0,0]},f={};return f.baseColorFactor=ir.white,h.pbrMetallicRoughness=f,o.material=h,o.aabb=new Hi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}Ct(Cb,"TriangleGridIndex");class gf{constructor(t){this._stringToNumber={},this._numberToString=[];for(let o=0;o<t.length;o++){const l=t[o];this._stringToNumber[l]=o,this._numberToString[o]=l}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const Ib=["tile","layer","source","sourceLayer","state"];class Sb{constructor(t,o,l,h,f){this.type="Feature",this._vectorTileFeature=t,this._z=o,this._x=l,this._y=h,this.properties=t.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const o of Ib)void 0!==this[o]&&(t[o]=this[o]);return t}}class _f{constructor(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ml(gt,16,0),this.featureIndexArray=new kd,this.promoteId=o,this.is3DTile=!1}insert(t,o,l,h,f,g=0,v=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,f,g);const E=this.grid;for(let D=0;D<o.length;D++){const I=o[D],P=[1/0,1/0,-1/0,-1/0];for(let L=0;L<I.length;L++){const N=I[L];P[0]=Math.min(P[0],N.x),P[1]=Math.min(P[1],N.y),P[2]=Math.max(P[2],N.x),P[3]=Math.max(P[3],N.y)}0!==v&&(P[0]-=v,P[1]-=v,P[2]+=v,P[3]+=v),P[0]<gt&&P[1]<gt&&P[2]>=0&&P[3]>=0&&E.insert(w,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new pg(new vh(this.rawTileData)).layers,this.sourceLayerCoder=new gf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,o,l,h){this.loadVTLayers();const f=t.params||{},g=Yo(f.filter),v=t.tileResult,w=t.transform,E=v.bufferedTilespaceBounds,D=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(N,B,U,H)=>ow(v.bufferedTilespaceGeometry,N,B,U,H));D.sort(AE);let I=null;w.elevation&&D.length>0&&(I=ga.create(w.elevation,this.tileID));const P={};let L;for(let N=0;N<D.length;N++){const B=D[N];if(B===L)continue;L=B;const U=this.featureIndexArray.get(B);let H=null;if(this.is3DTile){const Q=this.bucketLayerIDs[0][0],ne=o[Q];if("model"!==ne.type)continue;const{queryFeature:ie,intersectionZ:ue}=ne.queryIntersectsMatchingFeature(v,U.featureIndex,g,w);ie&&this.appendToResult(P,Q,U.featureIndex,ie,ue)}else this.loadMatchingFeature(P,U,g,f.layers,f.availableImages,o,l,h,(Q,ne,ie,ue=0)=>(H||(H=Ei(Q,this.tileID.canonical,t.tileTransform)),ne.queryIntersectsFeature(v,Q,ie,H,this.z,t.transform,t.pixelPosMatrix,I,ue)))}return P}loadMatchingFeature(t,o,l,h,f,g,v,w,E){const{featureIndex:D,bucketIndex:I,sourceLayerIndex:P,layoutVertexArrayOffset:L}=o,N=this.bucketLayerIDs[I];if(h&&!function(Q,ne){for(let ie=0;ie<Q.length;ie++)if(ne.indexOf(Q[ie])>=0)return!0;return!1}(h,N))return;const B=this.sourceLayerCoder.decode(P),U=this.vtLayers[B].feature(D);if(l.needGeometry){const Q=mr(U,!0);if(!l.filter(new Mi(this.tileID.overscaledZ),Q,this.tileID.canonical))return}else if(!l.filter(new Mi(this.tileID.overscaledZ),U))return;const H=this.getId(U,B);for(let Q=0;Q<N.length;Q++){const ne=N[Q];if(h&&h.indexOf(ne)<0)continue;const ie=g[ne];if(!ie)continue;let ue={};void 0!==H&&w&&(ue=w.getState(ie.sourceLayer||"_geojsonTileLayer",H));const ae=!E||E(U,ie,ue,L);if(!ae)continue;const de=new Sb(U,this.z,this.x,this.y,H),ye=Vr({},v[ne]);ye.paint=Ab(ye.paint,ie.paint,U,ue,f),ye.layout=Ab(ye.layout,ie.layout,U,ue,f),de.layer=ye,this.appendToResult(t,ne,D,de,ae)}}appendToResult(t,o,l,h,f){let g=t[o];void 0===g&&(g=t[o]=[]),g.push({featureIndex:l,feature:h,intersectionZ:f})}lookupSymbolFeatures(t,o,l,h,f,g,v,w){const E={};this.loadVTLayers();const D=Yo(f);for(const I of t)this.loadMatchingFeature(E,{bucketIndex:l,sourceLayerIndex:h,featureIndex:I,layoutVertexArrayOffset:0},D,g,v,w,o);return E}loadFeature(t){const{featureIndex:o,sourceLayerIndex:l}=t;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),f=this.vtFeatures[h];if(f[o])return f[o];const g=this.vtLayers[h].feature(o);return f[o]=g,g}hasLayer(t){for(const o of this.bucketLayerIDs)for(const l of o)if(t===l)return!0;return!1}getId(t,o){let l=t.id;if(this.promoteId){const h="string"==typeof this.promoteId?this.promoteId:this.promoteId[o];null!=h&&(l=t.properties[h]),"boolean"==typeof l&&(l=Number(l))}return l}}function Ab(n,t,o,l,h){return si(n,(f,g)=>{const v=t instanceof Gc?t.get(g):null;return v&&v.evaluate?v.evaluate(o,l,h):v})}function AE(n,t){return t-n}Ct(_f,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const mv=new Float32Array(262144),Rh=new Uint8Array(262144);function Jg(n){let t=0;if(n.meshes)for(const o of n.meshes)t=Math.max(t,o.aabb.max[2]);if(n.children)for(const o of n.children)t=Math.max(t,Jg(o));return t}function Jp(n,t,o){if(n.meshes)for(const l of n.meshes)l.aabb.min[0]!==1/0&&o.insert(t,l.aabb.min[0],l.aabb.min[1],l.aabb.max[0],l.aabb.max[1]);if(n.children)for(const l of n.children)Jp(l,t,o)}const Qp=["","wall","door","roof","window","lamp","logo"];class RE{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:Jg(t)}}}getLocalBounds(){if(!this.node.meshes)return new Hi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const o=new Hi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==t&&o.encapsulate(l.aabb),t++;this.aabb=o}return this.aabb}}class Qg{constructor(t,o,l,h,f,g){this.id=o,this.modelTraits|=ff.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,l&&(this.modelTraits|=ff.HasMapboxMeshFeatures),h&&(this.modelTraits|=ff.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const v of t)this.nodesInfo.push(new RE(v)),Jp(v,g.featureIndexArray.length,g.grid),g.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,g.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const l of o){const h=l.node;this.uploaded?this.updatePbrBuffer(h):yb(h,t,!0)}for(const l of o)Th(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let o=!1;if(!t.meshes)return o;for(const l of t.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),o=!0);return o}needsReEvaluation(t,o,l){const h=t.transform.projectionOptions,f=t.style.getBrightness(),g=this.brightness!==f;return!!(!this.uploaded||this.dirty||h.name!==this.projection.name||em(l.paint.get("model-color").value,g)||em(l.paint.get("model-color-mix-intensity").value,g)||em(l.paint.get("model-roughness").value,g)||em(l.paint.get("model-emissive-strength").value,g)||em(l.paint.get("model-height-based-emissive-strength-multiplier").value,g))&&(this.projection=h,this.brightness=f,!0)}evaluateScale(t,o){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const l=this.getNodesInfo(),h=this.id.canonical;for(const f of l){const g=f.feature;f.evaluatedScale=o.paint.get("model-scale").evaluate(g,{},h)}}evaluate(t){const o=this.getNodesInfo();for(const l of o){if(!l.node.meshes)continue;const h=l.feature,f=l.node.meshes&&l.node.meshes[0].featureData,g=l.evaluatedColor[2],v=l.evaluatedRMEA[2],w=this.id.canonical;if(l.hasTranslucentParts=!1,f){for(let E=0;E<Qp.length;E++){const D=Qp[E];D.length&&(h.properties.part=D);const I=t.paint.get("model-color").evaluate(h,{},w),P=t.paint.get("model-color-mix-intensity").evaluate(h,{},w);l.evaluatedColor[E]=[I.r,I.g,I.b,P],l.evaluatedRMEA[E][0]=t.paint.get("model-roughness").evaluate(h,{},w),l.evaluatedRMEA[E][2]=t.paint.get("model-emissive-strength").evaluate(h,{},w),l.evaluatedRMEA[E][3]=I.a,l.emissionHeightBasedParams[E]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,{},w),!l.hasTranslucentParts&&I.a<1&&(l.hasTranslucentParts=!0)}delete h.properties.part,PE(l,g!==l.evaluatedColor[2]||v!==l.evaluatedRMEA[2],this.modelTraits)}else l.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(h,{},w);l.evaluatedScale=t.paint.get("model-scale").evaluate(h,{},w),this.updatePbrBuffer(l.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,o,l,h){const f=t.findDEMTileFor(l);if(f&&(f.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const g=ga.create(t,l,f);if(!g)return;this.modelTraits&ff.HasMapboxMeshFeatures&&this.updateDEM(t,g,l,h);for(const v of this.getNodesInfo()){const w=v.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const E=w.footprint.vertices;let D=g.getElevationAt(E[0].x,E[0].y,!0,!0);for(let I=1;I<E.length;I++)D=Math.min(D,g.getElevationAt(E[I].x,E[I].y,!0,!0));w.elevation=D}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=o}}updateDEM(t,o,l,h){let f=o._dem._modifiedForSources[h];if(void 0===f&&(o._dem._modifiedForSources[h]=[],f=o._dem._modifiedForSources[h]),f.includes(l.canonical))return;const g=o._dem.dim;f.push(l.canonical);let v=!1;for(const w of this.getNodesInfo()){const E=w.node;if(!E.footprint||!E.footprint.grid)continue;const D=E.footprint.grid,I=o.tileCoordToPixel(D.min.x,D.min.y),P=o.tileCoordToPixel(D.max.x,D.max.y),L=Math.min(Math.min(g-P.y,I.x),Math.min(I.y,g-P.x));if(L<0)continue;const N=on(L,2,5);let B=Math.max(0,I.x-N),U=Math.max(0,I.y-N),H=Math.min(P.x+N,g-1),Q=Math.min(P.y+N,g-1);for(let ae=U;ae<=Q;++ae)for(let de=B;de<=H;++de)Rh[ae*g+de]=255;let ne=0,ie=0;for(let ae=0;ae<D.cellsY;++ae)for(let de=0;de<D.cellsX;++de){if(!D.cells[ae*D.cellsX+de])continue;const ye=o.tileCoordToPixel(D.min.x+de/D.xScale,D.min.y+ae/D.yScale),be=o.tileCoordToPixel(D.min.x+(de+1)/D.xScale,D.min.y+(ae+1)/D.yScale);for(let Te=ye.y;Te<=Math.min(be.y+1,g-1);++Te)for(let we=ye.x;we<=Math.min(be.x+1,g-1);++we)255===Rh[Te*g+we]&&(Rh[Te*g+we]=0,ne+=o.getElevationAtPixel(we,Te),ie++)}const ue=ne/ie;B=Math.max(1,I.x-N),U=Math.max(1,I.y-N),H=Math.min(P.x+N,g-2),Q=Math.min(P.y+N,g-2),v=!0;for(let ae=U;ae<=Q;++ae)for(let de=B;de<=H;++de)0===Rh[ae*g+de]&&(mv[ae*g+de]=o._dem.set(de,ae,ue));for(let ae=1;ae<N;++ae){B=Math.max(1,I.x-ae),U=Math.max(1,I.y-ae),H=Math.min(P.x+ae,g-2),Q=Math.min(P.y+ae,g-2);for(let de=U;de<=Q;++de)for(let ye=B;ye<=H;++ye){const be=de*g+ye;if(255===Rh[be]){let Te=0,we=0,Oe=-1,Ge=-1;for(let Re=-1;Re<=1;++Re)for(let Ve=-1;Ve<=1;++Ve){const Ie=(de+Re)*g+ye+Ve;if(Rh[Ie]>=ae)continue;const je=mv[Ie],lt=Math.abs(je);lt>we&&(Te=je,we=lt,Oe=Ve,Ge=Re)}if(we>.1){const Re=1-(ae+.5*Math.abs(Oe*Ge))/N;let Ve=o._dem.get(ye,de)+Te*Re;const Ie=o._dem.get(ye+Oe,de+Ge),je=o._dem.get(ye-Oe,de-Ge,!0);(Ve-Ie)*(Ve-je)>0&&(Ve=(Ie+je)/2),mv[be]=o._dem.set(ye,de,Ve),Rh[be]=ae}}}}}v&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=Xe.now())}getNodesInfo(){return this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const o of t)Th(o.node),cv(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const l=o.getReplacementRegionsForTile(t.toUnwrapped()),h=this.getNodesInfo();for(let f=0;f<this.nodesInfo.length;f++){const g=h[f].node;h[f].hiddenByReplacement=!!g.footprint&&!l.find(v=>v.footprint===g.footprint)}}getHeightAtTileCoord(t,o){const l=this.getNodesInfo(),h=[];for(let f=0;f<this.nodesInfo.length;f++){const g=l[f],v=g.node.meshes[0];if(t<v.aabb.min[0]||o<v.aabb.min[1]||t>v.aabb.max[0]||o>v.aabb.max[1])continue;const w=(t-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*64|0,E=64*Math.min(63,(o-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*64|0)+Math.min(63,w);if(!(v.heightmap[E]<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:v.heightmap[E],maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new ht(t,o),new ht(t,o),h),h.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function em(n,t){return!n.isLightConstant&&t}function gv(n,t,o,l,h,f,g,v){let w=(61440&t|(61440&t)>>4)>>8,E=(3840&t|(3840&t)>>4)>>4,D=240&t|(240&t)>>4;o[3]>0&&(w=rn(w,255*o[0],o[3]),E=rn(E,255*o[1],o[3]),D=rn(D,255*o[2],o[3]));const I=w<<8|E,P=D<<8|Math.floor(255*l[3]),L=function(ae){const de=on(ae,0,2);return Math.min(Math.round(.5*de*255),255)}(l[2])<<8|15*l[0]<<4|15*l[1],N=on(h[0],0,1),B=on(h[1],0,1),U=on(h[2],0,1),H=on(h[3],0,1);let Q,ne,ie,ue;if(N!==B&&g!==f&&B!==N){const ae=g-f;ne=1/(ae*(B-N)),ie=-(f+ae*N)/(ae*(B-N));const de=on(h[4],-1,1);ue=Math.pow(10,de),Q=255*U<<8|255*H}else Q=65535,ne=0,ie=1,ue=1;if(n.emplaceBack(I,P,L,Q,ne,ie,ue),v){const ae=v.length;v.clear();for(let de=0;de<ae;de++)v.emplaceBack(I,P,L,Q,ne,ie,ue)}}function PE(n,t,o){const l=n.node;let h=0;const f=o&ff.HasMeshoptCompression;for(const g of l.meshes){if(l.lights&&l.lightMeshIndex===h||!g.featureData)continue;g.featureArray=new Qu,g.featureArray.reserve(g.featureData.length);let v=t;for(const w of g.featureData){const E=f?65535&w:w>>16&65535,D=f?w>>16&65535:65535&w,I=(15&D)<8?15&D:0,P=n.evaluatedRMEA[I],L=n.evaluatedColor[I],N=n.emissionHeightBasedParams[I];let B;if(v&&2===I&&l.lights&&(B=new Qu,B.resize(10*l.lights.length)),gv(g.featureArray,E,L,P,N,g.aabb.min[2],g.aabb.max[2],B),B&&v){v=!1;const U=l.meshes[l.lightMeshIndex];U.featureArray=B,U.featureArray._trim()}}g.featureArray._trim(),h++}}function _v(n,t,o,l){const h=1<<n.z;t.lat=Dn((l/gt+n.y)/h),t.lng=tn((o/gt+n.x)/h)}Ct(Qg,"Tiled3dModelBucket",{omit:["layers"]}),Ct(RE,"Tiled3dModelFeature");const OE={circle:class extends Po{constructor(n,t,o){super(n,io,t,o)}createBucket(n){return new Lo(n)}queryRadius(n){const t=n;return op("circle-radius",this,t)+op("circle-stroke-width",this,t)+U_(this.paint.get("circle-translate"))}queryIntersectsFeature(n,t,o,l,h,f,g,v){const w=x0(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(t,o)+this.paint.get("circle-stroke-width").evaluate(t,o);return vy(n,l,f,g,v,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),w,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,t){const o=rg(this);return{config:new j(this,t),defines:o,overrideFog:!1}}},heatmap:class extends Po{createBucket(n){return new ex(n)}constructor(n,t,o){super(n,rT,t,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=og({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return op("heatmap-radius",this,n)}queryIntersectsFeature(n,t,o,l,h,f,g,v){const w=this.paint.get("heatmap-radius").evaluate(t,o);return vy(n,l,f,g,v,!0,!0,new ht(0,0),w)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,t){return"heatmap"===n?{config:new j(this,t),overrideFog:!1}:{}}},hillshade:class extends Po{constructor(n,t,o){super(n,sT,t,o)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,t){return{overrideFog:!1}}},fill:class extends Po{constructor(n,t,o){super(n,Pw,t,o)}getProgramIds(){const n=this.paint.get("fill-pattern"),t=n&&n.constantOr(1),o=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(n,t){return{config:new j(this,t),overrideFog:!1}}recalculate(n,t){super.recalculate(n,t);const o=this.paint._values["fill-outline-color"];"constant"===o.value.kind&&void 0===o.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new My(n)}queryRadius(){return U_(this.paint.get("fill-translate"))}queryIntersectsFeature(n,t,o,l,h,f){return!n.queryGeometry.isAboveHorizon&&gs(nh(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Po{constructor(n,t,o){super(n,Bw,t,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new Xd(n)}queryRadius(){return U_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,t,o,l,h,f,g,v,w){const E=x0(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),D=this.paint.get("fill-extrusion-height").evaluate(t,o),I=this.paint.get("fill-extrusion-base").evaluate(t,o),P=[0,0],L=v&&f.elevation,N=f.elevation?f.elevation.exaggeration():1,B=n.tile.getBucket(this);if(L&&B instanceof Xd){const ie=B.centroidVertexArray,ue=w+1;ue<ie.length&&(P[0]=ie.geta_centroid_pos0(ue),P[1]=ie.geta_centroid_pos1(ue))}if(0===P[0]&&1===P[1])return!1;"globe"===f.projection.name&&(l=Dg([l],[new ht(0,0),new ht(gt,gt)],n.tileID.canonical).map(ie=>ie.polygon).flat());const U=L?v:null,[H,Q]=(ue=l,ae=I,de=D,ye=E,be=g,Te=U,we=P,Oe=N,Ge=f.center.lat,"globe"===(ie=f).projection.name?function(Ve,Ie,je,lt,Be,yt,dt,Ze,qt,Ft,Tt){const We=[],jt=[],un=Ve.projection.upVectorScale(Tt,Ve.center.lat,Ve.worldSize).metersToTile,Ht=[0,0,0,1],dn=[0,0,0,1],Jt=(sn,_i,Vn,Fn)=>{sn[0]=_i,sn[1]=Vn,sn[2]=Fn,sn[3]=1},Pn=Cx();je>0&&(je+=Pn),lt+=Pn;for(const sn of Ie){const _i=[],Vn=[];for(const Fn of sn){const Jn=Fn.x+Be.x,jn=Fn.y+Be.y,St=Ve.projection.projectTilePoint(Jn,jn,Tt),oi=Ve.projection.upVector(Tt,Fn.x,Fn.y);let nr=je,wr=lt;if(dt){const Ar=Tg(Jn,jn,je,lt,dt,Ze,qt,Ft);nr+=Ar.base,wr+=Ar.top}0!==je?Jt(Ht,St.x+oi[0]*un*nr,St.y+oi[1]*un*nr,St.z+oi[2]*un*nr):Jt(Ht,St.x,St.y,St.z),Jt(dn,St.x+oi[0]*un*wr,St.y+oi[1]*un*wr,St.z+oi[2]*un*wr),d.N.transformMat4(Ht,Ht,yt),d.N.transformMat4(dn,dn,yt),_i.push(new Op(Ht[0],Ht[1],Ht[2])),Vn.push(new Op(dn[0],dn[1],dn[2]))}We.push(_i),jt.push(Vn)}return[We,jt]}(ie,ue,ae,de,ye,be,Te,we,Oe,Ge,n.tileID.canonical):Te?function(Ve,Ie,je,lt,Be,yt,dt,Ze,qt){const Ft=[],Tt=[],We=[0,0,0,1];for(const jt of Ve){const un=[],Ht=[];for(const dn of jt){const Jt=dn.x+lt.x,Pn=dn.y+lt.y,sn=Tg(Jt,Pn,Ie,je,yt,dt,Ze,qt);We[0]=Jt,We[1]=Pn,We[2]=sn.base,We[3]=1,d.a7.transformMat4(We,We,Be),We[3]=Math.max(We[3],1e-5);const _i=new Op(We[0]/We[3],We[1]/We[3],We[2]/We[3]);We[0]=Jt,We[1]=Pn,We[2]=sn.top,We[3]=1,d.a7.transformMat4(We,We,Be),We[3]=Math.max(We[3],1e-5);const Vn=new Op(We[0]/We[3],We[1]/We[3],We[2]/We[3]);un.push(_i),Ht.push(Vn)}Ft.push(un),Tt.push(Ht)}return[Ft,Tt]}(ue,ae,de,ye,be,Te,we,Oe,Ge):function(Ve,Ie,je,lt,Be){const yt=[],dt=[],Ze=Be[8]*Ie,qt=Be[9]*Ie,Ft=Be[10]*Ie,Tt=Be[11]*Ie,We=Be[8]*je,jt=Be[9]*je,un=Be[10]*je,Ht=Be[11]*je;for(const dn of Ve){const Jt=[],Pn=[];for(const sn of dn){const _i=sn.x+lt.x,Vn=sn.y+lt.y,Fn=Be[0]*_i+Be[4]*Vn+Be[12],Jn=Be[1]*_i+Be[5]*Vn+Be[13],jn=Be[2]*_i+Be[6]*Vn+Be[14],St=Be[3]*_i+Be[7]*Vn+Be[15],oi=Fn+Ze,nr=Jn+qt,wr=jn+Ft,Ar=Math.max(St+Tt,1e-5),Ci=Fn+We,ji=Jn+jt,Rr=jn+un,Pr=Math.max(St+Ht,1e-5);Jt.push(new Op(oi/Ar,nr/Ar,wr/Ar)),Pn.push(new Op(Ci/Pr,ji/Pr,Rr/Pr))}yt.push(Jt),dt.push(Pn)}return[yt,dt]}(ue,ae,de,ye,be)),ne=n.queryGeometry;var ie,ue,ae,de,ye,be,Te,we,Oe,Ge;return function(ie,ue,ae){let de=1/0;gs(ae,ue)&&(de=Lp(ae,ue[0]));for(let ye=0;ye<ue.length;ye++){const be=ue[ye],Te=ie[ye];for(let we=0;we<be.length-1;we++){const Oe=be[we],Ge=[Oe,be[we+1],Te[we+1],Te[we],Oe];Fs(ae,Ge)&&(de=Math.min(de,Lp(ae,Ge)))}}return de!==1/0&&de}(H,Q,ne.isPointQuery()?ne.screenBounds:ne.screenGeometry)}},line:class extends Po{constructor(n,t,o){super(n,Sx,t,o),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Lu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,t){super.recalculate(n,t),this.paint._values["line-floorwidth"]=Ny.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Ig(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,t){const o=Bo(this);return{config:new j(this,t),defines:o,overrideFog:!1}}queryRadius(n){const t=n,o=Fp(op("line-width",this,t),op("line-gap-width",this,t)),l=op("line-offset",this,t);return o/2+Math.abs(l)+U_(this.paint.get("line-translate"))}queryIntersectsFeature(n,t,o,l,h,f){if(n.queryGeometry.isAboveHorizon)return!1;const g=nh(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),v=n.pixelToTileUnitsFactor/2*Fp(this.paint.get("line-width").evaluate(t,o),this.paint.get("line-gap-width").evaluate(t,o)),w=this.paint.get("line-offset").evaluate(t,o);return w&&(l=function(E,D){const I=[],P=new ht(0,0);for(let L=0;L<E.length;L++){const N=E[L],B=[];for(let U=0;U<N.length;U++){const H=N[U],Q=N[U+1],ne=0===U?P:H.sub(N[U-1])._unit()._perp(),ie=U===N.length-1?P:Q.sub(H)._unit()._perp(),ue=ne._add(ie)._unit();ue._mult(1/(ue.x*ie.x+ue.y*ie.y)),B.push(ue._mult(D)._add(H))}I.push(B)}return I}(l,w*n.pixelToTileUnitsFactor)),function(E,D,I){for(let P=0;P<D.length;P++){const L=D[P];if(E.length>=3)for(let N=0;N<L.length;N++)if(Na(E,L[N]))return!0;if(fa(E,L,I))return!0}return!1}(g,l,v)}isTileClipped(){return!0}},symbol:Ug,background:class extends Po{constructor(n,t,o){super(n,fE,t,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,t){return{overrideFog:!1}}},raster:ob,"raster-particle":sv,sky:class extends Po{constructor(n,t,o){super(n,ab,t,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=og({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(n,t){if("atmosphere"===this.paint.get("sky-type")){const l=this.paint.get("sky-atmosphere-sun"),h=!l,f=n.style.light,g=f.properties.get("position");return h&&"viewport"===f.properties.get("anchor")&&tr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Gg(g.azimuthal,90-g.polar,t):Gg(l[0],90-l[1],t)}const o=this.paint.get("sky-gradient-center");return Gg(o[0],90-o[1],t)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}},slot:class extends Po{constructor(n,t,o){super(n,yE,t)}},model:class extends Po{constructor(n,t,o){super(n,gb,t,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new lv(n)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof Qg?gt-1:0}queryIntersectsFeature(n,t,o,l,h,f){if(!this.modelManager)return!1;const g=this.modelManager,v=n.tile.getBucket(this);if(!(v&&v instanceof lv))return!1;const w=v;for(const E in w.instancesPerModel){const D=w.instancesPerModel[E];if(D.idToFeaturesIndex.hasOwnProperty(t.id)){const I=D.features[D.idToFeaturesIndex[t.id]],P=g.getModel(E,this.scope);if(!P)return!1;let L=d.a6.create();const N=new xe(0,0),B=w.canonical;let U=Number.MAX_VALUE;for(let H=0;H<I.instancedDataCount;++H){const Q=16*(I.instancedDataOffset+H),ne=D.instancedDataArray.float32,ie=[ne[Q+4],ne[Q+5],ne[Q+6]];_v(B,N,ne[Q],0|ne[Q+1]),CE(L,P,f,N,I.rotation,I.scale,ie,!1,!1,!1),"globe"===f.projection.name&&(L=av(L,f));const ue=d.a6.multiply([],f.projMatrix,L),ae=n.queryGeometry,de=db(ae.isPointQuery()?ae.screenBounds:ae.screenGeometry,f,ue,P.aabb);null!=de&&(U=Math.min(de,U))}return U!==Number.MAX_VALUE&&U}}return!1}_handleOverridablePaintPropertyUpdate(n,t,o){return!(!this.layout||t.isDataDriven()||o.isDataDriven()||"model-color"!==n&&"model-color-mix-intensity"!==n&&"model-rotation"!==n&&"model-scale"!==n&&"model-translation"!==n&&"model-emissive-strength"!==n)}_isPropertyZoomDependent(n){const t=this._transitionablePaint._values[n];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof fd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(n,t,o,l){const h=n.tile,f=h.getBucket(this);let g=null,v=Number.MAX_VALUE;if(!(f&&f instanceof Qg))return{queryFeature:g,intersectionZ:v};const w=f.getNodesInfo()[t];if(w.hiddenByReplacement||!w.node.meshes||!o.filter(new Mi(h.tileID.overscaledZ),w.feature,h.tileID.canonical))return{queryFeature:g,intersectionZ:v};const E=w.node,D=l.calculatePosMatrix(h.tileID.toUnwrapped(),l.worldSize),I=w.evaluatedScale;let P=0;l.elevation&&E.elevation&&(P=E.elevation*l.elevation.exaggeration()),d.a6.translate(D,D,[(E.anchor?E.anchor[0]:0)*(I[0]-1),(E.anchor?E.anchor[1]:0)*(I[1]-1),P]),d.a6.scale(D,D,I),d.a6.multiply(D,D,E.matrix);const L=n.queryGeometry,N=L.isPointQuery()?L.screenBounds:L.screenGeometry,B=function(H){const Q=d.a6.multiply([],D,H.matrix),ne=d.a6.multiply(Q,l.expandedFarZProjMatrix,Q);for(let ie=0;ie<H.meshes.length;++ie){const ue=H.meshes[ie];if(ie===H.lightMeshIndex)continue;const ae=db(N,l,ne,ue.aabb);null!=ae&&(v=Math.min(ae,v))}if(H.children)for(const ie of H.children)B(ie)};if(B(E),v===Number.MAX_VALUE)return{queryFeature:g,intersectionZ:v};const U=new xe(0,0);return _v(h.tileID.canonical,U,w.node.anchor[0],w.node.anchor[1]),g={type:"Feature",geometry:{type:"Point",coordinates:[U.lng,U.lat]},properties:w.feature.properties,id:w.feature.id,state:{},layer:this.serialize()},{queryFeature:g,intersectionZ:v}}}},cn={read:function(n,t){return n.readFields(cn._readField,{header_length:0,x:0,y:0,z:0,layers:[]},t)},_readField:function(n,t,o){1===n?t.header_length=o.readFixed32():2===n?t.x=o.readVarint():3===n?t.y=o.readVarint():4===n?t.z=o.readVarint():5===n&&t.layers.push(cn.Layer.read(o,o.readVarint()+o.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};cn.Filter.read=function(n,t){return n.readFields(cn.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},t)},cn.Filter._readField=function(n,t,o){1===n?(t.delta_filter=cn.Filter.Delta.read(o,o.readVarint()+o.pos),t.filter="delta_filter"):2===n?(t.zigzag_filter=cn.Filter.Zigzag.read(o,o.readVarint()+o.pos),t.filter="zigzag_filter"):3===n?(t.bitshuffle_filter=cn.Filter.BitShuffle.read(o,o.readVarint()+o.pos),t.filter="bitshuffle_filter"):4===n&&(t.byteshuffle_filter=cn.Filter.ByteShuffle.read(o,o.readVarint()+o.pos),t.filter="byteshuffle_filter")},cn.Filter.Delta={},cn.Filter.Delta.read=function(n,t){return n.readFields(cn.Filter.Delta._readField,{block_size:0},t)},cn.Filter.Delta._readField=function(n,t,o){1===n&&(t.block_size=o.readVarint())},cn.Filter.Zigzag={},cn.Filter.Zigzag.read=function(n,t){return n.readFields(cn.Filter.Zigzag._readField,{},t)},cn.Filter.Zigzag._readField=function(n,t,o){},cn.Filter.BitShuffle={},cn.Filter.BitShuffle.read=function(n,t){return n.readFields(cn.Filter.BitShuffle._readField,{},t)},cn.Filter.BitShuffle._readField=function(n,t,o){},cn.Filter.ByteShuffle={},cn.Filter.ByteShuffle.read=function(n,t){return n.readFields(cn.Filter.ByteShuffle._readField,{},t)},cn.Filter.ByteShuffle._readField=function(n,t,o){},cn.Codec={},cn.Codec.read=function(n,t){return n.readFields(cn.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},t)},cn.Codec._readField=function(n,t,o){1===n?(t.gzip_data=cn.Codec.GzipData.read(o,o.readVarint()+o.pos),t.codec="gzip_data"):2===n?(t.jpeg_image=cn.Codec.JpegImage.read(o,o.readVarint()+o.pos),t.codec="jpeg_image"):3===n?(t.webp_image=cn.Codec.WebpImage.read(o,o.readVarint()+o.pos),t.codec="webp_image"):4===n&&(t.png_image=cn.Codec.PngImage.read(o,o.readVarint()+o.pos),t.codec="png_image")},cn.Codec.GzipData={},cn.Codec.GzipData.read=function(n,t){return n.readFields(cn.Codec.GzipData._readField,{},t)},cn.Codec.GzipData._readField=function(n,t,o){},cn.Codec.JpegImage={},cn.Codec.JpegImage.read=function(n,t){return n.readFields(cn.Codec.JpegImage._readField,{},t)},cn.Codec.JpegImage._readField=function(n,t,o){},cn.Codec.WebpImage={},cn.Codec.WebpImage.read=function(n,t){return n.readFields(cn.Codec.WebpImage._readField,{},t)},cn.Codec.WebpImage._readField=function(n,t,o){},cn.Codec.PngImage={},cn.Codec.PngImage.read=function(n,t){return n.readFields(cn.Codec.PngImage._readField,{},t)},cn.Codec.PngImage._readField=function(n,t,o){},cn.DataIndexEntry={},cn.DataIndexEntry.read=function(n,t){return n.readFields(cn.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)},cn.DataIndexEntry._readField=function(n,t,o){1===n?t.first_byte=o.readFixed64():2===n?t.last_byte=o.readFixed64():3===n?t.filters.push(cn.Filter.read(o,o.readVarint()+o.pos)):4===n?t.codec=cn.Codec.read(o,o.readVarint()+o.pos):5===n?t.offset=o.readFloat():6===n?t.scale=o.readFloat():7===n&&t.bands.push(o.readString())},cn.Layer={},cn.Layer.read=function(n,t){return n.readFields(cn.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},t)},cn.Layer._readField=function(n,t,o){1===n?t.version=o.readVarint():2===n?t.name=o.readString():3===n?t.units=o.readString():4===n?t.tilesize=o.readVarint():5===n?t.buffer=o.readVarint():6===n?t.pixel_format=o.readVarint():7===n&&t.data_index.push(cn.DataIndexEntry.read(o,o.readVarint()+o.pos))};const Co={read:function(n,t){return n.readFields(Co._readField,{uint32_values:null,values:null,fixed32_values:null},t)},_readField:function(n,t,o){2===n?(t.uint32_values=Co.Uint32Values.read(o,o.readVarint()+o.pos),t.values="uint32_values"):3===n&&(t.fixed32_values=Co.Fixed32Values.read(o,o.readVarint()+o.pos),t.values="fixed32_values")},Uint32Values:{}};Co.Uint32Values.read=function(n,t){return n.readFields(Co.Uint32Values._readField,{values:[]},t)},Co.Uint32Values._readField=function(n,t,o){1===n&&(t.readValuesInto=function(l){if(2!==l.type)throw new Error(`Unsupported pbf type "${l.type}"`);const h=2===(g=l).type?g.readVarint()+g.pos:g.pos+1,f=l.pos;var g;return l.pos=h,function(g){l.pos=f;let v=0;for(;l.pos<h;){const w=l.readVarint();g[v++]=w}return g}}(o))},Co.Fixed32Values={},Co.Fixed32Values.read=function(n,t){return n.readFields(Co.Fixed32Values._readField,{values:[]},t)},Co.Fixed32Values._readField=function(n,t,o){throw new Error("Not implemented")};class Rb{constructor(t=0,o=0,l=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=l,this.size=0,this.ttl=o}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const o=this.items[t];delete this.items[t],this.size--,null!==o.prev&&(o.prev.next=o.next),null!==o.next&&(o.next.prev=o.prev),this.first===o&&(this.first=o.next),this.last===o&&(this.last=o.prev)}return this}entries(t=this.keys()){return t.map(o=>[o,this.get(o)])}evict(t=!1){if(t||this.size>0){const o=this.first;delete this.items[o.key],0==--this.size?(this.first=null,this.last=null):(this.first=o.next,this.first.prev=null)}return this}expiresAt(t){let o;return this.has(t)&&(o=this.items[t].expiry),o}get(t){let o;if(this.has(t)){const l=this.items[t];this.ttl>0&&l.expiry<=Date.now()?this.delete(t):(o=l.value,this.set(t,o,!0))}return o}has(t){return t in this.items}keys(){const t=[];let o=this.first;for(;null!==o;)t.push(o.key),o=o.next;return t}set(t,o,l=!1,h=this.resetTtl){let f;if(l||this.has(t)){if(f=this.items[t],f.value=o,!1===l&&h&&(f.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==f){const g=this.last,v=f.next,w=f.prev;this.first===f&&(this.first=f.next),f.next=null,f.prev=this.last,g.next=f,null!==w&&(w.next=v),null!==v&&(v.prev=w)}}else this.max>0&&this.size===this.max&&this.evict(!0),f=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:o},1==++this.size?this.first=f:this.last.next=f;return this.last=f,this}values(t=this.keys()){return t.map(o=>this.get(o))}}function Pb(n,t){if(4!==t.length)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let o=t[3];for(let l=2;l>=1;l--){const h=1===l?1:0,f=2===l?1:0;for(let g=0;g<t[0];g++){const v=t[1]*g;for(let w=h;w<t[1];w++){const E=t[2]*(w+v);for(let D=f;D<t[2];D++){const I=t[3]*(D+E);for(let P=0;P<t[3];P++){const L=I+P;n[L]+=n[L-o]}}}}o*=t[l]}return n}function kE(n){for(let t=0,o=n.length;t<o;t++)n[t]=n[t]>>>1^-(1&n[t]);return n}function LE(n,t){switch(t){case"uint32":return n;case"uint16":for(let o=0;o<n.length;o+=2){const l=n[o],h=n[o+1];n[o]=(240&l)>>4|(61440&l)>>8|(240&h)<<4|61440&h,n[o+1]=15&l|(3840&l)>>4|(15&h)<<8|(3840&h)<<4}return n;case"uint8":for(let o=0;o<n.length;o+=4){const l=n[o],h=n[o+1],f=n[o+2],g=n[o+3];n[o+0]=(192&l)>>6|(192&h)>>4|(192&f)>>2|192&g,n[o+1]=(48&l)>>4|(48&h)>>2|48&f|(48&g)<<2,n[o+2]=(12&l)>>2|12&h|(12&f)<<2|(12&g)<<4,n[o+3]=3&l|(3&h)<<2|(3&f)<<4|(3&g)<<6}return n;default:throw new Error(`Invalid pixel format, "${t}"`)}}class cu extends Error{constructor(t){super(t),this.name="MRTError"}}var vs=Uint8Array,Za=Uint16Array,yv=Int32Array,Ob=new vs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),bt=new vs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Lt=new vs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Bn=function(n,t){for(var o=new Za(31),l=0;l<31;++l)o[l]=t+=1<<n[l-1];var h=new yv(o[30]);for(l=1;l<30;++l)for(var f=o[l];f<o[l+1];++f)h[f]=f-o[l]<<5|l;return{b:o,r:h}},vv=Bn(Ob,2),kb=vv.b,FE=vv.r;kb[28]=258,FE[258]=28;for(var NE=Bn(bt,0).b,tm=new Za(32768),sr=0;sr<32768;++sr){var Ph=(43690&sr)>>1|(21845&sr)<<1;tm[sr]=((65280&(Ph=(61680&(Ph=(52428&Ph)>>2|(13107&Ph)<<2))>>4|(3855&Ph)<<4))>>8|(255&Ph)<<8)>>1}var yf=function(n,t,o){for(var l=n.length,h=0,f=new Za(t);h<l;++h)n[h]&&++f[n[h]-1];var g,v=new Za(t);for(h=1;h<t;++h)v[h]=v[h-1]+f[h-1]<<1;if(o){g=new Za(1<<t);var w=15-t;for(h=0;h<l;++h)if(n[h])for(var E=h<<4|n[h],D=t-n[h],I=v[n[h]-1]++<<D,P=I|(1<<D)-1;I<=P;++I)g[tm[I]>>w]=E}else for(g=new Za(l),h=0;h<l;++h)n[h]&&(g[h]=tm[v[n[h]-1]++]>>15-n[h]);return g},nm=new vs(288);for(sr=0;sr<144;++sr)nm[sr]=8;for(sr=144;sr<256;++sr)nm[sr]=9;for(sr=256;sr<280;++sr)nm[sr]=7;for(sr=280;sr<288;++sr)nm[sr]=8;var Lb=new vs(32);for(sr=0;sr<32;++sr)Lb[sr]=5;var zE=yf(nm,9,1),e_=yf(Lb,5,1),t_=function(n){for(var t=n[0],o=1;o<n.length;++o)n[o]>t&&(t=n[o]);return t},Do=function(n,t,o){var l=t/8|0;return(n[l]|n[l+1]<<8)>>(7&t)&o},n_=function(n,t){var o=t/8|0;return(n[o]|n[o+1]<<8|n[o+2]<<16)>>(7&t)},BE=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],va=function(n,t,o){var l=new Error(t||BE[n]);if(l.code=n,Error.captureStackTrace&&Error.captureStackTrace(l,va),!o)throw l;return l},Fb=new vs(0),Nb=typeof TextDecoder<"u"&&new TextDecoder;try{Nb.decode(Fb,{stream:!0})}catch{}const xv={gzip_data:"gzip"},VE={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},jE={uint32:1,uint16:2,uint8:4},UE={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class bv{constructor(t=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){return this.layers[t]}getHeaderLength(t){const o=new Uint8Array(t),l=new DataView(t);if(13!==o[0])throw new cu("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(t){const o=new Uint8Array(t),l=this.getHeaderLength(t);if(o.length<l)throw new cu(`Expected header with length >= ${l} but got buffer of length ${o.length}`);const h=new vh(o.subarray(0,l)),f=cn.read(h);if(!isNaN(this.x)&&(this.x!==f.x||this.y!==f.y||this.z!==f.z))throw new cu(`Invalid attempt to parse header ${f.z}/${f.x}/${f.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=f.x,this.y=f.y,this.z=f.z;for(const g of f.layers)this.layers[g.name]=new wv(g,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const o=[],l=this.getLayer(t.layerName);for(let h=0;h<l.dataIndex.length;h++){const f=l.dataIndex[h],g=f.first_byte-t.firstByte,v=f.last_byte+1-t.firstByte;if(h<t.firstBlock||h>t.lastBlock||l._blocksInProgress.has(h))continue;const w={layerName:l.name,firstByte:g,lastByte:v,pixelFormat:l.pixelFormat,blockIndex:h,blockShape:[f.bands.length].concat(l.bandShape),buffer:l.buffer,codec:f.codec.codec,filters:f.filters.map(E=>E.filter)};l._blocksInProgress.add(h),o.push(w)}return new Ev(o,()=>{o.forEach(h=>l._blocksInProgress.delete(h.blockIndex))},(h,f)=>{if(o.forEach(g=>l._blocksInProgress.delete(g.blockIndex)),h)throw h;f.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class wv{constructor({version:t,name:o,units:l,tilesize:h,pixel_format:f,buffer:g,data_index:v},w){if(this.version=t,1!==this.version)throw new cu(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=o,this.units=l,this.tileSize=h,this.buffer=g,this.pixelFormat=VE[f],this.dataIndex=v,this.bandShape=[h+2*g,h+2*g,jE[this.pixelFormat]],this._decodedBlocks=function(E=1e3,D=0,I=!1){if(isNaN(E)||E<0)throw new TypeError("Invalid max value");if(isNaN(D)||D<0)throw new TypeError("Invalid ttl value");if("boolean"!=typeof I)throw new TypeError("Invalid resetTtl value");return new Rb(E,D,I)}(w?w.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(t){const o=t.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.set(o,t.data)}getBlockForBand(t){let o=0;switch(typeof t){case"string":for(const[l,h]of this.dataIndex.entries()){for(const[f,g]of h.bands.entries())if(g===t)return{bandIndex:o+f,blockIndex:l,blockBandIndex:f};o+=h.bands.length}break;case"number":for(const[l,h]of this.dataIndex.entries()){if(t>=o&&t<o+h.bands.length)return{bandIndex:t,blockIndex:l,blockBandIndex:t-o};o+=h.bands.length}break;default:throw new cu(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new cu(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let o=1/0,l=-1/0,h=1/0,f=-1/0;for(const g of t){const{blockIndex:v}=this.getBlockForBand(g);if(v<0)throw new cu(`Invalid band: ${JSON.stringify(g)}`);const w=this.dataIndex[v];h=Math.min(h,v),f=Math.max(f,v),o=Math.min(o,w.first_byte),l=Math.max(l,w.last_byte)}return{layerName:this.name,firstByte:o,lastByte:l,firstBlock:h,lastBlock:f}}hasBand(t){const{blockIndex:o}=this.getBlockForBand(t);return o>=0}hasDataForBand(t){const{blockIndex:o}=this.getBlockForBand(t);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(t){const{blockIndex:o,blockBandIndex:l}=this.getBlockForBand(t),h=this._decodedBlocks.get(o.toString());if(!h)throw new cu(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[o],g=this.bandShape.reduce((E,D)=>E*D,1),v=l*g,w=h.subarray(v,v+g);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:f.offset,scale:f.scale}}}class Ev{constructor(t,o,l){this.tasks=t,this._onCancel=o,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,o){this._finalized||(this._onComplete(t,o),this._finalized=!0)}}bv.performDecoding=function(n,t){return Promise.all(t.tasks.map(o=>{const{layerName:l,firstByte:h,lastByte:f,pixelFormat:g,blockShape:v,blockIndex:w,filters:E,codec:D}=o,I=new Uint8Array(n).subarray(h,f+1),P=new Uint32Array(v[0]*v[1]*v[2]);let L;if("gzip_data"!==D)throw new Error(`Unhandled codec: ${D}`);return L=function(N,B){if(!globalThis.DecompressionStream&&"gzip_data"===B)return Promise.resolve(((ne=function(ae){31==ae[0]&&139==ae[1]&&8==ae[2]||va(6,"invalid gzip data");var de=ae[3],ye=10;4&de&&(ye+=2+(ae[10]|ae[11]<<8));for(var be=(de>>3&1)+(de>>4&1);be>0;be-=!ae[ye++]);return ye+(2&de)}(Q=N))+8>Q.length&&va(6,"invalid gzip data"),function(ae,de,ye,be){var Te=ae.length;if(!Te||de.f&&!de.l)return ye||new vs(0);var we=!ye,Oe=we||2!=de.i,Ge=de.i;we&&(ye=new vs(3*Te));var To,Mo,Hs,Re=function(To){var Mo=ye.length;if(To>Mo){var Hs=new vs(Math.max(2*Mo,To));Hs.set(ye),ye=Hs}},Ve=de.f||0,Ie=de.p||0,je=de.b||0,lt=de.l,Be=de.d,yt=de.m,dt=de.n,Ze=8*Te;do{if(!lt){Ve=Do(ae,Ie,1);var qt=Do(ae,Ie+1,3);if(Ie+=3,!qt){var Ft=ae[(Vn=4+((Ie+7)/8|0))-4]|ae[Vn-3]<<8,Tt=Vn+Ft;if(Tt>Te){Ge&&va(0);break}Oe&&Re(je+Ft),ye.set(ae.subarray(Vn,Tt),je),de.b=je+=Ft,de.p=Ie=8*Tt,de.f=Ve;continue}if(1==qt)lt=zE,Be=e_,yt=9,dt=5;else if(2==qt){var We=Do(ae,Ie,31)+257,jt=Do(ae,Ie+10,15)+4,un=We+Do(ae,Ie+5,31)+1;Ie+=14;for(var Ht=new vs(un),dn=new vs(19),Jt=0;Jt<jt;++Jt)dn[Lt[Jt]]=Do(ae,Ie+3*Jt,7);Ie+=3*jt;var Pn=t_(dn),sn=(1<<Pn)-1,_i=yf(dn,Pn,1);for(Jt=0;Jt<un;){var Vn,Fn=_i[Do(ae,Ie,sn)];if(Ie+=15&Fn,(Vn=Fn>>4)<16)Ht[Jt++]=Vn;else{var Jn=0,jn=0;for(16==Vn?(jn=3+Do(ae,Ie,3),Ie+=2,Jn=Ht[Jt-1]):17==Vn?(jn=3+Do(ae,Ie,7),Ie+=3):18==Vn&&(jn=11+Do(ae,Ie,127),Ie+=7);jn--;)Ht[Jt++]=Jn}}var St=Ht.subarray(0,We),oi=Ht.subarray(We);yt=t_(St),dt=t_(oi),lt=yf(St,yt,1),Be=yf(oi,dt,1)}else va(1);if(Ie>Ze){Ge&&va(0);break}}Oe&&Re(je+131072);for(var nr=(1<<yt)-1,wr=(1<<dt)-1,Ar=Ie;;Ar=Ie){var Ci=(Jn=lt[n_(ae,Ie)&nr])>>4;if((Ie+=15&Jn)>Ze){Ge&&va(0);break}if(Jn||va(2),Ci<256)ye[je++]=Ci;else{if(256==Ci){Ar=Ie,lt=null;break}var ji=Ci-254;Ci>264&&(ji=Do(ae,Ie,(1<<(Or=Ob[Jt=Ci-257]))-1)+kb[Jt],Ie+=Or);var Rr=Be[n_(ae,Ie)&wr],Pr=Rr>>4;if(Rr||va(3),Ie+=15&Rr,oi=NE[Pr],Pr>3){var Or=bt[Pr];oi+=n_(ae,Ie)&(1<<Or)-1,Ie+=Or}if(Ie>Ze){Ge&&va(0);break}Oe&&Re(je+131072);var Ii=je+ji;if(je<oi){var es=0-oi,mc=Math.min(oi,Ii);for(es+je<0&&va(3);je<mc;++je)ye[je]=undefined[es+je]}for(;je<Ii;++je)ye[je]=ye[je-oi]}}de.l=lt,de.p=Ar,de.b=je,de.f=Ve,lt&&(Ve=1,de.m=yt,de.d=Be,de.n=dt)}while(!Ve);return je!=ye.length&&we?(To=ye,(null==(Mo=0)||Mo<0)&&(Mo=0),(null==(Hs=je)||Hs>To.length)&&(Hs=To.length),new vs(To.subarray(Mo,Hs))):ye.subarray(0,je)}(Q.subarray(ne,-8),{i:2},new vs(((U=Q)[(H=U.length)-4]|U[H-3]<<8|U[H-2]<<16|U[H-1]<<24)>>>0))));var U,H,Q,ne;const ie=xv[B];if(!ie)throw new Error(`Unhandled codec: ${B}`);const ue=new globalThis.DecompressionStream(ie);return new Response(new Blob([N]).stream().pipeThrough(ue)).arrayBuffer().then(ae=>new Uint8Array(ae))}(I,D).then(N=>{const B=Co.read(new vh(N));if("uint32_values"===B.values)return B.uint32_values.readValuesInto(P),new UE[g](P.buffer);throw new Error(`Unhandled numeric data "${B.values}"`)}),L.then(N=>{for(let B=E.length-1;B>=0;B--)switch(E[B]){case"delta_filter":Pb(N,v);break;case"zigzag_filter":kE(N);break;case"bitshuffle_filter":LE(N,g);break;default:throw new Error(`Unhandled filter "${E[B]}"`)}return{layerName:l,blockIndex:w,data:N}}).catch(N=>{throw N})}))},Ct(Ev,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const Cv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class i_{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,l]=new Uint8Array(t,0,2);if(219!==o)throw new Error("Data does not appear to be in a KDBush format.");const h=l>>4;if(1!==h)throw new Error(`Got v${h} data when expected v1.`);const f=Cv[15&l];if(!f)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new i_(v,g,f,t)}constructor(t,o=64,l=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const f=Cv.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-v%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${l}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+w,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+v+w),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+w,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=t)}add(t,o){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=o,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return r_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,o,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:g,nodeSize:v}=this,w=[0,f.length-1,0],E=[];for(;w.length;){const D=w.pop()||0,I=w.pop()||0,P=w.pop()||0;if(I-P<=v){for(let U=P;U<=I;U++){const H=g[2*U],Q=g[2*U+1];H>=t&&H<=l&&Q>=o&&Q<=h&&E.push(f[U])}continue}const L=P+I>>1,N=g[2*L],B=g[2*L+1];N>=t&&N<=l&&B>=o&&B<=h&&E.push(f[L]),(0===D?t<=N:o<=B)&&(w.push(P),w.push(L-1),w.push(1-D)),(0===D?l>=N:h>=B)&&(w.push(L+1),w.push(I),w.push(1-D))}return E}within(t,o,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:f,nodeSize:g}=this,v=[0,h.length-1,0],w=[],E=l*l;for(;v.length;){const D=v.pop()||0,I=v.pop()||0,P=v.pop()||0;if(I-P<=g){for(let U=P;U<=I;U++)Tv(f[2*U],f[2*U+1],t,o)<=E&&w.push(h[U]);continue}const L=P+I>>1,N=f[2*L],B=f[2*L+1];Tv(N,B,t,o)<=E&&w.push(h[L]),(0===D?t-l<=N:o-l<=B)&&(v.push(P),v.push(L-1),v.push(1-D)),(0===D?t+l>=N:o+l>=B)&&(v.push(L+1),v.push(I),v.push(1-D))}return w}}function r_(n,t,o,l,h,f){if(h-l<=o)return;const g=l+h>>1;Dv(n,t,g,l,h,f),r_(n,t,o,l,g-1,1-f),r_(n,t,o,g+1,h,1-f)}function Dv(n,t,o,l,h,f){for(;h>l;){if(h-l>600){const E=h-l+1,D=o-l+1,I=Math.log(E),P=.5*Math.exp(2*I/3),L=.5*Math.sqrt(I*P*(E-P)/E)*(D-E/2<0?-1:1);Dv(n,t,o,Math.max(l,Math.floor(o-D*P/E+L)),Math.min(h,Math.floor(o+(E-D)*P/E+L)),f)}const g=t[2*o+f];let v=l,w=h;for(vf(n,t,l,o),t[2*h+f]>g&&vf(n,t,l,h);v<w;){for(vf(n,t,v,w),v++,w--;t[2*v+f]<g;)v++;for(;t[2*w+f]>g;)w--}t[2*l+f]===g?vf(n,t,l,w):(w++,vf(n,t,w,h)),w<=o&&(l=w+1),o<=w&&(h=w-1)}}function vf(n,t,o,l){o_(n,o,l),o_(t,2*o,2*l),o_(t,2*o+1,2*l+1)}function o_(n,t,o){const l=n[t];n[t]=n[o],n[o]=l}function Tv(n,t,o,l){const h=n-o,f=t-l;return h*h+f*f}d.$=ys,d.A=Vc,d.B=Tm,d.C=kn,d.D=Ce,d.E=Tc,d.F=Xi,d.G=nt,d.H=class{constructor(n){this.specification=n}possiblyEvaluate(n,t){return Ta(n.expression.evaluate(t))}interpolate(n,t,o){return{x:rn(n.x,t.x,o),y:rn(n.y,t.y,o),z:rn(n.z,t.z,o),azimuthal:rn(n.azimuthal,t.azimuthal,o),polar:rn(n.polar,t.polar,o)}}},d.I=Og,d.J=_l,d.K=Mi,d.L=zn,d.M=class{constructor(n,t,o,l){this.id=n,this.position=null!=t?new xe(t[0],t[1]):new xe(0,0),this.orientation=o??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new Hi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,t){if(d.a6.multiply(n.matrix,t,n.matrix),n.meshes)for(const o of n.meshes){const l=Hi.applyTransform(o.aabb,n.matrix);this.aabb.encapsulate(l)}if(n.children)for(const o of n.children)this._applyTransformations(o,n.matrix)}computeBoundsAndApplyParent(){const n=d.a6.identity([]);for(const t of this.nodes)this._applyTransformations(t,n)}computeModelMatrix(n,t,o,l,h,f,g=!1){CE(this.matrix,this,n.transform,this.position,t,o,l,h,f,g)}upload(n){if(!this.uploaded){for(const t of this.nodes)yb(t,n);for(const t of this.nodes)Th(t);this.uploaded=!0}}destroy(){for(const n of this.nodes)cv(n)}},d.O=xc,d.P=ht,d.Q=Gc,d.R=mo,d.S=Xc,d.T=Ch,d.U=rn,d.V=gt,d.W=Sn,d.X=class{constructor(n){this.specification=n}possiblyEvaluate(n,t){return function([o,l]){const h=Ta([1,o,l]);return{x:h.x,y:h.y,z:h.z}}(n.expression.evaluate(t))}interpolate(n,t,o){return{x:rn(n.x,t.x,o),y:rn(n.y,t.y,o),z:rn(n.z,t.z,o)}}},d.Y=function(n,t,o=0,l=!0){const h=new ht(o,o),f=n.sub(h),g=t.add(h),v=[f,new ht(g.x,f.y),g,new ht(f.x,g.y)];return l&&v.push(f.clone()),v},d.Z=fd,d._=function(n,t){const o=[];for(let l=0;l<n.length;l++){const h=Da(l-1,-1,n.length-1),f=Da(l+1,-1,n.length-1),g=n[l],v=n[f],w=n[h].sub(g).unit(),E=v.sub(g).unit(),D=E.angleWithSep(w.x,w.y),I=w.add(E).unit().mult(-1*t/Math.sin(D/2));o.push(g.add(I))}return o},d.a=Tf,d.a$=function(n){const t=[];for(const o in n)t.push(n[o]);return t},d.a0=ow,d.a1=function(n,t,o=0){return d.N.fromValues(((t.x-o)*n.scale-n.x)*gt,(t.y*n.scale-n.y)*gt,gi(t.z,t.y))},d.a2=sc,d.a3=gh,d.a4=function(n){let t=1/0,o=1/0,l=-1/0,h=-1/0;for(const f of n)t=Math.min(t,f.x),o=Math.min(o,f.y),l=Math.max(l,f.x),h=Math.max(h,f.y);return{min:new ht(t,o),max:new ht(l,h)}},d.a5=hn,d.a8=Na,d.a9=Rn,d.aA=ra,d.aB=Ki,d.aC=bc,d.aD=ft,d.aE=Zp,d.aF=function(){Kr.isLoading()||Kr.isLoaded()||"deferred"!==Pa()||$c()},d.aG=Yo,d.aH=mr,d.aI=Sb,d.aJ=Cc,d.aK=Ig,d.aL=My,d.aM=Ei,d.aN=mi,d.aO=Od,d.aP=fy,d.aQ=ug,d.aR=uf,d.aS=function(n,t){const o=Xc(t.zoom);if(0===o)return Va(n);const l=yp(n),h=gy(l),f=hn(l.getWest())*t.worldSize,g=hn(l.getEast())*t.worldSize,v=Yt(l.getNorth())*t.worldSize,w=Yt(l.getSouth())*t.worldSize,E=[f,v,0],D=[g,v,0],I=[f,w,0],P=[g,w,0],L=d.a6.invert([],t.globeMatrix);return d.N.transformMat4(E,E,L),d.N.transformMat4(D,D,L),d.N.transformMat4(I,I,L),d.N.transformMat4(P,P,L),h[0]=ja(h[0],I,o),h[1]=ja(h[1],P,o),h[2]=ja(h[2],D,o),h[3]=ja(h[3],E,o),Hi.fromPoints(h)},d.aT=xp,d.aU=vp,d.aV=ja,d.aW=Jr,d.aX=dy,d.aY=Ja,d.aZ=bv,d.a_=ze,d.aa=on,d.ab=ee,d.ac=function(n,t){const o={};for(let l=0;l<t.length;l++){const h=t[l];h in n&&(o[h]=n[h])}return o},d.ad=Se,d.ae=Yt,d.af=class{constructor(n){this.entries={},this.scheduler=n}request(n,t,o,l){const h=this.entries[n]=this.entries[n]||{callbacks:[]};if(h.result){const[f,g]=h.result;return this.scheduler?this.scheduler.add(()=>{l(f,g)},t):l(f,g),()=>{}}return h.callbacks.push(l),h.cancel||(h.cancel=o((f,g)=>{h.result=[f,g];for(const v of h.callbacks)this.scheduler?this.scheduler.add(()=>{v(f,g)},t):v(f,g);setTimeout(()=>delete this.entries[n],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(f=>f!==l),h.callbacks.length||(h.cancel(),delete this.entries[n]))}}},d.ag=Id,d.ah=function(n,t,o){const l=JSON.stringify(n.request);return n.data&&(this.deduped.entries[l]={result:[null,n.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},h=>{const f=ze(n.request,(g,v,w,E)=>{g?h(g):v&&h(null,{vectorTile:o?void 0:new pg(new vh(v)),rawData:v,cacheControl:w,expires:E})});return()=>{f.cancel(),h()}},t)},d.ai=function(n){Qn++,Qn>Rt&&(n.getActor().send("enforceCacheSizeLimit",Ne),Qn=0)},d.aj=qi,d.ak=$e,d.al=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},d.am=Je,d.an=ob,d.ao=sv,d.ap=ov,d.aq=function(n,t){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){t(null,o)};for(let l=0;l<n.length;l++){const h=document.createElement("source");Ke(n[l])||(o.crossOrigin="Anonymous"),h.src=n[l],o.appendChild(h)}return{cancel:()=>{}}},d.ar=Wp,d.as=$p,d.at=tn,d.au=Dn,d.av=fs,d.aw=Ir,d.ax=ir,d.ay=ei,d.az=ps,d.b=el,d.b$=bd,d.b0=function(n,t){const o=[];for(const l in n)l in t||o.push(l);return o},d.b1=Di,d.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.b3=function(n,t){const{x:o,y:l}=n.point,h=K0(o,l,n.worldSize/n._pixelsPerMercatorPixel,0,0);return d.a6.multiply(h,h,Ud(Va(t)))},d.b5=Jd,d.b6=ho,d.b7=Np,d.b8=function(n,t,o,l,h){const f=5*t+2;n.float32[f+0]=o,n.float32[f+1]=l,n.float32[f+2]=h},d.b9=nv,d.bA=Hg,d.bB=lb,d.bC=function(n){const t=lb(n,!0);return d.b4.invert([],[t[0],t[1],t[4],t[5]])},d.bD=eg,d.bE=function(n){const{x:t,y:o}=n.point,{lng:l,lat:h}=n._center;return K0(t,o,n.worldSize,l,h)},d.bF=Er,d.bG=oe,d.bH=function(n){const t=Math.round((n+45+360)%360/90)%4;return Hh[t]},d.bI=45,d.bJ=Dt,d.bK=m,d.bL=Fa,d.bM=np,d.bN=eo,d.bO=Wc,d.bP=p,d.bQ=function(n,t,o){const l=Math.sqrt(n*n+t*t+o*o),h=l>0?Math.acos(o/l)*gu:0;let f=0!==n||0!==t?Math.atan2(-t,-n)*gu+90:0;return f<0&&(f+=360),[l,f,h]},d.bR=vn,d.bS=Hi,d.bT=Ta,d.bU=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},d.bV=function(n){return n({pluginStatus:xo,pluginURL:aa}),Ed.on("pluginStateChange",n),n},d.bW=ya,d.bX=dc,d.bY=Pt,d.bZ=kg,d.b_=lr,d.ba=oE,d.bb=Fs,d.bc=ro,d.bd=Hx,d.be=ev,d.bf=Pg,d.bg=i_,d.bh=Da,d.bj=Cn,d.bk=le,d.bl=en,d.bm=function(n,t,o){n[4*t+0]=o[0],n[4*t+1]=o[1],n[4*t+2]=o[2],n[4*t+3]=o[3]},d.bn=xe,d.bo=tv,d.bp=et,d.bq=hy,d.br=hf,d.bs=He,d.bt=X0,d.bu=function(n,t,o,l,h,f,g,v,w){if("globe"===w.name)return X0(n,t,new He(o,l,h),!1);const E=$p({z:o,x:l,y:h},w);return new Hi([(f+E.x/E.scale)*t,t*(E.y/E.scale),g],[(f+E.x2/E.scale)*t,t*(E.y2/E.scale),v])},d.bv=function(n,t,o){let l=0;for(let h=0;h<2;++h){const f=o?o[h]:0;n[h]>f&&(l+=(n[h]-f)*(n[h]-f)),t[h]<f&&(l+=(f-t[h])*(f-t[h]))}return l},d.bw=En,d.bx=X,d.by=function(n){const t=d.a6.identity(new Float64Array(16));d.a6.multiply(t,n.pixelMatrix,n.globeMatrix);const o=[0,ge,0],l=[0,De,0];return d.N.transformMat4(o,o,t),d.N.transformMat4(l,l,t),[o[0]>0&&o[0]<=n.width&&o[1]>0&&o[1]<=n.height&&!yy(n,new xe(n.center.lat,90)),l[0]>0&&l[0]<=n.width&&l[1]>0&&l[1]<=n.height&&!yy(n,new xe(n.center.lat,-90))]},d.bz=function(n,t){const{scale:o}=n.tileTransform,l=o*gt/(n.tileSize*Math.pow(2,t.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return d.b4.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[l,l])},d.c=Xg,d.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},d.c0=bn,d.c1=ti,d.c2=function(n,t,o){return"custom"===n.type?new Yp(n,t):new OE[n.type](n,t,o)},d.c3=function(n){const t=n.indexOf("\x1f");return t>=0?n.slice(0,t):n},d.c4=function(n){return n.indexOf("\x1f")>=0},d.c5=function(n){const t=n.indexOf("\x1f");return t>=0?n.slice(t+1):""},d.c6=function(n){const t=[],o=n.id;return void 0===o&&t.push({message:`layers.${o}: missing required property "id"`}),void 0===n.render&&t.push({message:`layers.${o}: missing required method "render"`}),n.renderingMode&&"2d"!==n.renderingMode&&"3d"!==n.renderingMode&&t.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),t},d.c7=os,d.c8=Ed,d.c9=Le,d.cA=Bo,d.cB=(n,t,o,l,h,f)=>{const g=n.transform;return{u_matrix:_h(n,t,o,l),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:g.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:h,u_image:0,u_tile_units_to_pixels:Ax(t,g),u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:f}},d.cC=(n,t,o,l,h,f,g)=>{const v=n.transform,w=v.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:_h(n,t,o,l),u_pixels_to_tile_units:w,u_device_pixel_ratio:f,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:Rx(o)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ax(t,n.transform),u_alpha_discard_threshold:0,u_trim_offset:g,u_emissive_strength:o.paint.get("line-emissive-strength")}},d.cD=Ti,d.cE=og,d.cF=Cx,d.cG=Mt,d.cH=Xd,d.cI=Ua,d.cJ=450,d.cK=7,d.cL=rb,d.cM=256,d.cN=Ud,d.cO=yl,d.cP=Wf,d.cQ=function(n,t,o,l,h){return on((n-t)/(o-t)*(h-l)+l,l,h)},d.cR=yn,d.cS=av,d.cT=[1,1,1],d.cU=ga,d.cV=ff,d.cW=ks,d.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n){const t=gg(new ht(0,0),new ht(gt,gt),n),o=[];for(const l of this._activeRegions){if(l.hiddenByOverlap||!_x(t,l))continue;const h=_g(l.min,l.max,n);o.push({min:h.min,max:h.max,sourceId:this._sourceIds[l.priority],footprint:l.footprint,footprintTileId:l.tileId})}return o}setSources(n){this._setSources(n.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const o=[];for(const l of t.cache.getVisibleCoordinates()){const h=t.cache.getTile(l).buckets[t.layer];if(h)for(const f of h.getNodesInfo()){const g=f.node;g.footprint&&o.push({footprint:g.footprint,id:l.toUnwrapped()})}}return o}})))}_addSource(n){const t=n.getFootprints();if(0!==t.length){for(const o of t){if(!o.footprint)continue;const l=gg(o.footprint.min,o.footprint.max,o.id);this._activeRegions.push({min:l.min,max:l.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:o.id,footprint:o.footprint})}this._sourceIds.push(n.getSourceId())}}_computeReplacement(){this._activeRegions.sort((t,o)=>t.priority-o.priority||qd(t.min,o.min)||qd(t.max,o.max));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let t=0,o=0;for(;!n&&t!==this._activeRegions.length;){const l=this._activeRegions[t],h=this._prevRegions[o];n=l.priority!==h.priority||!Sp(l,h),++t,++o}}if(n){++this._updateTime;const t=o=>{const l=this._activeRegions;if(o>=l.length)return o;const h=l[o].priority;for(;o<l.length&&l[o].priority===h;)++o;return o};if(this._sourceIds.length>1){let o=0,l=t(o);for(;o!==l;){let h=o;const f=o;for(;h!==l;){const g=this._activeRegions[h];g.hiddenByOverlap=!1;for(let v=0;v<f;v++){const w=this._activeRegions[v];if(!w.hiddenByOverlap&&_x(g,w)&&(g.hiddenByOverlap=hh(g.footprint,g.tileId,w.footprint,w.tileId),g.hiddenByOverlap))break}++h}o=l,l=t(o)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=n.length-1;t>=0;t--)this._addSource(n[t]);this._computeReplacement()}},d.cY=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,t){const o=new mi,l=new Ir,h=[],f=n+1+2,g=t[0]+1,v=t[0]+1+(1+t.length),w=(E,D,I)=>{let P=E===f-1?E-2:0===E?E:E-1;return P+=I?24575:0,[P,D]};for(let E=0;E<f;++E)o.emplaceBack(...w(E,0,!0));for(let E=0;E<g;++E)for(let D=0;D<f;++D)o.emplaceBack(...w(D,E,(0===D||D===f-1)&&!0));for(let E=0;E<t.length;++E){const D=t[E];for(let I=0;I<f;++I)o.emplaceBack(...w(I,D,!0))}for(let E=0;E<t.length;++E){const D=l.length,I=t[E]+1+2,P=new Ir;for(let B=0;B<I-1;B++){const U=B===I-2,H=U?f*(v-t.length+E-B):f;for(let Q=0;Q<f-1;Q++){const ne=B*f+Q;0===B||U||0===Q||Q===f-2?(P.emplaceBack(ne+1,ne,ne+H),P.emplaceBack(ne+H,ne+H+1,ne+1)):(l.emplaceBack(ne+1,ne,ne+H),l.emplaceBack(ne+H,ne+H+1,ne+1))}}const L=Ki.simpleSegment(0,D,o.length,l.length-D);for(let B=0;B<P.uint16.length;B+=3)l.emplaceBack(P.uint16[B],P.uint16[B+1],P.uint16[B+2]);const N=Ki.simpleSegment(0,D,o.length,l.length-D);h.push({withoutSkirts:L,withSkirts:N})}return{vertices:o,indices:l,segments:h}}_createGrid(n){const t=this._fillGridMeshWithLods(64,fe);this._gridSegments=t.segments,this._gridBuffer=n.createVertexBuffer(t.vertices,fy.members),this._gridIndexBuffer=n.createIndexBuffer(t.indices,!0)}_createPoles(n){const t=new Ir;for(let g=0;g<=64;g++)t.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=n.createIndexBuffer(t,!0);const o=new yl,l=new yl,h=new yl,f=new yl;this._poleSegments=[];for(let g=0,v=0;g<oe;g++){const w=360/(1<<g);o.emplaceBack(0,-ee,0,.5,0),l.emplaceBack(0,-ee,0,.5,1),h.emplaceBack(0,-ee,0,.5,.5),f.emplaceBack(0,-ee,0,.5,.5);for(let E=0;E<=64;E++){let D=E/64,I=0;const P=rn(0,w,D),[L,N,B]=ve(Iw,$d,P,ee);o.emplaceBack(L,N,B,D,I),l.emplaceBack(L,N,B,D,1-I);const U=Cn(P);D=.5+.5*Math.sin(U),I=.5+.5*Math.cos(U),h.emplaceBack(L,N,B,D,I),f.emplaceBack(L,N,B,D,1-I)}this._poleSegments.push(Ki.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(o,gp,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(l,gp,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(h,gp,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(f,gp,!1)}getGridBuffers(n,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},d.cZ=function(n){return ls.has(n)},d.c_=Cs,d.ca=s,d.cb=class extends da{constructor(n){super(n),this.current=y}set(n,t,o){if(this.fetchUniformLocation(n,t))for(let l=0;l<9;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}},d.cc=_t,d.cd=function(n,t,o){const l=Xc(o.zoom),h=n.style.map._antialias,f=t.options.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return 0===l&&!h&&!f},d.ce=function(n){const t=n.pixelsPerMeter,o=t/en(1,n.center.lat),l=d.a6.identity(new Float64Array(16));return d.a6.translate(l,l,[n.point.x,n.point.y,0]),d.a6.scale(l,l,[o,o,t]),Float32Array.from(l)},d.cf=yp,d.cg=function(n){const t=En-5;n=on(n,-t,t)/t*90;const o=Math.pow(Math.abs(Math.sin(Cn(n))),3);return Math.round(o*(fe.length-1))},d.ch=function(n,t,o,l){const h=t.getNorth(),f=t.getSouth(),g=t.getWest(),v=t.getEast(),w=1<<n.z,E=v-g,D=h-f,I=E/64,P=-D/fe[o],L=[0,I,0,P,0,0,h,g,0];if(n.z>0){const N=180/l;d.co.multiply(L,L,[N/E+1,0,0,0,N/D+1,0,-.5*N/I,.5*N/P,1])}return L[2]=w,L[5]=n.x,L[8]=n.y,L},d.ci=Va,d.cj=function(n,t,o){const l=d.a6.identity(new Float64Array(16)),h=(t/(1<<n)-.5)*Math.PI*2;return d.a6.rotateY(l,o.globeMatrix,h),Float32Array.from(l)},d.ck=class{isDataAvailableAtPoint(n){const t=this._source();if(this.isUsingMockSource()||!t||n.y<0||n.y>1)return!1;const o=t.getSource().maxzoom,l=1<<o,h=Math.floor(n.x),f=Math.floor((n.x-h)*l),g=Math.floor(n.y*l),v=this.findDEMTileFor(new Je(o,h,o,f,g));return!(!v||!v.dem)}getAtPointOrZero(n,t=0){return this.getAtPoint(n,t)||0}getAtPoint(n,t,o=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);const l=this._source();if(!l||n.y<0||n.y>1)return t;const h=l.getSource().maxzoom,f=1<<h,g=Math.floor(n.x),v=n.x-g,w=new Je(h,g,h,Math.floor(v*f),Math.floor(n.y*f)),E=this.findDEMTileFor(w);if(!E||!E.dem)return t;const D=E.dem,I=1<<E.tileID.canonical.z,P=(v*I-E.tileID.canonical.x)*D.dim,L=(n.y*I-E.tileID.canonical.y)*D.dim,N=Math.floor(P),B=Math.floor(L);return(o?this.exaggeration():1)*rn(rn(D.get(N,B),D.get(N,B+1),L-B),rn(D.get(N+1,B),D.get(N+1,B+1),L-B),P-N)}getAtTileOffset(n,t,o){const l=1<<n.canonical.z;return this.getAtPointOrZero(new zn(n.wrap+(n.canonical.x+t/gt)/l,(n.canonical.y+o/gt)/l))}getAtTileOffsetFunc(n,t,o,l){return h=>{const f=this.getAtTileOffset(n,h.x,h.y),g=l.upVector(n.canonical,h.x,h.y),v=l.upVectorScale(n.canonical,t,o).metersToTile;return d.N.scale(g,g,f*v),g}}getForTilePoints(n,t,o,l){if(this.isUsingMockSource())return!1;const h=ga.create(this,n,l);return!!h&&(t.forEach(f=>{f[2]=this.exaggeration()*h.getElevationAt(f[0],f[1],o)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(n);if(!t||!t.dem)return null;const o=t.dem.tree,l=t.tileID,h=1<<n.canonical.z-l.canonical.z;let f=n.canonical.x/h-l.canonical.x,g=n.canonical.y/h-l.canonical.y,v=0;for(let w=0;w<n.canonical.z-l.canonical.z&&!o.leaves[v];w++){f*=2,g*=2;const E=2*Math.floor(g)+Math.floor(f);v=o.childOffsets[v]+E,f%=1,g%=1}return{min:this.exaggeration()*o.minimums[v],max:this.exaggeration()*o.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,t,o){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(0===n.length)return null;let t=!1,o=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const h of n){const f=this.getMinMaxForTile(h.tileID);f&&(o=Math.min(o,f.min),l=Math.max(l,f.max),t=!0)}return t?{min:o,max:l}:null}},d.cl=lh,d.cm=ix,d.cn=function(n,t){return[Math.pow(n[0],2.2)*t,Math.pow(n[1],2.2)*t,Math.pow(n[2],2.2)*t]},d.cp=ch,d.cq=256,d.cr=function(n,t){const o=[0,0,0],l=xp(Va(t.canonical));return d.N.transformMat4(o,o,l),d.N.transformMat4(o,o,n),o},d.cs=n=>({u_camera_to_center_distance:new eo(n),u_extrude_scale:new C(n),u_device_pixel_ratio:new eo(n),u_matrix:new m(n),u_inv_rot_matrix:new m(n),u_merc_center:new Fa(n),u_tile_id:new np(n),u_zoom_transition:new eo(n),u_up_dir:new np(n),u_emissive_strength:new eo(n)}),d.ct=n=>({u_matrix:new m(n),u_pixels_to_tile_units:new C(n),u_device_pixel_ratio:new eo(n),u_units_to_pixels:new Fa(n),u_dash_image:new Wc(n),u_gradient_image:new Wc(n),u_image_height:new eo(n),u_texsize:new Fa(n),u_tile_units_to_pixels:new eo(n),u_alpha_discard_threshold:new eo(n),u_trim_offset:new Fa(n),u_emissive_strength:new eo(n)}),d.cu=n=>({u_matrix:new m(n),u_texsize:new Fa(n),u_pixels_to_tile_units:new C(n),u_device_pixel_ratio:new eo(n),u_image:new Wc(n),u_units_to_pixels:new Fa(n),u_tile_units_to_pixels:new eo(n),u_alpha_discard_threshold:new eo(n),u_trim_offset:new Fa(n)}),d.cv=Yu,d.cw=Hw,d.cx=qw,d.cy=rg,d.cz=(n,t,o,l,h,f)=>{const g=n.transform,v="globe"===g.projection.name;let w;if("map"===f.paint.get("circle-pitch-alignment"))if(v){const D=ch(g.zoom,t.canonical)*g._pixelsPerMercatorPixel;w=Float32Array.from([D,0,0,D])}else w=g.calculatePixelsToTileUnitsMatrix(o);else w=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(g.projection),u_matrix:n.translatePosMatrix(t.projMatrix,o,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Xe.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:ig,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(v){E.u_inv_rot_matrix=l,E.u_merc_center=h,E.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],E.u_zoom_transition=Xc(g.zoom);const D=h[0]*gt,I=h[1]*gt;E.u_up_dir=g.projection.upVector(new He(0,0,0),D,I)}return E},d.d=mt,d.d0=qr,d.d1=Nn,d.d2=Pe,d.d3=function([n,t,o]){const l=Math.hypot(n,t,o),h=Math.atan2(n,o),f=.5*Math.PI-Math.acos(-t/l);return new xe(Er(h),Er(f))},d.d4=Ae,d.d5=fn,d.d6=yy,d.d7=Mw,d.d8=function(n){const t=[0,0,0],o=d.a6.identity(new Float64Array(16));return d.a6.multiply(o,n.pixelMatrix,n.globeMatrix),d.N.transformMat4(t,t,o),new ht(t[0],t[1])},d.d9=function(n){const t=n.navigator?n.navigator.userAgent:null;return!!function(o){if(null==Ue){const l=o.navigator?o.navigator.userAgent:null;Ue=!!o.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Ue}(n)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},d.dA=Eo,d.dB=gf,d.dC=_f,d.dD=Mx,d.dE=si,d.dF=Ux,d.dG=function(n,t,o,l,h,f,g,v,w,E,D){n.createArrays(),n.tilePixelRatio=gt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const I=n.layers[0].layout,P=n.layers[0]._unevaluatedLayout._values,L={};if("composite"===n.textSizeData.kind){const{minZoom:H,maxZoom:Q}=n.textSizeData;L.compositeTextSizes=[P["text-size"].possiblyEvaluate(new Mi(H),v),P["text-size"].possiblyEvaluate(new Mi(Q),v)]}if("composite"===n.iconSizeData.kind){const{minZoom:H,maxZoom:Q}=n.iconSizeData;L.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new Mi(H),v),P["icon-size"].possiblyEvaluate(new Mi(Q),v)]}L.layoutTextSize=P["text-size"].possiblyEvaluate(new Mi(w+1),v),L.layoutIconSize=P["icon-size"].possiblyEvaluate(new Mi(w+1),v),L.textMaxSize=P["text-size"].possiblyEvaluate(new Mi(18),v);const N="map"===I.get("text-rotation-alignment")&&"point"!==I.get("symbol-placement"),B=I.get("text-size");let U=!1;for(const H of n.features)if(H.icon&&H.icon.nameSecondary){U=!0;break}for(const H of n.features){const Q=I.get("text-font").evaluate(H,{},v).join(","),ne=B.evaluate(H,{},v),ie=L.layoutTextSize.evaluate(H,{},v),ue=(L.layoutIconSize.evaluate(H,{},v),{horizontal:{},vertical:void 0}),ae=H.text;let de,ye=[0,0];if(ae){const we=ae.toString(),Oe=I.get("text-letter-spacing").evaluate(H,{},v)*ro,Ge=I.get("text-line-height").evaluate(H,{},v)*ro,Re=gl(we)?Oe:0,Ve=I.get("text-anchor").evaluate(H,{},v),Ie=I.get("text-variable-anchor");if(!Ie){const dt=I.get("text-radial-offset").evaluate(H,{},v);ye=dt?Hx(Ve,[dt*ro,Lg]):I.get("text-offset").evaluate(H,{},v).map(Ze=>Ze*ro)}let je=N?"center":I.get("text-justify").evaluate(H,{},v);const lt="point"===I.get("symbol-placement"),Be=lt?I.get("text-max-width").evaluate(H,{},v)*ro:1/0,yt=dt=>{n.allowVerticalPlacement&&Ro(we)&&(ue.vertical=Hy(ae,t,o,h,Q,Be,Ge,Ve,dt,Re,ye,ho.vertical,!0,ie,ne))};if(!N&&Ie){const dt="auto"===je?Ie.map(qt=>ev(qt)):[je];let Ze=!1;for(let qt=0;qt<dt.length;qt++){const Ft=dt[qt];if(!ue.horizontal[Ft])if(Ze)ue.horizontal[Ft]=ue.horizontal[0];else{const Tt=Hy(ae,t,o,h,Q,Be,Ge,"center",Ft,Re,ye,ho.horizontal,!1,ie,ne);Tt&&(ue.horizontal[Ft]=Tt,Ze=1===Tt.positionedLines.length)}}yt("left")}else{if("auto"===je&&(je=ev(Ve)),lt||I.get("text-writing-mode").indexOf("horizontal")>=0||!Ro(we)){const dt=Hy(ae,t,o,h,Q,Be,Ge,Ve,je,Re,ye,ho.horizontal,!1,ie,ne);dt&&(ue.horizontal[je]=dt)}yt(lt?"left":je)}}let be=!1;if(H.icon&&H.icon.namePrimary){const we=l[H.icon.namePrimary];we&&(de=nE(h[H.icon.namePrimary],H.icon.nameSecondary?h[H.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(H,{},v),I.get("icon-anchor").evaluate(H,{},v)),be=we.sdf,void 0===n.sdfIcons?n.sdfIcons=we.sdf:n.sdfIcons!==we.sdf&&tr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(we.pixelRatio!==n.pixelRatio||0!==I.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const Te=Zx(ue.horizontal)||ue.vertical;n.iconsInText||(n.iconsInText=!!Te&&Te.iconsInText),(Te||de)&&sE(n,H,ue,de,l,L,ie,0,ye,be,g,v,E,D,U)}f&&n.generateCollisionDebugBuffers(w,n.collisionBoxArray)},d.dH=pg,d.dI=vh,d.dJ=Ap,d.dK=$o,d.dL=wl,d.dM=Ip,d.dN=Ka,d.dO=Zw,d.dP=function(n){let t=0;if(new Uint32Array(n,0,1)[0]!==dv){const o=new Uint32Array(n,0,7),[,,l,h,f,g]=o;t=o.byteLength+h+f+g+f,(l!==n.byteLength||t>=n.byteLength)&&tr("Invalid b3dm header information.")}return Eb(n,t)},d.dQ=function(n,t){const o=Xg(n);for(const l of o){for(const h of l.meshes)Kg(h);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(Mb(l.lights,t)))}return o},d.dR=Qg,d.dS=vb,d.dT=Kr,d.dU=function(n){di(),Et&&Et.then(t=>{t.keys().then(o=>{for(let l=0;l<o.length-n;l++)t.delete(o[l])})})},d.da=class{constructor(n,t,o){this._transformRequestFn=n,this._customAccessToken=t,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const n=function(){let t="";for(let o=0;o<10;o++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",st,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,t){return this._transformRequestFn&&this._transformRequestFn(n,t)||{url:n}}normalizeStyleURL(n,t){if(!bn(n))return n;const o=Wt(n);return o.params.push(`sdk=js-${Zt}`),o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||t)}normalizeGlyphsURL(n,t){if(!bn(n))return n;const o=Wt(n);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||t)}normalizeModelURL(n,t){if(!bn(n))return n;const o=Wt(n);return o.path=`/models/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||t)}normalizeSourceURL(n,t,o,l){if(!bn(n))return n;const h=Wt(n);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),o&&h.params.push(`language=${o}`),l&&h.params.push(`worldview=${l}`),this._makeAPIURL(h,this._customAccessToken||t)}normalizeSpriteURL(n,t,o,l){const h=Wt(n);return bn(n)?(h.path=`/styles/v1${h.path}/sprite${t}${o}`,this._makeAPIURL(h,this._customAccessToken||l)):(h.path+=`${t}${o}`,An(h))}normalizeTileURL(n,t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!bn(n))return n;const l=Wt(n);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||o&&"raster"!==l.authority&&512===o?"@2x":""}${Wn.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${fn.RASTER_URL_PREFIX}${l.path}`:"rasterarrays"===l.authority?l.path=`/${fn.RASTERARRAYS_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${fn.TILE_URL_VERSION}${l.path}`);const h=this._customAccessToken||function(f){for(const g of f){const v=g.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(l.params)||fn.ACCESS_TOKEN;return fn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,h)}canonicalizeTileURL(n,t){const o=Wt(n);if(!o.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!o.path.match(/\.[\w]+$/))return n;let l="mapbox://";o.path.match(/^\/raster\/v1\//)?l+=`raster/${o.path.replace(`/${fn.RASTER_URL_PREFIX}/`,"")}`:o.path.match(/^\/rasterarrays\/v1\//)?l+=`rasterarrays/${o.path.replace(`/${fn.RASTERARRAYS_URL_PREFIX}/`,"")}`:l+=`tiles/${o.path.replace(`/${fn.TILE_URL_VERSION}/`,"")}`;let h=o.params;return t&&(h=h.filter(f=>!f.match(/^access_token=/))),h.length&&(l+=`?${h.join("&")}`),l}canonicalizeTileset(n,t){const o=!!t&&bn(t),l=[];for(const h of n.tiles||[])Ea(h)?l.push(this.canonicalizeTileURL(h,o)):l.push(h);return l}_makeAPIURL(n,t){const o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=Wt(fn.API_URL);if(n.protocol=l.protocol,n.authority=l.authority,"http"===n.protocol){const h=n.params.indexOf("secure");h>=0&&n.params.splice(h,1)}if("/"!==l.path&&(n.path=`${l.path}${n.path}`),!fn.REQUIRE_ACCESS_TOKEN)return An(n);if(t=t||fn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return n.params=n.params.filter(h=>-1===h.indexOf("access_token")),n.params.push(`access_token=${t||""}`),An(n)}},d.db=function(n,t){t?ls.add(n):ls.delete(n)},d.dc=Wn,d.dd=as,d.de=xu,d.df=vt,d.dg=Yn,d.dh=function(n){ls.delete(n)},d.di=Dr,d.dj=Zi,d.dk=Zt,d.dl=function(n,t){Ne=n,Rt=t},d.dm=function(n,t,o=!1){if(xo===yd||xo===vd||xo===xd)throw new Error("setRTLTextPlugin cannot be called multiple times.");aa=Xe.resolveURL(n),xo=yd,Uu=t,wd(),o||$c()},d.dn=Pa,d.dp=function(){dc().acquire(hc)},d.dq=function(){const n=jo;n&&(n.isPreloaded()&&1===n.numActive()?(n.release(hc),jo=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.dr=su,d.ds=function(n){const t=pn();if(!t)return;const o=t.delete(wt);n&&o.catch(n).then(()=>n())},d.dt=uc,d.du=Mh,d.dv=function(n){au=Xe.resolveURL(n),qa||(qa=new ya(dc(),new Tc)),qa.broadcast("setDracoUrl",au)},d.dw=Ih,d.dx=function(n){Ha=Xe.resolveURL(n),qa||(qa=new ya(dc(),new Tc)),qa.broadcast("setMeshoptUrl",Ha)},d.dy=Ct,d.dz=Jo,d.e=Vr,d.f=Xe,d.g=function(n,t){return Le(Vr(n,{type:"json"}),t)},d.h=wo,d.i=gn,d.j=wu,d.k=Mr,d.l=function(n){return fetch(n).then(t=>t.arrayBuffer()).then(t=>Eb(t,0,n))},d.m=yo,d.n=Bu,d.o=Hu,d.p=Up,d.q=Vf,d.r=Bf,d.s=Xr,d.t=Aa,d.u=Cd,d.v=kr,d.w=tr,d.x=Vl,d.z=Dd}),Df(0,function(d){function Zt(Ue){const te=Ue?Ue.url.toString():void 0;return te?performance.getEntriesByName(te):[]}function is(Ue){if("number"==typeof Ue||"boolean"==typeof Ue||"string"==typeof Ue||null==Ue)return JSON.stringify(Ue);if(Array.isArray(Ue)){let le="[";for(const _e of Ue)le+=`${is(_e)},`;return`${le}]`}let te="{";for(const le of Object.keys(Ue).sort())te+=`${le}:${is(Ue[le])},`;return`${te}}`}function fn(Ue){let te="";for(const le of d.b2)te+=`/${is(Ue[le])}`;return te}class Ea{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,le){this._layerConfigs={},this._layers={},this.update(te,[],le)}update(te,le,_e){this._options=_e;for(const $e of te)this._layerConfigs[$e.id]=$e,(this._layers[$e.id]=d.c2($e,this.scope,this._options)).compileFilter(),this.keyCache[$e.id]&&delete this.keyCache[$e.id];for(const $e of le)delete this.keyCache[$e],delete this._layerConfigs[$e],delete this._layers[$e];this.familiesBySource={};const Fe=function($e,Xe){const wt={};for(let Rt=0;Rt<$e.length;Rt++){const Et=Xe&&Xe[$e[Rt].id]||fn($e[Rt]);Xe&&(Xe[$e[Rt].id]=Et);let kt=wt[Et];kt||(kt=wt[Et]=[]),kt.push($e[Rt])}const Ne=[];for(const Rt in wt)Ne.push(wt[Rt]);return Ne}(d.a$(this._layerConfigs),this.keyCache);for(const $e of Fe){const Xe=$e.map(pn=>this._layers[pn.id]),wt=Xe[0];if("none"===wt.visibility)continue;const Ne=wt.source||"";let Rt=this.familiesBySource[Ne];Rt||(Rt=this.familiesBySource[Ne]={});const Et=wt.sourceLayer||"_geojsonTileLayer";let kt=Rt[Et];kt||(kt=Rt[Et]=[]),kt.push(Xe)}}}const bn=1*d.dA;class ao{constructor(te){const le={},_e=[];for(const wt in te){const Ne=te[wt],Rt=le[wt]={};for(const Et in Ne.glyphs){const kt=Ne.glyphs[+Et];if(!kt||0===kt.bitmap.width||0===kt.bitmap.height)continue;const pn=kt.metrics.localGlyph?bn:1,di={x:0,y:0,w:kt.bitmap.width+2*pn,h:kt.bitmap.height+2*pn};_e.push(di),Rt[Et]=di}}const{w:Fe,h:$e}=d.p(_e),Xe=new d.dz({width:Fe||1,height:$e||1});for(const wt in te){const Ne=te[wt];for(const Rt in Ne.glyphs){const Et=Ne.glyphs[+Rt];if(!Et||0===Et.bitmap.width||0===Et.bitmap.height)continue;const kt=le[wt][Rt],pn=Et.metrics.localGlyph?bn:1;d.dz.copy(Et.bitmap,Xe,{x:0,y:0},{x:kt.x+pn,y:kt.y+pn},Et.bitmap)}}this.image=Xe,this.positions=le}}d.dy(ao,"GlyphAtlas");class bs{constructor(te){this.tileID=new d.am(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.scope=te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.collectResourceTiming,this.promoteId=te.promoteId,this.isSymbolTile=te.isSymbolTile,this.tileTransform=d.as(te.tileID.canonical,te.projection),this.projection=te.projection,this.brightness=te.brightness,this.extraShadowCaster=!!te.extraShadowCaster}parse(te,le,_e,Fe,$e){this.status="parsing",this.data=te,this.collisionBoxArray=new d.aD;const Xe=new d.dB(Object.keys(te.layers).sort()),wt=new d.dC(this.tileID,this.promoteId);wt.bucketLayerIDs=[];const Ne={},Rt=new d.dD(256,256),Et={featureIndex:wt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Rt,availableImages:_e,brightness:this.brightness},kt=le.familiesBySource[this.source];for(const ai in kt){const Si=te.layers[ai];if(!Si)continue;let Cr=!1,Oi=!1,Zr=!1;for(const cr of kt[ai])"symbol"===cr[0].type?Cr=!0:Oi=!0,cr[0].is3D()&&"model"!==cr[0].type&&(Zr=!0);if(this.extraShadowCaster&&!Zr||!0===this.isSymbolTile&&!Cr||!1===this.isSymbolTile&&!Oi)continue;1===Si.version&&d.w(`Vector tile source "${this.source}" layer "${ai}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Wr=Xe.encode(ai),mo=[];for(let cr=0;cr<Si.length;cr++){const lr=Si.feature(cr),Le=wt.getId(lr,ai);mo.push({feature:lr,id:Le,index:cr,sourceLayerIndex:Wr})}for(const cr of kt[ai]){const lr=cr[0];(!this.extraShadowCaster||lr.is3D()&&"model"!==lr.type)&&(void 0!==this.isSymbolTile&&"symbol"===lr.type!==this.isSymbolTile||lr.minzoom&&this.zoom<Math.floor(lr.minzoom)||lr.maxzoom&&this.zoom>=lr.maxzoom||"none"!==lr.visibility&&(rs(cr,this.zoom,Et.brightness,_e),(Ne[lr.id]=lr.createBucket({index:wt.bucketLayerIDs.length,layers:cr,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wr,sourceID:this.source,projection:this.projection.spec})).populate(mo,Et,this.tileID.canonical,this.tileTransform),wt.bucketLayerIDs.push(cr.map(Le=>Le.id))))}}let pn,di,Pi,fi;Rt.trim();const Qn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Wn=()=>{if(pn)return this.status="done",$e(pn);if(this.extraShadowCaster)this.status="done",$e(null,{buckets:d.a$(Ne).filter(ai=>!ai.isEmpty()),featureIndex:wt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Et.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(di&&Pi&&fi){const ai=new ao(di),Si=new d.dF(Pi,fi);for(const Cr in Ne){const Oi=Ne[Cr];Oi instanceof d.aE?(rs(Oi.layers,this.zoom,Et.brightness,_e),d.dG(Oi,di,ai.positions,Pi,Si.iconPositions,this.showCollisionBoxes,_e,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Oi.hasPattern&&(Oi instanceof d.aK||Oi instanceof d.aL||Oi instanceof d.cH)&&(rs(Oi.layers,this.zoom,Et.brightness,_e),Oi.addFeatures(Et,this.tileID.canonical,Si.patternPositions,_e,this.tileTransform,this.brightness))}this.status="done",$e(null,{buckets:d.a$(Ne).filter(Cr=>!Cr.isEmpty()),featureIndex:wt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ai.image,lineAtlas:Rt,imageAtlas:Si,brightness:Et.brightness})}};if(!this.extraShadowCaster){const ai=d.dE(Et.glyphDependencies,Oi=>Object.keys(Oi).map(Number));Object.keys(ai).length?Fe.send("getGlyphs",{uid:this.uid,stacks:ai,scope:this.scope},(Oi,Zr)=>{pn||(pn=Oi,di=Zr,Wn())},void 0,!1,Qn):di={};const Si=Object.keys(Et.iconDependencies);Si.length?Fe.send("getImages",{icons:Si,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Oi,Zr)=>{pn||(pn=Oi,Pi=Zr,Wn())},void 0,!1,Qn):Pi={};const Cr=Object.keys(Et.patternDependencies);Cr.length?Fe.send("getImages",{icons:Cr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Oi,Zr)=>{pn||(pn=Oi,fi=Zr,Wn())},void 0,!1,Qn):fi={}}Wn()}}function rs(Ue,te,le,_e){const Fe=new d.K(te,{brightness:le});for(const $e of Ue)$e.recalculate(Fe,_e)}class Al extends d.E{constructor(te,le,_e,Fe,$e,Xe){super(),this.actor=te,this.layerIndex=le,this.availableImages=_e,this.loadVectorData=$e||d.ah,this.loading={},this.loaded={},this.deduped=new d.af(te.scheduler),this.isSpriteLoaded=Fe,this.scheduler=te.scheduler,this.brightness=Xe}loadTile(te,le){const _e=te.uid,Fe=te&&te.request,$e=Fe&&Fe.collectResourceTiming,Xe=this.loading[_e]=new bs(te);Xe.abort=this.loadVectorData(te,(wt,Ne)=>{const Rt=!this.loading[_e];if(delete this.loading[_e],Rt||wt||!Ne)return Xe.status="done",Rt||(this.loaded[_e]=Xe),le(wt);const Et=Ne.rawData,kt={};Ne.expires&&(kt.expires=Ne.expires),Ne.cacheControl&&(kt.cacheControl=Ne.cacheControl),Xe.vectorTile=Ne.vectorTile||new d.dH(new d.dI(Et));const pn=()=>{Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.actor,(di,Pi)=>{if(di||!Pi)return le(di);const fi={};if($e){const Qn=Zt(Fe);Qn.length>0&&(fi.resourceTiming=JSON.parse(JSON.stringify(Qn)))}le(null,d.e({rawTileData:Et.slice(0)},Pi,kt,fi))})};this.isSpriteLoaded?pn():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(pn,{type:"parseTile",isSymbolTile:te.isSymbolTile,zoom:te.tileZoom}):pn()}),this.loaded=this.loaded||{},this.loaded[_e]=Xe})}reloadTile(te,le){const _e=this.loaded,Fe=te.uid,$e=this;if(_e&&_e[Fe]){const Xe=_e[Fe];Xe.showCollisionBoxes=te.showCollisionBoxes,Xe.projection=te.projection,Xe.brightness=te.brightness,Xe.tileTransform=d.as(te.tileID.canonical,te.projection),Xe.extraShadowCaster=te.extraShadowCaster;const wt=(Ne,Rt)=>{const Et=Xe.reloadCallback;Et&&(delete Xe.reloadCallback,Xe.parse(Xe.vectorTile,$e.layerIndex,this.availableImages,$e.actor,Et)),le(Ne,Rt)};"parsing"===Xe.status?Xe.reloadCallback=wt:"done"===Xe.status&&(Xe.vectorTile?Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.actor,wt):wt())}else le(null,void 0)}abortTile(te,le){const _e=te.uid,Fe=this.loading[_e];Fe&&(Fe.abort&&Fe.abort(),delete this.loading[_e]),le()}removeTile(te,le){const _e=this.loaded,Fe=te.uid;_e&&_e[Fe]&&delete _e[Fe],le()}}class Gh{loadTile(te,le){const{uid:_e,encoding:Fe,rawImageData:$e,padding:Xe}=te,wt=ImageBitmap&&$e instanceof ImageBitmap?this.getImageData($e,Xe):$e;le(null,new d.dJ(_e,wt,Fe,Xe<1))}getImageData(te,le){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const _e=this.offscreenCanvasContext.getImageData(-le,-le,te.width+2*le,te.height+2*le);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),_e}}class $o{decodeRasterArray({task:te,buffer:le},_e){d.aZ.performDecoding(le,te).then(Fe=>{_e(null,Fe)},Fe=>{_e(Fe)})}}function Xa(Ue,te){if(0!==Ue.length){Go(Ue[0],te);for(var le=1;le<Ue.length;le++)Go(Ue[le],!te)}}function Go(Ue,te){for(var le=0,_e=0,Fe=0,$e=Ue.length,Xe=$e-1;Fe<$e;Xe=Fe++){var wt=(Ue[Fe][0]-Ue[Xe][0])*(Ue[Xe][1]+Ue[Fe][1]),Ne=le+wt;_e+=Math.abs(le)>=Math.abs(wt)?le-Ne+wt:wt-Ne+le,le=Ne}le+_e>=0!=!!te&&Ue.reverse()}var ws=d.dK(function Ue(te,le){var _e,Fe=te&&te.type;if("FeatureCollection"===Fe)for(_e=0;_e<te.features.length;_e++)Ue(te.features[_e],le);else if("GeometryCollection"===Fe)for(_e=0;_e<te.geometries.length;_e++)Ue(te.geometries[_e],le);else if("Feature"===Fe)Ue(te.geometry,le);else if("Polygon"===Fe)Xa(te.coordinates,le);else if("MultiPolygon"===Fe)for(_e=0;_e<te.coordinates.length;_e++)Xa(te.coordinates[_e],le);return te});const Ka=d.dL.prototype.toGeoJSON;var Ca={exports:{}},gu=d.dN,Cn=d.dM.VectorTileFeature,Er=Hh;function Hh(Ue,te){this.options=te||{},this.features=Ue,this.length=Ue.length}function _t(Ue,te){this.id="number"==typeof Ue.id?Ue.id:void 0,this.type=Ue.type,this.rawGeometry=1===Ue.type?[Ue.geometry]:Ue.geometry,this.properties=Ue.tags,this.extent=te||4096}Hh.prototype.feature=function(Ue){return new _t(this.features[Ue],this.options.extent)},_t.prototype.loadGeometry=function(){var Ue=this.rawGeometry;this.geometry=[];for(var te=0;te<Ue.length;te++){for(var le=Ue[te],_e=[],Fe=0;Fe<le.length;Fe++)_e.push(new gu(le[Fe][0],le[Fe][1]));this.geometry.push(_e)}return this.geometry},_t.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ue=this.geometry,te=1/0,le=-1/0,_e=1/0,Fe=-1/0,$e=0;$e<Ue.length;$e++)for(var Xe=Ue[$e],wt=0;wt<Xe.length;wt++){var Ne=Xe[wt];te=Math.min(te,Ne.x),le=Math.max(le,Ne.x),_e=Math.min(_e,Ne.y),Fe=Math.max(Fe,Ne.y)}return[te,_e,le,Fe]},_t.prototype.toGeoJSON=Cn.prototype.toGeoJSON;var Cs=d.dO,qr=Er;function on(Ue){var te=new Cs;return function(le,_e){for(var Fe in le.layers)_e.writeMessage(3,xc,le.layers[Fe])}(Ue,te),te.finish()}function xc(Ue,te){var le;te.writeVarintField(15,Ue.version||1),te.writeStringField(1,Ue.name||""),te.writeVarintField(5,Ue.extent||4096);var _e={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<Ue.length;le++)_e.feature=Ue.feature(le),te.writeMessage(2,Da,_e);var Fe=_e.keys;for(le=0;le<Fe.length;le++)te.writeStringField(3,Fe[le]);var $e=_e.values;for(le=0;le<$e.length;le++)te.writeMessage(4,_u,$e[le])}function Da(Ue,te){var le=Ue.feature;void 0!==le.id&&te.writeVarintField(1,le.id),te.writeMessage(2,Di,Ue),te.writeVarintField(3,le.type),te.writeMessage(4,bc,le)}function Di(Ue,te){var le=Ue.feature,_e=Ue.keys,Fe=Ue.values,$e=Ue.keycache,Xe=Ue.valuecache;for(var wt in le.properties){var Ne=le.properties[wt],Rt=$e[wt];if(null!==Ne){void 0===Rt&&(_e.push(wt),$e[wt]=Rt=_e.length-1),te.writeVarint(Rt);var Et=typeof Ne;"string"!==Et&&"boolean"!==Et&&"number"!==Et&&(Ne=JSON.stringify(Ne));var kt=Et+":"+Ne,pn=Xe[kt];void 0===pn&&(Fe.push(Ne),Xe[kt]=pn=Fe.length-1),te.writeVarint(pn)}}}function Vr(Ue,te){return(te<<3)+(7&Ue)}function Rl(Ue){return Ue<<1^Ue>>31}function bc(Ue,te){for(var le=Ue.loadGeometry(),_e=Ue.type,Fe=0,$e=0,Xe=le.length,wt=0;wt<Xe;wt++){var Ne=le[wt],Rt=1;1===_e&&(Rt=Ne.length),te.writeVarint(Vr(1,Rt));for(var Et=3===_e?Ne.length-1:Ne.length,kt=0;kt<Et;kt++){1===kt&&1!==_e&&te.writeVarint(Vr(2,Et-1));var pn=Ne[kt].x-Fe,di=Ne[kt].y-$e;te.writeVarint(Rl(pn)),te.writeVarint(Rl(di)),Fe+=pn,$e+=di}3===_e&&te.writeVarint(Vr(7,1))}}function _u(Ue,te){var le=typeof Ue;"string"===le?te.writeStringField(1,Ue):"boolean"===le?te.writeBooleanField(7,Ue):"number"===le&&(Ue%1!=0?te.writeDoubleField(3,Ue):Ue<0?te.writeSVarintField(6,Ue):te.writeVarintField(5,Ue))}Ca.exports=on,Ca.exports.fromVectorTileJs=on,Ca.exports.fromGeojsonVt=function(Ue,te){te=te||{};var le={};for(var _e in Ue)le[_e]=new qr(Ue[_e].features,te),le[_e].name=_e,le[_e].version=te.version,le[_e].extent=te.extent;return on({layers:le})},Ca.exports.GeoJSONWrapper=qr;var Ti=d.dK(Ca.exports);const wc={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ue=>Ue},Ja=Math.fround||(Fi=new Float32Array(1),Ue=>(Fi[0]=+Ue,Fi[0]));var Fi;const si=3,os=5,ti=6;class Ec{constructor(te){this.options=Object.assign(Object.create(wc),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:le,minZoom:_e,maxZoom:Fe}=this.options;le&&console.time("total time");const $e=`prepare ${te.length} points`;le&&console.time($e),this.points=te;const Xe=[];for(let Ne=0;Ne<te.length;Ne++){const Rt=te[Ne];if(!Rt.geometry)continue;const[Et,kt]=Rt.geometry.coordinates,pn=Ja(Pl(Et)),di=Ja(Ta(kt));Xe.push(pn,di,1/0,Ne,-1,1),this.options.reduce&&Xe.push(0)}let wt=this.trees[Fe+1]=this._createTree(Xe);le&&console.timeEnd($e);for(let Ne=Fe;Ne>=_e;Ne--){const Rt=+Date.now();wt=this.trees[Ne]=this._createTree(this._cluster(wt,Ne)),le&&console.log("z%d: %d clusters in %dms",Ne,wt.numItems,+Date.now()-Rt)}return le&&console.timeEnd("total time"),this}getClusters(te,le){let _e=((te[0]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,te[1]));let $e=180===te[2]?180:((te[2]+180)%360+360)%360-180;const Xe=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)_e=-180,$e=180;else if(_e>$e){const kt=this.getClusters([_e,Fe,180,Xe],le),pn=this.getClusters([-180,Fe,$e,Xe],le);return kt.concat(pn)}const wt=this.trees[this._limitZoom(le)],Ne=wt.range(Pl(_e),Ta(Xe),Pl($e),Ta(Fe)),Rt=wt.data,Et=[];for(const kt of Ne){const pn=this.stride*kt;Et.push(Rt[pn+os]>1?tr(Rt,pn,this.clusterProps):this.points[Rt[pn+si]])}return Et}getChildren(te){const le=this._getOriginId(te),_e=this._getOriginZoom(te),Fe="No cluster with the specified id.",$e=this.trees[_e];if(!$e)throw new Error(Fe);const Xe=$e.data;if(le*this.stride>=Xe.length)throw new Error(Fe);const wt=this.options.radius/(this.options.extent*Math.pow(2,_e-1)),Ne=$e.within(Xe[le*this.stride],Xe[le*this.stride+1],wt),Rt=[];for(const Et of Ne){const kt=Et*this.stride;Xe[kt+4]===te&&Rt.push(Xe[kt+os]>1?tr(Xe,kt,this.clusterProps):this.points[Xe[kt+si]])}if(0===Rt.length)throw new Error(Fe);return Rt}getLeaves(te,le,_e){const Fe=[];return this._appendLeaves(Fe,te,le=le||10,_e=_e||0,0),Fe}getTile(te,le,_e){const Fe=this.trees[this._limitZoom(te)],$e=Math.pow(2,te),{extent:Xe,radius:wt}=this.options,Ne=wt/Xe,Rt=(_e-Ne)/$e,Et=(_e+1+Ne)/$e,kt={features:[]};return this._addTileFeatures(Fe.range((le-Ne)/$e,Rt,(le+1+Ne)/$e,Et),Fe.data,le,_e,$e,kt),0===le&&this._addTileFeatures(Fe.range(1-Ne/$e,Rt,1,Et),Fe.data,$e,_e,$e,kt),le===$e-1&&this._addTileFeatures(Fe.range(0,Rt,Ne/$e,Et),Fe.data,-1,_e,$e,kt),kt.features.length?kt:null}getClusterExpansionZoom(te){let le=this._getOriginZoom(te)-1;for(;le<=this.options.maxZoom;){const _e=this.getChildren(te);if(le++,1!==_e.length)break;te=_e[0].properties.cluster_id}return le}_appendLeaves(te,le,_e,Fe,$e){const Xe=this.getChildren(le);for(const wt of Xe){const Ne=wt.properties;if(Ne&&Ne.cluster?$e+Ne.point_count<=Fe?$e+=Ne.point_count:$e=this._appendLeaves(te,Ne.cluster_id,_e,Fe,$e):$e<Fe?$e++:te.push(wt),te.length===_e)break}return $e}_createTree(te){const le=new d.bg(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let _e=0;_e<te.length;_e+=this.stride)le.add(te[_e],te[_e+1]);return le.finish(),le.data=te,le}_addTileFeatures(te,le,_e,Fe,$e,Xe){for(const wt of te){const Ne=wt*this.stride,Rt=le[Ne+os]>1;let Et,kt,pn;if(Rt)Et=Io(le,Ne,this.clusterProps),kt=le[Ne],pn=le[Ne+1];else{const fi=this.points[le[Ne+si]];Et=fi.properties;const[Qn,Wn]=fi.geometry.coordinates;kt=Pl(Qn),pn=Ta(Wn)}const di={type:1,geometry:[[Math.round(this.options.extent*(kt*$e-_e)),Math.round(this.options.extent*(pn*$e-Fe))]],tags:Et};let Pi;Pi=Rt||this.options.generateId?le[Ne+si]:this.points[le[Ne+si]].id,void 0!==Pi&&(di.id=Pi),Xe.features.push(di)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,le){const{radius:_e,extent:Fe,reduce:$e,minPoints:Xe}=this.options,wt=_e/(Fe*Math.pow(2,le)),Ne=te.data,Rt=[],Et=this.stride;for(let kt=0;kt<Ne.length;kt+=Et){if(Ne[kt+2]<=le)continue;Ne[kt+2]=le;const pn=Ne[kt],di=Ne[kt+1],Pi=te.within(Ne[kt],Ne[kt+1],wt),fi=Ne[kt+os];let Qn=fi;for(const Wn of Pi){const ai=Wn*Et;Ne[ai+2]>le&&(Qn+=Ne[ai+os])}if(Qn>fi&&Qn>=Xe){let Wn,ai=pn*fi,Si=di*fi,Cr=-1;const Oi=(kt/Et<<5)+(le+1)+this.points.length;for(const Zr of Pi){const Wr=Zr*Et;if(Ne[Wr+2]<=le)continue;Ne[Wr+2]=le;const mo=Ne[Wr+os];ai+=Ne[Wr]*mo,Si+=Ne[Wr+1]*mo,Ne[Wr+4]=Oi,$e&&(Wn||(Wn=this._map(Ne,kt,!0),Cr=this.clusterProps.length,this.clusterProps.push(Wn)),$e(Wn,this._map(Ne,Wr)))}Ne[kt+4]=Oi,Rt.push(ai/Qn,Si/Qn,1/0,Oi,-1,Qn),$e&&Rt.push(Cr)}else{for(let Wn=0;Wn<Et;Wn++)Rt.push(Ne[kt+Wn]);if(Qn>1)for(const Wn of Pi){const ai=Wn*Et;if(!(Ne[ai+2]<=le)){Ne[ai+2]=le;for(let Si=0;Si<Et;Si++)Rt.push(Ne[ai+Si])}}}}return Rt}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,le,_e){if(te[le+os]>1){const Xe=this.clusterProps[te[le+ti]];return _e?Object.assign({},Xe):Xe}const Fe=this.points[te[le+si]].properties,$e=this.options.map(Fe);return _e&&$e===Fe?Object.assign({},$e):$e}}function tr(Ue,te,le){return{type:"Feature",id:Ue[te+si],properties:Io(Ue,te,le),geometry:{type:"Point",coordinates:[(_e=Ue[te],360*(_e-.5)),Xs(Ue[te+1])]}};var _e}function Io(Ue,te,le){const _e=Ue[te+os],Fe=_e>=1e4?`${Math.round(_e/1e3)}k`:_e>=1e3?Math.round(_e/100)/10+"k":_e,$e=Ue[te+ti],Xe=-1===$e?{}:Object.assign({},le[$e]);return Object.assign(Xe,{cluster:!0,cluster_id:Ue[te+si],point_count:_e,point_count_abbreviated:Fe})}function Pl(Ue){return Ue/360+.5}function Ta(Ue){const te=Math.sin(Ue*Math.PI/180),le=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return le<0?0:le>1?1:le}function Xs(Ue){const te=(180-360*Ue)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}var Cc={exports:{}};Cc.exports=function(){function Ue(Le,ze,Ke,ot){for(var it,tt=ot,mt=Ke-ze>>1,st=Ke-ze,vt=Le[ze],ct=Le[ze+1],Wt=Le[Ke],An=Le[Ke+1],Nt=ze+3;Nt<Ke;Nt+=3){var Hn=te(Le[Nt],Le[Nt+1],vt,ct,Wt,An);if(Hn>tt)it=Nt,tt=Hn;else if(Hn===tt){var Ni=Math.abs(Nt-mt);Ni<st&&(it=Nt,st=Ni)}}tt>ot&&(it-ze>3&&Ue(Le,ze,it,ot),Le[it+2]=tt,Ke-it>3&&Ue(Le,it,Ke,ot))}function te(Le,ze,Ke,ot,it,tt){var mt=it-Ke,st=tt-ot;if(0!==mt||0!==st){var vt=((Le-Ke)*mt+(ze-ot)*st)/(mt*mt+st*st);vt>1?(Ke=it,ot=tt):vt>0&&(Ke+=mt*vt,ot+=st*vt)}return(mt=Le-Ke)*mt+(st=ze-ot)*st}function le(Le,ze,Ke,ot){var it={id:void 0===Le?null:Le,type:ze,geometry:Ke,tags:ot,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(tt){var mt=tt.geometry,st=tt.type;if("Point"===st||"MultiPoint"===st||"LineString"===st)_e(tt,mt);else if("Polygon"===st||"MultiLineString"===st)for(var vt=0;vt<mt.length;vt++)_e(tt,mt[vt]);else if("MultiPolygon"===st)for(vt=0;vt<mt.length;vt++)for(var ct=0;ct<mt[vt].length;ct++)_e(tt,mt[vt][ct])}(it),it}function _e(Le,ze){for(var Ke=0;Ke<ze.length;Ke+=3)Le.minX=Math.min(Le.minX,ze[Ke]),Le.minY=Math.min(Le.minY,ze[Ke+1]),Le.maxX=Math.max(Le.maxX,ze[Ke]),Le.maxY=Math.max(Le.maxY,ze[Ke+1])}function Fe(Le,ze,Ke,ot){if(ze.geometry){var it=ze.geometry.coordinates,tt=ze.geometry.type,mt=Math.pow(Ke.tolerance/((1<<Ke.maxZoom)*Ke.extent),2),st=[],vt=ze.id;if(Ke.promoteId?vt=ze.properties[Ke.promoteId]:Ke.generateId&&(vt=ot||0),"Point"===tt)$e(it,st);else if("MultiPoint"===tt)for(var ct=0;ct<it.length;ct++)$e(it[ct],st);else if("LineString"===tt)Xe(it,st,mt,!1);else if("MultiLineString"===tt){if(Ke.lineMetrics){for(ct=0;ct<it.length;ct++)Xe(it[ct],st=[],mt,!1),Le.push(le(vt,"LineString",st,ze.properties));return}wt(it,st,mt,!1)}else if("Polygon"===tt)wt(it,st,mt,!0);else{if("MultiPolygon"!==tt){if("GeometryCollection"===tt){for(ct=0;ct<ze.geometry.geometries.length;ct++)Fe(Le,{id:vt,geometry:ze.geometry.geometries[ct],properties:ze.properties},Ke,ot);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ct=0;ct<it.length;ct++){var Wt=[];wt(it[ct],Wt,mt,!0),st.push(Wt)}}Le.push(le(vt,tt,st,ze.properties))}}function $e(Le,ze){ze.push(Ne(Le[0])),ze.push(Rt(Le[1])),ze.push(0)}function Xe(Le,ze,Ke,ot){for(var it,tt,mt=0,st=0;st<Le.length;st++){var vt=Ne(Le[st][0]),ct=Rt(Le[st][1]);ze.push(vt),ze.push(ct),ze.push(0),st>0&&(mt+=ot?(it*ct-vt*tt)/2:Math.sqrt(Math.pow(vt-it,2)+Math.pow(ct-tt,2))),it=vt,tt=ct}var Wt=ze.length-3;ze[2]=1,Ue(ze,0,Wt,Ke),ze[Wt+2]=1,ze.size=Math.abs(mt),ze.start=0,ze.end=ze.size}function wt(Le,ze,Ke,ot){for(var it=0;it<Le.length;it++){var tt=[];Xe(Le[it],tt,Ke,ot),ze.push(tt)}}function Ne(Le){return Le/360+.5}function Rt(Le){var ze=Math.sin(Le*Math.PI/180),Ke=.5-.25*Math.log((1+ze)/(1-ze))/Math.PI;return Ke<0?0:Ke>1?1:Ke}function Et(Le,ze,Ke,ot,it,tt,mt,st){if(ot/=ze,tt>=(Ke/=ze)&&mt<ot)return Le;if(mt<Ke||tt>=ot)return null;for(var vt=[],ct=0;ct<Le.length;ct++){var Wt=Le[ct],An=Wt.geometry,Nt=Wt.type,Hn=0===it?Wt.minX:Wt.minY,Ni=0===it?Wt.maxX:Wt.maxY;if(Hn>=Ke&&Ni<ot)vt.push(Wt);else if(!(Ni<Ke||Hn>=ot)){var Un=[];if("Point"===Nt||"MultiPoint"===Nt)kt(An,Un,Ke,ot,it);else if("LineString"===Nt)pn(An,Un,Ke,ot,it,!1,st.lineMetrics);else if("MultiLineString"===Nt)Pi(An,Un,Ke,ot,it,!1);else if("Polygon"===Nt)Pi(An,Un,Ke,ot,it,!0);else if("MultiPolygon"===Nt)for(var qi=0;qi<An.length;qi++){var Zi=[];Pi(An[qi],Zi,Ke,ot,it,!0),Zi.length&&Un.push(Zi)}if(Un.length){if(st.lineMetrics&&"LineString"===Nt){for(qi=0;qi<Un.length;qi++)vt.push(le(Wt.id,Nt,Un[qi],Wt.tags));continue}"LineString"!==Nt&&"MultiLineString"!==Nt||(1===Un.length?(Nt="LineString",Un=Un[0]):Nt="MultiLineString"),"Point"!==Nt&&"MultiPoint"!==Nt||(Nt=3===Un.length?"Point":"MultiPoint"),vt.push(le(Wt.id,Nt,Un,Wt.tags))}}}return vt.length?vt:null}function kt(Le,ze,Ke,ot,it){for(var tt=0;tt<Le.length;tt+=3){var mt=Le[tt+it];mt>=Ke&&mt<=ot&&(ze.push(Le[tt]),ze.push(Le[tt+1]),ze.push(Le[tt+2]))}}function pn(Le,ze,Ke,ot,it,tt,mt){for(var st,vt,ct=di(Le),Wt=0===it?Qn:Wn,An=Le.start,Nt=0;Nt<Le.length-3;Nt+=3){var Hn=Le[Nt],Ni=Le[Nt+1],Un=Le[Nt+2],qi=Le[Nt+3],Zi=Le[Nt+4],Yn=0===it?Hn:Ni,Ho=0===it?qi:Zi,as=!1;mt&&(st=Math.sqrt(Math.pow(Hn-qi,2)+Math.pow(Ni-Zi,2))),Yn<Ke?Ho>Ke&&(vt=Wt(ct,Hn,Ni,qi,Zi,Ke),mt&&(ct.start=An+st*vt)):Yn>ot?Ho<ot&&(vt=Wt(ct,Hn,Ni,qi,Zi,ot),mt&&(ct.start=An+st*vt)):fi(ct,Hn,Ni,Un),Ho<Ke&&Yn>=Ke&&(vt=Wt(ct,Hn,Ni,qi,Zi,Ke),as=!0),Ho>ot&&Yn<=ot&&(vt=Wt(ct,Hn,Ni,qi,Zi,ot),as=!0),!tt&&as&&(mt&&(ct.end=An+st*vt),ze.push(ct),ct=di(Le)),mt&&(An+=st)}var Dr=Le.length-3;Hn=Le[Dr],Ni=Le[Dr+1],Un=Le[Dr+2],(Yn=0===it?Hn:Ni)>=Ke&&Yn<=ot&&fi(ct,Hn,Ni,Un),Dr=ct.length-3,tt&&Dr>=3&&(ct[Dr]!==ct[0]||ct[Dr+1]!==ct[1])&&fi(ct,ct[0],ct[1],ct[2]),ct.length&&ze.push(ct)}function di(Le){var ze=[];return ze.size=Le.size,ze.start=Le.start,ze.end=Le.end,ze}function Pi(Le,ze,Ke,ot,it,tt){for(var mt=0;mt<Le.length;mt++)pn(Le[mt],ze,Ke,ot,it,tt,!1)}function fi(Le,ze,Ke,ot){Le.push(ze),Le.push(Ke),Le.push(ot)}function Qn(Le,ze,Ke,ot,it,tt){var mt=(tt-ze)/(ot-ze);return Le.push(tt),Le.push(Ke+(it-Ke)*mt),Le.push(1),mt}function Wn(Le,ze,Ke,ot,it,tt){var mt=(tt-Ke)/(it-Ke);return Le.push(ze+(ot-ze)*mt),Le.push(tt),Le.push(1),mt}function ai(Le,ze){for(var Ke=[],ot=0;ot<Le.length;ot++){var it,tt=Le[ot],mt=tt.type;if("Point"===mt||"MultiPoint"===mt||"LineString"===mt)it=Si(tt.geometry,ze);else if("MultiLineString"===mt||"Polygon"===mt){it=[];for(var st=0;st<tt.geometry.length;st++)it.push(Si(tt.geometry[st],ze))}else if("MultiPolygon"===mt)for(it=[],st=0;st<tt.geometry.length;st++){for(var vt=[],ct=0;ct<tt.geometry[st].length;ct++)vt.push(Si(tt.geometry[st][ct],ze));it.push(vt)}Ke.push(le(tt.id,mt,it,tt.tags))}return Ke}function Si(Le,ze){var Ke=[];Ke.size=Le.size,void 0!==Le.start&&(Ke.start=Le.start,Ke.end=Le.end);for(var ot=0;ot<Le.length;ot+=3)Ke.push(Le[ot]+ze,Le[ot+1],Le[ot+2]);return Ke}function Cr(Le,ze){if(Le.transformed)return Le;var Ke,ot,it,tt=1<<Le.z,mt=Le.x,st=Le.y;for(Ke=0;Ke<Le.features.length;Ke++){var vt=Le.features[Ke],ct=vt.geometry,Wt=vt.type;if(vt.geometry=[],1===Wt)for(ot=0;ot<ct.length;ot+=2)vt.geometry.push(Oi(ct[ot],ct[ot+1],ze,tt,mt,st));else for(ot=0;ot<ct.length;ot++){var An=[];for(it=0;it<ct[ot].length;it+=2)An.push(Oi(ct[ot][it],ct[ot][it+1],ze,tt,mt,st));vt.geometry.push(An)}}return Le.transformed=!0,Le}function Oi(Le,ze,Ke,ot,it,tt){return[Math.round(Ke*(Le*ot-it)),Math.round(Ke*(ze*ot-tt))]}function Zr(Le,ze,Ke,ot,it){for(var tt=ze===it.maxZoom?0:it.tolerance/((1<<ze)*it.extent),mt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ke,y:ot,z:ze,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},st=0;st<Le.length;st++){mt.numFeatures++,Wr(mt,Le[st],tt,it);var vt=Le[st].minX,ct=Le[st].minY,Wt=Le[st].maxX,An=Le[st].maxY;vt<mt.minX&&(mt.minX=vt),ct<mt.minY&&(mt.minY=ct),Wt>mt.maxX&&(mt.maxX=Wt),An>mt.maxY&&(mt.maxY=An)}return mt}function Wr(Le,ze,Ke,ot){var it=ze.geometry,tt=ze.type,mt=[];if("Point"===tt||"MultiPoint"===tt)for(var st=0;st<it.length;st+=3)mt.push(it[st]),mt.push(it[st+1]),Le.numPoints++,Le.numSimplified++;else if("LineString"===tt)mo(mt,it,Le,Ke,!1,!1);else if("MultiLineString"===tt||"Polygon"===tt)for(st=0;st<it.length;st++)mo(mt,it[st],Le,Ke,"Polygon"===tt,0===st);else if("MultiPolygon"===tt)for(var vt=0;vt<it.length;vt++){var ct=it[vt];for(st=0;st<ct.length;st++)mo(mt,ct[st],Le,Ke,!0,0===st)}if(mt.length){var Wt=ze.tags||null;if("LineString"===tt&&ot.lineMetrics){for(var An in Wt={},ze.tags)Wt[An]=ze.tags[An];Wt.mapbox_clip_start=it.start/it.size,Wt.mapbox_clip_end=it.end/it.size}var Nt={geometry:mt,type:"Polygon"===tt||"MultiPolygon"===tt?3:"LineString"===tt||"MultiLineString"===tt?2:1,tags:Wt};null!==ze.id&&(Nt.id=ze.id),Le.features.push(Nt)}}function mo(Le,ze,Ke,ot,it,tt){var mt=ot*ot;if(ot>0&&ze.size<(it?mt:ot))Ke.numPoints+=ze.length/3;else{for(var st=[],vt=0;vt<ze.length;vt+=3)(0===ot||ze[vt+2]>mt)&&(Ke.numSimplified++,st.push(ze[vt]),st.push(ze[vt+1])),Ke.numPoints++;it&&function(ct,Wt){for(var An=0,Nt=0,Hn=ct.length,Ni=Hn-2;Nt<Hn;Ni=Nt,Nt+=2)An+=(ct[Nt]-ct[Ni])*(ct[Nt+1]+ct[Ni+1]);if(An>0===Wt)for(Nt=0,Hn=ct.length;Nt<Hn/2;Nt+=2){var Un=ct[Nt],qi=ct[Nt+1];ct[Nt]=ct[Hn-2-Nt],ct[Nt+1]=ct[Hn-1-Nt],ct[Hn-2-Nt]=Un,ct[Hn-1-Nt]=qi}}(st,tt),Le.push(st)}}function cr(Le,ze){var Ke=(ze=this.options=function(it,tt){for(var mt in tt)it[mt]=tt[mt];return it}(Object.create(this.options),ze)).debug;if(Ke&&console.time("preprocess data"),ze.maxZoom<0||ze.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ze.promoteId&&ze.generateId)throw new Error("promoteId and generateId cannot be used together.");var it,tt,mt,st,vt,ct,ot=function(it,tt){var mt=[];if("FeatureCollection"===it.type)for(var st=0;st<it.features.length;st++)Fe(mt,it.features[st],tt,st);else Fe(mt,"Feature"===it.type?it:{geometry:it},tt);return mt}(Le,ze);this.tiles={},this.tileCoords=[],Ke&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ze.indexMaxZoom,ze.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(it=ot,tt=ze,mt=tt.buffer/tt.extent,st=it,vt=Et(it,1,-1-mt,mt,0,-1,2,tt),ct=Et(it,1,1-mt,2+mt,0,-1,2,tt),(vt||ct)&&(st=Et(it,1,-mt,1+mt,0,-1,2,tt)||[],vt&&(st=ai(vt,1).concat(st)),ct&&(st=st.concat(ai(ct,-1)))),ot=st).length&&this.splitTile(ot,0,0,0),Ke&&(ot.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function lr(Le,ze,Ke){return 32*((1<<Le)*Ke+ze)+Le}return cr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},cr.prototype.splitTile=function(Le,ze,Ke,ot,it,tt,mt){for(var st=[Le,ze,Ke,ot],vt=this.options,ct=vt.debug;st.length;){ot=st.pop(),Ke=st.pop(),ze=st.pop(),Le=st.pop();var Wt=1<<ze,An=lr(ze,Ke,ot),Nt=this.tiles[An];if(!Nt&&(ct>1&&console.time("creation"),Nt=this.tiles[An]=Zr(Le,ze,Ke,ot,vt),this.tileCoords.push({z:ze,x:Ke,y:ot}),ct)){ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ze,Ke,ot,Nt.numFeatures,Nt.numPoints,Nt.numSimplified),console.timeEnd("creation"));var Hn="z"+ze;this.stats[Hn]=(this.stats[Hn]||0)+1,this.total++}if(Nt.source=Le,it){if(ze===vt.maxZoom||ze===it)continue;var Ni=1<<it-ze;if(Ke!==Math.floor(tt/Ni)||ot!==Math.floor(mt/Ni))continue}else if(ze===vt.indexMaxZoom||Nt.numPoints<=vt.indexMaxPoints)continue;if(Nt.source=null,0!==Le.length){ct>1&&console.time("clipping");var Un,qi,Zi,Yn,Ho,as,Dr=.5*vt.buffer/vt.extent,xu=.5-Dr,ls=.5+Dr,Dc=1+Dr;Un=qi=Zi=Yn=null,Ho=Et(Le,Wt,Ke-Dr,Ke+ls,0,Nt.minX,Nt.maxX,vt),as=Et(Le,Wt,Ke+xu,Ke+Dc,0,Nt.minX,Nt.maxX,vt),Le=null,Ho&&(Un=Et(Ho,Wt,ot-Dr,ot+ls,1,Nt.minY,Nt.maxY,vt),qi=Et(Ho,Wt,ot+xu,ot+Dc,1,Nt.minY,Nt.maxY,vt),Ho=null),as&&(Zi=Et(as,Wt,ot-Dr,ot+ls,1,Nt.minY,Nt.maxY,vt),Yn=Et(as,Wt,ot+xu,ot+Dc,1,Nt.minY,Nt.maxY,vt),as=null),ct>1&&console.timeEnd("clipping"),st.push(Un||[],ze+1,2*Ke,2*ot),st.push(qi||[],ze+1,2*Ke,2*ot+1),st.push(Zi||[],ze+1,2*Ke+1,2*ot),st.push(Yn||[],ze+1,2*Ke+1,2*ot+1)}}},cr.prototype.getTile=function(Le,ze,Ke){var ot=this.options,it=ot.extent,tt=ot.debug;if(Le<0||Le>24)return null;var mt=1<<Le,st=lr(Le,ze=(ze%mt+mt)%mt,Ke);if(this.tiles[st])return Cr(this.tiles[st],it);tt>1&&console.log("drilling down to z%d-%d-%d",Le,ze,Ke);for(var vt,ct=Le,Wt=ze,An=Ke;!vt&&ct>0;)ct--,Wt=Math.floor(Wt/2),An=Math.floor(An/2),vt=this.tiles[lr(ct,Wt,An)];return vt&&vt.source?(tt>1&&console.log("found parent tile z%d-%d-%d",ct,Wt,An),tt>1&&console.time("drilling down"),this.splitTile(vt.source,ct,Wt,An,Le,ze,Ke),tt>1&&console.timeEnd("drilling down"),this.tiles[st]?Cr(this.tiles[st],it):null):null},function(Le,ze){return new cr(Le,ze)}}();var fr=d.dK(Cc.exports);function yu(Ue,te){const le=Ue.tileID.canonical;if(!this._geoJSONIndex)return te(null,null);const _e=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!_e)return te(null,null);const Fe=new class{constructor(Ue){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.V,this.length=Ue.length,this._features=Ue}feature(Ue){return new class{constructor(Ue){this._feature=Ue,this.extent=d.V,this.type=Ue.type,this.properties=Ue.tags,"id"in Ue&&!isNaN(Ue.id)&&(this.id=parseInt(Ue.id,10))}loadGeometry(){if(1===this._feature.type){const Ue=[];for(const te of this._feature.geometry)Ue.push([new d.P(te[0],te[1])]);return Ue}{const Ue=[];for(const te of this._feature.geometry){const le=[];for(const _e of te)le.push(new d.P(_e[0],_e[1]));Ue.push(le)}return Ue}}toGeoJSON(Ue,te,le){return Ka.call(this,Ue,te,le)}}(this._features[Ue])}}(_e.features);let $e=Ti(Fe);0===$e.byteOffset&&$e.byteLength===$e.buffer.byteLength||($e=new Uint8Array($e)),te(null,{vectorTile:Fe,rawData:$e.buffer})}class vu extends Al{constructor(te,le,_e,Fe,$e,Xe){super(te,le,_e,Fe,yu,Xe),$e&&(this.loadGeoJSON=$e)}loadData(te,le){const _e=te&&te.request,Fe=_e&&_e.collectResourceTiming;this.loadGeoJSON(te,($e,Xe)=>{if($e||!Xe)return le($e);if("object"!=typeof Xe)return le(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{ws(Xe,!0);try{if(te.filter){const Ne=d.r(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ne.result)throw new Error(Ne.value.map(Et=>`${Et.key}: ${Et.message}`).join(", "));Xe={type:"FeatureCollection",features:Xe.features.filter(Et=>Ne.value.evaluate({zoom:0},Et))}}this._geoJSONIndex=te.cluster?new Ec(function({superclusterOptions:Ne,clusterProperties:Rt}){if(!Rt||!Ne)return Ne;const Et={},kt={},pn={accumulated:null,zoom:0},di={properties:null},Pi=Object.keys(Rt);for(const fi of Pi){const[Qn,Wn]=Rt[fi],ai=d.r(Wn),Si=d.r("string"==typeof Qn?[Qn,["accumulated"],["get",fi]]:Qn);Et[fi]=ai.value,kt[fi]=Si.value}return Ne.map=fi=>{di.properties=fi;const Qn={};for(const Wn of Pi)Qn[Wn]=Et[Wn].evaluate(pn,di);return Qn},Ne.reduce=(fi,Qn)=>{di.properties=Qn;for(const Wn of Pi)pn.accumulated=fi[Wn],fi[Wn]=kt[Wn].evaluate(pn,di)},Ne}(te)).load(Xe.features):fr(Xe,te.geojsonVtOptions)}catch(Ne){return le(Ne)}this.loaded={};const wt={};if(Fe){const Ne=Zt(_e);Ne&&(wt.resourceTiming={},wt.resourceTiming[te.source]=JSON.parse(JSON.stringify(Ne)))}le(null,wt)}})}reloadTile(te,le){const _e=this.loaded;return _e&&_e[te.uid]?super.reloadTile(te,le):this.loadTile(te,le)}loadGeoJSON(te,le){if(te.request)d.g(te.request,le);else{if("string"!=typeof te.data)return le(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));try{return le(null,JSON.parse(te.data))}catch{return le(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(te,le){try{le(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(_e){le(_e)}}getClusterChildren(te,le){try{le(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(_e){le(_e)}}getClusterLeaves(te,le){try{le(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(_e){le(_e)}}}class ss{constructor(te,le){this.tileID=new d.am(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=le}parse(te,le,_e,Fe){this.status="parsing";const $e=new d.am(_e.tileID.overscaledZ,_e.tileID.wrap,_e.tileID.canonical.z,_e.tileID.canonical.x,_e.tileID.canonical.y),Xe={},wt=le.familiesBySource[_e.source],Ne=new d.dC($e,_e.promoteId);return Ne.bucketLayerIDs=[],Ne.is3DTile=!0,d.dP(te).then(Rt=>{if(!Rt)return Fe(new Error("Could not parse tile"));const Et=d.dQ(Rt,1/d.bR(_e.tileID.canonical)),kt=Rt.json.extensionsUsed&&Rt.json.extensionsUsed.includes("MAPBOX_mesh_features")||Rt.json.asset.extras&&Rt.json.asset.extras.MAPBOX_mesh_features,pn=Rt.json.extensionsUsed&&Rt.json.extensionsUsed.includes("EXT_meshopt_compression"),di=new d.K(this.zoom,{brightness:this.brightness});for(const Pi in wt)for(const fi of wt[Pi]){const Qn=fi[0];Ne.bucketLayerIDs.push(fi.map(ai=>ai.id)),Qn.recalculate(di,[]);const Wn=new d.dR(Et,$e,kt,pn,this.brightness,Ne);kt||(Wn.needsUpload=!0),Xe[Qn.fqid]=Wn,Wn.evaluate(Qn)}this.status="done",Fe(null,{buckets:Xe,featureIndex:Ne})}).catch(Rt=>Fe(new Error(Rt.message)))}}class Ks{constructor(te,le,_e,Fe,$e,Xe){this.actor=te,this.layerIndex=le,this.brightness=Xe,this.loading={},this.loaded={}}loadTile(te,le){const _e=te.uid,Fe=this.loading[_e]=new ss(te,this.brightness);d.a_(te.request,($e,Xe)=>{const wt=!this.loading[_e];return delete this.loading[_e],wt||$e?(Fe.status="done",wt||(this.loaded[_e]=Fe),le($e)):Xe&&0!==Xe.byteLength?void Fe.parse(Xe,this.layerIndex,te,(Ne,Rt)=>{Fe.status="done",this.loaded=this.loaded||{},this.loaded[_e]=Fe,Ne||!Rt?le(Ne):le(null,Rt)}):(Fe.status="done",this.loaded[_e]=Fe,le())})}reloadTile(te,le){const _e=this.loaded,Fe=te.uid;if(_e&&_e[Fe]){const $e=_e[Fe];$e.projection=te.projection,$e.brightness=te.brightness;const Xe=(wt,Ne)=>{$e.reloadCallback&&(delete $e.reloadCallback,this.loadTile(te,le)),le(wt,Ne)};"parsing"===$e.status?$e.reloadCallback=Xe:"done"===$e.status&&this.loadTile(te,le)}}abortTile(te,le){const _e=te.uid;this.loading[_e]&&delete this.loading[_e],le()}removeTile(te,le){const _e=this.loaded,Fe=te.uid;_e&&_e[Fe]&&delete _e[Fe],le()}}class Qa{constructor(te){this.self=te,this.actor=new d.dS(te,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.bo({name:"mercator"}),this.workerSourceTypes={vector:Al,geojson:vu,"batched-model":Ks},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(le,_e)=>{if(this.workerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.workerSourceTypes[le]=_e},this.self.registerRTLTextPlugin=le=>{if(d.dT.isParsed())throw new Error("RTL text plugin already registered.");d.dT.applyArabicShaping=le.applyArabicShaping,d.dT.processBidirectionalText=le.processBidirectionalText,d.dT.processStyledBidirectionalText=le.processStyledBidirectionalText}}clearCaches(te,le,_e){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te],delete this.rasterArrayWorkerSource,_e()}checkIfReady(te,le,_e){_e()}setReferrer(te,le){this.referrer=le}spriteLoaded(te,{scope:le,isLoaded:_e}){if(this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),this.isSpriteLoaded[te][le]=_e,this.workerSources[te]&&this.workerSources[te][le])for(const Fe in this.workerSources[te][le]){const $e=this.workerSources[te][le][Fe];for(const Xe in $e)$e[Xe]instanceof Al&&($e[Xe].isSpriteLoaded=_e,$e[Xe].fire(new d.b("isSpriteLoaded")))}}setImages(te,{scope:le,images:_e},Fe){if(this.availableImages[te]||(this.availableImages[te]={}),this.availableImages[te][le]=_e,this.workerSources[te]&&this.workerSources[te][le]){for(const $e in this.workerSources[te][le]){const Xe=this.workerSources[te][le][$e];for(const wt in Xe)Xe[wt].availableImages=_e}Fe()}else Fe()}setProjection(te,le){this.projections[te]=d.bo(le)}setBrightness(te,le,_e){this.brightness=le,_e()}setLayers(te,le,_e){this.getLayerIndex(te,le.scope).replace(le.layers,le.options),_e()}updateLayers(te,le,_e){this.getLayerIndex(te,le.scope).update(le.layers,le.removedIds,le.options),_e()}loadTile(te,le,_e){le.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,le.type,le.source,le.scope).loadTile(le,_e)}loadDEMTile(te,le,_e){this.getDEMWorkerSource(te,le.source,le.scope).loadTile(le,_e)}decodeRasterArray(te,le,_e){this.getRasterArrayWorkerSource().decodeRasterArray(le,_e)}reloadTile(te,le,_e){le.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,le.type,le.source,le.scope).reloadTile(le,_e)}abortTile(te,le,_e){this.getWorkerSource(te,le.type,le.source,le.scope).abortTile(le,_e)}removeTile(te,le,_e){this.getWorkerSource(te,le.type,le.source,le.scope).removeTile(le,_e)}removeSource(te,le,_e){if(!(this.workerSources[te]&&this.workerSources[te][le.scope]&&this.workerSources[te][le.scope][le.type]&&this.workerSources[te][le.scope][le.type][le.source]))return;const Fe=this.workerSources[te][le.scope][le.type][le.source];delete this.workerSources[te][le.scope][le.type][le.source],void 0!==Fe.removeSource?Fe.removeSource(le,_e):_e()}loadWorkerSource(te,le,_e){try{this.self.importScripts(le.url),_e()}catch(Fe){_e(Fe.toString())}}syncRTLPluginState(te,le,_e){try{d.dT.setState(le);const Fe=d.dT.getPluginURL();if(d.dT.isLoaded()&&!d.dT.isParsed()&&null!=Fe){this.self.importScripts(Fe);const $e=d.dT.isParsed();_e($e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Fe}`),$e)}}catch(Fe){_e(Fe.toString())}}setDracoUrl(te,le){this.dracoUrl=le}getAvailableImages(te,le){this.availableImages[te]||(this.availableImages[te]={});let _e=this.availableImages[te][le];return _e||(_e=[]),_e}getLayerIndex(te,le){this.layerIndexes[te]||(this.layerIndexes[te]={});let _e=this.layerIndexes[te][le];return _e||(_e=this.layerIndexes[te][le]=new Ea,_e.scope=le),_e}getWorkerSource(te,le,_e,Fe){return this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][Fe]||(this.workerSources[te][Fe]={}),this.workerSources[te][Fe][le]||(this.workerSources[te][Fe][le]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),this.workerSources[te][Fe][le][_e]||(this.workerSources[te][Fe][le][_e]=new this.workerSourceTypes[le]({send:(Xe,wt,Ne,Rt,Et,kt)=>{this.actor.send(Xe,wt,Ne,te,Et,kt)},scheduler:this.actor.scheduler},this.getLayerIndex(te,Fe),this.getAvailableImages(te,Fe),this.isSpriteLoaded[te][Fe],void 0,this.brightness)),this.workerSources[te][Fe][le][_e]}getDEMWorkerSource(te,le,_e){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][_e]||(this.demWorkerSources[te][_e]={}),this.demWorkerSources[te][_e][le]||(this.demWorkerSources[te][_e][le]=new Gh),this.demWorkerSources[te][_e][le]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new $o),this.rasterArrayWorkerSource}enforceCacheSizeLimit(te,le){d.dU(le)}getWorkerPerformanceMetrics(te,le,_e){_e(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Qa(self)),Qa}),Df(0,function(d){function Zt(p,s){if(Array.isArray(p)){if(!Array.isArray(s)||p.length!==s.length)return!1;for(let c=0;c<p.length;c++)if(!Zt(p[c],s[c]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==s){if("object"!=typeof s||Object.keys(p).length!==Object.keys(s).length)return!1;for(const c in p)if(!Zt(p[c],s[c]))return!1;return!0}return p===s}var is=fn;function fn(p){return s=p,!(typeof window>"u"||typeof document>"u"||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,x=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(x);try{y=new Worker(C),m=!0}catch{m=!1}return y&&y.terminate(),URL.revokeObjectURL(C),m}()||!function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var x=y.getImageData(0,0,1,1);return x&&x.width===m.width}()||(void 0===Ea[c=s&&s.failIfMajorPerformanceCaveat]&&(Ea[c]=function(m){var y,C,T,S,x=(C=m,T=document.createElement("canvas"),(S=Object.create(fn.webGLContextAttributes)).failIfMajorPerformanceCaveat=C,T.getContext("webgl2",S));if(!x)return!1;try{y=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!y||x.isContextLost())&&(x.shaderSource(y,"void main() {}"),x.compileShader(y),!0===x.getShaderParameter(y,x.COMPILE_STATUS))}(c)),!Ea[c]||document.documentMode));var s,c}var Ea={};function bn(p,s,c){const m=document.createElement(p);return null!=s&&(m.className=s),c&&c.appendChild(m),m}function ao(p,s,c){const m=document.createElementNS("http://www.w3.org/2000/svg",p);for(const y of Object.keys(s))m.setAttributeNS(null,y,String(s[y]));return c&&c.appendChild(m),m}fn.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const bs=typeof document<"u"?document.documentElement&&document.documentElement.style:null,rs=bs&&void 0!==bs.userSelect?"userSelect":"WebkitUserSelect";let Al;function Gh(){bs&&rs&&(Al=bs[rs],bs[rs]="none")}function $o(){bs&&rs&&(bs[rs]=Al)}function Xa(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",Xa,!0)}function Go(){window.addEventListener("click",Xa,!0),window.setTimeout(()=>{window.removeEventListener("click",Xa,!0)},0)}function ws(p,s){const c=p.getBoundingClientRect();return ht(p,c,s)}function Ka(p,s){const c=p.getBoundingClientRect(),m=[];for(let y=0;y<s.length;y++)m.push(ht(p,c,s[y]));return m}function Es(p){return void 0!==window.InstallTrigger&&2===p.button&&p.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function ht(p,s,c){const m=p.offsetWidth===s.width?1:p.offsetWidth/s.width;return new d.P((c.clientX-s.left)*m,(c.clientY-s.top)*m)}class Ca{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,c){this._updatedSourceCaches[s]=c,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){const c=s.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(s.id),this.setDirty()}removeLayer(s){const c=s.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][s.id]=s,this._updatedLayers[c].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){const s={};for(const c in this._updatedLayers)s[c]=s[c]||{},s[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)s[c]=s[c]||{},s[c].removedIds=Object.keys(this._removedLayers[c]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(s){this._updatedImages.add(s),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class gu extends d.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.numModelsLoading={}}loadModel(s,c){return d.l(this.requestManager.transformRequest(c,d.R.Model).url).then(m=>{if(!m)return;const y=d.c(m),x=new d.M(s,void 0,void 0,y);return x.computeBoundsAndApplyParent(),x}).catch(m=>{this.fire(new d.a(new Error(`Could not load model ${s} from ${c}: ${m.message}`)))})}load(s,c){this.models[c]||(this.models[c]={});const m=Object.keys(s);this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+m.length;const y=[];for(const x of m)y.push(this.loadModel(x,s[x]));Promise.allSettled(y).then(x=>{for(let C=0;C<x.length;C++){const{status:T,value:S}=x[C];"fulfilled"===T&&S&&(this.models[c][m[C]]=S)}this.numModelsLoading[c]-=m.length,this.fire(new d.b("data",{dataType:"style"}))}).catch(x=>{this.fire(new d.a(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(const s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,c){return!!this.getModel(s,c)}getModel(s,c){return this.models[c]||(this.models[c]={}),this.models[c][s]}addModel(s,c,m){this.models[m]||(this.models[m]={}),this.hasModel(s,m)&&this.removeModel(s,m),this.load({[s]:this.requestManager.normalizeModelURL(c)},m)}addModels(s,c){const m={};for(const y in s)m[y]=this.requestManager.normalizeModelURL(s[y]);this.load(m,c)}removeModel(s,c){this.models[c]||(this.models[c]={});const m=this.models[c][s];delete this.models[c][s],m.destroy()}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,c){this.models[c]||(this.models[c]={});for(const m in this.models[c])this.models[c][m].upload(s.context)}}class Cn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,c,m){const y=String(c);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][y]=this.stateChanges[s][y]||{},d.e(this.stateChanges[s][y],m),null===this.deletedStates[s]){this.deletedStates[s]={};for(const x in this.state[s])x!==y&&(this.deletedStates[s][x]=null)}else if(this.deletedStates[s]&&null===this.deletedStates[s][y]){this.deletedStates[s][y]={};for(const x in this.state[s][y])m[x]||(this.deletedStates[s][y][x]=null)}else for(const x in m)this.deletedStates[s]&&this.deletedStates[s][y]&&null===this.deletedStates[s][y][x]&&delete this.deletedStates[s][y][x]}removeFeatureState(s,c,m){if(null===this.deletedStates[s])return;const y=String(c);if(this.deletedStates[s]=this.deletedStates[s]||{},m&&void 0!==c)null!==this.deletedStates[s][y]&&(this.deletedStates[s][y]=this.deletedStates[s][y]||{},this.deletedStates[s][y][m]=null);else if(void 0!==c)if(this.stateChanges[s]&&this.stateChanges[s][y])for(m in this.deletedStates[s][y]={},this.stateChanges[s][y])this.deletedStates[s][y][m]=null;else this.deletedStates[s][y]=null;else this.deletedStates[s]=null}getState(s,c){const m=String(c),y=d.e({},(this.state[s]||{})[m],(this.stateChanges[s]||{})[m]);if(null===this.deletedStates[s])return{};if(this.deletedStates[s]){const x=this.deletedStates[s][c];if(null===x)return{};for(const C in x)delete y[C]}return y}initializeTileState(s,c){s.setFeatureState(this.state,c)}coalesceChanges(s,c){const m={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const x={};for(const C in this.stateChanges[y])this.state[y][C]||(this.state[y][C]={}),d.e(this.state[y][C],this.stateChanges[y][C]),x[C]=this.state[y][C];m[y]=x}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const x={};if(null===this.deletedStates[y])for(const C in this.state[y])x[C]={},this.state[y][C]={};else for(const C in this.deletedStates[y]){if(null===this.deletedStates[y][C])this.state[y][C]={};else if(this.state[y][C])for(const T of Object.keys(this.deletedStates[y][C]))delete this.state[y][C][T];x[C]=this.state[y][C]}m[y]=m[y]||{},d.e(m[y],x)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(m).length)for(const y in s)s[y].setFeatureState(m,c)}}function Er(p){const{userImage:s}=p;return!!(s&&s.render&&s.render())&&(p.data.replace(new Uint8Array(s.data.buffer)),!0)}class Hh extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(s){this.images[s]={},this.loaded[s]=!1,this.updatedImages[s]={},this.patterns[s]={},this.callbackDispatchedThisFrame[s]={},this.atlasImage[s]=new d.h({width:1,height:1})}isLoaded(){for(const s in this.loaded)if(!this.loaded[s])return!1;return!0}setLoaded(s,c){if(this.loaded[c]!==s&&(this.loaded[c]=s,s)){for(const{ids:m,callback:y}of this.requestors)this._notify(m,c,y);this.requestors=[]}}hasImage(s,c){return!!this.getImage(s,c)}getImage(s,c){return this.images[c][s]}addImage(s,c,m){this._validate(s,m)&&(this.images[c][s]=m)}_validate(s,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new d.a(new Error(`Image "${s}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new d.a(new Error(`Image "${s}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new d.a(new Error(`Image "${s}" has invalid "content" value`))),m=!1),m}_validateStretch(s,c){if(!s)return!0;let m=0;for(const y of s){if(y[0]<m||y[1]<y[0]||c<y[1])return!1;m=y[1]}return!0}_validateContent(s,c){return!(s&&(4!==s.length||s[0]<0||c.data.width<s[0]||s[1]<0||c.data.height<s[1]||s[2]<0||c.data.width<s[2]||s[3]<0||c.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,c,m){m.version=this.images[c][s].version+1,this.images[c][s]=m,this.updatedImages[c][s]=!0}removeImage(s,c){const m=this.images[c][s];delete this.images[c][s],delete this.patterns[c][s],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(s){return Object.keys(this.images[s])}getImages(s,c,m){let y=!0;const x=!!this.loaded[c];if(!x)for(const C of s)this.images[c][C]||(y=!1);x||y?this._notify(s,c,m):this.requestors.push({ids:s,scope:c,callback:m})}getUpdatedImages(s){return this.updatedImages[s]}_notify(s,c,m){const y={};for(const x of s){this.images[c][x]||this.fire(new d.b("styleimagemissing",{id:x}));const C=this.images[c][x];C?y[x]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!(!C.userImage||!C.userImage.render)}:d.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}m(null,y)}getPixelSize(s){const{width:c,height:m}=this.atlasImage[s];return{width:c,height:m}}getPattern(s,c){const m=this.patterns[c][s],y=this.getImage(s,c);if(!y)return null;if(m&&m.position.version===y.version)return m.position;if(m)m.position.version=y.version;else{const x={w:y.data.width+2,h:y.data.height+2,x:0,y:0},C=new d.I(x,y);this.patterns[c][s]={bin:x,position:C}}return this._updatePatternAtlas(c),this.patterns[c][s].position}bind(s,c){const m=s.gl;let y=this.atlasTexture[c];y?this.dirty&&(y.update(this.atlasImage[c]),this.dirty=!1):(y=new d.T(s,this.atlasImage[c],m.RGBA),this.atlasTexture[c]=y),y.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(s){const c=[];for(const C in this.patterns[s])c.push(this.patterns[s][C].bin);const{w:m,h:y}=d.p(c),x=this.atlasImage[s];x.resize({width:m||1,height:y||1});for(const C in this.patterns[s]){const{bin:T}=this.patterns[s][C],S=T.x+1,O=T.y+1,k=this.images[s][C].data,F=k.width,V=k.height;d.h.copy(k,x,{x:0,y:0},{x:S,y:O},{width:F,height:V}),d.h.copy(k,x,{x:0,y:V-1},{x:S,y:O-1},{width:F,height:1}),d.h.copy(k,x,{x:0,y:0},{x:S,y:O+V},{width:F,height:1}),d.h.copy(k,x,{x:F-1,y:0},{x:S-1,y:O},{width:1,height:V}),d.h.copy(k,x,{x:0,y:0},{x:S+F,y:O},{width:1,height:V})}this.dirty=!0}beginFrame(){for(const s in this.images)this.callbackDispatchedThisFrame[s]={}}dispatchRenderCallbacks(s,c){for(const m of s){if(this.callbackDispatchedThisFrame[c][m])continue;this.callbackDispatchedThisFrame[c][m]=!0;const y=this.images[c][m];Er(y)&&this.updateImage(m,c,y)}}}class _t{constructor(s,c,m,y){this.message=(s?`${s}: `:"")+m,y&&(this.identifier=y),null!=c&&c.__line__&&(this.line=c.__line__)}}class Cs extends _t{}function qr(p){const s=p.key,c=p.value,m=p.valueSpec||{},y=p.objectElementValidators||{},x=p.style,C=p.styleSpec;let T=[];const S=d.i(c);if("object"!==S)return[new _t(s,c,`object expected, ${S} found`)];for(const O in c){const k=O.split(".")[0];let F;y[k]?F=y[k]:m[k]?F=fr:y["*"]?F=y["*"]:m["*"]&&(F=fr),F?T=T.concat(F({key:(s&&`${s}.`)+O,value:c[O],valueSpec:m[k]||m["*"],style:x,styleSpec:C,object:c,objectKey:O},c)):T.push(new Cs(s,c[O],`unknown property "${O}"`))}for(const O in m)y[O]||m[O].required&&void 0===m[O].default&&void 0===c[O]&&T.push(new _t(s,c,`missing required property "${O}"`));return T}function on(p){const s=p.value,c=p.valueSpec,m=p.style,y=p.styleSpec,x=p.key,C=p.arrayElementValidator||fr;if("array"!==d.i(s))return[new _t(x,s,`array expected, ${d.i(s)} found`)];if(c.length&&s.length!==c.length)return[new _t(x,s,`array length ${c.length} expected, length ${s.length} found`)];if(c["min-length"]&&s.length<c["min-length"])return[new _t(x,s,`array length at least ${c["min-length"]} expected, length ${s.length} found`)];let T={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};y.$version<7&&(T.function=c.function),"object"===d.i(c.value)&&(T=c.value);let S=[];for(let O=0;O<s.length;O++)S=S.concat(C({array:s,arrayIndex:O,value:s[O],valueSpec:T,style:m,styleSpec:y,key:`${x}[${O}]`},!0));return S}function xc(p){const s=p.key,c=p.value,m=p.valueSpec;let y=d.i(c);if("number"===y&&c!=c&&(y="NaN"),"number"!==y)return[new _t(s,c,`number expected, ${y} found`)];if("minimum"in m){let x=m.minimum;if("array"===d.i(m.minimum)&&(x=m.minimum[p.arrayIndex]),c<x)return[new _t(s,c,`${c} is less than the minimum value ${x}`)]}if("maximum"in m){let x=m.maximum;if("array"===d.i(m.maximum)&&(x=m.maximum[p.arrayIndex]),c>x)return[new _t(s,c,`${c} is greater than the maximum value ${x}`)]}return[]}function Da(p){const s=p.valueSpec,c=d.u(p.value.type);let m,y,x,C={};const T="categorical"!==c&&void 0===p.value.property,S=!T,O="array"===d.i(p.value.stops)&&"array"===d.i(p.value.stops[0])&&"object"===d.i(p.value.stops[0][0]),k=qr({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(j){if("identity"===c)return[new _t(j.key,j.value,'identity function may not have a "stops" property')];let q=[];const W=j.value;return q=q.concat(on({key:j.key,value:W,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:F})),"array"===d.i(W)&&0===W.length&&q.push(new _t(j.key,W,"array must have at least one stop")),q},default:function(j){return fr({key:j.key,value:j.value,valueSpec:s,style:j.style,styleSpec:j.styleSpec})}}});return"identity"===c&&T&&k.push(new _t(p.key,p.value,'missing required property "property"')),"identity"===c||p.value.stops||k.push(new _t(p.key,p.value,'missing required property "stops"')),"exponential"===c&&p.valueSpec.expression&&!d.s(p.valueSpec)&&k.push(new _t(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(S&&!d.k(p.valueSpec)?k.push(new _t(p.key,p.value,"property functions not supported")):T&&!d.m(p.valueSpec)&&k.push(new _t(p.key,p.value,"zoom functions not supported"))),"categorical"!==c&&!O||void 0!==p.value.property||k.push(new _t(p.key,p.value,'"property" property is required')),k;function F(j){let q=[];const W=j.value,Y=j.key;if("array"!==d.i(W))return[new _t(Y,W,`array expected, ${d.i(W)} found`)];if(2!==W.length)return[new _t(Y,W,`array length 2 expected, length ${W.length} found`)];if(O){if("object"!==d.i(W[0]))return[new _t(Y,W,`object expected, ${d.i(W[0])} found`)];if(void 0===W[0].zoom)return[new _t(Y,W,"object stop key must have zoom")];if(void 0===W[0].value)return[new _t(Y,W,"object stop key must have value")];const G=d.u(W[0].zoom);if("number"!=typeof G)return[new _t(Y,W[0].zoom,"stop zoom values must be numbers")];if(x&&x>G)return[new _t(Y,W[0].zoom,"stop zoom values must appear in ascending order")];G!==x&&(x=G,y=void 0,C={}),q=q.concat(qr({key:`${Y}[0]`,value:W[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:xc,value:V}}))}else q=q.concat(V({key:`${Y}[0]`,value:W[0],valueSpec:{},style:j.style,styleSpec:j.styleSpec},W));return d.n(d.o(W[1]))?q.concat([new _t(`${Y}[1]`,W[1],"expressions are not allowed in function stops.")]):q.concat(fr({key:`${Y}[1]`,value:W[1],valueSpec:s,style:j.style,styleSpec:j.styleSpec}))}function V(j,q){const W=d.i(j.value),Y=d.u(j.value),G=null!==j.value?j.value:q;if(m){if(W!==m)return[new _t(j.key,G,`${W} stop domain type must match previous stop domain type ${m}`)]}else m=W;if("number"!==W&&"string"!==W&&"boolean"!==W&&"number"!=typeof Y&&"string"!=typeof Y&&"boolean"!=typeof Y)return[new _t(j.key,G,"stop domain value must be a number, string, or boolean")];if("number"!==W&&"categorical"!==c){let J=`number expected, ${W} found`;return d.k(s)&&void 0===c&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _t(j.key,G,J)]}return"categorical"!==c||"number"!==W||"number"==typeof Y&&isFinite(Y)&&Math.floor(Y)===Y?"categorical"!==c&&"number"===W&&"number"==typeof Y&&"number"==typeof y&&void 0!==y&&Y<y?[new _t(j.key,G,"stop domain values must appear in ascending order")]:(y=Y,"categorical"===c&&Y in C?[new _t(j.key,G,"stop domain values must be unique")]:(C[Y]=!0,[])):[new _t(j.key,G,`integer expected, found ${String(Y)}`)]}}function Di(p){const s=("property"===p.expressionContext?d.q:d.r)(d.o(p.value),p.valueSpec);if("error"===s.result)return s.value.map(m=>new _t(`${p.key}${m.key}`,p.value,m.message));const c=s.value.expression||s.value._styleExpression.expression;if("property"===p.expressionContext&&"text-font"===p.propertyKey&&!c.outputDefined())return[new _t(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===p.expressionContext&&"layout"===p.propertyType&&!d.t(c))return[new _t(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===p.expressionContext)return Vr(c,p);if(p.expressionContext&&0===p.expressionContext.indexOf("cluster")){if(!d.v(c,["zoom","feature-state"]))return[new _t(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===p.expressionContext&&!d.x(c))return[new _t(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vr(p,s){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(const y of s.valueSpec.expression.parameters)c.delete(y);if(0===c.size)return[];const m=[];return p instanceof d.C&&c.has(p.name)?[new _t(s.key,s.value,`["${p.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(p.eachChild(y=>{m.push(...Vr(y,s))}),m)}function Rl(p){const s=p.key,c=p.value,m=p.valueSpec,y=[];return Array.isArray(m.values)?-1===m.values.indexOf(d.u(c))&&y.push(new _t(s,c,`expected one of [${m.values.join(", ")}], ${JSON.stringify(c)} found`)):-1===Object.keys(m.values).indexOf(d.u(c))&&y.push(new _t(s,c,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(c)} found`)),y}function bc(p){return d.z(d.o(p.value))?Di(d.j({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):_u(p)}function _u(p){const s=p.value,c=p.key;if("array"!==d.i(s))return[new _t(c,s,`array expected, ${d.i(s)} found`)];const m=p.styleSpec;let y,x=[];if(s.length<1)return[new _t(c,s,"filter array must have at least 1 element")];switch(x=x.concat(Rl({key:`${c}[0]`,value:s[0],valueSpec:m.filter_operator,style:p.style,styleSpec:p.styleSpec})),d.u(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&"$type"===d.u(s[1])&&x.push(new _t(c,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":3!==s.length&&x.push(new _t(c,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(y=d.i(s[1]),"string"!==y&&x.push(new _t(`${c}[1]`,s[1],`string expected, ${y} found`)));for(let C=2;C<s.length;C++)y=d.i(s[C]),"$type"===d.u(s[1])?x=x.concat(Rl({key:`${c}[${C}]`,value:s[C],valueSpec:m.geometry_type,style:p.style,styleSpec:p.styleSpec})):"string"!==y&&"number"!==y&&"boolean"!==y&&x.push(new _t(`${c}[${C}]`,s[C],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let C=1;C<s.length;C++)x=x.concat(_u({key:`${c}[${C}]`,value:s[C],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":y=d.i(s[1]),2!==s.length?x.push(new _t(c,s,`filter array for "${s[0]}" operator must have 2 elements`)):"string"!==y&&x.push(new _t(`${c}[1]`,s[1],`string expected, ${y} found`))}return x}function Ti(p,s){const c=p.key,m=p.style,y=p.layer,x=p.styleSpec,C=p.value,T=p.objectKey,S=x[`${s}_${p.layerType}`];if(!S)return[];const O=T.match(/^(.*)-transition$/);if("paint"===s&&O&&S[O[1]]&&S[O[1]].transition)return fr({key:c,value:C,valueSpec:x.transition,style:m,styleSpec:x});const k=p.valueSpec||S[T];if(!k)return[new Cs(c,C,`unknown property "${T}"`)];let F;if("string"===d.i(C)&&d.k(k)&&!k.tokens&&(F=/^{([^}]+)}$/.exec(C))){const j=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new _t(c,C,`"${T}" does not support interpolation syntax\nUse an identity property function instead: ${j}.`)]}const V=[];if("symbol"===p.layerType)"text-field"!==T||!m||m.glyphs||m.imports||V.push(new _t(c,C,'use of "text-field" requires a style "glyphs" property')),"text-font"===T&&d.A(d.o(C))&&"identity"===d.u(C.type)&&V.push(new _t(c,C,'"text-font" does not support identity functions'));else if("model"===p.layerType&&"paint"===s&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&d.k(k)&&(d.B(k)||d.m(k))){const j=d.q(d.o(C),k),q=j.value.expression||j.value._styleExpression.expression;q&&!d.v(q,["measure-light"])&&("model-emissive-strength"===T&&d.x(q)&&d.t(q)||V.push(new _t(c,C,`${T} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return V.concat(fr({key:p.key,value:C,valueSpec:k,style:m,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:T}))}function wc(p){return Ti(p,"paint")}function Ja(p){return Ti(p,"layout")}function Fi(p){let s=[];const c=p.value,m=p.key,y=p.style,x=p.styleSpec;c.type||c.ref||s.push(new _t(m,c,'either "type" or "ref" is required'));let C=d.u(c.type);const T=d.u(c.ref);if(c.id){const S=d.u(c.id);for(let O=0;O<p.arrayIndex;O++){const k=y.layers[O];d.u(k.id)===S&&s.push(new _t(m,c.id,`duplicate layer id "${c.id}", previously used at line ${k.id.__line__}`))}}if("ref"in c){let S;["type","source","source-layer","filter","layout"].forEach(O=>{O in c&&s.push(new _t(m,c[O],`"${O}" is prohibited for ref layers`))}),y.layers.forEach(O=>{d.u(O.id)===T&&(S=O)}),S?S.ref?s.push(new _t(m,c.ref,"ref cannot reference another ref layer")):C=d.u(S.type):"string"==typeof T&&s.push(new _t(m,c.ref,`ref layer "${T}" not found`))}else if("background"!==C&&"sky"!==C&&"slot"!==C)if(c.source){const S=y.sources&&y.sources[c.source],O=S&&d.u(S.type);S?"vector"===O&&"raster"===C?s.push(new _t(m,c.source,`layer "${c.id}" requires a raster source`)):"raster"===O&&"raster"!==C?s.push(new _t(m,c.source,`layer "${c.id}" requires a vector source`)):"vector"!==O||c["source-layer"]?"raster-dem"===O&&"hillshade"!==C?s.push(new _t(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==O||["raster","raster-particle"].includes(C)?"line"!==C||!c.paint||!c.paint["line-gradient"]&&!c.paint["line-trim-offset"]||"geojson"===O&&S.lineMetrics?"raster-particle"===C&&"raster-array"!==O&&s.push(new _t(m,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):s.push(new _t(m,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new _t(m,c.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new _t(m,c,`layer "${c.id}" must specify a "source-layer"`)):s.push(new _t(m,c.source,`source "${c.source}" not found`))}else s.push(new _t(m,c,'missing required property "source"'));return s=s.concat(qr({key:m,value:c,valueSpec:x.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>fr({key:`${m}.type`,value:c.type,valueSpec:x.layer.type,style:p.style,styleSpec:p.styleSpec,object:c,objectKey:"type"}),filter:S=>bc(d.j({layerType:C},S)),layout:S=>qr({layer:c,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":O=>Ja(d.j({layerType:C},O))}}),paint:S=>qr({layer:c,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":O=>wc(d.j({layerType:C,layer:c},O))}})}})),s}function si(p){const s=p.value,c=p.key,m=d.i(s);return"string"!==m?[new _t(c,s,`string expected, ${m} found`)]:[]}const os={promoteId:function({key:p,value:s}){if("string"===d.i(s))return si({key:p,value:s});{const c=[];for(const m in s)c.push(...si({key:`${p}.${m}`,value:s[m]}));return c}}};function ti(p){const s=p.value,c=p.key,m=p.styleSpec,y=p.style;if(!s.type)return[new _t(c,s,'"type" is required')];const x=d.u(s.type);let C=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(s.url||s.tiles||C.push(new Cs(c,s,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return C=C.concat(qr({key:c,value:s,valueSpec:m[`source_${x.replace("-","_")}`],style:p.style,styleSpec:m,objectElementValidators:os})),C;case"geojson":if(C=qr({key:c,value:s,valueSpec:m.source_geojson,style:y,styleSpec:m,objectElementValidators:os}),s.cluster)for(const T in s.clusterProperties){const[S,O]=s.clusterProperties[T],k="string"==typeof S?[S,["accumulated"],["get",T]]:S;C.push(...Di({key:`${c}.${T}.map`,value:O,expressionContext:"cluster-map"})),C.push(...Di({key:`${c}.${T}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return C;case"video":return qr({key:c,value:s,valueSpec:m.source_video,style:y,styleSpec:m});case"image":return qr({key:c,value:s,valueSpec:m.source_image,style:y,styleSpec:m});case"canvas":return[new _t(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Rl({key:`${c}.type`,value:s.type,valueSpec:{values:Ec(m)},style:y,styleSpec:m})}}function Ec(p){return p.source.reduce((s,c)=>{const m=p[c];return"enum"===m.type.type&&(s=s.concat(Object.keys(m.type.values))),s},[])}function tr(p){const s=p.value;let c=[];if(!s)return c;const m=d.i(s);return"string"!==m?(c=c.concat([new _t(p.key,s,`string expected, "${m}" found`)]),c):(function(y){const x=-1===y.indexOf("://");try{return new URL(y,x?"http://example.com":void 0),!0}catch{return!1}}(s)||(c=c.concat([new _t(p.key,s,`invalid url "${s}"`)])),c)}function Io(p){const s=p.value,c=p.styleSpec,m=c.light,y=p.style;let x=[];const C=d.i(s);if(void 0===s)return x;if("object"!==C)return x=x.concat([new _t("light",s,`object expected, ${C} found`)]),x;for(const T in s){const S=T.match(/^(.*)-transition$/);x=x.concat(S&&m[S[1]]&&m[S[1]].transition?fr({key:T,value:s[T],valueSpec:c.transition,style:y,styleSpec:c}):m[T]?fr({key:T,value:s[T],valueSpec:m[T],style:y,styleSpec:c}):[new _t(T,s[T],`unknown property "${T}"`)])}return x}function Pl(p){const s=p.value;let c=[];if(!s)return c;const m=d.i(s);if("object"!==m)return c=c.concat([new _t("light-3d",s,`object expected, ${m} found`)]),c;const y=p.styleSpec,x=y["light-3d"],C=p.key,T=p.style,S=p.style.lights;for(const F of["type","id"])if(!(F in s))return c=c.concat([new _t("light-3d",s,`missing property ${F} on light`)]),c;if(s.type&&S)for(let F=0;F<p.arrayIndex;F++){const V=d.u(s.type),j=S[F];d.u(j.type)===V&&c.push(new _t(C,s.id,`duplicate light type "${s.type}", previously defined at line ${j.id.__line__}`))}const O=`properties_light_${s.type}`;if(!(O in y))return c=c.concat([new _t("light-3d",s,`Invalid light type ${s.type}`)]),c;const k=y[O];for(const F in s)if("properties"===F){const V=s[F],j=d.i(V);if("object"!==j)return c=c.concat([new _t("properties",V,`object expected, ${j} found`)]),c;for(const q in V)c=c.concat(k[q]?fr({key:q,value:V[q],valueSpec:k[q],style:T,styleSpec:y}):[new Cs(p.key,V[q],`unknown property "${q}"`)])}else{const V=F.match(/^(.*)-transition$/);c=c.concat(V&&x[V[1]]&&x[V[1]].transition?fr({key:F,value:s[F],valueSpec:y.transition,style:T,styleSpec:y}):x[F]?fr({key:F,value:s[F],valueSpec:x[F],style:T,styleSpec:y}):[new Cs(F,s[F],`unknown property "${F}"`)])}return c}function Ta(p){const s=p.value,c=p.key,m=p.style,y=p.styleSpec,x=y.terrain;let C=[];const T=d.i(s);if(void 0===s||"null"===T)return C;if("object"!==T)return C=C.concat([new _t("terrain",s,`object expected, ${T} found`)]),C;for(const S in s){const O=S.match(/^(.*)-transition$/);C=C.concat(O&&x[O[1]]&&x[O[1]].transition?fr({key:S,value:s[S],valueSpec:y.transition,style:m,styleSpec:y}):x[S]?fr({key:S,value:s[S],valueSpec:x[S],style:m,styleSpec:y}):[new Cs(S,s[S],`unknown property "${S}"`)])}if(s.source){const S=m.sources&&m.sources[s.source],O=S&&d.u(S.type);S?"raster-dem"!==O&&C.push(new _t(c,s.source,`terrain cannot be used with a source of type ${String(O)}, it only be used with a "raster-dem" source type`)):C.push(new _t(c,s.source,`source "${s.source}" not found`))}else C.push(new _t(c,s,'terrain is missing required property "source"'));return C}function Xs(p){const s=p.value,c=p.style,m=p.styleSpec,y=m.fog;let x=[];const C=d.i(s);if(void 0===s)return x;if("object"!==C)return x=x.concat([new _t("fog",s,`object expected, ${C} found`)]),x;for(const T in s){const S=T.match(/^(.*)-transition$/);x=x.concat(S&&y[S[1]]&&y[S[1]].transition?fr({key:T,value:s[T],valueSpec:m.transition,style:c,styleSpec:m}):y[T]?fr({key:T,value:s[T],valueSpec:y[T],style:c,styleSpec:m}):[new Cs(T,s[T],`unknown property "${T}"`)])}return x}const Cc={"*":()=>[],array:on,boolean:function(p){const s=p.value,c=p.key,m=d.i(s);return"boolean"!==m?[new _t(c,s,`boolean expected, ${m} found`)]:[]},number:xc,color:function(p){const s=p.key,c=p.value,m=d.i(c);return"string"!==m?[new _t(s,c,`color expected, ${m} found`)]:null===d.y(c)?[new _t(s,c,`color expected, "${c}" found`)]:[]},enum:Rl,filter:bc,function:Da,layer:Fi,object:qr,source:ti,model:tr,light:Io,"light-3d":Pl,terrain:Ta,fog:Xs,string:si,formatted:function(p){return 0===si(p).length?[]:Di(p)},resolvedImage:function(p){return 0===si(p).length?[]:Di(p)},projection:function(p){const s=p.value,c=p.styleSpec,m=c.projection,y=p.style;let x=[];const C=d.i(s);if("object"===C)for(const T in s)x=x.concat(fr({key:T,value:s[T],valueSpec:m[T],style:y,styleSpec:c}));else"string"!==C&&(x=x.concat([new _t("projection",s,`object or string expected, ${C} found`)]));return x},import:function(p){const{value:s,styleSpec:c}=p,{data:m,...y}=s;Object.defineProperty(y,"__line__",{value:s.__line__,enumerable:!1});let x=qr(d.j({},p,{value:y,valueSpec:c.import}));return""===d.u(y.id)&&x.push(new _t(`${p.key}.id`,y,"import id can't be an empty string")),m&&(x=x.concat(vu(m,c,{key:`${p.key}.data`}))),x}};function fr(p,s=!1){const c=p.value,m=p.valueSpec,y=p.styleSpec;if(m.expression&&d.A(d.u(c)))return Da(p);if(m.expression&&d.n(d.o(c)))return Di(p);if(m.type&&Cc[m.type]){const x=Cc[m.type](p);return!0===s&&x.length>0&&"array"===d.i(p.value)?Di(p):x}return qr(d.j({},p,{valueSpec:m.type?y[m.type]:m}))}function yu(p){const s=p.value,c=p.key,m=si(p);return m.length||(-1===s.indexOf("{fontstack}")&&m.push(new _t(c,s,'"glyphs" url must include a "{fontstack}" token')),-1===s.indexOf("{range}")&&m.push(new _t(c,s,'"glyphs" url must include a "{range}" token'))),m}function vu(p,s=d.D,c={}){return fr({key:c.key||"",value:p,valueSpec:s.$root,styleSpec:s,style:p,objectElementValidators:{glyphs:yu,"*":()=>[]}})}function ss(p,s=d.D){return Ne(vu(p,s))}const Ks=p=>Ne(ti(p)),Qa=p=>Ne(Io(p)),Ue=p=>Ne(Pl(p)),te=p=>Ne(Ta(p)),le=p=>Ne(Xs(p)),_e=p=>Ne(Fi(p)),Fe=p=>Ne(bc(p)),$e=p=>Ne(wc(p)),Xe=p=>Ne(Ja(p)),wt=p=>Ne(tr(p));function Ne(p){return p.slice().sort((s,c)=>s.line&&c.line?s.line-c.line:0)}function Rt(p,s){let c=!1;if(s&&s.length)for(const m of s)m instanceof Cs?d.w(m.message):(p.fire(new d.a(new Error(m.message))),c=!0);return c}const Et=new d.F({anchor:new d.G(d.D.light.anchor),position:new d.H(d.D.light.position),color:new d.G(d.D.light.color),intensity:new d.G(d.D.light.intensity)});class kt extends d.E{constructor(s,c="flat"){super(),this._transitionable=new d.J(Et),this.setLight(s,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,c,m={}){this._validate(Qa,s,m)||(this._transitionable.setTransitionOrValue(s),this.id=c)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,m){return(!m||!1!==m.validate)&&Rt(this,s.call(ss,d.e({value:c,style:{glyphs:!0,sprite:!0},styleSpec:d.D})))}}const pn=new d.F({source:new d.G(d.D.terrain.source),exaggeration:new d.G(d.D.terrain.exaggeration)});let di=class extends d.E{constructor(p,s,c,m){super(),this.scope=c,this._transitionable=new d.J(pn,c,m),this._transitionable.setTransitionOrValue(p,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(p,s){this._transitionable.setTransitionOrValue(p,s)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new d.K(p)).get("exaggeration")}isZoomDependent(){const p=this._transitionable._values.exaggeration;return null!=p&&null!=p.value&&null!=p.value.expression&&p.value.expression instanceof d.Z}};const Pi=45,fi=65,Qn=.05;function Wn(p,s,c,m){const y=d.O(Pi,fi,c),[x,C]=ai(p,m);let T=1-Math.min(1,Math.exp((s-x)/(C-x)*-6));return T*=T*T,T=Math.min(1,1.00747*T),T*y*p.alpha}function ai(p,s){const c=.5/Math.tan(.5*s);return[p.range[0]+c,p.range[1]+c]}function Si(p,s,c,m,y){const x=d.N.transformMat4([],[s,c,m],y.mercatorFogMatrix);return Wn(p,d.N.length(x),y.pitch,y._fov)}function Cr(p,s,c,m,y,x,C){const T=[[c,m,0],[y,m,0],[y,x,0],[c,x,0]];let S=Number.MAX_VALUE,O=-Number.MAX_VALUE;for(const k of T){const F=d.N.transformMat4([],k,s),V=d.N.length(F);S=Math.min(S,V),O=Math.max(O,V)}return[Wn(p,S,C.pitch,C._fov),Wn(p,O,C.pitch,C._fov)]}const Oi=new d.F({range:new d.G(d.D.fog.range),color:new d.G(d.D.fog.color),"high-color":new d.G(d.D.fog["high-color"]),"space-color":new d.G(d.D.fog["space-color"]),"horizon-blend":new d.G(d.D.fog["horizon-blend"]),"star-intensity":new d.G(d.D.fog["star-intensity"]),"vertical-range":new d.G(d.D.fog["vertical-range"])});class Zr extends d.E{constructor(s,c,m,y){super(),this._transitionable=new d.J(Oi,m,new Map(y)),this.set(s,y),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new d.Q(Oi)}get state(){const s=this._transform,c="globe"===s.projection.name,m=d.S(s.zoom),y=this.properties.get("range"),x=[.5,3];return{range:c?[d.U(x[0],y[0],m),d.U(x[1],y[1],m)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,c,m={}){if(this._validate(le,s,m))return;const y=d.e({},s);for(const x of Object.keys(d.D.fog))void 0===y[x]&&(y[x]=d.D.fog[x].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:d.O(Pi,fi,s))*c.a}getOpacityAtLatLng(s,c){return this._transform.projection.supportsFog?function(m,y,x){const C=d.L.fromLngLat(y),T=x.elevation?x.elevation.getAtPointOrZero(C):0;return Si(m,C.x,C.y,T,x)}(this.state,s,c):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(s.toUnwrapped());return Cr(this.state,c,0,0,d.V,d.V,this._transform)}getOpacityForBounds(s,c,m,y,x){return this._transform.projection.supportsFog?Cr(this.state,s,c,m,y,x,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?ai(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const m of c){const y=s.points[m];let x;if(y[2]>=0)x=y;else{const C=s.points[m-4];x=d.W(C,y,C[2]/(C[2]-y[2]))}if(Si(this.state,x[0],x[1],0,this._transform)>=Qn)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,m){return(!m||!1!==m.validate)&&Rt(this,s.call(ss,d.e({value:c,style:{glyphs:!0,sprite:!0},styleSpec:d.D})))}}class Wr extends d.E{constructor(s,c,m,y){super(),this.scope=m,this._options=s,this.properties=new d.Q(c),this._transitionable=new d.J(c,m,new Map(y)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,c){this._options=s,this._transitionable.setTransitionOrValue(s.properties,c)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const mo=new d.F({color:new d.G(d.D.properties_light_ambient.color),intensity:new d.G(d.D.properties_light_ambient.intensity)}),cr=new d.F({direction:new d.X(d.D.properties_light_directional.direction),color:new d.G(d.D.properties_light_directional.color),intensity:new d.G(d.D.properties_light_directional.intensity),"cast-shadows":new d.G(d.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new d.G(d.D.properties_light_directional["shadow-intensity"])});class lr{constructor(s,c,m,y){this.screenBounds=s,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(s,c){let m,y;if(s instanceof d.P||"number"==typeof s[0]){const x=d.P.convert(s);m=[x],y=c.isPointAboveHorizon(x)}else{const x=d.P.convert(s[0]),C=d.P.convert(s[1]);m=[x,C],y=d.Y(x,C).every(T=>c.isPointAboveHorizon(T))}return new lr(m,c.getCameraPoint(),y,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(s){return d.Y(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const c=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new d.P(1,1)):this.screenBounds[1],y=d.Y(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),d._(y,s)}bufferedCameraGeometryGlobe(s){const c=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new d.P(1,1)):this.screenBounds[1],y=d.Y(c,m,s),x=this.cameraPoint.clone();switch(3*((x.y>c.y)+(x.y>m.y))+((x.x>c.x)+(x.x>m.x))){case 0:y[0]=x,y[4]=x.clone();break;case 1:y.splice(1,0,x);break;case 2:y[1]=x;break;case 3:y.splice(4,0,x);break;case 5:y.splice(2,0,x);break;case 6:y[3]=x;break;case 7:y.splice(3,0,x);break;case 8:y[2]=x}return y}containsTile(s,c,m,y=0){const x=s.queryPadding/c._pixelsPerMercatorPixel+1,C=m?this._bufferedCameraMercator(x,c):this._bufferedScreenMercator(x,c);let T=s.tileID.wrap+(C.unwrapped?y:0);const S=C.polygon.map(Y=>d.$(s.tileTransform,Y,T));if(!d.a0(S,0,0,d.V,d.V))return;T=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const O=this.screenGeometryMercator.polygon.map(Y=>d.a1(s.tileTransform,Y,T)),k=O.map(Y=>new d.P(Y[0],Y[1])),F=c.getFreeCameraOptions().position||new d.L(0,0,0),V=d.a1(s.tileTransform,F,T),j=O.map(Y=>{const G=d.N.sub(Y,Y,V);return d.N.normalize(G,G),new d.a2(V,G)}),q=d.a3(s,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:j,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(W=d.a4(S),W.min.x=d.aa(W.min.x,0,d.V),W.min.y=d.aa(W.min.y,0,d.V),W.max.x=d.aa(W.max.x,0,d.V),W.max.y=d.aa(W.max.y,0,d.V),W),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:q};var W}_bufferedScreenMercator(s,c){const m=Ke(s);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let y;return y="globe"===c.projection.name?this._projectAndResample(this.bufferedScreenGeometry(s),c):{polygon:this.bufferedScreenGeometry(s).map(x=>c.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[m]=y,y}}_bufferedCameraMercator(s,c){const m=Ke(s);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let y;return y="globe"===c.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),c):{polygon:this.bufferedCameraGeometry(s).map(x=>c.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[m]=y,y}}_projectAndResample(s,c){const m=function(x,C){const T=d.a6.multiply([],C.pixelMatrix,C.globeMatrix),S=[0,-d.ab,0,1],O=[0,d.ab,0,1],k=[0,0,0,1];d.a7.transformMat4(S,S,T),d.a7.transformMat4(O,O,T),d.a7.transformMat4(k,k,T);const F=new d.P(S[0]/S[3],S[1]/S[3]),V=new d.P(O[0]/O[3],O[1]/O[3]),j=d.a8(x,F)&&S[3]<k[3],q=d.a8(x,V)&&O[3]<k[3];if(!j&&!q)return null;const W=function(se,he,fe){for(let ge=1;ge<se.length;ge++){const De=ze(he.pointCoordinate3D(se[ge-1]).x),ve=ze(he.pointCoordinate3D(se[ge]).x);if(fe<0){if(De<ve)return{idx:ge,t:-De/(ve-1-De)}}else if(ve<De)return{idx:ge,t:(1-De)/(ve+1-De)}}return null}(x,C,j?-1:1);if(!W)return null;const{idx:Y,t:G}=W;let J=Y>1?Le(x.slice(0,Y),C):[],re=Y<x.length?Le(x.slice(Y),C):[];J=J.map(se=>new d.P(ze(se.x),se.y)),re=re.map(se=>new d.P(ze(se.x),se.y));const ee=[...J];0===ee.length&&ee.push(re[re.length-1]);const oe=d.U(ee[ee.length-1].y,(0===re.length?J[0]:re[0]).y,G);let X;return X=j?[new d.P(0,oe),new d.P(0,0),new d.P(1,0),new d.P(1,oe)]:[new d.P(1,oe),new d.P(1,1),new d.P(0,1),new d.P(0,oe)],ee.push(...X),0===re.length?ee.push(J[0]):ee.push(...re),{polygon:ee.map(se=>new d.L(se.x,se.y)),unwrapped:!1}}(s,c);if(m)return m;const y=function(x,C){let T=!1,S=-1/0,O=0;for(let F=0;F<x.length-1;F++)x[F].x>S&&(S=x[F].x,O=F);for(let F=0;F<x.length-1;F++){const V=(O+F)%(x.length-1),j=x[V],q=x[V+1];Math.abs(j.x-q.x)>.5&&(j.x<q.x?(j.x+=1,0===V&&(x[x.length-1].x+=1)):(q.x+=1,V+1===x.length-1&&(x[0].x+=1)),T=!0)}const k=d.a5(C.center.lng);return T&&k<Math.abs(k-1)&&x.forEach(F=>{F.x-=1}),{polygon:x,unwrapped:T}}(Le(s,c).map(x=>new d.P(ze(x.x),x.y)),c);return{polygon:y.polygon.map(x=>new d.L(x.x,x.y)),unwrapped:y.unwrapped}}}function Le(p,s){return d.a9(p,c=>{const m=s.pointCoordinate3D(c);c.x=m.x,c.y=m.y},1/256)}function ze(p){return p<0?1+p%1:p%1}function Ke(p){return 100*p|0}function ot(p,s,c,m,y){const x=function(C,T){if(C)return y(C);if(T){p.url&&T.tiles&&p.tiles&&delete p.tiles;const S=d.ac(d.e(T,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(S.vectorLayers=T.vector_layers,S.vectorLayerIds=S.vectorLayers.map(O=>O.id)),T.raster_layers&&(S.rasterLayers=T.raster_layers,S.rasterLayerIds=S.rasterLayers.map(O=>O.id)),S.tiles=s.canonicalizeTileset(S,p.url),y(null,S)}};return p.url?d.g(s.transformRequest(s.normalizeSourceURL(p.url,null,c,m),d.R.Source),x):d.f.frame(()=>x(null,p))}class it{constructor(s,c,m){this.bounds=d.ad.convert(this.validateBounds(s)),this.minzoom=c||0,this.maxzoom=m||24}validateBounds(s){return Array.isArray(s)&&4===s.length?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const c=Math.pow(2,s.z),m=Math.floor(d.a5(this.bounds.getWest())*c),y=Math.floor(d.ae(this.bounds.getNorth())*c),x=Math.ceil(d.a5(this.bounds.getEast())*c),C=Math.ceil(d.ae(this.bounds.getSouth())*c);return s.x>=m&&s.x<x&&s.y>=y&&s.y<C}}class tt extends d.E{constructor(s,c,m,y){if(super(),this.id=s,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.ac(c,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new d.af}load(s){this._loaded=!1,this.fire(new d.b("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=ot(this._options,this.map._requestManager,c,m,(y,x)=>{this._tileJSONRequest=null,this._loaded=!0,y?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),m&&2!==m.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new d.a(y))):x&&(d.e(this,x),x.bounds&&(this.tileBounds=new it(x.bounds,this.minzoom,this.maxzoom)),d.aj(x.tiles,this.map._requestManager._customAccessToken),this.fire(new d.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.b("data",{dataType:"source",sourceDataType:"content"}))),s&&s(y)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=d.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return d.e({},this._options)}loadTile(s,c){const m=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(m,d.R.Tile),data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:d.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster};if(y.request.collectResourceTiming=this._collectResourceTiming,s.actor&&"expired"!==s.state)"loading"===s.state?s.reloadCallback=c:s.request=s.actor.send("reloadTile",y,x.bind(this));else if(s.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",y,x.bind(this),void 0,!0);else{const C=d.ah.call({deduped:this._deduped},y,(T,S)=>{T||!S?x.call(this,T):(y.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},s.actor&&s.actor.send("loadTile",y,x.bind(this),void 0,!0))},!0);s.request={cancel:C}}function x(C,T){return delete s.request,s.aborted?c(null):C&&404!==C.status?c(C):(T&&T.resourceTiming&&(s.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&s.setExpiryData(T),s.loadVectorData(T,this.map.painter),d.ai(this.dispatcher),c(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class mt extends d.E{constructor(s,c,m,y){super(),this.id=s,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},c),d.e(this,d.ac(c,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new d.b("dataloading",{dataType:"source"})),this._tileJSONRequest=ot(this._options,this.map._requestManager,null,null,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new d.a(c)):m&&(d.e(this,m),m.bounds&&(this.tileBounds=new it(m.bounds,this.minzoom,this.maxzoom)),d.aj(m.tiles),this.fire(new d.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.b("data",{dataType:"source",sourceDataType:"content"}))),s&&s(c)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=d.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return d.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,c){const m=d.f.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);s.request=d.d(this.map._requestManager.transformRequest(y,d.R.Tile),(x,C,T,S)=>(delete s.request,s.aborted?(s.state="unloaded",c(null)):x?(s.state="errored",c(x)):C?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:T,expires:S}),s.setTexture(C,this.map.painter),s.state="loaded",d.ai(this.dispatcher),void c(null)):c(null)))}abortTile(s,c){s.request&&(s.request.cancel(),delete s.request),c()}unloadTile(s,c){s.texture&&s.texture instanceof d.T?(s.destroy(!0),s.texture&&s.texture instanceof d.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class st extends mt{constructor(s,c,m,y){super(s,c,m,y),this.type="raster-array",this.maxzoom=22,this._options=d.e({type:"raster-array"},c)}triggerRepaint(s){const c=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);c&&c.enabled&&m&&c._clearRenderCacheForTile(m.id,s.tileID),this.map.triggerRepaint()}loadTile(s,c){const m=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(m,d.R.Tile);s.requestParams=y,s.actor||(s.actor=this.dispatcher.getActor()),s.request=s.fetchHeader(void 0,(x,C,T,S)=>(delete s.request,s.aborted?(s.state="unloaded",c(null)):x?20===x.code?void 0:(s.state="errored",c(x)):(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:T,expires:S}),s.state="empty",void c(null))))}unloadTile(s){const c=s.texture;c&&c instanceof d.T?(s.destroy(!0),this.map.painter.saveTileTexture(c)):(s.destroy(),s.flushQueues(),s._isHeaderLoaded=!1,delete s._mrt,delete s.textureDescriptor),s.fbo&&(s.fbo.destroy(),delete s.fbo),delete s.request,delete s.requestParams,delete s.neighboringTiles,s.state="unloaded"}prepareTile(s,c,m){s._isHeaderLoaded&&("empty"!==s.state&&(s.state="reloading"),s.fetchBand(c,m,(y,x)=>{if(y)return s.state="errored",this.fire(new d.a(y)),void this.triggerRepaint(s);x&&(s.setTexture(x,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:x})=>x===s),m=c&&c.fields,y=m&&m.bands&&m.bands;return y?y[0]:0}getTextureDescriptor(s,c,m){if(!s)return;const y=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let x=null;c instanceof d.an?x=c.paint.get("raster-array-band"):c instanceof d.ao&&(x=c.paint.get("raster-particle-array-band"));const C=x||this.getInitialBand(y);if(null!=C)if(s.textureDescriptor){if(!s.updateNeeded(y,C)||m)return Object.assign({},s.textureDescriptor,{texture:s.texture})}else this.prepareTile(s,y,C)}}const Wt=new Uint16Array(8184);for(let p=0;p<2046;p++){let s=p+2,c=0,m=0,y=0,x=0,C=0,T=0;for(1&s?y=x=C=32:c=m=T=32;(s>>=1)>1;){const O=c+y>>1,k=m+x>>1;1&s?(y=c,x=m,c=C,m=T):(c=y,m=x,y=C,x=T),C=O,T=k}const S=4*p;Wt[S+0]=c,Wt[S+1]=m,Wt[S+2]=y,Wt[S+3]=x}const An=new Uint16Array(2178),Nt=new Uint8Array(1089),Hn=new Uint16Array(1089);function Ni(p){return 0===p?-.03125:32===p?.03125:0}let Un=(()=>{class p{constructor(c,m,y,x){this.id=p.uniqueIdxCounter,p.uniqueIdxCounter++,this.context=c;const C=c.gl;this.buffer=C.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||x||m.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){this.id=p.uniqueIdxCounter,p.uniqueIdxCounter++;const m=this.context.gl;this.context.unbindVAO(),this.bind(),m.bufferSubData(m.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return p.uniqueIdxCounter=0,p})();const qi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Zi{constructor(s,c,m,y,x,C){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.instanceCount=C,this.context=s;const T=s.gl;this.buffer=T.createBuffer(),s.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||x||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,c){for(let m=0;m<this.attributes.length;m++){const y=c.attributes[this.attributes[m].name];void 0!==y&&s.enableVertexAttribArray(y)}}setVertexAttribPointers(s,c,m){for(let y=0;y<this.attributes.length;y++){const x=this.attributes[y],C=c.attributes[x.name];void 0!==C&&s.vertexAttribPointer(C,x.components,s[qi[x.type]],!1,this.itemSize,x.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(s,c,m){for(let y=0;y<this.attributes.length;y++){const x=c.attributes[this.attributes[y].name];void 0!==x&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(x,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Yn{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ho extends Yn{getDefault(){return d.ax.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class as extends Yn{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Dr extends Yn{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class xu extends Yn{getDefault(){return[!0,!0,!0,!0]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class ls extends Yn{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Dc extends Yn{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class qh extends Yn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const c=this.current;(s.func!==c.func||s.ref!==c.ref||s.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class el extends Yn{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Tf extends Yn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=s,this.dirty=!1}}class Tc extends Yn{getDefault(){return[0,1]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class gm extends Yn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=s,this.dirty=!1}}class Zh extends Yn{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Wh extends Yn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.BLEND):c.disable(c.BLEND),this.current=s,this.dirty=!1}}class Yh extends Yn{getDefault(){const s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Mf extends Yn{getDefault(){return d.ax.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class ki extends Yn{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class ir extends Yn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=s,this.dirty=!1}}class rn extends Yn{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Sn extends Yn{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let bu=class extends Yn{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class wu extends Yn{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Js extends Yn{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ds extends Yn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class If extends Yn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class zi extends Yn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Ma extends Yn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class at extends Yn{getDefault(){return null}set(s){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class $n extends Yn{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class Xn extends Yn{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class So extends Yn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class wn extends Yn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class On extends Yn{constructor(s,c){super(s),this.context=s,this.parent=c}getDefault(){return null}}class Mc extends On{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Eu extends On{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Ic extends On{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class xt extends Eu{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Wi{constructor(s,c,m,y,x){this.context=s,this.width=c,this.height=m;const C=this.framebuffer=s.gl.createFramebuffer();y&&(this.colorAttachment=new Mc(s,C)),x&&(this.depthAttachmentType=x,this.depthAttachment="renderbuffer"===x?new Eu(s,C):new Ic(s,C))}destroy(){const s=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&s.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const c=this.depthAttachment.get();c&&s.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&s.deleteTexture(c)}s.deleteFramebuffer(this.framebuffer)}}class rt{constructor(s,c,m){this.func=s,this.mask=c,this.range=m}}rt.ReadOnly=!1,rt.ReadWrite=!0,rt.disabled=new rt(519,rt.ReadOnly,[0,1]);class Qt{constructor(s,c,m,y,x,C){this.test=s,this.ref=c,this.mask=m,this.fail=y,this.depthFail=x,this.pass=C}}Qt.disabled=new Qt({func:519,mask:0},0,0,7680,7680,7680);class mn{constructor(s,c,m,y){this.blendFunction=s,this.blendColor=c,this.mask=m,this.blendEquation=y}}mn.Replace=[1,0,1,0],mn.disabled=new mn(mn.Replace,d.ax.transparent,[!1,!1,!1,!1]),mn.unblended=new mn(mn.Replace,d.ax.transparent,[!0,!0,!0,!0]),mn.alphaBlended=new mn([1,771,1,771],d.ax.transparent,[!0,!0,!0,!0]),mn.multiply=new mn([774,0,774,0],d.ax.transparent,[!0,!0,!0,!0]);class Ut{constructor(s,c,m){this.enable=s,this.mode=c,this.frontFace=m}}Ut.disabled=new Ut(!1,1029,2305),Ut.backCCW=new Ut(!0,1029,2305),Ut.backCW=new Ut(!0,1029,2304),Ut.frontCW=new Ut(!0,1028,2304),Ut.frontCCW=new Ut(!0,1028,2305);class _m{constructor(s,c){this.gl=s,this.clearColor=new Ho(this),this.clearDepth=new as(this),this.clearStencil=new Dr(this),this.colorMask=new xu(this),this.depthMask=new ls(this),this.stencilMask=new Dc(this),this.stencilFunc=new qh(this),this.stencilOp=new el(this),this.stencilTest=new Tf(this),this.depthRange=new Tc(this),this.depthTest=new gm(this),this.depthFunc=new Zh(this),this.blend=new Wh(this),this.blendFunc=new Yh(this),this.blendColor=new Mf(this),this.blendEquation=new ki(this),this.cullFace=new ir(this),this.cullFaceSide=new rn(this),this.frontFace=new Sn(this),this.program=new bu(this),this.activeTexture=new wu(this),this.viewport=new Js(this),this.bindFramebuffer=new Ds(this),this.bindRenderbuffer=new If(this),this.bindTexture=new zi(this),this.bindVertexBuffer=new Ma(this),this.bindElementBuffer=new at(this),this.bindVertexArrayOES=new $n(this),this.pixelStoreUnpack=new Xn(this),this.pixelStoreUnpackPremultiplyAlpha=new So(this),this.pixelStoreUnpackFlipY=new wn(this),this.options=c?{...c}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,c,m){return new Un(this,s,c,m)}createVertexBuffer(s,c,m,y,x){return new Zi(this,s,c,m,y,x)}createRenderbuffer(s,c,m){const y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,s,c,m),this.bindRenderbuffer.set(null),x}createFramebuffer(s,c,m,y){return new Wi(this,s,c,m,y)}clear({color:s,depth:c,stencil:m,colorMask:y}){const x=this.gl;let C=0;s&&(C|=x.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set(y||[!0,!0,!0,!0])),void 0!==c&&(C|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==m&&(C|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),x.clear(C)}setCullFace(s){!1===s.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){Zt(s.blendFunction,mn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var Sc=d.ay([{name:"a_pos",type:"Float32",components:3}]);class Ui{constructor(s,c,m,y){const x={width:m[0],height:m[1],data:null},C=s.gl;this.targetColorTexture=new d.T(s,x,C.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new d.T(s,x,C.RGBA,{useMipmap:!1}),this.context=s,this.setNumParticles(c,y),this.lastInvalidatedAt=0}setNumParticles(s,c){if(this.numParticles===c)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());const m=new d.az;m.reserve(Math.round(c));const y=d.aA(s.key);for(let x=0;x<c;x++)m.emplaceBack(y(),y(),y());this.particleVertices0=this.context.createVertexBuffer(m,Sc.members,!0),this.particleVertices1=this.context.createVertexBuffer(m,Sc.members,!0),this.particleSegment=d.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=c}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=d.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}const Ts={type:2,extent:d.V,loadGeometry:()=>[[new d.P(0,0),new d.P(d.V+1,0),new d.P(d.V+1,d.V+1),new d.P(0,d.V+1),new d.P(0,0)]]};class kl{constructor(s,c,m,y,x){this.tileID=s,this.uid=d.aC(),this.uses=0,this.tileSize=c,this.tileZoom=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection)}registerFadeDuration(s){const c=s+this.timeAdded;c<d.f.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=d.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,c,m){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(y,x){const C={};if(!x)return C;for(const T of y){const S=T.layerIds.map(O=>x.getLayer(O)).filter(Boolean);if(0!==S.length){T.layers=S,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(O=>S.filter(k=>k.id===O)[0]));for(const O of S)C[O.fqid]=T}}return C}(s.buckets,c.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const x=this.buckets[y];if(x instanceof d.aE){if(this.hasSymbolBuckets=!0,!m)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const x=this.buckets[y];if(x instanceof d.aE&&x.hasRTLText){this.hasRTLText=!0,d.aF();break}}this.queryPadding=0;for(const y in this.buckets){const x=this.buckets[y],C=c.style.getOwnLayer(y);if(!C)continue;const T=C.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,T)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new d.aD}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(s){return this.buckets[s.fqid]}upload(s){for(const y in this.buckets){const x=this.buckets[y];x.uploadPending()&&x.upload(s)}const c=s.gl,m=this.imageAtlas;if(m&&!m.uploaded){const y=!!Object.keys(m.patternPositions).length;this.imageAtlasTexture=new d.T(s,m.image,c.RGBA,{useMipmap:y}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new d.T(s,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new d.T(s,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(s,c,m){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,m),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=c.style.getBrightness();(this._lastUpdatedBrightness||y)&&(this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this._lastUpdatedBrightness=y,this.updateBuckets(void 0,c)))}queryRenderedFeatures(s,c,m,y,x,C,T,S){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:y,pixelPosMatrix:T,transform:C,params:x,tileTransform:this.tileTransform},s,c,m):{}}querySourceFeatures(s,c){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const y=m.loadVTLayers(),x=c?c.sourceLayer:"",C=y._geojsonTileLayer||y[x];if(!C)return;const T=d.aG(c&&c.filter),{z:S,x:O,y:k}=this.tileID.canonical,F={z:S,x:O,y:k};for(let V=0;V<C.length;V++){const j=C.feature(V);if(T.needGeometry){const Y=d.aH(j,!0);if(!T.filter(new d.K(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!T.filter(new d.K(this.tileID.overscaledZ),j))continue;const q=m.getId(j,x),W=new d.aI(j,S,O,k,q);W.tile=F,s.push(W)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const s in this.buckets)if(this.buckets[s].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const c=this.expirationTime;if(s.cacheControl){const m=d.aJ(s.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const m=Date.now();let y=!1;if(this.expirationTime>m)y=!1;else if(c)if(this.expirationTime<c)y=!0;else{const x=this.expirationTime-c;x?this.expirationTime=m+Math.max(x,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(s,c){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(s).length&&c&&this.updateBuckets(s,c)}updateBuckets(s,c){if(!this.latestFeatureIndex)return;const m=this.latestFeatureIndex.loadVTLayers(),y=c.style.listImages(),x=c.style.getBrightness();for(const C in this.buckets){if(!c.style.hasLayer(C))continue;const T=this.buckets[C],S=T.layers[0].sourceLayer||"_geojsonTileLayer",O=m[S];let k={};if(s&&(k=s[S],!O||!k||0===Object.keys(k).length))continue;if(T.update(k,O,y,this.imageAtlas&&this.imageAtlas.patternPositions||{},x),T instanceof d.aK||T instanceof d.aL){const V=c.style.getOwnSourceCache(T.layers[0].source);c._terrain&&c._terrain.enabled&&V&&T.programConfigurations.needsUpload&&c._terrain._clearRenderCacheForTile(V.id,this.tileID)}const F=c&&c.style&&c.style.getOwnLayer(C);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(T)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<d.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=d.f.now()+s}setTexture(s,c){const m=c.context,y=m.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof d.T?this.texture.update(s,{useMipmap:!0}):(this.texture=new d.T(m,s,y.RGBA,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(s,c){const m={};for(const y of c)m[y]=!0;this.dependencies[s]=m}hasDependency(s,c){for(const m of s){const y=this.dependencies[m];if(y)for(const x of c)if(y[x])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,c){if(!c||"mercator"===c.name||this._tileDebugBuffer)return;const m=d.aM(Ts,this.tileID.canonical,this.tileTransform)[0],y=new d.aN,x=new d.aO;for(let C=0;C<m.length;C++){const{x:T,y:S}=m[C];y.emplaceBack(T,S),x.emplaceBack(C)}x.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(x),this._tileDebugBuffer=s.createVertexBuffer(y,d.aP.members),this._tileDebugSegments=d.aB.simpleSegment(0,0,y.length,x.length)}_makeTileBoundsBuffers(s,c){if(this._tileBoundsBuffer||!c||"mercator"===c.name)return;const m=d.aM(Ts,this.tileID.canonical,this.tileTransform)[0];let y,x;if(this.isRaster){const C=function(T,S){const O=d.as(T,S),k=Math.pow(2,T.z);for(let Y=0;Y<33;Y++)for(let G=0;G<33;G++){const J=d.at((T.x+(G+Ni(G))/32)/k),re=d.au((T.y+(Y+Ni(Y))/32)/k),ee=S.project(J,re),oe=33*Y+G;An[2*oe+0]=Math.round((ee.x*O.scale-O.x)*d.V),An[2*oe+1]=Math.round((ee.y*O.scale-O.y)*d.V)}Nt.fill(0),Hn.fill(0);for(let Y=2045;Y>=0;Y--){const G=4*Y,J=Wt[G+0],re=Wt[G+1],ee=Wt[G+2],oe=Wt[G+3],X=J+ee>>1,se=re+oe>>1,he=X+se-re,fe=se+J-X,ge=33*re+J,De=33*oe+ee,ve=33*se+X,Pe=Math.hypot((An[2*ge+0]+An[2*De+0])/2-An[2*ve+0],(An[2*ge+1]+An[2*De+1])/2-An[2*ve+1])>=16;Nt[ve]=Nt[ve]||(Pe?1:0),Y<1022&&(Nt[ve]=Nt[ve]||Nt[33*(re+fe>>1)+(J+he>>1)]||Nt[33*(oe+fe>>1)+(ee+he>>1)])}const F=new d.av,V=new d.aw;let j=0;function q(Y,G){const J=33*G+Y;return 0===Hn[J]&&(F.emplaceBack(An[2*J+0],An[2*J+1],Y*d.V/32,G*d.V/32),Hn[J]=++j),Hn[J]-1}function W(Y,G,J,re,ee,oe){const X=Y+J>>1,se=G+re>>1;if(Math.abs(Y-ee)+Math.abs(G-oe)>1&&Nt[33*se+X])W(ee,oe,Y,G,X,se),W(J,re,ee,oe,X,se);else{const he=q(Y,G),fe=q(J,re),ge=q(ee,oe);V.emplaceBack(he,fe,ge)}}return W(0,0,32,32,32,0),W(32,32,0,0,0,32),{vertices:F,indices:V}}(this.tileID.canonical,c);y=C.vertices,x=C.indices}else{y=new d.av,x=new d.aw;for(const{x:T,y:S}of m)y.emplaceBack(T,S,0,0);const C=d.aQ(y.int16,void 0,4);for(let T=0;T<C.length;T+=3)x.emplaceBack(C[T],C[T+1],C[T+2])}this._tileBoundsBuffer=s.createVertexBuffer(y,d.aR.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(x),this._tileBoundsSegments=d.aB.simpleSegment(0,0,y.length,x.length)}_makeGlobeTileDebugBuffers(s,c){const m=c.projection;if(!m||"globe"!==m.name||c.freezeTileCoverage)return;const y=this.tileID.canonical,x=d.aS(y,c),C=d.aT(x),T=d.S(c.zoom);let S;T>0&&(S=d.a6.invert(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,y,c,C,S,T),this._makeGlobeTileDebugTextBuffer(s,y,c,C,S,T)}_globePoint(s,c,m,y,x,C,T){let S=d.aU(s,c,m);if(C){const O=1<<m.z,k=d.a5(y.center.lng),F=d.ae(y.center.lat),V=(m.x+.5)/O-k;let j=0;V>.5?j=-1:V<-.5&&(j=1);let q=(s/d.V+m.x)/O+j,W=(c/d.V+m.y)/O;q=(q-k)*y._pixelsPerMercatorPixel+k,W=(W-F)*y._pixelsPerMercatorPixel+F;const Y=[q*y.worldSize,W*y.worldSize,0];d.N.transformMat4(Y,Y,C),S=d.aV(S,Y,T)}return d.N.transformMat4(S,S,x)}_makeGlobeTileDebugBorderBuffer(s,c,m,y,x,C){const T=new d.aN,S=new d.aO,O=new d.aW,k=(V,j,q,W,Y)=>{const G=(q-V)/(Y-1),J=(W-j)/(Y-1),re=T.length;for(let ee=0;ee<Y;ee++){const oe=V+ee*G,X=j+ee*J;T.emplaceBack(oe,X);const se=this._globePoint(oe,X,c,m,y,x,C);O.emplaceBack(se[0],se[1],se[2]),S.emplaceBack(re+ee)}},F=d.V;k(0,0,F,0,16),k(F,0,F,F,16),k(F,F,0,F,16),k(0,F,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(S),this._tileDebugBuffer=s.createVertexBuffer(T,d.aP.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(O,d.aX.members),this._tileDebugSegments=d.aB.simpleSegment(0,0,T.length,S.length)}_makeGlobeTileDebugTextBuffer(s,c,m,y,x,C){const T=d.V/4,S=new d.aN,O=new d.aw,k=new d.aW,F=25;O.reserve(32),S.reserve(F),k.reserve(F);const V=(j,q)=>F*j+q;for(let j=0;j<F;j++){const q=j*T;for(let W=0;W<F;W++){const Y=W*T;S.emplaceBack(Y,q);const G=this._globePoint(Y,q,c,m,y,x,C);k.emplaceBack(G[0],G[1],G[2])}}for(let j=0;j<4;j++)for(let q=0;q<4;q++){const W=V(j,q),Y=V(j,q+1),G=V(j+1,q),J=V(j+1,q+1);O.emplaceBack(W,Y,G),O.emplaceBack(G,Y,J)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(O),this._tileDebugTextBuffer=s.createVertexBuffer(S,d.aP.members),this._globeTileDebugTextBuffer=s.createVertexBuffer(k,d.aX.members),this._tileDebugTextSegments=d.aB.simpleSegment(0,0,F,32)}destroy(s=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!s&&this.texture&&this.texture instanceof d.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const nl={vector:tt,raster:mt,"raster-dem":class extends mt{constructor(p,s,c,m){super(p,s,c,m),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(p,s){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(y,x){y&&(p.state="errored",s(y)),x&&(p.dem=x,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",s(null))}p.request=d.d(this.map._requestManager.transformRequest(c,d.R.Tile),function(y,x,C,T){if(delete p.request,p.aborted)p.state="unloaded",s(null);else if(y)p.state="errored",s(y);else if(x){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:C,expires:T});const S=ImageBitmap&&x instanceof ImageBitmap&&d.ak(),O=1-(x.width-d.al(x.width))/2;O<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const k=S?x:d.f.getImageData(x,O),F={uid:p.uid,coord:p.tileID,source:this.id,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:O};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",F,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const s=p.canonical,c=Math.pow(2,s.z),m=(s.x-1+c)%c,y=0===s.x?p.wrap-1:p.wrap,x=(s.x+1+c)%c,C=s.x+1===c?p.wrap+1:p.wrap,T={};return T[new d.am(p.overscaledZ,y,s.z,m,s.y).key]={backfilled:!1},T[new d.am(p.overscaledZ,C,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(T[new d.am(p.overscaledZ,y,s.z,m,s.y-1).key]={backfilled:!1},T[new d.am(p.overscaledZ,p.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},T[new d.am(p.overscaledZ,C,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<c&&(T[new d.am(p.overscaledZ,y,s.z,m,s.y+1).key]={backfilled:!1},T[new d.am(p.overscaledZ,p.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},T[new d.am(p.overscaledZ,C,s.z,x,s.y+1).key]={backfilled:!1}),T}},"raster-array":st,geojson:class extends d.E{constructor(p,s,c,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=s.data,this._options=d.e({},s),this._collectResourceTiming=s.collectResourceTiming,void 0!==s.maxzoom&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const y=d.V/this.tileSize;this.workerOptions=d.e({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(void 0!==s.buffer?s.buffer:128)*y,tolerance:(void 0!==s.tolerance?s.tolerance:.375)*y,extent:d.V,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:void 0!==s.clusterMaxZoom?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:d.V,radius:(void 0!==s.clusterRadius?s.clusterRadius:50)*y,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},s),this}getClusterChildren(p,s){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},s),this}getClusterLeaves(p,s,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:s,offset:c},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.b("dataloading",{dataType:"source"})),this._loaded=!1;const p=d.e({},this.workerOptions);p.scope=this.scope;const s=this._data;"string"==typeof s?(p.request=this.map._requestManager.transformRequest(d.f.resolveURL(s),d.R.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new d.a(c));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),this.fire(new d.b("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,s){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const m={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:d.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};p.request=this.actor.send(c,m,(y,x)=>(delete p.request,p.destroy(),p.aborted?s(null):y?s(y):(p.loadVectorData(x,this.map.painter,"reloadTile"===c),s(null))),void 0,"loadTile"===c)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends d.ap{constructor(p,s,c,m){super(p,s,c,m),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const s of p.urls)this.urls.push(this.map._requestManager.transformRequest(s,d.R.Source).url);d.aq(this.urls,(s,c)=>{this._loaded=!0,s?this.fire(new d.a(s)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const s=this.video.seekable;p<s.start(0)||p>s.end(0)?this.fire(new d.a(new _t(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,s=p.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new d.T(p,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:d.ap,model:class extends d.E{constructor(p,s,c,m){super(),this.id=p,this.type="model",this.models=[],this._loaded=!1,this._options=s}load(){const p=[];for(const s in this._options.models){const c=this._options.models[s],m=d.l(this.map._requestManager.transformRequest(c.uri,d.R.Model).url).then(y=>{if(!y)return;const x=d.c(y),C=new d.M(s,c.position,c.orientation,x);C.computeBoundsAndApplyParent(),this.models.push(C)}).catch(y=>{this.fire(new d.a(new Error(`Could not load model ${s} from ${c.uri}: ${y.message}`)))});p.push(m)}return Promise.allSettled(p).then(()=>{this._loaded=!0,this.fire(new d.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this.fire(new d.a(new Error(`Could not load models: ${s.message}`)))})}onAdd(p){this.map=p,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(p,s){}serialize(){return{type:"model"}}},"batched-model":class extends d.E{constructor(p,s,c,m){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(p){this.map=p,this.load()}load(p){this._loaded=!1,this.fire(new d.b("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map._worldview;this._tileJSONRequest=ot(this._options,this.map._requestManager,s,c,(m,y)=>{this._tileJSONRequest=null,this._loaded=!0,m?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),c&&2!==c.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new d.a(m))):y&&(d.e(this,y),y.bounds&&(this.tileBounds=new it(y.bounds,this.minzoom,this.maxzoom)),d.aj(y.tiles,this.map._requestManager._customAccessToken),this.fire(new d.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.b("data",{dataType:"source",sourceDataType:"content"}))),p&&p(m)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,s){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(c,d.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(p.actor&&"expired"!==p.state)if("loading"===p.state)p.reloadCallback=s;else{if(p.buckets){const x=Object.values(p.buckets);for(const C of x)C.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",m,y.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",m,y.bind(this),void 0,!0);function y(x,C){return p.aborted?s(null):x&&404!==x.status?s(x):(C&&(C.resourceTiming&&(p.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&p.setExpiryData(C),p.buckets={...p.buckets,...C.buckets},C.featureIndex&&(p.latestFeatureIndex=C.featureIndex)),p.state="loaded",void s(null))}}serialize(){return d.e({},this._options)}},canvas:class extends d.ap{constructor(p,s,c,m){super(p,s,c,m),s.coordinates?Array.isArray(s.coordinates)&&4===s.coordinates.length&&!s.coordinates.some(y=>!Array.isArray(y)||2!==y.length||y.some(x=>"number"!=typeof x))||this.fire(new d.a(new _t(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.a(new _t(`sources.${p}`,null,'missing required property "coordinates"'))),s.animate&&"boolean"!=typeof s.animate&&this.fire(new d.a(new _t(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),s.canvas?"string"==typeof s.canvas||s.canvas instanceof HTMLCanvasElement||this.fire(new d.a(new _t(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.a(new _t(`sources.${p}`,null,'missing required property "canvas"'))),this.options=s,this.animate=void 0===s.animate||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const s=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof d.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.T(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends d.E{constructor(p,s,c,m){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=s,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new d.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new d.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new it(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),d.e(this,d.ac(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return d.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new d.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new d.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:s,y:c,z:m}=p.canonical;return this._implementation.hasTile({x:s,y:c,z:m})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,s){const{x:c,y:m,z:y}=p.tileID.canonical,x=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:m,z:y},{signal:x.signal})).then(function(C){return delete p.request,p.aborted?(p.state="unloaded",s(null)):void 0===C?(p.state="errored",s(null)):null===C?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",s(null)):(T=C)instanceof ImageData||T instanceof HTMLCanvasElement||T instanceof ImageBitmap||T instanceof HTMLImageElement?(this.loadTileData(p,C),p.state="loaded",void s(null)):(p.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var T}.bind(this)).catch(C=>{20!==C.code&&(p.state="errored",s(C))}),p.request.cancel=()=>x.abort()}loadTileData(p,s){p.setTexture(s,this._map.painter)}unloadTile(p,s){if(p.texture&&p.texture instanceof d.T?(p.destroy(!0),p.texture&&p.texture instanceof d.T&&this._map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:c,y:m,z:y}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:m,z:y})}s()}abortTile(p,s){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){const p=d.ag(this.id,this.scope);this._map.style.clearSource(p)}_update(){this.fire(new d.b("data",{dataType:"source",sourceDataType:"content"}))}}},vr=function(p,s,c,m){const y=new nl[s.type](p,s,c,m);if(y.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${y.id}`);return d.aY(["load","abort","unload","serialize","prepare"],y),y};function Sf(p,s){const c=d.a6.identity([]);return d.a6.scale(c,c,[.5*p.width,.5*-p.height,1]),d.a6.translate(c,c,[1,-1,0]),d.a6.multiply(c,c,p.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(c)}function ym(p,s,c,m,y,x,C,T=!1){const S=p.tilesIn(m,C,T);S.sort(Cu);const O=[];for(const F of S)O.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(s,c,p._state,F,y,x,Sf(p.transform,F.tile.tileID),T)});const k=function(F){const V={},j={};for(const q of F){const W=q.queryResults,Y=q.wrappedTileID,G=j[Y]=j[Y]||{};for(const J in W){const re=W[J],ee=G[J]=G[J]||{},oe=V[J]=V[J]||[];for(const X of re)ee[X.featureIndex]||(ee[X.featureIndex]=!0,oe.push(X))}}return V}(O);for(const F in k)k[F].forEach(V=>{const j=V.feature,q=j.layer;q&&"background"!==q.type&&"sky"!==q.type&&"slot"!==q.type&&(j.source=q.source,q["source-layer"]&&(j.sourceLayer=q["source-layer"]),j.state=void 0!==j.id?p.getFeatureState(q["source-layer"],j.id):{})});return k}function Ia(p,s){const c=p.getRenderableIds().map(x=>p.getTileByID(x)),m=[],y={};for(let x=0;x<c.length;x++){const C=c[x],T=C.tileID.canonical.key;y[T]||(y[T]=!0,C.querySourceFeatures(m,s))}return m}function Cu(p,s){const c=p.tileID,m=s.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}class jr extends kl{constructor(s,c,m,y,x){super(s,c,m,y,x),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(s,c){const m=c.context,y=m.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof d.T?this.texture.update(s,{useMipmap:!1,premultiply:!1}):this.texture=new d.T(m,s,y.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(s=16384,c){const m=this._mrt=new d.aZ(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=d.a_(y,(x,C,T,S)=>{if(x)c(x);else try{const O=m.getHeaderLength(C);if(O>s)return void(this.request=this.fetchHeader(O,c));m.parseHeader(C),this._isHeaderLoaded=!0;let k=0;for(const F of Object.values(m.layers))k=Math.max(k,F.dataIndex[F.dataIndex.length-1].last_byte);C.byteLength>=k&&(this.entireBuffer=C),c(null,this.entireBuffer||C,T,S)}catch(O){c(O)}}),this.request}fetchBand(s,c,m){const y=this._mrt;if(!this._isHeaderLoaded||!y)return void m(new Error("Tile header is not ready"));const x=this.actor;if(!x)return void m(new Error("Can't fetch tile band without an actor"));let C;const T=(F,V)=>{C.complete(F,V),F?m(F):(this.updateTextureDescriptor(s,c),m(null,this.textureDescriptor&&this.textureDescriptor.img))},S=(F,V)=>{if(F)return m(F);const j=x.send("decodeRasterArray",{buffer:V,task:C},T,void 0,!0);this._workQueue.push(()=>{j&&j.cancel(),C.cancel()})},O=y.getLayer(s);if(!O)return void m(new Error(`Unknown sourceLayer "${s}"`));if(O.hasDataForBand(c))return this.updateTextureDescriptor(s,c),void m(null,this.textureDescriptor?this.textureDescriptor.img:null);const k=O.getDataRange([c]);if(C=y.createDecodingTask(k),!C||C.tasks.length)if(this.flushQueues(),this.entireBuffer)S(null,this.entireBuffer.slice(k.firstByte,k.lastByte+1));else{const F=Object.assign({},this.requestParams,{headers:{Range:`bytes=${k.firstByte}-${k.lastByte}`}}),V=d.a_(F,S);this._fetchQueue.push(()=>{V.cancel(),C.cancel()})}else m(null)}updateNeeded(s,c){return(!this.textureDescriptor||this.textureDescriptor.band!==c||this.textureDescriptor.layer!==s)&&"errored"!==this.state}updateTextureDescriptor(s,c){if(!this._mrt)return;const m=this._mrt.getLayer(s);if(!m||!m.hasBand(c)||!m.hasDataForBand(c))return;const{bytes:y,tileSize:x,buffer:C,offset:T,scale:S}=m.getBandView(c),O=x+2*C,k={data:y,width:O,height:O},F=this.texture;F&&F instanceof d.T&&F.update(k,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:s,band:c,img:k,buffer:C,offset:T,tileSize:x,format:m.pixelFormat,mix:[S,256*S,65536*S,16777216*S]}}}class gn{constructor(s,c){this.max=s,this.onRemove=c,this.reset()}reset(){for(const s in this.data)for(const c of this.data[s])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(s,c,m){const y=s.wrapped().key;void 0===this.data[y]&&(this.data[y]=[]);const x={value:c,timeout:void 0};if(void 0!==m&&(x.timeout=setTimeout(()=>{this.remove(s,x)},m)),this.data[y].push(x),this.order.push(y),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const c=this.data[s].shift();return c.timeout&&clearTimeout(c.timeout),0===this.data[s].length&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),c.value}getByKey(s){const c=this.data[s];return c?c[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,c){if(!this.has(s))return this;const m=s.wrapped().key,y=void 0===c?0:this.data[m].indexOf(c),x=this.data[m][y];return this.data[m].splice(y,1),x.timeout&&clearTimeout(x.timeout),0===this.data[m].length&&delete this.data[m],this.onRemove(x.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(s){const c=[];for(const m in this.data)for(const y of this.data[m])s(y.value)||c.push(y);for(const m of c)this.remove(m.value.tileID,m)}}class Qs extends d.E{constructor(s,c,m){super(),this.id=s,this._onlySymbols=m,c.on("data",y=>{"source"===y.dataType&&"metadata"===y.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===y.dataType&&"content"===y.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new gn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Cn,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(s){this.map=s,this._minTileCacheSize=void 0===this._minTileCacheSize&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles){const c=this._tiles[s];if("errored"!==c.state&&("loaded"!==c.state||!c.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,c){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,c)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s,()=>{})}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s,()=>{})}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const m=this._tiles[c];m.upload(s),m.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return d.a$(this._tiles).map(s=>s.tileID).sort(Af).map(s=>s.key)}getRenderableIds(s,c){const m=[];for(const y in this._tiles)this._isIdRenderable(+y,s,c)&&m.push(this._tiles[y]);return s?m.sort((y,x)=>{const C=y.tileID,T=x.tileID,S=new d.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle),O=new d.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return C.overscaledZ-T.overscaledZ||O.y-S.y||O.x-S.x}).map(y=>y.tileID.key):m.map(y=>y.tileID).sort(Af).map(y=>y.key)}hasRenderableParent(s){const c=this.findLoadedParent(s,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(s,c,m){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(c||!this._tiles[s].holdingForFade())&&(m||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)"errored"!==this._tiles[s].state&&this._reloadTile(+s,"reloading")}}_reloadTile(s,c){const m=this._tiles[s];m&&("loading"!==m.state&&(m.state=c),this._loadTile(m,this._tileLoaded.bind(this,m,s,c)))}_tileLoaded(s,c,m,y){if(y)if(s.state="errored",404!==y.status)this._source.fire(new d.a(y,{tile:s}));else{if(!(s.tileID.key in this._loadedParentTiles))return void this._source.fire(new d.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}else s.timeAdded=d.f.now(),"expired"===m&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(c,s),"raster-dem"===this._source.type&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),this._source.fire(new d.b("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id}))}_backfillDEM(s){const c=this.getRenderableIds();for(let y=0;y<c.length;y++){const x=c[y];if(s.neighboringTiles&&s.neighboringTiles[x]){const C=this.getTileByID(x);m(s,C),m(C,s)}}function m(y,x){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let C=x.tileID.canonical.x-y.tileID.canonical.x;const T=x.tileID.canonical.y-y.tileID.canonical.y,S=Math.pow(2,y.tileID.canonical.z),O=x.tileID.key;0===C&&0===T||Math.abs(T)>1||(Math.abs(C)>1&&(1===Math.abs(C+S)?C+=S:1===Math.abs(C-S)&&(C-=S)),x.dem&&y.dem&&(y.dem.backfillBorder(x.dem,C,T),y.neighboringTiles&&y.neighboringTiles[O]&&(y.neighboringTiles[O].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,c,m,y){for(const x in this._tiles){let C=this._tiles[x];if(y[x]||!C.hasData()||C.tileID.overscaledZ<=c||C.tileID.overscaledZ>m)continue;let T=C.tileID;for(;C&&C.tileID.overscaledZ>c+1;){const O=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[O.key],C&&C.hasData()&&(T=O)}let S=T;for(;S.overscaledZ>c;)if(S=S.scaledTo(S.overscaledZ-1),s[S.key]){y[T.key]=T;break}}}findLoadedParent(s,c){if(s.key in this._loadedParentTiles){const m=this._loadedParentTiles[s.key];return m&&m.tileID.overscaledZ>=c?m:null}for(let m=s.overscaledZ-1;m>=c;m--){const y=s.scaledTo(m),x=this._getLoadedTile(y);if(x)return x}}_getLoadedTile(s){const c=this._tiles[s.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,c){c=c||this._source.tileSize;const m=Math.ceil(s.width/c)+1,y=Math.ceil(s.height/c)+1,x=Math.floor(m*y*5),C="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,x):x,T="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(T)}handleWrapJump(s){const c=Math.round((s-(void 0===this._prevLng?s:this._prevLng))/360);if(this._prevLng=s,c){const m={};for(const y in this._tiles){const x=this._tiles[y];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+c),m[x.tileID.key]=x}this._tiles=m;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(s,c,m,y){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!m)return;let x;if(this.updateCacheSize(s,c),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)x=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new d.am(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y));else if(0!==this.tileCoverLift){const S=s.clone();S.tileCoverLift=this.tileCoverLift,x=S.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&"globe"===s.projection.name&&(x.push(new d.am(1,0,1,0,0)),x.push(new d.am(1,0,1,1,0)),x.push(new d.am(1,0,1,0,1)),x.push(new d.am(1,0,1,1,1)))}else x=s.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(x=x.filter(S=>this._source.hasTile(S)));else x=[];if(x.length>0&&this.castsShadows&&y&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!il(this._source.type)){const S=s.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!m}),O=Math.min(S,this._source.maxzoom),k=s.extendTileCoverForShadows(x,y,O);for(const F of k)this._shadowCasterTiles[F.key]=!0,x.push(F)}const C=this._updateRetainedTiles(x);if(il(this._source.type)&&0!==x.length){const S={},O={},k=Object.keys(C);for(const V of k){const j=C[V],q=this._tiles[V];if(!q||q.fadeEndTime&&q.fadeEndTime<=d.f.now())continue;const W=this.findLoadedParent(j,Math.max(j.overscaledZ-Qs.maxOverzooming,this._source.minzoom));W&&(this._addTile(W.tileID),S[W.tileID.key]=W.tileID),O[V]=j}const F=x[x.length-1].overscaledZ;for(const V in this._tiles){const j=this._tiles[V];if(C[V]||!j.hasData())continue;let q=j.tileID;for(;q.overscaledZ>F;){q=q.scaledTo(q.overscaledZ-1);const W=this._tiles[q.key];if(W&&W.hasData()&&O[q.key]){C[V]=j.tileID;break}}}for(const V in S)C[V]||(this._coveredTiles[V]=!0,C[V]=S[V])}for(const S in C)this._tiles[S].clearFadeHold();const T=d.b0(this._tiles,C);for(const S of T){const O=this._tiles[S];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(+S)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const c={};if(0===s.length)return c;const m={},y=s.reduce((O,k)=>Math.min(O,k.overscaledZ),1/0),x=s[0].overscaledZ,C=Math.max(x-Qs.maxOverzooming,this._source.minzoom),T=Math.max(x+Qs.maxUnderzooming,this._source.minzoom),S={};for(const O of s){const k=this._addTile(O);c[O.key]=O,k.hasData()||y<this._source.maxzoom&&(S[O.key]=O)}this._retainLoadedChildren(S,y,T,c);for(const O of s){let k=this._tiles[O.key];if(k.hasData())continue;if(O.canonical.z>=this._source.maxzoom){const V=O.children(this._source.maxzoom)[0],j=this.getTile(V);if(j&&j.hasData()){c[V.key]=V;continue}}else{const V=O.children(this._source.maxzoom);if(c[V[0].key]&&c[V[1].key]&&c[V[2].key]&&c[V[3].key])continue}let F=k.wasRequested();for(let V=O.overscaledZ-1;V>=C;--V){const j=O.scaledTo(V);if(m[j.key]||(m[j.key]=!0,k=this.getTile(j),!k&&F&&(k=this._addTile(j)),k&&(c[j.key]=j,F=k.wasRequested(),k.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const c=[];let m,y=this._tiles[s].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){m=this._loadedParentTiles[y.key];break}c.push(y.key);const x=y.scaledTo(y.overscaledZ-1);if(m=this._getLoadedTile(x),m)break;y=x}for(const x of c)this._loadedParentTiles[x]=m}}_addTile(s){let c=this._tiles[s.key];if(c)return!0!==c.isExtraShadowCaster||this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),c;c=this._cache.getAndRemove(s),c&&(this._setTileReloadTimer(s.key,c),c.tileID=s,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,c)));const m=!!c;if(!m){const y=this.map?this.map.painter:null,x=this._source.tileSize*s.overscaleFactor();c="raster-array"===this._source.type?new jr(s,x,this.transform.tileZoom,y,this._isRaster):new kl(s,x,this.transform.tileZoom,y,this._isRaster),this._loadTile(c,this._tileLoaded.bind(this,c,s.key,c.state))}return c?(c.uses++,this._tiles[s.key]=c,m||this._source.fire(new d.b("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c):null}_setTileReloadTimer(s,c){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const m=c.getExpiryTimeout();m&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},m))}_removeTile(s){const c=this._tiles[s];c&&(c.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),c.uses>0||(c.hasData()&&"reloading"!==c.state||"empty"===c.state?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,c,m){const y=[],x=this.transform;if(!x)return y;const C="globe"===x.projection.name,T=d.a5(x.center.lng);for(const S in this._tiles){const O=this._tiles[S];if(m&&O.clearQueryDebugViz(),O.holdingForFade())continue;let k;if(C){const F=O.tileID.canonical;if(0===F.z){const V=[Math.abs(d.aa(T,...$t(F,-1))-T),Math.abs(d.aa(T,...$t(F,1))-T)];k=[0,2*V.indexOf(Math.min(...V))-1]}else{const V=[Math.abs(d.aa(T,...$t(F,-1))-T),Math.abs(d.aa(T,...$t(F,0))-T),Math.abs(d.aa(T,...$t(F,1))-T)];k=[V.indexOf(Math.min(...V))-1]}}else k=[0];for(const F of k){const V=s.containsTile(O,x,c,F);V&&y.push(V)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,c){const m=this.getRenderableIds(s,c).map(x=>this._tiles[x].tileID),y="globe"===this.transform.projection.name;for(const x of m)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=y?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return m}sortCoordinatesByDistance(s){const c=s.slice(),m=this.transform._camera.position,y=this.transform._camera.forward(),x={};for(const C of c){const T=1/(1<<C.canonical.z);x[C.key]=((C.canonical.x+.5)*T+C.wrap-m[0])*y[0]+((C.canonical.y+.5)*T-m[1])*y[1]-m[2]*y[2]}return c.sort((C,T)=>x[C.key]-x[T.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(il(this._source.type))for(const s in this._tiles){const c=this._tiles[s];if(void 0!==c.fadeEndTime&&c.fadeEndTime>=d.f.now())return!0}return!1}setFeatureState(s,c,m){this._state.updateState(s=s||"_geojsonTileLayer",c,m)}removeFeatureState(s,c,m){this._state.removeFeatureState(s=s||"_geojsonTileLayer",c,m)}getFeatureState(s,c){return this._state.getState(s=s||"_geojsonTileLayer",c)}setDependencies(s,c,m){const y=this._tiles[s];y&&y.setDependencies(c,m)}reloadTilesForDependencies(s,c){for(const m in this._tiles)this._tiles[m].hasDependency(s,c)&&this._reloadTile(+m,"reloading");this._cache.filter(m=>!m.hasDependency(s,c))}_preloadTiles(s,c){if(!this._sourceLoaded){const S=()=>{this._sourceLoaded&&(this._source.off("data",S),this._preloadTiles(s,c))};return void this._source.on("data",S)}const m=new Map,y=Array.isArray(s)?s:[s],x=this.map.painter.terrain,C=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const S of y){const O=S.coveringTiles({tileSize:C,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of O)m.set(k.key,k);this.usedForTerrain&&S.updateElevation(!1)}const T=Array.from(m.values());d.b1(T,(S,O)=>{const k=new kl(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(k,F=>{"raster-dem"===this._source.type&&k.dem&&this._backfillDEM(k),O(F,k)})},c)}}function Af(p,s){const c=Math.abs(2*p.wrap)-+(p.wrap<0),m=Math.abs(2*s.wrap)-+(s.wrap<0);return p.overscaledZ-s.overscaledZ||m-c||s.canonical.y-p.canonical.y||s.canonical.x-p.canonical.x}function il(p){return"raster"===p||"image"===p||"video"===p||"custom"===p}function $t(p,s){const c=1<<p.z;return[p.x/c+s,(p.x+1)/c+s]}Qs.maxOverzooming=10,Qs.maxUnderzooming=3;class A_{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];for(const m in this.style._mergedLayers){const y=this.style._mergedLayers[m];if("fill-extrusion"===y.type)this.layers.push({layer:y,visible:false,visibilityChanged:false});else if("model"===y.type){const x=this.style.getLayerSource(y);x&&"batched-model"===x.type&&this.layers.push({layer:y,visible:false,visibilityChanged:false})}}}onNewFrame(s){this.layersGotHidden=!1;for(const c of this.layers){const m=c.layer;let y=!1;"fill-extrusion"===m.type?y=!m.isHidden(s)&&m.paint.get("fill-extrusion-opacity")>0:"model"===m.type&&(y=!m.isHidden(s)&&m.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!y&&c.visible,c.visible=y}}updateZOffset(s,c){this.currentBuildingBuckets=[];for(const y of this.layers){const x=y.layer,C=this.style.getLayerSourceCache(x);let T=1;"fill-extrusion"===x.type&&(T=y.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let S=C?C.getTile(c):null;if(!S&&C&&c.canonical.z>C.getSource().minzoom){let O=c.scaledTo(Math.min(C.getSource().maxzoom,c.overscaledZ-1));for(;O.overscaledZ>=C.getSource().minzoom&&(S=C.getTile(O),!S&&0!==O.overscaledZ);)O=O.scaledTo(O.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:S?S.getBucket(x):null,tileID:S?S.tileID:c,verticalScale:T})}s.hasAnyZOffset=!1;let m=!1;for(let y=0;y<s.symbolInstances.length;y++){const x=s.symbolInstances.get(y),C=x.zOffset,T=this._getHeightAtTileOffset(c,x.tileAnchorX,x.tileAnchorY);x.zOffset=T!==Number.NEGATIVE_INFINITY?T:C,m||C===x.zOffset||(m=!0),s.hasAnyZOffset||0===x.zOffset||(s.hasAnyZOffset=!0)}m&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,c,m,y){let x=c,C=m;if(s.canonical.z!==y.canonical.z){const T=y.canonical,S=1/(1<<s.canonical.z-T.z);x=(c+s.canonical.x*d.V)*S-T.x*d.V|0,C=(m+s.canonical.y*d.V)*S-T.y*d.V|0}return{tileX:x,tileY:C}}_getHeightAtTileOffset(s,c,m){let y,x;for(let C=0;C<this.layers.length;++C){if("fill-extrusion"!==this.layers[C].layer.type)continue;const{bucket:T,tileID:S,verticalScale:O}=this.currentBuildingBuckets[C];if(!T)continue;const{tileX:k,tileY:F}=this._mapCoordToOverlappingTile(s,c,m,S),V=T.getHeightAtTileCoord(k,F);V&&void 0!==V.height&&(V.hidden?y=V.height:x=Math.max(V.height*O,x||0))}if(void 0!==x)return x;for(let C=0;C<this.layers.length;++C){const T=this.layers[C];if("model"!==T.layer.type||!T.visible)continue;const{bucket:S,tileID:O}=this.currentBuildingBuckets[C];if(!S)continue;const{tileX:k,tileY:F}=this._mapCoordToOverlappingTile(s,c,m,O),V=S.getHeightAtTileCoord(k,F);if(V&&!V.hidden)return void 0===V.height&&void 0!==y?Math.min(V.maxHeight,y)*V.verticalScale:(V.height||0)*V.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function rr(p,s){const c={};for(const m in p)"ref"!==m&&(c[m]=p[m]);return d.b2.forEach(m=>{m in s&&(c[m]=s[m])}),c}function Du(p){p=p.slice();const s=Object.create(null);for(let c=0;c<p.length;c++)s[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=rr(p[c],s[p[c].ref]));return p}const kn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Ac(p,s,c){c.push({command:kn.addSource,args:[p,s[p]]})}function Rf(p,s,c){s.push({command:kn.removeSource,args:[p]}),c[p]=!0}function Xh(p,s,c,m){Rf(p,c,m),Ac(p,s,c)}function Kh(p,s,c){let m;for(m in p[c])if(p[c].hasOwnProperty(m)&&"data"!==m&&!Zt(p[c][m],s[c][m]))return!1;for(m in s[c])if(s[c].hasOwnProperty(m)&&"data"!==m&&!Zt(p[c][m],s[c][m]))return!1;return!0}function ea(p,s,c,m,y,x){let C;for(C in s=s||{},p=p||{})p.hasOwnProperty(C)&&(Zt(p[C],s[C])||c.push({command:x,args:[m,C,s[C],y]}));for(C in s)s.hasOwnProperty(C)&&!p.hasOwnProperty(C)&&(Zt(p[C],s[C])||c.push({command:x,args:[m,C,s[C],y]}))}function Sa(p){return p.id}function Jh(p,s){return p[s.id]=s,p}class Kn{constructor(s,c){this.reset(s,c)}reset(s,c){this.points=s||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(1===this.points.length)return this.points[0];s=d.aa(s,0,1);let c=1,m=this._distances[c];const y=s*this.paddedLength+this.padding;for(;m<y&&c<this._distances.length;)m=this._distances[++c];const x=c-1,C=this._distances[x],T=m-C,S=T>0?(y-C)/T:0;return this.points[x].mult(1-S).add(this.points[c].mult(S))}}class Tu{constructor(s,c,m){const y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/m),this.yCellCount=Math.ceil(c/m);for(let C=0;C<this.xCellCount*this.yCellCount;C++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=c,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,c,m,y,x){this._forEachCell(c,m,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(s,c,m,y){this._forEachCell(c-y,m-y,c+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(c),this.circles.push(m),this.circles.push(y)}_insertBoxCell(s,c,m,y,x,C){this.boxCells[x].push(C)}_insertCircleCell(s,c,m,y,x,C){this.circleCells[x].push(C)}_query(s,c,m,y,x,C){if(m<0||s>this.width||y<0||c>this.height)return!x&&[];const T=[];if(s<=0&&c<=0&&this.width<=m&&this.height<=y){if(x)return!0;for(let S=0;S<this.boxKeys.length;S++)T.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const O=this.circles[3*S],k=this.circles[3*S+1],F=this.circles[3*S+2];T.push({key:this.circleKeys[S],x1:O-F,y1:k-F,x2:O+F,y2:k+F})}return C?T.filter(C):T}return this._forEachCell(s,c,m,y,this._queryCell,T,{hitTest:x,seenUids:{box:{},circle:{}}},C),x?T.length>0:T}_queryCircle(s,c,m,y,x){const C=s-m,T=s+m,S=c-m,O=c+m;if(T<0||C>this.width||O<0||S>this.height)return!y&&[];const k=[];return this._forEachCell(C,S,T,O,this._queryCellCircle,k,{hitTest:y,circle:{x:s,y:c,radius:m},seenUids:{box:{},circle:{}}},x),y?k.length>0:k}query(s,c,m,y,x){return this._query(s,c,m,y,!1,x)}hitTest(s,c,m,y,x){return this._query(s,c,m,y,!0,x)}hitTestCircle(s,c,m,y){return this._queryCircle(s,c,m,!0,y)}_queryCell(s,c,m,y,x,C,T,S){const O=T.seenUids,k=this.boxCells[x];if(null!==k){const V=this.bboxes;for(const j of k)if(!O.box[j]){O.box[j]=!0;const q=4*j;if(s<=V[q+2]&&c<=V[q+3]&&m>=V[q+0]&&y>=V[q+1]&&(!S||S(this.boxKeys[j]))){if(T.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[j],x1:V[q],y1:V[q+1],x2:V[q+2],y2:V[q+3]})}}}const F=this.circleCells[x];if(null!==F){const V=this.circles;for(const j of F)if(!O.circle[j]){O.circle[j]=!0;const q=3*j;if(this._circleAndRectCollide(V[q],V[q+1],V[q+2],s,c,m,y)&&(!S||S(this.circleKeys[j]))){if(T.hitTest)return C.push(!0),!0;{const W=V[q],Y=V[q+1],G=V[q+2];C.push({key:this.circleKeys[j],x1:W-G,y1:Y-G,x2:W+G,y2:Y+G})}}}}}_queryCellCircle(s,c,m,y,x,C,T,S){const O=T.circle,k=T.seenUids,F=this.boxCells[x];if(null!==F){const j=this.bboxes;for(const q of F)if(!k.box[q]){k.box[q]=!0;const W=4*q;if(this._circleAndRectCollide(O.x,O.y,O.radius,j[W+0],j[W+1],j[W+2],j[W+3])&&(!S||S(this.boxKeys[q])))return C.push(!0),!0}}const V=this.circleCells[x];if(null!==V){const j=this.circles;for(const q of V)if(!k.circle[q]){k.circle[q]=!0;const W=3*q;if(this._circlesCollide(j[W],j[W+1],j[W+2],O.x,O.y,O.radius)&&(!S||S(this.circleKeys[q])))return C.push(!0),!0}}}_forEachCell(s,c,m,y,x,C,T,S){const O=this._convertToXCellCoord(s),k=this._convertToYCellCoord(c),F=this._convertToXCellCoord(m),V=this._convertToYCellCoord(y);for(let j=O;j<=F;j++)for(let q=k;q<=V;q++)if(x.call(this,s,c,m,y,this.xCellCount*q+j,C,T,S))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,c,m,y,x,C){const T=y-s,S=x-c,O=m+C;return O*O>T*T+S*S}_circleAndRectCollide(s,c,m,y,x,C,T){const S=(C-y)/2,O=Math.abs(s-(y+S));if(O>S+m)return!1;const k=(T-x)/2,F=Math.abs(c-(x+k));if(F>k+m)return!1;if(O<=S||F<=k)return!0;const V=O-S,j=F-k;return V*V+j*j<=m*m}}const ta={unknown:0,flipRequired:1,flipNotRequired:2},xr=Math.tan(85*Math.PI/180);function Rc(p,s,c,m,y,x,C){const T=d.a6.create();if(c)if("globe"===x.name){const S=d.b3(y,s);d.a6.multiply(T,T,S)}else{const S=d.b4.invert([],C);T[0]=S[0],T[1]=S[1],T[4]=S[2],T[5]=S[3],m||d.a6.rotateZ(T,T,y.angle)}else d.a6.multiply(T,y.labelPlaneMatrix,p);return T}function vm(p,s,c,m,y,x,C){const T=Rc(p,s,c,m,y,x,C);return"globe"===x.name&&c||(T[2]=T[6]=T[10]=T[14]=0),T}function $i(p,s,c,m,y,x,C){if(c){if("globe"===x.name){const T=Rc(p,s,c,m,y,x,C);return d.a6.invert(T,T),d.a6.multiply(T,p,T),T}{const T=d.a6.clone(p),S=d.a6.identity([]);return S[0]=C[0],S[1]=C[1],S[4]=C[2],S[5]=C[3],d.a6.multiply(T,T,S),m||d.a6.rotateZ(T,T,-y.angle),T}}return y.glCoordMatrix}function Ms(p,s,c,m){const y=[p,s,c,1];c?d.a7.transformMat4(y,y,m):xm(y,y,m);const x=y[3];return y[0]/=x,y[1]/=x,y[2]/=x,y}function R_(p,s){return Math.min(.5+p/s*.5,1.5)}function Bt(p,s){const c=p[0]/p[3],m=p[1]/p[3];return c>=-s[0]&&c<=s[0]&&m>=-s[1]&&m<=s[1]}function Mu(p,s,c,m,y,x,C,T,S,O){const k=c.transform,F=m?p.textSizeData:p.iconSizeData,V=d.b5(F,c.transform.zoom),j="globe"===k.projection.name,q=[256/c.width*2+1,256/c.height*2+1],W=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;W.clear();let Y=null;j&&(Y=m?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const G=p.lineVertexArray,J=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,re=c.transform.width/c.transform.height;let ee,oe=!1;for(let X=0;X<J.length;X++){const se=J.get(X),{numGlyphs:he,writingMode:fe}=se;if(fe!==d.b6.vertical||oe||ee===d.b6.horizontal||(oe=!0),ee=fe,(se.hidden||fe===d.b6.vertical)&&!oe){Ll(he,W);continue}oe=!1;const ge=new d.P(se.tileAnchorX,se.tileAnchorY);let{x:De,y:ve,z:Pe}=k.projection.projectTilePoint(ge.x,ge.y,O.canonical);if(S){const[pt,Mt,zt]=S(ge);De+=pt,ve+=Mt,Pe+=zt}const Ae=[De,ve,Pe,1];if(d.a7.transformMat4(Ae,Ae,s),!Bt(Ae,q)){Ll(he,W);continue}const qe=Ae[3],xe=R_(c.transform.getCameraToCenterDistance(k.projection),qe),Se=d.b7(F,V,se),pe=C?Se/xe:Se*xe,Ee=Ms(De,ve,Pe,y);if(Ee[3]<=0){Ll(he,W);continue}let He={};const et=C?null:S,Je=Su(se,pe,!1,T,s,y,x,p.glyphOffsetArray,G,W,Y,Ee,ge,He,re,et,k.projection,O,C);oe=Je.useVertical,et&&Je.needsFlipping&&(He={}),(Je.notEnoughRoom||oe||Je.needsFlipping&&Su(se,pe,!0,T,s,y,x,p.glyphOffsetArray,G,W,Y,Ee,ge,He,re,et,k.projection,O,C).notEnoughRoom)&&Ll(he,W)}m?(p.text.dynamicLayoutVertexBuffer.updateData(W),Y&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(Y)):(p.icon.dynamicLayoutVertexBuffer.updateData(W),Y&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(Y))}function Iu(p,s,c,m,y,x,C,T,S,O,k,F,V,j,q,W){const{lineStartIndex:Y,glyphStartIndex:G,segment:J}=T,re=G+T.numGlyphs,ee=Y+T.lineLength,oe=s.getoffsetX(G),X=s.getoffsetX(re-1),se=ed(p*oe,c,m,y,x,C,J,Y,ee,S,O,k,F,V,!0,j,q,W);if(!se)return null;const he=ed(p*X,c,m,y,x,C,J,Y,ee,S,O,k,F,V,!0,j,q,W);return he?{first:se,last:he}:null}function Qh(p,s,c,m){return p===d.b6.horizontal&&Math.abs(m)>Math.abs(c)?{useVertical:!0}:p===d.b6.vertical?m>0?{needsFlipping:!0}:null:s!==ta.unknown&&(0===(y=c)||Math.abs(m/y)>xr)?s===ta.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null;var y}function Su(p,s,c,m,y,x,C,T,S,O,k,F,V,j,q,W,Y,G,J){const re=s/24,ee=p.lineOffsetX*re,oe=p.lineOffsetY*re,{lineStartIndex:X,glyphStartIndex:se,numGlyphs:he,segment:fe,writingMode:ge,flipState:De}=p,ve=X+p.lineLength,Pe=Ae=>{if(k){const[pe,Ee,He]=Ae.up,et=O.length;d.b8(k,et+0,pe,Ee,He),d.b8(k,et+1,pe,Ee,He),d.b8(k,et+2,pe,Ee,He),d.b8(k,et+3,pe,Ee,He)}const[qe,xe,Se]=Ae.point;d.b9(O,qe,xe,Se,Ae.angle)};if(he>1){const Ae=Iu(re,T,ee,oe,c,F,V,p,S,x,j,W,!1,Y,G,J);if(!Ae)return{notEnoughRoom:!0};if(m&&!c){let[qe,xe,Se]=Ae.first.point,[pe,Ee,He]=Ae.last.point;[qe,xe]=Ms(qe,xe,Se,C),[pe,Ee]=Ms(pe,Ee,He,C);const et=Qh(ge,De,(pe-qe)*q,Ee-xe);if(p.flipState=et&&et.needsFlipping?ta.flipRequired:ta.flipNotRequired,et)return et}Pe(Ae.first);for(let qe=se+1;qe<se+he-1;qe++){const xe=ed(re*T.getoffsetX(qe),ee,oe,c,F,V,fe,X,ve,S,x,j,W,!1,!1,Y,G,J);if(!xe)return O.length-=4*(qe-se),{notEnoughRoom:!0};Pe(xe)}Pe(Ae.last)}else{if(m&&!c){const qe=Ms(V.x,V.y,0,y),xe=X+fe+1,Se=new d.P(S.getx(xe),S.gety(xe)),pe=Ms(Se.x,Se.y,0,y),Ee=pe[3]>0?pe:Oc(V,Se,qe,1,y,void 0,Y,G.canonical),He=Qh(ge,De,(Ee[0]-qe[0])*q,Ee[1]-qe[1]);if(p.flipState=He&&He.needsFlipping?ta.flipRequired:ta.flipNotRequired,He)return He}const Ae=ed(re*T.getoffsetX(se),ee,oe,c,F,V,fe,X,ve,S,x,j,W,!1,!1,Y,G,J);if(!Ae)return{notEnoughRoom:!0};Pe(Ae)}return{}}function Pc(p,s,c,m,y){const{x,y:C,z:T}=m.projectTilePoint(p.x,p.y,s);if(!y)return Ms(x,C,T,c);const[S,O,k]=y(p);return Ms(x+S,C+O,T+k,c)}function Oc(p,s,c,m,y,x,C,T){const S=Pc(p.sub(s)._unit()._add(p),T,y,C,x);return d.N.sub(S,c,S),d.N.normalize(S,S),d.N.scaleAndAdd(S,c,S,m)}function ed(p,s,c,m,y,x,C,T,S,O,k,F,V,j,q,W,Y,G){const J=m?p-s:p+s;let re=J>0?1:-1,ee=0;m&&(re*=-1,ee=Math.PI),re<0&&(ee+=Math.PI);let oe=T+C+(re>0?0:1)|0,X=y,se=y,he=0,fe=0;const ge=Math.abs(J),De=[],ve=[];let Pe=x,Ae=Pe;const qe=()=>Oc(Ae,Pe,se,ge-he+1,k,V,W,Y.canonical);for(;he+fe<=ge;){if(oe+=re,oe<T||oe>=S)return null;if(se=X,Ae=Pe,De.push(se),j&&ve.push(Ae),Pe=new d.P(O.getx(oe),O.gety(oe)),X=F[oe],!X){const Mt=Pc(Pe,Y.canonical,k,W,V);X=Mt[3]>0?F[oe]=Mt:qe()}he+=fe,fe=d.N.distance(se,X)}q&&V&&(F[oe]&&(X=qe(),fe=d.N.distance(se,X)),F[oe]=X);const xe=(ge-he)/fe,Se=Pe.sub(Ae)._mult(xe)._add(Ae),pe=d.N.sub([],X,se),Ee=d.N.scaleAndAdd([],se,pe,xe);let He=[0,0,1],et=pe[0],Je=pe[1];if(G&&(He=W.upVector(Y.canonical,Se.x,Se.y),0!==He[0]||0!==He[1]||1!==He[2])){const Mt=[He[2],0,-He[0]],zt=d.N.cross([],He,Mt);d.N.normalize(Mt,Mt),d.N.normalize(zt,zt),et=d.N.dot(pe,Mt),Je=d.N.dot(pe,zt)}if(c){const Mt=d.N.cross([],He,pe);d.N.normalize(Mt,Mt),d.N.scaleAndAdd(Ee,Ee,Mt,c*re)}const pt=ee+Math.atan2(Je,et);return De.push(Ee),j&&ve.push(Se),{point:Ee,angle:pt,path:De,tilePath:ve,up:He}}function Ll(p,s){const c=s.length,m=c+4*p;s.resize(m),s.float32.fill(-1/0,4*c,4*m)}function xm(p,s,c){const m=s[0],y=s[1];return p[0]=c[0]*m+c[4]*y+c[12],p[1]=c[1]*m+c[5]*y+c[13],p[3]=c[3]*m+c[7]*y+c[15],p}const Is=100;class gt{constructor(s,c,m=new Tu(s.width+200,s.height+200,25),y=new Tu(s.width+200,s.height+200,25)){this.transform=s,this.grid=m,this.ignoredGrid=y,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Is,this.screenBottomBoundary=s.height+Is,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=c}placeCollisionBox(s,c,m,y,x,C,T,S){let O=m.projectedAnchorX,k=m.projectedAnchorY,F=m.projectedAnchorZ;const V=m.elevation,j=m.tileID,q=s.getProjection();if(V&&j){const[X,se,he]=q.upVector(j.canonical,m.tileAnchorX,m.tileAnchorY),fe=q.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=X*V*fe,k+=se*V*fe,F+=he*V*fe}const W=this.projectAndGetPerspectiveRatio(T,O,k,F,m.tileID,"globe"===q.name||!!V||this.transform.pitch>0,q),Y=C*W.perspectiveRatio,G=(m.x1*c+y.x-m.padding)*Y+W.point.x,J=(m.y1*c+y.y-m.padding)*Y+W.point.y,re=(m.x2*c+y.x+m.padding)*Y+W.point.x,ee=(m.y2*c+y.y+m.padding)*Y+W.point.y,oe=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(G,J,re,ee)||!x&&this.grid.hitTest(G,J,re,ee,S)||oe?{box:[],offscreen:!1,occluded:W.occluded}:{box:[G,J,re,ee],offscreen:this.isOffscreen(G,J,re,ee),occluded:!1}}placeCollisionCircles(s,c,m,y,x,C,T,S,O,k,F,V,j,q,W){const Y=[],G=this.transform.elevation,J=s.getProjection(),re=G?G.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,J):null,ee=new d.P(m.tileAnchorX,m.tileAnchorY);let{x:oe,y:X,z:se}=J.projectTilePoint(ee.x,ee.y,W.canonical);if(re){const[Se,pe,Ee]=re(ee);oe+=Se,X+=pe,se+=Ee}const he="globe"===J.name,fe=this.projectAndGetPerspectiveRatio(T,oe,X,se,W,he||!!G||this.transform.pitch>0,J),{perspectiveRatio:ge}=fe,De=(F?C/ge:C*ge)/d.bc,ve=Ms(oe,X,se,S),Pe=fe.signedDistanceFromCamera>0?Iu(De,x,m.lineOffsetX*De,m.lineOffsetY*De,!1,ve,ee,m,y,S,{},G&&!F?re:null,F&&!!G,J,W,F):null;let Ae=!1,qe=!1,xe=!0;if(Pe&&!fe.occluded){const Se=.5*j*ge+q,pe=new d.P(-100,-100),Ee=new d.P(this.screenRightBoundary,this.screenBottomBoundary),He=new Kn,{first:et,last:Je}=Pe,pt=et.path.length;let Mt=[];for(let Dt=pt-1;Dt>=1;Dt--)Mt.push(et.path[Dt]);for(let Dt=1;Dt<Je.path.length;Dt++)Mt.push(Je.path[Dt]);const zt=2.5*Se;O&&(Mt=Mt.map(([Dt,hn,Yt],en)=>(re&&!he&&(Yt=re(en<pt-1?et.tilePath[pt-1-en]:Je.tilePath[en-pt+2])[2]),Ms(Dt,hn,Yt,O))),Mt.some(Dt=>Dt[3]<=0)&&(Mt=[]));let Ot=[];if(Mt.length>0){let Dt=1/0,hn=-1/0,Yt=1/0,en=-1/0;for(const tn of Mt)Dt=Math.min(Dt,tn[0]),Yt=Math.min(Yt,tn[1]),hn=Math.max(hn,tn[0]),en=Math.max(en,tn[1]);hn>=pe.x&&Dt<=Ee.x&&en>=pe.y&&Yt<=Ee.y&&(Ot=[Mt.map(tn=>new d.P(tn[0],tn[1]))],(Dt<pe.x||hn>Ee.x||Yt<pe.y||en>Ee.y)&&(Ot=d.ba(Ot,pe.x,pe.y,Ee.x,Ee.y)))}for(const Dt of Ot){He.reset(Dt,.25*Se);let hn=0;hn=He.length<=.5*Se?1:Math.ceil(He.paddedLength/zt)+1;for(let Yt=0;Yt<hn;Yt++){const en=Yt/Math.max(hn-1,1),tn=He.lerp(en),Dn=tn.x+Is,gi=tn.y+Is;Y.push(Dn,gi,Se,0);const En=Dn-Se,Vi=gi-Se,yn=Dn+Se,Nn=gi+Se;if(xe=xe&&this.isOffscreen(En,Vi,yn,Nn),qe=qe||this.isInsideGrid(En,Vi,yn,Nn),!c&&this.grid.hitTestCircle(Dn,gi,Se,V)&&(Ae=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Ae,occluded:!1}}}}return{circles:!k&&Ae||!qe?[]:Y,offscreen:xe,collisionDetected:Ae,occluded:fe.occluded}}queryRenderedSymbols(s){if(0===s.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let m=1/0,y=1/0,x=-1/0,C=-1/0;for(const k of s){const F=new d.P(k.x+Is,k.y+Is);m=Math.min(m,F.x),y=Math.min(y,F.y),x=Math.max(x,F.x),C=Math.max(C,F.y),c.push(F)}const T=this.grid.query(m,y,x,C).concat(this.ignoredGrid.query(m,y,x,C)),S={},O={};for(const k of T){const F=k.key;if(void 0===S[F.bucketInstanceId]&&(S[F.bucketInstanceId]={}),S[F.bucketInstanceId][F.featureIndex])continue;const V=[new d.P(k.x1,k.y1),new d.P(k.x2,k.y1),new d.P(k.x2,k.y2),new d.P(k.x1,k.y2)];d.bb(c,V)&&(S[F.bucketInstanceId][F.featureIndex]=!0,void 0===O[F.bucketInstanceId]&&(O[F.bucketInstanceId]=[]),O[F.bucketInstanceId].push(F.featureIndex))}return O}insertCollisionBox(s,c,m,y,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:x},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,c,m,y,x){const C=c?this.ignoredGrid:this.grid,T={bucketInstanceId:m,featureIndex:y,collisionGroupID:x};for(let S=0;S<s.length;S+=4)C.insertCircle(T,s[S],s[S+1],s[S+2])}projectAndGetPerspectiveRatio(s,c,m,y,x,C,T){const S=[c,m,y,1];let O=!1;y||this.transform.pitch>0?(d.a7.transformMat4(S,S,s),this.fogState&&x&&"globe"!==T.name&&(O=function(V,j,q,W,Y,G){const J=G.calculateFogTileMatrix(Y),re=[j,q,W];return d.N.transformMat4(re,re,J),Wn(V,d.N.length(re),G.pitch,G._fov)}(this.fogState,c,m,y,x.toUnwrapped(),this.transform)>.9)):xm(S,S,s);const k=S[3];return{point:new d.P((S[0]/k+1)/2*this.transform.width+Is,(-S[1]/k+1)/2*this.transform.height+Is),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(T)/k*.5,1.5),signedDistanceFromCamera:k,occluded:C&&S[2]>k||O}}isOffscreen(s,c,m,y){return m<Is||s>=this.screenRightBoundary||y<Is||c>this.screenBottomBoundary}isInsideGrid(s,c,m,y){return m>=0&&s<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const s=d.a6.identity([]);return d.a6.translate(s,s,[-100,-100,0]),s}}function rl(p,s,c){const m=s.createTileMatrix(p,p.worldSize,c.toUnwrapped());return d.a6.multiply(new Float32Array(16),p.projMatrix,m)}function Au(p,s,c){if(s.projection.name===c.projection.name)return p.projMatrix;const m=c.clone();return m.setProjection(s.projection),rl(m,s.getProjection(),p)}function ol(p,s,c){return s.name===c.projection.name?p.projMatrix:rl(c,s,p)}class Pf{constructor(s,c,m,y){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?c:-c))):y&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class sl{constructor(s,c,m,y,x,C=!1){this.text=new Pf(s?s.text:null,c,m,x),this.icon=new Pf(s?s.icon:null,c,y,x),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ss{constructor(s,c,m,y=!1){this.text=s,this.icon=c,this.skipFade=m,this.clipped=y}}class td{constructor(){this.invProjMatrix=d.a6.create(),this.viewportMatrix=d.a6.create(),this.circles=[]}}class cs{constructor(s,c,m,y,x){this.bucketInstanceId=s,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=x}}class nd{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const c=++this.maxGroupID;this.collisionGroups[s]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[s]}}function Ao(p,s,c,m,y){const{horizontalAlign:x,verticalAlign:C}=d.bf(p),T=-(x-.5)*s,S=-(C-.5)*c,O=d.bd(p,m);return new d.P(T+O[0]*y,S+O[1]*y)}function Of(p,s,c,m,y){const x=new d.P(p,s);return c&&x._rotate(m?y:-y),x}class Qe{constructor(s,c,m,y,x,C){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new gt(this.transform,x),this.buildingIndex=C,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new nd(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,c,m,y){const x=m.getBucket(c),C=m.latestFeatureIndex;if(!x||!C||c.fqid!==x.layerIds[0])return;const T=x.layers[0].layout,S=m.collisionBoxArray,O=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),k=m.tileSize/d.V,F=m.tileID.toUnwrapped();this.transform.setProjection(x.projection);const V=(j=m.tileID,q=x.getProjection(),W=this.transform,q.name===this.projection?W.calculateProjMatrix(j.toUnwrapped()):rl(W,q,j));var j,q,W;const Y="map"===T.get("text-pitch-alignment"),G="map"===T.get("text-rotation-alignment");c.compileFilter();const J=c.dynamicFilter(),re=c.dynamicFilterNeedsFeature(),ee=this.transform.calculatePixelsToTileUnitsMatrix(m),oe=vm(V,m.tileID.canonical,Y,G,this.transform,x.getProjection(),ee);let X=null;if(Y){const fe=$i(V,m.tileID.canonical,Y,G,this.transform,x.getProjection(),ee);X=d.a6.multiply([],this.transform.labelPlaneMatrix,fe)}let se=null;J&&m.latestFeatureIndex&&(se={unwrappedTileID:F,dynamicFilter:J,dynamicFilterNeedsFeature:re,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new cs(x.bucketInstanceId,C,x.sourceLayerIndex,x.index,m.tileID);const he={bucket:x,layout:T,posMatrix:V,textLabelPlaneMatrix:oe,labelToScreenMatrix:X,clippingData:se,scale:O,textPixelRatio:k,holdingForFade:m.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:d.b5(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:d.b5(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(y)for(const fe of x.sortKeyRanges){const{sortKey:ge,symbolInstanceStart:De,symbolInstanceEnd:ve}=fe;s.push({sortKey:ge,symbolInstanceStart:De,symbolInstanceEnd:ve,parameters:he})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:he})}attemptAnchorPlacement(s,c,m,y,x,C,T,S,O,k,F,V,j,q,W,Y,G,J){const{textOffset0:re,textOffset1:ee,crossTileID:oe}=V,X=[re,ee],se=Ao(s,m,y,X,x),he=this.collisionIndex.placeCollisionBox(q,x,c,Of(se.x,se.y,C,T,this.transform.angle),F,S,O,k.predicate);if(Y){const fe=q.getSymbolInstanceIconSize(J,this.transform.zoom,V.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(q,fe,Y,Of(se.x,se.y,C,T,this.transform.angle),F,S,O,k.predicate).box.length)return}if(he.box.length>0){let fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[oe]&&this.prevPlacement.placements[oe]&&this.prevPlacement.placements[oe].text&&(fe=this.prevPlacement.variableOffsets[oe].anchor),this.variableOffsets[oe]={textOffset:X,width:m,height:y,anchor:s,textScale:x,prevAnchor:fe},this.markUsedJustification(q,s,V,W),q.allowVerticalPlacement&&(this.markUsedOrientation(q,W,V),this.placedOrientations[oe]=W),{shift:se,placedGlyphBoxes:he}}}placeLayerBucketPart(s,c,m,y){const{bucket:x,layout:C,posMatrix:T,textLabelPlaneMatrix:S,labelToScreenMatrix:O,clippingData:k,textPixelRatio:F,holdingForFade:V,collisionBoxArray:j,partiallyEvaluatedTextSize:q,partiallyEvaluatedIconSize:W,collisionGroup:Y}=s.parameters,G=C.get("text-optional"),J=C.get("icon-optional"),re=C.get("text-allow-overlap"),ee=C.get("icon-allow-overlap"),oe="map"===C.get("text-rotation-alignment"),X="map"===C.get("text-pitch-alignment"),se="viewport-y"===C.get("symbol-z-order"),he=C.get("symbol-z-elevate");this.transform.setProjection(x.projection);let fe=re&&(ee||!x.hasIconData()||J),ge=ee&&(re||!x.hasTextData()||G);!x.collisionArrays&&j&&x.deserializeCollisionBoxes(j),m&&y&&x.updateCollisionDebugBuffers(this.transform.zoom,j);const De=(ve,Pe,Ae)=>{const{crossTileID:qe,numVerticalGlyphVertices:xe}=ve;if(k){const yn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Nn=null;if(k.dynamicFilterNeedsFeature){const vn=this.retainedQueryData[x.bucketInstanceId];Nn=k.featureIndex.loadFeature({featureIndex:ve.featureIndex,bucketIndex:vn.bucketIndex,sourceLayerIndex:vn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,k.dynamicFilter)(yn,Nn,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new d.P(ve.tileAnchorX,ve.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[qe]=new Ss(!1,!1,!1,!0),void c.add(qe)}if(c.has(qe))return;if(V)return void(this.placements[qe]=new Ss(!1,!1,!1));let Se=!1,pe=!1,Ee=!0,He=!1,et=!1,Je=null,pt={box:null,offscreen:null,occluded:null},Mt={box:null,offscreen:null,occluded:null},zt=null,Ot=null,Dt=null,hn=0,Yt=0,en=0;Ae.textFeatureIndex?hn=Ae.textFeatureIndex:ve.useRuntimeCollisionCircles&&(hn=ve.featureIndex),Ae.verticalTextFeatureIndex&&(Yt=Ae.verticalTextFeatureIndex);const tn=yn=>{yn.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const Nn=this.transform.elevation;yn.elevation=ve.zOffset+(Nn?Nn.getAtTileOffset(yn.tileID,yn.tileAnchorX,yn.tileAnchorY):0)},Dn=Ae.textBox;if(Dn){tn(Dn);const yn=vn=>{let zn=d.b6.horizontal;if(x.allowVerticalPlacement&&!vn&&this.prevPlacement){const vi=this.prevPlacement.placedOrientations[qe];vi&&(this.placedOrientations[qe]=vi,zn=vi,this.markUsedOrientation(x,zn,ve))}return zn},Nn=(vn,zn)=>{if(x.allowVerticalPlacement&&xe>0&&Ae.verticalTextBox){for(const vi of x.writingModes)if(vi===d.b6.vertical?(pt=zn(),Mt=pt):pt=vn(),pt&&pt.box&&pt.box.length)break}else pt=vn()};if(C.get("text-variable-anchor")){let vn=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[qe]){const Rn=this.prevPlacement.variableOffsets[qe];vn.indexOf(Rn.anchor)>0&&(vn=vn.filter(Sr=>Sr!==Rn.anchor),vn.unshift(Rn.anchor))}const zn=(Rn,Sr,zr)=>{const bo=x.getSymbolInstanceTextSize(q,ve,this.transform.zoom,Pe),Oo=(Rn.x2-Rn.x1)*bo+2*Rn.padding,ko=(Rn.y2-Rn.y1)*bo+2*Rn.padding,Ei=ve.hasIconTextFit&&!ee?Sr:null;Ei&&tn(Ei);let mr={box:[],offscreen:!1,occluded:!1};const to=re?2*vn.length:vn.length;for(let no=0;no<to;++no){const Lo=this.attemptAnchorPlacement(vn[no%vn.length],Rn,Oo,ko,bo,oe,X,F,T,Y,no>=vn.length,ve,Pe,x,zr,Ei,q,W);if(Lo&&(mr=Lo.placedGlyphBoxes,mr&&mr.box&&mr.box.length)){Se=!0,Je=Lo.shift;break}}return mr};Nn(()=>zn(Dn,Ae.iconBox,d.b6.horizontal),()=>{const Rn=Ae.verticalTextBox;return Rn&&tn(Rn),x.allowVerticalPlacement&&!(pt&&pt.box&&pt.box.length)&&xe>0&&Rn?zn(Rn,Ae.verticalIconBox,d.b6.vertical):{box:null,offscreen:null,occluded:null}}),pt&&(Se=pt.box,Ee=pt.offscreen,He=pt.occluded);const vi=yn(!(!pt||!pt.box));if(!Se&&this.prevPlacement){const Rn=this.prevPlacement.variableOffsets[qe];Rn&&(this.variableOffsets[qe]=Rn,this.markUsedJustification(x,Rn.anchor,ve,vi))}}else{const vn=(zn,vi)=>{const Rn=x.getSymbolInstanceTextSize(q,ve,this.transform.zoom,Pe),Sr=this.collisionIndex.placeCollisionBox(x,Rn,zn,new d.P(0,0),re,F,T,Y.predicate);return Sr&&Sr.box&&Sr.box.length&&(this.markUsedOrientation(x,vi,ve),this.placedOrientations[qe]=vi),Sr};Nn(()=>vn(Dn,d.b6.horizontal),()=>{const zn=Ae.verticalTextBox;return x.allowVerticalPlacement&&xe>0&&zn?(tn(zn),vn(zn,d.b6.vertical)):{box:null,offscreen:null,occluded:null}}),yn(!!(pt&&pt.box&&pt.box.length))}}if(zt=pt,Se=zt&&zt.box&&zt.box.length>0,Ee=zt&&zt.offscreen,He=zt&&zt.occluded,ve.useRuntimeCollisionCircles){const yn=x.text.placedSymbolArray.get(ve.centerJustifiedTextSymbolIndex>=0?ve.centerJustifiedTextSymbolIndex:ve.verticalPlacedTextSymbolIndex),Nn=d.b7(x.textSizeData,q,yn),vn=C.get("text-padding");Ot=this.collisionIndex.placeCollisionCircles(x,re,yn,x.lineVertexArray,x.glyphOffsetArray,Nn,T,S,O,m,X,Y.predicate,ve.collisionCircleDiameter*Nn/d.bc,vn,this.retainedQueryData[x.bucketInstanceId].tileID),Se=re||Ot.circles.length>0&&!Ot.collisionDetected,Ee=Ee&&Ot.offscreen,He=Ot.occluded}if(Ae.iconFeatureIndex&&(en=Ae.iconFeatureIndex),Ae.iconBox){const yn=Nn=>{tn(Nn);const vn=ve.hasIconTextFit&&Je?Of(Je.x,Je.y,oe,X,this.transform.angle):new d.P(0,0),zn=x.getSymbolInstanceIconSize(W,this.transform.zoom,ve.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,zn,Nn,vn,ee,F,T,Y.predicate)};Mt&&Mt.box&&Mt.box.length&&Ae.verticalIconBox?(Dt=yn(Ae.verticalIconBox),pe=Dt.box.length>0):(Dt=yn(Ae.iconBox),pe=Dt.box.length>0),Ee=Ee&&Dt.offscreen,et=Dt.occluded}const gi=G||0===ve.numHorizontalGlyphVertices&&0===xe,En=J||0===ve.numIconVertices;if(gi||En?En?gi||(pe=pe&&Se):Se=pe&&Se:pe=Se=pe&&Se,Se&&zt&&zt.box&&this.collisionIndex.insertCollisionBox(zt.box,C.get("text-ignore-placement"),x.bucketInstanceId,Mt&&Mt.box&&Yt?Yt:hn,Y.ID),pe&&Dt&&this.collisionIndex.insertCollisionBox(Dt.box,C.get("icon-ignore-placement"),x.bucketInstanceId,en,Y.ID),Ot&&(Se&&this.collisionIndex.insertCollisionCircles(Ot.circles,C.get("text-ignore-placement"),x.bucketInstanceId,hn,Y.ID),m)){const yn=x.bucketInstanceId;let Nn=this.collisionCircleArrays[yn];void 0===Nn&&(Nn=this.collisionCircleArrays[yn]=new td);for(let vn=0;vn<Ot.circles.length;vn+=4)Nn.circles.push(Ot.circles[vn+0]),Nn.circles.push(Ot.circles[vn+1]),Nn.circles.push(Ot.circles[vn+2]),Nn.circles.push(Ot.collisionDetected?1:0)}const Vi="globe"!==x.projection.name;fe=fe&&(Vi||!He),ge=ge&&(Vi||!et),this.placements[qe]=new Ss(Se||fe,pe||ge,Ee||x.justReloaded),c.add(qe)};if(he&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),se){const ve=x.getSortedSymbolIndexes(this.transform.angle);for(let Pe=ve.length-1;Pe>=0;--Pe){const Ae=ve[Pe];De(x.symbolInstances.get(Ae),Ae,x.collisionArrays[Ae])}x.hasAnyZOffset&&d.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){const ve=x.getSortedIndexesByZOffset();for(let Pe=0;Pe<ve.length;++Pe){const Ae=ve[Pe];De(x.symbolInstances.get(Ae),Ae,x.collisionArrays[Ae])}}else for(let ve=s.symbolInstanceStart;ve<s.symbolInstanceEnd;ve++)De(x.symbolInstances.get(ve),ve,x.collisionArrays[ve]);if(m&&x.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[x.bucketInstanceId];d.a6.invert(ve.invProjMatrix,T),ve.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(s,c,m,y){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:S,crossTileID:O}=m,k=d.be(c),F=y===d.b6.vertical?S:"left"===k?x:"center"===k?C:"right"===k?T:-1;x>=0&&(s.text.placedSymbolArray.get(x).crossTileID=F>=0&&x!==F?0:O),C>=0&&(s.text.placedSymbolArray.get(C).crossTileID=F>=0&&C!==F?0:O),T>=0&&(s.text.placedSymbolArray.get(T).crossTileID=F>=0&&T!==F?0:O),S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=F>=0&&S!==F?0:O)}markUsedOrientation(s,c,m){const y=c===d.b6.horizontal||c===d.b6.horizontalOnly?c:0,x=c===d.b6.vertical?c:0,{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:O}=m,k=s.text.placedSymbolArray;C>=0&&(k.get(C).placedOrientation=y),T>=0&&(k.get(T).placedOrientation=y),S>=0&&(k.get(S).placedOrientation=y),O>=0&&(k.get(O).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(s):1,x=c?c.opacities:{},C=c?c.variableOffsets:{},T=c?c.placedOrientations:{};for(const S in this.placements){const O=this.placements[S],k=x[S];k?(this.opacities[S]=new sl(k,y,O.text,O.icon,null,O.clipped),m=m||O.text!==k.text.placed||O.icon!==k.icon.placed):(this.opacities[S]=new sl(null,y,O.text,O.icon,O.skipFade,O.clipped),m=m||O.text||O.icon)}for(const S in x){const O=x[S];if(!this.opacities[S]){const k=new sl(O,y,!1,!1);k.isHidden()||(this.opacities[S]=k,m=m||O.text.placed||O.icon.placed)}}for(const S in C)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=C[S]);for(const S in T)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=T[S]);m?this.lastPlacementChangeTime=s:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:s)}updateLayerOpacities(s,c){const m=new Set;for(const y of c){const x=y.getBucket(s);x&&y.latestFeatureIndex&&s.fqid===x.layerIds[0]&&(this.updateBucketOpacities(x,m,y.collisionBoxArray),x.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,y.tileID),x.updateZOffset()))}}updateBucketOpacities(s,c,m){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const y=s.layers[0].layout,x=!!s.layers[0].dynamicFilter(),C=new sl(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),S=y.get("icon-allow-overlap"),O=y.get("text-variable-anchor"),k="map"===y.get("text-rotation-alignment"),F="map"===y.get("text-pitch-alignment"),V=new sl(null,0,T&&(S||!s.hasIconData()||y.get("icon-optional")),S&&(T||!s.hasTextData()||y.get("text-optional")),!0);!s.collisionArrays&&m&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(m);const j=(W,Y,G)=>{for(let J=0;J<Y/4;J++)W.opacityVertexArray.emplaceBack(G)};let q=0;for(let W=0;W<s.symbolInstances.length;W++){const Y=s.symbolInstances.get(W),{numHorizontalGlyphVertices:G,numVerticalGlyphVertices:J,crossTileID:re,numIconVertices:ee}=Y,oe=c.has(re);let X=this.opacities[re];oe?X=C:X||(X=V,this.opacities[re]=X),c.add(re);const se=G>0||J>0,he=ee>0,fe=this.placedOrientations[re],ge=fe===d.b6.vertical,De=fe===d.b6.horizontal||fe===d.b6.horizontalOnly;if(!se&&!he||X.isHidden()||q++,se){const ve=na(X.text);j(s.text,G,ge?al:ve),j(s.text,J,De?al:ve);const Pe=X.text.isHidden(),{leftJustifiedTextSymbolIndex:Ae,centerJustifiedTextSymbolIndex:qe,rightJustifiedTextSymbolIndex:xe,verticalPlacedTextSymbolIndex:Se}=Y,pe=s.text.placedSymbolArray,Ee=Pe||ge?1:0;Ae>=0&&(pe.get(Ae).hidden=Ee),qe>=0&&(pe.get(qe).hidden=Ee),xe>=0&&(pe.get(xe).hidden=Ee),Se>=0&&(pe.get(Se).hidden=Pe||De?1:0);const He=this.variableOffsets[re];He&&this.markUsedJustification(s,He.anchor,Y,fe);const et=this.placedOrientations[re];et&&(this.markUsedJustification(s,"left",Y,et),this.markUsedOrientation(s,et,Y))}if(he){const ve=na(X.icon),{placedIconSymbolIndex:Pe,verticalPlacedIconSymbolIndex:Ae}=Y,qe=s.icon.placedSymbolArray,xe=X.icon.isHidden()?1:0;Pe>=0&&(j(s.icon,ee,ge?al:ve),qe.get(Pe).hidden=xe),Ae>=0&&(j(s.icon,Y.numVerticalIconVertices,De?al:ve),qe.get(Ae).hidden=xe)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const ve=s.collisionArrays[W];if(ve){let Pe=new d.P(0,0),Ae=!0;if(ve.textBox||ve.verticalTextBox){if(O){const xe=this.variableOffsets[re];xe?(Pe=Ao(xe.anchor,xe.width,xe.height,xe.textOffset,xe.textScale),k&&Pe._rotate(F?this.transform.angle:-this.transform.angle)):Ae=!1}x&&(Ae=!X.clipped),ve.textBox&&Fl(s.textCollisionBox.collisionVertexArray,X.text.placed,!Ae||ge,Pe.x,Pe.y),ve.verticalTextBox&&Fl(s.textCollisionBox.collisionVertexArray,X.text.placed,!Ae||De,Pe.x,Pe.y)}const qe=Ae&&!(De||!ve.verticalIconBox);ve.iconBox&&Fl(s.iconCollisionBox.collisionVertexArray,X.icon.placed,qe,Y.hasIconTextFit?Pe.x:0,Y.hasIconTextFit?Pe.y:0),ve.verticalIconBox&&Fl(s.iconCollisionBox.collisionVertexArray,X.icon.placed,!qe,Y.hasIconTextFit?Pe.x:0,Y.hasIconTextFit?Pe.y:0)}}}if(s.fullyClipped=0===q,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const W=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=W.invProjMatrix,s.placementViewportMatrix=W.viewportMatrix,s.collisionCircleArray=W.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return 0===this.fadeDuration?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>s}setStale(){this.stale=!0}}function Fl(p,s,c,m,y){p.emplaceBack(s?1:0,c?1:0,m||0,y||0),p.emplaceBack(s?1:0,c?1:0,m||0,y||0),p.emplaceBack(s?1:0,c?1:0,m||0,y||0),p.emplaceBack(s?1:0,c?1:0,m||0,y||0)}const Xt=Math.pow(2,25),Ru=Math.pow(2,24),id=Math.pow(2,17),Nl=Math.pow(2,16),P_=Math.pow(2,9),O_=Math.pow(2,8),k_=Math.pow(2,1);function na(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const s=p.placed?1:0,c=Math.floor(127*p.opacity);return c*Xt+s*Ru+c*id+s*Nl+c*P_+s*O_+c*k_+s}const al=0;class As{constructor(s){this._sortAcrossTiles="viewport-y"!==s.layout.get("symbol-z-order")&&void 0!==s.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,c,m,y,x){const C=this._bucketParts;for(;this._currentTileIndex<s.length;)if(c.getBucketParts(C,y,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((T,S)=>T.sortKey-S.sortKey));this._currentPartIndex<C.length;){const T=C[this._currentPartIndex];if(c.placeLayerBucketPart(T,this._seenCrossTileIDs,m,0===T.symbolInstanceStart),this._currentPartIndex++,x())return!0}return!1}}class qo{constructor(s,c,m,y,x,C,T,S,O){this.placement=new Qe(s,x,C,T,S,O),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(s,c,m,y){const x=d.f.now(),C=()=>{const T=d.f.now()-x;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=c[s[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===T.type&&(!T.minzoom||T.minzoom<=S)&&(!T.maxzoom||T.maxzoom>S)){const O=T,k=O.layout.get("symbol-z-elevate"),F=this._inProgressLayer=this._inProgressLayer||new As(O),V=d.ag(T.source,T.scope);if(F.continuePlacement(k?y[V]:m[V],this.placement,this._showCollisionBoxes,T,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const wi=512/d.V/2;class Pu{constructor(s,c,m){this.tileID=s,this.bucketInstanceId=m,this.index=new d.bg(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=s.canonical.x*d.V,x=s.canonical.y*d.V;for(let C=0;C<c.length;C++){const{key:T,crossTileID:S,tileAnchorX:O,tileAnchorY:k}=c.get(C),F=Math.floor((y+O)*wi),V=Math.floor((x+k)*wi);this.index.add(F,V),this.keys.push(T),this.crossTileIDs.push(S)}this.index.finish()}findMatches(s,c,m){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),x=wi/Math.pow(2,c.canonical.z-this.tileID.canonical.z),C=c.canonical.x*d.V,T=c.canonical.y*d.V;for(let S=0;S<s.length;S++){const O=s.get(S);if(O.crossTileID)continue;const{key:k,tileAnchorX:F,tileAnchorY:V}=O,j=Math.floor((C+F)*x),q=Math.floor((T+V)*x),W=this.index.range(j-y,q-y,j+y,q+y);for(const Y of W){const G=this.crossTileIDs[Y];if(this.keys[Y]===k&&!m.has(G)){m.add(G),O.crossTileID=G;break}}}}}class Ou{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class kc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const c=Math.round((s-this.lng)/360);if(0!==c)for(const m in this.indexes){const y=this.indexes[m],x={};for(const C in y){const T=y[C];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+c),x[T.tileID.key]=T}this.indexes[m]=x}this.lng=s}addBucket(s,c,m){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const y=this.usedCrossTileIDs[s.overscaledZ];for(const x in this.indexes){const C=this.indexes[x];if(Number(x)>s.overscaledZ)for(const T in C){const S=C[T];S.tileID.isChildOf(s)&&S.findMatches(c.symbolInstances,s,y)}else{const T=C[s.scaledTo(Number(x)).key];T&&T.findMatches(c.symbolInstances,s,y)}}for(let x=0;x<c.symbolInstances.length;x++){const C=c.symbolInstances.get(x);C.crossTileID||(C.crossTileID=m.generate(),y.add(C.crossTileID))}return void 0===this.indexes[s.overscaledZ]&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Pu(s,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(s,c){for(const m of c.crossTileIDs)this.usedCrossTileIDs[s].delete(m)}removeStaleBuckets(s){let c=!1;for(const m in this.indexes){const y=this.indexes[m];for(const x in y)s[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[x]),delete y[x],c=!0)}return c}}class rd{constructor(){this.layerIndexes={},this.crossTileIDs=new Ou,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,c,m,y){let x=this.layerIndexes[s.fqid];void 0===x&&(x=this.layerIndexes[s.fqid]=new kc);let C=!1;const T={};"globe"!==y.name&&x.handleWrapJump(m);for(const S of c){const O=S.getBucket(s);O&&s.fqid===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(S.tileID,O,this.crossTileIDs)&&(C=!0),T[O.bucketInstanceId]=!0)}return x.removeStaleBuckets(T)&&(C=!0),C}pruneUnusedLayers(s){const c={};s.forEach(m=>{c[m]=!0});for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}class go{constructor(s=0,c=0,m=0,y=0){if(isNaN(s)||s<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=c,this.left=m,this.right=y}interpolate(s,c,m){return null!=c.top&&null!=s.top&&(this.top=d.U(s.top,c.top,m)),null!=c.bottom&&null!=s.bottom&&(this.bottom=d.U(s.bottom,c.bottom,m)),null!=c.left&&null!=s.left&&(this.left=d.U(s.left,c.left,m)),null!=c.right&&null!=s.right&&(this.right=d.U(s.right,c.right,m)),this}getCenter(s,c){const m=d.aa((this.left+s-this.right)/2,0,s),y=d.aa((this.top+c-this.bottom)/2,0,c);return new d.P(m,y)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new go(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ll(p,s){const c=d.bk(p,3);d.a6.fromQuat(p,s),d.bm(p,3,c)}function Lc(p,s){const c=d.bi.identity([]);return d.bi.rotateZ(c,c,-s),d.bi.rotateX(c,c,-p),c}function od(p,s){const c=[p[0],p[1],0],m=[s[0],s[1],0];if(d.N.length(c)>=1e-15){const C=d.N.normalize([],c);d.N.scale(m,C,d.N.dot(m,C)),s[0]=m[0],s[1]=m[1]}const y=d.N.cross([],s,p);if(d.N.len(y)<1e-15)return null;const x=Math.atan2(-y[1],y[0]);return Lc(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),x)}class zl{constructor(s,c){this.position=s,this.orientation=c}get position(){return this._position}set position(s){if(s){const c=s instanceof d.L?s:new d.L(s[0],s[1],s[2]);this._renderWorldCopies&&(c.x=d.bh(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(s,c){if(this.orientation=null,!this.position)return;const m=this.position,y=this._elevation?this._elevation.getAtPointOrZero(d.L.fromLngLat(s)):0,x=d.L.fromLngLat(s,y),C=[x.x-m.x,x.y-m.y,x.z-m.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=od(C,c)}setPitchBearing(s,c){this.orientation=Lc(d.bj(s),d.bj(-c))}}class Bl{constructor(s,c){this._transform=d.a6.identity([]),this.orientation=c,this.position=s}get mercatorPosition(){const s=this.position;return new d.L(s[0],s[1],s[2])}get position(){const s=d.bk(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var c;s&&d.bm(this._transform,3,[(c=s)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||d.bi.identity([]),s&&ll(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,c){this._orientation=Lc(s,c),ll(this._transform,this._orientation)}forward(){const s=d.bk(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=d.bk(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=d.bk(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,c){const m=new Float64Array(16);return d.a6.invert(m,this.getWorldToCamera(s,c)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,c,m){const y=this.position;d.N.scale(y,y,-s);const x=new Float64Array(16);return d.a6.fromScaling(x,[m,m,m]),d.a6.translate(x,x,y),x[10]*=c,x}getWorldToCamera(s,c){const m=new Float64Array(16),y=new Float64Array(4),x=this.position;return d.bi.conjugate(y,this._orientation),d.N.scale(x,x,-s),d.a6.fromQuat(m,y),d.a6.translate(m,m,x),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(s,c,m,y){const x=new Float64Array(16);return d.a6.perspective(x,s,c,m,y),x}getCameraToClipOrthographic(s,c,m,y,x,C){const T=new Float64Array(16);return d.a6.ortho(T,s,c,m,y,x,C),T}getDistanceToElevation(s,c=!1){const m=0===s?0:d.bl(s,c?d.au(this.position[1]):this.position[1]),y=this.forward();return(m-this.position[2])/y[2]}clone(){return new Bl([...this.position],[...this.orientation])}}const Vl=(p,s,c)=>(1-c)*p+c*s,Aa=p=>p*p*p*p*p;class Fc{constructor(s,c,m,y,x,C,T){this.tileSize=512,this._renderWorldCopies=void 0===x||x,this._minZoom=s||0,this._maxZoom=c||22,this._minPitch=m??0,this._maxPitch=y??60,this.setProjection(C),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new d.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new go,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Bl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const s=new Fc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(s,c=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||m)&&this._updateCameraOnTerrain(),(s||m)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return d.ac(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=d.bo(this.projectionOptions);const m=!Zt(c,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=d.bo({name:"mercator"});const c=s!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(s){void 0===s?s=!0:null===s&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return d.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return d.bh(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const c=-s*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=d.b4.create(),d.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const c=d.aa(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=d.bj(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const c=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){const s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const m=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let y=0,x=0;for(let C=0;C<c.length;C++){const T=new d.P(c[C][0]*this.width,m+c[C][1]*(this.height-m)),S=s.pointCoordinate(T);if(!S)continue;const O=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);y+=S[3]*O,x+=O}return 0===x?NaN:y/x}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const s=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(s),x=this._mercatorZfromZoom(this._maxZoom),C=Math.max(y-m,x);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let m;m=s.z<this._camera.position[2]?[c.x,c.y,c.z]:[s.x,s.y,s.z];const y=d.N.length(d.N.sub([],this._camera.position,m));return d.aa(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let c=!1;if(s.orientation&&!d.bi.exactEquals(s.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(s.orientation)),s.position){const m=[s.position.x,s.position.y,s.position.z];d.N.exactEquals(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,c=new zl;return c.position=new d.L(s[0],s[1],s[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(s){if(!d.bi.length(s))return!1;d.bi.normalize(s,s);const c=d.N.transformQuat([],[0,0,-1],s),m=d.N.transformQuat([],[0,-1,0],s);if(m[2]<0)return!1;const y=od(c,m);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(s){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;s[2]=d.aa(s[2],y/m,y/c),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,c,m){this._unmodified=!1,this._edgeInsets.interpolate(s,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const c=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(s){const c=[new d.bp(0,s)];if(this.renderWorldCopies){const m=this.pointCoordinate(new d.P(0,0)),y=this.pointCoordinate(new d.P(this.width,0)),x=this.pointCoordinate(new d.P(this.width,this.height)),C=this.pointCoordinate(new d.P(0,this.height)),T=Math.floor(Math.min(m.x,y.x,x.x,C.x)),S=Math.floor(Math.max(m.x,y.x,x.x,C.x)),O=1;for(let k=T-O;k<=S+O;k++)0!==k&&c.push(new d.bp(k,s))}return c}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(s,c,m){let y=[];if(0===c[0]&&0===c[1])return y;for(const C of s){const T=C.canonical,S=C.overscaledZ,O=C.wrap,k=1<<T.z,F=T.x+1<k,V=T.x>0,j=T.y+1<k,q=T.y>0,W=C.wrap-(V?0:1),Y=C.wrap+(F?0:1),G=V?T.x-1:k-1,J=F?T.x+1:0;c[0]<0?(y.push(new d.am(S,Y,T.z,J,T.y)),c[1]<0&&j&&(y.push(new d.am(S,O,T.z,T.x,T.y+1)),y.push(new d.am(S,Y,T.z,J,T.y+1))),c[1]>0&&q&&(y.push(new d.am(S,O,T.z,T.x,T.y-1)),y.push(new d.am(S,Y,T.z,J,T.y-1)))):c[0]>0?(y.push(new d.am(S,W,T.z,G,T.y)),c[1]<0&&j&&(y.push(new d.am(S,O,T.z,T.x,T.y+1)),y.push(new d.am(S,W,T.z,G,T.y+1))),c[1]>0&&q&&(y.push(new d.am(S,O,T.z,T.x,T.y-1)),y.push(new d.am(S,W,T.z,G,T.y-1)))):c[1]<0&&j?y.push(new d.am(S,O,T.z,T.x,T.y+1)):q&&y.push(new d.am(S,O,T.z,T.x,T.y-1))}if(y.length>1){y.sort((S,O)=>S.overscaledZ-O.overscaledZ||S.wrap-O.wrap||S.canonical.z-O.canonical.z||S.canonical.x-O.canonical.x||S.canonical.y-O.canonical.y);let C=0,T=0;for(;T<y.length;)y[T].equals(y[C])?++T:y[++C]=y[T++];y.length=C+1}const x=[];for(const C of y)y.some(T=>C.isChildOf(T))||x.push(C);return y=x.filter(C=>!s.some(T=>!!(C.overscaledZ<m&&T.isChildOf(C))||C.equals(T)||C.isChildOf(T))),y}coveringTiles(s){let c=this.coveringZoomLevel(s);const m=c,y=this.elevation&&this.elevation.exaggeration(),x=y&&!s.isTerrainDEM,C="mercator"===this.projection.name;if(void 0!==s.minzoom&&c<s.minzoom)return[];void 0!==s.maxzoom&&c>s.maxzoom&&(c=s.maxzoom);const T=this.locationCoordinate(this.center),S=this.center.lat,O=1<<c,k=[O*T.x,O*T.y,0],F="globe"===this.projection.name,V=!F,j=d.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,V),q=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=O*d.bl(1,this.center.lat),Y=this._camera.position[2]/d.bl(1,this.center.lat),G=[O*q.x,O*q.y,Y*(V?1:W)],J=F||y,re=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),ee=this.isLODDisabled(!0)?c:0;let oe;if(this._elevation&&s.isTerrainDEM)oe=1e4*this._elevation.exaggeration();else if(this._elevation){const pe=this._elevation.getMinMaxForVisibleTiles();oe=pe?pe.max:this._centerAltitude}else oe=this._centerAltitude;const X=s.isTerrainDEM?-oe:this._elevation?this._elevation.getMinElevationBelowMSL():0,se=this.projection.isReprojectedInTileSpace?d.br(this):1,he=pe=>{const He=new d.L(pe.x+25e-6,pe.y,pe.z),et=new d.L(pe.x,pe.y+25e-6,pe.z),Je=pe.toLngLat(),pt=He.toLngLat(),Mt=et.toLngLat(),zt=this.locationCoordinate(Je),Ot=this.locationCoordinate(pt),Dt=this.locationCoordinate(Mt),hn=Math.hypot(Ot.x-zt.x,Ot.y-zt.y),Yt=Math.hypot(Dt.x-zt.x,Dt.y-zt.y);return Math.sqrt(hn*Yt)*se/25e-6},fe=pe=>{const Ee=oe,He=X;return{aabb:d.bu(this,O,0,0,0,pe,He,Ee,this.projection),zoom:0,x:0,y:0,minZ:He,maxZ:Ee,wrap:pe,fullyVisible:!1}},ge=[];let De=[];const ve=c,Pe=s.reparseOverscaled?m:c,Ae=pe=>pe*pe,qe=Ae((Y-this._centerAltitude)*W),xe=pe=>{if(!this._elevation||!pe.tileID||!C)return;const Ee=this._elevation.getMinMaxForTile(pe.tileID),He=pe.aabb;Ee?(He.min[2]=Ee.min,He.max[2]=Ee.max,He.center[2]=(He.min[2]+He.max[2])/2):(pe.shouldSplit=Se(pe),pe.shouldSplit||(He.min[2]=He.max[2]=He.center[2]=this._centerAltitude))},Se=pe=>{if(pe.zoom<ee)return!0;if(pe.zoom===ve)return!1;if(null!=pe.shouldSplit)return pe.shouldSplit;const Ee=pe.aabb.distanceX(G),He=pe.aabb.distanceY(G);let et=qe,Je=1;if(F){et=Ae(pe.aabb.distanceZ(G));const zt=Math.pow(2,pe.zoom),Ot=d.au((pe.y+1)/zt),Dt=d.au(pe.y/zt),hn=Math.min(Math.max(S,Ot),Dt),Yt=d.bJ(hn)/d.bJ(S);if(Je=hn===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Yt/this._mercatorScaleRatio),this.zoom<=d.bG&&pe.zoom===ve-1&&Yt>=.9)return!0}else if(x&&(et=Ae(pe.aabb.distanceZ(G)*W)),this.projection.isReprojectedInTileSpace&&m<=5){const zt=Math.pow(2,pe.zoom),Ot=he(new d.L((pe.x+.5)/zt,(pe.y+.5)/zt));Je=Ot>.85?1:Ot}const pt=Ee*Ee+He*He+et;return pt<Ae((1<<ve-pe.zoom)*re*Je*((zt,Ot)=>{if(Ot*Ae(.707)<zt)return 1;const Dt=Math.sqrt(Ot/zt);return Dt/(1.4144271570014144+(Math.pow(1.1,Dt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(et,qe),pt))};if(this.renderWorldCopies)for(let pe=1;pe<=3;pe++)ge.push(fe(-pe)),ge.push(fe(pe));for(ge.push(fe(0));ge.length>0;){const pe=ge.pop(),Ee=pe.x,He=pe.y;let et=pe.fullyVisible;const Je=()=>"globe"===this.projection.name&&(0===pe.y||pe.y===(1<<pe.zoom)-1);if(!et){let pt=J?pe.aabb.intersects(j):pe.aabb.intersectsFlat(j);if(0===pt&&Je()){const Mt=new d.bs(pe.zoom,Ee,He);pt=d.bt(this,O,Mt,!0).intersects(j)}if(0===pt)continue;et=2===pt}if(pe.zoom!==ve&&Se(pe))for(let pt=0;pt<4;pt++){const Mt=(Ee<<1)+pt%2,zt=(He<<1)+(pt>>1),Ot={aabb:C?pe.aabb.quadrant(pt):d.bu(this,O,pe.zoom+1,Mt,zt,pe.wrap,pe.minZ,pe.maxZ,this.projection),zoom:pe.zoom+1,x:Mt,y:zt,wrap:pe.wrap,fullyVisible:et,tileID:void 0,shouldSplit:void 0,minZ:pe.minZ,maxZ:pe.maxZ};x&&!F&&(Ot.tileID=new d.am(pe.zoom+1===ve?Pe:pe.zoom+1,pe.wrap,pe.zoom+1,Mt,zt),xe(Ot)),ge.push(Ot)}else{const pt=pe.zoom===ve?Pe:pe.zoom;if(s.minzoom&&s.minzoom>pt)continue;if(!et){let Dt=J?pe.aabb.intersectsPrecise(j):pe.aabb.intersectsPreciseFlat(j);if(0===Dt&&Je()){const hn=new d.bs(pe.zoom,Ee,He);Dt=d.bt(this,O,hn,!0).intersectsPrecise(j)}if(0===Dt)continue}const Mt=k[0]-(.5+Ee+(pe.wrap<<pe.zoom))*(1<<c-pe.zoom),zt=k[1]-.5-He,Ot=pe.tileID?pe.tileID:new d.am(pt,pe.wrap,pe.zoom,Ee,He);De.push({tileID:Ot,distanceSq:Mt*Mt+zt*zt})}}if(this.fogCullDistSq){const pe=this.fogCullDistSq,Ee=this.horizonLineFromTop();De=De.filter(He=>{const et=[0,0,0,1],Je=[d.V,d.V,0,1],pt=this.calculateFogTileMatrix(He.tileID.toUnwrapped());d.a7.transformMat4(et,et,pt),d.a7.transformMat4(Je,Je,pt);const Mt=d.a7.min([],et,Je),zt=d.a7.max([],et,Je),Ot=d.bv(Mt,zt);if(0===Ot)return!0;let Dt=!1;const hn=this._elevation;if(hn&&Ot>pe&&0!==Ee){const Yt=this.calculateProjMatrix(He.tileID.toUnwrapped());let en;s.isTerrainDEM||(en=hn.getMinMaxForTile(He.tileID)),en||(en={min:X,max:oe});const tn=d.bH(this.rotation),Dn=[tn[0]*d.V,tn[1]*d.V,en.max];d.N.transformMat4(Dn,Dn,Yt),Dt=(1-Dn[1])*this.height*.5<Ee}return Ot<pe||Dt})}return De.sort((pe,Ee)=>pe.distanceSq-Ee.distanceSq).map(pe=>pe.tileID)}resize(s,c){this.width=s,this.height=c,this.pixelsToGLUnits=[2/s,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const c=d.aa(s.lat,-d.bw,d.bw),m=this.projection.project(s.lng,c);return new d.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/d.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,c){let m,y;const x=this.centerPoint;if("globe"===this.projection.name){const T=this.worldSize;m=(c.x-x.x)/T,y=(c.y-x.y)/T}else{const T=this.pointCoordinate(c),S=this.pointCoordinate(x);m=T.x-S.x,y=T.y-S.y}const C=this.locationCoordinate(s);this.setLocation(new d.L(C.x-m,C.y-y))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,c){const m=c?d.bl(c,s.lat):void 0,y=this.projection.project(s.lng,s.lat);return new d.L(y.x,y.y,m)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,c){const m=c??this._centerAltitude,y=[s.x,s.y,0,1],x=[s.x,s.y,1,1];d.a7.transformMat4(y,y,this.pixelMatrixInverse),d.a7.transformMat4(x,x,this.pixelMatrixInverse);const C=x[3];d.a7.scale(y,y,1/y[3]),d.a7.scale(x,x,1/C);const T=y[2],S=x[2];return{p0:y,p1:x,t:T===S?0:(m-T)/(S-T)}}screenPointToMercatorRay(s){const c=[s.x,s.y,0,1],m=[s.x,s.y,1,1];return d.a7.transformMat4(c,c,this.pixelMatrixInverse),d.a7.transformMat4(m,m,this.pixelMatrixInverse),d.a7.scale(c,c,1/c[3]),d.a7.scale(m,m,1/m[3]),c[2]=d.bl(c[2],this._center.lat)*this.worldSize,m[2]=d.bl(m[2],this._center.lat)*this.worldSize,d.a7.scale(c,c,1/this.worldSize),d.a7.scale(m,m,1/this.worldSize),new d.a2([c[0],c[1],c[2]],d.N.normalize([],d.N.sub([],m,c)))}rayIntersectionCoordinate(s){const{p0:c,p1:m,t:y}=s,x=d.bl(c[2],this._center.lat),C=d.bl(m[2],this._center.lat);return new d.L(d.U(c[0],m[0],y)/this.worldSize,d.U(c[1],m[1],y)/this.worldSize,d.U(x,C,y))}pointCoordinate(s,c=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,c)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let c=this.projection.pointCoordinate3D(this,s.x,s.y);if(c)return new d.L(c[0],c[1],c[2]);let m=0,y=this.horizonLineFromTop();if(s.y>y)return this.pointCoordinate(s);const x=.02*y,C=s.clone();for(let T=0;T<10&&y-m>x;T++){C.y=d.U(m,y,.66);const S=this.projection.pointCoordinate3D(this,C.x,C.y);S?(y=C.y,c=S):m=C.y}return c?new d.L(c[0],c[1],c[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=d.bx)return!this.isPointAboveHorizon(s);const c=this.pointCoordinate(s);return c.y>=0&&c.y<=1}_coordinatePoint(s,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,y=[s.x*this.worldSize,s.y*this.worldSize,m+s.toAltitude(),1];return d.a7.transformMat4(y,y,this.pixelMatrix),y[3]>0?new d.P(y[0]/y[3],y[1]/y[3]):new d.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:c}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,x=this.pointLocation3D(new d.P(c,s)),C=this.pointLocation3D(new d.P(y,s)),T=this.pointLocation3D(new d.P(y,m)),S=this.pointLocation3D(new d.P(c,m));let O=Math.min(x.lng,C.lng,T.lng,S.lng),k=Math.max(x.lng,C.lng,T.lng,S.lng),F=Math.min(x.lat,C.lat,T.lat,S.lat),V=Math.max(x.lat,C.lat,T.lat,S.lat);const j=Math.pow(2,-this.zoom)/16*270,q="globe"===this.projection.name?1:4,W=(Y,G,J,re,ee)=>{const oe=(Y+J)/2,X=(G+re)/2,se=new d.P(oe,X),{lng:he,lat:fe}=this.pointLocation3D(se),ge=Math.max(0,O-he,F-fe,he-k,fe-V);O=Math.min(O,he),k=Math.max(k,he),F=Math.min(F,fe),V=Math.max(V,fe),(ee<q||ge>j)&&(W(Y,G,oe,X,ee+1),W(oe,X,J,re,ee+1))};if(W(c,s,y,s,1),W(y,s,y,m,1),W(y,m,c,m,1),W(c,m,c,s,1),"globe"===this.projection.name){const[Y,G]=d.by(this);Y?(V=90,k=180,O=-180):G&&(F=-90,k=180,O=-180)}return new d.ad(new d.bn(O,F),new d.bn(k,V))}_getBoundsRectangular(s,c){const{top:m,left:y}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,T=new d.P(y,m),S=new d.P(C,m),O=new d.P(C,x),k=new d.P(y,x);let F=this.pointCoordinate(T,s),V=this.pointCoordinate(S,s);const j=this.pointCoordinate(O,c),q=this.pointCoordinate(k,c),W=(Y,G)=>(G.y-Y.y)/(G.x-Y.x);return F.y>1&&V.y>=0?F=new d.L((1-q.y)/W(q,F)+q.x,1):F.y<0&&V.y<=1&&(F=new d.L(-q.y/W(q,F)+q.x,0)),V.y>1&&F.y>=0?V=new d.L((1-j.y)/W(j,V)+j.x,1):V.y<0&&F.y<=1&&(V=new d.L(-j.y/W(j,V)+j.x,0)),(new d.ad).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=s.visibleDemTiles.reduce((m,y)=>{if(y.dem){const x=y.dem.tree;m.min=Math.min(m.min,x.minimums[0]),m.max=Math.max(m.max,x.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*s.exaggeration(),c.max*s.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return s?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-d.bw,this.maxLat=d.bw,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=d.a5(this.minLng)*this.tileSize,this.worldMaxX=d.a5(this.maxLng)*this.tileSize,this.worldMinY=d.ae(this.maxLat)*this.tileSize,this.worldMaxY=d.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,c){return this.projection.createTileMatrix(this,c,s)}calculateDistanceTileData(s){const c=s.key,m=this._distanceTileDataCache;if(m[c])return m[c];const y=s.canonical,x=1/this.height,C=this.cameraWorldSize,T=C/this.zoomScale(y.z),S=(y.x+Math.pow(2,y.z)*s.wrap)*T,O=y.y*T,k=this.point;k.x*=C/this.worldSize,k.y*=C/this.worldSize;const F=this.angle,V=Math.sin(-F),j=-Math.cos(-F);return m[c]={bearing:[V,j],center:[(k.x-S)*x,(k.y-O)*x],scale:T/d.V*x},m[c]}calculateFogTileMatrix(s){const c=s.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return d.a6.multiply(y,this.worldToFogMatrix,y),m[c]=new Float32Array(y),m[c]}calculateProjMatrix(s,c=!1,m=!1){const y=s.key;let x;if(x=m?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,x[y])return x[y];const C=this.calculatePosMatrix(s,this.worldSize);let T;return T=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,d.a6.multiply(C,T,C),x[y]=new Float32Array(C),x[y]}calculatePixelsToTileUnitsMatrix(s){const c=s.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const y=d.bz(s,this);return m[c]=y,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const s=1/this.worldSize,c=d.a6.fromScaling([],[s,s,s]);return d.a6.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const s=this._elevation;this._updateCameraState();const c=d.bl(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),y=this._camera.forward(),x=d.bl(1,this._center.lat);m[2]/=x,y[2]/=x,d.N.normalize(y,y);const C=s.raycast(m,y,s.exaggeration());if(C){const T=d.N.scaleAndAdd([],m,y,C),S=new d.L(T[0],T[1],d.bl(T[2],d.au(T[1]))),O=(S.z+d.N.length([S.x-m[0],S.y-m[1],S.z-m[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const c=this._elevation,m=d.bl(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(m),x=c.getAtPointOrZero(new d.L(...y)),C=this.pixelsPerMeter/this.worldSize*x,T=this._minimumHeightOverTerrain(),S=y[2]-C;if(S<=T)if(S<0||s){const O=this.locationCoordinate(this._center,this._centerAltitude),k=[y[0],y[1],O.z-y[2]],F=d.N.length(k);k[2]-=(T-S)/this._pixelsPerMercatorPixel;const V=d.N.length(k);if(0===V)return;d.N.scale(k,k,F/V*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],O.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const V=this.center;return V.lat=d.aa(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(V.lng=d.aa(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const c=this._unmodified,{x:m,y}=this.point;let x=0,C=m,T=y;const S=this.width/2,O=this.height/2,k=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(y-O<k&&(T=k+O),y+O>F&&(T=F-O),F-k<this.height&&(x=Math.max(x,this.height/(F-k)),T=(F+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,q=this.worldSize/2-(V+j)/2;C=(m+q+this.worldSize)%this.worldSize-q,C-S<V&&(C=V+S),C+S>j&&(C=j-S),j-V<this.width&&(x=Math.max(x,this.width/(j-V)),C=(j+V)/2)}C===m&&T===y||(this.center=this.unproject(new d.P(C,T))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,c="globe"===this.projection.name,m=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=d.bl(1,this.center.lat)/d.bl(1,d.bI));const y=d.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x="meters"===this.projection.zAxisUnit?m:1,C=this._camera.getWorldToCamera(this.worldSize,x);let T;const S=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(S[8]=2*-s.x/this.width,S[9]=2*s.y/this.height,this.isOrthographic){let fe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ge=fe*this.aspect,De=-ge,ve=-fe;ge-=s.x,De-=s.x,fe+=s.y,ve+=s.y,T=this._camera.getCameraToClipOrthographic(De,ge,ve,fe,this._nearZ,this._farZ),((Pe,Ae,qe,xe)=>{for(let Se=0;Se<16;Se++)Pe[Se]=Vl(Ae[Se],qe[Se],xe)})(T,T,S,Aa(this.pitch>=15?1:this.pitch/15))}else T=S;const O=d.a6.mul([],S,C);let k=d.a6.mul([],T,C);if(this.projection.isReprojectedInTileSpace){const fe=this.locationCoordinate(this.center),ge=d.a6.identity([]);d.a6.translate(ge,ge,[fe.x*this.worldSize,fe.y*this.worldSize,0]),d.a6.multiply(ge,ge,d.bB(this)),d.a6.translate(ge,ge,[-fe.x*this.worldSize,-fe.y*this.worldSize,0]),d.a6.multiply(k,k,ge),d.a6.multiply(O,O,ge),this.inverseAdjustmentMatrix=d.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=d.a6.scale([],k,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=k,this.invProjMatrix=d.a6.invert(new Float64Array(16),this.projMatrix),c){const fe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);fe[8]=2*-s.x/this.width,fe[9]=2*s.y/this.height,this.expandedFarZProjMatrix=d.a6.mul([],fe,C)}else this.expandedFarZProjMatrix=this.projMatrix;const F=d.a6.invert([],T);this.frustumCorners=d.bD.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=d.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const V=new Float32Array(16);d.a6.identity(V),d.a6.scale(V,V,[1,-1,1]),d.a6.rotateX(V,V,this._pitch),d.a6.rotateZ(V,V,this.angle);const j=d.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=d.a6.clone(j);const q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-s.x/this.width,j[9]=2*(s.y+q)/this.height,this.skyboxMatrix=d.a6.multiply(V,j,V);const W=this.point,Y=W.x,G=W.y,J=this.width%2/2,re=this.height%2/2,ee=Math.cos(this.angle),oe=Math.sin(this.angle),X=Y-Math.round(Y)+ee*J+oe*re,se=G-Math.round(G)+ee*re+oe*J,he=new Float64Array(k);if(d.a6.translate(he,he,[X>.5?X-1:X,se>.5?se-1:se,0]),this.alignedProjMatrix=he,k=d.a6.create(),d.a6.scale(k,k,[this.width/2,-this.height/2,1]),d.a6.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=d.a6.create(),d.a6.scale(k,k,[1,-1,1]),d.a6.translate(k,k,[-1,-1,0]),d.a6.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=d.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,O),this._calcFogMatrices(),this._distanceTileDataCache={},k=d.a6.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=d.bE(this);const fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=d.N.transformMat4(fe,fe,C),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,m=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,x=[s,s,c];d.N.scale(x,x,y),d.N.scale(m,m,-1),d.N.multiply(m,m,x);const C=d.a6.create();d.a6.translate(C,C,m),d.a6.scale(C,C,x),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,c,y)}_computeCameraPosition(s){const c=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),y=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-s/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-m[0]*x,y.y/this.worldSize-m[1]*x,s/this.worldSize*this._centerAltitude-m[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],y=s[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(x=Math.min((c-m)/y,1)),this._camera.position=d.N.scaleAndAdd([],this._camera.position,s,x),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:y}=this._camera.getPitchBearing(),x=d.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.bj(this._maxPitch)),T=Math.max((s[2]-x)/Math.cos(m),C),S=this._zoomFromMercatorZ(T);d.N.scaleAndAdd(s,s,c,T),this._pitch=d.aa(m,d.bj(this.minPitch),d.bj(this.maxPitch)),this.angle=d.bh(y,-Math.PI,Math.PI),this._setZoom(d.aa(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new d.L(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let c=0,m=d.bx,y=0,x=1/0;for(;m-c>1e-6&&m>c;){const C=c+.5*(m-c),T=this.tileSize*Math.pow(2,C),S=this.getCameraToCenterDistance(this.projection,C,T),O=this.scaleZoom(S/(s*this.tileSize)),k=Math.abs(C-O);k<x&&(x=k,y=C),C<O?c=C:m=C}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(d.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,c){const m=Math.min(s.x,c.x),y=Math.max(s.x,c.x),x=Math.min(s.y,c.y),C=Math.max(s.y,c.y);if(x<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const T=[new d.P(m,x),new d.P(y,C),new d.P(m,C),new d.P(y,x)],S=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const k of T){const F=this.pointRayIntersection(k);if(F.t<0)return!0;const V=this.rayIntersectionCoordinate(F);if(V.x<S||V.y<0||V.x>O||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new d.P(0,0),new d.P(this.width,this.height))}zoomDeltaToMovement(s,c){const m=d.N.length(d.N.sub([],this._camera.position,s)),y=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(y)}getCameraPoint(){if("globe"===this.projection.name){const s=function([c,m,y],x){const C=[c,m,y,1];d.a7.transformMat4(C,C,x);const T=C[3]=Math.max(C[3],1e-6);return C[0]/=T,C[1]/=T,C[2]/=T,C}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new d.P(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,s))}}getCameraToCenterDistance(s,c=this.zoom,m=this.worldSize){const y=d.bA(s,c,this.width,this.height,1024),x=s.pixelSpaceConversion(this.center.lat,m,y);let C=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(C=Vl(1,C,Aa(this.pitch>=15?1:this.pitch/15))),C}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&d.a6.multiply(s,s,this.globeMatrix),s}getFrustum(s){return d.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,"meters"===this.projection.zAxisUnit)}}const kr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},cl=(p,s)=>{if(s>0&&p.terrain&&d.w("Cutoff is currently disabled on terrain"),s<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=p.transform,m=Math.max(Math.abs(c._zoom-(p.minCutoffZoom-1)),1),y=c.isLODDisabled(!1)?d.O(60,45,c.pitch):d.O(30,15,c.pitch),x=c._farZ-c._nearZ,C=s*c.height,T=((1-(S=y))*c.cameraToCenterDistance+S*(c._farZ+C))*m;var S;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(T-c._nearZ)/x,(T-C-c._nearZ)/x]}}},lo={cascadeCount:2,shadowMapResolution:2048};class kf{constructor(s,c){this.aabb=s,this.lastCascade=c}}class bm{add(s,c){const m=this.receivers[s.key];void 0!==m?(m.aabb.min[0]=Math.min(m.aabb.min[0],c.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],c.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],c.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],c.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],c.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],c.max[2])):this.receivers[s.key]=new kf(c,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,c,m){const y=d.bS.fromPoints(s.points);let x=0;for(const C in this.receivers){const T=this.receivers[C];if(!T||!y.intersectsAabb(T.aabb))continue;T.aabb.min=y.closestPoint(T.aabb.min),T.aabb.max=y.closestPoint(T.aabb.max);const S=T.aabb.getCorners();for(let O=0;O<m.length;O++){let k=!0;for(const F of S){const V=[F[0]*c,F[1]*c,F[2]];if(d.N.transformMat4(V,V,m[O].matrix),V[0]<-1||V[0]>1||V[1]<-1||V[1]>1){k=!1;break}}if(T.lastCascade=O,x=Math.max(x,O),k)break}}return x+1}}class Zo{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new bm,this._depthMode=new rt(s.context.gl.LEQUAL,rt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,s.tp.registerParameter(lo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(lo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,c){const m=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const y=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||y<=0||(this._shadowLayerCount=m.style.order.reduce((q,W)=>{const Y=m.style._mergedLayers[W];return q+(Y.hasShadowPass()&&!Y.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const x=m.context,C=lo.shadowMapResolution,T=lo.shadowMapResolution;if(0===this._cascades.length||lo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let q=0;q<lo.cascadeCount;++q){const W=m._shadowMapDebug,Y=x.gl,G=x.createFramebuffer(C,T,W,"texture"),J=new d.T(x,{width:C,height:T,data:null},Y.DEPTH_COMPONENT);if(G.depthAttachment.set(J.texture),W){const re=new d.T(x,{width:C,height:T,data:null},Y.RGBA);G.colorAttachment.set(re.texture)}this._cascades.push({framebuffer:G,texture:J,matrix:[],far:0,boundingSphereRadius:0,frustum:new d.bq,scale:0})}}this.shadowDirection=ku(c);let S=0;if(s.elevation){const q=s.elevation,W=[1e4,-1e4];q.visibleDemTiles.filter(Y=>Y.dem).forEach(Y=>{const G=Y.dem.tree;W[0]=Math.min(W[0],G.minimums[0]),W[1]=Math.max(W[1],G.maximums[0])}),1e4!==W[0]&&(S=(W[1]-W[0])*q.exaggeration())}const O=1.5*s.cameraToCenterDistance,k=3*O,F=new Float64Array(16);for(let q=0;q<this._cascades.length;++q){const W=this._cascades[q];let Y=s.height/50,G=1;1===lo.cascadeCount?G=k:0===q?G=O:(Y=O,G=k);const[J,re]=wm(s,this.shadowDirection,Y,G,lo.shadowMapResolution,S);W.scale=s.scale,W.matrix=J,W.boundingSphereRadius=re,d.a6.invert(F,W.matrix),W.frustum=d.bq.fromInvProjectionMatrix(F,1,0,!0),W.far=G}const V=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[V].far,this._cascades[V].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/lo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=lo.shadowMapResolution,this._uniformValues.u_shadowmap_0=kr.ShadowMap0,this._uniformValues.u_shadowmap_1=kr.ShadowMap0+1,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const j=m.transform.elevation;for(const q of this._groundShadowTiles){let W={min:0,max:0};if(j){const Y=j.getMinMaxForTile(q);Y&&(W=Y)}this.addShadowReceiver(q.toUnwrapped(),W.min,W.max)}}get enabled(){return this._enabled}set enabled(s){this._enabled=s}drawShadowPass(s,c){if(!this._enabled)return;const m=this.painter,y=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),y.viewport.set([0,0,lo.shadowMapResolution,lo.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){m.currentShadowCascade=x,y.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),y.clear({color:d.ax.white,depth:1});for(const C of s.order){const T=s._mergedLayers[C];if(!T.hasShadowPass()||T.isHidden(m.transform.zoom))continue;const S=s.getLayerSourceCache(T),O=S?c[S.id]:void 0;("model"===T.type||O&&O.length)&&m.renderLayer(m,S,T,O)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const s=this.painter,c=s.style,m=s.context,y=c.directionalLight,x=c.ambientLight;if(!y||!x)return;const C=[],T=cl(s,s.longestCutoffRange);T.shouldRenderCutoff&&C.push("RENDER_CUTOFF");const S=Lu(y,x),O=new rt(m.gl.LEQUAL,rt.ReadOnly,s.depthRangeFor3D);for(const k of this._groundShadowTiles){const F=k.toUnwrapped(),V=s.isTileAffectedByFog(k),j=s.getOrCreateProgram("groundShadow",{defines:C,overrideFog:V});this.setupShadows(F,j),s.uploadCommonUniforms(m,j,F,null,T);const q={u_matrix:s.transform.calculateProjMatrix(F),u_ground_shadow_factor:S};j.draw(s,m.gl.TRIANGLES,O,Qt.disabled,mn.multiply,Ut.disabled,q,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,{},s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?mn.unblended:mn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){const c=this.painter.transform,m=c.calculatePosMatrix(s,c.worldSize);return d.a6.multiply(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(s){return d.a6.multiply(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}setupShadows(s,c,m,y=0){if(!this._enabled)return;const x=this.painter.transform,C=this.painter.context,T=C.gl,S=this._uniformValues,O=new Float64Array(16),k=x.calculatePosMatrix(s,x.worldSize);for(let F=0;F<this._cascades.length;F++)d.a6.multiply(O,this._cascades[F].matrix,k),S[0===F?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),C.activeTexture.set(T.TEXTURE0+kr.ShadowMap0+F),this._cascades[F].texture.bind(T.NEAREST,T.CLAMP_TO_EDGE);if(this.useNormalOffset=!!m,this.useNormalOffset){const F=d.bR(s.canonical),V=2/x.tileSize*d.V/lo.shadowMapResolution,j=V*this._cascades[0].boundingSphereRadius,q=V*this._cascades[this._cascades.length-1].boundingSphereRadius,W=("vector-tile"===m?1:3)/Math.pow(2,y-s.canonical.z-(1-x.zoom+Math.floor(x.zoom)));S.u_shadow_normal_offset=[F,j*W,q*W],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(C,S)}setupShadowsFromMatrix(s,c,m=!1){if(!this._enabled)return;const y=this.painter.context,x=y.gl,C=this._uniformValues,T=new Float64Array(16);for(let S=0;S<lo.cascadeCount;S++)d.a6.multiply(T,this._cascades[S].matrix,s),C[0===S?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(T),y.activeTexture.set(x.TEXTURE0+kr.ShadowMap0+S),this._cascades[S].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);this.useNormalOffset=m,m?(C.u_shadow_normal_offset=[1,5,5],C.u_shadow_bias=[6e-5,.0012,.012]):C.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(y,C)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,c,m,y){if(y[2]>=0)return{};const x=function(S,O,k){const F=k/(1<<S.canonical.z);return new d.bS([S.canonical.x*F+S.wrap*k,S.canonical.y*F+S.wrap*k,0],[(S.canonical.x+1)*F+S.wrap*k,(S.canonical.y+1)*F+S.wrap*k,O])}(s,c,m).getCorners(),C=c/-y[2];y[0]<0?(d.N.add(x[0],x[0],[y[0]*C,0,0]),d.N.add(x[3],x[3],[y[0]*C,0,0])):y[0]>0&&(d.N.add(x[1],x[1],[y[0]*C,0,0]),d.N.add(x[2],x[2],[y[0]*C,0,0])),y[1]<0?(d.N.add(x[0],x[0],[0,y[1]*C,0]),d.N.add(x[1],x[1],[0,y[1]*C,0])):y[1]>0&&(d.N.add(x[2],x[2],[0,y[1]*C,0]),d.N.add(x[3],x[3],[0,y[1]*C,0]));const T={};return T.vertices=x,T.planes=[jl(x[1],x[0],x[4]),jl(x[2],x[1],x[5]),jl(x[3],x[2],x[6]),jl(x[0],x[3],x[7])],T}addShadowReceiver(s,c,m){this._receivers.add(s,d.bS.fromTileIdAndHeight(s,c,m))}getMaxCascadeForTile(s){const c=this._receivers.get(s);return c&&c.lastCascade?c.lastCascade:0}}function jl(p,s,c){const m=d.N.sub([],c,s),y=d.N.sub([],p,s),x=d.N.cross([],m,y),C=d.N.length(x);return 0===C?[0,0,1,0]:(d.N.scale(x,x,1/C),[x[0],x[1],x[2],-d.N.dot(x,s)])}function ku(p){const s=p.properties.get("direction"),c=d.bQ(s.x,s.y,s.z);c[2]=d.aa(c[2],0,75);const m=d.bT([c[0],c[1],c[2]]);return d.N.fromValues(m.x,m.y,m.z)}function Lu(p,s){const c=p.properties.get("color"),m=p.properties.get("intensity"),y=p.properties.get("direction"),x=[y.x,y.y,y.z],C=s.properties.get("color"),T=s.properties.get("intensity"),S=Math.max(d.N.dot([0,0,1],x),0),O=[0,0,0];d.N.scale(O,C.toArray01Linear().slice(0,3),T);const k=[0,0,0];return d.N.scale(k,c.toArray01Linear().slice(0,3),S*m),d.bU([O[0]>0?O[0]/(O[0]+k[0]):0,O[1]>0?O[1]/(O[1]+k[1]):0,O[2]>0?O[2]/(O[2]+k[2]):0])}function wm(p,s,c,m,y,x){const C=p.zoom,T=p.scale,S=p.worldSize,O=1/S,k=p.aspect,F=Math.sqrt(1+k*k)*Math.tan(.5*p.fovX),V=F*F,j=m-c,q=m+c;let W,Y;V>j/q?(W=m,Y=m*F):(W=.5*q*(1+V),Y=.5*Math.sqrt(j*j+2*(m*m+c*c)*V+q*q*V*V));const G=p.projection.pixelsPerMeter(p.center.lat,S),J=p._camera.getCameraToWorldMercator(),re=[0,0,-W*O];d.N.transformMat4(re,re,J);let ee=Y*O;const oe=p._edgeInsets;if(!(0===oe.left&&0===oe.top&&0===oe.right&&0===oe.bottom||oe.left===oe.right&&oe.top===oe.bottom)){const et=p._camera.getWorldToCamera(p.worldSize,"meters"===p.projection.zAxisUnit?G:1),Je=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,c,m);Je[8]=2*-p.centerOffset.x/p.width,Je[9]=2*p.centerOffset.y/p.height;const pt=new Float64Array(16);d.a6.mul(pt,Je,et);const Mt=new Float64Array(16);d.a6.invert(Mt,pt);const zt=d.bq.fromInvProjectionMatrix(Mt,S,C,!0);for(const Ot of zt.points){const Dt=((X=Ot)[0]/=T,X[1]/=T,X[2]=d.bl(X[2],p._center.lat),X);ee=Math.max(ee,d.N.len(d.N.subtract([],re,Dt)))}}var X;ee*=y/(y-1);const se=Math.acos(s[2]),he=Math.atan2(-s[0],-s[1]),fe=new Bl;fe.position=re,fe.setPitchBearing(se,he);const ge=fe.getWorldToCamera(S,G),De=ee*S,ve=Math.min(p._mercatorZfromZoom(17)*S*-2,-2*De),Pe=fe.getCameraToClipOrthographic(-De,De,-De,De,ve,(De+x*G)/s[2]),Ae=new Float64Array(16);d.a6.multiply(Ae,Pe,ge);const qe=d.N.fromValues(Math.floor(1e6*re[0])/1e6*S,Math.floor(1e6*re[1])/1e6*S,0),xe=.5*y,Se=[0,0,0];d.N.transformMat4(Se,qe,Ae),d.N.scale(Se,Se,xe);const pe=[Math.floor(Se[0]),Math.floor(Se[1]),Math.floor(Se[2])],Ee=[0,0,0];d.N.sub(Ee,Se,pe),d.N.scale(Ee,Ee,-1/xe);const He=new Float64Array(16);return d.a6.identity(He),d.a6.translate(He,He,Ee),d.a6.multiply(Ae,He,Ae),[Ae,De]}const ul=(p,s)=>Rt(p,s&&s.filter(c=>"source.canvas"!==c.identifier)),Em=d.ac(kn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Ul=d.ac(kn,["setCenter","setZoom","setBearing","setPitch"]),Lf={version:8,layers:[],sources:{}},Cm={duration:300,delay:0},L_=new Set(["fill","line","background","hillshade","raster"]);class Bi extends d.E{constructor(s,c={}){super(),this.map=s,this.scope=c.scope||"",this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=d.e({},Cm),this._buildingIndex=new A_(this),this.crossTileSymbolIndex=new rd,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new Ca,this.dispatcher=c.dispatcher?c.dispatcher:new d.bW(d.bX(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new Hh,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new d.bY(s._requestManager,c.localFontFamily?d.bZ.all:c.localIdeographFontFamily?d.bZ.ideographs:d.bZ.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new gu(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this.dispatcher.broadcast("setReferrer",d.b_());const m=this;this._rtlTextPluginCallback=Bi.registerForPluginStateChange(y=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(x,C)=>{if(d.b$(x),C&&C.every(T=>T))for(const T in m._sourceCaches){const S=m._sourceCaches[T],O=S.getSource().type;"vector"!==O&&"geojson"!==O||S.reload()}})}),this.on("data",y=>{if("source"!==y.dataType||"metadata"!==y.sourceDataType)return;const x=this.getOwnSource(y.sourceId);if(x&&x.vectorLayerIds)for(const C in this._layers){const T=this._layers[C];T.source===x.id&&this._validateLayer(T)}})}loadURL(s,c={}){this.fire(new d.b("dataloading",{dataType:"style"}));const m="boolean"==typeof c.validate?c.validate:!d.c0(s);s=this.map._requestManager.normalizeStyleURL(s,c.accessToken),this.resolvedImports.add(s);const y=this.importsCache.get(s);if(y)return this._load(y,m);const x=this.map._requestManager.transformRequest(s,d.R.Style);this._request=d.g(x,(C,T)=>{if(this._request=null,C)this.fire(new d.a(C));else if(T)return this.importsCache.set(s,T),this._load(T,m)})}loadJSON(s,c={}){this.fire(new d.b("dataloading",{dataType:"style"})),this._request=d.f.frame(()=>{this._request=null,this._load(s,!1!==c.validate)})}loadEmpty(){this.fire(new d.b("dataloading",{dataType:"style"})),this._load(Lf,!1)}_loadImports(s,c,m){if(this.importDepth>=4)return d.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const x of s){const C=this._createFragmentStyle(x),T=new Promise(k=>{C.once("style.import.load",k),C.once("error",k)}).then(()=>this.mergeAll());if(y.push(T),this.resolvedImports.has(x.url)){C.loadEmpty();continue}const S=x.data||this.importsCache.get(x.url);S?C.loadJSON(S,{validate:c}):x.url?C.loadURL(x.url,{validate:c}):C.loadEmpty();const O={style:C,id:x.id,config:x.config};if(m){const k=this.fragments.findIndex(({id:F})=>F===m);this.fragments=this.fragments.slice(0,k).concat(O).concat(this.fragments.slice(k))}else this.fragments.push(O)}return Promise.allSettled(y)}_createFragmentStyle(s){const c=this.scope?d.ag(s.id,this.scope):s.id,m=new Bi(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:s.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return m.setEventedParent(this.map,{style:m}),m}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const s=this.isRootStyle();this._shouldPrecompile=s,this.fire(new d.b(s?"style.load":"style.import.load"))}_load(s,c){const m=s.schema;if(this.isRootStyle()&&(s.fragment||m&&!1!==s.fragment)){const C=d.e({},Lf,{imports:[{id:"basemap",data:s,url:""}]});return void this._load(C,c)}if(this.setConfig(this._config,m),c&&ul(this,ss(s)))return;this._loaded=!0,this.stylesheet=d.c1(s);for(const C in s.sources)this.addSource(C,s.sources[C],{validate:!1,isInitialLoad:!0});s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(s.glyphs,this.scope);const y=Du(this.stylesheet.layers);if(this._order=y.map(C=>C.id),this.stylesheet.light&&d.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const C=this.stylesheet.lights[0];this.light=new kt(C.properties,C.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new kt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const C of y){const T=d.c2(C,this.scope,this.options);T.isConfigDependent&&this._configDependentLayers.add(T.fqid),T.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=T,this._serializedLayers[T.id]=T.serialize();const S=this.getOwnLayerSourceCache(T),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&T.canCastShadows()&&O&&(S.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const x=this.stylesheet.terrain;x&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=d.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?d.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(x,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new d.b("data",{dataType:"style"})),s.imports?this._loadImports(s.imports,c).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return 0===this.importDepth}mergeAll(){let s,c,m,y,x,C,T,S;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(null!=O.light&&(s=O.light),O.stylesheet.lights)for(const k of O.stylesheet.lights)"ambient"===k.type&&null!=O.ambientLight&&(c=O.ambientLight),"directional"===k.type&&null!=O.directionalLight&&(m=O.directionalLight);y=this._prioritizeTerrain(y,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&null!=O.fog&&(x=O.fog),null!=O.stylesheet.camera&&(S=O.stylesheet.camera),null!=O.stylesheet.projection&&(C=O.stylesheet.projection),null!=O.stylesheet.transition&&(T=O.stylesheet.transition)}}),this.light=s,this.ambientLight=c,this.directionalLight=m,this.fog=x,null===y?delete this.terrain:this.terrain=y,this.camera=S||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=d.e({},Cm,T),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(s){const c=m=>{for(const y of m.fragments)c(y.style);s(m)};c(this)}_prioritizeTerrain(s,c,m){const y=s&&0===s.drapeRenderMode;return null===m?c&&0===c.drapeRenderMode?c:y?s:null:null!=c&&(!s||y||c&&1===c.drapeRenderMode)?c:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{s=this._prioritizeTerrain(s,c.terrain,c.stylesheet.terrain)}),null===s?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(c=>{null!=c.stylesheet.projection&&(s=c.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){const s={},c={},m={};this.forEachFragmentStyle(y=>{for(const x in y._sourceCaches){const C=d.ag(x,y.scope);s[C]=y._sourceCaches[x]}for(const x in y._otherSourceCaches){const C=d.ag(x,y.scope);c[C]=y._otherSourceCaches[x]}for(const x in y._symbolSourceCaches){const C=d.ag(x,y.scope);m[C]=y._symbolSourceCaches[x]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=m}mergeLayers(){const s={},c=[],m={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(const C of x._order){const T=x._layers[C];if("slot"===T.type){const S=d.c3(C);if(s[S])continue;s[S]=[]}T.slot&&s[T.slot]?s[T.slot].push(T):c.push(T)}}),this._mergedOrder=[];const y=(x=[])=>{for(const C of x)if("slot"===C.type){const T=d.c3(C.id);s[T]&&y(s[T])}else{const T=d.ag(C.id,C.scope);this._mergedOrder.push(T),m[T]=C,C.is3D()&&(this._has3DLayers=!0),"circle"===C.type&&(this._hasCircleLayers=!0),"symbol"===C.type&&(this._hasSymbolLayers=!0)}};y(c),this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=d.e({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(c,m,y){let x,C,T;const S=d.f.devicePixelRatio>1?"@2x":"";let O=d.g(m.transformRequest(m.normalizeSpriteURL(c,S,".json"),d.R.SpriteJSON),(V,j)=>{O=null,T||(T=V,x=j,F())}),k=d.d(m.transformRequest(m.normalizeSpriteURL(c,S,".png"),d.R.SpriteImage),(V,j)=>{k=null,T||(T=V,C=j,F())});function F(){if(T)y(T);else if(x&&C){const V=d.f.getImageData(C),j={};for(const q in x){const{width:W,height:Y,x:G,y:J,sdf:re,pixelRatio:ee,stretchX:oe,stretchY:X,content:se}=x[q],he=new d.h({width:W,height:Y});d.h.copy(V,he,{x:G,y:J},{x:0,y:0},{width:W,height:Y}),j[q]={data:he,pixelRatio:ee,sdf:re,stretchX:oe,stretchY:X,content:se}}y(null,j)}}return{cancel(){O&&(O.cancel(),O=null),k&&(k.cancel(),k=null)}}}(s,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new d.a(c));else if(m)for(const y in m)this.imageManager.addImage(y,this.scope,m[y]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new d.b("data",{dataType:"style"}))})}_validateLayer(s){const c=this.getOwnSource(s.source);if(!c)return;const m=s.sourceLayer;m&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(m))&&this.fire(new d.a(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,c)=>{const m=this.fragments[c];return m&&m.style&&(s.data=m.style.serialize()),s})}_serializeSources(){const s={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();s[m.id]||(s[m.id]=m.serialize())}return s}_serializeLayers(s){const c=[];for(const m of s){const y=this._layers[m];y&&"custom"!==y.type&&c.push(y.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&("function"==typeof s.isLayerDraped?s.isLayerDraped(this.getLayerSourceCache(s)):L_.has(s.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){const c=this.getOwnLayer(s);if(c)return c;this.fire(new d.a(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){const c=this.getOwnSource(s);if(c)return c;this.fire(new d.a(new Error(`The source '${s}' does not exist in the map's style.`)))}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);const c=this.calculateLightsBrightness();s.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c));const m=this._changes.isDirty();if(this._changes.isDirty()){const x=this._changes.getLayerUpdatesByScope();for(const C in x){const{updatedIds:T,removedIds:S}=x[C];(T||S)&&this._updateWorkerLayers(C,T,S)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._changes.reset()}const y={};for(const x in this._mergedSourceCaches){const C=this._mergedSourceCaches[x];y[x]=C.used,C.used=!1,C.tileCoverLift=0}for(const x of this._mergedOrder){const C=this._mergedLayers[x];if(C.recalculate(s,this._availableImages),!C.isHidden(s.zoom)){const T=this.getLayerSourceCache(C);T&&(T.used=!0,T.tileCoverLift=Math.max(T.tileCoverLift,C.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let T=C.minzoom||0;T<(C.maxzoom||25.5);T++){const S=this.map.painter;if(S){const O=C.getProgramIds();if(!O)continue;for(const k of O){const F=C.getDefaultProgramParams(k,s.zoom);F&&(S.style=this,this.fog&&(S._fogVisible=!0,F.overrideFog=!0,S.getOrCreateProgram(k,F)),S._fogVisible=!1,F.overrideFog=!1,S.getOrCreateProgram(k,F),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(F.overrideRtt=!0,S.getOrCreateProgram(k,F)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const x in y){const C=this._mergedSourceCaches[x];y[x]!==C.used&&C.getSource().fire(new d.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),m&&this.fire(new d.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=this._changes.getUpdatedImages();if(s.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],s);this._changes.resetUpdatedImages()}}_updateWorkerLayers(s,c,m){const y=this.getFragmentStyle(s);y&&this.dispatcher.broadcast("updateLayers",{layers:c?y._serializeLayers(c):[],scope:s,removedIds:m||[],options:y.options})}setState(s){if(this._checkLoaded(),ul(this,ss(s)))return!1;(s=d.c1(s)).layers=Du(s.layers);const c=function(y,x){if(!y)return[{command:kn.setStyle,args:[x]}];let C=[];try{if(!Zt(y.version,x.version))return[{command:kn.setStyle,args:[x]}];Zt(y.center,x.center)||C.push({command:kn.setCenter,args:[x.center]}),Zt(y.zoom,x.zoom)||C.push({command:kn.setZoom,args:[x.zoom]}),Zt(y.bearing,x.bearing)||C.push({command:kn.setBearing,args:[x.bearing]}),Zt(y.pitch,x.pitch)||C.push({command:kn.setPitch,args:[x.pitch]}),Zt(y.sprite,x.sprite)||C.push({command:kn.setSprite,args:[x.sprite]}),Zt(y.glyphs,x.glyphs)||C.push({command:kn.setGlyphs,args:[x.glyphs]}),Zt(y.imports,x.imports)||function(F=[],V=[],j){V=V||[];const q=(F=F||[]).map(Sa),W=V.map(Sa),Y=F.reduce(Jh,{}),G=V.reduce(Jh,{}),J=q.slice();let re,ee,oe,X;for(re=0,ee=0;re<q.length;re++)oe=q[re],G.hasOwnProperty(oe)?ee++:(j.push({command:kn.removeImport,args:[oe]}),J.splice(J.indexOf(oe,ee),1));for(re=0,ee=0;re<W.length;re++)oe=W[W.length-1-re],J[J.length-1-re]!==oe&&(Y.hasOwnProperty(oe)?(j.push({command:kn.removeImport,args:[oe]}),J.splice(J.lastIndexOf(oe,J.length-ee),1)):ee++,X=J[J.length-re],j.push({command:kn.addImport,args:[G[oe],X]}),J.splice(J.length-re,0,oe));for(const se of V){const he=Y[se.id];he&&!Zt(he,se)&&j.push({command:kn.updateImport,args:[se.id,se]})}}(y.imports,x.imports,C),Zt(y.transition,x.transition)||C.push({command:kn.setTransition,args:[x.transition]}),Zt(y.light,x.light)||C.push({command:kn.setLight,args:[x.light]}),Zt(y.fog,x.fog)||C.push({command:kn.setFog,args:[x.fog]}),Zt(y.projection,x.projection)||C.push({command:kn.setProjection,args:[x.projection]}),Zt(y.lights,x.lights)||C.push({command:kn.setLights,args:[x.lights]}),Zt(y.camera,x.camera)||C.push({command:kn.setCamera,args:[x.camera]});const T={},S=[];!function(F,V,j,q){let W;for(W in V=V||{},F=F||{})F.hasOwnProperty(W)&&(V.hasOwnProperty(W)||Rf(W,j,q));for(W in V){if(!V.hasOwnProperty(W))continue;const Y=V[W];F.hasOwnProperty(W)?Zt(F[W],Y)||("geojson"===F[W].type&&"geojson"===Y.type&&Kh(F,V,W)?j.push({command:kn.setGeoJSONSourceData,args:[W,Y.data]}):Xh(W,V,j,q)):Ac(W,V,j)}}(y.sources,x.sources,S,T);const O=[];y.layers&&y.layers.forEach(F=>{F.source&&T[F.source]?C.push({command:kn.removeLayer,args:[F.id]}):O.push(F)});let k=y.terrain;k&&T[k.source]&&(C.push({command:kn.setTerrain,args:[void 0]}),k=void 0),C=C.concat(S),Zt(k,x.terrain)||C.push({command:kn.setTerrain,args:[x.terrain]}),function(F,V,j){V=V||[];const q=(F=F||[]).map(Sa),W=V.map(Sa),Y=F.reduce(Jh,{}),G=V.reduce(Jh,{}),J=q.slice(),re=Object.create(null);let ee,oe,X,se,he,fe,ge;for(ee=0,oe=0;ee<q.length;ee++)X=q[ee],G.hasOwnProperty(X)?oe++:(j.push({command:kn.removeLayer,args:[X]}),J.splice(J.indexOf(X,oe),1));for(ee=0,oe=0;ee<W.length;ee++)X=W[W.length-1-ee],J[J.length-1-ee]!==X&&(Y.hasOwnProperty(X)?(j.push({command:kn.removeLayer,args:[X]}),J.splice(J.lastIndexOf(X,J.length-oe),1)):oe++,fe=J[J.length-ee],j.push({command:kn.addLayer,args:[G[X],fe]}),J.splice(J.length-ee,0,X),re[X]=!0);for(ee=0;ee<W.length;ee++)if(X=W[ee],se=Y[X],he=G[X],!re[X]&&!Zt(se,he))if(Zt(se.source,he.source)&&Zt(se["source-layer"],he["source-layer"])&&Zt(se.type,he.type)){for(ge in ea(se.layout,he.layout,j,X,null,kn.setLayoutProperty),ea(se.paint,he.paint,j,X,null,kn.setPaintProperty),Zt(se.slot,he.slot)||j.push({command:kn.setSlot,args:[X,he.slot]}),Zt(se.filter,he.filter)||j.push({command:kn.setFilter,args:[X,he.filter]}),Zt(se.minzoom,he.minzoom)&&Zt(se.maxzoom,he.maxzoom)||j.push({command:kn.setLayerZoomRange,args:[X,he.minzoom,he.maxzoom]}),se)se.hasOwnProperty(ge)&&"layout"!==ge&&"paint"!==ge&&"filter"!==ge&&"metadata"!==ge&&"minzoom"!==ge&&"maxzoom"!==ge&&"slot"!==ge&&(0===ge.indexOf("paint.")?ea(se[ge],he[ge],j,X,ge.slice(6),kn.setPaintProperty):Zt(se[ge],he[ge])||j.push({command:kn.setLayerProperty,args:[X,ge,he[ge]]}));for(ge in he)he.hasOwnProperty(ge)&&!se.hasOwnProperty(ge)&&"layout"!==ge&&"paint"!==ge&&"filter"!==ge&&"metadata"!==ge&&"minzoom"!==ge&&"maxzoom"!==ge&&"slot"!==ge&&(0===ge.indexOf("paint.")?ea(se[ge],he[ge],j,X,ge.slice(6),kn.setPaintProperty):Zt(se[ge],he[ge])||j.push({command:kn.setLayerProperty,args:[X,ge,he[ge]]}))}else j.push({command:kn.removeLayer,args:[X]}),fe=J[J.lastIndexOf(X)+1],j.push({command:kn.addLayer,args:[he,fe]})}(O,x.layers,C)}catch(T){console.warn("Unable to compute style diff:",T),C=[{command:kn.setStyle,args:[x]}]}return C}(this.serialize(),s).filter(y=>!(y.command in Ul));if(0===c.length)return!1;const m=c.filter(y=>!(y.command in Em));if(m.length>0)throw new Error(`Unimplemented: ${m.map(y=>y.command).join(", ")}.`);return c.forEach(y=>{this[y.command].apply(this,y.args)}),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(s,c){return this.getImage(s)?this.fire(new d.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,this.scope,c),this._afterImageUpdated(s),this)}updateImage(s,c){this.imageManager.updateImage(s,this.scope,c)}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._afterImageUpdated(s),this):this.fire(new d.a(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(s),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new d.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(s,c,m={}){return this._checkLoaded(),this._validate(wt,`models.${s}`,c,null,m)||(this.modelManager.addModel(s,c,this.scope),this._changes.setDirty()),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope),this):this.fire(new d.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,c,m={}){if(this._checkLoaded(),void 0!==this.getOwnSource(s))throw new Error(`There is already a source with ID "${s}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(Ks,`sources.${s}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=vr(s,c,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));const x=C=>{const T=(C?"symbol:":"other:")+y.id,S=d.ag(T,this.scope),O=this._sourceCaches[T]=new Qs(S,y,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=O,O.onAdd(this.map)};x(!1),"vector"!==c.type&&"geojson"!==c.type||x(!0),y.onAdd&&y.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();const c=this.getOwnSource(s);if(!c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===s)return this.fire(new d.a(new Error(`Source "${s}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new d.a(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const m=this.getOwnSourceCaches(s);for(const y of m){const x=d.c3(y.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(y.id),y.fire(new d.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,c){this._checkLoaded(),this.getOwnSource(s).setData(c),this._changes.setDirty()}getOwnSource(s){const c=this.getOwnSourceCache(s);return c&&c.getSource()}getOwnSources(){const s=[];for(const c in this._otherSourceCaches){const m=this.getOwnSourceCache(c);m&&s.push(m.getSource())}return s}areTilesLoaded(){const s=this._mergedSourceCaches;for(const c in s){const m=s[c]._tiles;for(const y in m){const x=m[y];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const y of s){if(this._validate(Ue,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const x=this.ambientLight;x.set(y),x.updateTransitions(c)}else this.ambientLight=new Wr(y,mo,this.scope,this.options);break;case"directional":if(this.directionalLight){const x=this.directionalLight;x.set(y),x.updateTransitions(c)}else this.directionalLight=new Wr(y,cr,this.scope,this.options)}}const m=new d.K(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(m),this.directionalLight&&this.directionalLight.recalculate(m),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const s=this.directionalLight,c=this.ambientLight;if(!s||!c)return;const m=F=>.2126*(F[0]<=.03928?F[0]/12.92:Math.pow((F[0]+.055)/1.055,2.4))+.7152*(F[1]<=.03928?F[1]/12.92:Math.pow((F[1]+.055)/1.055,2.4))+.0722*(F[2]<=.03928?F[2]/12.92:Math.pow((F[2]+.055)/1.055,2.4)),y=s.properties.get("color").toArray01(),x=s.properties.get("intensity"),C=s.properties.get("direction"),T=1-d.bQ(C.x,C.y,C.z)[2]/90,S=m(y)*x*T,O=c.properties.get("color").toArray01(),k=c.properties.get("intensity");return(S+m(O)*k)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(!s)return this;if(d.c4(s)){const c=d.c5(s),m=this.fragments.find(({id:x})=>x===c);if(!m)throw new Error(`Style import not found: ${s}`);const y=d.c3(s);return m.style.getFragmentStyle(y)}{const c=this.fragments.find(({id:m})=>m===s);if(!c)throw new Error(`Style import not found: ${s}`);return c.style}}getConfigProperty(s,c){const m=this.getFragmentStyle(s);if(!m)return null;const y=d.ag(c,m.scope),x=m.options.get(y),C=x?x.value||x.default:null;return C?C.serialize():null}setConfigProperty(s,c,m){const y=d.r(m);if("success"!==y.result)return void ul(this,y.value);const x=y.value.expression,C=this.getFragmentStyle(s);if(!C)return;const T=d.ag(c,C.scope),S=C.options.get(T);S&&(this.options.set(T,{...S,value:x}),this.updateConfigDependencies())}setConfig(s,c){if(this._config=s,s||c)if(c)for(const m in c){let y,x;const C=d.r(c[m].default);if("success"===C.result&&(y=C.value.expression),s&&void 0!==s[m]){const V=d.r(s[m]);"success"===V.result&&(x=V.value.expression)}const{minValue:T,maxValue:S,stepValue:O,type:k,values:F}=c[m];if(y){const V=d.ag(m,this.scope);this.options.set(V,{default:y,value:x,minValue:T,maxValue:S,stepValue:O,type:k,values:F})}else this.fire(new d.a(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new d.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const s of this._configDependentLayers){const c=this.getLayer(s);c&&(c.possiblyEvaluateVisibility(),this._updateLayer(c))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(s,c,m={}){this._checkLoaded();const y=s.id;if(this._layers[y])return void this.fire(new d.a(new Error(`Layer with id "${y}" already exists on this map`)));let x;if("custom"===s.type){if(ul(this,d.c6(s)))return;x=d.c2(s,this.scope,this.options)}else{if("object"==typeof s.source&&(this.addSource(y,s.source),s=d.c1(s),s=d.e(s,{source:y})),this._validate(_e,`layers.${y}`,s,{arrayIndex:-1},m))return;x=d.c2(s,this.scope,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[x.id]=x.serialize()}x.isConfigDependent&&this._configDependentLayers.add(x.fqid);let C=this._order.length;if(c){const k=this._order.indexOf(c);if(-1===k)return void this.fire(new d.a(new Error(`Layer with id "${c}" does not exist on this map.`)));x.slot===this._layers[c].slot?C=k:d.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,y),this._layerOrderChanged=!0,this._layers[y]=x;const T=this.getOwnLayerSourceCache(x),S=!!this.directionalLight&&this.directionalLight.shadowsEnabled();T&&x.canCastShadows()&&S&&(T.castsShadows=!0);const O=this._changes.getRemovedLayer(x);if(O&&x.source&&T&&"custom"!==x.type){this._changes.discardLayerRemoval(x);const k=d.ag(x.source,x.scope);O.type!==x.type?this._changes.updateSourceCache(k,"clear"):(this._changes.updateSourceCache(k,"reload"),T.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(s,c){this._checkLoaded();const m=this._checkLayer(s);if(!m||s===c)return;const y=this._order.indexOf(s);this._order.splice(y,1);let x=this._order.length;if(c){const C=this._order.indexOf(c);if(-1===C)return void this.fire(new d.a(new Error(`Layer with id "${c}" does not exist on this map.`)));m.slot===this._layers[c].slot?x=C:d.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();const c=this._checkLayer(s);if(!c)return;c.setEventedParent(null);const m=this._order.indexOf(s);this._order.splice(m,1),delete this._layers[s],delete this._serializedLayers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const y=this.getOwnLayerSourceCache(c);if(y&&y.castsShadows){let x=!1;for(const C in this._layers)if(this._layers[C].source===c.source&&this._layers[C].canCastShadows()){x=!0;break}y.castsShadows=x}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(const c in this._layers)if(this._layers[c].type===s)return!0;return!1}setLayerZoomRange(s,c,m){this._checkLoaded();const y=this._checkLayer(s);y&&(y.minzoom===c&&y.maxzoom===m||(null!=c&&(y.minzoom=c),null!=m&&(y.maxzoom=m),this._updateLayer(y)))}setSlot(s,c){this._checkLoaded();const m=this._checkLayer(s);m&&m.slot!==c&&(m.slot=c,this._updateLayer(m))}setFilter(s,c,m={}){this._checkLoaded();const y=this._checkLayer(s);if(y&&!Zt(y.filter,c))return null==c?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(Fe,`layers.${y.id}.filter`,c,{layerType:y.type},m)||(y.filter=d.c1(c),this._updateLayer(y)))}getFilter(s){const c=this._checkLayer(s);if(c)return d.c1(c.filter)}setLayoutProperty(s,c,m,y={}){this._checkLoaded();const x=this._checkLayer(s);if(x&&!Zt(x.getLayoutProperty(c),m)){if(null!=m&&(!y||!1!==y.validate)&&ul(x,Xe.call(ss,{key:`layers.${s}.layout.${c}`,layerType:x.type,objectKey:c,value:m,styleSpec:d.D,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(c,m),x.isConfigDependent&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(s,c){const m=this._checkLayer(s);if(m)return m.getLayoutProperty(c)}setPaintProperty(s,c,m,y={}){this._checkLoaded();const x=this._checkLayer(s);if(!x||Zt(x.getPaintProperty(c),m)||null!=m&&(!y||!1!==y.validate)&&ul(x,$e.call(ss,{key:`layers.${s}.paint.${c}`,layerType:x.type,objectKey:c,value:m,styleSpec:d.D})))return;const C=x.setPaintProperty(c,m);x.isConfigDependent&&this._configDependentLayers.add(x.fqid),C&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(s,c){const m=this._checkLayer(s);if(m)return m.getPaintProperty(c)}setFeatureState(s,c){this._checkLoaded();const m=s.source,y=s.sourceLayer,x=this._checkSource(m);if(!x)return;const C=x.type;if("geojson"===C&&y)return void this.fire(new d.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===C&&!y)return void this.fire(new d.a(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===s.id&&this.fire(new d.a(new Error("The feature id parameter must be provided.")));const T=this.getOwnSourceCaches(m);for(const S of T)S.setFeatureState(y,s.id,c)}removeFeatureState(s,c){this._checkLoaded();const m=s.source,y=this._checkSource(m);if(!y)return;const x=y.type,C="vector"===x?s.sourceLayer:void 0;if("vector"===x&&!C)return void this.fire(new d.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof s.id&&"number"!=typeof s.id)return void this.fire(new d.a(new Error("A feature id is required to remove its specific state property.")));const T=this.getOwnSourceCaches(m);for(const S of T)S.removeFeatureState(C,s.id,c)}getFeatureState(s){this._checkLoaded();const c=s.source,m=s.sourceLayer,y=this._checkSource(c);if(y){if("vector"!==y.type||m)return void 0===s.id&&this.fire(new d.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(m,s.id);this.fire(new d.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=d.e({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return d.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const s=this.getTerrain(),c=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return d.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},m=>void 0!==m)}_updateLayer(s){this._changes.updateLayer(s);const c=this.getLayerSourceCache(s),m=d.ag(s.source,s.scope),y=this._changes.getUpdatedSourceCaches();s.source&&!y[m]&&c&&"raster"!==c.getSource().type&&(this._changes.updateSourceCache(m,"reload"),c.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const c=T=>"fill-extrusion"===this._mergedLayers[T].type||"model"===this._mergedLayers[T].type,m=this.order,y={},x=[];for(let T=m.length-1;T>=0;T--){const S=m[T];if(c(S)){y[S]=T;for(const O of s){const k=O[S];if(k)for(const F of k)x.push(F)}}}x.sort((T,S)=>S.intersectionZ-T.intersectionZ);const C=[];for(let T=m.length-1;T>=0;T--){const S=m[T];if(c(S))for(let O=x.length-1;O>=0;O--){const k=x[O].feature;if(y[k.layer.id]<T)break;C.push(k),x.pop()}else for(const O of s){const k=O[S];if(k)for(const F of k)C.push(F.feature)}}return C}queryRenderedFeatures(s,c,m){c&&c.filter&&this._validate(Fe,"queryRenderedFeatures.filter",c.filter,null,c),c.scope=this.scope,c.availableImages=this._availableImages,c.serializedLayers=this._serializedLayers;const y={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new d.a(new Error("parameters.layers must be an Array."))),[];for(const O of c.layers){const k=this._mergedLayers[O];if(!k)return this.fire(new d.a(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];y[k.source]=!0}}const x=[],C=c.serializedLayers||{},T=c&&c.layers?c.layers.some(O=>{const k=this.getLayer(O);return k&&k.is3D()}):this.has3DLayers(),S=lr.createFromScreenPoints(s,m);for(const O in this._mergedSourceCaches){const k=this._mergedSourceCaches[O].getSource();if(!k||k.scope!==c.scope)continue;const F=this._mergedSourceCaches[O].getSource().id;c.layers&&!y[F]||x.push(ym(this._mergedSourceCaches[O],this._mergedLayers,C,S,c,m,T,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(O,k,F,V,j,q,W){const Y={},G=q.queryRenderedSymbols(V),J=[];for(const re of Object.keys(G).map(Number))J.push(W[re]);J.sort(Cu);for(const re of J){const ee=re.featureIndex.lookupSymbolFeatures(G[re.bucketInstanceId],k,re.bucketIndex,re.sourceLayerIndex,j.filter,j.layers,j.availableImages,O);for(const oe in ee){const X=Y[oe]=Y[oe]||[],se=ee[oe];se.sort((he,fe)=>{const ge=re.featureSortOrder;if(ge){const De=ge.indexOf(he.featureIndex);return ge.indexOf(fe.featureIndex)-De}return fe.featureIndex-he.featureIndex});for(const he of se)X.push(he)}}for(const re in Y)Y[re].forEach(ee=>{const oe=ee.feature,X=F(O[re]);if(!X)return;const se=X.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=se});return Y}(this._mergedLayers,C,this.getLayerSourceCache.bind(this),S.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(s,c){c&&c.filter&&this._validate(Fe,"querySourceFeatures.filter",c.filter,null,c);const m=this.getOwnSourceCaches(s);let y=[];for(const x of m)y=y.concat(Ia(x,c));return y}addSourceType(s,c,m){return Bi.getSourceType(s)?m(new Error(`A source type called "${s}" already exists.`)):(Bi.setSourceType(s,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:c.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,c,m={}){this._checkLoaded();const y=this.light.getLight();let x=!1;for(const T in s)if(!Zt(s[T],y[T])){x=!0;break}if(!x)return;const C=this._getTransitionParameters();this.light.setLight(s,c,m),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(s,c=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()&&0!==c||delete this.terrain,null===s?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let m=s;const y=null==s.source;if(1===c){if("object"==typeof m.source){const T="terrain-dem-src";this.addSource(T,m.source),m=d.c1(m),m=d.e(m,{source:T})}const x=d.e({},m),C={};if(this.terrain&&y){x.source=this.terrain.get().source;const T=this.terrain?this.getFragmentStyle(this.terrain.scope):null;T&&(C.style=T.serialize())}if(this._validate(te,"terrain",x,C))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&c!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,c),this.fire(new d.b("data",{dataType:"style"}))}else{const x=this.terrain,C=x.get();for(const T of Object.keys(d.D.terrain))!m.hasOwnProperty(T)&&d.D.terrain[T].default&&(m[T]=d.D.terrain[T].default);for(const T in s)if(!Zt(s[T],C[T])){x.set(s,this.options),this.stylesheet.terrain=s;const S=this._getTransitionParameters({duration:0});x.updateTransitions(S),this.fire(new d.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const c=this.fog=new Zr(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!Zt(c.get(),s)){c.set(s,this.options),this.stylesheet.fog=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}}else this._createFog(s);this._markersNeedUpdate=!0}_getTransitionParameters(s){return{now:d.f.now(),transition:d.e(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;const s=[],c=[];for(const m in this._mergedLayers)this.isLayerDraped(this._mergedLayers[m])?s.push(m):c.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...c)}_createTerrain(s,c){const m=this.terrain=new di(s,c,this.scope,this.options);1===c&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});m.updateTransitions(y)}_force3DLayerUpdate(){for(const s in this._layers){const c=this._layers[s];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const c=this._layers[s];"symbol"===c.type&&this._updateLayer(c)}}_validate(s,c,m,y,x={}){if(x&&!1===x.validate)return!1;const C=d.e({},this.serialize());return ul(this,s.call(ss,d.e({key:c,style:C,value:m,styleSpec:d.D},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(s){const c=this.getSourceCaches(s);for(const m of c)m.clearTiles()}clearSources(){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}reloadSource(s){const c=this.getSourceCaches(s);for(const m of c)m.resume(),m.reload()}reloadSources(){for(const s of this.getSources())s.reload&&s.reload()}updateSources(s){let c;this.directionalLight&&(c=ku(this.directionalLight));for(const m in this._mergedSourceCaches)this._mergedSourceCaches[m].update(s,void 0,void 0,c)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const c=this._sourceCaches[s];c.resume(),c.reload()}}_updatePlacement(s,c,m,y,x=!1){let C=!1,T=!1;const S={},O={};for(const k of this._mergedOrder){const F=this._mergedLayers[k];if("symbol"!==F.type)continue;const V=d.ag(F.source,F.scope);let j=S[V];if(!j){const W=this.getLayerSourceCache(F);if(!W)continue;const Y=W.getRenderableIds(!0).map(G=>W.getTileByID(G));O[V]=Y.slice(),j=S[V]=Y.sort((G,J)=>J.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(J.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(F,j,s.center.lng,s.projection);C=C||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),x=x||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new d.b("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.f.now(),s.zoom))&&(this.pauseablePlacement=new qo(s,this._mergedOrder,x,c,m,y,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,S,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.f.now()),T=!0),C&&this.pauseablePlacement.placement.setStale()),T||C){this._buildingIndex.onNewFrame(s.zoom);for(const k of this._mergedOrder){const F=this._mergedLayers[k];"symbol"===F.type&&this.placement.updateLayerOpacities(F,S[d.ag(F.source,F.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.f.now())}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,c){this._checkLoaded();const m=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==m.findIndex(({id:x})=>x===s.id))return this.fire(new d.a(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!c)return m.push(s),this._loadImports([s],!0),this;const y=m.findIndex(({id:x})=>x===c);return-1===y?this.fire(new d.a(new Error(`Import with id "${c}" does not exist on this map.`))):(this.stylesheet.imports=m.slice(0,y).concat(s).concat(m.slice(y)),this._loadImports([s],!0,c),this)}updateImport(s,c){this._checkLoaded();const m=this.stylesheet.imports||[],y=this.getImportIndex(s);return-1===y?this:"string"==typeof c?(this.setImportUrl(s,c),this):(c.url&&c.url!==m[y].url&&this.setImportUrl(s,c.url),Zt(c.config,m[y].config)||this.setImportConfig(s,c.config),Zt(c.data,m[y].data)||this.setImportData(s,c.data),this)}moveImport(s,c){this._checkLoaded();let m=this.stylesheet.imports||[];const y=this.getImportIndex(s);if(-1===y)return this;const x=this.getImportIndex(c);if(-1===x)return this;const C=m[y],T=this.fragments[y];return m=m.filter(({id:S})=>S!==s),this.fragments=this.fragments.filter(({id:S})=>S!==s),this.stylesheet.imports=m.slice(0,x).concat(C).concat(m.slice(x)),this.fragments=this.fragments.slice(0,x).concat(T).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(s,c){this._checkLoaded();const m=this.stylesheet.imports||[],y=this.getImportIndex(s);if(-1===y)return this;m[y].url=c;const x=this.fragments[y];return x.style=this._createFragmentStyle(m[y]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(c),this}setImportData(s,c){this._checkLoaded();const m=this.getImportIndex(s),y=this.stylesheet.imports||[];return-1===m?this:c?(this.fragments[m].style.setState(c),this._reloadImports(),this):(delete y[m].data,this.setImportUrl(s,y[m].url))}setImportConfig(s,c){this._checkLoaded();const m=this.getImportIndex(s),y=this.stylesheet.imports||[];if(-1===m)return this;c?y[m].config=c:delete y[m].config;const x=this.fragments[m],C=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=c,x.style.setConfig(c,C),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();const c=this.stylesheet.imports||[],m=this.getImportIndex(s);return-1===m||(c.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports()),this}getImportIndex(s){const c=(this.stylesheet.imports||[]).findIndex(m=>m.id===s);return-1===c&&this.fire(new d.a(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),c}getLayer(s){return this._mergedLayers[s]}getSources(){const s=[];for(const c in this._mergedOtherSourceCaches){const m=this._mergedOtherSourceCaches[c];m&&s.push(m.getSource())}return s}getSource(s,c){const m=this.getSourceCache(s,c);return m&&m.getSource()}getLayerSource(s){const c=this.getLayerSourceCache(s);return c&&c.getSource()}getSourceCache(s,c){const m=d.ag(s,c);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(s){const c=d.ag(s.source,s.scope);return"symbol"===s.type?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(s){const c=[];return this._mergedOtherSourceCaches[s]&&c.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&c.push(this._mergedSymbolSourceCaches[s]),c}updateSourceCaches(){const s=this._changes.getUpdatedSourceCaches();for(const c in s){const m=s[c];"reload"===m?this.reloadSource(c):"clear"===m&&this.clearSource(c)}}updateLayers(s){const c=this._changes.getUpdatedPaintProperties();for(const m of c){const y=this.getLayer(m);y&&y.updateTransitions(s)}}getImages(s,c,m){this.imageManager.getImages(c.icons,c.scope,m),this._updateTilesForChangedImages();const y=x=>{x&&x.setDependencies(c.tileID.key,c.type,c.icons)};y(this._otherSourceCaches[c.source]),y(this._symbolSourceCaches[c.source])}getGlyphs(s,c,m){this.glyphManager.getGlyphs(c.stacks,c.scope,m)}getResource(s,c,m){return d.c9(c,m)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return"symbol"===s.type?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){const c=[];return this._otherSourceCaches[s]&&c.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&c.push(this._symbolSourceCaches[s]),c}_isSourceCacheLoaded(s){const c=this.getOwnSourceCaches(s);return 0===c.length?(this.fire(new d.a(new Error(`There is no source with ID '${s}'`))),!1):c.every(m=>m.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Bi.getSourceType=function(p){return nl[p]},Bi.setSourceType=function(p,s){nl[p]=s},Bi.registerForPluginStateChange=d.bV;var sd="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",ad="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}",ld="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",br="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ff="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",cd="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Tr="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Lr="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",ni="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);\n#ifdef DATA_FORMAT_UINT32\nvec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;\n#else\nvec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));\n#endif\nreturn velocity/max(u_max_speed,length(velocity));}\n#endif",Fr="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Nr="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Rs=[];hl(sd,Rs),hl(ld,Rs),hl(ad,Rs);const or={"_prelude_fog.vertex.glsl":cd,"_prelude_terrain.vertex.glsl":Ff,"_prelude_shadow.vertex.glsl":Fr,"_prelude_fog.fragment.glsl":Tr,"_prelude_shadow.fragment.glsl":Nr,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Lr,"_prelude_raster_particle.glsl":ni},$l={};Kt("",Ff),Kt(Tr,cd),Kt(Nr,Fr),Kt(Lr,""),Kt(ni,"");const ud=Kt(ad,ld),Gl=sd;var Nf={background:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Kt("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Kt('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Kt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Kt("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Kt("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Kt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Kt("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Kt('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Kt("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Kt("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nvec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Kt("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'precision highp float;\n#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}'),rasterParticleTexture:Kt("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Kt("void main() {}",'#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);\n#ifdef DATA_FORMAT_UINT32\nvec2 dp=vec2(0);\n#else\nvec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;\n#endif\nvec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(\nvec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)\n);}'),symbolIcon:Kt('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:Kt('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Kt('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Kt("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Kt('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',br),skyboxGradient:Kt('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',br),skyboxCapture:Kt("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Kt('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Kt("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Kt("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function hl(p,s){const c=p.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let m of c)if(m=m.trim(),"#"===m[0]&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=m.split(" ");for(const x of y)s.includes(x)||s.push(x)}}function Kt(p,s){const c=/#include\s+"([^"]+)"/g,m=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let y=s.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);y&&(y=y.map(O=>{const k=O.split(" ");return k[k.length-1]}),y=[...new Set(y)]);const x={},C=[],T=[];if(p=p.replace(c,(O,k)=>(T.push(k),"")),(s=s.replace(c,(O,k)=>(C.push(k),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let S=[...Rs];hl(p,S),hl(s,S);for(const O of[...C,...T])or[O]||console.error(`Undefined include: ${O}`),$l[O]||($l[O]=[],hl(or[O],$l[O])),S=[...S,...$l[O]];return{fragmentSource:p=p.replace(m,(O,k,F,V,j)=>(x[j]=!0,"define"===k?`\n#ifndef HAS_UNIFORM_u_${j}\nin ${F} ${V} ${j};\n#else\nuniform ${F} ${V} u_${j};\n#endif\n`:"initialize"===k?`\n#ifdef HAS_UNIFORM_u_${j}\n    ${F} ${V} ${j} = u_${j};\n#endif\n`:"define-attribute"===k?`\n#ifdef HAS_ATTRIBUTE_a_${j}\n    in ${F} ${V} ${j};\n#endif\n`:"initialize-attribute"===k?"":void 0)),vertexSource:s=s.replace(m,(O,k,F,V,j)=>{const q="float"===V?"vec2":V,W=j.match(/color/)?"color":q;return"define-attribute-vertex-shader-only"===k?`\n#ifdef HAS_ATTRIBUTE_a_${j}\nin ${F} ${V} a_${j};\n#endif\n`:x[j]?"define"===k?`\n#ifndef HAS_UNIFORM_u_${j}\nuniform lowp float u_${j}_t;\nin ${F} ${q} a_${j};\nout ${F} ${V} ${j};\n#else\nuniform ${F} ${V} u_${j};\n#endif\n`:"initialize"===k?"vec4"===W?`\n#ifndef HAS_UNIFORM_u_${j}\n    ${j} = a_${j};\n#else\n    ${F} ${V} ${j} = u_${j};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${j}\n    ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);\n#else\n    ${F} ${V} ${j} = u_${j};\n#endif\n`:"define-attribute"===k?`\n#ifdef HAS_ATTRIBUTE_a_${j}\n    in ${F} ${V} a_${j};\n    out ${F} ${V} ${j};\n#endif\n`:"initialize-attribute"===k?`\n#ifdef HAS_ATTRIBUTE_a_${j}\n    ${j} = a_${j};\n#endif\n`:void 0:"define"===k?`\n#ifndef HAS_UNIFORM_u_${j}\nuniform lowp float u_${j}_t;\nin ${F} ${q} a_${j};\n#else\nuniform ${F} ${V} u_${j};\n#endif\n`:"define-instanced"===k?"mat4"===W?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${j}0;\nin vec4 a_${j}1;\nin vec4 a_${j}2;\nin vec4 a_${j}3;\n#else\nuniform ${F} ${V} u_${j};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${F} ${q} a_${j};\n#else\nuniform ${F} ${V} u_${j};\n#endif\n`:"initialize-attribute-custom"===k?`\n#ifdef HAS_ATTRIBUTE_a_${j}\n    ${F} ${V} ${j} = a_${j};\n#endif\n`:"vec4"===W?`\n#ifndef HAS_UNIFORM_u_${j}\n    ${F} ${V} ${j} = a_${j};\n#else\n    ${F} ${V} ${j} = u_${j};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${j}\n    ${F} ${V} ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);\n#else\n    ${F} ${V} ${j} = u_${j};\n#endif\n`}),staticAttributes:y,usedDefines:S,vertexIncludes:C,fragmentIncludes:T}}class Gt{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,c,m,y,x,C,T,S){this.context=s;let O=this.boundPaintVertexBuffers.length!==y.length;for(let F=0;!O&&F<y.length;F++)this.boundPaintVertexBuffers[F]!==y[F]&&(O=!0);let k=this.boundDynamicVertexBuffers.length!==T.length;for(let F=0;!k&&F<T.length;F++)this.boundDynamicVertexBuffers[F]!==T[F]&&(k=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==m||O||k||this.boundIndexBuffer!==x||this.boundVertexOffset!==C)this.freshBind(c,m,y,x,C,T,S);else{s.bindVertexArrayOES.set(this.vao);for(const F of T)F&&(F.bind(),S&&F.instanceCount&&F.setVertexAttribDivisor(s.gl,c,S));x&&x.dynamicDraw&&x.bind()}}freshBind(s,c,m,y,x,C,T){const S=s.numAttributes,O=this.context,k=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=C,c.enableAttributes(k,s),c.bind(),c.setVertexAttribPointers(k,s,x);for(const F of m)F.enableAttributes(k,s),F.bind(),F.setVertexAttribPointers(k,s,x);for(const F of C)F&&(F.enableAttributes(k,s),F.bind(),F.setVertexAttribPointers(k,s,x),T&&F.instanceCount&&F.setVertexAttribDivisor(k,s,T));y&&y.bind(),O.currentNumAttributes=S}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function qn(p,s){const c=Math.pow(2,s.canonical.z),m=s.canonical.y;return[new d.L(0,m/c).toLngLat().lat,new d.L(0,(m+1)/c).toLngLat().lat]}function Yi(p,s,c,m,y,x,C){const T=p.context,S=T.gl,O=c.hillshadeFBO;if(!O)return;p.prepareDrawTile();const k=p.isTileAffectedByFog(s),F=p.getOrCreateProgram("hillshade",{overrideFog:k});T.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,O.colorAttachment.get());const V=((Y,G,J,re)=>{const ee=J.paint.get("hillshade-shadow-color"),oe=J.paint.get("hillshade-highlight-color"),X=J.paint.get("hillshade-accent-color"),se=J.paint.get("hillshade-emissive-strength");let he=d.bj(J.paint.get("hillshade-illumination-direction"));if("viewport"===J.paint.get("hillshade-illumination-anchor"))he-=Y.transform.angle;else if(Y.style&&Y.style.enable3dLights()&&Y.style.directionalLight){const ge=Y.style.directionalLight.properties.get("direction"),De=d.bQ(ge.x,ge.y,ge.z);he=d.bj(De[1])}const fe=!Y.options.moving;return{u_matrix:re||Y.transform.calculateProjMatrix(G.tileID.toUnwrapped(),fe),u_image:0,u_latrange:qn(0,G.tileID),u_light:[J.paint.get("hillshade-exaggeration"),he],u_shadow:ee,u_highlight:oe,u_emissive_strength:se,u_accent:X}})(p,c,m,p.terrain?s.projMatrix:null);p.uploadCommonUniforms(T,F,s.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:q,tileBoundsSegments:W}=p.getTileBoundsBuffers(c);F.draw(p,S.TRIANGLES,y,x,C,Ut.disabled,V,m.id,j,q,W)}function us(p,s,c){if(!s.needsDEMTextureUpload)return;const m=p.context,y=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||p.getTileTexture(c.stride);const x=c.getPixels();s.demTexture?s.demTexture.update(x,{premultiply:!1}):s.demTexture=new d.T(m,x,y.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Hl(p,s,c){const m=p.context,y=m.gl;if(!s.dem)return;const x=s.dem;if(m.activeTexture.set(y.TEXTURE1),us(p,s,x),!s.demTexture)return;s.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const C=x.dim;m.activeTexture.set(y.TEXTURE0);let T=s.hillshadeFBO;if(!T){const V=new d.T(m,{width:C,height:C,data:null},y.RGBA);V.bind(y.LINEAR,y.CLAMP_TO_EDGE),T=s.hillshadeFBO=m.createFramebuffer(C,C,!0,"renderbuffer"),T.colorAttachment.set(V.texture)}m.bindFramebuffer.set(T.framebuffer),m.viewport.set([0,0,C,C]);const{tileBoundsBuffer:S,tileBoundsIndexBuffer:O,tileBoundsSegments:k}=p.getMercatorTileBoundsBuffers(),F=[];p.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(p,y.TRIANGLES,rt.disabled,Qt.disabled,mn.unblended,Ut.disabled,((V,j)=>{const q=j.stride,W=d.a6.create();return d.a6.ortho(W,0,d.V,-d.V,0,0,1),d.a6.translate(W,W,[0,-d.V,0]),{u_matrix:W,u_image:1,u_dimension:[q,q],u_zoom:V.overscaledZ}})(s.tileID,x),c.id,S,O,k),s.needsHillshadePrepare=!1}const Yr=p=>({u_matrix:new d.bK(p),u_image0:new d.bO(p),u_skirt_height:new d.bN(p),u_ground_shadow_factor:new d.bM(p)}),Ra=(p,s,c)=>({u_matrix:p,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:c}),pr=(p,s,c,m,y,x,C,T,S,O,k,F,V,j,q,W)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:c,u_zoom_transition:y,u_merc_center:x,u_image0:0,u_frustum_tl:C,u_frustum_tr:T,u_frustum_br:S,u_frustum_bl:O,u_globe_pos:k,u_globe_radius:F,u_viewport:V,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:q});function hs(p,s){return null!=p&&null!=s&&!(!p.hasData()||!s.hasData())&&null!=p.demTexture&&null!=s.demTexture&&p.tileID.key!==s.tileID.key}const Ps=new class{constructor(){this.operations={}}newMorphing(p,s,c,m,y){if(p in this.operations){const x=this.operations[p];x.to.tileID.key!==c.tileID.key&&(x.queued=c)}else this.operations[p]={startTime:m,phase:0,duration:y,from:s,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const s=this.operations[p];return{from:s.from,to:s.to,phase:s.phase}}update(p){for(const s in this.operations){const c=this.operations[s];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[s];break}}}_nextOp(p,s){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=s,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},Ln={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ql(p,s,c){if(0===s)return 0;const m=s<1&&514===c?.25/s:1;return 6*Math.pow(1.5,22-p)*Math.max(s,1)*m}function Zl(p,s){const c=1<<p.z;return!s&&(0===p.x||p.x===c-1)||0===p.y||p.y===c-1}const dl=p=>({u_matrix:p});function ur(p,s,c,m,y){if(y>0){const x=d.f.now(),C=(x-p.timeAdded)/y,T=s?(x-s.timeAdded)/y:-1,S=c.getSource(),O=m.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),k=!s||Math.abs(s.tileID.overscaledZ-O)>Math.abs(p.tileID.overscaledZ-O),F=k&&p.refreshedUponExpiration?1:d.aa(k?C:1-T,0,1);return p.refreshedUponExpiration&&C>=1&&(p.refreshedUponExpiration=!1),s?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class Fu extends Qs{constructor(s){const c={type:"raster-dem",maxzoom:s.transform.maxZoom},m=new d.bW(d.bX(),null),y=vr("mock-dem",c,m,s.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,c){s.state="loaded",c(null)}}class Nc extends Qs{constructor(s){const c=vr("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new d.bW(d.bX(),null),s.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,c,m){if(s.freezeTileCoverage)return;this.transform=s;const y=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,C)=>{if(x[C.key]="",!this._tiles[C.key]){const T=new kl(C,this._source.tileSize*C.overscaleFactor(),s.tileZoom);T.state="loaded",this._tiles[C.key]=T}return x},{});for(const x in this._tiles)x in y||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(s){const c=this.proxyCachedFBO[s];if(void 0!==c){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Os extends d.am{constructor(s,c,m){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class Nu extends d.ck{constructor(s,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,y,x]=function(S){const O=new d.aN,k=new d.aw,F=131;O.reserve(17161),k.reserve(33800);const V=d.V/128,j=d.V+V/2,q=j+V;for(let Y=-V;Y<q;Y+=V)for(let G=-V;G<q;G+=V){const J=G<0||G>j||Y<0||Y>j?24575:0,re=d.aa(Math.round(G),0,d.V),ee=d.aa(Math.round(Y),0,d.V);O.emplaceBack(re+J,ee)}const W=(Y,G)=>{const J=G*F+Y;k.emplaceBack(J+1,J,J+F),k.emplaceBack(J+F,J+F+1,J+1)};for(let Y=1;Y<129;Y++)for(let G=1;G<129;G++)W(G,Y);return[0,129].forEach(Y=>{for(let G=0;G<130;G++)W(G,Y),W(Y,G)}),[O,k,32768]}(),C=s.context;this.gridBuffer=C.createVertexBuffer(m,d.aP.members),this.gridIndexBuffer=C.createIndexBuffer(y),this.gridSegments=d.aB.simpleSegment(0,0,m.length,y.length),this.gridNoSkirtSegments=d.aB.simpleSegment(0,0,m.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Nc(c.map),this.orthoMatrix=d.a6.create(),d.a6.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,d.V,0,d.V,0,1);const T=C.gl;this._overlapStencilMode=new Qt({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Fu(c.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,c,m){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);const y=s.terrain.properties,x=0===s.terrain.drapeRenderMode,C=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=d.f.now();const T=s.terrain&&s.terrain.scope,S=y.get("source"),O=x?this._mockSourceCache:s.getSourceCache(S,T);if(!O)return void d.w(`Couldn't find terrain source "${S}".`);if(this.sourceCache=O,this._exaggeration=C?this.calculateExaggeration(c):y.get("exaggeration"),!c.projection.requiresDraping&&C&&0===this._exaggeration)return void this._disable();this.enabled=!0;const k=()=>{this.sourceCache.used&&d.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const F=this.getScaledDemTileSize();this.sourceCache.update(c,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),c.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(s){const c=this._previousCameraAltitude,m=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=m;const y=null!=c?m-c:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const x=s.zoom,C=this._style.terrain;if(!this._previousUpdateTimestamp)return C.getExaggeration(x);let T=x-this._previousZoom;const S=this._previousUpdateTimestamp;let O=x;null!=this._evaluationZoom&&(O=this._evaluationZoom,Math.abs(x-O)>.5&&(T=.5*(x-O+T)),T*y<0&&(O+=T)),this._evaluationZoom=O;const k=C.getExaggeration(O),F=k===C.getExaggeration(Math.max(0,O-.1));if(F&&Math.abs(k-this._exaggeration)<.01)return k;let V=Math.min(.1,.00375*(this._updateTimestamp-S));return(F||k<.1||Math.abs(T)<1e-4)&&(V=Math.min(.2,4*V)),d.U(this._exaggeration,k,V)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.coord&&"source"===s.dataType?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):"style"===s.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(d.L.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(S=>{const O=c.getTileByID(S).tileID;return O.projMatrix=m.calculateProjMatrix(O.toUnwrapped()),O});!function(S,O){const k=O.transform.pointCoordinate(O.transform.getCameraPoint()),F=new d.P(k.x,k.y);S.sort((V,j)=>{if(j.overscaledZ-V.overscaledZ)return j.overscaledZ-V.overscaledZ;const q=new d.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),W=new d.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),Y=F.mult(1<<V.canonical.z);return Y.x-=.5,Y.y-=.5,Y.distSqr(q)-Y.distSqr(W)})}(y,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},y.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};const C=this._style._mergedSourceCaches;for(const S in C){const O=C[S];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,s[S],x),O.usedForTerrain))continue;const k=s[S];O.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[c.id]=y.map(S=>new Os(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const T={};this._visibleDemTiles=[];for(const S of this.proxyCoords){const O=this.terrainTileForTile[S.key];if(!O)continue;const k=O.tileID.key;k in T||(this._visibleDemTiles.push(O),T[k]=k)}}_assignTerrainTiles(s){this._initializing||s.forEach(c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){const s=this.painter.context,c=s.gl;for(const m in this.terrainTileForTile){const y=this.terrainTileForTile[m],x=y.dem;!x||y.demTexture&&!y.needsDEMTextureUpload||(s.activeTexture.set(c.TEXTURE1),us(this.painter,y,x))}}_prepareDemTileUniforms(s,c,m,y){if(!c||null==c.demTexture)return!1;const x=s.tileID.canonical,C=Math.pow(2,c.tileID.canonical.z-x.z),T=y||"";return m[`u_dem_tl${T}`]=[x.x*C%1,x.y*C%1],m[`u_dem_scale${T}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const s=this.painter.context,c=s.gl;if(!this._emptyDepthBufferTexture){const m=new d.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new d.T(s,m,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let s=0;const c=this._visibleDemTiles.reduce((m,y)=>{if(!y.dem)return m;const x=y.dem.tree.minimums[0];return x>0&&s++,m+x},0);return s?c/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,c=s.gl;s.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),[y,x]=(()=>{const T=new d.cm({width:1,height:1},new Float32Array([m]));return[c.R32F,T]})();this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(x,{premultiply:!1}):C=this._emptyDEMTexture=new d.T(s,x,y,{premultiply:!1}),C}setupElevationDraw(s,c,m){const y=this.painter.context,x=y.gl,C={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};C.u_exaggeration=this.exaggeration();let T=null,S=null,O=1;if(m&&m.morphing&&this._useVertexMorphing){const V=m.morphing.srcDemTile,j=m.morphing.dstDemTile;O=m.morphing.phase,V&&j&&(this._prepareDemTileUniforms(s,V,C,"_prev")&&(S=V),this._prepareDemTileUniforms(s,j,C)&&(T=j))}const k=V=>V&&V.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST,F=V=>{C.u_dem_size=1===V.size[0]?1:V.size[0]-2};if(S&&T)y.activeTexture.set(x.TEXTURE2),T.demTexture.bind(k(T),x.CLAMP_TO_EDGE),y.activeTexture.set(x.TEXTURE4),S.demTexture.bind(k(S),x.CLAMP_TO_EDGE),T.demTexture&&F(T.demTexture),C.u_dem_lerp=O;else{T=this.terrainTileForTile[s.tileID.key],y.activeTexture.set(x.TEXTURE2);const V=this._prepareDemTileUniforms(s,T,C)?T.demTexture:this.emptyDEMTexture;V.bind(k(T),x.CLAMP_TO_EDGE),F(V)}if(y.activeTexture.set(x.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(C.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),C.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&T){const V=(1<<T.tileID.canonical.z)*d.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=V}if(m&&m.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(y,C),"globe"===this.painter.transform.projection.name){const V=this.globeUniformValues(this.painter.transform,s.tileID.canonical,m&&m.useDenormalizedUpVectorScale);c.setGlobeUniformValues(y,V)}}globeUniformValues(s,c,m){const y=s.projection;return{u_tile_tl_up:y.upVector(c,0,0),u_tile_tr_up:y.upVector(c,d.V,0),u_tile_br_up:y.upVector(c,d.V,d.V),u_tile_bl_up:y.upVector(c,0,d.V),u_tile_up_scale:m?d.cl(1):y.upVectorScale(c,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const c=this.painter,m=this.painter.context;0!==s.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,x,C,T,S){if("globe"===y.transform.projection.name)!function(O,k,F,V,j){const q=O.context,W=q.gl;let Y,G;const J=O.transform,re=d.cd(O,q,J),ee=(Pe,Ae)=>{if(G===Ae)return;const qe=[Ln[Ae],"PROJECTION_GLOBE_VIEW"];re&&qe.push("CUSTOM_ANTIALIASING");const xe=O.isTileAffectedByFog(Pe);Y=O.getOrCreateProgram("globeRaster",{defines:qe,overrideFog:xe}),G=Ae},oe=O.colorModeForRenderPass(),X=new rt(W.LEQUAL,rt.ReadWrite,O.depthRangeFor3D);Ps.update(j);const se=d.ce(J),he=[d.a5(J.center.lng),d.ae(J.center.lat)],fe=O.globeSharedBuffers,ge=[J.width*d.f.devicePixelRatio,J.height*d.f.devicePixelRatio],De=Float32Array.from(J.globeMatrix),ve={useDenormalizedUpVectorScale:!0};{const Pe=O.transform,Ae=ql(Pe.zoom,k.exaggeration(),k.sourceCache._source.tileSize);G=-1;const qe=W.TRIANGLES;for(const xe of V){const Se=F.getTile(xe),pe=Qt.disabled,Ee=k.prevTerrainTileForTile[xe.key],He=k.terrainTileForTile[xe.key];hs(Ee,He)&&Ps.newMorphing(xe.key,Ee,He,j,250),q.activeTexture.set(W.TEXTURE0),Se.texture&&Se.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const et=Ps.getMorphValuesForProxy(xe.key),Je=et?1:0;et&&d.j(ve,{morphing:{srcDemTile:et.from,dstDemTile:et.to,phase:d.cc(et.phase)}});const pt=d.cf(xe.canonical),Mt=d.cg(pt.getCenter().lat),zt=d.ch(xe.canonical,pt,Mt,Pe.worldSize/Pe._pixelsPerMercatorPixel),Ot=d.aT(d.ci(xe.canonical)),Dt=pr(Pe.expandedFarZProjMatrix,De,se,Ot,d.S(Pe.zoom),he,Pe.frustumCorners.TL,Pe.frustumCorners.TR,Pe.frustumCorners.BR,Pe.frustumCorners.BL,Pe.globeCenterInViewSpace,Pe.globeRadius,ge,Ae,Pe._farZ,zt);if(ee(xe,Je),Y&&(k.setupElevationDraw(Se,Y,ve),O.uploadCommonUniforms(q,Y,xe.toUnwrapped()),fe)){const[hn,Yt,en]=fe.getGridBuffers(Mt,0!==Ae);Y.draw(O,qe,X,pe,oe,Ut.backCCW,Dt,"globe_raster",hn,Yt,en)}}}if(fe&&(O.renderDefaultNorthPole||O.renderDefaultSouthPole)){const Pe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&Pe.push("CUSTOM_ANTIALIASING"),Y=O.getOrCreateProgram("globeRaster",{defines:Pe});for(const Ae of V){const{x:qe,y:xe,z:Se}=Ae.canonical,pe=0===xe,Ee=xe===(1<<Se)-1,[He,et,Je,pt]=fe.getPoleBuffers(Se,!1);if(pt&&(pe||Ee)){const Mt=F.getTile(Ae);q.activeTexture.set(W.TEXTURE0),Mt.texture&&Mt.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let zt=d.cj(Se,qe,J);const Ot=d.aT(d.ci(Ae.canonical)),Dt=(hn,Yt)=>hn.draw(O,W.TRIANGLES,X,Qt.disabled,oe,Ut.disabled,pr(J.expandedFarZProjMatrix,zt,zt,Ot,0,he,J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.globeCenterInViewSpace,J.globeRadius,ge,0,J._farZ),"globe_pole_raster",Yt,Je,pt);k.setupElevationDraw(Mt,Y,ve),O.uploadCommonUniforms(q,Y,Ae.toUnwrapped()),pe&&O.renderDefaultNorthPole&&Dt(Y,He),Ee&&O.renderDefaultSouthPole&&(zt=d.a6.scale(d.a6.create(),zt,[1,-1,1]),Dt(Y,et))}}}}(y,x,C,T,S);else{const O=y.context,k=O.gl;let F,V;const j=y.shadowRenderer,q=cl(y,y.longestCutoffRange),W=oe=>{if(V===oe)return;const X=[];X.push(Ln[oe]),q.shouldRenderCutoff&&X.push("RENDER_CUTOFF"),F=y.getOrCreateProgram("terrainRaster",{defines:X}),V=oe},Y=y.colorModeForRenderPass(),G=new rt(k.LEQUAL,rt.ReadWrite,y.depthRangeFor3D);Ps.update(S);const J=y.transform,re=ql(J.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let ee=[0,0,0];if(j){const oe=y.style.directionalLight,X=y.style.ambientLight;oe&&X&&(ee=Lu(oe,X))}{V=-1;const oe=k.TRIANGLES,[X,se]=[x.gridIndexBuffer,x.gridSegments];for(const he of T){const fe=C.getTile(he),ge=Qt.disabled,De=x.prevTerrainTileForTile[he.key],ve=x.terrainTileForTile[he.key];hs(De,ve)&&Ps.newMorphing(he.key,De,ve,S,250),O.activeTexture.set(k.TEXTURE0),fe.texture&&fe.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const Pe=Ps.getMorphValuesForProxy(he.key),Ae=Pe?1:0;let qe;Pe&&(qe={morphing:{srcDemTile:Pe.from,dstDemTile:Pe.to,phase:d.cc(Pe.phase)}});const xe=Ra(he.projMatrix,Zl(he.canonical,J.renderWorldCopies)?re/10:re,ee);if(W(Ae),!F)continue;x.setupElevationDraw(fe,F,qe);const Se=he.toUnwrapped();j&&j.setupShadows(Se,F),y.uploadCommonUniforms(O,F,Se,null,q),F.draw(y,oe,G,ge,Y,Ut.backCCW,xe,"terrain_raster",x.gridBuffer,X,se)}}}}(c,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(0===this._drapedRenderBatches.length)return s+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,y=this.proxySourceCache,x=this.proxiedCoords[y.id],C=this._drapedRenderBatches.shift(),T=c.style.order,S=[];let O=0;for(const k of x){const F=y.getTileByID(k.proxyTileKey),V=y.proxyCachedFBO[k.key]?y.proxyCachedFBO[k.key][s]:void 0,j=void 0!==V?y.renderCache[V]:this.pool[O++],q=void 0!==V;if(F.texture=j.tex,q&&!j.dirty){S.push(F.tileID);continue}let W;m.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(m.clear({color:d.ax.transparent,stencil:0}),j.dirty=!1);for(let Y=C.start;Y<=C.end;++Y){const G=c.style._mergedLayers[T[Y]];if(G.isHidden(c.transform.zoom))continue;const J=c.style.getLayerSourceCache(G),re=J?this.proxyToSource[k.key][J.id]:[k];if(!re)continue;const ee=re;m.viewport.set([0,0,j.fb.width,j.fb.height]),W!==(J?J.id:null)&&(this._setupStencil(j,re,G,J),W=J?J.id:null),c.renderLayer(c,J,G,ee)}if(0===this._drapedRenderBatches.length)for(const Y of this._pendingGroundEffectLayers){const G=c.style._mergedLayers[T[Y]];if(G.isHidden(c.transform.zoom))continue;const J=c.style.getLayerSourceCache(G),re=J?this.proxyToSource[k.key][J.id]:[k];if(!re)continue;const ee=re;m.viewport.set([0,0,j.fb.width,j.fb.height]),W!==(J?J.id:null)&&(this._setupStencil(j,re,G,J),W=J?J.id:null),c.renderLayer(c,J,G,ee)}this.renderedToTile?(j.dirty=!0,S.push(F.tileID)):q||--O,5===O&&(O=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),C.end+1}postRender(){}isLayerOrderingCorrect(s){const c=s.order.length;let m=-1,y=c;for(let x=0;x<c;++x)this._style.isLayerDraped(s._mergedLayers[s.order[x]])?m=Math.max(m,x):y=Math.min(y,x);return y>m}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{s=Math.min(s,c.dem.tree.minimums[0])}),0===s?s:(s-30)*this._exaggeration}raycast(s,c,m){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const C=x.tileID,T=1<<C.overscaledZ,{x:S,y:O}=C.canonical,k=S/T,F=(S+1)/T,V=O/T,j=(O+1)/T;return{minx:k,miny:V,maxx:F,maxy:j,t:x.dem.tree.raycastRoot(k,V,F,j,s,c,m),tile:x}});y.sort((x,C)=>(null!==x.t?x.t:Number.MAX_VALUE)-(null!==C.t?C.t:Number.MAX_VALUE));for(const x of y){if(null==x.t)return null;const C=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,s,c,m);if(null!=C)return C}return null}_createFBO(){const s=this.painter.context,c=s.gl,m=this.drapeBufferSize;s.activeTexture.set(c.TEXTURE0);const y=new d.T(s,{width:m[0],height:m[1],data:null},c.RGBA);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const x=s.createFramebuffer(m[0],m[1],!0,null);return x.colorAttachment.set(y.texture),x.depthAttachment=new xt(s,x.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:x,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const c=this._style._mergedLayers[s],m=c.isHidden(this.painter.transform.zoom);return"custom"===c.type?!m&&c.shouldRedrape():!m&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const m of this._style.getSources())if(m instanceof tt){s=!0;break}if(!s)return;const c={};for(let m=0;m<this._style.order.length;++m){const y=this._style._mergedLayers[this._style.order[m]],x=this._style.getLayerSourceCache(y);if(x&&!c[x.id]&&!y.isHidden(this.painter.transform.zoom)&&"line"===y.type&&y.widthExpression()instanceof d.Z){c[x.id]=!0;for(const C of this.proxyCoords){const T=this.proxyToSource[C.key][x.id];if(T)for(const S of T)this._clearRenderCacheForTile(x.id,S)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof mt){s=!0;break}if(!s)return;const c={};for(let m=0;m<this._style.order.length;++m){const y=this._style._mergedLayers[this._style.order[m]],x=this._style.getLayerSourceCache(y);if(!x||c[x.id]||y.isHidden(this.painter.transform.zoom)||"raster"!==y.type)continue;const C=y.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const S=this.proxyToSource[T.key][x.id];if(S)for(const O of S){const k=ur(x.getTile(O),x.findLoadedParent(O,0),x,this.painter.transform,C);(1!==k.opacity||0!==k.mix)&&this._clearRenderCacheForTile(x.id,O)}}}}_setupDrapedRenderBatches(){const s=this._style.order,c=s.length;if(0===c)return;const m=[];this._pendingGroundEffectLayers=[];let y,x=0,C=this._style._mergedLayers[s[x]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++x<c;)C=this._style._mergedLayers[s[x]];for(;x<c;++x){const T=this._style._mergedLayers[s[x]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?void 0===y&&(y=x):("fill-extrusion"===T.type&&this._pendingGroundEffectLayers.push(x),void 0!==y&&(m.push({start:y,end:x-1}),y=void 0)))}if(void 0!==y&&m.push({start:y,end:x-1}),0!==m.length){const T=m[m.length-1];this._pendingGroundEffectLayers.every(S=>S>T.end)||d.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(s){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const C=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let T=0;T<C.length;++T){const S=Object.values(C[T]);c.renderCachePool.push(...S)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,y=this._tilesDirty;for(let C=m.length-1;C>=0;C--){const T=m[C];if(c.getTileByID(T.key),void 0!==c.proxyCachedFBO[T.key]){const S=s[T.key],O=this.proxyToSource[T.key];let k=0;for(const F in O){const V=O[F],j=S[F];if(!j||j.length!==V.length||V.some((q,W)=>q!==j[W]||y[F]&&y[F].hasOwnProperty(q.key))){k=-1;break}++k}for(const F in c.proxyCachedFBO[T.key])c.renderCache[c.proxyCachedFBO[T.key][F]].dirty=k<0||k!==Object.values(S).length}}const x=[...this._drapedRenderBatches];x.sort((C,T)=>T.end-T.start-(C.end-C.start));for(const C of x)for(const T of m){if(c.proxyCachedFBO[T.key])continue;let S=c.renderCachePool.pop();void 0===S&&c.renderCache.length<50&&(S=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==S&&(c.proxyCachedFBO[T.key]={},c.proxyCachedFBO[T.key][C.start]=S,c.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(s,c,m,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,C=x.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let T;if(m.isTileClipped())T=c.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):Qt.disabled}_renderTileClippingMasks(s,c){const m=this.painter,y=this.painter.context,x=y.gl;m._tileClippingMaskIDs={},y.setColorMode(mn.disabled),y.setDepthMode(rt.disabled);const C=m.getOrCreateProgram("clippingMask");for(const T of s){const S=m._tileClippingMaskIDs[T.key]=--c;C.draw(m,x.TRIANGLES,rt.disabled,new Qt({func:x.ALWAYS,mask:0},S,255,x.KEEP,x.KEEP,x.REPLACE),mn.disabled,Ut.disabled,dl(T.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(s){const c=this.painter.transform;if(s.x<0||s.x>c.width||s.y<0||s.y>c.height)return null;const m=[s.x,s.y,1,1];d.a7.transformMat4(m,m,c.pixelMatrixInverse),d.a7.scale(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const y=c._camera.position,x=d.bl(1,c.center.lat),C=[y[0],y[1],y[2]/x,0],T=d.N.subtract([],m.slice(0,3),C);d.N.normalize(T,T);const S=this.raycast(C,T,this._exaggeration);return null!==S&&S?(d.N.scaleAndAdd(C,C,T,S),C[3]=C[2],C[2]*=x,C):null}drawDepth(){const s=this.painter,c=s.context,m=this.proxySourceCache,y=Math.ceil(s.width),x=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const C=c.gl,T=c.createFramebuffer(y,x,!0,"renderbuffer");c.activeTexture.set(C.TEXTURE0);const S=new d.T(c,{width:y,height:x,data:null},C.RGBA);S.bind(C.NEAREST,C.CLAMP_TO_EDGE),T.colorAttachment.set(S.texture);const O=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,y,x);T.depthAttachment.set(O),this._depthFBO=T,this._depthTexture=S}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,y,x]),function(C,T,S,O){if("globe"===C.transform.projection.name)return;const k=C.context,F=k.gl;k.clear({depth:1});const V=C.getOrCreateProgram("terrainDepth"),j=new rt(F.LESS,rt.ReadWrite,C.depthRangeFor3D);for(const q of O){const W=S.getTile(q),Y=Ra(q.projMatrix,0,[0,0,0]);T.setupElevationDraw(W,V),V.draw(C,F.TRIANGLES,j,Qt.disabled,mn.unblended,Ut.backCCW,Y,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(s,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,c,m){if(s.getSource()instanceof d.ap)return this._setupProxiedCoordsForImageSource(s,c,m);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const y=this.proxiedCoords[s.id]=[],x=this.proxyCoords;for(let S=0;S<x.length;S++){const O=x[S],k=this._findTileCoveringTileID(O,s);if(k){const F=this._createProxiedId(O,k,m[O.key]&&m[O.key][s.id]);y.push(F),this.proxyToSource[O.key][s.id]=[F]}}let C=!1;const T=new Set;for(let S=0;S<c.length;S++){const O=s.getTile(c[S]);if(!O||!O.hasData())continue;const k=this._findTileCoveringTileID(O.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==O.tileID.canonical.z){const F=this.proxyToSource[k.tileID.key][s.id],V=this._createProxiedId(k.tileID,O,m[k.tileID.key]&&m[k.tileID.key][s.id]);F?F.splice(F.length-1,0,V):this.proxyToSource[k.tileID.key][s.id]=[V];const j=this.proxyToSource[k.tileID.key][s.id];T.has(j)||T.add(j),y.push(V),C=!0}}if(this._sourceTilesOverlap[s.id]=C,C&&this._debugParams.sortTilesHiZFirst)for(const S of T)S.sort((O,k)=>k.overscaledZ-O.overscaledZ)}_setupProxiedCoordsForImageSource(s,c,m){if(!s.getSource().loaded())return;const y=this.proxiedCoords[s.id]=[],x=this.proxyCoords,C=s.getSource(),T=C.tileID;if(!T)return;const S=new d.P(T.x,T.y)._div(1<<T.z),O=C.coordinates.map(d.L.fromLngLat).reduce((F,V)=>(F.min.x=Math.min(F.min.x,V.x-S.x),F.min.y=Math.min(F.min.y,V.y-S.y),F.max.x=Math.max(F.max.x,V.x-S.x),F.max.y=Math.max(F.max.y,V.y-S.y),F),{min:new d.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(F,V)=>{const j=F.wrap+F.canonical.x/(1<<F.canonical.z),q=F.canonical.y/(1<<F.canonical.z),W=d.V/(1<<F.canonical.z),Y=V.wrap+V.canonical.x/(1<<V.canonical.z),G=V.canonical.y/(1<<V.canonical.z);return j+W<Y+O.min.x||j>Y+O.max.x||q+W<G+O.min.y||q>G+O.max.y};for(let F=0;F<x.length;F++){const V=x[F];for(let j=0;j<c.length;j++){const q=s.getTile(c[j]);if(!q||!q.hasData()||k(V,q.tileID))continue;const W=this._createProxiedId(V,q,m[V.key]&&m[V.key][s.id]),Y=this.proxyToSource[V.key][s.id];Y?Y.push(W):this.proxyToSource[V.key][s.id]=[W],y.push(W)}}}_createProxiedId(s,c,m){let y=this.orthoMatrix;if(m){const x=m.find(C=>C.key===c.tileID.key);if(x)return x}if(c.tileID.key!==s.key){const x=s.canonical.z-c.tileID.canonical.z;let C,T,S;y=d.a6.create();const O=c.tileID.wrap-s.wrap<<s.overscaledZ;x>0?(C=d.V>>x,T=C*((c.tileID.canonical.x<<x)-s.canonical.x+O),S=C*((c.tileID.canonical.y<<x)-s.canonical.y)):(C=d.V<<-x,T=d.V*(c.tileID.canonical.x-(s.canonical.x+O<<-x)),S=d.V*(c.tileID.canonical.y-(s.canonical.y<<-x))),d.a6.ortho(y,0,C,0,C,0,1),d.a6.translate(y,y,[T,S,0])}return new Os(c.tileID,s.key,y)}_findTileCoveringTileID(s,c){let m=c.getTile(s);if(m&&m.hasData())return m;const y=this._findCoveringTileCache[c.id],x=y[s.key];if(m=x?c.getTileByID(x):null,m&&m.hasData()||null===x)return m;let C=m?m.tileID:s,T=C.overscaledZ;const S=c.getSource().minzoom,O=[];if(!x){const F=c.getSource().maxzoom;if(s.canonical.z>=F){const V=s.canonical.z-F;c.getSource().reparseOverscaled?(T=Math.max(s.canonical.z+2,c.transform.tileZoom),C=new d.am(T,s.wrap,F,s.canonical.x>>V,s.canonical.y>>V)):0!==V&&(T=F,C=new d.am(T,s.wrap,F,s.canonical.x>>V,s.canonical.y>>V))}C.key!==s.key&&(O.push(C.key),m=c.getTile(C))}const k=F=>{O.forEach(V=>{y[V]=F}),O.length=0};for(T-=1;T>=S&&(!m||!m.hasData());T--){m&&k(m.tileID.key);const F=C.calculateScaledKey(T);if(m=c.getTileByID(F),m&&m.hasData())break;const V=y[F];if(null===V)break;void 0===V?O.push(F):m=c.getTileByID(V)}return k(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,c){let m=this._tilesDirty[s];m||(m=this._tilesDirty[s]={}),m[c.key]=!0}}function hd(p,s,c){const m=function(T,S,O){const k=d.N.dot(S,T),F=d.N.dot(O,[.2126,.7152,.0722]),V=(q,W,Y)=>(1-Y)*q+Y*W,j=V(1-.3*Math.min(F,1),1,Math.min(k+1,1));return V(.92,1,Math.asin(d.aa(S[2],-1,1))/Math.PI+.5)*j}(p,[0,0,1],s),y=[0,0,0];d.N.scale(y,c.slice(0,3),m);const x=[0,0,0];d.N.scale(x,s.slice(0,3),p[2]);const C=[0,0,0];return d.N.add(C,y,x),d.bU(C)}const ia=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ra=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Wl{static cacheKey(s,c,m,y){let x=`${c}${y?y.cacheKey:""}`;for(const C of m)s.usedDefines.includes(C)&&(x+=`/${C}`);return x}constructor(s,c,m,y,x,C,T){const S=s.gl;this.program=S.createProgram(),this.configuration=y,this.name=c,this.fixedDefines=[...C];const O=y?y.getBinderAttributes():[],k=(m.staticAttributes||[]).concat(O);let F=y?y.defines():[];F=F.concat(C.map(G=>`#define ${G}`));const V="#version 300 es\n";let j=V+F.concat("precision mediump float;",Gl,ud.fragmentSource).join("\n");for(const G of m.fragmentIncludes)j+=`\n${or[G]}`;j+=`\n${m.fragmentSource}`;let q=V+F.concat("precision highp float;",Gl,ud.vertexSource).join("\n");for(const G of m.vertexIncludes)q+=`\n${or[G]}`;q+=`\n${m.vertexSource}`;const W=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(W,j),S.compileShader(W),S.attachShader(this.program,W);const Y=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(Y,q),S.compileShader(Y),S.attachShader(this.program,Y),this.attributes={},this.numAttributes=k.length;for(let G=0;G<this.numAttributes;G++)if(k[G]){const J=k[G].startsWith("a_")?k[G]:`a_${k[G]}`;S.bindAttribLocation(this.program,G,J),this.attributes[J]=G}T&&T.shaderVaryings.length>0&&S.transformFeedbackVaryings(this.program,T.shaderVaryings,T.bufferMode),S.linkProgram(this.program),S.deleteShader(Y),S.deleteShader(W),this.fixedUniforms=x(s),this.binderUniforms=y?y.getUniforms(s):[],C.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new d.bO(G=s),u_dem_prev:new d.bO(G),u_dem_tl:new d.bL(G),u_dem_scale:new d.bN(G),u_dem_tl_prev:new d.bL(G),u_dem_scale_prev:new d.bN(G),u_dem_size:new d.bN(G),u_dem_lerp:new d.bN(G),u_exaggeration:new d.bN(G),u_depth:new d.bO(G),u_depth_size_inv:new d.bL(G),u_meter_to_dem:new d.bN(G),u_label_plane_matrix_inv:new d.bK(G)}),C.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new d.bM(G),u_tile_tr_up:new d.bM(G),u_tile_br_up:new d.bM(G),u_tile_bl_up:new d.bM(G),u_tile_up_scale:new d.bN(G)}))(s)),C.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new d.bK(G),u_fog_range:new d.bL(G),u_fog_color:new d.bP(G),u_fog_horizon_blend:new d.bN(G),u_fog_vertical_limit:new d.bL(G),u_fog_temporal_offset:new d.bN(G),u_frustum_tl:new d.bM(G),u_frustum_tr:new d.bM(G),u_frustum_br:new d.bM(G),u_frustum_bl:new d.bM(G),u_globe_pos:new d.bM(G),u_globe_radius:new d.bN(G),u_globe_transition:new d.bN(G),u_is_globe:new d.bO(G),u_viewport:new d.bL(G)}))(s)),C.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(G=>({u_cutoff_params:new d.bP(G)}))(s)),C.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(G=>({u_lighting_ambient_color:new d.bM(G),u_lighting_directional_dir:new d.bM(G),u_lighting_directional_color:new d.bM(G),u_ground_radiance:new d.bM(G)}))(s)),C.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(G=>({u_light_matrix_0:new d.bK(G),u_light_matrix_1:new d.bK(G),u_fade_range:new d.bL(G),u_shadow_normal_offset:new d.bM(G),u_shadow_intensity:new d.bN(G),u_shadow_texel_size:new d.bN(G),u_shadow_map_resolution:new d.bN(G),u_shadow_direction:new d.bM(G),u_shadow_bias:new d.bM(G),u_shadowmap_0:new d.bO(G),u_shadowmap_1:new d.bO(G)}))(s))}var G}setTerrainUniformValues(s,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const y in c)m[y]&&m[y].set(this.program,y,c[y])}}setGlobeUniformValues(s,c){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const y in c)m[y]&&m[y].set(this.program,y,c[y])}}setFogUniformValues(s,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const y in c)m[y].set(this.program,y,c[y])}}setCutoffUniformValues(s,c){if(!this.cutoffUniforms)return;const m=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const y in c)m[y].set(this.program,y,c[y])}}setLightsUniformValues(s,c){if(!this.lightsUniforms)return;const m=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const y in c)m[y].set(this.program,y,c[y])}}setShadowUniformValues(s,c){if(this.failedToCreate||!this.shadowUniforms)return;const m=this.shadowUniforms;s.program.set(this.program);for(const y in c)m[y].set(this.program,y,c[y])}_drawDebugWireframe(s,c,m,y,x,C,T,S,O,k){const F=s.options.wireframe;if(!1===F.terrain&&!1===F.layers2D&&!1===F.layers3D)return;const V=s.context;if(!(()=>!(!F.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!F.layers2D||s._terrain&&s._terrain.renderingToTexture||!ia.includes(this.name))||!(!F.layers3D||!ra.includes(this.name)))())return;const j=V.gl,q=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,x,V);if(!q)return;const W=[...this.fixedDefines];W.push("DEBUG_WIREFRAME");const Y=s.getOrCreateProgram(this.name,{config:this.configuration,defines:W});V.program.set(Y.program);const G=(ee,oe,X)=>{if(oe[ee]&&X[ee])for(const se in oe[ee])X[ee][se]&&X[ee][se].set(X.program,se,oe[ee][se].current)};O&&O.setUniforms(Y.program,V,Y.binderUniforms,T,{zoom:S}),G("fixedUniforms",this,Y),G("terrainUniforms",this,Y),G("globeUniforms",this,Y),G("fogUniforms",this,Y),G("lightsUniforms",this,Y),G("shadowUniforms",this,Y),q.bind(),V.setColorMode(new mn([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],d.ax.transparent,[!0,!0,!0,!1])),V.setDepthMode(new rt(c.func===j.LESS?j.LEQUAL:c.func,rt.ReadOnly,c.range)),V.setStencilMode(Qt.disabled);const J=3*C.primitiveLength*2,re=3*C.primitiveOffset*2*2;k&&k>1?j.drawElementsInstanced(j.LINES,J,j.UNSIGNED_SHORT,re,k):j.drawElements(j.LINES,J,j.UNSIGNED_SHORT,re),x.bind(),V.program.set(this.program),V.setDepthMode(c),V.setStencilMode(m),V.setColorMode(y)}draw(s,c,m,y,x,C,T,S,O,k,F,V,j,q,W,Y,G){const J=s.context,re=J.gl;if(this.failedToCreate)return;J.program.set(this.program),J.setDepthMode(m),J.setStencilMode(y),J.setColorMode(x),J.setCullFace(C);for(const se of Object.keys(this.fixedUniforms))this.fixedUniforms[se].set(this.program,se,T[se]);q&&q.setUniforms(this.program,J,this.binderUniforms,V,{zoom:j});const ee={[re.POINTS]:1,[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[c],oe=G&&G.length>0;if(oe){for(const se of G)re.bindBufferBase(re.TRANSFORM_FEEDBACK_BUFFER,se.targetIndex,se.buffer.buffer);re.beginTransformFeedback(c)}const X=Y&&Y>0?1:void 0;for(const se of F.get()){const he=se.vaos||(se.vaos={});(he[S]||(he[S]=new Gt)).bind(J,this,O,q?q.getPaintVertexBuffers():[],k,se.vertexOffset,W||[],X),Y&&Y>1?re.drawElementsInstanced(c,se.primitiveLength*ee,re.UNSIGNED_SHORT,se.primitiveOffset*ee*2,Y):k?re.drawElements(c,se.primitiveLength*ee,re.UNSIGNED_SHORT,se.primitiveOffset*ee*2):re.drawArrays(c,se.vertexOffset,se.vertexLength),c===re.TRIANGLES&&k&&this._drawDebugWireframe(s,m,y,x,k,se,V,j,q,Y)}oe&&re.endTransformFeedback()}}function Yl(p,s){const c=Math.pow(2,s.tileID.overscaledZ),m=s.tileSize*Math.pow(2,p.transform.tileZoom)/c,y=m*(s.tileID.canonical.x+s.tileID.wrap*c),x=m*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/d.a3(s,1,p.transform.tileZoom),u_pixel_coord_upper:[y>>16,x>>16],u_pixel_coord_lower:[65535&y,65535&x]}}const li=d.a6.create(),Dm=(p,s,c,m,y,x,C,T,S,O,k,F,V,j,q,W)=>{const Y=s.style.light,G=Y.properties.get("position"),J=[G.x,G.y,G.z],re=d.co.create();"viewport"===Y.properties.get("anchor")&&(d.co.fromRotation(re,-s.transform.angle),d.N.transformMat3(J,J,re));const ee=Y.properties.get("color"),oe=s.transform,X={u_matrix:p,u_lightpos:J,u_lightintensity:Y.properties.get("intensity"),u_lightcolor:[ee.r,ee.g,ee.b],u_vertical_gradient:+c,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:li,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:y,u_edge_radius:x,u_flood_light_color:F,u_vertical_scale:V,u_flood_light_intensity:j,u_ground_shadow_factor:q,u_emissive_strength:W};return"globe"===oe.projection.name&&(X.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],X.u_zoom_transition=S,X.u_inv_rot_matrix=k,X.u_merc_center=O,X.u_up_dir=oe.projection.upVector(new d.bs(0,0,0),O[0]*d.V,O[1]*d.V),X.u_height_lift=T),X},zu=(p,s,c)=>({u_matrix:p,u_edge_radius:s,u_vertical_scale:c}),fl=(p,s,c,m,y,x,C,T,S,O,k,F,V,j)=>{const q=Dm(p,s,c,m,y,x,C,S,O,k,F,V,j,1,[0,0,0],0),W={u_height_factor:-Math.pow(2,C.overscaledZ)/T.tileSize/8};return d.e(q,Yl(s,T),W)},_o=(p,s)=>({u_matrix:p,u_emissive_strength:s}),zc=(p,s,c,m)=>d.e(_o(p,s),Yl(c,m)),ds=(p,s,c)=>({u_matrix:p,u_world:c,u_emissive_strength:s}),Bc=(p,s,c,m,y)=>d.e(zc(p,s,c,m),{u_world:y}),Mr=(p,s,c,m)=>{const y=d.V/c.tileSize;return{u_matrix:p,u_camera_to_center_distance:s.getCameraToCenterDistance(m),u_extrude_scale:[s.pixelsToGLUnits[0]/y,s.pixelsToGLUnits[1]/y]}},Tm=(p,s,c=1)=>({u_matrix:p,u_color:s,u_overlay:0,u_overlay_scale:c}),yo=d.a6.create(),Xr=(p,s,c,m,y,x,C)=>{const T=p.transform,S="globe"===T.projection.name,O=S?d.cp(T.zoom,s.canonical)*T._pixelsPerMercatorPixel:d.a3(c,1,x),k={u_matrix:s.projMatrix,u_extrude_scale:O,u_intensity:C,u_inv_rot_matrix:yo,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){k.u_inv_rot_matrix=m,k.u_merc_center=y,k.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],k.u_zoom_transition=d.S(T.zoom);const F=y[0]*d.V,V=y[1]*d.V;k.u_up_dir=T.projection.upVector(new d.bs(0,0,0),F,V)}return k};function Vc(p,[s,c,m,y],[x,C]){if(x===C)return[0,0,0,0];const T=255*(p-1)/(p*(C-x));return[s*T,c*T,m*T,y*T]}function pl(p,s,[c,m]){return c===m?0:.5/p+(s-c)*(p-1)/(p*(m-c))}const jc=(p,s,c,m,y,x,C,T,S,O,k,F,V,j,q,W,Y,G,J,re,ee)=>{return{u_matrix:p,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:m,u_grid_matrix:y,u_tl_parent:x,u_scale_parent:O,u_fade_t:k.mix,u_opacity:k.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:(X=F.paint.get("raster-saturation"),X>0?1-1/(1.001-X):-X),u_contrast_factor:(oe=F.paint.get("raster-contrast"),oe>0?1/(1-oe):1+oe),u_spin_weights:vo(F.paint.get("raster-hue-rotate")),u_perspective_transform:V,u_raster_elevation:j,u_zoom_transition:C,u_merc_center:T,u_cutoff_params:S,u_colorization_mix:Vc(d.cq,W,G),u_colorization_offset:pl(d.cq,Y,G),u_color_ramp:q,u_texture_offset:[re/(J+2*re),J/(J+2*re)],u_texture_res:[J+2*re,J+2*re],u_emissive_strength:ee};var oe,X};function vo(p){p*=Math.PI/180;const s=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}const zf=(p,s,c,m,y,x,C,T,S,O,k,F)=>({u_matrix:p,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:m,u_grid_matrix:y,u_tl_parent:x,u_scale_parent:O,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:C,u_merc_center:T,u_cutoff_params:S}),F_=(p,s,c,m,y,x,C,T)=>({u_tile_offset:p,u_velocity:s,u_color_ramp:m,u_velocity_res:c,u_max_speed:y,u_texture_offset:x,u_data_scale:C,u_data_offset:T}),Mm=(p,s,c,m,y,x,C,T)=>({u_velocity:p,u_velocity_res:s,u_max_speed:c,u_speed_factor:m,u_lifetime_delta:y,u_rand_seed:Math.random(),u_texture_offset:x,u_data_scale:C,u_data_offset:T}),N_=d.a6.create(),dd=(p,s,c,m,y,x,C,T,S,O,k,F,V,j,q,W,Y,G)=>{const J=y.transform,re={u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:J.getCameraToCenterDistance(W),u_rotate_symbol:+c,u_aspect_ratio:J.width/J.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:C,u_coord_matrix:T,u_is_text:+S,u_pitch_with_map:+m,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:N_,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:N_,u_up_vector:[0,-1,0],u_icon_transition:G||0,u_icon_saturation:Y};return"globe"===W.name&&(re.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],re.u_zoom_transition=F,re.u_inv_rot_matrix=j,re.u_merc_center=V,re.u_camera_forward=J._camera.forward(),re.u_ecef_origin=d.cr(J.globeMatrix,k.toUnwrapped()),re.u_tile_matrix=Float32Array.from(J.globeMatrix),re.u_up_vector=q),re},Bu=(p,s,c,m,y,x,C,T,S,O,k,F,V,j,q,W,Y)=>d.e(dd(p,s,c,m,y,x,C,T,S,O,F,V,j,q,W,Y,1),{u_gamma_scale:m?y.transform.getCameraToCenterDistance(Y)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:d.f.devicePixelRatio,u_is_halo:+k,undefined:void 0}),Bf=(p,s,c,m,y,x,C,T,S,O,k,F,V,j,q,W)=>d.e(Bu(p,s,c,m,y,x,C,T,!0,S,!0,k,F,V,j,q,W),{u_texsize_icon:O,u_texture_icon:1}),Im=(p,s,c,m)=>({u_matrix:p,u_emissive_strength:s,u_opacity:c,u_color:m}),fd=(p,s,c,m,y,x,C)=>d.e(function(T,S,O,k){const F=O.imageManager.getPattern(T.toString(),S),{width:V,height:j}=O.imageManager.getPixelSize(S),q=Math.pow(2,k.tileID.overscaledZ),W=k.tileSize*Math.pow(2,O.transform.tileZoom)/q,Y=W*(k.tileID.canonical.x+k.tileID.wrap*q),G=W*k.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[V,j],u_pattern_size:F.displaySize,u_tile_units_to_pixels:1/d.a3(k,1,O.transform.tileZoom),u_pixel_coord_upper:[Y>>16,G>>16],u_pixel_coord_lower:[65535&Y,65535&G]}}(y,x,m,C),{u_matrix:p,u_emissive_strength:s,u_opacity:c}),Vf=(p,s,c,m,y,x,C,T,S,O,k,F,V=[0,0,0],j)=>{const q=m.style.light,W=q.properties.get("position"),Y=[-W.x,-W.y,W.z],G=d.co.create();"viewport"===q.properties.get("anchor")&&(d.co.fromRotation(G,-m.transform.angle),d.N.transformMat3(Y,Y,G));const J="MASK"===O.alphaMode,re=q.properties.get("color"),ee=F.paint.get("model-ambient-occlusion-intensity"),oe=F.paint.get("model-color").constantOr(d.ax.white),X=F.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:p,u_lighting_matrix:s,u_normal_matrix:c,u_lightpos:Y,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[re.r,re.g,re.b],u_camera_pos:V,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+J,u_alphaCutoff:O.alphaCutoff,u_baseColorFactor:[x.r,x.g,x.b,x.a],u_emissiveFactor:[C[0],C[1],C[2],1],u_metallicFactor:T,u_roughnessFactor:S,u_baseColorTexture:kr.BaseColor,u_metallicRoughnessTexture:kr.MetallicRoughness,u_normalTexture:kr.Normal,u_occlusionTexture:kr.Occlusion,u_emissionTexture:kr.Emission,u_color_mix:[oe.r,oe.g,oe.b,X],u_aoIntensity:ee,u_emissive_strength:k,u_occlusionTextureTransform:j||[0,0,0,0]}},pd=new Float32Array(16),md=(p,s=pd,c=pd)=>({u_matrix:p,u_instance:s,u_node_matrix:c}),_0={fillExtrusion:p=>({u_matrix:new d.bK(p),u_lightpos:new d.bM(p),u_lightintensity:new d.bN(p),u_lightcolor:new d.bM(p),u_vertical_gradient:new d.bN(p),u_opacity:new d.bN(p),u_edge_radius:new d.bN(p),u_ao:new d.bL(p),u_tile_id:new d.bM(p),u_zoom_transition:new d.bN(p),u_inv_rot_matrix:new d.bK(p),u_merc_center:new d.bL(p),u_up_dir:new d.bM(p),u_height_lift:new d.bN(p),u_flood_light_color:new d.bM(p),u_vertical_scale:new d.bN(p),u_flood_light_intensity:new d.bN(p),u_ground_shadow_factor:new d.bM(p),u_emissive_strength:new d.bN(p)}),fillExtrusionDepth:p=>({u_matrix:new d.bK(p),u_edge_radius:new d.bN(p),u_vertical_scale:new d.bN(p)}),fillExtrusionPattern:p=>({u_matrix:new d.bK(p),u_lightpos:new d.bM(p),u_lightintensity:new d.bN(p),u_lightcolor:new d.bM(p),u_vertical_gradient:new d.bN(p),u_height_factor:new d.bN(p),u_edge_radius:new d.bN(p),u_ao:new d.bL(p),u_tile_id:new d.bM(p),u_zoom_transition:new d.bN(p),u_inv_rot_matrix:new d.bK(p),u_merc_center:new d.bL(p),u_up_dir:new d.bM(p),u_height_lift:new d.bN(p),u_image:new d.bO(p),u_texsize:new d.bL(p),u_pixel_coord_upper:new d.bL(p),u_pixel_coord_lower:new d.bL(p),u_tile_units_to_pixels:new d.bN(p),u_opacity:new d.bN(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new d.bK(p),u_opacity:new d.bN(p),u_ao_pass:new d.bN(p),u_meter_to_tile:new d.bN(p),u_ao:new d.bL(p),u_flood_light_intensity:new d.bN(p),u_flood_light_color:new d.bM(p),u_attenuation:new d.bN(p),u_edge_radius:new d.bN(p),u_fb:new d.bO(p),u_fb_size:new d.bN(p)}),fill:p=>({u_matrix:new d.bK(p),u_emissive_strength:new d.bN(p)}),fillPattern:p=>({u_matrix:new d.bK(p),u_emissive_strength:new d.bN(p),u_image:new d.bO(p),u_texsize:new d.bL(p),u_pixel_coord_upper:new d.bL(p),u_pixel_coord_lower:new d.bL(p),u_tile_units_to_pixels:new d.bN(p)}),fillOutline:p=>({u_matrix:new d.bK(p),u_emissive_strength:new d.bN(p),u_world:new d.bL(p)}),fillOutlinePattern:p=>({u_matrix:new d.bK(p),u_emissive_strength:new d.bN(p),u_world:new d.bL(p),u_image:new d.bO(p),u_texsize:new d.bL(p),u_pixel_coord_upper:new d.bL(p),u_pixel_coord_lower:new d.bL(p),u_tile_units_to_pixels:new d.bN(p)}),circle:d.cs,collisionBox:p=>({u_matrix:new d.bK(p),u_camera_to_center_distance:new d.bN(p),u_extrude_scale:new d.bL(p)}),collisionCircle:p=>({u_matrix:new d.bK(p),u_inv_matrix:new d.bK(p),u_camera_to_center_distance:new d.bN(p),u_viewport_size:new d.bL(p)}),debug:p=>({u_color:new d.ca(p),u_matrix:new d.bK(p),u_overlay:new d.bO(p),u_overlay_scale:new d.bN(p)}),clippingMask:p=>({u_matrix:new d.bK(p)}),heatmap:p=>({u_extrude_scale:new d.bN(p),u_intensity:new d.bN(p),u_matrix:new d.bK(p),u_inv_rot_matrix:new d.bK(p),u_merc_center:new d.bL(p),u_tile_id:new d.bM(p),u_zoom_transition:new d.bN(p),u_up_dir:new d.bM(p)}),heatmapTexture:p=>({u_image:new d.bO(p),u_color_ramp:new d.bO(p),u_opacity:new d.bN(p)}),hillshade:p=>({u_matrix:new d.bK(p),u_image:new d.bO(p),u_latrange:new d.bL(p),u_light:new d.bL(p),u_shadow:new d.ca(p),u_highlight:new d.ca(p),u_emissive_strength:new d.bN(p),u_accent:new d.ca(p)}),hillshadePrepare:p=>({u_matrix:new d.bK(p),u_image:new d.bO(p),u_dimension:new d.bL(p),u_zoom:new d.bN(p)}),line:d.ct,linePattern:d.cu,raster:p=>({u_matrix:new d.bK(p),u_normalize_matrix:new d.bK(p),u_globe_matrix:new d.bK(p),u_merc_matrix:new d.bK(p),u_grid_matrix:new d.cb(p),u_tl_parent:new d.bL(p),u_scale_parent:new d.bN(p),u_fade_t:new d.bN(p),u_opacity:new d.bN(p),u_image0:new d.bO(p),u_image1:new d.bO(p),u_brightness_low:new d.bN(p),u_brightness_high:new d.bN(p),u_saturation_factor:new d.bN(p),u_contrast_factor:new d.bN(p),u_spin_weights:new d.bM(p),u_perspective_transform:new d.bL(p),u_raster_elevation:new d.bN(p),u_zoom_transition:new d.bN(p),u_merc_center:new d.bL(p),u_cutoff_params:new d.bP(p),u_colorization_mix:new d.bP(p),u_colorization_offset:new d.bN(p),u_color_ramp:new d.bO(p),u_texture_offset:new d.bL(p),u_texture_res:new d.bL(p),u_emissive_strength:new d.bN(p)}),rasterParticle:p=>({u_matrix:new d.bK(p),u_normalize_matrix:new d.bK(p),u_globe_matrix:new d.bK(p),u_merc_matrix:new d.bK(p),u_grid_matrix:new d.cb(p),u_tl_parent:new d.bL(p),u_scale_parent:new d.bN(p),u_fade_t:new d.bN(p),u_opacity:new d.bN(p),u_image0:new d.bO(p),u_image1:new d.bO(p),u_raster_elevation:new d.bN(p),u_zoom_transition:new d.bN(p),u_merc_center:new d.bL(p),u_cutoff_params:new d.bP(p)}),rasterParticleTexture:p=>({u_texture:new d.bO(p),u_opacity:new d.bN(p)}),rasterParticleDraw:p=>({u_tile_offset:new d.bL(p),u_velocity:new d.bO(p),u_color_ramp:new d.bO(p),u_velocity_res:new d.bL(p),u_max_speed:new d.bN(p),u_texture_offset:new d.bL(p),u_data_scale:new d.bP(p),u_data_offset:new d.bN(p)}),rasterParticleUpdate:p=>({u_velocity:new d.bO(p),u_velocity_res:new d.bL(p),u_max_speed:new d.bN(p),u_speed_factor:new d.bN(p),u_lifetime_delta:new d.bN(p),u_rand_seed:new d.bN(p),u_texture_offset:new d.bL(p),u_data_scale:new d.bP(p),u_data_offset:new d.bN(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new d.bO(p),u_is_size_feature_constant:new d.bO(p),u_size_t:new d.bN(p),u_size:new d.bN(p),u_camera_to_center_distance:new d.bN(p),u_rotate_symbol:new d.bO(p),u_aspect_ratio:new d.bN(p),u_fade_change:new d.bN(p),u_matrix:new d.bK(p),u_label_plane_matrix:new d.bK(p),u_coord_matrix:new d.bK(p),u_is_text:new d.bO(p),u_pitch_with_map:new d.bO(p),u_texsize:new d.bL(p),u_tile_id:new d.bM(p),u_zoom_transition:new d.bN(p),u_inv_rot_matrix:new d.bK(p),u_merc_center:new d.bL(p),u_camera_forward:new d.bM(p),u_tile_matrix:new d.bK(p),u_up_vector:new d.bM(p),u_ecef_origin:new d.bM(p),u_texture:new d.bO(p),u_icon_transition:new d.bN(p),u_icon_saturation:new d.bN(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new d.bO(p),u_is_size_feature_constant:new d.bO(p),u_size_t:new d.bN(p),u_size:new d.bN(p),u_camera_to_center_distance:new d.bN(p),u_rotate_symbol:new d.bO(p),u_aspect_ratio:new d.bN(p),u_fade_change:new d.bN(p),u_matrix:new d.bK(p),u_label_plane_matrix:new d.bK(p),u_coord_matrix:new d.bK(p),u_is_text:new d.bO(p),u_pitch_with_map:new d.bO(p),u_texsize:new d.bL(p),u_texture:new d.bO(p),u_gamma_scale:new d.bN(p),u_device_pixel_ratio:new d.bN(p),u_tile_id:new d.bM(p),u_zoom_transition:new d.bN(p),u_inv_rot_matrix:new d.bK(p),u_merc_center:new d.bL(p),u_camera_forward:new d.bM(p),u_tile_matrix:new d.bK(p),u_up_vector:new d.bM(p),u_ecef_origin:new d.bM(p),u_is_halo:new d.bO(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new d.bO(p),u_is_size_feature_constant:new d.bO(p),u_size_t:new d.bN(p),u_size:new d.bN(p),u_camera_to_center_distance:new d.bN(p),u_rotate_symbol:new d.bO(p),u_aspect_ratio:new d.bN(p),u_fade_change:new d.bN(p),u_matrix:new d.bK(p),u_label_plane_matrix:new d.bK(p),u_coord_matrix:new d.bK(p),u_is_text:new d.bO(p),u_pitch_with_map:new d.bO(p),u_texsize:new d.bL(p),u_texsize_icon:new d.bL(p),u_texture:new d.bO(p),u_texture_icon:new d.bO(p),u_gamma_scale:new d.bN(p),u_device_pixel_ratio:new d.bN(p),u_is_halo:new d.bO(p)}),background:p=>({u_matrix:new d.bK(p),u_emissive_strength:new d.bN(p),u_opacity:new d.bN(p),u_color:new d.ca(p)}),backgroundPattern:p=>({u_matrix:new d.bK(p),u_emissive_strength:new d.bN(p),u_opacity:new d.bN(p),u_image:new d.bO(p),u_pattern_tl:new d.bL(p),u_pattern_br:new d.bL(p),u_texsize:new d.bL(p),u_pattern_size:new d.bL(p),u_pixel_coord_upper:new d.bL(p),u_pixel_coord_lower:new d.bL(p),u_tile_units_to_pixels:new d.bN(p)}),terrainRaster:Yr,terrainDepth:Yr,skybox:p=>({u_matrix:new d.bK(p),u_sun_direction:new d.bM(p),u_cubemap:new d.bO(p),u_opacity:new d.bN(p),u_temporal_offset:new d.bN(p)}),skyboxGradient:p=>({u_matrix:new d.bK(p),u_color_ramp:new d.bO(p),u_center_direction:new d.bM(p),u_radius:new d.bN(p),u_opacity:new d.bN(p),u_temporal_offset:new d.bN(p)}),skyboxCapture:p=>({u_matrix_3f:new d.cb(p),u_sun_direction:new d.bM(p),u_sun_intensity:new d.bN(p),u_color_tint_r:new d.bP(p),u_color_tint_m:new d.bP(p),u_luminance:new d.bN(p)}),globeRaster:p=>({u_proj_matrix:new d.bK(p),u_globe_matrix:new d.bK(p),u_normalize_matrix:new d.bK(p),u_merc_matrix:new d.bK(p),u_zoom_transition:new d.bN(p),u_merc_center:new d.bL(p),u_image0:new d.bO(p),u_grid_matrix:new d.cb(p),u_skirt_height:new d.bN(p),u_far_z_cutoff:new d.bN(p),u_frustum_tl:new d.bM(p),u_frustum_tr:new d.bM(p),u_frustum_br:new d.bM(p),u_frustum_bl:new d.bM(p),u_globe_pos:new d.bM(p),u_globe_radius:new d.bN(p),u_viewport:new d.bL(p)}),globeAtmosphere:p=>({u_frustum_tl:new d.bM(p),u_frustum_tr:new d.bM(p),u_frustum_br:new d.bM(p),u_frustum_bl:new d.bM(p),u_horizon:new d.bN(p),u_transition:new d.bN(p),u_fadeout_range:new d.bN(p),u_color:new d.bP(p),u_high_color:new d.bP(p),u_space_color:new d.bP(p),u_temporal_offset:new d.bN(p),u_horizon_angle:new d.bN(p)}),model:p=>({u_matrix:new d.bK(p),u_lighting_matrix:new d.bK(p),u_normal_matrix:new d.bK(p),u_lightpos:new d.bM(p),u_lightintensity:new d.bN(p),u_lightcolor:new d.bM(p),u_camera_pos:new d.bM(p),u_opacity:new d.bN(p),u_baseColorFactor:new d.bP(p),u_emissiveFactor:new d.bP(p),u_metallicFactor:new d.bN(p),u_roughnessFactor:new d.bN(p),u_baseTextureIsAlpha:new d.bO(p),u_alphaMask:new d.bO(p),u_alphaCutoff:new d.bN(p),u_baseColorTexture:new d.bO(p),u_metallicRoughnessTexture:new d.bO(p),u_normalTexture:new d.bO(p),u_occlusionTexture:new d.bO(p),u_emissionTexture:new d.bO(p),u_color_mix:new d.bP(p),u_aoIntensity:new d.bN(p),u_emissive_strength:new d.bN(p),u_occlusionTextureTransform:new d.bP(p)}),modelDepth:p=>({u_matrix:new d.bK(p),u_instance:new d.bK(p),u_node_matrix:new d.bK(p)}),groundShadow:p=>({u_matrix:new d.bK(p),u_ground_shadow_factor:new d.bM(p)}),stars:p=>({u_matrix:new d.bK(p),u_up:new d.bM(p),u_right:new d.bM(p),u_intensity_multiplier:new d.bN(p)})};let oa;function sa(p,s,c,m,y,x,C){const T=p.context,S=T.gl,O=p.transform,k=p.getOrCreateProgram("collisionBox"),F=[];let V=0,j=0;for(let ee=0;ee<m.length;ee++){const oe=m[ee],X=s.getTile(oe),se=X.getBucket(c);if(!se)continue;const he=Au(oe,se,O);let fe=he;0===y[0]&&0===y[1]||(fe=p.translatePosMatrix(he,X,y,x));const ge=C?se.textCollisionBox:se.iconCollisionBox,De=se.collisionCircleArray;if(De.length>0){const ve=d.a6.create(),Pe=fe;d.a6.mul(ve,se.placementInvProjMatrix,O.glCoordMatrix),d.a6.mul(ve,ve,se.placementViewportMatrix),F.push({circleArray:De,circleOffset:j,transform:Pe,invTransform:ve,projection:se.getProjection()}),V+=De.length/4,j=V}ge&&(p.terrain&&p.terrain.setupElevationDraw(X,k),k.draw(p,S.LINES,rt.disabled,Qt.disabled,p.colorModeForRenderPass(),Ut.disabled,Mr(fe,O,X,se.getProjection()),c.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,O.zoom,null,[ge.collisionVertexBuffer,ge.collisionVertexBufferExt]))}if(!C||!F.length)return;const q=p.getOrCreateProgram("collisionCircle"),W=new d.cv;W.resize(4*V),W._trim();let Y=0;for(const ee of F)for(let oe=0;oe<ee.circleArray.length/4;oe++){const X=4*oe,se=ee.circleArray[X+0],he=ee.circleArray[X+1],fe=ee.circleArray[X+2],ge=ee.circleArray[X+3];W.emplace(Y++,se,he,fe,ge,0),W.emplace(Y++,se,he,fe,ge,1),W.emplace(Y++,se,he,fe,ge,2),W.emplace(Y++,se,he,fe,ge,3)}(!oa||oa.length<2*V)&&(oa=function(ee){const oe=2*ee,X=new d.aw;X.resize(oe),X._trim();for(let se=0;se<oe;se++){const he=6*se;X.uint16[he+0]=4*se+0,X.uint16[he+1]=4*se+1,X.uint16[he+2]=4*se+2,X.uint16[he+3]=4*se+2,X.uint16[he+4]=4*se+3,X.uint16[he+5]=4*se+0}return X}(V));const G=T.createIndexBuffer(oa,!0),J=T.createVertexBuffer(W,d.cw.members,!0);for(const ee of F){const oe={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(re=O).getCameraToCenterDistance(ee.projection),u_viewport_size:[re.width,re.height]};q.draw(p,S.TRIANGLES,rt.disabled,Qt.disabled,p.colorModeForRenderPass(),Ut.disabled,oe,c.id,J,G,d.aB.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,O.zoom)}var re;J.destroy(),G.destroy()}const ml=d.a6.create();function gd(p){const s=p._camera.getWorldToCamera(p.worldSize,1),c=d.a6.multiply([],s,p.globeMatrix);d.a6.invert(c,c);const m=[0,0,0],y=[0,1,0,0];return d.a7.transformMat4(y,y,c),m[0]=y[0],m[1]=y[1],m[2]=y[2],d.N.normalize(m,m),m}function Ct({width:p,height:s,anchor:c,textOffset:m,textScale:y},x){const{horizontalAlign:C,verticalAlign:T}=d.bf(c),S=-(C-.5)*p,O=-(T-.5)*s,k=d.bd(c,m);return new d.P((S/y+k[0])*x,(O/y+k[1])*x)}function jf(p,s,c,m,y,x,C,T,S,O,k){const F=p.text.placedSymbolArray,V=p.text.dynamicLayoutVertexArray,j=p.icon.dynamicLayoutVertexArray,q={},W=p.getProjection(),Y=ol(T,W,x),G=x.elevation,J=W.upVectorScale(T.canonical,x.center.lat,x.worldSize).metersToTile;V.clear();for(let re=0;re<F.length;re++){const ee=F.get(re),{tileAnchorX:oe,tileAnchorY:X,numGlyphs:se}=ee,he=ee.hidden||!ee.crossTileID||p.allowVerticalPlacement&&!ee.placedOrientation?null:m[ee.crossTileID];if(he){let fe=0,ge=0,De=0;if(G){const He=G?G.getAtTileOffset(T,oe,X):0,[et,Je,pt]=W.upVector(T.canonical,oe,X);fe=He*et*J,ge=He*Je*J,De=He*pt*J}let[ve,Pe,Ae,qe]=Ms(ee.projectedAnchorX+fe,ee.projectedAnchorY+ge,ee.projectedAnchorZ+De,c?Y:C);const xe=R_(x.getCameraToCenterDistance(W),qe);let Se=y.evaluateSizeForFeature(p.textSizeData,O,ee)*xe/d.bc;c&&(Se*=p.tilePixelRatio/S);const pe=Ct(he,Se);c?(({x:ve,y:Pe,z:Ae}=W.projectTilePoint(oe+pe.x,X+pe.y,T.canonical)),[ve,Pe,Ae]=Ms(ve+fe,Pe+ge,Ae+De,C)):(s&&pe._rotate(-x.angle),ve+=pe.x,Pe+=pe.y,Ae=0);const Ee=p.allowVerticalPlacement&&ee.placedOrientation===d.b6.vertical?Math.PI/2:0;for(let He=0;He<se;He++)d.b9(V,ve,Pe,Ae,Ee);k&&ee.associatedIconIndex>=0&&(q[ee.associatedIconIndex]={x:ve,y:Pe,z:Ae,angle:Ee})}else Ll(se,V)}if(k){j.clear();const re=p.icon.placedSymbolArray;for(let ee=0;ee<re.length;ee++){const oe=re.get(ee),{numGlyphs:X}=oe,se=q[ee];if(oe.hidden||!se)Ll(X,j);else{const{x:he,y:fe,z:ge,angle:De}=se;for(let ve=0;ve<X;ve++)d.b9(j,he,fe,ge,De)}}p.icon.dynamicLayoutVertexBuffer.updateData(j)}p.text.dynamicLayoutVertexBuffer.updateData(V)}function Vu(p,s,c,m,y,x,C={}){const T=c.paint.get("icon-translate"),S=c.paint.get("text-translate"),O=c.paint.get("icon-translate-anchor"),k=c.paint.get("text-translate-anchor"),F=c.layout.get("icon-rotation-alignment"),V=c.layout.get("text-rotation-alignment"),j=c.layout.get("icon-pitch-alignment"),q=c.layout.get("text-pitch-alignment"),W=c.layout.get("icon-keep-upright"),Y=c.layout.get("text-keep-upright"),G=c.paint.get("icon-color-saturation"),J=p.context,re=J.gl,ee=p.transform,oe="map"===F,X="map"===V,se="map"===j,he="map"===q,fe=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let ge=!1;const De=p.depthModeForSublayer(0,rt.ReadOnly),ve=[d.a5(ee.center.lng),d.ae(ee.center.lat)],Pe=c.layout.get("text-variable-anchor"),Ae="globe"===ee.projection.name,qe=[],xe=[0,-1,0];for(const Se of m){const pe=s.getTile(Se),Ee=pe.getBucket(c);if(!Ee||"mercator"===Ee.projection.name&&Ae||Ee.fullyClipped)continue;const He="globe"===Ee.projection.name,et=He?d.S(ee.zoom):0,Je=ol(Se,Ee.getProjection(),ee),pt=ee.calculatePixelsToTileUnitsMatrix(pe),Mt=Pe&&Ee.hasTextData(),zt=Ee.hasIconTextFit()&&Mt&&Ee.hasIconData(),Ot=Ee.getProjection().createInversionMatrix(ee,Se.canonical),Dt=()=>{const Vi=oe&&"point"!==c.layout.get("symbol-placement"),yn=[],Nn=Vi||zt,vn=c.paint.get("icon-image-cross-fade").constantOr(0);p.terrainRenderModeElevated()&&se&&yn.push("PITCH_WITH_MAP_TERRAIN"),He&&(yn.push("PROJECTION_GLOBE_VIEW"),Nn&&yn.push("PROJECTED_POS_ON_VIEWPORT")),vn>0&&yn.push("ICON_TRANSITION"),Ee.icon.zOffsetVertexBuffer&&yn.push("Z_OFFSET"),G<1&&yn.push("SATURATION");const zn=Ee.icon.programConfigurations.get(c.id),vi=p.getOrCreateProgram(Ee.sdfIcons?"symbolSDF":"symbolIcon",{config:zn,defines:yn});let Rn;const Sr=pe.imageAtlasTexture?pe.imageAtlasTexture.size:[0,0],zr=Ee.iconSizeData,bo=d.b5(zr,ee.zoom),Oo=se||0!==ee.pitch,ko=Rc(Je,pe.tileID.canonical,se,oe,ee,Ee.getProjection(),pt),Ei=$i(Je,pe.tileID.canonical,se,oe,ee,Ee.getProjection(),pt),mr=p.translatePosMatrix(Ei,pe,T,O,!0),to=p.translatePosMatrix(Je,pe,T,O),no=Nn?ml:ko,Lo=oe&&!se&&!Vi;let Fs=xe;!Ae&&!ee.mercatorFromTransition||oe||(Fs=gd(ee));const Ns=He?Fs:xe;Rn=Ee.sdfIcons&&!Ee.iconsInText?Bu(zr.kind,bo,Lo,se,p,to,no,mr,!1,Sr,!0,Se,et,ve,Ot,Ns,Ee.getProjection()):dd(zr.kind,bo,Lo,se,p,to,no,mr,!1,Sr,Se,et,ve,Ot,Ns,Ee.getProjection(),G,vn);const gs=pe.imageAtlasTexture?pe.imageAtlasTexture:null,fa=1!==c.layout.get("icon-size").constantOr(0)||Ee.iconsNeedLinear,pa=Ee.sdfIcons||p.options.rotating||p.options.zooming||fa||Oo?re.LINEAR:re.NEAREST,Fd=Ee.sdfIcons&&0!==c.paint.get("icon-halo-width").constantOr(1),tc=p.terrain&&se&&Vi?d.a6.invert(d.a6.create(),ko):ml;if(Vi&&Ee.icon){const zs=ee.elevation,ip=zs?zs.getAtTileOffsetFunc(Se,ee.center.lat,ee.worldSize,Ee.getProjection()):null,Na=vm(Je,pe.tileID.canonical,se,oe,ee,Ee.getProjection(),pt);Mu(Ee,Je,p,!1,Na,Ei,se,W,ip,Se)}return{program:vi,buffers:Ee.icon,uniformValues:Rn,atlasTexture:gs,atlasTextureIcon:null,atlasInterpolation:pa,atlasInterpolationIcon:null,isSDF:Ee.sdfIcons,hasHalo:Fd,tile:pe,labelPlaneMatrixInv:tc}},hn=()=>{const Vi=X&&"point"!==c.layout.get("symbol-placement"),yn=[],Nn=Vi||Pe||zt;p.terrainRenderModeElevated()&&he&&yn.push("PITCH_WITH_MAP_TERRAIN"),He&&(yn.push("PROJECTION_GLOBE_VIEW"),Nn&&yn.push("PROJECTED_POS_ON_VIEWPORT")),Ee.text.zOffsetVertexBuffer&&yn.push("Z_OFFSET");const vn=Ee.text.programConfigurations.get(c.id),zn=p.getOrCreateProgram(Ee.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:vn,defines:yn});let vi,Rn=[0,0],Sr=null;const zr=Ee.textSizeData;Ee.iconsInText&&(Rn=pe.imageAtlasTexture?pe.imageAtlasTexture.size:[0,0],Sr=pe.imageAtlasTexture?pe.imageAtlasTexture:null,vi=he||0!==ee.pitch||p.options.rotating||p.options.zooming||"composite"===zr.kind||"camera"===zr.kind?re.LINEAR:re.NEAREST);const bo=pe.glyphAtlasTexture?pe.glyphAtlasTexture.size:[0,0],Oo=d.b5(zr,ee.zoom),ko=Rc(Je,pe.tileID.canonical,he,X,ee,Ee.getProjection(),pt),Ei=$i(Je,pe.tileID.canonical,he,X,ee,Ee.getProjection(),pt),mr=p.translatePosMatrix(Ei,pe,S,k,!0),to=p.translatePosMatrix(Je,pe,S,k),no=Nn?ml:ko,Lo=X&&!he&&!Vi;let Fs=xe;!Ae&&!ee.mercatorFromTransition||X||(Fs=gd(ee));const Ns=He?Fs:xe;let gs;gs=Ee.iconsInText?Bf(zr.kind,Oo,Lo,he,p,to,no,mr,bo,Rn,Se,et,ve,Ot,Ns,Ee.getProjection()):Bu(zr.kind,Oo,Lo,he,p,to,no,mr,!0,bo,!0,Se,et,ve,Ot,Ns,Ee.getProjection());const fa=pe.glyphAtlasTexture?pe.glyphAtlasTexture:null,pa=re.LINEAR,Fd=0!==c.paint.get("text-halo-width").constantOr(1),tc=p.terrain&&he&&Vi?d.a6.invert(d.a6.create(),ko):ml;if(Vi&&Ee.text){const zs=ee.elevation,ip=zs?zs.getAtTileOffsetFunc(Se,ee.center.lat,ee.worldSize,Ee.getProjection()):null,Na=vm(Je,pe.tileID.canonical,he,X,ee,Ee.getProjection(),pt);Mu(Ee,Je,p,!0,Na,Ei,he,Y,ip,Se)}return{program:zn,buffers:Ee.text,uniformValues:gs,atlasTexture:fa,atlasTextureIcon:Sr,atlasInterpolation:pa,atlasInterpolationIcon:vi,isSDF:!0,hasHalo:Fd,tile:pe,labelPlaneMatrixInv:tc}},Yt=Ee.icon.segments.get().length,en=Ee.text.segments.get().length,tn=Yt&&!C.onlyText?Dt():null,Dn=en&&!C.onlyIcons?hn():null,gi=c.paint.get("icon-opacity").constantOr(1),En=c.paint.get("text-opacity").constantOr(1);if(fe&&Ee.canOverlap){ge=!0;const Vi=gi&&!C.onlyText?Ee.icon.segments.get():[],yn=En&&!C.onlyIcons?Ee.text.segments.get():[];for(const Nn of Vi)qe.push({segments:new d.aB([Nn]),sortKey:Nn.sortKey,state:tn});for(const Nn of yn)qe.push({segments:new d.aB([Nn]),sortKey:Nn.sortKey,state:Dn})}else C.onlyText||qe.push({segments:gi?Ee.icon.segments:new d.aB([]),sortKey:0,state:tn}),C.onlyIcons||qe.push({segments:En?Ee.text.segments:new d.aB([]),sortKey:0,state:Dn})}ge&&qe.sort((Se,pe)=>Se.sortKey-pe.sortKey);for(const Se of qe){const pe=Se.state;if(pe)if(p.terrain&&p.terrain.setupElevationDraw(pe.tile,pe.program,{useDepthForOcclusion:ee.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:pe.labelPlaneMatrixInv}),J.activeTexture.set(re.TEXTURE0),pe.atlasTexture&&pe.atlasTexture.bind(pe.atlasInterpolation,re.CLAMP_TO_EDGE,!0),pe.atlasTextureIcon&&(J.activeTexture.set(re.TEXTURE1),pe.atlasTextureIcon&&pe.atlasTextureIcon.bind(pe.atlasInterpolationIcon,re.CLAMP_TO_EDGE,!0)),p.uploadCommonLightUniforms(p.context,pe.program),pe.hasHalo){const Ee=pe.uniformValues;Ee.u_is_halo=1,Xl(pe.buffers,Se.segments,c,p,pe.program,De,y,x,Ee,2),Ee.u_is_halo=0}else{if(pe.isSDF){const Ee=pe.uniformValues;pe.hasHalo&&(Ee.u_is_halo=1,Xl(pe.buffers,Se.segments,c,p,pe.program,De,y,x,Ee,1)),Ee.u_is_halo=0}Xl(pe.buffers,Se.segments,c,p,pe.program,De,y,x,pe.uniformValues,1)}}}function Xl(p,s,c,m,y,x,C,T,S,O){const k=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer];y.draw(m,m.context.gl.TRIANGLES,x,C,T,Ut.disabled,S,c.id,p.layoutVertexBuffer,p.indexBuffer,s,c.paint,m.transform.zoom,p.programConfigurations.get(c.id),k,O)}function Uc(p,s,c,m,y,x,C){const T=p.context.gl,S=c.paint.get("fill-pattern"),O=S&&S.constantOr(1);let k,F,V,j,q;C?(F=O&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=T.LINES):(F=O?"fillPattern":"fill",k=T.TRIANGLES);for(const W of m){const Y=s.getTile(W);if(O&&!Y.patternsLoaded())continue;const G=Y.getBucket(c);if(!G)continue;p.prepareDrawTile();const J=G.programConfigurations.get(c.id),re=p.isTileAffectedByFog(W),ee=p.getOrCreateProgram(F,{config:J,overrideFog:re});O&&(p.context.activeTexture.set(T.TEXTURE0),Y.imageAtlasTexture&&Y.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),J.updatePaintBuffers());const oe=S.constantOr(null);if(oe&&Y.imageAtlas){const he=Y.imageAtlas.patternPositions[oe.toString()];he&&J.setConstantPatternPositions(he)}const X=p.translatePosMatrix(W.projMatrix,Y,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),se=c.paint.get("fill-emissive-strength");if(C){j=G.indexBuffer2,q=G.segments2;const he=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];V="fillOutlinePattern"===F&&O?Bc(X,se,p,Y,he):ds(X,se,he)}else j=G.indexBuffer,q=G.segments,V=O?zc(X,se,p,Y):_o(X,se);p.uploadCommonUniforms(p.context,ee,W.toUnwrapped()),ee.draw(p,k,y,p.stencilModeForClipping(W),x,Ut.disabled,V,c.id,G.layoutVertexBuffer,j,q,c.paint,p.transform.zoom,J,void 0)}}function At(p,s,c,m,y,x,C,T){c.resetLayerRenderingStats(p);const S=p.context,O=S.gl,k=p.transform,F=c.paint.get("fill-extrusion-pattern"),V=F.constantOr(1),j=c.paint.get("fill-extrusion-opacity"),q=p.style.enable3dLights(),W=c.paint.get(q&&!V?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Y=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),W],G=c.layout.get("fill-extrusion-edge-radius"),J=G>0&&!c.paint.get("fill-extrusion-rounded-roof"),re=J?0:G,ee="globe"===k.projection.name?d.cF():0,oe="globe"===k.projection.name,X=oe?d.S(k.zoom):0,se=[d.a5(k.center.lng),d.ae(k.center.lat)],he=c.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),fe=c.paint.get("fill-extrusion-flood-light-intensity"),ge=c.paint.get("fill-extrusion-vertical-scale"),De=cl(p,c.paint.get("fill-extrusion-cutoff-fade-range")),ve=c.paint.get("fill-extrusion-emissive-strength"),Pe=[];let Ae;oe&&Pe.push("PROJECTION_GLOBE_VIEW"),Y[0]>0&&Pe.push("FAUX_AO"),J&&Pe.push("ZERO_ROOF_RADIUS"),T&&Pe.push("HAS_CENTROID"),fe>0&&Pe.push("FLOOD_LIGHT"),De.shouldRenderCutoff&&Pe.push("RENDER_CUTOFF");const qe="shadow"===p.renderPass,xe=p.shadowRenderer,Se=qe&&!!xe;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let pe=[0,0,0];if(xe){const et=p.style.directionalLight,Je=p.style.ambientLight;et&&Je&&(pe=Lu(et,Je)),Ae=Pe.concat(["SHADOWS_SINGLE_CASCADE"])}const Ee=Se?"fillExtrusionDepth":V?"fillExtrusionPattern":"fillExtrusion",He=c.getLayerRenderingStats();for(const et of m){const Je=s.getTile(et),pt=Je.getBucket(c);if(!pt||pt.projection.name!==k.projection.name)continue;let Mt=!1;xe&&(Mt=0===xe.getMaxCascadeForTile(et.toUnwrapped()));const zt=p.isTileAffectedByFog(et),Ot=pt.programConfigurations.get(c.id),Dt=p.getOrCreateProgram(Ee,{config:Ot,defines:Mt?Ae:Pe,overrideFog:zt});if(p.terrain&&p.terrain.setupElevationDraw(Je,Dt,{useMeterToDem:!0}),!pt.centroidVertexBuffer){const gi=Dt.attributes.a_centroid_pos;void 0!==gi&&O.vertexAttrib2f(gi,0,0)}!qe&&xe&&xe.setupShadows(Je.tileID.toUnwrapped(),Dt,"vector-tile",Je.tileID.overscaledZ),V&&(p.context.activeTexture.set(O.TEXTURE0),Je.imageAtlasTexture&&Je.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ot.updatePaintBuffers());const hn=F.constantOr(null);if(hn&&Je.imageAtlas){const gi=Je.imageAtlas.patternPositions[hn.toString()];gi&&Ot.setConstantPatternPositions(gi)}const Yt=c.paint.get("fill-extrusion-vertical-gradient");let en;if(qe&&xe){if(ju(Je.tileID,pt,p))continue;const gi=xe.calculateShadowPassMatrixFromTile(Je.tileID.toUnwrapped());en=zu(gi,re,ge)}else{const gi=p.translatePosMatrix(et.expandedProjMatrix,Je,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),En=k.projection.createInversionMatrix(k,et.canonical);en=V?fl(gi,p,Yt,j,Y,re,et,Je,ee,X,se,En,he,ge):Dm(gi,p,Yt,j,Y,re,et,ee,X,se,En,he,ge,fe,pe,ve)}p.uploadCommonUniforms(S,Dt,et.toUnwrapped(),null,De);let tn=pt.segments;if("mercator"===k.projection.name&&!qe&&(tn=pt.getVisibleSegments(Je.tileID,p.terrain,p.transform.getFrustum(0)),!tn.get().length))continue;if(He)if(qe)for(const gi of tn.get())He.numRenderedVerticesInShadowPass+=gi.primitiveLength;else for(const gi of tn.get())He.numRenderedVerticesInTransparentPass+=gi.primitiveLength;const Dn=[];(p.terrain||T)&&Dn.push(pt.centroidVertexBuffer),oe&&Dn.push(pt.layoutVertexExtBuffer),Dt.draw(p,S.gl.TRIANGLES,y,x,C,Ut.backCCW,en,c.id,pt.layoutVertexBuffer,pt.indexBuffer,tn,c.paint,p.transform.zoom,Ot,Dn)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}function Ro(p,s,c,m,y,x,C,T,S,O,k,F,V,j,q,W,Y,G,J){const re=p.context,ee=re.gl,oe=p.transform,X=p.transform.zoom,se=[],he=cl(p,c.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===O?(se.push("CLEAR_SUBPASS"),J&&(se.push("CLEAR_FROM_TEXTURE"),re.activeTexture.set(ee.TEXTURE0),J.bind(ee.LINEAR,ee.CLAMP_TO_EDGE))):"sdf"===O&&se.push("SDF_SUBPASS"),Y&&se.push("HAS_CENTROID"),he.shouldRenderCutoff&&se.push("RENDER_CUTOFF");const fe=c.layout.get("fill-extrusion-edge-radius"),ge=(De,ve,Pe,Ae,qe)=>{const xe=ve.programConfigurations.get(c.id),Se=p.isTileAffectedByFog(De),pe=p.getOrCreateProgram("fillExtrusionGroundEffect",{config:xe,defines:se,overrideFog:Se}),Ee={u_matrix:Ae,u_opacity:k,u_ao_pass:S?1:0,u_meter_to_tile:qe,u_ao:[F,V*qe],u_flood_light_intensity:j,u_flood_light_color:q,u_attenuation:W,u_edge_radius:X>=17?0:fe*qe,u_fb:0,u_fb_size:J?J.size[0]:0},He=[];Y&&He.push(ve.hiddenByLandmarkVertexBuffer),p.uploadCommonUniforms(re,pe,De.toUnwrapped(),null,he),pe.draw(p,re.gl.TRIANGLES,y,x,C,T,Ee,c.id,ve.vertexBuffer,ve.indexBuffer,Pe,c.paint,X,xe,He)};for(const De of m){const ve=s.getTile(De),Pe=ve.getBucket(c);if(!Pe||Pe.projection.name!==oe.projection.name||!Pe.groundEffect||Pe.groundEffect&&!Pe.groundEffect.hasData())continue;const Ae=Pe.groundEffect,qe=1/Pe.tileToMeter;{const xe=p.translatePosMatrix(De.projMatrix,ve,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Se=Ae.getDefaultSegment();ge(De,Ae,Se,xe,qe)}if(G)for(let xe=0;xe<4;xe++){const Se=d.cG[xe](De),pe=s.getTile(Se);if(!pe)continue;const Ee=pe.getBucket(c);if(!Ee||Ee.projection.name!==oe.projection.name||!Ee.groundEffect||Ee.groundEffect&&!Ee.groundEffect.hasData())continue;const He=Ee.groundEffect;let et,Je;0===xe?(et=[-d.V,0,0],Je=1):1===xe?(et=[d.V,0,0],Je=0):2===xe?(et=[0,-d.V,0],Je=3):(et=[0,d.V,0],Je=2);const pt=He.regionSegments[Je];if(!pt)continue;const Mt=new Float32Array(16);d.a6.translate(Mt,De.projMatrix,et),ge(De,He,pt,p.translatePosMatrix(Mt,ve,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),qe)}}}function gl(p,s,c,m,y,x,C){0===m.centroidVertexArray.length&&m.createCentroidsBuffer();const T=x?x.findDEMTileFor(c):null;if(!(T&&T.dem||C))return;const S=G=>new d.P(Math.ceil((G+d.cJ)*d.cK),0),O=G=>{const J=s.getSource().minzoom,re=oe=>{const X=s.getTileByID(oe);if(X&&X.hasData())return X.getBucket(y)},ee=[0,-1,1];for(const oe of ee){if(G.overscaledZ+oe<J)continue;const X=re(G.calculateScaledKey(G.overscaledZ+oe));if(X)return X}},k=[0,0,0],F=(G,J)=>(k[0]=Math.min(G.min.y,J.min.y),k[1]=Math.max(G.max.y,J.max.y),k[2]=d.V-J.min.x>G.max.x?J.min.x-d.V:G.max.x,k),V=(G,J)=>(k[0]=Math.min(G.min.x,J.min.x),k[1]=Math.max(G.max.x,J.max.x),k[2]=d.V-J.min.y>G.max.y?J.min.y-d.V:G.max.y,k),j=[(G,J)=>F(G,J),(G,J)=>F(J,G),(G,J)=>V(G,J),(G,J)=>V(J,G)],q=(G,J,re,ee,oe,X,se)=>{if(!x)return 0;const he=[[X?re:G,X?G:re,0],[X?re:J,X?J:re,0]],fe=se<0?d.V+se:se,ge=[X?fe:(G+J)/2,X?(G+J)/2:fe,0];return 0===re&&se<0||0!==re&&se>0?x.getForTilePoints(oe,[ge],!0,ee):he.push(ge),x.getForTilePoints(c,he,!0,T),Math.max(he[0][2],he[1][2],ge[2])/x.exaggeration()};for(let G=0;G<4;G++){const J=m.borderFeatureIndices[G];if(0===J.length)continue;const re=d.cG[G](c),ee=O(re);if(!(ee&&ee instanceof d.cH)||m.borderDoneWithNeighborZ[G]===ee.canonical.z)continue;0===ee.centroidVertexArray.length&&ee.createCentroidsBuffer();const oe=x?x.findDEMTileFor(re):null;if(!(oe&&oe.dem||C))continue;const X=(G<2?1:5)-G,se=ee.borderDoneWithNeighborZ[X]!==m.canonical.z,he=ee.borderFeatureIndices[X];let fe=0;if(m.canonical.z!==ee.canonical.z){for(const ge of J)m.showCentroid(m.featuresOnBorder[ge]);if(se)for(const ge of he)ee.showCentroid(ee.featuresOnBorder[ge]);m.borderDoneWithNeighborZ[G]=ee.canonical.z,ee.borderDoneWithNeighborZ[X]=m.canonical.z}for(const ge of J){const De=m.featuresOnBorder[ge],ve=m.centroidData[De.centroidDataIndex],Pe=De.borders[G];let Ae;for(;fe<he.length;){Ae=ee.featuresOnBorder[he[fe]];const qe=Ae.borders[X];if(qe[1]>Pe[0]+3||qe[0]>Pe[0]-3)break;ee.showCentroid(Ae),fe++}if(Ae&&fe<he.length){const qe=fe;let xe=0;for(;!(Ae.borders[X][0]>Pe[1]-3)&&(xe++,++fe!==he.length);)Ae=ee.featuresOnBorder[he[fe]];if(Ae=ee.featuresOnBorder[he[qe]],xe>1){const Ee=Ae.borders[X];Math.abs(Pe[0]-Ee[0])<3&&Math.abs(Pe[1]-Ee[1])<3&&(xe=1,fe=qe+1)}else if(0===xe){m.showCentroid(De);continue}const Se=ee.centroidData[Ae.centroidDataIndex];C&&1===xe&&(((W=ve).flags|(Y=Se).flags)&d.cI?(W.flags|=d.cI,Y.flags|=d.cI):(W.flags&=~d.cI,Y.flags&=~d.cI));const pe=De.intersectsCount()>1||Ae.intersectsCount()>1;if(xe>1)fe=qe,ve.centroidXY=Se.centroidXY=new d.P(0,0);else if(oe&&oe.dem&&!pe){const Ee=j[G](ve,Se),He=G%2?d.V-1:0,et=q(Ee[0],Math.min(d.V-1,Ee[1]),He,oe,re,G<2,Ee[2]);ve.centroidXY=Se.centroidXY=S(et)}else pe?ve.centroidXY=Se.centroidXY=new d.P(0,0):(ve.centroidXY=m.encodeBorderCentroid(De),Se.centroidXY=ee.encodeBorderCentroid(Ae));m.writeCentroidToBuffer(ve),ee.writeCentroidToBuffer(Se)}else m.showCentroid(De)}m.borderDoneWithNeighborZ[G]=ee.canonical.z,ee.borderDoneWithNeighborZ[X]=m.canonical.z}var W,Y;(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(p)}const y0=[1,0,0],Sm=[0,1,0],Ur=[0,0,1];function ju(p,s,c){const m=c.transform,y=c.shadowRenderer;if(!y)return!0;const x=p.toUnwrapped(),C=m.tileSize*y._cascades[c.currentShadowCascade].scale;let T=s.maxHeight;if(m.elevation){const W=m.elevation.getMinMaxForTile(p);W&&(T+=W.max)}const S=[...y.shadowDirection];S[2]=-S[2];const O=y.computeSimplifiedTileShadowVolume(x,T,C,S);if(!O)return!1;const k=[y0,Sm,Ur,S,[S[0],0,S[2]],[0,S[1],S[2]]],F="globe"===m.projection.name,V=m.scaleZoom(C),j=d.bq.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,V,!F),q=y.getCurrentCascadeFrustum();return 0===j.intersectsPrecise(O.vertices,O.planes,k)||0===q.intersectsPrecise(O.vertices,O.planes,k)}function Wo(p){return[p[0]*d.cL,p[1]*d.cL,p[2]*d.cL,0]}function _d(p,s,c,m,y,x,C,T,S){const O=m.getSource(),k=c.globeSharedBuffers;if(!k)return;let F,V,j;if(s&&(F=m.getTile(s)),O instanceof d.ap?(V=O.texture,j=d.cj(0,0,c.transform)):F&&s&&(V=F.texture,j=d.cj(s.canonical.z,s.canonical.x,c.transform)),!V||!j)return;p||(j=d.a6.scale(d.a6.create(),j,[1,-1,1]));const q=c.context,W=q.gl,Y="nearest"===y.paint.get("raster-resampling")?W.NEAREST:W.LINEAR,G=c.colorModeForDrapableLayerRenderPass(x),J=C.defines;J.push("GLOBE_POLES");const re=new rt(W.LEQUAL,rt.ReadWrite,c.depthRangeFor3D),ee=Float32Array.from(c.transform.expandedFarZProjMatrix),oe=Float32Array.from(d.aT(d.ci(new d.bs(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),q.activeTexture.set(W.TEXTURE0),V.bind(Y,W.CLAMP_TO_EDGE),q.activeTexture.set(W.TEXTURE1),V.bind(Y,W.CLAMP_TO_EDGE),V.useMipmap&&q.extTextureFilterAnisotropic&&c.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const[X,se,he,fe]=s?k.getPoleBuffers(s.canonical.z,!1):k.getPoleBuffers(0,!0),ge=y.paint.get("raster-elevation");let De;p?(De=X,c.renderDefaultNorthPole=0!==ge):(De=se,c.renderDefaultSouthPole=0!==ge);const ve=Wo(C.mix),Pe=(qe=ee,xe=oe,Se=j,pe=d.S(c.transform.zoom),He=y,Je=ge,Mt=ve,zt=C.offset,Ot=C.range,Dt=x,jc(qe,xe,Se,new Float32Array(16),new Float32Array(9),[0,0],pe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},He,[0,0],Je,2,Mt,zt,Ot,1,0,Dt)),Ae=c.getOrCreateProgram("raster",{defines:J});var qe,xe,Se,pe,He,Je,Mt,zt,Ot,Dt;c.uploadCommonUniforms(q,Ae,null),Ae.draw(c,W.TRIANGLES,re,S,G,T,Pe,y.id,De,he,fe)}function yd(p){const s=p._nearZ,c=p.projection.farthestPixelDistance(p),m=c-s,y=.2*p.height,x=s+y;return[s,c,(x-y-s)/m,(x-s)/m]}function vd(p,s,c,m){if(p)return s instanceof st&&p instanceof jr?s.getTextureDescriptor(p,c,!0):{texture:p.texture,mix:Wo(m.mix),offset:m.offset,buffer:0,tileSize:1}}function xd(p,s,c){if(!p)return null;const m=s.getTextureDescriptor(p,c,!0);if(!m)return null;let{texture:y,mix:x,offset:C,tileSize:T,buffer:S,format:O}=m;if(!y||!O)return null;let k=!1;return"uint32"===O&&(k=!0,x[3]=0,x=Vc(d.cM,x,[0,c.paint.get("raster-particle-max-speed")]),C=pl(d.cM,C,[0,c.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[S/(T+2*S),T/(T+2*S)],tileSize:T,scalarData:k,scale:x,offset:C,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[O]]}}function Uu(p){const s=p._nearZ,c=p.projection.farthestPixelDistance(p),m=c-s,y=.2*p.height,x=s+y;return[s,c,(x-y-s)/m,(x-s)/m]}const xo=new d.ax(1,0,0,1),aa=new d.ax(0,1,0,1),bd=new d.ax(0,0,1,1),wd=new d.ax(1,0,1,1),Ed=new d.ax(0,1,1,1);function Pa(p,s,c,m,y,x,C){const T=p.context,S=p.transform,O=T.gl,k="globe"===S.projection.name,F=k?["PROJECTION_GLOBE_VIEW"]:[];let V=d.a6.clone(c.projMatrix);if(k&&d.S(S.zoom)>0){const ve=d.aS(c.canonical,S),Pe=d.cN(ve);V=d.a6.multiply(new Float32Array(16),S.globeMatrix,Pe),d.a6.multiply(V,S.projMatrix,V)}const j=d.a6.create();j[12]+=2*y/(d.f.devicePixelRatio*S.width),j[13]+=2*x/(d.f.devicePixelRatio*S.height),d.a6.multiply(V,j,V);const q=p.getOrCreateProgram("debug",{defines:F}),W=s.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(W,q);const Y=rt.disabled,G=Qt.disabled,J=p.colorModeForRenderPass();T.activeTexture.set(O.TEXTURE0),p.emptyTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),k?W._makeGlobeTileDebugBuffers(p.context,S):W._makeDebugTileBoundsBuffers(p.context,S.projection);const ee=W._tileDebugBuffer||p.debugBuffer,oe=W._tileDebugIndexBuffer||p.debugIndexBuffer,X=W._tileDebugSegments||p.debugSegments;if(q.draw(p,O.LINE_STRIP,Y,G,J,Ut.disabled,Tm(V,m),"$debug",ee,oe,X,null,null,null,[W._globeTileDebugBorderBuffer]),C){const ve=W.latestRawTileData,Pe=Math.floor((ve&&ve.byteLength||0)/1024);let Ae=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ae+=` => ${c.overscaledZ}`),Ae+=` ${W.state}`,Ae+=` ${Pe}kb`,function(qe,xe){qe.initDebugOverlayCanvas();const Se=qe.debugOverlayCanvas,pe=qe.context.gl,Ee=qe.debugOverlayCanvas.getContext("2d");Ee.clearRect(0,0,Se.width,Se.height),Ee.shadowColor="white",Ee.shadowBlur=2,Ee.lineWidth=1.5,Ee.strokeStyle="white",Ee.textBaseline="top",Ee.font="bold 36px Open Sans, sans-serif",Ee.fillText(xe,5,5),Ee.strokeText(xe,5,5),qe.debugOverlayTexture.update(Se),qe.debugOverlayTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE)}(p,Ae)}const se=s.getTile(c).tileSize,he=512/Math.min(se,512)*(c.overscaledZ/S.zoom)*.5,fe=W._tileDebugTextBuffer||p.debugBuffer,ge=W._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,De=W._tileDebugTextSegments||p.debugSegments;q.draw(p,O.TRIANGLES,Y,G,mn.alphaBlended,Ut.disabled,Tm(V,d.ax.transparent,he),"$debug",fe,ge,De,null,null,null,[W._globeTileDebugTextBuffer])}function $c(p,s,c,m){Mi(p,0,s+c/2,p.transform.width,c,m)}function Kr(p,s,c,m){Mi(p,s-c/2,0,c,p.transform.height,m)}function Mi(p,s,c,m,y,x){const C=p.context,T=C.gl;T.enable(T.SCISSOR_TEST),T.scissor(s*d.f.devicePixelRatio,c*d.f.devicePixelRatio,m*d.f.devicePixelRatio,y*d.f.devicePixelRatio),C.clear({color:x}),T.disable(T.SCISSOR_TEST)}const $u=d.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Am}=$u;function _l(p,s,c,m){p.emplaceBack(s,c,m)}class Rm{constructor(s){this.vertexArray=new d.az,this.indices=new d.aw,_l(this.vertexArray,-1,-1,1),_l(this.vertexArray,1,-1,1),_l(this.vertexArray,-1,1,1),_l(this.vertexArray,1,1,1),_l(this.vertexArray,-1,-1,-1),_l(this.vertexArray,1,-1,-1),_l(this.vertexArray,-1,1,-1),_l(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,Am),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=d.aB.simpleSegment(0,0,36,12)}}function Kl(p,s,c,m,y,x){const C=p.context.gl,T=s.paint.get("sky-atmosphere-color"),S=s.paint.get("sky-atmosphere-halo-color"),O=s.paint.get("sky-atmosphere-sun-intensity"),k={u_matrix_3f:d.co.fromMat4(d.co.create(),m),u_sun_direction:y,u_sun_intensity:O,u_color_tint_r:[(q=T).r,q.g,q.b,q.a],u_color_tint_m:[(W=S).r,W.g,W.b,W.a],u_luminance:5e-5};var q,W;C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+x,s.skyboxTexture,0),c.draw(p,C.TRIANGLES,rt.disabled,Qt.disabled,mn.unblended,Ut.frontCW,k,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const z_=d.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Gu{constructor(s){const c=new d.cO;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const m=new d.aw;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(c,z_.members),this.indexBuffer=s.createIndexBuffer(m),this.segments=d.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Gc=d.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class nt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Vt{constructor(s){this.colorModeAlphaBlendedWriteRGB=new mn([1,771,1,771],d.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new mn([1,0,1,0],d.ax.transparent,[!1,!1,!1,!0]),this.params=new nt,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){const c=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Gu(c);const m=this.params.sizeRange,y=this.params.intensityRange,x=function(k){const F=d.aA(30),V=[];for(let j=0;j<k;++j){const q=2*Math.PI*F(),W=Math.acos(1-2*F())-.5*Math.PI;V.push(d.N.fromValues(Math.cos(W)*Math.cos(q),Math.cos(W)*Math.sin(q),Math.sin(W)))}return V}(this.params.starsCount),C=d.aA(300),T=new d.cP,S=new d.aw;let O=0;for(let k=0;k<x.length;++k){const F=d.N.scale([],x[k],200),V=Math.max(0,1+.01*m*(1*C()-.5)),j=Math.max(0,1+.01*y*(1*C()-.5));T.emplaceBack(F[0],F[1],F[2],-1,-1,V,j),T.emplaceBack(F[0],F[1],F[2],1,-1,V,j),T.emplaceBack(F[0],F[1],F[2],1,1,V,j),T.emplaceBack(F[0],F[1],F[2],-1,1,V,j),S.emplaceBack(O+0,O+1,O+2),S.emplaceBack(O+0,O+2,O+3),O+=4}this.starsVx=c.createVertexBuffer(T,Gc.members),this.starsIdx=c.createIndexBuffer(S),this.starsSegments=d.aB.simpleSegment(0,0,T.length,S.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,c){const m=s.context,y=m.gl,x=s.transform,C=new rt(y.LEQUAL,rt.ReadOnly,[0,1]),T=d.S(x.zoom),S=c.properties.get("color").toArray01(),O=c.properties.get("high-color").toArray01(),k=c.properties.get("space-color").toArray01PremultipliedAlpha(),F=5e-4,V=d.cQ(c.properties.get("horizon-blend"),0,1,F,.25),j=d.cd(s,m,x)&&V===F?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,q=s.frameCounter/1e3%1,W=d.N.length(x.globeCenterInViewSpace),Y=Math.sqrt(Math.pow(W,2)-Math.pow(j,2)),G=Math.acos(Y/W),J=re=>{const ee="globe"===x.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];re&&ee.push("ALPHA_PASS");const oe=s.getOrCreateProgram("globeAtmosphere",{defines:ee}),X={u_frustum_tl:x.frustumCorners.TL,u_frustum_tr:x.frustumCorners.TR,u_frustum_br:x.frustumCorners.BR,u_frustum_bl:x.frustumCorners.BL,u_horizon:x.frustumCorners.horizon,u_transition:T,u_fadeout_range:V,u_color:S,u_high_color:O,u_space_color:k,u_temporal_offset:q,u_horizon_angle:G};s.uploadCommonUniforms(m,oe);const se=this.atmosphereBuffer;se&&oe.draw(s,y.TRIANGLES,C,Qt.disabled,re?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ut.backCW,X,re?"atmosphere_glow_alpha":"atmosphere_glow",se.vertexBuffer,se.indexBuffer,se.segments)};J(!1),J(!0)}drawStars(s,c){const m=d.aa(c.properties.get("star-intensity"),0,1);if(0===m)return;const y=s.context,x=y.gl,C=s.transform,T=s.getOrCreateProgram("stars"),S=d.bi.identity([]);d.bi.rotateX(S,S,-C._pitch),d.bi.rotateZ(S,S,-C.angle),d.bi.rotateX(S,S,d.bj(C._center.lat)),d.bi.rotateY(S,S,-d.bj(C._center.lng));const O=d.a6.fromQuat(new Float32Array(16),S),k=d.a6.multiply([],C.starsProjMatrix,O),F=d.co.fromMat4([],O),V=d.co.invert([],F),j=[0,1,0];d.N.transformMat3(j,j,V),d.N.scale(j,j,this.params.sizeMultiplier);const q=[1,0,0];d.N.transformMat3(q,q,V),d.N.scale(q,q,this.params.sizeMultiplier);const W=(Y=j,G=q,J=m,{u_matrix:Float32Array.from(k),u_up:Y,u_right:G,u_intensity_multiplier:J});var Y,G,J;s.uploadCommonUniforms(y,T),this.starsVx&&this.starsIdx&&T.draw(s,x.TRIANGLES,rt.disabled,Qt.disabled,this.colorModeAlphaBlendedWriteRGB,Ut.disabled,W,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Oa(p,s){const c=[...p],m=s.cameraWorldSizeForFog/s.worldSize,y=d.a6.identity([]);return d.a6.scale(y,y,[m,m,1]),d.a6.multiply(c,y,c),d.a6.multiply(c,s.worldToFogMatrix,c),c}function Xi(p,s,c,m){const y=c.material,x=m.context,{baseColorTexture:C,metallicRoughnessTexture:T}=y.pbrMetallicRoughness,{normalTexture:S,occlusionTexture:O,emissionTexture:k}=y;function F(V,j,q){if(V&&(p.push(j),x.activeTexture.set(x.gl.TEXTURE0+q),V.gfxTexture)){const{minFilter:W,magFilter:Y,wrapS:G,wrapT:J}=V.sampler;V.gfxTexture.bindExtraParam(W,Y,G,J)}}F(C,"HAS_TEXTURE_u_baseColorTexture",kr.BaseColor),F(T,"HAS_TEXTURE_u_metallicRoughnessTexture",kr.MetallicRoughness),F(S,"HAS_TEXTURE_u_normalTexture",kr.Normal),F(O,"HAS_TEXTURE_u_occlusionTexture",kr.Occlusion),F(k,"HAS_TEXTURE_u_emissionTexture",kr.Emission),c.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(c.texcoordBuffer)),c.colorBuffer&&(p.push(12===c.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(c.colorBuffer)),c.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(c.normalBuffer)),c.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(c.pbrBuffer)),"OPAQUE"!==y.alphaMode&&"MASK"!==y.alphaMode||p.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||p.push("DIFFUSE_SHADED"),p.push("USE_STANDARD_DERIVATIVES")}function Cd(p,s,c,m,y,x){const C=c.paint.get("model-opacity"),T=s.context,S=new rt(s.context.gl.LEQUAL,rt.ReadWrite,s.depthRangeFor3D),O=s.transform,k=p.mesh,F=k.material,V=F.pbrMetallicRoughness,j=s.style.fog;let q;q="pixels"===s.transform.projection.zAxisUnit?[...p.nodeModelMatrix]:d.a6.multiply([],m.zScaleMatrix,p.nodeModelMatrix),d.a6.multiply(q,m.negCameraPosMatrix,q);const W=d.a6.invert([],q);d.a6.transpose(W,W);const Y=c.paint.get("model-emissive-strength").constantOr(0),G=Vf(new Float32Array(p.worldViewProjection),new Float32Array(q),new Float32Array(W),s,C,V.baseColorFactor,F.emissiveFactor,V.metallicFactor,V.roughnessFactor,F,Y,c),J={defines:[]},re=[];Xi(J.defines,re,k,s);const ee=s.shadowRenderer;ee&&(ee.useNormalOffset=!1);let oe=null;if(j){const he=Oa(p.nodeModelMatrix,s.transform);if(oe=new Float32Array(he),"globe"!==O.projection.name){const fe=k.aabb.min,ge=k.aabb.max,[De,ve]=j.getOpacityForBounds(he,fe[0],fe[1],ge[0],ge[1]);J.overrideFog=De>=Qn||ve>=Qn}}const X=cl(s,c.paint.get("model-cutoff-fade-range"));X.shouldRenderCutoff&&J.defines.push("RENDER_CUTOFF");const se=s.getOrCreateProgram("model",J);s.uploadCommonUniforms(T,se,null,oe,X),"shadow"!==s.renderPass&&ee&&ee.setupShadowsFromMatrix(p.nodeModelMatrix,se),se.draw(s,T.gl.TRIANGLES,S,y,x,k.material.doubleSided?Ut.disabled:Ut.backCCW,G,c.id,k.vertexBuffer,k.indexBuffer,k.segments,c.paint,s.transform.zoom,void 0,re)}function Hu(p,s,c,m,y,x,C){let T;T="globe"===p.projection.name?d.cS(c,p):[...c],d.a6.multiply(T,T,s.matrix);const S=d.a6.multiply([],m,T);if(s.meshes)for(const O of s.meshes){if("BLEND"!==O.material.alphaMode){C.push({mesh:O,depth:0,modelIndex:y,worldViewProjection:S,nodeModelMatrix:T});continue}const k=d.N.transformMat4([],O.centroid,S);k[2]>0&&x.push({mesh:O,depth:k[2],modelIndex:y,worldViewProjection:S,nodeModelMatrix:T})}if(s.children)for(const O of s.children)Hu(p,O,c,m,y,x,C)}function Ce(p,s,c,m){const y=c.shadowRenderer;if(!y)return;const x=y.getShadowPassDepthMode(),C=y.getShadowPassColorMode(),T=y.calculateShadowPassMatrixFromMatrix(s),S=md(T);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,x,Qt.disabled,C,Ut.backCCW,S,m.id,p.vertexBuffer,p.indexBuffer,p.segments,m.paint,c.transform.zoom,void 0,void 0)}function Dd(p,s,c){const m=s.updateZoomBasedPaintProperties(),y=function(x,C,T){let S,O,k,F=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&F>0){const V=x.terrain,j=V.findDEMTileFor(T);j&&j.dem?S=d.cU.create(V,T,j):F=0}if(0===F&&(C.terrainElevationMin=0,C.terrainElevationMax=0),F===C.validForExaggeration&&(0===F||S&&S._demTile&&S._demTile.tileID===C.validForDEMTile.id&&S._dem._timestamp===C.validForDEMTile.timestamp))return!1;for(const V in C.instancesPerModel){const j=C.instancesPerModel[V];for(let q=0;q<j.instancedDataArray.length;++q){const W=(S?F*S.getElevationAt(0|j.instancedDataArray.float32[16*q],0|j.instancedDataArray.float32[16*q+1],!0,!0):0)+j.instancesEvaluatedElevation[q];j.instancedDataArray.float32[16*q+6]=W,O=O?Math.min(C.terrainElevationMin,W):W,k=k?Math.max(C.terrainElevationMax,W):W}}return C.terrainElevationMin=O||0,C.terrainElevationMax=k||0,C.validForExaggeration=F,C.validForDEMTile=S&&S._demTile?{id:S._demTile.tileID,timestamp:S._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,s,c);(m||y)&&(s.uploaded=!1,s.upload(p.context))}const Yo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new d.bS([0,0,0],[d.V,d.V,0])};function Pm(p,s){const c=1<<p.canonical.z,m=s.getFreeCameraOptions().position,y=s.elevation,x=p.canonical.x/c,C=(p.canonical.x+1)/c,T=p.canonical.y/c,S=(p.canonical.y+1)/c;let O=s._centerAltitude;if(y){const j=y.getMinMaxForTile(p);j&&j.max>O&&(O=j.max)}const k=d.aa(m.x,x,C)-m.x,F=d.aa(m.y,T,S)-m.y,V=d.bl(O,s.center.lat)-m.z;return s._zoomFromMercatorZ(Math.sqrt(k*k+F*F+V*V))}function Uf(p,s,c,m,y,x,C){const T=p.context,S="shadow"===p.renderPass,O=p.shadowRenderer,k=S&&O?O.getShadowPassDepthMode():new rt(T.gl.LEQUAL,rt.ReadWrite,p.depthRangeFor3D),F=p.isTileAffectedByFog(x);if(c.meshes)for(const V of c.meshes){const j=["MODEL_POSITION_ON_GPU"],q=[];let W,Y,G;m.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");const J=cl(p,s.paint.get("model-cutoff-fade-range"));if(J.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),S&&O)W=p.getOrCreateProgram("modelDepth",{defines:j}),Y=md(C.shadowTileMatrix,C.shadowTileMatrix,Float32Array.from(c.matrix)),G=O.getShadowPassColorMode();else{Xi(j,q,V,p),W=p.getOrCreateProgram("model",{defines:j,overrideFog:F});const ee=V.material,oe=ee.pbrMetallicRoughness,X=s.paint.get("model-opacity"),se=s.paint.get("model-emissive-strength").constantOr(0);Y=Vf(x.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),p,X,oe.baseColorFactor,ee.emissiveFactor,oe.metallicFactor,oe.roughnessFactor,ee,se,s,y),O&&(C.shadowUniformsInitialized?W.setShadowUniformValues(T,O.getShadowUniformValues()):(O.setupShadows(x.toUnwrapped(),W,"model-tile",x.overscaledZ),C.shadowUniformsInitialized=!0)),G=J.shouldRenderCutoff||X<1||"OPAQUE"!==ee.alphaMode?mn.alphaBlended:mn.unblended}p.uploadCommonUniforms(T,W,x.toUnwrapped(),null,J);const re=V.material.doubleSided?Ut.disabled:Ut.backCCW;if(m.instancedDataArray.length>20)q.push(m.instancedDataBuffer),W.draw(p,T.gl.TRIANGLES,k,Qt.disabled,G,re,Y,s.id,V.vertexBuffer,V.indexBuffer,V.segments,s.paint,p.transform.zoom,void 0,q,m.instancedDataArray.length);else{const ee=S?"u_instance":"u_normal_matrix";for(let oe=0;oe<m.instancedDataArray.length;++oe)Y[ee]=new Float32Array(m.instancedDataArray.arrayBuffer,64*oe,16),W.draw(p,T.gl.TRIANGLES,k,Qt.disabled,G,re,Y,s.id,V.vertexBuffer,V.indexBuffer,V.segments,s.paint,p.transform.zoom,void 0,q)}}if(c.children)for(const V of c.children)Uf(p,s,V,m,y,x,C)}const Jl=[1,-1,1];function B_(p,s,c,m){if(!c.modelManager)return!0;const y=c.modelManager;if(!c.shadowRenderer)return!0;const x=c.shadowRenderer,C=s.aabb;let T=!0,S=p.maxHeight;if(0===S){let k=0;for(const F in p.instancesPerModel){const V=y.getModel(F,m);V?k=Math.max(k,Math.max(Math.max(V.aabb.max[0],V.aabb.max[1]),V.aabb.max[2])):T=!1}S=p.maxScale*k*1.41+p.maxVerticalOffset,T&&(p.maxHeight=S)}C.max[2]=S,C.min[2]+=p.terrainElevationMin,C.max[2]+=p.terrainElevationMax,d.N.transformMat4(C.min,C.min,s.tileMatrix),d.N.transformMat4(C.max,C.max,s.tileMatrix);const O=C.intersects(x.getCurrentCascadeFrustum());return 0===c.currentShadowCascade&&(p.isInsideFirstShadowMapFrustum=2===O),0===O}class Om{}class km{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,c,m){{const F=this._storage.get(c.id);if(F)return F.lastUsedFrameIdx=s,F.buf}const y=m.gl,x=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),C=new ArrayBuffer(x),T=new Int16Array(C);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(C));const S=new d.cW;for(let F=0;F<x/2;F+=3){const V=T[F],j=T[F+1],q=T[F+2];S.emplaceBack(V,j),S.emplaceBack(j,q),S.emplaceBack(q,V)}const O=m.bindVertexArrayOES.current,k=new Om;return k.buf=new Un(m,S),k.lastUsedFrameIdx=s,this._storage.set(c.id,k),m.bindVertexArrayOES.set(O),k.buf}update(s){for(const[c,m]of this._storage)s-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(c))}destroy(){for(const[s,c]of this._storage)c.buf.destroy(),this._storage.delete(s)}}class Td{registerParameter(s,c,m,y,x){}registerButton(s,c,m){}}const qu={symbol:function(p,s,c,m,y){if("translucent"!==p.renderPass)return;const x=Qt.disabled,C=p.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(O,k,F,V,j,q,W){const Y=k.transform,G="map"===j,J="map"===q;for(const re of O){const ee=V.getTile(re),oe=ee.getBucket(F);if(!oe||!oe.text||!oe.text.segments.get().length)continue;const X=d.b5(oe.textSizeData,Y.zoom),se=ol(re,oe.getProjection(),Y),he=Y.calculatePixelsToTileUnitsMatrix(ee),fe=Rc(se,ee.tileID.canonical,J,G,Y,oe.getProjection(),he),ge=oe.hasIconTextFit()&&oe.hasIconData();if(X){const De=Math.pow(2,Y.zoom-ee.tileID.overscaledZ);jf(oe,G,J,W,d.cx,Y,fe,re,De,X,ge)}}}(m,p,c,s,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y);const T=0!==c.paint.get("icon-opacity").constantOr(1),S=0!==c.paint.get("text-opacity").constantOr(1);void 0!==c.layout.get("symbol-sort-key").constantOr(1)&&(T||S)?Vu(p,s,c,m,x,C):(T&&Vu(p,s,c,m,x,C,{onlyIcons:!0}),S&&Vu(p,s,c,m,x,C,{onlyText:!0})),s.map.showCollisionBoxes&&(sa(p,s,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),sa(p,s,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,s,c,m){if("translucent"!==p.renderPass)return;const y=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),C=c.paint.get("circle-stroke-opacity"),T=void 0!==c.layout.get("circle-sort-key").constantOr(1),S=c.paint.get("circle-emissive-strength");if(0===y.constantOr(1)&&(0===x.constantOr(1)||0===C.constantOr(1)))return;const O=p.context,k=O.gl,F=p.transform,V=p.depthModeForSublayer(0,rt.ReadOnly),j=Qt.disabled,q=p.colorModeForDrapableLayerRenderPass(S),W="globe"===F.projection.name,Y=[d.a5(F.center.lng),d.ae(F.center.lat)],G=[];for(let re=0;re<m.length;re++){const ee=m[re],oe=s.getTile(ee),X=oe.getBucket(c);if(!X||X.projection.name!==F.projection.name)continue;const se=X.programConfigurations.get(c.id),he=d.cy(c),fe=p.isTileAffectedByFog(ee);W&&he.push("PROJECTION_GLOBE_VIEW");const ge=p.getOrCreateProgram("circle",{config:se,defines:he,overrideFog:fe}),De=X.layoutVertexBuffer,ve=X.globeExtVertexBuffer,Pe=X.indexBuffer,Ae=F.projection.createInversionMatrix(F,ee.canonical),qe={programConfiguration:se,program:ge,layoutVertexBuffer:De,globeExtVertexBuffer:ve,indexBuffer:Pe,uniformValues:d.cz(p,ee,oe,Ae,Y,c),tile:oe};if(T){const xe=X.segments.get();for(const Se of xe)G.push({segments:new d.aB([Se]),sortKey:Se.sortKey,state:qe})}else G.push({segments:X.segments,sortKey:0,state:qe})}T&&G.sort((re,ee)=>re.sortKey-ee.sortKey);const J={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(const re of G){const{programConfiguration:ee,program:oe,layoutVertexBuffer:X,globeExtVertexBuffer:se,indexBuffer:he,uniformValues:fe,tile:ge}=re.state,De=re.segments;p.terrain&&p.terrain.setupElevationDraw(ge,oe,J),p.uploadCommonUniforms(O,oe,ge.tileID.toUnwrapped()),oe.draw(p,k.TRIANGLES,V,j,q,Ut.disabled,fe,c.id,X,he,De,c.paint,F.zoom,ee,[se])}},heatmap:function(p,s,c,m){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const y=p.context,x=y.gl,C=Qt.disabled,T=new mn([x.ONE,x.ONE,x.ONE,x.ONE],d.ax.transparent,[!0,!0,!0,!0]);(function(j,q,W,Y){const G=j.gl,J=q.width*Y,re=q.height*Y;j.activeTexture.set(G.TEXTURE1),j.viewport.set([0,0,J,re]);let ee=W.heatmapFbo;if(!ee||ee&&(ee.width!==J||ee.height!==re)){ee&&ee.destroy();const oe=G.createTexture();G.bindTexture(G.TEXTURE_2D,oe),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),ee=W.heatmapFbo=j.createFramebuffer(J,re,!0,null),function(X,se,he,fe,ge,De){const ve=X.gl;ve.texImage2D(ve.TEXTURE_2D,0,X.extRenderToTextureHalfFloat?ve.RGBA16F:ve.RGBA,ge,De,0,ve.RGBA,X.extRenderToTextureHalfFloat?ve.HALF_FLOAT:ve.UNSIGNED_BYTE,null),fe.colorAttachment.set(he)}(j,0,oe,ee,J,re)}else G.bindTexture(G.TEXTURE_2D,ee.colorAttachment.get()),j.bindFramebuffer.set(ee.framebuffer)})(y,p,c,"globe"===p.transform.projection.name?.5:.25),y.clear({color:d.ax.transparent});const S=p.transform,O="globe"===S.projection.name,k=O?["PROJECTION_GLOBE_VIEW"]:[],F=O?Ut.frontCCW:Ut.disabled,V=[d.a5(S.center.lng),d.ae(S.center.lat)];for(let j=0;j<m.length;j++){const q=m[j];if(s.hasRenderableParent(q))continue;const W=s.getTile(q),Y=W.getBucket(c);if(!Y||Y.projection.name!==S.projection.name)continue;const G=p.isTileAffectedByFog(q),J=Y.programConfigurations.get(c.id),re=p.getOrCreateProgram("heatmap",{config:J,defines:k,overrideFog:G}),{zoom:ee}=p.transform;p.terrain&&p.terrain.setupElevationDraw(W,re),p.uploadCommonUniforms(y,re,q.toUnwrapped());const oe=S.projection.createInversionMatrix(S,q.canonical);re.draw(p,x.TRIANGLES,rt.disabled,C,T,F,Xr(p,q,W,oe,V,ee,c.paint.get("heatmap-intensity")),c.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,c.paint,p.transform.zoom,J,O?[Y.globeExtVertexBuffer]:null)}y.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(y,x){const C=y.context,T=C.gl,S=x.heatmapFbo;if(!S)return;C.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,S.colorAttachment.get()),C.activeTexture.set(T.TEXTURE1);let O=x.colorRampTexture;O||(O=x.colorRampTexture=new d.T(C,x.colorRamp,T.RGBA)),O.bind(T.LINEAR,T.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,T.TRIANGLES,rt.disabled,Qt.disabled,y.colorModeForRenderPass(),Ut.disabled,{u_image:0,u_color_ramp:1,u_opacity:x.paint.get("heatmap-opacity")},x.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,x.paint,y.transform.zoom)}(p,c))},line:function(p,s,c,m){if("translucent"!==p.renderPass)return;const y=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(0===y.constantOr(1)||0===x.constantOr(1))return;const C=c.paint.get("line-emissive-strength"),T=p.depthModeForSublayer(0,rt.ReadOnly),S=p.colorModeForDrapableLayerRenderPass(C),O=p.terrain&&p.terrain.renderingToTexture?1:d.f.devicePixelRatio,k=c.paint.get("line-dasharray"),F=k.constantOr(1),V=c.layout.get("line-cap"),j=c.paint.get("line-pattern"),q=j.constantOr(1),W=c.paint.get("line-pattern").constantOr(1),Y=1!==c.paint.get("line-opacity").constantOr(1);let G=!W&&Y;const J=c.paint.get("line-gradient"),re=q?"linePattern":"line",ee=p.context,oe=ee.gl,X=d.cA(c);p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(G=!1);for(const se of m){const he=s.getTile(se);if(q&&!he.patternsLoaded())continue;const fe=he.getBucket(c);if(!fe)continue;p.prepareDrawTile();const ge=fe.programConfigurations.get(c.id),De=p.isTileAffectedByFog(se),ve=p.getOrCreateProgram(re,{config:ge,defines:X,overrideFog:De}),Pe=j.constantOr(null);if(Pe&&he.imageAtlas){const et=he.imageAtlas.patternPositions[Pe.toString()];et&&ge.setConstantPatternPositions(et)}const Ae=k.constantOr(null),qe=V.constantOr(null);if(!q&&Ae&&qe&&he.lineAtlas){const et=he.lineAtlas.getDash(Ae,qe);et&&ge.setConstantPatternPositions(et)}let[xe,Se]=c.paint.get("line-trim-offset");("round"===qe||"square"===qe)&&xe!==Se&&(0===xe&&(xe-=1),1===Se&&(Se+=1));const pe=p.terrain?se.projMatrix:null,Ee=q?d.cB(p,he,c,pe,O,[xe,Se]):d.cC(p,he,c,pe,fe.lineClipsArray.length,O,[xe,Se]);if(J){const et=fe.gradients[c.id];let Je=et.texture;if(c.gradientVersion!==et.version){let pt=256;if(c.stepInterpolant){const Mt=s.getSource().maxzoom,zt=se.canonical.z===Mt?Math.ceil(1<<p.transform.maxZoom-se.canonical.z):1;pt=d.aa(d.cD(fe.maxLineLength/d.V*1024*zt),256,ee.maxTextureSize)}et.gradient=d.cE({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:pt,image:et.gradient||void 0,clips:fe.lineClipsArray}),et.texture?et.texture.update(et.gradient):et.texture=new d.T(ee,et.gradient,oe.RGBA),et.version=c.gradientVersion,Je=et.texture}ee.activeTexture.set(oe.TEXTURE1),Je.bind(c.stepInterpolant?oe.NEAREST:oe.LINEAR,oe.CLAMP_TO_EDGE)}F&&(ee.activeTexture.set(oe.TEXTURE0),he.lineAtlasTexture&&he.lineAtlasTexture.bind(oe.LINEAR,oe.REPEAT),ge.updatePaintBuffers()),q&&(ee.activeTexture.set(oe.TEXTURE0),he.imageAtlasTexture&&he.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),ge.updatePaintBuffers()),p.uploadCommonUniforms(ee,ve,se.toUnwrapped());const He=et=>{ve.draw(p,oe.TRIANGLES,T,et,S,Ut.disabled,Ee,c.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,c.paint,p.transform.zoom,ge,[fe.layoutVertexBuffer2])};if(G){const et=p.stencilModeForClipping(se).ref;0===et&&p.terrain&&ee.clear({stencil:0});const Je={func:oe.EQUAL,mask:255};Ee.u_alpha_discard_threshold=.8,He(new Qt(Je,et,255,oe.KEEP,oe.KEEP,oe.INVERT)),Ee.u_alpha_discard_threshold=0,He(new Qt(Je,et,255,oe.KEEP,oe.KEEP,oe.KEEP))}else He(p.stencilModeForClipping(se))}G&&(p.resetStencilClippingMasks(),p.terrain&&ee.clear({stencil:0}))},fill:function(p,s,c,m){const y=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(0===x.constantOr(1))return;const C=c.paint.get("fill-emissive-strength"),T=p.colorModeForDrapableLayerRenderPass(C),S=c.paint.get("fill-pattern"),O=p.opaquePassEnabledForLayer()&&!S.constantOr(1)&&1===y.constantOr(d.ax.transparent).a&&1===x.constantOr(0)?"opaque":"translucent";if(p.renderPass===O){const k=p.depthModeForSublayer(1,"opaque"===p.renderPass?rt.ReadWrite:rt.ReadOnly);Uc(p,s,c,m,k,T,!1)}if("translucent"===p.renderPass&&c.paint.get("fill-antialias")){const k=p.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,rt.ReadOnly);Uc(p,s,c,m,k,T,!0)}},"fill-extrusion":function(p,s,c,m){const y=c.paint.get("fill-extrusion-opacity"),x=p.context,C=x.gl,T=p.terrain,S=T&&T.renderingToTexture;if(0===y)return;const O=p.conflationActive&&p.layerUsedInConflation(c,s.getSource());if(O&&function(k,F,V,j){for(const q of j){const W=F.getTile(q).getBucket(V);W&&(W.updateReplacement(q,k.replacementSource),W.uploadCentroid(k.context))}}(p,s,c,m),T||O)for(const k of m){const F=s.getTile(k).getBucket(c);F&&gl(p.context,s,k,F,c,T,O)}if("shadow"===p.renderPass&&p.shadowRenderer){const k=p.shadowRenderer;if(T&&y<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof d.Z)return;const F=k.getShadowPassDepthMode(),V=k.getShadowPassColorMode();At(p,s,c,m,F,Qt.disabled,V,O)}else if("translucent"===p.renderPass){const k=!c.paint.get("fill-extrusion-pattern").constantOr(1),F=c.paint.get("fill-extrusion-color").constantOr(d.ax.white);if(!S&&0!==F.a){const V=new rt(p.context.gl.LEQUAL,rt.ReadWrite,p.depthRangeFor3D);1===y&&k?At(p,s,c,m,V,Qt.disabled,mn.unblended,O):(At(p,s,c,m,V,Qt.disabled,mn.disabled,O),At(p,s,c,m,V,p.stencilModeFor3D(),p.colorModeForRenderPass(),O),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&k&&(!T&&"globe"!==p.transform.projection.name||S)){const V=c.paint.get("fill-extrusion-opacity"),j=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),q=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),W=c.paint.get("fill-extrusion-flood-light-intensity"),Y=c.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),G=j>0&&q>0,J=W>0,re=(oe,X,se)=>(1-se)*oe+se*X,ee=oe=>{const X=p.depthModeForSublayer(1,rt.ReadOnly,C.LEQUAL,!0),se=c.paint.get(oe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),he=re(.1,3,se),fe=p._showOverdrawInspector;if(!fe){const ge=new Qt({func:C.ALWAYS,mask:255},255,255,C.KEEP,C.KEEP,C.REPLACE),De=new mn([C.ONE,C.ONE,C.ONE,C.ONE],d.ax.transparent,[!1,!1,!1,!0],C.MIN);Ro(p,s,c,m,X,ge,De,Ut.disabled,oe,"sdf",V,j,q,W,Y,he,O,!1)}{const ge=fe?Qt.disabled:new Qt({func:C.EQUAL,mask:255},255,255,C.KEEP,C.DECR,C.DECR),De=fe?p.colorModeForRenderPass():new mn([C.ONE_MINUS_DST_ALPHA,C.DST_ALPHA,C.ONE,C.ONE],d.ax.transparent,[!0,!0,!0,!0]);Ro(p,s,c,m,X,ge,De,Ut.disabled,oe,"color",V,j,q,W,Y,he,O,!1)}};if(S){const oe=(X,se,he)=>{const fe=p.depthModeForSublayer(1,rt.ReadOnly,C.LEQUAL,!1),ge=c.paint.get(X?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),De=re(.1,3,ge);{const ve=new mn([C.ONE,C.ONE,C.ONE,C.ONE],d.ax.transparent,[!1,!1,!1,!0]);Ro(p,s,c,m,fe,Qt.disabled,ve,Ut.disabled,X,"clear",V,j,q,W,Y,De,O,se)}{const ve=new Qt({func:C.ALWAYS,mask:255},255,255,C.KEEP,C.KEEP,C.REPLACE),Pe=new mn([C.ONE,C.ONE,C.ONE,C.ONE],d.ax.transparent,[!1,!1,!1,!0],C.MIN);Ro(p,s,c,m,fe,ve,Pe,Ut.disabled,X,"sdf",V,j,q,W,Y,De,O,se)}{const ve=X?C.ZERO:C.ONE_MINUS_DST_ALPHA,Pe=new Qt({func:C.EQUAL,mask:255},255,255,C.KEEP,C.DECR,C.DECR),Ae=new mn([ve,C.DST_ALPHA,C.ONE_MINUS_DST_ALPHA,C.ZERO],d.ax.transparent,[!0,!0,!0,!0]);Ro(p,s,c,m,fe,Pe,Ae,Ut.disabled,X,"color",V,j,q,W,Y,De,O,se)}{const ve=new mn([C.ONE,C.ONE,C.ONE,X?C.ZERO:C.ONE],d.ax.transparent,[!1,!1,!1,!0],X?C.FUNC_ADD:C.MAX);Ro(p,s,c,m,fe,Qt.disabled,ve,Ut.disabled,X,"clear",V,j,q,W,Y,De,O,se,he)}};if(G||J){let X;if(p.prepareDrawTile(),T){const se=T.drapeBufferSize[0],he=T.drapeBufferSize[1];X=T.framebufferCopyTexture,X&&(!X||X.size[0]===se&&X.size[1]===he)||(X&&X.destroy(),X=T.framebufferCopyTexture=new d.T(x,new d.h({width:se,height:he}),C.RGBA)),X.bind(C.LINEAR,C.CLAMP_TO_EDGE),C.copyTexImage2D(C.TEXTURE_2D,0,C.RGBA,0,0,se,he,0)}G&&oe(!0,!1,X),J&&oe(!1,!0,X)}}else G&&ee(!0),J&&ee(!1)}}},hillshade:function(p,s,c,m){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass||p.style.disableElevatedTerrain)return;const y=p.context,x=p.terrain&&p.terrain.renderingToTexture,[C,T]="translucent"!==p.renderPass||x?[{},m]:p.stencilConfigForOverlap(m);for(const S of T){const O=s.getTile(S);if(O.needsHillshadePrepare&&"offscreen"===p.renderPass)Hl(p,O,c);else if("translucent"===p.renderPass){const k=p.depthModeForSublayer(0,rt.ReadOnly),F=c.paint.get("hillshade-emissive-strength"),V=p.colorModeForDrapableLayerRenderPass(F),j=x&&p.terrain?p.terrain.stencilModeForRTTOverlap(S):C[S.overscaledZ];Yi(p,S,O,c,k,j,V)}}y.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,s,c,m,y,x){if("translucent"!==p.renderPass||0===c.paint.get("raster-opacity"))return;const C="globe"===p.transform.projection.name,T=0!==c.paint.get("raster-elevation"),S=T&&C;if(p.renderElevatedRasterBackface&&!S)return;const O=p.context,k=O.gl,F=s.getSource(),V=function(X,se,he,fe){const ge=se.paint.get("raster-color"),De="raster-array"===X.type,ve=[],Pe=se.paint.get("raster-resampling"),Ae=se.paint.get("raster-color-mix");let qe=se.paint.get("raster-color-range");const xe=[Ae[0],Ae[1],Ae[2],0],Se=Ae[3];let pe="nearest"===Pe?fe.NEAREST:fe.LINEAR;if(De&&(ve.push("RASTER_ARRAY"),ge||ve.push("RASTER_COLOR"),"linear"===Pe&&ve.push("RASTER_ARRAY_LINEAR"),pe=fe.NEAREST,!qe&&X.rasterLayers)){const Ee=X.rasterLayers.find(({id:He})=>He===se.sourceLayer);Ee&&Ee.fields&&Ee.fields.range&&(qe=Ee.fields.range)}if(qe=qe||[0,1],ge){ve.push("RASTER_COLOR"),he.activeTexture.set(fe.TEXTURE2),se.updateColorRamp(qe);let Ee=se.colorRampTexture;Ee||(Ee=se.colorRampTexture=new d.T(he,se.colorRamp,fe.RGBA)),Ee.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)}return{mix:xe,range:qe,offset:Se,defines:ve,resampling:pe}}(F,c,O,k);if(F instanceof d.ap&&!m.length&&!C)return;const j=c.paint.get("raster-emissive-strength"),q=p.colorModeForDrapableLayerRenderPass(j),W=p.terrain&&p.terrain.renderingToTexture,Y=!p.options.moving,G="nearest"===c.paint.get("raster-resampling")?k.NEAREST:k.LINEAR;if(F instanceof d.ap&&!m.length&&(F.onNorthPole||F.onSouthPole)){const X=T?p.stencilModeFor3D():Qt.disabled;return void _d(!!F.onNorthPole,null,p,s,c,j,V,Ut.disabled,X)}if(!m.length)return;const[J,re]=F instanceof d.ap||W?[{},m]:p.stencilConfigForOverlap(m),ee=re[re.length-1].overscaledZ;S&&V.defines.push("PROJECTION_GLOBE_VIEW"),T&&V.defines.push("RENDER_CUTOFF");const oe=(X,se,he)=>{for(const fe of X){const ge=fe.toUnwrapped(),De=s.getTile(fe);if(W&&(!De||!De.hasData()))continue;O.activeTexture.set(k.TEXTURE0);const ve=vd(De,F,c,V);if(!ve||!ve.texture)continue;const{texture:Pe,mix:Ae,offset:qe,tileSize:xe,buffer:Se}=ve;let pe,Ee;W?(pe=rt.disabled,Ee=fe.projMatrix):T?(pe=new rt(k.LEQUAL,rt.ReadWrite,p.depthRangeFor3D),Ee=C?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(ge,Y)):(pe=p.depthModeForSublayer(fe.overscaledZ-ee,1===c.paint.get("raster-opacity")?rt.ReadWrite:rt.ReadOnly,k.LESS),Ee=p.transform.calculateProjMatrix(ge,Y));const He=p.terrain&&W?p.terrain.stencilModeForRTTOverlap(fe):J[fe.overscaledZ],et=x?0:c.paint.get("raster-fade-duration");De.registerFadeDuration(et);const Je=s.findLoadedParent(fe,0),pt=ur(De,Je,s,p.transform,et);let Mt,zt;p.terrain&&p.terrain.prepareDrawTile(),O.activeTexture.set(k.TEXTURE0),Pe.bind(G,k.CLAMP_TO_EDGE),O.activeTexture.set(k.TEXTURE1),Je?(Je.texture&&Je.texture.bind(G,k.CLAMP_TO_EDGE),Mt=Math.pow(2,Je.tileID.overscaledZ-De.tileID.overscaledZ),zt=[De.tileID.canonical.x*Mt%1,De.tileID.canonical.y*Mt%1]):Pe.bind(G,k.CLAMP_TO_EDGE),Pe.useMipmap&&O.extTextureFilterAnisotropic&&p.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);const Ot=p.transform;let Dt;const hn=T?yd(Ot):[0,0,0,0];let Yt,en,tn,Dn,gi,En=0;if(S&&F instanceof d.ap&&F.coordinates.length>3)Yt=Float32Array.from(d.aT(d.ci(new d.bs(0,0,0)))),en=Float32Array.from(Ot.globeMatrix),tn=Float32Array.from(d.ce(Ot)),Dn=[d.a5(Ot.center.lng),d.ae(Ot.center.lat)],Dt=F.elevatedGlobePerspectiveTransform,gi=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(S){const vn=d.cf(fe.canonical);En=d.cg(vn.getCenter().lat),Yt=Float32Array.from(d.aT(d.ci(fe.canonical))),en=Float32Array.from(Ot.globeMatrix),tn=Float32Array.from(d.ce(Ot)),Dn=[d.a5(Ot.center.lng),d.ae(Ot.center.lat)],Dt=[0,0],gi=Float32Array.from(d.ch(fe.canonical,vn,En,Ot.worldSize/Ot._pixelsPerMercatorPixel))}else Dt=F instanceof d.ap?F.perspectiveTransform:[0,0],Yt=new Float32Array(16),en=new Float32Array(9),tn=new Float32Array(16),Dn=[0,0],gi=new Float32Array(9);const Vi=jc(Ee,Yt,en,tn,gi,zt||[0,0],d.S(p.transform.zoom),Dn,hn,Mt||1,pt,c,Dt,T?c.paint.get("raster-elevation"):0,2,Ae,qe,V.range,xe,Se,j),yn=p.isTileAffectedByFog(fe),Nn=p.getOrCreateProgram("raster",{defines:V.defines,overrideFog:yn});if(p.uploadCommonUniforms(O,Nn,ge),F instanceof d.ap){const vn=F.elevatedGlobeVertexBuffer,zn=F.elevatedGlobeIndexBuffer;if(W||!C)F.boundsBuffer&&F.boundsSegments&&Nn.draw(p,k.TRIANGLES,pe,Qt.disabled,q,Ut.disabled,Vi,c.id,F.boundsBuffer,p.quadTriangleIndexBuffer,F.boundsSegments);else if(vn&&zn){const vi=Ot.zoom<=d.bG?F.elevatedGlobeSegments:F.getSegmentsForLongitude(Ot.center.lng);vi&&Nn.draw(p,k.TRIANGLES,pe,Qt.disabled,q,se,Vi,c.id,vn,zn,vi)}}else if(S){pe=new rt(k.LEQUAL,rt.ReadOnly,p.depthRangeFor3D);const vn=p.globeSharedBuffers;if(vn){const[zn,vi,Rn]=vn.getGridBuffers(En,!1);Nn.draw(p,k.TRIANGLES,pe,he||He,p.colorModeForRenderPass(),se,Vi,c.id,zn,vi,Rn)}}else{const{tileBoundsBuffer:vn,tileBoundsIndexBuffer:zn,tileBoundsSegments:vi}=p.getTileBoundsBuffers(De);Nn.draw(p,k.TRIANGLES,pe,He,q,Ut.disabled,Vi,c.id,vn,zn,vi)}}if(!(F instanceof d.ap)&&S)for(const fe of X){const ge=fe.canonical.y===(1<<fe.canonical.z)-1;0===fe.canonical.y&&_d(!0,fe,p,s,c,j,V,se,he||Qt.disabled),ge&&_d(!1,fe,p,s,c,j,V,se===Ut.frontCW?Ut.backCW:Ut.frontCW,he||Qt.disabled)}};S?oe(re,p.renderElevatedRasterBackface?Ut.backCW:Ut.frontCW,p.stencilModeFor3D()):oe(re,Ut.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,s,c,m,y,x){"offscreen"===p.renderPass&&function(C,T,S,O){if(!O.length)return;const k=C.context,F=k.gl,V=T.getSource();if(!(V instanceof st))return;const j=[];for(const Y of O){const G=T.getTile(Y);if(!(G instanceof jr))continue;const J=xd(G,V,S);if(!J)continue;const re=[J.tileSize,J.tileSize];let ee=S.tileFramebuffer;ee||(ee=S.tileFramebuffer=k.createFramebuffer(re[0],re[1],!0,null));let oe=G.rasterParticleState;const X=S.paint.get("raster-particle-count");oe||(oe=G.rasterParticleState=new Ui(k,Y,re,X));const se=oe.update(S.lastInvalidatedAt);oe.numParticles!==X&&oe.setNumParticles(Y,X);const he=oe.targetColorTexture;oe.targetColorTexture=oe.backgroundColorTexture,oe.backgroundColorTexture=he;const fe=oe.particleVertices0;oe.particleVertices0=oe.particleVertices1,oe.particleVertices1=fe,j.push([Y,J,oe,se])}if(0===j.length)return;const q=d.f.now(),W=S.previousDrawTimestamp?.001*(q-S.previousDrawTimestamp):.0167;if(S.previousDrawTimestamp=q,S.hasColorMap()){k.activeTexture.set(F.TEXTURE0+2);let Y=S.colorRampTexture;Y||(Y=S.colorRampTexture=new d.T(k,S.colorRamp,F.RGBA)),Y.bind(F.LINEAR,F.CLAMP_TO_EDGE)}k.bindFramebuffer.set(S.tileFramebuffer.framebuffer),k.activeTexture.set(F.TEXTURE0),function(Y,G,J){const re=Y.context,ee=re.gl,oe=G.tileFramebuffer;re.activeTexture.set(ee.TEXTURE0);const X={u_texture:0,u_opacity:1.05*(he=G.paint.get("raster-particle-fade-opacity-factor"))/(he+.05)},se=Y.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var he;for(const fe of J){const[,,ge,De]=fe;oe.colorAttachment.set(ge.targetColorTexture.texture),re.viewport.set([0,0,oe.width,oe.height]),re.clear({color:d.ax.transparent}),De&&(ge.backgroundColorTexture.bind(ee.NEAREST,ee.CLAMP_TO_EDGE),se.draw(Y,ee.TRIANGLES,rt.disabled,Qt.disabled,mn.alphaBlended,Ut.disabled,X,G.id,Y.viewportBuffer,Y.quadTriangleIndexBuffer,Y.viewportSegments))}}(C,S,j),function(Y,G,J,re){const ee=Y.context.gl,oe=J.tileFramebuffer,X="globe"===Y.transform.projection.name,se=J.paint.get("raster-particle-max-speed");for(const he of re){const[fe,ge,De]=he;ge.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),oe.colorAttachment.set(De.targetColorTexture.texture);const ve=Y.getOrCreateProgram("rasterParticleDraw",{defines:ge.defines,overrideFog:!1}),Pe=ge.scalarData?[]:[0,1,2,3].map(xe=>d.cG[xe](fe));Pe.push(fe);const Ae=fe.canonical.x,qe=fe.canonical.y;for(const xe of Pe){const Se=G.getTile(X?xe.wrapped():xe);if(!Se)continue;const pe=Se.rasterParticleState;if(!pe)continue;const Ee=F_([xe.canonical.x+(1<<xe.canonical.z)*(xe.wrap-fe.wrap)-Ae,xe.canonical.y-qe],0,ge.texture.size,2,se,ge.textureOffset,ge.scale,ge.offset);ve.draw(Y,ee.POINTS,rt.disabled,Qt.disabled,mn.alphaBlended,Ut.disabled,Ee,J.id,pe.particleVertices0,void 0,pe.particleSegment)}}}(C,T,S,j),function(Y,G,J,re){const ee=Y.context.gl;let oe=G.transformFeedbackObject;oe||(oe=G.transformFeedbackObject=ee.createTransformFeedback()),ee.bindTransformFeedback(ee.TRANSFORM_FEEDBACK,G.transformFeedbackObject);const X=G.paint.get("raster-particle-max-speed"),se=re*G.paint.get("raster-particle-speed-factor")*.3,he=(fe=G.paint.get("raster-particle-reset-rate-factor"),Math.pow(fe,6));var fe;for(const ge of J){const[,De,ve]=ge;De.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const Pe=Mm(0,De.texture.size,X,se,he,De.textureOffset,De.scale,De.offset);Y.getOrCreateProgram("rasterParticleUpdate",{defines:De.defines,transformFeedback:{bufferMode:ee.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(Y,ee.POINTS,rt.disabled,Qt.disabled,mn.disabled,Ut.disabled,Pe,G.id,ve.particleVertices0,void 0,ve.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:ve.particleVertices1,targetIndex:0}])}ee.bindTransformFeedback(ee.TRANSFORM_FEEDBACK,null)}(C,S,j,W)}(p,s,c,m),"translucent"===p.renderPass&&(function(C,T,S,O,k){const F=C.context,V=F.gl,j=!C.options.moving,q="globe"===C.transform.projection.name;if(!O.length)return;const[W,Y]=C.stencilConfigForOverlap(O),G=[];q&&G.push("PROJECTION_GLOBE_VIEW");for(const J of Y){const re=J.toUnwrapped(),ee=T.getTile(J);if(!ee.rasterParticleState)continue;const oe=ee.rasterParticleState,X=100;ee.registerFadeDuration(X);const se=T.findLoadedParent(J,0),he=ur(ee,se,T,C.transform,X);let fe,ge;C.terrain&&C.terrain.prepareDrawTile(),F.activeTexture.set(V.TEXTURE0),oe.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),F.activeTexture.set(V.TEXTURE1),se&&se.rasterParticleState?(se.rasterParticleState.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),fe=Math.pow(2,se.tileID.overscaledZ-ee.tileID.overscaledZ),ge=[ee.tileID.canonical.x*fe%1,ee.tileID.canonical.y*fe%1]):oe.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const De=q?Float32Array.from(C.transform.expandedFarZProjMatrix):C.transform.calculateProjMatrix(re,j),ve=C.transform,Pe=Uu(ve),Ae=d.cf(J.canonical),qe=d.cg(Ae.getCenter().lat);let xe,Se,pe,Ee,He;q?(xe=Float32Array.from(d.aT(d.ci(J.canonical))),Se=Float32Array.from(ve.globeMatrix),pe=Float32Array.from(d.ce(ve)),Ee=[d.a5(ve.center.lng),d.ae(ve.center.lat)],He=Float32Array.from(d.ch(J.canonical,Ae,qe,ve.worldSize/ve._pixelsPerMercatorPixel))):(xe=new Float32Array(16),Se=new Float32Array(9),pe=new Float32Array(16),Ee=[0,0],He=new Float32Array(9));const et=zf(De,xe,Se,pe,He,ge||[0,0],d.S(C.transform.zoom),Ee,Pe,fe||1,he,250),Je=C.isTileAffectedByFog(J),pt=C.getOrCreateProgram("rasterParticle",{defines:G,overrideFog:Je});if(C.uploadCommonUniforms(F,pt,re),q){const Mt=new rt(V.LEQUAL,rt.ReadWrite,C.depthRangeFor3D),zt=0,Ot=C.globeSharedBuffers;if(Ot){const[Dt,hn,Yt]=Ot.getGridBuffers(qe,0!==zt);pt.draw(C,V.TRIANGLES,Mt,Qt.disabled,mn.alphaBlended,Ut.backCCW,et,S.id,Dt,hn,Yt)}}else{const Mt=C.depthModeForSublayer(0,rt.ReadOnly),zt=W[J.overscaledZ],{tileBoundsBuffer:Ot,tileBoundsIndexBuffer:Dt,tileBoundsSegments:hn}=C.getTileBoundsBuffers(ee);pt.draw(C,V.TRIANGLES,Mt,zt,mn.alphaBlended,Ut.disabled,et,S.id,Ot,Dt,hn)}}C.resetStencilClippingMasks()}(p,s,c,m),p.style.map.triggerRepaint())},background:function(p,s,c,m){const y=c.paint.get("background-color"),x=c.paint.get("background-opacity"),C=c.paint.get("background-emissive-strength");if(0===x)return;const T=p.context,S=T.gl,O=p.transform,k=O.tileSize,F=c.paint.get("background-pattern");if(p.isPatternMissing(F,c.scope))return;const V=!F&&1===y.a&&1===x&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==V)return;const j=Qt.disabled,q=p.depthModeForSublayer(0,"opaque"===V?rt.ReadWrite:rt.ReadOnly),W=p.colorModeForDrapableLayerRenderPass(C),Y=F?"backgroundPattern":"background";let G,J=m;J||(G=p.getBackgroundTiles(),J=Object.values(G).map(re=>re.tileID)),F&&(T.activeTexture.set(S.TEXTURE0),p.imageManager.bind(p.context,c.scope));for(const re of J){const ee=p.isTileAffectedByFog(re),oe=p.getOrCreateProgram(Y,{overrideFog:ee}),X=re.toUnwrapped(),se=m?re.projMatrix:p.transform.calculateProjMatrix(X);p.prepareDrawTile();const he=s?s.getTile(re):G?G[re.key]:new kl(re,k,O.zoom,p),fe=F?fd(se,C,x,p,F,c.scope,{tileID:re,tileSize:k}):Im(se,C,x,y);p.uploadCommonUniforms(T,oe,X);const{tileBoundsBuffer:ge,tileBoundsIndexBuffer:De,tileBoundsSegments:ve}=p.getTileBoundsBuffers(he);oe.draw(p,S.TRIANGLES,q,j,W,Ut.disabled,fe,c.id,ge,De,ve)}},sky:function(p,s,c){const m=p._atmosphere?d.S(p.transform.zoom):1,y=c.paint.get("sky-opacity")*m;if(0===y)return;const x=p.context,C=c.paint.get("sky-type"),T=new rt(x.gl.LEQUAL,rt.ReadOnly,[0,1]),S=p.frameCounter/1e3%1;"atmosphere"===C?"offscreen"===p.renderPass?c.needsSkyboxCapture(p)&&(function(O,k,F,V){const j=O.context,q=j.gl;let W=k.skyboxFbo;if(!W){W=k.skyboxFbo=j.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new Rm(j),k.skyboxTexture=j.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,k.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let re=0;re<6;++re)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(W.framebuffer),j.viewport.set([0,0,32,32]);const Y=k.getCenter(O,!0),G=O.getOrCreateProgram("skyboxCapture"),J=new Float64Array(16);d.a6.identity(J),d.a6.rotateY(J,J,.5*-Math.PI),Kl(O,k,G,J,Y,0),d.a6.identity(J),d.a6.rotateY(J,J,.5*Math.PI),Kl(O,k,G,J,Y,1),d.a6.identity(J),d.a6.rotateX(J,J,.5*-Math.PI),Kl(O,k,G,J,Y,2),d.a6.identity(J),d.a6.rotateX(J,J,.5*Math.PI),Kl(O,k,G,J,Y,3),d.a6.identity(J),Kl(O,k,G,J,Y,4),d.a6.identity(J),d.a6.rotateY(J,J,Math.PI),Kl(O,k,G,J,Y,5),j.viewport.set([0,0,O.width,O.height])}(p,c),c.markSkyboxValid(p)):"sky"===p.renderPass&&function(O,k,F,V,j){const q=O.context,W=q.gl,Y=O.transform,G=O.getOrCreateProgram("skybox");q.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_CUBE_MAP,k.skyboxTexture);const J={u_matrix:Y.skyboxMatrix,u_sun_direction:k.getCenter(O,!1),u_cubemap:0,u_opacity:V,u_temporal_offset:j};O.uploadCommonUniforms(q,G),G.draw(O,W.TRIANGLES,F,Qt.disabled,O.colorModeForRenderPass(),Ut.backCW,J,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(p,c,T,y,S):"gradient"===C&&"sky"===p.renderPass&&function(O,k,F,V,j){const q=O.context,W=q.gl,Y=O.transform,G=O.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new Rm(q)),q.activeTexture.set(W.TEXTURE0);let J=k.colorRampTexture;J||(J=k.colorRampTexture=new d.T(q,k.colorRamp,W.RGBA)),J.bind(W.LINEAR,W.CLAMP_TO_EDGE);const re=(ee=Y.skyboxMatrix,oe=k.getCenter(O,!1),X=k.paint.get("sky-gradient-radius"),se=V,he=j,{u_matrix:ee,u_color_ramp:0,u_center_direction:oe,u_radius:d.bj(X),u_opacity:se,u_temporal_offset:he});var ee,oe,X,se,he;O.uploadCommonUniforms(q,G),G.draw(O,W.TRIANGLES,F,Qt.disabled,O.colorModeForRenderPass(),Ut.backCW,re,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(p,c,T,y,S)},debug:function(p,s,c,m,y,x){for(let C=0;C<c.length;C++)if(y){const O=new d.ax(.8*m.r,.8*m.g,.8*m.b,1);Pa(p,s,c[C],m,-1,-1,x),Pa(p,s,c[C],m,-1,1,x),Pa(p,s,c[C],m,1,1,x),Pa(p,s,c[C],m,1,-1,x),Pa(p,s,c[C],O,0,0,x)}else Pa(p,s,c[C],m,0,0,x)},custom:function(p,s,c,m){const y=p.context,x=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||"offscreen"===p.renderPass)&&c.isLayerDraped(s)){if("offscreen"===p.renderPass){const C=x.prerender;if(C){if(p.setCustomLayerDefaults(),y.setColorMode(p.colorModeForRenderPass()),"globe"===p.transform.projection.name){const T=p.transform.pointMerc;C.call(x,y.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),d.S(p.transform.zoom),[T.x,T.y],p.transform.pixelsPerMeterRatio)}else C.call(x,y.gl,p.transform.customLayerMatrix());y.setDirty(),p.setBaseState()}}else if("translucent"===p.renderPass){if(p.terrain&&p.terrain.renderingToTexture){const T=x.renderToTile;if(T){const S=m[0].canonical,O=new d.L(S.x+m[0].wrap*(1<<S.z),S.y,S.z);y.setDepthMode(rt.disabled),y.setStencilMode(Qt.disabled),y.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),T.call(x,y.gl,O),y.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),y.setColorMode(p.colorModeForRenderPass()),y.setStencilMode(Qt.disabled);const C="3d"===x.renderingMode?new rt(p.context.gl.LEQUAL,rt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,rt.ReadOnly);if(y.setDepthMode(C),"globe"===p.transform.projection.name){const T=p.transform.pointMerc;x.render(y.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),d.S(p.transform.zoom),[T.x,T.y],p.transform.pixelsPerMeterRatio)}else x.render(y.gl,p.transform.customLayerMatrix());y.setDirty(),p.setBaseState(),y.bindFramebuffer.set(null)}}else d.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,s,c,m){if("opaque"===p.renderPass)return;const y=c.paint.get("model-opacity");if(0===y)return;const x=c.paint.get("model-cast-shadows");if("shadow"===p.renderPass&&(!x||p.terrain&&y<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof d.Z))return;const C=p.shadowRenderer,T=c.paint.get("model-receive-shadows");C&&(C.useNormalOffset=!0,T||(C.enabled=!1));const S=()=>{C&&(C.useNormalOffset=!0,T||(C.enabled=!0))},O=s.getSource();if("light-beam"===p.renderPass&&"batched-model"!==O.type)return;if("vector"===O.type||"geojson"===O.type)return function(G,J,re,ee){const oe=G.transform;if("mercator"!==oe.projection.name)return void d.w(`Drawing 3D models for ${oe.projection.name} projection is not yet implemented`);const X=oe.getFreeCameraOptions().position;if(!G.modelManager)return;const se=G.modelManager;re.modelManager=se;const he=G.shadowRenderer;if(!re._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const fe=re._unevaluatedLayout._values["model-id"],ge={...re.layout.get("model-id").parameters};for(const De of ee){const ve=J.getTile(De).getBucket(re);if(!ve||ve.projection.name!==oe.projection.name)continue;const Pe=Pm(De,oe);ge.zoom=Pe;const Ae=fe.possiblyEvaluate(ge);if(Dd(G,ve,De),Yo.shadowUniformsInitialized=!1,Yo.useSingleShadowCascade=!!he&&0===he.getMaxCascadeForTile(De.toUnwrapped()),"shadow"===G.renderPass&&he){if(1===G.currentShadowCascade&&ve.isInsideFirstShadowMapFrustum)continue;const Se=oe.calculatePosMatrix(De.toUnwrapped(),oe.worldSize);if(Yo.tileMatrix.set(Se),Yo.shadowTileMatrix=Float32Array.from(he.calculateShadowPassMatrixFromMatrix(Se)),Yo.aabb.min.fill(0),Yo.aabb.max[0]=Yo.aabb.max[1]=d.V,Yo.aabb.max[2]=0,B_(ve,Yo,G,re.scope))continue}const qe=1<<De.canonical.z,xe=[((X.x-De.wrap)*qe-De.canonical.x)*d.V,(X.y*qe-De.canonical.y)*d.V,X.z*qe*d.V];for(let Se in ve.instancesPerModel){const pe=ve.instancesPerModel[Se];pe.features.length>0&&(Se=Ae.evaluate(pe.features[0].feature,{}));const Ee=se.getModel(Se,re.scope);if(Ee&&Ee.uploaded)for(const He of Ee.nodes)Uf(G,re,He,pe,xe,De,Yo)}}}(p,s,c,m),void S();if(!O.loaded())return;if("batched-model"===O.type)return function(G,J,re,ee){re.resetLayerRenderingStats(G);const oe=G.context,X=G.transform,se=G.style.fog,he=G.shadowRenderer;if("mercator"!==X.projection.name)return void d.w(`Drawing 3D landmark models for ${X.projection.name} projection is not yet implemented`);const fe=G.transform.getFreeCameraOptions().position,ge=d.N.scale([],[fe.x,fe.y,fe.z],G.transform.worldSize);d.N.negate(ge,ge);const De=d.a6.identity([]),ve=d.cR(X.center.lat,X.zoom),Pe=d.a6.fromScaling([],[1,1,1/ve]);d.a6.translate(De,De,ge);const Ae=re.paint.get("model-opacity"),qe=new rt(oe.gl.LEQUAL,rt.ReadWrite,G.depthRangeFor3D),xe=new rt(oe.gl.LEQUAL,rt.ReadOnly,G.depthRangeFor3D),Se=new d.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),pe="shadow"===G.renderPass,Ee=pe&&he?he.getCurrentCascadeFrustum():X.getFrustum(X.scaleZoom(X.worldSize)),He=re.getLayerRenderingStats(),et=function(Je,pt){for(const Mt of ee){const zt=J.getTile(Mt).getBucket(re);if(!zt||!zt.uploaded)continue;let Ot=!1;he&&(Ot=0===he.getMaxCascadeForTile(Mt.toUnwrapped()));const Dt=X.calculatePosMatrix(Mt.toUnwrapped(),X.worldSize),hn=zt.modelTraits;for(const Yt of zt.getNodesInfo()){if(Yt.hiddenByReplacement||!Yt.node.meshes)continue;const en=Yt.evaluatedScale,tn=Yt.node;let Dn=0;if(G.terrain&&tn.elevation&&(Dn=tn.elevation*G.terrain.exaggeration()),en[0]<=1&&en[1]<=1&&en[2]<=1&&0===(()=>{const vi=Yt.getLocalBounds();return Se.min=[...vi.min],Se.max=[...vi.max],Se.min[2]+=Dn,Se.max[2]+=Dn,d.N.transformMat4(Se.min,Se.min,Dt),d.N.transformMat4(Se.max,Se.max,Dt),Se})().intersects(Ee))continue;const gi="light-beam"===G.renderPass,En=[...Dt];d.a6.translate(En,En,[(tn.anchor?tn.anchor[0]:0)*(en[0]-1),(tn.anchor?tn.anchor[1]:0)*(en[1]-1),Dn]),d.N.exactEquals(en,d.cT)||d.a6.scale(En,En,en),d.a6.multiply(En,En,tn.matrix);const Vi=d.a6.multiply([],Pe,En);d.a6.multiply(Vi,De,Vi);const yn=d.a6.invert([],Vi);d.a6.transpose(yn,yn),d.a6.scale(yn,yn,Jl);const Nn=d.a6.multiply([],X.expandedFarZProjMatrix,En),vn=hn&d.cV.HasMapboxMeshFeatures,zn=vn?0:Yt.evaluatedRMEA[0][2];for(let vi=0;vi<tn.meshes.length;++vi){const Rn=tn.meshes[vi],Sr=vi===tn.lightMeshIndex;if(Sr){if(!gi&&!G.terrain&&G.shadowRenderer){G.currentLayer<G.firstLightBeamLayer&&(G.firstLightBeamLayer=G.currentLayer);continue}}else if(gi)continue;const zr={defines:[]},bo=[];if(Xi(zr.defines,bo,Rn,G),vn||zr.defines.push("DIFFUSE_SHADED"),Ot&&zr.defines.push("SHADOWS_SINGLE_CASCADE"),He&&(pe?He.numRenderedVerticesInShadowPass+=Rn.vertexArray.length:He.numRenderedVerticesInTransparentPass+=Rn.vertexArray.length),pe){Ce(Rn,En,G,re);continue}let Oo=null;if(se){const Lo=Oa(En,G.transform);if(Oo=new Float32Array(Lo),"globe"!==X.projection.name){const Fs=Rn.aabb.min,Ns=Rn.aabb.max,[gs,fa]=se.getOpacityForBounds(Lo,Fs[0],Fs[1],Ns[0],Ns[1]);zr.overrideFog=gs>=Qn||fa>=Qn}}const ko=Rn.material;let Ei;ko.occlusionTexture&&ko.occlusionTexture.offsetScale&&(Ei=ko.occlusionTexture.offsetScale,zr.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!pe&&he&&(he.useNormalOffset=!!Rn.normalBuffer);const mr=G.getOrCreateProgram("model",zr);!pe&&he&&he.setupShadowsFromMatrix(En,mr,he.useNormalOffset),G.uploadCommonUniforms(oe,mr,Mt.toUnwrapped(),Oo);const to=ko.pbrMetallicRoughness;to.metallicFactor=.9,to.roughnessFactor=.5;const no=Vf(new Float32Array(Nn),new Float32Array(Vi),new Float32Array(yn),G,Ae,to.baseColorFactor,ko.emissiveFactor,to.metallicFactor,to.roughnessFactor,ko,zn,re,[0,0,0],Ei);mr.draw(G,oe.gl.TRIANGLES,pt&&!Sr?qe:xe,Qt.disabled,Je?Sr||Ae<1||Yt.hasTranslucentParts?mn.alphaBlended:mn.unblended:mn.disabled,Ut.backCCW,no,re.id,Rn.vertexBuffer,Rn.indexBuffer,Rn.segments,re.paint,G.transform.zoom,void 0,bo)}}}};(function(Je,pt,Mt,zt){const Ot=Je.terrain?Je.terrain.exaggeration():0,Dt=Je.transform.zoom;for(const hn of zt){const Yt=pt.getTile(hn).getBucket(Mt);Yt&&(Je.conflationActive&&Yt.updateReplacement(hn,Je.replacementSource),Yt.evaluateScale(Je,Mt),Je.terrain&&Ot>0&&Yt.elevationUpdate(Je.terrain,Ot,hn,Mt.source),Yt.needsReEvaluation(Je,Dt,Mt)&&Yt.evaluate(Mt))}})(G,J,re,ee),1===Ae?et(!0,!0):(et(!1,!0),et(!0,!1))}(p,s,c,m),void S();const k=O.getModels(),F=[],V=p.transform.getFreeCameraOptions().position,j=d.N.scale([],[V.x,V.y,V.z],p.transform.worldSize);d.N.negate(j,j);const q=[],W=[];let Y=0;for(const G of k){const J=c.paint.get("model-rotation").constantOr(null),re=c.paint.get("model-scale").constantOr(null),ee=c.paint.get("model-translation").constantOr(null);G.computeModelMatrix(p,J,re,ee,!0,!0,!1);const oe=d.a6.identity([]),X=d.cR(G.position.lat,p.transform.zoom),se=d.a6.fromScaling([],[1,1,1/X]);d.a6.translate(oe,oe,j),F.push({zScaleMatrix:se,negCameraPosMatrix:oe});for(const he of G.nodes)Hu(p.transform,he,G.matrix,p.transform.expandedFarZProjMatrix,Y,q,W);Y++}if(q.sort((G,J)=>J.depth-G.depth),"shadow"!==p.renderPass){if(1===y)for(const G of W)Cd(G,p,c,F[G.modelIndex],Qt.disabled,p.colorModeForRenderPass());else{for(const G of W)Cd(G,p,c,F[G.modelIndex],Qt.disabled,mn.disabled);for(const G of W)Cd(G,p,c,F[G.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}for(const G of q)Cd(G,p,c,F[G.modelIndex],Qt.disabled,p.colorModeForRenderPass());S()}else{for(const G of W)Ce(G.mesh,G.nodeModelMatrix,p,c);for(const G of q)Ce(G.mesh,G.nodeModelMatrix,p,c);S()}}},la={model:function(p,s,c){const m=p.scope,y=s.getSource();if(!y.loaded())return;if("vector"===y.type||"geojson"===y.type)return void(c.modelManager&&c.modelManager.upload(c,m));if("batched-model"===y.type)return;const x=y.getModels();for(const C of x)C.upload(c.context)},raster:function(p,s,c){const m=s.getSource();if(!(m instanceof st&&m.loaded()))return;const y=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!y)return;const x=p.paint.get("raster-array-band")||m.getInitialBand(y);if(null==x)return;const C=s.getIds().map(T=>s.getTileByID(T));for(const T of C)T.updateNeeded(y,x)&&m.prepareTile(T,y,x)},"raster-particle":function(p,s,c){const m=s.getSource();if(!(m instanceof st&&m.loaded()))return;const y=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!y)return;const x=p.paint.get("raster-particle-array-band")||m.getInitialBand(y);if(null==x)return;const C=s.getIds().map(T=>s.getTileByID(T));for(const T of C)T.updateNeeded(y,x)&&m.prepareTile(T,y,x)}};class $f{constructor(s,c,m,y){this.context=new _m(s,c),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._debugParams={showTerrainProxyTiles:!1},y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=Qs.maxUnderzooming+Qs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new d.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Zo(this),this._wireframeDebugCache=new km,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(s,c){const m=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Nu(this,s));const y=this._terrain;this.transform.elevation=m?y:null,y.update(s,this.transform,c),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(s){const c=s.fog;if(!c||"globe"===this.transform.projection.name||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,y]=c.getFovAdjustedRange(this.transform._fov);if(m>y)return void(this.transform.fogCullDistSq=null);const x=m+.78*(y-m);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,c){if(this.width=s*d.f.devicePixelRatio,this.height=c*d.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._mergedLayers[m].resize()}setup(){const s=this.context,c=new d.aN;c.emplaceBack(0,0),c.emplaceBack(d.V,0),c.emplaceBack(0,d.V),c.emplaceBack(d.V,d.V),this.tileExtentBuffer=s.createVertexBuffer(c,d.aP.members),this.tileExtentSegments=d.aB.simpleSegment(0,0,4,2);const m=new d.aN;m.emplaceBack(0,0),m.emplaceBack(d.V,0),m.emplaceBack(0,d.V),m.emplaceBack(d.V,d.V),this.debugBuffer=s.createVertexBuffer(m,d.aP.members),this.debugSegments=d.aB.simpleSegment(0,0,4,5);const y=new d.aN;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(y,d.aP.members),this.viewportSegments=d.aB.simpleSegment(0,0,4,2);const x=new d.av;x.emplaceBack(0,0,0,0),x.emplaceBack(d.V,0,d.V,0),x.emplaceBack(0,d.V,0,d.V),x.emplaceBack(d.V,d.V,d.V,d.V),this.mercatorBoundsBuffer=s.createVertexBuffer(x,d.aR.members),this.mercatorBoundsSegments=d.aB.simpleSegment(0,0,4,2);const C=new d.aw;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(C);const T=new d.aO;for(const O of[0,1,3,2,0])T.emplaceBack(O);this.debugIndexBuffer=s.createIndexBuffer(T),this.emptyTexture=new d.T(s,new d.h({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=d.a6.create();const S=this.context.gl;this.stencilClearMode=new Qt({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,rt.disabled,this.stencilClearMode,mn.disabled,Ut.disabled,dl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,c,m){if(!c||this.currentStencilSource===c.id||!s.isTileClipped()||!m||0===m.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const S of m)if(void 0===this._tileClippingMaskIDs[S.key]){T=!0;break}if(!T)return}this.currentStencilSource=c.id;const y=this.context,x=y.gl;this.nextStencilID+m.length>256&&this.clearStencil(),y.setColorMode(mn.disabled),y.setDepthMode(rt.disabled);const C=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of m){const S=c.getTile(T),O=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:F,tileBoundsSegments:V}=this.getTileBoundsBuffers(S);C.draw(this,x.TRIANGLES,rt.disabled,new Qt({func:x.ALWAYS,mask:0},O,255,x.KEEP,x.KEEP,x.REPLACE),mn.disabled,Ut.disabled,dl(T.projMatrix),"$clipping",k,F,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,c=this.context.gl;return new Qt({func:c.NOTEQUAL,mask:255},s,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const c=this.context.gl;return new Qt({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(s){const c=this.context.gl,m=s.sort((C,T)=>T.overscaledZ-C.overscaledZ),y=m[m.length-1].overscaledZ,x=m[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const C={};for(let T=0;T<x;T++)C[T+y]=new Qt({func:c.GEQUAL,mask:255},T+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[C,m]}return[{[y]:Qt.disabled},m]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new mn([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new d.ax(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?mn.unblended:mn.alphaBlended}colorModeForDrapableLayerRenderPass(s){const c=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new mn([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new d.ax(0,0,0,void 0===s?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,c,m,y=!1){if(!this.opaquePassEnabledForLayer()&&!y)return rt.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new rt(m||this.context.gl.LEQUAL,c,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,c){this._wireframeDebugCache.update(this.frameCounter),this.style=s,this.options=c;const m=this.style._mergedLayers,y=this.style.order,x=y.map(X=>m[X]),C=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(d.f.now()),this.imageManager.beginFrame();let T=0,S=!1;for(const X in C){const se=C[X];se.used&&(se.prepare(this.context),se.getSource().usedInConflation&&++T)}for(const X of x)X.isHidden(this.transform.zoom)||this.prepareLayer(X);const O={},k={},F={},V={},j={};for(const X in C){const se=C[X];O[X]=se.getVisibleCoordinates(),k[X]=O[X].slice().reverse(),F[X]=se.getVisibleCoordinates(!0).reverse(),V[X]=se.getShadowCasterCoordinates(),j[X]=se.sortCoordinatesByDistance(O[X])}const q=X=>{const se=this.style.getLayerSourceCache(X);return se&&se.used?se.getSource():null};if(T){const X=[];for(const se of x)this.layerUsedInConflation(se,q(se))&&X.push(se);if(X&&X.length>1){const se=[];for(const he of X){const fe=this.style.getLayerSourceCache(he);fe&&fe.used&&fe.getSource().usedInConflation&&se.push({layer:he.fqid,cache:fe})}this.replacementSource.setSources(se),S=!0}}S||this.replacementSource.clear(),this.conflationActive=S,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const X of x){const se=X.cutoffRange();if(this.longestCutoffRange=Math.max(se,this.longestCutoffRange),se>0){const he=q(X);he&&(this.minCutoffZoom=Math.max(he.minzoom,this.minCutoffZoom)),X.minzoom&&(this.minCutoffZoom=Math.max(X.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let X=0;X<x.length;X++)if(x[X].is3D()){this.opaquePassCutoff=X;break}const W=this.style&&this.style.fog;W?(this._fogVisible=0!==W.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=W.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(F),this.opaquePassCutoff=0);const Y=this._shadowRenderer;if(Y){Y.updateShadowParameters(this.transform,this.style.directionalLight);for(const X in C)for(const se of O[X]){let he={min:0,max:0};this.terrain&&(he=this.terrain.getMinMaxForTile(se)||he),Y.addShadowReceiver(se.toUnwrapped(),he.min,he.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new d.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Vt(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!d.cZ(this.context.gl))return;this.renderPass="offscreen";for(const X of x){const se=s.getLayerSourceCache(X);if(!X.hasOffscreenPass()||X.isHidden(this.transform.zoom))continue;const he=se?k[se.id]:void 0;("custom"===X.type||"raster"===X.type||"raster-particle"===X.type||X.isSky()||he&&he.length)&&this.renderLayer(this,se,X,he)}this.depthRangeFor3D=[0,1-(x.length+2)*this.numSublayers*this.depthEpsilon];const G=this.terrain;G&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&G.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,V)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const J="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),re=(()=>{if(c.showOverdrawInspector)return d.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!J){const X=this.style.fog.properties.get("color").toArray01();return new d.ax(...X)}if(this.style.fog&&this.transform.projection.supportsFog&&J){const X=this.style.fog.properties.get("space-color").toArray01();return new d.ax(...X)}return d.ax.transparent})();if(this.context.clear({color:re,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&J&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const X=x[this.currentLayer],se=s.getLayerSourceCache(X);if(X.isSky())continue;const he=se?(X.is3D()?j:k)[se.id]:void 0;this._renderTileClippingMasks(X,se,he),this.renderLayer(this,se,X,he)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&J&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||d.S(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const X=x[this.currentLayer],se=s.getLayerSourceCache(X);X.isSky()&&this.renderLayer(this,se,X,se?k[se.id]:void 0)}function ee(X,se){let he;return se&&(he=("symbol"===X.type?F:X.is3D()?j:k)[se.id]),he}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<y.length;){const X=x[this.currentLayer];if("raster"===X.type){const se=s.getLayerSourceCache(X);this.renderLayer(this,se,X,ee(X,se))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let oe=0;for(Y&&(oe=Y.getShadowCastingLayerCount());this.currentLayer<y.length;){const X=x[this.currentLayer],se=s.getLayerSourceCache(X);if(X.isSky())++this.currentLayer;else if(G&&this.style.isLayerDraped(X)){if(X.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=G.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(X,se,se?O[se.id]:void 0),this.renderLayer(this,se,X,ee(X,se)),!G&&Y&&oe>0&&X.hasShadowPass()&&0==--oe&&(Y.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const he=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=he;this.currentLayer++){const fe=x[this.currentLayer];if(!fe.hasLightBeamPass())continue;const ge=s.getLayerSourceCache(fe);this.renderLayer(this,ge,fe,ge?k[ge.id]:void 0)}this.currentLayer=he,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let X=null;x.forEach(se=>{const he=s.getLayerSourceCache(se);he&&!se.isHidden(this.transform.zoom)&&he.getVisibleCoordinates().length&&(!X||X.getSource().maxzoom<he.getSource().maxzoom)&&(X=he)}),X&&this.options.showTileBoundaries&&qu.debug(this,X,X.getVisibleCoordinates(),d.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&qu.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new d.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(X){const se=X.transform.padding;$c(X,X.transform.height-(se.top||0),3,xo),$c(X,se.bottom||0,3,aa),Kr(X,se.left||0,3,bd),Kr(X,X.transform.width-(se.right||0),3,wd);const he=X.transform.centerPoint;var fe,ge,De,ve;Mi(fe=X,(ge=he.x)-1,(De=X.transform.height-he.y)-10,2,20,ve=Ed),Mi(fe,ge-10,De-1,20,2,ve)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),S||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);const{unsupportedLayers:c}=this.transform.projection,m=!c||!c.includes(s.type);if(la[s.type]&&(m||this.terrain&&"custom"===s.type)){const y=this.style.getLayerSourceCache(s);la[s.type](s,y,this)}this.gpuTimingEnd()}renderLayer(s,c,m,y){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||"model"===m.type||"raster"===m.type||"raster-particle"===m.type||y&&y.length)&&(this.id=m.id,this.gpuTimingStart(m),(!s.transform.projection.unsupportedLayers||!s.transform.projection.unsupportedLayers.includes(m.type)||s.terrain&&"custom"===m.type)&&qu[m.type](s,c,m,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,m=this.context.gl;let y=this.gpuTimers[s.id];y||(y=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:m.createQuery()}),y.calls++,m.beginQuery(c.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,c=this.context.gl,m=c.createQuery();this.deferredRenderGpuTimeQueries.push(m),c.beginQuery(s.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const c={};for(const m in s){const y=s[m],x=this.context.extTimerQuery,C=x.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(y.query),c[m]=C}return c}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery,m=this.context.gl;let y=0;for(const x of s)y+=c.getQueryParameter(x,m.QUERY_RESULT)/1e6,c.deleteQueryEXT(x);return y}translatePosMatrix(s,c,m,y,x){if(!m[0]&&!m[1])return s;const C=x?"map"===y?this.transform.angle:0:"viewport"===y?-this.transform.angle:0;if(C){const O=Math.sin(C),k=Math.cos(C);m=[m[0]*k-m[1]*O,m[0]*O+m[1]*k]}const T=[x?m[0]:d.a3(c,m[0],this.transform.zoom),x?m[1]:d.a3(c,m[1],this.transform.zoom),0],S=new Float32Array(16);return d.a6.translate(S,s,T),S}saveTileTexture(s){const c=s.size[0],m=this._tileTextures[c];m?m.push(s):this._tileTextures[c]=[s]}getTileTexture(s){const c=this._tileTextures[s];return c&&c.length>0?c.pop():null}isPatternMissing(s,c){return null===s||void 0!==s&&!this.imageManager.getPattern(s.toString(),c)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(s,c,m){const y=void 0===m?this.terrain&&this.terrain.renderingToTexture:m,x=this.terrain&&0===this.terrain.exaggeration(),C=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===s||"terrainRaster"===s?(C.push("LIGHTING_3D_MODE"),C.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||C.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||C.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?C.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):C.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(C.push("TERRAIN"),this.linearFloatFilteringSupported()&&C.push("TERRAIN_DEM_FLOAT_FORMAT"),x&&C.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&C.push("GLOBE"),!this._fogVisible||y||void 0!==c&&!c||C.push("FOG","FOG_DITHERING"),y&&C.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&C.push("OVERDRAW_INSPECTOR"),C}getOrCreateProgram(s,c){this.cache=this.cache||{};const m=c&&c.defines||[],y=c&&c.config,x=c&&c.transformFeedback,C=this.currentGlobalDefines(s,c&&c.overrideFog,c&&c.overrideRtt).concat(m),T=Wl.cacheKey(Nf[s],s,C,y);return this.cache[T]||(this.cache[T]=new Wl(this.context,s,Nf[s],y,_0[s],C,x)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,c){if(this.style.enable3dLights()){const m=this.style.directionalLight,y=this.style.ambientLight;if(m&&y){const x=((C,T)=>{const S=C.properties.get("direction"),O=C.properties.get("color").toArray01(),k=C.properties.get("intensity"),F=T.properties.get("color").toArray01(),V=T.properties.get("intensity"),j=[S.x,S.y,S.z],q=d.cn(F,V),W=d.cn(O,k);return{u_lighting_ambient_color:q,u_lighting_directional_dir:j,u_lighting_directional_color:W,u_ground_radiance:hd(j,W,q)}})(m,y);c.setLightsUniformValues(s,x)}}}uploadCommonUniforms(s,c,m,y,x){if(this.uploadCommonLightUniforms(s,c),this.terrain&&this.terrain.renderingToTexture)return;const C=this.style.fog;if(C){const T=C.getOpacity(this.transform.pitch),S=((O,k,F,V,j,q,W,Y,G,J,re,ee)=>{const oe=O.transform,X=k.properties.get("color").toArray01();X[3]=V;const se=O.frameCounter/1e3%1,[he,fe]=k.properties.get("vertical-range");return{u_fog_matrix:F?oe.calculateFogTileMatrix(F):ee||O.identityMat,u_fog_range:k.getFovAdjustedRange(oe._fov),u_fog_color:X,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(he,fe),fe],u_fog_temporal_offset:se,u_frustum_tl:j,u_frustum_tr:q,u_frustum_br:W,u_frustum_bl:Y,u_globe_pos:G,u_globe_radius:J,u_viewport:re,u_globe_transition:d.S(oe.zoom),u_is_globe:+("globe"===oe.projection.name)}})(this,C,m,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*d.f.devicePixelRatio,this.transform.height*d.f.devicePixelRatio],y);c.setFogUniformValues(s,S)}x&&c.setCutoffUniformValues(s,x.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,c=s.createTexture();return s.bindTexture(s.TEXTURE_2D,c),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&0!==s.getOpacity(this.transform.pitch)}getBackgroundTiles(){const s=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const y of m)c[y.key]=s[y.key]||new kl(y,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(s,c){return!(!s.is3D()||s.minzoom&&s.minzoom>this.transform.zoom||"building"!==s.sourceLayer&&(!c||"batched-model"!==c.type))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let c=this._cachedTileFogOpacities[s.key];return c||(this._cachedTileFogOpacities[s.key]=c=this.style.fog.getOpacityForTile(s)),c[0]>=Qn||c[1]>=Qn}}function Zu(p,s){let c=!1,m=null;const y=()=>{m=null,c&&(p(),m=setTimeout(y,s),c=!1)};return()=>(c=!0,m||y(),m)}class Md{constructor(s){this._hashName=s&&encodeURIComponent(s),d.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Zu(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const c=Id(s);if(this._hashName){const m=this._hashName;let y=!1;const x=location.hash.slice(1).split("&").map(C=>{const T=C.split("=")[0];return T===m?(y=!0,`${T}=${c}`):C}).filter(C=>C);return y||x.push(`${m}=${c}`),`#${x.join("&")}`}return`#${c}`}_getCurrentHash(){const s=location.hash.replace("#","");if(this._hashName){let c;return s.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(m=>isNaN(m))){const m=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(c[3]||0):s.getBearing();return s.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:m,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Id(p,s){const c=p.getCenter(),m=Math.round(100*p.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),C=Math.round(c.lng*x)/x,T=Math.round(c.lat*x)/x,S=p.getBearing(),O=p.getPitch();let k=s?`/${C}/${T}/${m}`:`${m}/${T}/${C}`;return(S||O)&&(k+="/"+Math.round(10*S)/10),O&&(k+=`/${Math.round(O)}`),k}const Hc={linearity:.3,easing:d.c_(0,0,.3,1)},Po=d.e({deceleration:2500,maxSpeed:1400},Hc),Gf=d.e({deceleration:20,maxSpeed:1400},Hc),Sd=d.e({deceleration:1e3,maxSpeed:360},Hc),ii=d.e({deceleration:1e3,maxSpeed:90},Hc);class ei{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.f.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,c=d.f.now();for(;s.length>0&&c-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const x=mi(c.pan.mag(),m,d.e({},Po,s||{}));y.offset=c.pan.mult(x.amount/c.pan.mag()),y.center=this._map.transform.center,qc(y,x)}if(c.zoom){const x=mi(c.zoom,m,Gf);y.zoom=this._map.transform.zoom+x.amount,qc(y,x)}if(c.bearing){const x=mi(c.bearing,m,Sd);y.bearing=this._map.transform.bearing+d.aa(x.amount,-179,179),qc(y,x)}if(c.pitch){const x=mi(c.pitch,m,ii);y.pitch=this._map.transform.pitch+x.amount,qc(y,x)}if(y.zoom||y.bearing){const x=void 0===c.pinchAround?c.around:c.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function qc(p,s){(!p.duration||p.duration<s.duration)&&(p.duration=s.duration,p.easing=s.easing)}function mi(p,s,c){const{maxSpeed:m,linearity:y,deceleration:x}=c,C=d.aa(p*y/(s/1e3),-m,m),T=Math.abs(C)/(x*y);return{easing:c.easing,duration:1e3*T,amount:C*(T/2)}}class Jr extends d.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,m,y={}){const x=ws(c.getCanvasContainer(),m),C=c.unproject(x);super(s,d.e({point:x,lngLat:C,originalEvent:m},y)),this._defaultPrevented=!1,this.target=c}}class fs extends d.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,m){const y="touchend"===s?m.changedTouches:m.touches,x=Ka(c.getCanvasContainer(),y),C=x.map(S=>c.unproject(S)),T=x.reduce((S,O,k,F)=>S.add(O.div(F.length)),new d.P(0,0));super(s,{points:x,point:T,lngLats:C,lngLat:c.unproject(T),originalEvent:m}),this._defaultPrevented=!1}}class co extends d.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,m){super(s,{originalEvent:m}),this._defaultPrevented=!1}}class Hf{constructor(s,c){this._map=s,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new co(s.type,this._map,s))}mousedown(s,c){return this._mousedownPos=c,this._firePreventable(new Jr(s.type,this._map,s))}mouseup(s){this._map.fire(new Jr(s.type,this._map,s))}preclick(s){const c=d.e({},s);c.type="preclick",this._map.fire(new Jr(c.type,this._map,c))}click(s,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(s),this._map.fire(new Jr(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new Jr(s.type,this._map,s))}mouseover(s){this._map.fire(new Jr(s.type,this._map,s))}mouseout(s){this._map.fire(new Jr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new fs(s.type,this._map,s))}touchmove(s){this._map.fire(new fs(s.type,this._map,s))}touchend(s){this._map.fire(new fs(s.type,this._map,s))}touchcancel(s){this._map.fire(new fs(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ka{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new Jr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Jr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Jr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xo{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,c){this.isEnabled()&&s.shiftKey&&0===s.button&&(Gh(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(s,c){if(!this._active)return;const m=c,y=this._startPos,x=this._lastPos;if(!y||!x||x.equals(m)||!this._box&&m.dist(y)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=bn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const C=Math.min(y.x,m.x),T=Math.max(y.x,m.x),S=Math.min(y.y,m.y),O=Math.max(y.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${C}px,${S}px)`,this._box.style.width=T-C+"px",this._box.style.height=O-S+"px")})}mouseupWindow(s,c){if(!this._active)return;const m=this._startPos,y=c;if(m&&0===s.button){if(this.reset(),Go(),m.x!==y.x||m.y!==y.y)return this._map.fire(new d.b("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(m,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&27===s.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),$o(),delete this._startPos,delete this._lastPos}_fireEvent(s,c){return this._map.fire(new d.b(s,{originalEvent:c}))}}function $r(p,s){const c={};for(let m=0;m<p.length;m++)c[p[m].identifier]=s[m];return c}class Ad{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=s.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){const x=new d.P(0,0);for(const C of y)x._add(C);return x.div(y.length)}(c),this.touches=$r(m,c)))}touchmove(s,c,m){if(this.aborted||!this.centroid)return;const y=$r(m,c);for(const x in this.touches){const C=y[x];(!C||C.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(s,c,m){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Wu{constructor(s){this.singleTap=new Ad(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,c,m){this.singleTap.touchstart(s,c,m)}touchmove(s,c,m){this.singleTap.touchmove(s,c,m)}touchend(s,c,m){const y=this.singleTap.touchend(s,c,m);if(y){const x=s.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(y)<30;if(x&&C||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class qf{constructor(){this._zoomIn=new Wu({numTouches:1,numTaps:2}),this._zoomOut=new Wu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,c,m){this._zoomIn.touchstart(s,c,m),this._zoomOut.touchstart(s,c,m)}touchmove(s,c,m){this._zoomIn.touchmove(s,c,m),this._zoomOut.touchmove(s,c,m)}touchend(s,c,m){const y=this._zoomIn.touchend(s,c,m),x=this._zoomOut.touchend(s,c,m);return y?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(y)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ca={0:1,2:2};class ks{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,c){return!1}_move(s,c){return{}}mousedown(s,c){if(this._lastPoint)return;const m=Es(s);this._correctButton(s,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(s,c){const m=this._lastPoint;if(m)if(s.preventDefault(),null!=this._eventButton&&function(y,x){const C=ca[x];return void 0===y.buttons||(y.buttons&C)!==C}(s,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}mouseupWindow(s){this._lastPoint&&Es(s)===this._eventButton&&(this._moved&&Go(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zf extends ks{mousedown(s,c){super.mousedown(s,c),this._lastPoint&&(this._active=!0)}_correctButton(s,c){return 0===c&&!s.ctrlKey}_move(s,c){return{around:c,panDelta:c.sub(s)}}}class Zc extends ks{_correctButton(s,c){return 0===c&&s.ctrlKey||2===c}_move(s,c){const m=.8*(c.x-s.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(s){s.preventDefault()}}class Yu extends ks{_correctButton(s,c){return 0===c&&s.ctrlKey||2===c}_move(s,c){const m=-.5*(c.y-s.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(s){s.preventDefault()}}class Rd{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),d.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}touchstart(s,c,m){return this._calculateTransform(s,c,m)}touchmove(s,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length&&!d.c$())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,c,m)}}touchend(s,c,m){this._calculateTransform(s,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,c,m){m.length>0&&(this._active=!0);const y=$r(m,c),x=new d.P(0,0),C=new d.P(0,0);let T=0;for(const O in y){const k=y[O],F=this._touches[O];F&&(x._add(k),C._add(k.sub(F)),T++,y[O]=k)}if(this._touches=y,T<this._minTouches||!C.mag())return;const S=C.div(T);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(T),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=bn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ir{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,c,m){return{}}touchstart(s,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(s,c,m){const y=this._firstTwoTouches;if(!y)return;s.preventDefault();const[x,C]=y,T=_n(m,c,x),S=_n(m,c,C);if(!T||!S)return;const O=this._aroundCenter?null:T.add(S).div(2);return this._move([T,S],O,s)}touchend(s,c,m){if(!this._firstTwoTouches)return;const[y,x]=this._firstTwoTouches,C=_n(m,c,y),T=_n(m,c,x);C&&T||(this._active&&Go(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function _n(p,s,c){for(let m=0;m<p.length;m++)if(p[m].identifier===c)return s[m]}function Xu(p,s){return Math.log(p/s)/Math.LN2}class Pd extends Ir{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,c){const m=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Xu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xu(this._distance,m),pinchAround:c}}}function yl(p,s){return 180*p.angleWith(s)/Math.PI}class Wf extends Ir{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,c){const m=this._vector;if(this._vector=s[0].sub(s[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:yl(this._vector,m),pinchAround:c}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const c=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const y=yl(s,m);return Math.abs(y)<c}}function Ku(p){return Math.abs(p.y)>Math.abs(p.x)}class Od extends Ir{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,Ku(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,c,m){const y=this._lastPoints;if(!y)return;const x=s[0].sub(y[0]),C=s[1].sub(y[1]);return this._map._cooperativeGestures&&!d.c$()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(x,C,m.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(x.y+C.y)/2*-.5})}gestureBeginsVertically(s,c,m){if(void 0!==this._valid)return this._valid;const y=s.mag()>=2,x=c.mag()>=2;if(!y&&!x)return;if(!y||!x)return null==this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const C=s.y>0==c.y>0;return Ku(s)&&Ku(c)&&C}}const ps={panStep:100,bearingStep:15,pitchStep:10};class Ju{constructor(){const s=ps;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let c=0,m=0,y=0,x=0,C=0;switch(s.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:s.shiftKey?m=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?m=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?y=1:(s.preventDefault(),C=-1);break;case 40:s.shiftKey?y=-1:(s.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:T=>{const S=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:Yf,zoom:c?Math.round(S)+c*(s.shiftKey?2:1):S,bearing:T.getBearing()+m*this._bearingStep,pitch:T.getPitch()+y*this._pitchStep,offset:[-x*this._panStep,-C*this._panStep],center:T.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Yf(p){return p*(2-p)}const Qu=4.000244140625;class Lm{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||d.c$()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const m=d.f.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==c&&c%Qu==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),s.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=s,this._delta-=c,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=ws(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;"wheel"===this._type&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(0!==this._delta){const O="wheel"===this._type&&Math.abs(this._delta)>Qu?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&0!==k&&(k=1/k);const F=c(),V=Math.pow(2,F),j="number"==typeof this._targetZoom?s.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(j*k))),"wheel"===this._type&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:c(),y=this._startZoom,x=this._easing;let C,T=!1;if("wheel"===this._type&&y&&x){const O=Math.min((d.f.now()-this._lastWheelEventTime)/200,1),k=x(O);C=d.U(y,m,k),O<1?this._frameId||(this._frameId=!0):T=!0}else C=m,T=!0;this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let S=C-c();return S*this._lastDelta<0&&(S=0),{noInertia:!0,needsRenderFrame:!T,zoomDelta:S,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let c=d.d0;if(this._prevEase){const m=this._prevEase,y=(d.f.now()-m.start)/m.duration,x=m.easing(y+.01)-m.easing(y),C=.27/Math.sqrt(x*x+1e-4)*.01,T=Math.sqrt(.0729-C*C);c=d.c_(C,T,.25,1)}return this._prevEase={start:d.f.now(),duration:s,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=bn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ft{constructor(s,c){this._clickZoom=s,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yi{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,c){return s.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(s.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fm{constructor(){this._tap=new Wu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,c,m){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(s,c,m))}touchmove(s,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=c[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,c,m)}touchend(s,c,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(s,c,m)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nm{constructor(s,c,m){this._el=s,this._mousePan=c,this._touchPan=m}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gr{constructor(s,c,m){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Kf{constructor(s,c,m,y){this._el=s,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const La=p=>p.zoom||p.drag||p.pitch||p.rotate;class Ls extends d.b{}class kd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,c){const m=d.N.sub([],c,s);this.radius=d.N.length(m[2]<0?d.N.div([],m,this.constants):[m[0],m[1],0])}projectRay(s){d.N.div(s,s,this.constants),d.N.normalize(s,s),d.N.mul(s,s,this.constants);const c=d.N.scale([],s,this.radius);if(c[2]>0){const m=d.N.scale([],[0,0,1],d.N.dot(c,[0,0,1])),y=d.N.scale([],d.N.normalize([],[c[0],c[1],0]),this.radius),x=d.N.add([],c,d.N.scale([],d.N.sub([],d.N.add([],y,m),c),2));c[0]=x[0],c[1]=x[1]}return c}}function Ql(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class V_{constructor(s,c){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ei(s),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new kd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),d.aY(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,x,C]of this._listeners){const T=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(x,T,C)}}destroy(){for(const[s,c,m]of this._listeners){const y=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(c,y,m)}}_addDefaultHandlers(s){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new Hf(c,s));const y=c.boxZoom=new Xo(c,s);this._add("boxZoom",y);const x=new qf,C=new yi;c.doubleClickZoom=new ft(C,x),this._add("tapZoom",x),this._add("clickZoom",C);const T=new Fm;this._add("tapDragZoom",T);const S=c.touchPitch=new Od(c);this._add("touchPitch",S);const O=new Zc(s),k=new Yu(s);c.dragRotate=new Gr(s,O,k),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const F=new Zf(s),V=new Rd(c,s);c.dragPan=new Nm(m,F,V),this._add("mousePan",F),this._add("touchPan",V,["touchZoom","touchRotate"]);const j=new Wf,q=new Pd;c.touchZoomRotate=new Kf(m,q,j,T),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ka(c));const W=c.scrollZoom=new Lm(c,this);this._add("scrollZoom",W,["mousePan"]);const Y=c.keyboard=new Ju;this._add("keyboard",Y);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[G]&&c[G].enable(s[G])}_add(s,c,m){this._handlers.push({handlerName:s,handler:c,allowed:m}),this._handlersById[s]=c}stop(s){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!La(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,c,m){for(const y in s)if(y!==m&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const c=[];for(const m of s)this._el.contains(m.target)&&c.push(m);return c}handleEvent(s,c){this._updatingCamera=!0;const m="renderFrame"===s.type,y=m?void 0:s,x={needsRenderFrame:!1},C={},T={},S=s.touches?this._getMapTouches(s.touches):void 0,O=S?Ka(this._el,S):m?void 0:ws(this._el,s);for(const{handlerName:V,handler:j,allowed:q}of this._handlers){if(!j.isEnabled())continue;let W;this._blockedByActive(T,q,V)?j.reset():j[c||s.type]&&(W=j[c||s.type](s,O,S),this.mergeHandlerResult(x,C,W,V,y),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||j.isActive())&&(T[V]=j)}const k={};for(const V in this._previousActiveHandlers)T[V]||(k[V]=y);this._previousActiveHandlers=T,(Object.keys(k).length||Ql(x))&&(this._changes.push([x,C,k]),this._triggerRenderFrame()),(Object.keys(T).length||Ql(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=x;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(s,c,m,y,x){if(!m)return;d.e(s,m);const C={handlerName:y,originalEvent:m.originalEvent||x};void 0!==m.zoomDelta&&(c.zoom=C),void 0!==m.panDelta&&(c.drag=C),void 0!==m.pitchDelta&&(c.pitch=C),void 0!==m.bearingDelta&&(c.rotate=C)}_applyChanges(){const s={},c={},m={};for(const[y,x,C]of this._changes)y.panDelta&&(s.panDelta=(s.panDelta||new d.P(0,0))._add(y.panDelta)),y.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+y.pitchDelta),void 0!==y.around&&(s.around=y.around),void 0!==y.aroundCoord&&(s.aroundCoord=y.aroundCoord),void 0!==y.pinchAround&&(s.pinchAround=y.pinchAround),y.noInertia&&(s.noInertia=y.noInertia),d.e(c,x),d.e(m,C);this._updateMapTransform(s,c,m),this._changes=[]}_updateMapTransform(s,c,m){const y=this._map,x=y.transform,C=J=>[J.x,J.y,J.z];if((J=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!Ql(s)){const J=x.zoom;x.cameraElevationReference="sea",null!=this._originalZoom&&x._orthographicProjectionAtLowPitch&&"globe"!==x.projection.name&&0===x.pitch?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),J!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&y._stop(!0),!Ql(s))return void this._fireEvents(c,m,!0);let{panDelta:T,zoomDelta:S,bearingDelta:O,pitchDelta:k,around:F,aroundCoord:V,pinchAround:j}=s;x._isCameraConstrained&&(S>0&&(S=0),x._isCameraConstrained=!1),void 0!==j&&(F=j),(S||(J=>c[J]&&!this._eventsInProgress[J])("drag"))&&F&&(this._dragOrigin=C(x.pointCoordinate3D(F)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",y._stop(!0),F=F||y.transform.centerPoint,O&&(x.bearing+=O),k&&(x.pitch+=k),x._updateCameraState();const q=[0,0,0];if(T)if("mercator"===x.projection.name){const J=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(F).dir),re=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(F.sub(T)).dir);q[0]=re[0]-J[0],q[1]=re[1]-J[1]}else{const J=x.pointCoordinate(F);if("globe"===x.projection.name){T=T.rotate(-x.angle);const re=x._pixelsPerMercatorPixel/x.worldSize;q[0]=-T.x*d.d1(d.au(J.y))*re,q[1]=-T.y*d.d1(x.center.lat)*re}else{const re=x.pointCoordinate(F.sub(T));J&&re&&(q[0]=re.x-J.x,q[1]=re.y-J.y)}}const W=x.zoom,Y=[0,0,0];if(S){const J=C(V||x.pointCoordinate3D(F)),re={dir:d.N.normalize([],d.N.sub([],J,x._camera.position))};if(re.dir[2]<0){const ee=x.zoomDeltaToMovement(J,S);d.N.scale(Y,re.dir,ee)}}const G=d.N.add(q,q,Y);x._translateCameraConstrained(G),S&&Math.abs(x.zoom-W)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(c,m,!0)}_fireEvents(s,c,m){const y=La(this._eventsInProgress),x=La(s),C={};for(const k in s){const{originalEvent:F}=s[k];this._eventsInProgress[k]||(C[`${k}start`]=F),this._eventsInProgress[k]=s[k]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(const k in C)this._fireEvent(k,C[k]);x&&this._fireEvent("move",x.originalEvent);for(const k in s){const{originalEvent:F}=s[k];this._fireEvent(k,F)}const T={};let S;for(const k in this._eventsInProgress){const{handlerName:F,originalEvent:V}=this._eventsInProgress[k];this._handlersById[F].isActive()||(delete this._eventsInProgress[k],S=c[F]||V,T[`${k}end`]=S)}for(const k in T)this._fireEvent(k,T[k]);const O=La(this._eventsInProgress);if(m&&(y||x)&&!O){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=V=>0!==V&&-this._bearingSnap<V&&V<this._bearingSnap;k?(F(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:S})):(this._map.fire(new d.b("moveend",{originalEvent:S})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,c){this._map.fire(new d.b(s,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new Ls("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const j_="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ki extends d.E{constructor(s,c){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=!1!==c.respectPrefersReducedMotion,d.aY(["_renderFrameCallback"],this)}getCenter(){return new d.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(s,c){return this.jumpTo({center:s},c)}panBy(s,c,m){return s=d.P.convert(s).mult(-1),this.panTo(this.transform.center,d.e({offset:s},c),m)}panTo(s,c,m){return this.easeTo(d.e({center:s},c),m)}getZoom(){return this.transform.zoom}setZoom(s,c){return this.jumpTo({zoom:s},c),this}zoomTo(s,c,m){return this.easeTo(d.e({zoom:s},c),m)}zoomIn(s,c){return this.zoomTo(this.getZoom()+1,s,c),this}zoomOut(s,c){return this.zoomTo(this.getZoom()-1,s,c),this}getBearing(){return this.transform.bearing}setBearing(s,c){return this.jumpTo({bearing:s},c),this}getPadding(){return this.transform.padding}setPadding(s,c){return this.jumpTo({padding:s},c),this}rotateTo(s,c,m){return this.easeTo(d.e({bearing:s},c),m)}resetNorth(s,c){return this.rotateTo(0,d.e({duration:1e3},s),c),this}resetNorthPitch(s,c){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},s),c),this}snapToNorth(s,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,c):this}getPitch(){return this.transform.pitch}setPitch(s,c){return this.jumpTo({pitch:s},c),this}cameraForBounds(s,c){s=d.ad.convert(s);const m=c&&c.bearing||0,y=c&&c.pitch||0,x=s.getNorthWest(),C=s.getSouthEast();return this._cameraForBounds(this.transform,x,C,m,y,c)}_extendCameraOptions(s){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(s=d.e({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding){const m=s.padding;s.padding={top:m,bottom:m,right:m,left:m}}return s.padding=d.e(c,s.padding),s}_minimumAABBFrustumDistance(s,c){const m=c.max[0]-c.min[0],y=c.max[1]-c.min[1];return m/y>s.aspect?m/(2*Math.tan(.5*s.fovX)*s.aspect):y/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,c,m,y,x,C){const T=s.clone(),S=this._extendCameraOptions(C);T.bearing=y,T.pitch=x;const O=d.bn.convert(c),k=d.bn.convert(m),F=.5*(O.lat+k.lat),V=.5*(O.lng+k.lng),j=d.d2(F,V),q=d.N.normalize([],j),W=d.N.normalize([],d.N.cross([],q,[0,1,0])),Y=d.N.cross([],W,q),G=[W[0],W[1],W[2],0,Y[0],Y[1],Y[2],0,q[0],q[1],q[2],0,0,0,0,1],J=[j,d.d2(O.lat,O.lng),d.d2(k.lat,O.lng),d.d2(k.lat,k.lng),d.d2(O.lat,k.lng),d.d2(F,O.lng),d.d2(F,k.lng),d.d2(O.lat,V),d.d2(k.lat,V)];let re=d.bS.fromPoints(J.map(Ee=>[d.N.dot(W,Ee),d.N.dot(Y,Ee),d.N.dot(q,Ee)]));const ee=d.N.transformMat4([],re.center,G);0===d.N.squaredLength(ee)&&d.N.set(ee,0,0,1),d.N.normalize(ee,ee),d.N.scale(ee,ee,d.ab),T.center=d.d3(ee);const oe=T.getWorldToCameraMatrix(),X=d.a6.invert(new Float64Array(16),oe);re=d.bS.applyTransform(re,d.a6.multiply([],oe,G)),d.N.transformMat4(ee,ee,oe);const se=.5*(re.max[2]-re.min[2]),he=this._minimumAABBFrustumDistance(T,re),fe=d.N.scale([],[0,0,1],se),ge=d.N.add(fe,ee,fe),De=he+(0===T.pitch?0:d.N.distance(ee,ge)),ve=T.globeCenterInViewSpace,Pe=d.N.sub([],ee,[ve[0],ve[1],ve[2]]);d.N.normalize(Pe,Pe),d.N.scale(Pe,Pe,De);const Ae=d.N.add([],ee,Pe);d.N.transformMat4(Ae,Ae,X);const qe=d.d4/d.ab,xe=d.N.length(Ae),Se=d.bl(Math.max(xe*qe-d.d4,Number.EPSILON),0),pe=Math.min(T.zoomFromMercatorZAdjusted(Se),S.maxZoom);return pe>.5*(d.bG+d.bx)?(T.setProjection({name:"mercator"}),T.zoom=pe,this._cameraForBounds(T,c,m,y,x,C)):{center:T.center,zoom:pe,bearing:y,pitch:x}}queryTerrainElevation(s,c){const m=this.transform.elevation;return m?(c=d.e({},{exaggerated:!0},c),m.getAtPoint(d.L.fromLngLat(s),null,c.exaggerated)):null}_cameraForBounds(s,c,m,y,x,C){if("globe"===s.projection.name)return this._cameraForBoundsOnGlobe(s,c,m,y,x,C);const T=s.clone(),S=this._extendCameraOptions(C),O=T.padding;T.bearing=y,T.pitch=x;const k=d.bn.convert(c),F=d.bn.convert(m),V=new d.bn(k.lng,F.lat),j=new d.bn(F.lng,k.lat),q=T.project(k),W=T.project(F),Y=this.queryTerrainElevation(k),G=this.queryTerrainElevation(F),J=this.queryTerrainElevation(V),re=this.queryTerrainElevation(j),ee=[[q.x,q.y,Math.min(Y||0,G||0,J||0,re||0)],[W.x,W.y,Math.max(Y||0,G||0,J||0,re||0)]];let oe=d.bS.fromPoints(ee);const X=T.getWorldToCameraMatrix(),se=d.a6.invert(new Float64Array(16),X);oe=d.bS.applyTransform(oe,X);const he=d.N.sub([],oe.max,oe.min),fe=O.left||0,ge=O.right||0,De=O.bottom||0,ve=O.top||0,{left:Pe,right:Ae,top:qe,bottom:xe}=S.padding,Se=.5*(fe+ge),pe=.5*(ve+De),Ee=Math.min(T.scaleZoom(T.scale*Math.min((T.width-(fe+ge+Pe+Ae))/he[0],(T.height-(De+ve+xe+qe))/he[1])),S.maxZoom),He=T.scale/T.zoomScale(Ee);oe=new d.bS([oe.min[0]-(Pe+Se)*He,oe.min[1]-(xe+pe)*He,oe.min[2]],[oe.max[0]+(Ae+Se)*He,oe.max[1]+(qe+pe)*He,oe.max[2]]);const et=.5*he[2],Je=this._minimumAABBFrustumDistance(T,oe),pt=[0,0,1,0];d.a7.transformMat4(pt,pt,X),d.a7.normalize(pt,pt);const Mt=d.N.scale([],pt,Je+et),zt=d.N.add([],oe.center,Mt),Ot=("number"==typeof S.offset.x&&"number"==typeof S.offset.y?new d.P(S.offset.x,S.offset.y):d.P.convert(S.offset)).rotate(-d.bj(y));oe.center[0]-=Ot.x*He,oe.center[1]+=Ot.y*He,d.N.transformMat4(oe.center,oe.center,se),d.N.transformMat4(zt,zt,se);const Dt=[oe.center[0],oe.center[1],zt[2]*T.pixelsPerMeter];d.N.scale(Dt,Dt,1/T.worldSize);const hn=d.at(Dt[0]),Yt=d.au(Dt[1]),en=Math.min(T._zoomFromMercatorZ(Dt[2]),S.maxZoom),tn=new d.bn(hn,Yt);return T.mercatorFromTransition&&en<.5*(d.bG+d.bx)?(T.setProjection({name:"globe"}),T.zoom=en,this._cameraForBounds(T,c,m,y,x,C)):{center:tn,zoom:en,bearing:y,pitch:x}}fitBounds(s,c,m){const y=this.cameraForBounds(s,c);return this._fitInternal(y,c,m)}fitScreenCoordinates(s,c,m,y,x){const C=d.P.convert(s),T=d.P.convert(c),S=new d.P(Math.min(C.x,T.x),Math.min(C.y,T.y)),O=new d.P(Math.max(C.x,T.x),Math.max(C.y,T.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(C,T))return this;const k=this.transform.pointLocation3D(S),F=this.transform.pointLocation3D(O),V=this.transform.pointLocation3D(new d.P(S.x,O.y)),j=this.transform.pointLocation3D(new d.P(O.x,S.y)),q=[Math.min(k.lng,F.lng,V.lng,j.lng),Math.min(k.lat,F.lat,V.lat,j.lat)],W=[Math.max(k.lng,F.lng,V.lng,j.lng),Math.max(k.lat,F.lat,V.lat,j.lat)],Y=y&&y.pitch?y.pitch:this.getPitch(),G=this._cameraForBounds(this.transform,q,W,m,Y,y);return this._fitInternal(G,y,x)}_fitInternal(s,c,m){return s?(delete(c=d.e(s,c)).padding,c.linear?this.easeTo(c,m):this.flyTo(c,m)):this}jumpTo(s,c){this.stop();const m=s.preloadOnly?this.transform.clone():this.transform;let y=!1,x=!1,C=!1;return"zoom"in s&&m.zoom!==+s.zoom&&(y=!0,m.zoom=+s.zoom),void 0!==s.center&&(m.center=d.bn.convert(s.center)),"bearing"in s&&m.bearing!==+s.bearing&&(x=!0,m.bearing=+s.bearing),"pitch"in s&&m.pitch!==+s.pitch&&(C=!0,m.pitch=+s.pitch),null==s.padding||m.isPaddingEqual(s.padding)||(m.padding=s.padding),s.preloadOnly?(this._preloadTiles(m),this):(this.fire(new d.b("movestart",c)).fire(new d.b("move",c)),y&&this.fire(new d.b("zoomstart",c)).fire(new d.b("zoom",c)).fire(new d.b("zoomend",c)),x&&this.fire(new d.b("rotatestart",c)).fire(new d.b("rotate",c)).fire(new d.b("rotateend",c)),C&&this.fire(new d.b("pitchstart",c)).fire(new d.b("pitch",c)).fire(new d.b("pitchend",c)),this.fire(new d.b("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||d.w(j_),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,c){const m=this.transform;if(!m.projection.supportsFreeCamera)return d.w(j_),this;this.stop();const y=m.zoom,x=m.pitch,C=m.bearing;m.setFreeCameraOptions(s);const T=y!==m.zoom,S=x!==m.pitch,O=C!==m.bearing;return this.fire(new d.b("movestart",c)).fire(new d.b("move",c)),T&&this.fire(new d.b("zoomstart",c)).fire(new d.b("zoom",c)).fire(new d.b("zoomend",c)),O&&this.fire(new d.b("rotatestart",c)).fire(new d.b("rotate",c)).fire(new d.b("rotateend",c)),S&&this.fire(new d.b("pitchstart",c)).fire(new d.b("pitch",c)).fire(new d.b("pitchend",c)),this.fire(new d.b("moveend",c)),this}easeTo(s,c){this._stop(!1,s.easeId),(!1===(s=d.e({offset:[0,0],duration:500,easing:d.d0},s)).animate||this._prefersReducedMotion(s))&&(s.duration=0);const m=this.transform,y=this.getZoom(),x=this.getBearing(),C=this.getPitch(),T=this.getPadding(),S="zoom"in s?+s.zoom:y,O="bearing"in s?this._normalizeBearing(s.bearing,x):x,k="pitch"in s?+s.pitch:C,F="padding"in s?s.padding:m.padding,V=d.P.convert(s.offset);let j,q,W;if("globe"===m.projection.name){const fe=d.L.fromLngLat(m.center),ge=V.rotate(-m.angle);fe.x+=ge.x/m.worldSize,fe.y+=ge.y/m.worldSize;const De=fe.toLngLat(),ve=d.bn.convert(s.center||De);this._normalizeCenter(ve),j=m.centerPoint.add(ge),q=new d.P(fe.x,fe.y).mult(m.worldSize),W=new d.P(d.a5(ve.lng),d.ae(ve.lat)).mult(m.worldSize).sub(q)}else{j=m.centerPoint.add(V);const fe=m.pointLocation(j),ge=d.bn.convert(s.center||fe);this._normalizeCenter(ge),q=m.project(fe),W=m.project(ge).sub(q)}const Y=m.zoomScale(S-y);let G,J;s.around&&(G=d.bn.convert(s.around),J=m.locationPoint(G));const re=this._zooming||S!==y,ee=this._rotating||x!==O,oe=this._pitching||k!==C,X=!m.isPaddingEqual(F),se=fe=>ge=>{if(re&&(fe.zoom=d.U(y,S,ge)),ee&&(fe.bearing=d.U(x,O,ge)),oe&&(fe.pitch=d.U(C,k,ge)),X&&(fe.interpolatePadding(T,F,ge),j=fe.centerPoint.add(V)),G)fe.setLocationAtPoint(G,J);else{const De=fe.zoomScale(fe.zoom-y),ve=S>y?Math.min(2,Y):Math.max(.5,Y),Pe=Math.pow(ve,1-ge),Ae=fe.unproject(q.add(W.mult(ge*Pe)).mult(De));fe.setLocationAtPoint(fe.renderWorldCopies?Ae.wrap():Ae,j)}return s.preloadOnly||this._fireMoveEvents(c),fe};if(s.preloadOnly){const fe=this._emulate(se,s.duration,m);return this._preloadTiles(fe),this}const he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=ee,this._pitching=oe,this._easeId=s.easeId,this._prepareEase(c,s.noMoveStart,he),this._ease(se(m),fe=>{"sea"===m.cameraElevationReference&&m.recenterOnTerrain(),this._afterEase(c,fe)},s),this}_prepareEase(s,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),c||m.moving||this.fire(new d.b("movestart",s)),this._zooming&&!m.zooming&&this.fire(new d.b("zoomstart",s)),this._rotating&&!m.rotating&&this.fire(new d.b("rotatestart",s)),this._pitching&&!m.pitching&&this.fire(new d.b("pitchstart",s))}_fireMoveEvents(s){this.fire(new d.b("move",s)),this._zooming&&this.fire(new d.b("zoom",s)),this._rotating&&this.fire(new d.b("rotate",s)),this._pitching&&this.fire(new d.b("pitch",s))}_afterEase(s,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,y=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,m&&this.fire(new d.b("zoomend",s)),y&&this.fire(new d.b("rotateend",s)),x&&this.fire(new d.b("pitchend",s)),this.fire(new d.b("moveend",s))}flyTo(s,c){if(this._prefersReducedMotion(s)){const xe=d.ac(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(xe,c)}this.stop(),s=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.d0},s);const m=this.transform,y=this.getZoom(),x=this.getBearing(),C=this.getPitch(),T="zoom"in s?d.aa(+s.zoom,m.minZoom,m.maxZoom):y,S="bearing"in s?this._normalizeBearing(s.bearing,x):x,O="pitch"in s?+s.pitch:C,k=m.zoomScale(T-y),F=d.P.convert(s.offset),V=m.centerPoint.add(F),j=m.pointLocation(V);let q=s.center;if(q&&s.padding){const xe=this._cameraForBounds(this.transform,q,q,S,O,s);xe&&(q=xe.center)}q=d.bn.convert(q||j),this._normalizeCenter(q);const W=m.project(j),Y=m.project(q).sub(W);let G=s.curve;const J=Math.max(m.width,m.height),re=J/k,ee=Y.mag();if("minZoom"in s){const xe=d.aa(Math.min(s.minZoom,y,T),m.minZoom,m.maxZoom),Se=J/m.zoomScale(xe-y);G=Math.sqrt(Se/ee*2)}const oe=G*G;function X(xe){const Se=(re*re-J*J+(xe?-1:1)*oe*oe*ee*ee)/(2*(xe?re:J)*oe*ee);return Math.log(Math.sqrt(Se*Se+1)-Se)}function se(xe){return(Math.exp(xe)-Math.exp(-xe))/2}function he(xe){return(Math.exp(xe)+Math.exp(-xe))/2}const fe=X(0);let ge=function(xe){return he(fe)/he(fe+G*xe)},De=function(xe){return J*((he(fe)*(se(Se=fe+G*xe)/he(Se))-se(fe))/oe)/ee;var Se},ve=(X(1)-fe)/G;if(Math.abs(ee)<1e-6||!isFinite(ve)){if(Math.abs(J-re)<1e-6)return this.easeTo(s,c);const xe=re<J?-1:1;ve=Math.abs(Math.log(re/J))/G,De=function(){return 0},ge=function(Se){return Math.exp(xe*G*Se)}}s.duration="duration"in s?+s.duration:1e3*ve/("screenSpeed"in s?+s.screenSpeed/G:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const Pe=x!==S,Ae=O!==C,qe=xe=>Se=>{const pe=Se*ve,Ee=1/ge(pe);xe.zoom=1===Se?T:y+xe.scaleZoom(Ee),Pe&&(xe.bearing=d.U(x,S,Se)),Ae&&(xe.pitch=d.U(C,O,Se));const He=1===Se?q:xe.unproject(W.add(Y.mult(De(pe))).mult(Ee));return xe.setLocationAtPoint(xe.renderWorldCopies?He.wrap():He,V),xe._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(c),xe};if(s.preloadOnly){const xe=this._emulate(qe,s.duration,m);return this._preloadTiles(xe),this}return this._zooming=!0,this._rotating=Pe,this._pitching=Ae,this._prepareEase(c,!1),this._ease(qe(m),()=>this._afterEase(c),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,c)}if(!s){const m=this.handlers;m&&m.stop(!1)}return this}_ease(s,c,m){!1===m.animate||0===m.duration?(s(1),c()):(this._easeStart=d.f.now(),this._easeOptions=m,this._onEaseFrame=s,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((d.f.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,c){s=d.bh(s,-180,180);const m=Math.abs(s-c);return Math.abs(s-360-c)<m&&(s-=360),Math.abs(s+360-c)<m&&(s+=360),s}_normalizeCenter(s){const c=this.transform;if(c.maxBounds||"globe"!==c.projection.name&&!c.renderWorldCopies)return;const m=s.lng-c.center.lng;s.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&d.f.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,c,m){const y=Math.ceil(15*c/1e3),x=[],C=s(m.clone());for(let T=0;T<=y;T++){const S=C(T/y);x.push(S.clone())}return x}}class Qr{constructor(s={}){this.options=s,d.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const c=this.options&&this.options.compact;return this._map=s,this._container=bn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=bn("button","mapboxgl-ctrl-attrib-button",this._container),bn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=bn("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,c){const m=this._map._getUIString(`AttributionControl.${c}`);s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.d5.ACCESS_TOKEN}];if(s){const m=c.reduce((y,x,C)=>(x.value&&(y+=`${x.key}=${x.value}${C<c.length-1?"&":""}`),y),"?");s.href=`${d.d5.FEEDBACK_URL}/${m}#${Id(this._map,!0)}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||"metadata"!==s.sourceDataType&&"visibility"!==s.sourceDataType&&"style"!==s.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._mergedSourceCaches;for(const y in c){const x=c[y];if(x.used){const C=x.getSource();C.attribution&&s.indexOf(C.attribution)<0&&s.push(C.attribution)}}s.sort((y,x)=>y.length-x.length),s=s.filter((y,x)=>{for(let C=x+1;C<s.length;C++)if(s[C].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const m=s.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,s.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ua{constructor(){d.aY(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=bn("div","mapboxgl-ctrl");const c=bn("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&"metadata"!==s.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(0===Object.entries(s).length)return!0;for(const c in s){const m=s[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const c=s[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Jf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const c=++this._id;return this._queue.push({callback:s,id:c,cancelled:!1}),c}remove(s){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const y of m)if(y.id===s)return void(y.cancelled=!0)}run(s=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ha(p,s,c){if(p=new d.bn(p.lng,p.lat),s){const m=new d.bn(p.lng-360,p.lat),y=new d.bn(p.lng+360,p.lat),x=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),C=c.locationPoint(p).distSqr(s),T=s.x<0||s.y<0||s.x>c.width||s.y>c.height;c.locationPoint(m).distSqr(s)<C&&(T||Math.abs(m.lng-c.center.lng)<x)?p=m:c.locationPoint(y).distSqr(s)<C&&(T||Math.abs(y.lng-c.center.lng)<x)&&(p=y)}for(;Math.abs(p.lng-c.center.lng)>180;){const m=c.locationPoint(p);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const ms={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Qf extends d.E{constructor(s,c){if(super(),(s instanceof HTMLElement||c)&&(s=d.e({element:s},c)),d.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=d.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=bn("div");const x=41,C=27,T=ao("svg",{display:"block",height:x*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${x}`},this._element),S=ao("radialGradient",{id:"shadowGradient"},ao("defs",{},T));ao("stop",{offset:"10%","stop-opacity":.4},S),ao("stop",{offset:"100%","stop-opacity":.05},S),ao("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),ao("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),ao("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),ao("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=d.P.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const m=this._element.classList;for(const x in ms)m.remove(`mapboxgl-marker-anchor-${x}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`);const y=s&&s.className?s.className.trim().split(/\s+/):[];m.add(...y),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=d.bn.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(24.6+y)],"bottom-right":[-y,-1*(24.6+y)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const c=s.code,m=s.charCode||s.keyCode;"Space"!==c&&"Enter"!==c&&32!==m&&13!==m||this.togglePopup()}_onMapClick(s){const c=s.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,c=this._pos;if(!s||!c)return!1;const m=s.unproject(c),y=s.getFreeCameraOptions();if(!y.position)return!1;const x=y.position.toLngLat();return x.distanceTo(m)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const c=this._pos;if(!c||c.x<0||c.x>s.transform.width||c.y<0||c.y>s.transform.height)return void this._clearFadeTimer();const m=s.unproject(c);let y;s._showingGlobe()&&d.d6(s.transform,this._lngLat)?y=0:(y=1-s._queryFogOpacity(m),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${s.x}px,${s.y}px)\n            ${ms[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${c.x}px,${c.y}px)\n        `}_calculateXYTransform(){const s=this._pos,c=this._map,m=this.getPitchAlignment();if(!c||!s||"map"!==m)return"";if(!c._showingGlobe()){const S=c.getPitch();return S?`rotateX(${S}deg)`:""}const y=d.bF(d.d7(c.transform,this._lngLat)),x=s.sub(d.d8(c.transform)),C=Math.abs(x.x)+Math.abs(x.y);if(0===C)return"";const T=y/C;return`rotateX(${-x.y*T}deg) rotateY(${x.x*T}deg)`}_calculateZTransform(){const s=this._pos,c=this._map;if(!c||!s)return"";let m=0;const y=this.getRotationAlignment();if("map"===y)if(c._showingGlobe()){const x=c.project(new d.bn(this._lngLat.lng,this._lngLat.lat+.001)),C=c.project(new d.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);m=d.bF(Math.atan2(C.y,C.x))-90}else m=-c.getBearing();else if("horizon"===y){const x=d.O(4,6,c.getZoom()),C=d.d8(c.transform);C.y+=x*c.transform.height;const T=s.sub(C),S=d.bF(Math.atan2(T.y,T.x));m=(S>90?S-270:S+90)*(1-x)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=ha(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),!0===s?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=d.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){const c=this._map;if(!c)return;const m=this._pointerdownPos,y=this._positionDelta;if(m&&y){if(!this._isDragging){const x=this._clickTolerance||c._clickTolerance;if(s.point.dist(m)<x)return;this._isDragging=!0}this._pos=s.point.sub(y),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.b("dragstart"))),this.fire(new d.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new d.b("dragend")),this._state="inactive"}_addDragHandler(s){const c=this._map,m=this._pos;c&&m&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(m),this._pointerdownPos=s.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const c=this._map;return c&&(s?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ep={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Bm(p=new d.P(0,0),s="bottom"){if("number"==typeof p){const c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(s){case"top":return new d.P(0,p);case"top-left":return new d.P(c,c);case"top-right":return new d.P(-c,c);case"bottom":return new d.P(0,-p);case"bottom-left":return new d.P(c,-c);case"bottom-right":return new d.P(-c,-c);case"left":return new d.P(p,0);case"right":return new d.P(-p,0)}return new d.P(0,0)}return p instanceof d.P||Array.isArray(p)?d.P.convert(p):d.P.convert(p[s]||[0,0])}class eh{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const c=d.cc((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,c,m){this._start=this.getValue(c),this._end=s,this._startTime=c,this._endTime=c+m}}const ec={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},tp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class th{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const Ld={showCompass:!0,showZoom:!0,visualizePitch:!1};class da{constructor(s,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Zc({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,m&&(this.mousePitch=new Yu({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),d.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(s,c){this.mouseRotate.mousedown(s,c),this.mousePitch&&this.mousePitch.mousedown(s,c),Gh()}move(s,c){const m=this.map,y=this.mouseRotate.mousemoveWindow(s,c),x=y&&y.bearingDelta;if(x&&m.setBearing(m.getBearing()+x),this.mousePitch){const C=this.mousePitch.mousemoveWindow(s,c),T=C&&C.pitchDelta;T&&m.setPitch(m.getPitch()+T)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){$o(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(d.e({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),ws(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,ws(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){1!==s.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ka(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){1!==s.targetTouches.length?this.reset():(this._lastPos=Ka(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){0===s.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Wc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},eo={maxWidth:100,unit:"metric"},Fa={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:d.dk,supported:is,setRTLTextPlugin:d.dm,getRTLTextPluginStatus:d.dn,Map:class extends Ki{constructor(p){const s=p;if(null!=(p=d.e({},tp,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&d.d9(window)&&(p.antialias=!1,d.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Fc(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._repaint=!1,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Jf,this._domRenderTaskQueue=new Jf,this._controls=[],this._markers=[],this._popups=[],this._mapId=d.aC(),this._locale=d.e({},ec,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new eh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new d.da(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?{...p.contextCreateOptions}:{},"string"==typeof p.container){const c=document.getElementById(p.container);if(!c)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=c}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&d.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),d.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new th,this._tp=p.devtools?new Td(this):new Td,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,c=>{this.repaint=c}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,c=>{this.showTileAABBs=c}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,c=>{this.showPadding=c}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new V_(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||d.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new Md("string"==typeof p.hash&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==s.center&&null==s.zoom||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const c=p.bounds;c&&(this.resize(),this.fitBounds(c,d.e({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new Qr({customAttribution:p.customAttribution})),this._logoControl=new ua,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new d.b(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new d.b(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(p,s){if(void 0===s&&(s=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new d.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[s];return-1!==s.indexOf("bottom")?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new d.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(p);return s>-1&&this._controls.splice(s,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new d.b("movestart",p)).fire(new d.b("move",p)),this.fire(new d.b("resize",p)),s&&this.fire(new d.b("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(d.ad.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new d.b("zoomstart")).fire(new d.b("zoom")).fire(new d.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new d.b("zoomstart")).fire(new d.b("zoom")).fire(new d.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new d.b("pitchstart")).fire(new d.b("pitch")).fire(new d.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new d.b("pitchstart")).fire(new d.b("pitch")).fire(new d.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return"auto"===p?navigator.language:Array.isArray(p)?0===p.length?void 0:p.map(s=>"auto"===s?navigator.language:s):p}setLanguage(p){const s=this._parseLanguage(p);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(p){return this._lazyInitEmptyStyle(),p?"string"==typeof p&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const p=this.transform,s=p.projection.name;let c;"globe"===s&&p.zoom>=d.bx?(p.setMercatorFromTransition(),c=!0):"mercator"===s&&p.zoom<d.bx&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,s){return this._updateProjection(p||s||{name:"mercator"})}_updateProjection(p){let s;return s="globe"===p.name&&this.transform.zoom>=d.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),s&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p){return this.transform.locationPoint3D(d.bn.convert(p))}unproject(p){return this.transform.pointLocation3D(d.P.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,s,c){if("mouseenter"===p||"mouseover"===p){let m=!1;const y=C=>{const T=s.filter(O=>this.getLayer(O)),S=T.length?this.queryRenderedFeatures(C.point,{layers:T}):[];S.length?m||(m=!0,c.call(this,new Jr(p,this,C.originalEvent,{features:S}))):m=!1},x=()=>{m=!1};return{layers:new Set(s),listener:c,delegates:{mousemove:y,mouseout:x}}}if("mouseleave"===p||"mouseout"===p){let m=!1;const y=C=>{const T=s.filter(S=>this.getLayer(S));(T.length?this.queryRenderedFeatures(C.point,{layers:T}):[]).length?m=!0:m&&(m=!1,c.call(this,new Jr(p,this,C.originalEvent)))},x=C=>{m&&(m=!1,c.call(this,new Jr(p,this,C.originalEvent)))};return{layers:new Set(s),listener:c,delegates:{mousemove:y,mouseout:x}}}{const m=y=>{const x=s.filter(T=>this.getLayer(T)),C=x.length?this.queryRenderedFeatures(y.point,{layers:x}):[];C.length&&(y.features=C,c.call(this,y),delete y.features)};return{layers:new Set(s),listener:c,delegates:{[p]:m}}}}on(p,s,c){if(void 0===c)return super.on(p,s);if(Array.isArray(s)||(s=[s]),s)for(const y of s)if(!this._isValidId(y))return this;const m=this._createDelegatedListener(p,s,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const y in m.delegates)this.on(y,m.delegates[y]);return this}once(p,s,c){if(void 0===c)return super.once(p,s);if(Array.isArray(s)||(s=[s]),s)for(const y of s)if(!this._isValidId(y))return this;const m=this._createDelegatedListener(p,s,c);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(p,s,c){if(void 0===c)return super.off(p,s);s=new Set(Array.isArray(s)?s:[s]);for(const x of s)if(!this._isValidId(x))return this;const m=(x,C)=>{if(x.size!==C.size)return!1;for(const T of x)if(!C.has(T))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[p]:void 0;return y&&(x=>{for(let C=0;C<x.length;C++){const T=x[C];if(T.listener===c&&m(T.layers,s)){for(const S in T.delegates)this.off(S,T.delegates[S]);return x.splice(C,1),this}}})(y),this}queryRenderedFeatures(p,s){if(!this.style)return[];if(void 0!==s||void 0===p||p instanceof d.P||Array.isArray(p)||(s=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],(s=s||{}).layers&&Array.isArray(s.layers))for(const c of s.layers)if(!this._isValidId(c))return[];return this.style.queryRenderedFeatures(p,s,this.transform)}querySourceFeatures(p,s){return this._isValidId(p)?this.style.querySourceFeatures(p,s):[]}isPointOnSurface(p){const{name:s}=this.transform.projection;return"globe"!==s&&"mercator"!==s&&d.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(d.P.convert(p))}setStyle(p,s){return!1!==(s=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s)).diff&&s.localIdeographFontFamily===this._localIdeographFontFamily&&s.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(p,s))}_getUIString(p){const s=this._locale[p];if(null==s)throw new Error(`Missing UI string '${p}'`);return s}_updateStyle(p,s){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new Bi(this,s||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Bi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,s){if("string"==typeof p){const c=this._requestManager.normalizeStyleURL(p),m=this._requestManager.transformRequest(c,d.R.Style);d.g(m,(y,x)=>{y?this.fire(new d.a(y)):x&&this._updateDiff(x,s)})}else"object"==typeof p&&this._updateDiff(p,s)}_updateDiff(p,s){try{this.style.setState(p)&&this._update(!0)}catch(c){d.w(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(p,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(d.w("There is no style added to the map."),!1)}_isValidId(p){return null==p?(this.fire(new d.a(new Error("IDs can't be empty."))),!1):!d.c4(p)||(this.fire(new d.a(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}addSource(p,s){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,s),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,s,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,s,c)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,s,{pixelRatio:c=1,sdf:m=!1,stretchX:y,stretchY:x,content:C}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){const{width:T,height:S,data:O}=d.f.getImageData(s);this.style.addImage(p,{data:new d.h({width:T,height:S},O),pixelRatio:c,stretchX:y,stretchY:x,content:C,sdf:m,version:0})}else if(void 0===s.width||void 0===s.height)this.fire(new d.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:T,height:S}=s,O=s;this.style.addImage(p,{data:new d.h({width:T,height:S},new Uint8Array(O.data)),pixelRatio:c,stretchX:y,stretchY:x,content:C,sdf:m,version:0,userImage:O}),O.onAdd&&O.onAdd(this,p)}}updateImage(p,s){this._lazyInitEmptyStyle();const c=this.style.getImage(p);if(!c)return void this.fire(new d.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?d.f.getImageData(s):s,{width:y,height:x}=m,C=m.data;if(void 0===y||void 0===x)return void this.fire(new d.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==c.data.width||x!==c.data.height)return void this.fire(new d.a(new Error(`The width and height of the updated image (${y}, ${x})\n                must be that same as the previous version of the image\n                (${c.data.width}, ${c.data.height})`)));const T=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);c.data.replace(C,T),this.style.updateImage(p,c)}hasImage(p){return p?!!this.style&&!!this.style.getImage(p):(this.fire(new d.a(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,s){d.d(this._requestManager.transformRequest(p,d.R.Image),(c,m)=>{s(c,m instanceof HTMLImageElement?d.f.getImageData(m):m)})}listImages(){return this.style.listImages()}addModel(p,s){this._lazyInitEmptyStyle(),this.style.addModel(p,s)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new d.a(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,s){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,s),this._update(!0)):this}getSlot(p){const s=this.getLayer(p);return s&&s.slot||null}setSlot(p,s){return this.style.setSlot(p,s),this.style.mergeLayers(),this._update(!0)}addImport(p,s){return this.style.addImport(p,s),this}updateImport(p,s){return"string"!=typeof s&&s.id!==p?(this.removeImport(p),this.addImport(s)):(this.style.updateImport(p,s),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,s){return this.style.moveImport(p,s),this._update(!0)}moveLayer(p,s){return this._isValidId(p)?(this.style.moveLayer(p,s),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){return this._isValidId(p)?this.style.getOwnLayer(p):null}setLayerZoomRange(p,s,c){return this._isValidId(p)?(this.style.setLayerZoomRange(p,s,c),this._update(!0)):this}setFilter(p,s,c={}){return this._isValidId(p)?(this.style.setFilter(p,s,c),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,s,c,m={}){return this._isValidId(p)?(this.style.setPaintProperty(p,s,c,m),this._update(!0)):this}getPaintProperty(p,s){return this._isValidId(p)?this.style.getPaintProperty(p,s):null}setLayoutProperty(p,s,c,m={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,s,c,m),this._update(!0)):this}getLayoutProperty(p,s){return this._isValidId(p)?this.style.getLayoutProperty(p,s):null}getConfigProperty(p,s){return this.style.getConfigProperty(p,s)}setConfigProperty(p,s,c){return this.style.setConfigProperty(p,s,c),this._update(!0)}setLights(p){if(this._lazyInitEmptyStyle(),p&&1===p.length&&"flat"===p[0].type){const s=p[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return 0===p.length&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===p["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.bn.convert(p),this.transform):0}setFeatureState(p,s){return this._isValidId(p.source)?(this.style.setFeatureState(p,s),this._update()):this}removeFeatureState(p,s){return this._isValidId(p.source)?(this.style.removeFeatureState(p,s),this._update()):this}getFeatureState(p){return this._isValidId(p.source)?this.style.getFeatureState(p):null}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let c,m,y,x=this._container;for(;x&&(!m||!y);){const C=window.getComputedStyle(x).transform;C&&"none"!==C&&(c=C.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&"0"!==c[0]&&"1"!==c[0]&&(m=c[0]),c[3]&&"0"!==c[3]&&"1"!==c[3]&&(y=c[3])),x=x.parentElement}this._containerWidth=m?Math.abs(p/m):p,this._containerHeight=y?Math.abs(s/y):s}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=bn("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=bn("div","mapboxgl-canvas-container",p);this._canvas=bn("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=bn("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=bn("div",`mapboxgl-ctrl-${y}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,s){const c=d.f.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(s),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${s}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const s=this._markers.indexOf(p);-1!==s&&this._markers.splice(s,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const s=this._popups.indexOf(p);-1!==s&&this._popups.splice(s,1)}_setupPainter(){const p=d.e({},is.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",p);s?(d.db(s,!0),this.painter=new $f(s,this._contextCreateOptions,this.transform,this._tp),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),d.dc.testSupport(s)):this.fire(new d.a(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.b("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new d.b("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let s;this.fire(new d.b("renderstart"));const c=this.painter.context.extTimerQuery,m=d.f.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=y.createQuery(),y.beginQuery(c.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,O=this.transform.pitch,k=d.f.now(),F=new d.K(S,{now:k,fadeDuration:x,pitch:O,transition:this.style.transition});this.style.update(F)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(m),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):C=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const S=d.f.now()-m;y.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const O=y.getQueryParameter(s,y.QUERY_RESULT)/1e6;y.deleteQuery(s),this.fire(new d.b("gpu-timing-frame",{cpuTime:S,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(S);this.fire(new d.b("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const O=this.painter.queryGpuTimeDeferredRender(S);this.fire(new d.b("gpu-timing-deferred-render",{gpuTime:O}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(T||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(C=this._updateAverageElevation(m,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new d.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new d.b("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,this._performanceMetricsCollection&&d.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const s of this._markers)p&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!p||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(p,s=!1){const c=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);const m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(s||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const y=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=p;const C=Math.abs(y-x);if(C>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(x),c(x);this._averageElevation.easeTo(x,p,300)}else if(C>1e-4)return this._averageElevation.jumpTo(x),c(x)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){d.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===d.df||401===p.status)){const s=this.painter.context.gl;d.db(s,!1),this._logoControl instanceof ua&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),d.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function y(x){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,x,0);const C=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,C),C}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(y(p),s.canvasCopies.map(y),s.timeStamps)}_canvasPixelComparison(p,s,c){let m=c[1]-c[0];const y=p.length/4;for(let x=0;x<s.length;x++){const C=s[x];let T=0;for(let S=0;S<C.length;S+=4)C[S]===p[S]&&C[S+1]===p[S+1]&&C[S+2]===p[S+2]&&C[S+3]===p[S+3]&&(T+=1);m+=(c[x+2]-c[x+1])*(1-T/y)}return m}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),d.dh(this.painter.context.gl),d.di.remove(),d.dj.remove(),this._removed=!0,this.fire(new d.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=d.f.frame(s=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(s)}))}_preloadTiles(p){const s=this.style?Object.values(this.style._sourceCaches):[];return d.b1(s,(c,m)=>c._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,s){d.dl(p,s)}get version(){return d.dk}},NavigationControl:class{constructor(p){this.options=d.e({},Ld,p),this._container=bn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(d.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),bn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),bn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(d.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:s}):c.resetNorth({},{originalEvent:s}))}),this._compassIcon=bn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const s=p.getZoom(),c=s===p.getMaxZoom(),m=s===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new da(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,s){const c=bn("button",p,this._container);return c.type="button",c.addEventListener("click",s),c}_setButtonTitle(p,s){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${s}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends d.E{constructor(p){super();const s=navigator.geolocation;this.options=d.e({geolocation:s},Wc,p),d.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Zu(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=bn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const s=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};void 0!==this._supportsGeolocation?p(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(c=>s("denied"!==c.state)).catch(()=>s()):s()}_isOutOfMapMaxBounds(p){const s=this._map.getMaxBounds(),c=p.coords;return!!s&&(c.longitude<s.getWest()||c.longitude>s.getEast()||c.latitude<s.getSouth()||c.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new d.b("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new d.b("geolocate",p)),this._finish()}}_updateCamera(p){const s=new d.bn(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,m=this._map.getBearing(),y=d.e({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(c),y,{geolocateSource:!0})}_updateMarker(p){if(p){const s=new d.bn(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,s=d.bl(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new d.b("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=bn("button","mapboxgl-ctrl-geolocate",this._container),bn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=bn("div","mapboxgl-user-location"),this._dotElement.appendChild(bn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(bn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Qf({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=bn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||"ACTIVE_LOCK"!==this._watchState||s.originalEvent&&"resize"===s.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.b("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(s=>{"granted"===s&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Qr,ScaleControl:class{constructor(p){this.options=d.e({},eo,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),d.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,s=this._map,c=s._containerHeight/2,m=s._containerWidth/2-p/2,y=s.unproject([m,c]),x=s.unproject([m+p,c]),C=y.distanceTo(x);if("imperial"===this.options.unit){const T=3.2808*C;T>5280?this._setScale(p,T/5280,"mile"):this._setScale(p,T,"foot")}else"nautical"===this.options.unit?this._setScale(p,C/1852,"nautical-mile"):C>=1e3?this._setScale(p,C/1e3,"kilometer"):this._setScale(p,C,"meter")}_setScale(p,s,c){this._map._requestDomTask(()=>{const m=function(x){const C=Math.pow(10,`${Math.floor(x)}`.length-1);let T=x/C;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(S){const O=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*O)/O}(T),C*T}(s),y=m/s;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==c?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(m):`${m}&nbsp;${Fa[c]}`,this._container.style.width=p*y+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=bn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:d.w("Full screen control 'container' must be a DOM element.")),d.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=bn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=bn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);bn("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.E{constructor(p){super(),this.options=d.e(Object.create(ep),p),d.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new d.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new d.b("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=d.bn.convert(p),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const s=document.createDocumentFragment(),c=document.createElement("body");let m;for(c.innerHTML=p;m=c.firstChild,m;)s.appendChild(m);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=bn("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(p),this.options.closeButton){const c=this._closeButton=bn("button","mapboxgl-popup-close-button",s);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let s;return this._classList.delete(p)?s=!1:(this._classList.add(p),s=!0),this._updateClassList(),s}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const s=this._map,c=this._container,m=this._pos;if(!s||!c||!m)return"bottom";const y=c.offsetWidth,x=c.offsetHeight,C=m.x<y/2,T=m.x>s.transform.width-y/2;if(m.y+p<x)return C?"top-left":T?"top-right":"top";if(m.y>s.transform.height-x){if(C)return"bottom-left";if(T)return"bottom-right"}return C?"left":T?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),p.className=s.join(" ")}_update(p){const s=this._map,c=this._content;if(!s||!this._lngLat&&!this._trackPointer||!c)return;let m=this._container;if(m||(m=this._container=bn("div","mapboxgl-popup",s.getContainer()),this._tip=bn("div","mapboxgl-popup-tip",m),m.appendChild(c)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ha(this._lngLat,this._pos,s.transform)),!this._trackPointer||p){const y=this._pos=this._trackPointer&&p?p:s.project(this._lngLat),x=Bm(this.options.offset),C=this._anchor=this._getAnchor(x.y),T=Bm(this.options.offset,C),S=y.add(T).round();s._requestDomTask(()=>{this._container&&C&&(this._container.style.transform=`${ms[C]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&s._showingGlobe()){const y=d.d6(s.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(zm);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Qf,Style:Bi,LngLat:d.bn,LngLatBounds:d.ad,Point:d.P,MercatorCoordinate:d.L,FreeCameraOptions:zl,Evented:d.E,config:d.d5,prewarm:d.dp,clearPrewarmedResources:d.dq,get accessToken(){return d.d5.ACCESS_TOKEN},set accessToken(p){d.d5.ACCESS_TOKEN=p},get baseApiUrl(){return d.d5.API_URL},set baseApiUrl(p){d.d5.API_URL=p},get workerCount(){return d.dr.workerCount},set workerCount(p){d.dr.workerCount=p},get maxParallelImageRequests(){return d.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){d.d5.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){d.ds(p)},get workerUrl(){return d.dt.workerUrl},set workerUrl(p){d.dt.workerUrl=p},get workerClass(){return d.dt.workerClass},set workerClass(p){d.dt.workerClass=p},get workerParams(){return d.dt.workerParams},set workerParams(p){d.dt.workerParams=p},get dracoUrl(){return d.du()},set dracoUrl(p){d.dv(p)},get meshoptUrl(){return d.dw()},set meshoptUrl(p){d.dx(p)},setNow:d.f.setNow,restoreNow:d.f.restoreNow}}),bi}()}},I_=>{I_(I_.s=416)}]);