(self.webpackChunkmy_wedding=self.webpackChunkmy_wedding||[]).push([[179],{961:(p_,uu,hu)=>{"use strict";function Pn(i){return"function"==typeof i}function qh(i){const o=i(l=>{Error.call(l),l.stack=(new Error).stack});return o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,o}const m_=qh(i=>function(o){i(this),this.message=o?`${o.length} errors occurred during unsubscription:\n${o.map((l,h)=>`${h+1}) ${l.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=o});function te(i,r){if(i){const o=i.indexOf(r);0<=o&&i.splice(o,1)}}class st{constructor(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let r;if(!this.closed){this.closed=!0;const{_parentage:o}=this;if(o)if(this._parentage=null,Array.isArray(o))for(const m of o)m.remove(this);else o.remove(this);const{initialTeardown:l}=this;if(Pn(l))try{l()}catch(m){r=m instanceof m_?m.errors:[m]}const{_finalizers:h}=this;if(h){this._finalizers=null;for(const m of h)try{Le(m)}catch(y){r=r??[],y instanceof m_?r=[...r,...y.errors]:r.push(y)}}if(r)throw new m_(r)}}add(r){var o;if(r&&r!==this)if(this.closed)Le(r);else{if(r instanceof st){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=null!==(o=this._finalizers)&&void 0!==o?o:[]).push(r)}}_hasParent(r){const{_parentage:o}=this;return o===r||Array.isArray(o)&&o.includes(r)}_addParent(r){const{_parentage:o}=this;this._parentage=Array.isArray(o)?(o.push(r),o):o?[o,r]:r}_removeParent(r){const{_parentage:o}=this;o===r?this._parentage=null:Array.isArray(o)&&te(o,r)}remove(r){const{_finalizers:o}=this;o&&te(o,r),r instanceof st&&r._removeParent(this)}}st.EMPTY=(()=>{const i=new st;return i.closed=!0,i})();const Ko=st.EMPTY;function Ms(i){return i instanceof st||i&&"closed"in i&&Pn(i.remove)&&Pn(i.add)&&Pn(i.unsubscribe)}function Le(i){Pn(i)?i():i.unsubscribe()}const yo={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Qo={setTimeout(i,r,...o){const{delegate:l}=Qo;return l?.setTimeout?l.setTimeout(i,r,...o):setTimeout(i,r,...o)},clearTimeout(i){const{delegate:r}=Qo;return(r?.clearTimeout||clearTimeout)(i)},delegate:void 0};function ha(i){Qo.setTimeout(()=>{const{onUnhandledError:r}=yo;if(!r)throw i;r(i)})}function Wl(){}const Ha=Jr("C",void 0,void 0);function Jr(i,r,o){return{kind:i,value:r,error:o}}let Ts=null;function Ss(i){if(yo.useDeprecatedSynchronousErrorHandling){const r=!Ts;if(r&&(Ts={errorThrown:!1,error:null}),i(),r){const{errorThrown:o,error:l}=Ts;if(Ts=null,o)throw l}}else i()}class Ga extends st{constructor(r){super(),this.isStopped=!1,r?(this.destination=r,Ms(r)&&r.add(this)):this.destination=g_}static create(r,o,l){return new Yl(r,o,l)}next(r){this.isStopped?ki(function Zh(i){return Jr("N",i,void 0)}(r),this):this._next(r)}error(r){this.isStopped?ki(function pp(i){return Jr("E",void 0,i)}(r),this):(this.isStopped=!0,this._error(r))}complete(){this.isStopped?ki(Ha,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(r){this.destination.next(r)}_error(r){try{this.destination.error(r)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Is=Function.prototype.bind;function et(i,r){return Is.call(i,r)}class Xe{constructor(r){this.partialObserver=r}next(r){const{partialObserver:o}=this;if(o.next)try{o.next(r)}catch(l){As(l)}}error(r){const{partialObserver:o}=this;if(o.error)try{o.error(r)}catch(l){As(l)}else As(r)}complete(){const{partialObserver:r}=this;if(r.complete)try{r.complete()}catch(o){As(o)}}}class Yl extends Ga{constructor(r,o,l){let h;if(super(),Pn(r)||!r)h={next:r??void 0,error:o??void 0,complete:l??void 0};else{let m;this&&yo.useDeprecatedNextContext?(m=Object.create(r),m.unsubscribe=()=>this.unsubscribe(),h={next:r.next&&et(r.next,m),error:r.error&&et(r.error,m),complete:r.complete&&et(r.complete,m)}):h=r}this.destination=new Xe(h)}}function As(i){yo.useDeprecatedSynchronousErrorHandling?function mp(i){yo.useDeprecatedSynchronousErrorHandling&&Ts&&(Ts.errorThrown=!0,Ts.error=i)}(i):ha(i)}function ki(i,r){const{onStoppedNotification:o}=yo;o&&Qo.setTimeout(()=>o(i,r))}const g_={closed:!0,next:Wl,error:function De(i){throw i},complete:Wl},qa="function"==typeof Symbol&&Symbol.observable||"@@observable";function Rs(i){return i}function Za(i){return 0===i.length?Rs:1===i.length?i[0]:function(o){return i.reduce((l,h)=>h(l),o)}}let jn=(()=>{class i{constructor(o){o&&(this._subscribe=o)}lift(o){const l=new i;return l.source=this,l.operator=o,l}subscribe(o,l,h){const m=function Os(i){return i&&i instanceof Ga||function Ps(i){return i&&Pn(i.next)&&Pn(i.error)&&Pn(i.complete)}(i)&&Ms(i)}(o)?o:new Yl(o,l,h);return Ss(()=>{const{operator:y,source:w}=this;m.add(y?y.call(m,w):w?this._subscribe(m):this._trySubscribe(m))}),m}_trySubscribe(o){try{return this._subscribe(o)}catch(l){o.error(l)}}forEach(o,l){return new(l=Qt(l))((h,m)=>{const y=new Yl({next:w=>{try{o(w)}catch(D){m(D),y.unsubscribe()}},error:m,complete:h});this.subscribe(y)})}_subscribe(o){var l;return null===(l=this.source)||void 0===l?void 0:l.subscribe(o)}[qa](){return this}pipe(...o){return Za(o)(this)}toPromise(o){return new(o=Qt(o))((l,h)=>{let m;this.subscribe(y=>m=y,y=>h(y),()=>l(m))})}}return i.create=r=>new i(r),i})();function Qt(i){var r;return null!==(r=i??yo.Promise)&&void 0!==r?r:Promise}const Kl=qh(i=>function(){i(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let kn=(()=>{class i extends jn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(o){const l=new qt(this,this);return l.operator=o,l}_throwIfClosed(){if(this.closed)throw new Kl}next(o){Ss(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const l of this.currentObservers)l.next(o)}})}error(o){Ss(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=o;const{observers:l}=this;for(;l.length;)l.shift().error(o)}})}complete(){Ss(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:o}=this;for(;o.length;)o.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var o;return(null===(o=this.observers)||void 0===o?void 0:o.length)>0}_trySubscribe(o){return this._throwIfClosed(),super._trySubscribe(o)}_subscribe(o){return this._throwIfClosed(),this._checkFinalizedStatuses(o),this._innerSubscribe(o)}_innerSubscribe(o){const{hasError:l,isStopped:h,observers:m}=this;return l||h?Ko:(this.currentObservers=null,m.push(o),new st(()=>{this.currentObservers=null,te(m,o)}))}_checkFinalizedStatuses(o){const{hasError:l,thrownError:h,isStopped:m}=this;l?o.error(h):m&&o.complete()}asObservable(){const o=new jn;return o.source=this,o}}return i.create=(r,o)=>new qt(r,o),i})();class qt extends kn{constructor(r,o){super(),this.destination=r,this.source=o}next(r){var o,l;null===(l=null===(o=this.destination)||void 0===o?void 0:o.next)||void 0===l||l.call(o,r)}error(r){var o,l;null===(l=null===(o=this.destination)||void 0===o?void 0:o.error)||void 0===l||l.call(o,r)}complete(){var r,o;null===(o=null===(r=this.destination)||void 0===r?void 0:r.complete)||void 0===o||o.call(r)}_subscribe(r){var o,l;return null!==(l=null===(o=this.source)||void 0===o?void 0:o.subscribe(r))&&void 0!==l?l:Ko}}function Or(i){return Pn(i?.lift)}function Di(i){return r=>{if(Or(r))return r.lift(function(o){try{return i(o,this)}catch(l){this.error(l)}});throw new TypeError("Unable to lift unknown Observable type")}}function hi(i,r,o,l,h){return new gp(i,r,o,l,h)}class gp extends Ga{constructor(r,o,l,h,m,y){super(r),this.onFinalize=m,this.shouldUnsubscribe=y,this._next=o?function(w){try{o(w)}catch(D){r.error(D)}}:super._next,this._error=h?function(w){try{h(w)}catch(D){r.error(D)}finally{this.unsubscribe()}}:super._error,this._complete=l?function(){try{l()}catch(w){r.error(w)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:o}=this;super.unsubscribe(),!o&&(null===(r=this.onFinalize)||void 0===r||r.call(this))}}}function Yn(i,r){return Di((o,l)=>{let h=0;o.subscribe(hi(l,m=>{l.next(i.call(r,m,h++))}))})}function Un(i){return this instanceof Un?(this.v=i,this):new Un(i)}function wr(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=i[Symbol.asyncIterator];return r?r.call(i):(i=function _e(i){var r="function"==typeof Symbol&&Symbol.iterator,o=r&&i[r],l=0;if(o)return o.call(i);if(i&&"number"==typeof i.length)return{next:function(){return i&&l>=i.length&&(i=void 0),{value:i&&i[l++],done:!i}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}(i),o={},l("next"),l("throw"),l("return"),o[Symbol.asyncIterator]=function(){return this},o);function l(m){o[m]=i[m]&&function(y){return new Promise(function(w,D){!function h(m,y,w,D){Promise.resolve(D).then(function(S){m({value:S,done:w})},y)}(w,D,(y=i[m](y)).done,y.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const It=i=>i&&"number"==typeof i.length&&"function"!=typeof i;function Nt(i){return Pn(i?.then)}function jt(i){return Pn(i[qa])}function kt(i){return Symbol.asyncIterator&&Pn(i?.[Symbol.asyncIterator])}function Kt(i){return new TypeError(`You provided ${null!==i&&"object"==typeof i?"an invalid object":`'${i}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Ie=function Bt(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function wn(i){return Pn(i?.[Ie])}function ce(i){return function $n(i,r,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var h,l=o.apply(i,r||[]),m=[];return h={},y("next"),y("throw"),y("return"),h[Symbol.asyncIterator]=function(){return this},h;function y(H){l[H]&&(h[H]=function(J){return new Promise(function(ct,mt){m.push([H,J,ct,mt])>1||w(H,J)})})}function w(H,J){try{!function D(H){H.value instanceof Un?Promise.resolve(H.value.v).then(S,k):z(m[0][2],H)}(l[H](J))}catch(ct){z(m[0][3],ct)}}function S(H){w("next",H)}function k(H){w("throw",H)}function z(H,J){H(J),m.shift(),m.length&&w(m[0][0],m[0][1])}}(this,arguments,function*(){const o=i.getReader();try{for(;;){const{value:l,done:h}=yield Un(o.read());if(h)return yield Un(void 0);yield yield Un(l)}}finally{o.releaseLock()}})}function _n(i){return Pn(i?.getReader)}function pn(i){if(i instanceof jn)return i;if(null!=i){if(jt(i))return function pi(i){return new jn(r=>{const o=i[qa]();if(Pn(o.subscribe))return o.subscribe(r);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(i);if(It(i))return function Mi(i){return new jn(r=>{for(let o=0;o<i.length&&!r.closed;o++)r.next(i[o]);r.complete()})}(i);if(Nt(i))return function gr(i){return new jn(r=>{i.then(o=>{r.closed||(r.next(o),r.complete())},o=>r.error(o)).then(null,ha)})}(i);if(kt(i))return Li(i);if(wn(i))return function Oo(i){return new jn(r=>{for(const o of i)if(r.next(o),r.closed)return;r.complete()})}(i);if(_n(i))return function Lr(i){return Li(ce(i))}(i)}throw Kt(i)}function Li(i){return new jn(r=>{(function _r(i,r){var o,l,h,m;return function ne(i,r,o,l){return new(o||(o=Promise))(function(m,y){function w(k){try{S(l.next(k))}catch(z){y(z)}}function D(k){try{S(l.throw(k))}catch(z){y(z)}}function S(k){k.done?m(k.value):function h(m){return m instanceof o?m:new o(function(y){y(m)})}(k.value).then(w,D)}S((l=l.apply(i,r||[])).next())})}(this,void 0,void 0,function*(){try{for(o=wr(i);!(l=yield o.next()).done;)if(r.next(l.value),r.closed)return}catch(y){h={error:y}}finally{try{l&&!l.done&&(m=o.return)&&(yield m.call(o))}finally{if(h)throw h.error}}r.complete()})})(i,r).catch(o=>r.error(o))})}function eo(i,r,o,l=0,h=!1){const m=r.schedule(function(){o(),h?i.add(this.schedule(null,l)):this.unsubscribe()},l);if(i.add(m),!h)return m}function Ti(i,r,o=1/0){return Pn(r)?Ti((l,h)=>Yn((m,y)=>r(l,m,h,y))(pn(i(l,h))),o):("number"==typeof r&&(o=r),Di((l,h)=>function Xa(i,r,o,l,h,m,y,w){const D=[];let S=0,k=0,z=!1;const H=()=>{z&&!D.length&&!S&&r.complete()},J=mt=>S<l?ct(mt):D.push(mt),ct=mt=>{m&&r.next(mt),S++;let Pt=!1;pn(o(mt,k++)).subscribe(hi(r,Wt=>{h?.(Wt),m?J(Wt):r.next(Wt)},()=>{Pt=!0},void 0,()=>{if(Pt)try{for(S--;D.length&&S<l;){const Wt=D.shift();y?eo(r,y,()=>ct(Wt)):ct(Wt)}H()}catch(Wt){r.error(Wt)}}))};return i.subscribe(hi(r,J,()=>{z=!0,H()})),()=>{w?.()}}(l,h,i,o)))}function Ka(i=1/0){return Ti(Rs,i)}const ts=new jn(i=>i.complete());function a1(i){return i&&Pn(i.schedule)}function _p(i){return i[i.length-1]}function Qa(i){return a1(_p(i))?i.pop():void 0}function Wh(i,r=0){return Di((o,l)=>{o.subscribe(hi(l,h=>eo(l,i,()=>l.next(h),r),()=>eo(l,i,()=>l.complete(),r),h=>eo(l,i,()=>l.error(h),r)))})}function __(i,r=0){return Di((o,l)=>{l.add(i.schedule(()=>o.subscribe(l),r))})}function yp(i,r){if(!i)throw new Error("Iterable cannot be null");return new jn(o=>{eo(o,r,()=>{const l=i[Symbol.asyncIterator]();eo(o,r,()=>{l.next().then(h=>{h.done?o.complete():o.next(h.value)})},0,!0)})})}function Gi(i,r){return r?function v_(i,r){if(null!=i){if(jt(i))return function EM(i,r){return pn(i).pipe(__(r),Wh(r))}(i,r);if(It(i))return function c1(i,r){return new jn(o=>{let l=0;return r.schedule(function(){l===i.length?o.complete():(o.next(i[l++]),o.closed||this.schedule())})})}(i,r);if(Nt(i))return function CM(i,r){return pn(i).pipe(__(r),Wh(r))}(i,r);if(kt(i))return yp(i,r);if(wn(i))return function u1(i,r){return new jn(o=>{let l;return eo(o,r,()=>{l=i[Ie](),eo(o,r,()=>{let h,m;try{({value:h,done:m}=l.next())}catch(y){return void o.error(y)}m?o.complete():o.next(h)},0,!0)}),()=>Pn(l?.return)&&l.return()})}(i,r);if(_n(i))return function y_(i,r){return yp(ce(i),r)}(i,r)}throw Kt(i)}(i,r):pn(i)}function Yh(...i){const r=Qa(i),o=function l1(i,r){return"number"==typeof _p(i)?i.pop():r}(i,1/0),l=i;return l.length?1===l.length?pn(l[0]):Ka(o)(Gi(l,r)):ts}class Er extends kn{constructor(r){super(),this._value=r}get value(){return this.getValue()}_subscribe(r){const o=super._subscribe(r);return!o.closed&&r.next(this._value),o}getValue(){const{hasError:r,thrownError:o,_value:l}=this;if(r)throw o;return this._throwIfClosed(),l}next(r){super.next(this._value=r)}}function Fe(...i){return Gi(i,Qa(i))}function x_(i={}){const{connector:r=(()=>new kn),resetOnError:o=!0,resetOnComplete:l=!0,resetOnRefCountZero:h=!0}=i;return m=>{let y,w,D,S=0,k=!1,z=!1;const H=()=>{w?.unsubscribe(),w=void 0},J=()=>{H(),y=D=void 0,k=z=!1},ct=()=>{const mt=y;J(),mt?.unsubscribe()};return Di((mt,Pt)=>{S++,!z&&!k&&H();const Wt=D=D??r();Pt.add(()=>{S--,0===S&&!z&&!k&&(w=xe(ct,h))}),Wt.subscribe(Pt),!y&&S>0&&(y=new Yl({next:Et=>Wt.next(Et),error:Et=>{z=!0,H(),w=xe(J,o,Et),Wt.error(Et)},complete:()=>{k=!0,H(),w=xe(J,l),Wt.complete()}}),pn(mt).subscribe(y))})(m)}}function xe(i,r,...o){if(!0===r)return void i();if(!1===r)return;const l=new Yl({next:()=>{l.unsubscribe(),i()}});return pn(r(...o)).subscribe(l)}function rn(i,r){return Di((o,l)=>{let h=null,m=0,y=!1;const w=()=>y&&!h&&l.complete();o.subscribe(hi(l,D=>{h?.unsubscribe();let S=0;const k=m++;pn(i(D,k)).subscribe(h=hi(l,z=>l.next(r?r(D,z,k,S++):z),()=>{h=null,w()}))},()=>{y=!0,w()}))})}function ks(i,r=Rs){return i=i??Ql,Di((o,l)=>{let h,m=!0;o.subscribe(hi(l,y=>{const w=r(y);(m||!i(h,w))&&(m=!1,h=w,l.next(y))}))})}function Ql(i,r){return i===r}function Hn(i){for(let r in i)if(i[r]===Hn)return r;throw Error("Could not find renamed property on target object.")}function Xh(i,r){for(const o in r)r.hasOwnProperty(o)&&!i.hasOwnProperty(o)&&(i[o]=r[o])}function qi(i){if("string"==typeof i)return i;if(Array.isArray(i))return"["+i.map(qi).join(", ")+"]";if(null==i)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;const r=i.toString();if(null==r)return""+r;const o=r.indexOf("\n");return-1===o?r:r.substring(0,o)}function vp(i,r){return null==i||""===i?null===r?"":r:null==r||""===r?i:i+" "+r}const b_=Hn({__forward_ref__:Hn});function Kh(i){return i.__forward_ref__=Kh,i.toString=function(){return qi(this())},i}function Ge(i){return gu(i)?i():i}function gu(i){return"function"==typeof i&&i.hasOwnProperty(b_)&&i.__forward_ref__===Kh}function xp(i){return i&&!!i.\u0275providers}class Jt extends Error{constructor(r,o){super(function Dt(i,r){return`NG0${Math.abs(i)}${r?": "+r:""}`}(r,o)),this.code=r}}function zt(i){return"string"==typeof i?i:null==i?"":String(i)}function es(i,r){throw new Jt(-201,!1)}function Fr(i,r){null==i&&function Ve(i,r,o,l){throw new Error(`ASSERTION ERROR: ${i}`+(null==l?"":` [Expected=> ${o} ${l} ${r} <=Actual]`))}(r,i,null,"!=")}function he(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function ji(i){return{providers:i.providers||[],imports:i.imports||[]}}function tl(i){return C_(i,tc)||C_(i,Nr)}function C_(i,r){return i.hasOwnProperty(r)?i[r]:null}function yu(i){return i&&(i.hasOwnProperty(Jh)||i.hasOwnProperty(Pe))?i[Jh]:null}const tc=Hn({\u0275prov:Hn}),Jh=Hn({\u0275inj:Hn}),Nr=Hn({ngInjectableDef:Hn}),Pe=Hn({ngInjectorDef:Hn});var En=function(i){return i[i.Default=0]="Default",i[i.Host=1]="Host",i[i.Self=2]="Self",i[i.SkipSelf=4]="SkipSelf",i[i.Optional=8]="Optional",i}(En||{});let td;function gi(i){const r=td;return td=i,r}function D_(i,r,o){const l=tl(i);return l&&"root"==l.providedIn?void 0===l.value?l.value=l.factory():l.value:o&En.Optional?null:void 0!==r?r:void es(qi(i))}const Ke=globalThis,id={},Tp="__NG_DI_FLAG__",Ls="ngTempTokenPath",Fs=/\n/gm,M_="__source";let xu;function ko(i){const r=xu;return xu=i,r}function rd(i,r=En.Default){if(void 0===xu)throw new Jt(-203,!1);return null===xu?D_(i,void 0,r):xu.get(i,r&En.Optional?null:void 0,r)}function St(i,r=En.Default){return(function zr(){return td}()||rd)(Ge(i),r)}function fe(i,r=En.Default){return St(i,rc(r))}function rc(i){return typeof i>"u"||"number"==typeof i?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function Ns(i){const r=[];for(let o=0;o<i.length;o++){const l=Ge(i[o]);if(Array.isArray(l)){if(0===l.length)throw new Jt(900,!1);let h,m=En.Default;for(let y=0;y<l.length;y++){const w=l[y],D=IM(w);"number"==typeof D?-1===D?h=w.token:m|=D:h=w}r.push(St(h,m))}else r.push(St(l))}return r}function od(i,r){return i[Tp]=r,i.prototype[Tp]=r,i}function IM(i){return i[Tp]}function ga(i){return{toString:i}.toString()}var bu=function(i){return i[i.OnPush=0]="OnPush",i[i.Default=1]="Default",i}(bu||{}),Lo=function(i){return i[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",i}(Lo||{});const is={},Gn=[],sd=Hn({\u0275cmp:Hn}),oc=Hn({\u0275dir:Hn}),ad=Hn({\u0275pipe:Hn}),T_=Hn({\u0275mod:Hn}),rs=Hn({\u0275fac:Hn}),wu=Hn({__NG_ELEMENT_ID__:Hn}),Ip=Hn({__NG_ENV_ID__:Hn});function ut(i,r,o){let l=i.length;for(;;){const h=i.indexOf(r,o);if(-1===h)return h;if(0===h||i.charCodeAt(h-1)<=32){const m=r.length;if(h+m===l||i.charCodeAt(h+m)<=32)return h}o=h+1}}function Ap(i,r,o){let l=0;for(;l<o.length;){const h=o[l];if("number"==typeof h){if(0!==h)break;l++;const m=o[l++],y=o[l++],w=o[l++];i.setAttribute(r,y,w,m)}else{const m=h,y=o[++l];Pp(m)?i.setProperty(r,m,y):i.setAttribute(r,m,y),l++}}return l}function Rp(i){return 3===i||4===i||6===i}function Pp(i){return 64===i.charCodeAt(0)}function Eu(i,r){if(null!==r&&0!==r.length)if(null===i||0===i.length)i=r.slice();else{let o=-1;for(let l=0;l<r.length;l++){const h=r[l];"number"==typeof h?o=h:0===o||ld(i,o,h,null,-1===o||2===o?r[++l]:null)}}return i}function ld(i,r,o,l,h){let m=0,y=i.length;if(-1===r)y=-1;else for(;m<i.length;){const w=i[m++];if("number"==typeof w){if(w===r){y=-1;break}if(w>r){y=m-1;break}}}for(;m<i.length;){const w=i[m];if("number"==typeof w)break;if(w===o){if(null===l)return void(null!==h&&(i[m+1]=h));if(l===i[m+1])return void(i[m+2]=h)}m++,null!==l&&m++,null!==h&&m++}-1!==y&&(i.splice(y,0,r),m=y+1),i.splice(m++,0,o),null!==l&&i.splice(m++,0,l),null!==h&&i.splice(m++,0,h)}const zs="ng-template";function S_(i,r,o){let l=0,h=!0;for(;l<i.length;){let m=i[l++];if("string"==typeof m&&h){const y=i[l++];if(o&&"class"===m&&-1!==ut(y.toLowerCase(),r,0))return!0}else{if(1===m){for(;l<i.length&&"string"==typeof(m=i[l++]);)if(m.toLowerCase()===r)return!0;return!1}"number"==typeof m&&(h=!1)}}return!1}function el(i){return 4===i.type&&i.value!==zs}function Op(i,r,o){return r===(4!==i.type||o?i.value:zs)}function Cu(i,r,o){let l=4;const h=i.attrs||[],m=function A_(i){for(let r=0;r<i.length;r++)if(Rp(i[r]))return r;return i.length}(h);let y=!1;for(let w=0;w<r.length;w++){const D=r[w];if("number"!=typeof D){if(!y)if(4&l){if(l=2|1&l,""!==D&&!Op(i,D,o)||""===D&&1===r.length){if(xo(l))return!1;y=!0}}else{const S=8&l?D:r[++w];if(8&l&&null!==i.attrs){if(!S_(i.attrs,S,o)){if(xo(l))return!1;y=!0}continue}const z=RM(8&l?"class":D,h,el(i),o);if(-1===z){if(xo(l))return!1;y=!0;continue}if(""!==S){let H;H=z>m?"":h[z+1].toLowerCase();const J=8&l?H:null;if(J&&-1!==ut(J,S,0)||2&l&&S!==H){if(xo(l))return!1;y=!0}}}}else{if(!y&&!xo(l)&&!xo(D))return!1;if(y&&xo(D))continue;y=!1,l=D|1&l}}return xo(l)||y}function xo(i){return 0==(1&i)}function RM(i,r,o,l){if(null===r)return-1;let h=0;if(l||!o){let m=!1;for(;h<r.length;){const y=r[h];if(y===i)return h;if(3===y||6===y)m=!0;else{if(1===y||2===y){let w=r[++h];for(;"string"==typeof w;)w=r[++h];continue}if(4===y)break;if(0===y){h+=4;continue}}h+=m?1:2}return-1}return function PM(i,r){let o=i.indexOf(4);if(o>-1)for(o++;o<i.length;){const l=i[o];if("number"==typeof l)return-1;if(l===r)return o;o++}return-1}(r,i)}function I_(i,r,o=!1){for(let l=0;l<r.length;l++)if(Cu(i,r[l],o))return!0;return!1}function m1(i,r){return i?":not("+r.trim()+")":r}function kM(i){let r=i[0],o=1,l=2,h="",m=!1;for(;o<i.length;){let y=i[o];if("string"==typeof y)if(2&l){const w=i[++o];h+="["+y+(w.length>0?'="'+w+'"':"")+"]"}else 8&l?h+="."+y:4&l&&(h+=" "+y);else""!==h&&!xo(y)&&(r+=m1(m,h),h=""),l=y,m=m||!xo(l);o++}return""!==h&&(r+=m1(m,h)),r}function Ni(i){return ga(()=>{const r=kp(i),o={...r,decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===bu.OnPush,directiveDefs:null,pipeDefs:null,dependencies:r.standalone&&i.dependencies||null,getStandaloneInjector:null,signals:i.signals??!1,data:i.data||{},encapsulation:i.encapsulation||Lo.Emulated,styles:i.styles||Gn,_:null,schemas:i.schemas||null,tView:null,id:""};O_(o);const l=i.dependencies;return o.directiveDefs=Mu(l,!1),o.pipeDefs=Mu(l,!0),o.id=function k_(i){let r=0;const o=[i.selectors,i.ngContentSelectors,i.hostVars,i.hostAttrs,i.consts,i.vars,i.decls,i.encapsulation,i.standalone,i.signals,i.exportAs,JSON.stringify(i.inputs),JSON.stringify(i.outputs),Object.getOwnPropertyNames(i.type.prototype),!!i.contentQueries,!!i.viewQuery].join("|");for(const h of o)r=Math.imul(31,r)+h.charCodeAt(0)<<0;return r+=2147483648,"c"+r}(o),o})}function _1(i){return In(i)||Ji(i)}function R_(i){return null!==i}function Vi(i){return ga(()=>({type:i.type,bootstrap:i.bootstrap||Gn,declarations:i.declarations||Gn,imports:i.imports||Gn,exports:i.exports||Gn,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function Du(i,r){if(null==i)return is;const o={};for(const l in i)if(i.hasOwnProperty(l)){let h=i[l],m=h;Array.isArray(h)&&(m=h[1],h=h[0]),o[h]=l,r&&(r[h]=m)}return o}function Ui(i){return ga(()=>{const r=kp(i);return O_(r),r})}function In(i){return i[sd]||null}function Ji(i){return i[oc]||null}function Zi(i){return i[ad]||null}function no(i,r){const o=i[T_]||null;if(!o&&!0===r)throw new Error(`Type ${qi(i)} does not have '\u0275mod' property.`);return o}function kp(i){const r={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:r,inputTransforms:null,inputConfig:i.inputs||is,exportAs:i.exportAs||null,standalone:!0===i.standalone,signals:!0===i.signals,selectors:i.selectors||Gn,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Du(i.inputs,r),outputs:Du(i.outputs)}}function O_(i){i.features?.forEach(r=>r(i))}function Mu(i,r){if(!i)return null;const o=r?Zi:_1;return()=>("function"==typeof i?i():i).map(l=>o(l)).filter(R_)}const xi=0,vt=1,sn=2,di=3,Fo=4,Tu=5,yr=6,os=7,zi=8,il=9,Su=10,en=11,sc=12,Fp=13,rl=14,Ii=15,Iu=16,ac=17,Bs=18,_a=19,Au=20,ya=21,No=22,lc=23,io=24,Cn=25,cd=1,L_=2,zo=7,ol=9,Wi=11;function Cr(i){return Array.isArray(i)&&"object"==typeof i[cd]}function Br(i){return Array.isArray(i)&&!0===i[cd]}function hd(i){return 0!=(4&i.flags)}function cc(i){return i.componentOffset>-1}function uc(i){return 1==(1&i.flags)}function ss(i){return!!i.template}function zp(i){return 0!=(512&i[sn])}function bo(i,r){return i.hasOwnProperty(rs)?i[rs]:null}let tr=null,ku=!1;function jr(i){const r=tr;return tr=i,r}const E1={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function Lu(i){if(!hc(i)||i.dirty){if(!i.producerMustRecompute(i)&&!fd(i))return void(i.dirty=!1);i.producerRecomputeValue(i),i.dirty=!1}}function j_(i){i.dirty=!0,function C1(i){if(void 0===i.liveConsumerNode)return;const r=ku;ku=!0;try{for(const o of i.liveConsumerNode)o.dirty||j_(o)}finally{ku=r}}(i),i.consumerMarkedDirty?.(i)}function V_(i){return i&&(i.nextProducerIndex=0),jr(i)}function dd(i,r){if(jr(r),i&&void 0!==i.producerNode&&void 0!==i.producerIndexOfThis&&void 0!==i.producerLastReadVersion){if(hc(i))for(let o=i.nextProducerIndex;o<i.producerNode.length;o++)as(i.producerNode[o],i.producerIndexOfThis[o]);for(;i.producerNode.length>i.nextProducerIndex;)i.producerNode.pop(),i.producerLastReadVersion.pop(),i.producerIndexOfThis.pop()}}function fd(i){ba(i);for(let r=0;r<i.producerNode.length;r++){const o=i.producerNode[r],l=i.producerLastReadVersion[r];if(l!==o.version||(Lu(o),l!==o.version))return!0}return!1}function xa(i){if(ba(i),hc(i))for(let r=0;r<i.producerNode.length;r++)as(i.producerNode[r],i.producerIndexOfThis[r]);i.producerNode.length=i.producerLastReadVersion.length=i.producerIndexOfThis.length=0,i.liveConsumerNode&&(i.liveConsumerNode.length=i.liveConsumerIndexOfThis.length=0)}function as(i,r){if(function pd(i){i.liveConsumerNode??=[],i.liveConsumerIndexOfThis??=[]}(i),ba(i),1===i.liveConsumerNode.length)for(let l=0;l<i.producerNode.length;l++)as(i.producerNode[l],i.producerIndexOfThis[l]);const o=i.liveConsumerNode.length-1;if(i.liveConsumerNode[r]=i.liveConsumerNode[o],i.liveConsumerIndexOfThis[r]=i.liveConsumerIndexOfThis[o],i.liveConsumerNode.length--,i.liveConsumerIndexOfThis.length--,r<i.liveConsumerNode.length){const l=i.liveConsumerIndexOfThis[r],h=i.liveConsumerNode[r];ba(h),h.producerIndexOfThis[l]=r}}function hc(i){return i.consumerIsAlwaysLive||(i?.liveConsumerNode?.length??0)>0}function ba(i){i.producerNode??=[],i.producerIndexOfThis??=[],i.producerLastReadVersion??=[]}let md=null;const Gp=()=>{},S1=(()=>({...E1,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:i=>{i.schedule(i.ref)},hasRun:!1,cleanupFn:Gp}))();class I1{constructor(r,o,l){this.previousValue=r,this.currentValue=o,this.firstChange=l}isFirstChange(){return this.firstChange}}function wa(){return G_}function G_(i){return i.type.prototype.ngOnChanges&&(i.setInput=A1),Fu}function Fu(){const i=R1(this),r=i?.current;if(r){const o=i.previous;if(o===is)i.previous=r;else for(let l in r)o[l]=r[l];i.current=null,this.ngOnChanges(r)}}function A1(i,r,o,l){const h=this.declaredInputs[o],m=R1(i)||function P1(i,r){return i[q_]=r}(i,{previous:is,current:null}),y=m.current||(m.current={}),w=m.previous,D=w[h];y[h]=new I1(D&&D.currentValue,r,w===is),i[l]=r}wa.ngInherit=!0;const q_="__ngSimpleChanges__";function R1(i){return i[q_]||null}const cs=function(i,r,o){};function an(i){for(;Array.isArray(i);)i=i[xi];return i}function er(i,r){return an(r[i.index])}function k1(i,r){return i.data[r]}function wo(i,r){const o=r[i];return Cr(o)?o:o[xi]}function sl(i,r){return null==r?null:i[r]}function L1(i){i[ac]=0}function nT(i){1024&i[sn]||(i[sn]|=1024,vd(i,1))}function Bo(i){1024&i[sn]&&(i[sn]&=-1025,vd(i,-1))}function vd(i,r){let o=i[di];if(null===o)return;o[Tu]+=r;let l=o;for(o=o[di];null!==o&&(1===r&&1===l[Tu]||-1===r&&0===l[Tu]);)o[Tu]+=r,l=o,o=o[di]}const Re={lFrame:ny(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function pc(){return Re.bindingsEnabled}function Ft(){return Re.lFrame.lView}function Nn(){return Re.lFrame.tView}function nr(){let i=Zp();for(;null!==i&&64===i.type;)i=i.parent;return i}function Zp(){return Re.lFrame.currentTNode}function jo(i,r){const o=Re.lFrame;o.currentTNode=i,o.isParent=r}function Dr(){return Re.lFrame.isParent}function zn(){return Re.lFrame.bindingIndex++}function V1(i,r){const o=Re.lFrame;o.bindingIndex=o.bindingRootIndex=i,ey(r)}function ey(i){Re.lFrame.currentDirectiveIndex=i}function Bu(){return Re.lFrame.currentQueryIndex}function wt(i){Re.lFrame.currentQueryIndex=i}function se(i){const r=i[vt];return 2===r.type?r.declTNode:1===r.type?i[yr]:null}function ju(i,r,o){if(o&En.SkipSelf){let h=r,m=i;for(;!(h=h.parent,null!==h||o&En.Host||(h=se(m),null===h||(m=m[rl],10&h.type))););if(null===h)return!1;r=h,i=m}const l=Re.lFrame=xd();return l.currentTNode=r,l.lView=i,!0}function Xn(i){const r=xd(),o=i[vt];Re.lFrame=r,r.currentTNode=o.firstChild,r.lView=i,r.tView=o,r.contextLView=i,r.bindingIndex=o.bindingStartIndex,r.inI18n=!1}function xd(){const i=Re.lFrame,r=null===i?null:i.child;return null===r?ny(i):r}function ny(i){const r={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return null!==i&&(i.child=r),r}function cr(){const i=Re.lFrame;return Re.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}const bd=cr;function Yp(){const i=cr();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function Vr(){return Re.lFrame.selectedIndex}function Us(i){Re.lFrame.selectedIndex=i}function Ue(){const i=Re.lFrame;return k1(i.tView,i.selectedIndex)}let Kp=!0;function Vu(){return Kp}function Mr(i){Kp=i}function gc(i,r){for(let o=r.directiveStart,l=r.directiveEnd;o<l;o++){const m=i.data[o].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:w,ngAfterViewInit:D,ngAfterViewChecked:S,ngOnDestroy:k}=m;y&&(i.contentHooks??=[]).push(-o,y),w&&((i.contentHooks??=[]).push(o,w),(i.contentCheckHooks??=[]).push(o,w)),D&&(i.viewHooks??=[]).push(-o,D),S&&((i.viewHooks??=[]).push(o,S),(i.viewCheckHooks??=[]).push(o,S)),null!=k&&(i.destroyHooks??=[]).push(o,k)}}function _c(i,r,o){Qp(i,r,3,o)}function Uu(i,r,o,l){(3&i[sn])===o&&Qp(i,r,o,l)}function wd(i,r){let o=i[sn];(3&o)===r&&(o&=8191,o+=1,i[sn]=o)}function Qp(i,r,o,l){const m=l??-1,y=r.length-1;let w=0;for(let D=void 0!==l?65535&i[ac]:0;D<y;D++)if("number"==typeof r[D+1]){if(w=r[D],null!=l&&w>=l)break}else r[D]<0&&(i[ac]+=65536),(w<m||-1==m)&&(iy(i,o,r,D),i[ac]=(4294901760&i[ac])+D+2),D++}function Ea(i,r){cs(4,i,r);const o=jr(null);try{r.call(i)}finally{jr(o),cs(5,i,r)}}function iy(i,r,o,l){const h=o[l]<0,m=o[l+1],w=i[h?-o[l]:o[l]];h?i[sn]>>13<i[ac]>>16&&(3&i[sn])===r&&(i[sn]+=8192,Ea(w,m)):Ea(w,m)}const Ca=-1;class yc{constructor(r,o,l){this.factory=r,this.resolving=!1,this.canSeeViewProviders=o,this.injectImpl=l}}function xc(i){return i!==Ca}function hs(i){return 32767&i}function bc(i,r){let o=function Dd(i){return i>>16}(i),l=r;for(;o>0;)l=l[rl],o--;return l}let $u=!0;function Hu(i){const r=$u;return $u=i,r}const Jp=255,oy=5;let Z1=0;const ds={};function Md(i,r){const o=sy(i,r);if(-1!==o)return o;const l=r[vt];l.firstCreatePass&&(i.injectorIndex=r.length,tm(l.data,i),tm(r,null),tm(l.blueprint,null));const h=Td(i,r),m=i.injectorIndex;if(xc(h)){const y=hs(h),w=bc(h,r),D=w[vt].data;for(let S=0;S<8;S++)r[m+S]=w[y+S]|D[y+S]}return r[m+8]=h,m}function tm(i,r){i.push(0,0,0,0,0,0,0,0,r)}function sy(i,r){return-1===i.injectorIndex||i.parent&&i.parent.injectorIndex===i.injectorIndex||null===r[i.injectorIndex+8]?-1:i.injectorIndex}function Td(i,r){if(i.parent&&-1!==i.parent.injectorIndex)return i.parent.injectorIndex;let o=0,l=null,h=r;for(;null!==h;){if(l=Ne(h),null===l)return Ca;if(o++,h=h[rl],-1!==l.injectorIndex)return l.injectorIndex|o<<16}return Ca}function em(i,r,o){!function W1(i,r,o){let l;"string"==typeof o?l=o.charCodeAt(0)||0:o.hasOwnProperty(wu)&&(l=o[wu]),null==l&&(l=o[wu]=Z1++);const h=l&Jp;r.data[i+(h>>oy)]|=1<<h}(i,r,o)}function Y1(i,r,o){if(o&En.Optional||void 0!==i)return i;es()}function yn(i,r,o,l){if(o&En.Optional&&void 0===l&&(l=null),!(o&(En.Self|En.Host))){const h=i[il],m=gi(void 0);try{return h?h.get(r,l,o&En.Optional):D_(r,l,o&En.Optional)}finally{gi(m)}}return Y1(l,0,o)}function ay(i,r,o,l=En.Default,h){if(null!==i){if(2048&r[sn]&&!(l&En.Self)){const y=function Da(i,r,o,l,h){let m=i,y=r;for(;null!==m&&null!==y&&2048&y[sn]&&!(512&y[sn]);){const w=X1(m,y,o,l|En.Self,ds);if(w!==ds)return w;let D=m.parent;if(!D){const S=y[Au];if(S){const k=S.get(o,ds,l);if(k!==ds)return k}D=Ne(y),y=y[rl]}m=D}return h}(i,r,o,l,ds);if(y!==ds)return y}const m=X1(i,r,o,l,ds);if(m!==ds)return m}return yn(r,o,l,h)}function X1(i,r,o,l,h){const m=function hT(i){if("string"==typeof i)return i.charCodeAt(0)||0;const r=i.hasOwnProperty(wu)?i[wu]:void 0;return"number"==typeof r?r>=0?r&Jp:K1:r}(o);if("function"==typeof m){if(!ju(r,i,l))return l&En.Host?Y1(h,0,l):yn(r,o,l,h);try{let y;if(y=m(l),null!=y||l&En.Optional)return y;es()}finally{bd()}}else if("number"==typeof m){let y=null,w=sy(i,r),D=Ca,S=l&En.Host?r[Ii][yr]:null;for((-1===w||l&En.SkipSelf)&&(D=-1===w?Td(i,r):r[w+8],D!==Ca&&cy(l,!1)?(y=r[vt],w=hs(D),r=bc(D,r)):w=-1);-1!==w;){const k=r[vt];if(ly(m,w,k.data)){const z=uT(w,r,o,y,l,S);if(z!==ds)return z}D=r[w+8],D!==Ca&&cy(l,r[vt].data[w+8]===S)&&ly(m,w,r)?(y=k,w=hs(D),r=bc(D,r)):w=-1}}return h}function uT(i,r,o,l,h,m){const y=r[vt],w=y.data[i+8],k=wc(w,y,o,null==l?cc(w)&&$u:l!=y&&0!=(3&w.type),h&En.Host&&m===w);return null!==k?hl(r,y,k,w):ds}function wc(i,r,o,l,h){const m=i.providerIndexes,y=r.data,w=1048575&m,D=i.directiveStart,k=m>>20,H=h?w+k:i.directiveEnd;for(let J=l?w:w+k;J<H;J++){const ct=y[J];if(J<D&&o===ct||J>=D&&ct.type===o)return J}if(h){const J=y[D];if(J&&ss(J)&&J.type===o)return D}return null}function hl(i,r,o,l){let h=i[o];const m=r.data;if(function ry(i){return i instanceof yc}(h)){const y=h;y.resolving&&function rt(i,r){const o=r?`. Dependency path: ${r.join(" > ")} > ${i}`:"";throw new Jt(-200,`Circular dependency in DI detected for ${i}${o}`)}(function Be(i){return"function"==typeof i?i.name||i.toString():"object"==typeof i&&null!=i&&"function"==typeof i.type?i.type.name||i.type.toString():zt(i)}(m[o]));const w=Hu(y.canSeeViewProviders);y.resolving=!0;const S=y.injectImpl?gi(y.injectImpl):null;ju(i,l,En.Default);try{h=i[o]=y.factory(void 0,m,i,l),r.firstCreatePass&&o>=l.directiveStart&&function ul(i,r,o){const{ngOnChanges:l,ngOnInit:h,ngDoCheck:m}=r.type.prototype;if(l){const y=G_(r);(o.preOrderHooks??=[]).push(i,y),(o.preOrderCheckHooks??=[]).push(i,y)}h&&(o.preOrderHooks??=[]).push(0-i,h),m&&((o.preOrderHooks??=[]).push(i,m),(o.preOrderCheckHooks??=[]).push(i,m))}(o,m[o],r)}finally{null!==S&&gi(S),Hu(w),y.resolving=!1,bd()}}return h}function ly(i,r,o){return!!(o[r+(i>>oy)]&1<<i)}function cy(i,r){return!(i&En.Self||i&En.Host&&r)}class ir{constructor(r,o){this._tNode=r,this._lView=o}get(r,o,l){return ay(this._tNode,this._lView,r,rc(l),o)}}function K1(){return new ir(nr(),Ft())}function Gu(i){return gu(i)?()=>{const r=Gu(Ge(i));return r&&r()}:bo(i)}function Ne(i){const r=i[vt],o=r.type;return 2===o?r.declTNode:1===o?i[yr]:null}const be="__parameters__";function ye(i,r,o){return ga(()=>{const l=function hy(i){return function(...o){if(i){const l=i(...o);for(const h in l)this[h]=l[h]}}}(r);function h(...m){if(this instanceof h)return l.apply(this,m),this;const y=new h(...m);return w.annotation=y,w;function w(D,S,k){const z=D.hasOwnProperty(be)?D[be]:Object.defineProperty(D,be,{value:[]})[be];for(;z.length<=k;)z.push(null);return(z[k]=z[k]||[]).push(y),D}}return o&&(h.prototype=Object.create(o.prototype)),h.prototype.ngMetadataName=i,h.annotationCls=h,h})}function Dc(i,r){i.forEach(o=>Array.isArray(o)?Dc(o,r):r(o))}function Ur(i,r,o){r>=i.length?i.push(o):i.splice(r,0,o)}function bi(i,r){return r>=i.length-1?i.pop():i.splice(r,1)[0]}function fn(i,r,o){let l=Do(i,r);return l>=0?i[1|l]=o:(l=~l,function mT(i,r,o,l){let h=i.length;if(h==r)i.push(o,l);else if(1===h)i.push(l,i[0]),i[0]=o;else{for(h--,i.push(i[h-1],i[h]);h>r;)i[h]=i[h-2],h--;i[r]=o,i[r+1]=l}}(i,l,r,o)),l}function Rd(i,r){const o=Do(i,r);if(o>=0)return i[1|o]}function Do(i,r){return function fy(i,r,o){let l=0,h=i.length>>o;for(;h!==l;){const m=l+(h-l>>1),y=i[m<<o];if(r===y)return m<<o;y>r?h=m:l=m+1}return~(h<<o)}(i,r,1)}const Sr=od(ye("Optional"),8),Pd=od(ye("SkipSelf"),4);function $o(i){return 128==(128&i.flags)}var Ta=function(i){return i[i.Important=1]="Important",i[i.DashCase=2]="DashCase",i}(Ta||{});const sm=new Map;let _b=0;const lm="__ngContext__";function xr(i,r){Cr(r)?(i[lm]=r[_a],function yb(i){sm.set(i[_a],i)}(r)):i[lm]=r}let hm;function jd(i,r){return hm(i,r)}function Zu(i){const r=i[di];return Br(r)?r[di]:r}function Sy(i){return Oe(i[sc])}function Vd(i){return Oe(i[Fo])}function Oe(i){for(;null!==i&&!Br(i);)i=i[Fo];return i}function gl(i,r,o,l,h){if(null!=l){let m,y=!1;Br(l)?m=l:Cr(l)&&(y=!0,l=l[xi]);const w=an(l);0===i&&null!==o?null==h?Ob(r,o,w):$i(r,o,w,h||null,!0):1===i&&null!==o?$i(r,o,w,h||null,!0):2===i?function $d(i,r,o){const l=fm(i,r);l&&function TT(i,r,o,l){i.removeChild(r,o,l)}(i,l,r,o)}(r,w,y):3===i&&r.destroyNode(w),null!=m&&function Nb(i,r,o,l,h){const m=o[zo];m!==an(o)&&gl(r,i,l,m,h);for(let w=Wi;w<o.length;w++){const D=o[w];Tc(D[vt],D,i,r,l,m)}}(r,i,m,o,h)}}function Ud(i,r,o){return i.createElement(r,o)}function Rb(i,r){const o=i[ol],l=o.indexOf(r);Bo(r),o.splice(l,1)}function Wu(i,r){if(i.length<=Wi)return;const o=Wi+r,l=i[o];if(l){const h=l[Iu];null!==h&&h!==i&&Rb(h,l),r>0&&(i[o-1][Fo]=l[Fo]);const m=bi(i,Wi+r);!function Db(i,r){Tc(i,r,r[en],2,null,null),r[xi]=null,r[yr]=null}(l[vt],l);const y=m[Bs];null!==y&&y.detachView(m[vt]),l[di]=null,l[Fo]=null,l[sn]&=-129}return l}function mn(i,r){if(!(256&r[sn])){const o=r[en];r[lc]&&xa(r[lc]),r[io]&&xa(r[io]),o.destroyNode&&Tc(i,r,o,3,null,null),function Sb(i){let r=i[sc];if(!r)return Ay(i[vt],i);for(;r;){let o=null;if(Cr(r))o=r[sc];else{const l=r[Wi];l&&(o=l)}if(!o){for(;r&&!r[Fo]&&r!==i;)Cr(r)&&Ay(r[vt],r),r=r[di];null===r&&(r=i),Cr(r)&&Ay(r[vt],r),o=r&&r[Fo]}r=o}}(r)}}function Ay(i,r){if(!(256&r[sn])){r[sn]&=-129,r[sn]|=256,function Yu(i,r){let o;if(null!=i&&null!=(o=i.destroyHooks))for(let l=0;l<o.length;l+=2){const h=r[o[l]];if(!(h instanceof yc)){const m=o[l+1];if(Array.isArray(m))for(let y=0;y<m.length;y+=2){const w=h[m[y]],D=m[y+1];cs(4,w,D);try{D.call(w)}finally{cs(5,w,D)}}else{cs(4,h,m);try{m.call(h)}finally{cs(5,h,m)}}}}}(i,r),function MT(i,r){const o=i.cleanup,l=r[os];if(null!==o)for(let m=0;m<o.length-1;m+=2)if("string"==typeof o[m]){const y=o[m+3];y>=0?l[y]():l[-y].unsubscribe(),m+=2}else o[m].call(l[o[m+1]]);null!==l&&(r[os]=null);const h=r[ya];if(null!==h){r[ya]=null;for(let m=0;m<h.length;m++)(0,h[m])()}}(i,r),1===r[vt].type&&r[en].destroy();const o=r[Iu];if(null!==o&&Br(r[di])){o!==r[di]&&Rb(o,r);const l=r[Bs];null!==l&&l.detachView(i)}!function vb(i){sm.delete(i[_a])}(r)}}function Ry(i,r,o){return function Pb(i,r,o){let l=r;for(;null!==l&&40&l.type;)l=(r=l).parent;if(null===l)return o[xi];{const{componentOffset:h}=l;if(h>-1){const{encapsulation:m}=i.data[l.directiveStart+h];if(m===Lo.None||m===Lo.Emulated)return null}return er(l,o)}}(i,r.parent,o)}function $i(i,r,o,l,h){i.insertBefore(r,o,l,h)}function Ob(i,r,o){i.appendChild(r,o)}function it(i,r,o,l,h){null!==l?$i(i,r,o,l,h):Ob(i,r,o)}function fm(i,r){return i.parentNode(r)}let pm,Ly,Lb=function G(i,r,o){return 40&i.type?er(i,o):null};function mm(i,r,o,l){const h=Ry(i,l,r),m=r[en],w=function kb(i,r,o){return Lb(i,r,o)}(l.parent||r[yr],l,r);if(null!=h)if(Array.isArray(o))for(let D=0;D<o.length;D++)it(m,h,o[D],w,!1);else it(m,h,o,w,!1);void 0!==pm&&pm(m,l,r,o,h)}function _l(i,r){if(null!==r){const o=r.type;if(3&o)return er(r,i);if(4&o)return Gs(-1,i[r.index]);if(8&o){const l=r.child;if(null!==l)return _l(i,l);{const h=i[r.index];return Br(h)?Gs(-1,h):an(h)}}if(32&o)return jd(r,i)()||an(i[r.index]);{const l=Py(i,r);return null!==l?Array.isArray(l)?l[0]:_l(Zu(i[Ii]),l):_l(i,r.next)}}return null}function Py(i,r){return null!==r?i[Ii][yr].projection[r.projection]:null}function Gs(i,r){const o=Wi+i+1;if(o<r.length){const l=r[o],h=l[vt].firstChild;if(null!==h)return _l(l,h)}return r[zo]}function oo(i,r,o,l,h,m,y){for(;null!=o;){const w=l[o.index],D=o.type;if(y&&0===r&&(w&&xr(an(w),l),o.flags|=2),32!=(32&o.flags))if(8&D)oo(i,r,o.child,l,h,m,!1),gl(r,i,h,w,m);else if(32&D){const S=jd(o,l);let k;for(;k=S();)gl(r,i,h,k,m);gl(r,i,h,w,m)}else 16&D?Xu(i,r,l,o,h,m):gl(r,i,h,w,m);o=y?o.projectionNext:o.next}}function Tc(i,r,o,l,h,m){oo(o,l,i.firstChild,r,h,m,!1)}function Xu(i,r,o,l,h,m){const y=o[Ii],D=y[yr].projection[l.projection];if(Array.isArray(D))for(let S=0;S<D.length;S++)gl(r,i,h,D[S],m);else{let S=D;const k=y[di];$o(l)&&(S.flags|=128),oo(i,r,S,k,h,m,!0)}}function Ku(i,r,o){""===o?i.removeAttribute(r,"class"):i.setAttribute(r,"class",o)}function ky(i,r,o){const{mergedAttrs:l,classes:h,styles:m}=o;null!==l&&Ap(i,r,l),null!==h&&Ku(i,r,h),null!==m&&function Oy(i,r,o){i.setAttribute(r,"style",o)}(i,r,m)}class Bb{constructor(r){this.changingThisBreaksApplicationSecurity=r}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class le{constructor(r,o){this._desc=r,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof o?this.__NG_ELEMENT_ID__=o:void 0!==o&&(this.\u0275prov=he({token:this,providedIn:o.providedIn||"root",factory:o.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const th=new le("ENVIRONMENT_INITIALIZER"),Wb=new le("INJECTOR",-1),gs=new le("INJECTOR_DEF_TYPES");class Zs{get(r,o=id){if(o===id){const l=new Error(`NullInjectorError: No provider for ${qi(r)}!`);throw l.name="NullInjectorError",l}return o}}function wm(...i){return{\u0275providers:Em(0,i),\u0275fromNgModule:!0}}function Em(i,...r){const o=[],l=new Set;let h;const m=y=>{o.push(y)};return Dc(r,y=>{const w=y;Cm(w,m,[],l)&&(h||=[],h.push(w))}),void 0!==h&&Yy(h,m),o}function Yy(i,r){for(let o=0;o<i.length;o++){const{ngModule:l,providers:h}=i[o];Xy(h,m=>{r(m,l)})}}function Cm(i,r,o,l){if(!(i=Ge(i)))return!1;let h=null,m=yu(i);const y=!m&&In(i);if(m||y){if(y&&!y.standalone)return!1;h=i}else{const D=i.ngModule;if(m=yu(D),!m)return!1;h=D}const w=l.has(h);if(y){if(w)return!1;if(l.add(h),y.dependencies){const D="function"==typeof y.dependencies?y.dependencies():y.dependencies;for(const S of D)Cm(S,r,o,l)}}else{if(!m)return!1;{if(null!=m.imports&&!w){let S;l.add(h);try{Dc(m.imports,k=>{Cm(k,r,o,l)&&(S||=[],S.push(k))})}finally{}void 0!==S&&Yy(S,r)}if(!w){const S=bo(h)||(()=>new h);r({provide:h,useFactory:S,deps:Gn},h),r({provide:gs,useValue:h,multi:!0},h),r({provide:th,useValue:()=>St(h),multi:!0},h)}const D=m.providers;if(null!=D&&!w){const S=i;Xy(D,k=>{r(k,S)})}}}return h!==i&&void 0!==i.providers}function Xy(i,r){for(let o of i)xp(o)&&(o=o.\u0275providers),Array.isArray(o)?Xy(o,r):r(o)}const Ky=Hn({provide:String,useValue:Hn});function Qy(i){return null!==i&&"object"==typeof i&&Ky in i}function wl(i){return"function"==typeof i}const Mm=new le("Set Injector scope."),Tm={},eh={};let Kd;function Ra(){return void 0===Kd&&(Kd=new Zs),Kd}class Gr{}class Qd extends Gr{get destroyed(){return this._destroyed}constructor(r,o,l,h){super(),this.parent=o,this.source=l,this.scopes=h,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Im(r,y=>this.processProvider(y)),this.records.set(Wb,nh(void 0,this)),h.has("environment")&&this.records.set(Gr,nh(void 0,this));const m=this.records.get(Mm);null!=m&&"string"==typeof m.value&&this.scopes.add(m.value),this.injectorDefTypes=new Set(this.get(gs.multi,Gn,En.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const o of this._ngOnDestroyHooks)o.ngOnDestroy();const r=this._onDestroyHooks;this._onDestroyHooks=[];for(const o of r)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(r){return this.assertNotDestroyed(),this._onDestroyHooks.push(r),()=>this.removeOnDestroy(r)}runInContext(r){this.assertNotDestroyed();const o=ko(this),l=gi(void 0);try{return r()}finally{ko(o),gi(l)}}get(r,o=id,l=En.Default){if(this.assertNotDestroyed(),r.hasOwnProperty(Ip))return r[Ip](this);l=rc(l);const m=ko(this),y=gi(void 0);try{if(!(l&En.SkipSelf)){let D=this.records.get(r);if(void 0===D){const S=function NT(i){return"function"==typeof i||"object"==typeof i&&i instanceof le}(r)&&tl(r);D=S&&this.injectableDefInScope(S)?nh(Sm(r),Tm):null,this.records.set(r,D)}if(null!=D)return this.hydrate(r,D)}return(l&En.Self?Ra():this.parent).get(r,o=l&En.Optional&&o===id?null:o)}catch(w){if("NullInjectorError"===w.name){if((w[Ls]=w[Ls]||[]).unshift(qi(r)),m)throw w;return function AM(i,r,o,l){const h=i[Ls];throw r[M_]&&h.unshift(r[M_]),i.message=function f1(i,r,o,l=null){i=i&&"\n"===i.charAt(0)&&"\u0275"==i.charAt(1)?i.slice(2):i;let h=qi(r);if(Array.isArray(r))h=r.map(qi).join(" -> ");else if("object"==typeof r){let m=[];for(let y in r)if(r.hasOwnProperty(y)){let w=r[y];m.push(y+":"+("string"==typeof w?JSON.stringify(w):qi(w)))}h=`{${m.join(", ")}}`}return`${o}${l?"("+l+")":""}[${h}]: ${i.replace(Fs,"\n  ")}`}("\n"+i.message,h,o,l),i.ngTokenPath=h,i[Ls]=null,i}(w,r,"R3InjectorError",this.source)}throw w}finally{gi(y),ko(m)}}resolveInjectorInitializers(){const r=ko(this),o=gi(void 0);try{const h=this.get(th.multi,Gn,En.Self);for(const m of h)m()}finally{ko(r),gi(o)}}toString(){const r=[],o=this.records;for(const l of o.keys())r.push(qi(l));return`R3Injector[${r.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Jt(205,!1)}processProvider(r){let o=wl(r=Ge(r))?r:Ge(r&&r.provide);const l=function FT(i){return Qy(i)?nh(void 0,i.useValue):nh(function Yb(i,r,o){let l;if(wl(i)){const h=Ge(i);return bo(h)||Sm(h)}if(Qy(i))l=()=>Ge(i.useValue);else if(function Jy(i){return!(!i||!i.useFactory)}(i))l=()=>i.useFactory(...Ns(i.deps||[]));else if(function Dm(i){return!(!i||!i.useExisting)}(i))l=()=>St(Ge(i.useExisting));else{const h=Ge(i&&(i.useClass||i.provide));if(!function Xb(i){return!!i.deps}(i))return bo(h)||Sm(h);l=()=>new h(...Ns(i.deps))}return l}(i),Tm)}(r);if(wl(r)||!0!==r.multi)this.records.get(o);else{let h=this.records.get(o);h||(h=nh(void 0,Tm,!0),h.factory=()=>Ns(h.multi),this.records.set(o,h)),o=r,h.multi.push(r)}this.records.set(o,l)}hydrate(r,o){return o.value===Tm&&(o.value=eh,o.value=o.factory()),"object"==typeof o.value&&o.value&&function Kb(i){return null!==i&&"object"==typeof i&&"function"==typeof i.ngOnDestroy}(o.value)&&this._ngOnDestroyHooks.add(o.value),o.value}injectableDefInScope(r){if(!r.providedIn)return!1;const o=Ge(r.providedIn);return"string"==typeof o?"any"===o||this.scopes.has(o):this.injectorDefTypes.has(o)}removeOnDestroy(r){const o=this._onDestroyHooks.indexOf(r);-1!==o&&this._onDestroyHooks.splice(o,1)}}function Sm(i){const r=tl(i),o=null!==r?r.factory:bo(i);if(null!==o)return o;if(i instanceof le)throw new Jt(204,!1);if(i instanceof Function)return function LT(i){const r=i.length;if(r>0)throw function _i(i,r){const o=[];for(let l=0;l<i;l++)o.push(r);return o}(r,"?"),new Jt(204,!1);const o=function Ep(i){return i&&(i[tc]||i[Nr])||null}(i);return null!==o?()=>o.factory(i):()=>new i}(i);throw new Jt(204,!1)}function nh(i,r,o=!1){return{factory:i,value:r,multi:o?[]:void 0}}function Im(i,r){for(const o of i)Array.isArray(o)?Im(o,r):o&&xp(o)?Im(o.\u0275providers,r):r(o)}const Am=new le("AppId",{providedIn:"root",factory:()=>zT}),zT="ng",tv=new le("Platform Initializer"),Cl=new le("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Jd=new le("AnimationModuleType"),_s=new le("CSP nonce",{providedIn:"root",factory:()=>function yl(){if(void 0!==Ly)return Ly;if(typeof document<"u")return document;throw new Jt(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let Qb=(i,r,o)=>null;function Ml(i,r,o=!1){return Qb(i,r,o)}class lv{}class rf{}class uv{resolveComponentFactory(r){throw function cv(i){const r=Error(`No component factory found for ${qi(i)}.`);return r.ngComponent=i,r}(r)}}let Pa=(()=>{class i{static#t=this.NULL=new uv}return i})();function HT(){return oh(nr(),Ft())}function oh(i,r){return new qr(er(i,r))}let qr=(()=>{class i{constructor(o){this.nativeElement=o}static#t=this.__NG_ELEMENT_ID__=HT}return i})();function GT(i){return i instanceof qr?i.nativeElement:i}class iw{}let ZT=(()=>{class i{static#t=this.\u0275prov=he({token:i,providedIn:"root",factory:()=>null})}return i})();class Oa{constructor(r){this.full=r,this.major=r.split(".")[0],this.minor=r.split(".")[1],this.patch=r.split(".").slice(2).join(".")}}const WT=new Oa("16.2.8"),Nm={};function af(i,r=null,o=null,l){const h=mv(i,r,o,l);return h.resolveInjectorInitializers(),h}function mv(i,r=null,o=null,l,h=new Set){const m=[o||Gn,wm(i)];return l=l||("object"==typeof i?void 0:qi(i)),new Qd(m,r||Ra(),l||null,h)}let hr=(()=>{class i{static#t=this.THROW_IF_NOT_FOUND=id;static#e=this.NULL=new Zs;static create(o,l){if(Array.isArray(o))return af({name:""},l,o,"");{const h=o.name??"";return af({name:h},o.parent,o.providers,h)}}static#n=this.\u0275prov=he({token:i,providedIn:"any",factory:()=>St(Wb)});static#i=this.__NG_ELEMENT_ID__=-1}return i})();function Zn(i){return i.ngOriginalError}class ys{constructor(){this._console=console}handleError(r){const o=this._findOriginalError(r);this._console.error("ERROR",r),o&&this._console.error("ORIGINAL ERROR",o)}_findOriginalError(r){let o=r&&Zn(r);for(;o&&Zn(o);)o=Zn(o);return o||null}}function Bm(i){return r=>{setTimeout(i,void 0,r)}}const dr=class sh extends kn{constructor(r=!1){super(),this.__isAsync=r}emit(r){super.next(r)}subscribe(r,o,l){let h=r,m=o||(()=>null),y=l;if(r&&"object"==typeof r){const D=r;h=D.next?.bind(D),m=D.error?.bind(D),y=D.complete?.bind(D)}this.__isAsync&&(m=Bm(m),h&&(h=Bm(h)),y&&(y=Bm(y)));const w=super.subscribe({next:h,error:m,complete:y});return r instanceof st&&r.add(w),w}};function lw(...i){}class Dn{constructor({enableLongStackTrace:r=!1,shouldCoalesceEventChangeDetection:o=!1,shouldCoalesceRunChangeDetection:l=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new dr(!1),this.onMicrotaskEmpty=new dr(!1),this.onStable=new dr(!1),this.onError=new dr(!1),typeof Zone>"u")throw new Jt(908,!1);Zone.assertZonePatched();const h=this;h._nesting=0,h._outer=h._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(h._inner=h._inner.fork(new Zone.TaskTrackingZoneSpec)),r&&Zone.longStackTraceZoneSpec&&(h._inner=h._inner.fork(Zone.longStackTraceZoneSpec)),h.shouldCoalesceEventChangeDetection=!l&&o,h.shouldCoalesceRunChangeDetection=l,h.lastRequestAnimationFrameId=-1,h.nativeRequestAnimationFrame=function QT(){const i="function"==typeof Ke.requestAnimationFrame;let r=Ke[i?"requestAnimationFrame":"setTimeout"],o=Ke[i?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&r&&o){const l=r[Zone.__symbol__("OriginalDelegate")];l&&(r=l);const h=o[Zone.__symbol__("OriginalDelegate")];h&&(o=h)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function eS(i){const r=()=>{!function tS(i){i.isCheckStableRunning||-1!==i.lastRequestAnimationFrameId||(i.lastRequestAnimationFrameId=i.nativeRequestAnimationFrame.call(Ke,()=>{i.fakeTopEventTask||(i.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{i.lastRequestAnimationFrameId=-1,ah(i),i.isCheckStableRunning=!0,yv(i),i.isCheckStableRunning=!1},void 0,()=>{},()=>{})),i.fakeTopEventTask.invoke()}),ah(i))}(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(o,l,h,m,y,w)=>{if(function nS(i){return!(!Array.isArray(i)||1!==i.length)&&!0===i[0].data?.__ignore_ng_zone__}(w))return o.invokeTask(h,m,y,w);try{return Lc(i),o.invokeTask(h,m,y,w)}finally{(i.shouldCoalesceEventChangeDetection&&"eventTask"===m.type||i.shouldCoalesceRunChangeDetection)&&r(),vv(i)}},onInvoke:(o,l,h,m,y,w,D)=>{try{return Lc(i),o.invoke(h,m,y,w,D)}finally{i.shouldCoalesceRunChangeDetection&&r(),vv(i)}},onHasTask:(o,l,h,m)=>{o.hasTask(h,m),l===h&&("microTask"==m.change?(i._hasPendingMicrotasks=m.microTask,ah(i),yv(i)):"macroTask"==m.change&&(i.hasPendingMacrotasks=m.macroTask))},onHandleError:(o,l,h,m)=>(o.handleError(h,m),i.runOutsideAngular(()=>i.onError.emit(m)),!1)})}(h)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Dn.isInAngularZone())throw new Jt(909,!1)}static assertNotInAngularZone(){if(Dn.isInAngularZone())throw new Jt(909,!1)}run(r,o,l){return this._inner.run(r,o,l)}runTask(r,o,l,h){const m=this._inner,y=m.scheduleEventTask("NgZoneEvent: "+h,r,JT,lw,lw);try{return m.runTask(y,o,l)}finally{m.cancelTask(y)}}runGuarded(r,o,l){return this._inner.runGuarded(r,o,l)}runOutsideAngular(r){return this._outer.run(r)}}const JT={};function yv(i){if(0==i._nesting&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function ah(i){i.hasPendingMicrotasks=!!(i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&-1!==i.lastRequestAnimationFrameId)}function Lc(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function vv(i){i._nesting--,yv(i)}class jm{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new dr,this.onMicrotaskEmpty=new dr,this.onStable=new dr,this.onError=new dr}run(r,o,l){return r.apply(o,l)}runGuarded(r,o,l){return r.apply(o,l)}runOutsideAngular(r){return r()}runTask(r,o,l,h){return r.apply(o,l)}}const cw=new le("",{providedIn:"root",factory:xv});function xv(){const i=fe(Dn);let r=!0;return Yh(new jn(h=>{r=i.isStable&&!i.hasPendingMacrotasks&&!i.hasPendingMicrotasks,i.runOutsideAngular(()=>{h.next(r),h.complete()})}),new jn(h=>{let m;i.runOutsideAngular(()=>{m=i.onStable.subscribe(()=>{Dn.assertNotInAngularZone(),queueMicrotask(()=>{!r&&!i.hasPendingMacrotasks&&!i.hasPendingMicrotasks&&(r=!0,h.next(!0))})})});const y=i.onUnstable.subscribe(()=>{Dn.assertInAngularZone(),r&&(r=!1,i.runOutsideAngular(()=>{h.next(!1)}))});return()=>{m.unsubscribe(),y.unsubscribe()}}).pipe(x_()))}function Ws(i){return i instanceof Function?i():i}let wv=(()=>{class i{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#t=this.\u0275prov=he({token:i,providedIn:"root",factory:()=>new i})}return i})();function Il(i){for(;i;){i[sn]|=64;const r=Zu(i);if(zp(i)&&!r)return i;i=r}return null}const Um=new le("",{providedIn:"root",factory:()=>!1});let co=null;function lh(i,r){return i[r]??ch()}function vs(i,r){const o=ch();o.producerNode?.length&&(i[r]=co,o.lView=i,co=vw())}const aS={...E1,consumerIsAlwaysLive:!0,consumerMarkedDirty:i=>{Il(i.lView)},lView:null};function vw(){return Object.create(aS)}function ch(){return co??=vw(),co}const ln={};function re(i,r=En.Default){const o=Ft();return null===o?St(i,r):ay(nr(),o,Ge(i),r)}function Cv(){throw new Error("invalid")}function lf(i,r,o,l,h,m,y,w,D,S,k){const z=r.blueprint.slice();return z[xi]=h,z[sn]=140|l,(null!==S||i&&2048&i[sn])&&(z[sn]|=2048),L1(z),z[di]=z[rl]=i,z[zi]=o,z[Su]=y||i&&i[Su],z[en]=w||i&&i[en],z[il]=D||i&&i[il]||null,z[yr]=m,z[_a]=function am(){return _b++}(),z[No]=k,z[Au]=S,z[Ii]=2==r.type?i[Ii]:z,z}function On(i,r,o,l,h){let m=i.data[r];if(null===m)m=function Hm(i,r,o,l,h){const m=Zp(),y=Dr(),D=i.data[r]=function La(i,r,o,l,h,m){let y=r?r.injectorIndex:-1,w=0;return function us(){return null!==Re.skipHydrationRootTNode}()&&(w|=128),{type:o,index:l,insertBeforeIndex:null,injectorIndex:y,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:w,providerIndexes:0,value:h,attrs:m,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:r,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,y?m:m&&m.parent,o,r,l,h);return null===i.firstChild&&(i.firstChild=D),null!==m&&(y?null==m.child&&null!==D.parent&&(m.child=D):null===m.next&&(m.next=D,D.prev=m)),D}(i,r,o,l,h),function ty(){return Re.lFrame.inI18n}()&&(m.flags|=32);else if(64&m.type){m.type=o,m.value=l,m.attrs=h;const y=function mc(){const i=Re.lFrame,r=i.currentTNode;return i.isParent?r:r.parent}();m.injectorIndex=null===y?-1:y.injectorIndex}return jo(m,!0),m}function ka(i,r,o,l){if(0===o)return-1;const h=r.length;for(let m=0;m<o;m++)r.push(l),i.blueprint.push(l),i.data.push(null);return h}function Bc(i,r,o,l,h){const m=lh(r,lc),y=Vr(),w=2&l;try{Us(-1),w&&r.length>Cn&&function $m(i,r,o,l){if(!l)if(3==(3&r[sn])){const m=i.preOrderCheckHooks;null!==m&&_c(r,m,o)}else{const m=i.preOrderHooks;null!==m&&Uu(r,m,0,o)}Us(o)}(i,r,Cn,!1),cs(w?2:0,h);const S=w?m:null,k=V_(S);try{null!==S&&(S.dirty=!1),o(l,h)}finally{dd(S,k)}}finally{w&&null===r[lc]&&vs(r,lc),Us(y),cs(w?3:1,h)}}function cf(i,r,o){if(hd(r)){const l=jr(null);try{const m=r.directiveEnd;for(let y=r.directiveStart;y<m;y++){const w=i.data[y];w.contentQueries&&w.contentQueries(1,o[y],y)}}finally{jr(l)}}}function uh(i,r,o){pc()&&(function df(i,r,o,l){const h=o.directiveStart,m=o.directiveEnd;cc(o)&&function Zm(i,r,o){const l=er(r,i),h=Mv(o);let y=16;o.signals?y=4096:o.onPush&&(y=64);const w=Ym(i,lf(i,h,null,y,l,r,null,i[Su].rendererFactory.createRenderer(l,o),null,null,null));i[r.index]=w}(r,o,i.data[h+o.componentOffset]),i.firstCreatePass||Md(o,r),xr(l,r);const y=o.initialInputs;for(let w=h;w<m;w++){const D=i.data[w],S=hl(r,i,w,o);xr(S,r),null!==y&&pS(0,w-h,S,D,0,y),ss(D)&&(wo(o.index,r)[zi]=hl(r,i,w,o))}}(i,r,o,er(o,r)),64==(64&o.flags)&&Av(i,r,o))}function Dv(i,r,o=er){const l=r.localNames;if(null!==l){let h=r.index+1;for(let m=0;m<l.length;m+=2){const y=l[m+1],w=-1===y?o(r,i):i[y];i[h++]=w}}}function Mv(i){const r=i.tView;return null===r||r.incompleteFirstPass?i.tView=Gm(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts,i.id):r}function Gm(i,r,o,l,h,m,y,w,D,S,k){const z=Cn+l,H=z+h,J=function uS(i,r){const o=[];for(let l=0;l<r;l++)o.push(l<i?null:ln);return o}(z,H),ct="function"==typeof S?S():S;return J[vt]={type:i,blueprint:J,template:o,queries:null,viewQuery:w,declTNode:r,data:J.slice().fill(null,z),bindingStartIndex:z,expandoStartIndex:H,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof m?m():m,pipeRegistry:"function"==typeof y?y():y,firstChild:null,schemas:D,consts:ct,incompleteFirstPass:!1,ssrId:k}}let uf=i=>null;function Tv(i,r,o,l){for(let h in i)if(i.hasOwnProperty(h)){o=null===o?{}:o;const m=i[h];null===l?Sv(o,r,h,m):l.hasOwnProperty(h)&&Sv(o,r,l[h],m)}return o}function Sv(i,r,o,l){i.hasOwnProperty(o)?i[o].push(r,l):i[o]=[r,l]}function hf(i,r,o,l){if(pc()){const h=null===l?null:{"":-1},m=function xs(i,r){const o=i.directiveRegistry;let l=null,h=null;if(o)for(let m=0;m<o.length;m++){const y=o[m];if(I_(r,y.selectors,!1))if(l||(l=[]),ss(y))if(null!==y.findHostDirectiveDefs){const w=[];h=h||new Map,y.findHostDirectiveDefs(y,w,h),l.unshift(...w,y),Al(i,r,w.length)}else l.unshift(y),Al(i,r,0);else h=h||new Map,y.findHostDirectiveDefs?.(y,l,h),l.push(y)}return null===l?null:[l,h]}(i,o);let y,w;null===m?y=w=null:[y,w]=m,null!==y&&Zr(i,r,o,y,h,w),h&&function Rl(i,r,o){if(r){const l=i.localNames=[];for(let h=0;h<r.length;h+=2){const m=o[r[h+1]];if(null==m)throw new Jt(-301,!1);l.push(r[h],m)}}}(o,l,h)}o.mergedAttrs=Eu(o.mergedAttrs,o.attrs)}function Zr(i,r,o,l,h,m){for(let S=0;S<l.length;S++)em(Md(o,r),i,l[S].type);!function qm(i,r,o){i.flags|=1,i.directiveStart=r,i.directiveEnd=r+o,i.providerIndexes=r}(o,i.data.length,l.length);for(let S=0;S<l.length;S++){const k=l[S];k.providersResolver&&k.providersResolver(k)}let y=!1,w=!1,D=ka(i,r,l.length,null);for(let S=0;S<l.length;S++){const k=l[S];o.mergedAttrs=Eu(o.mergedAttrs,k.hostAttrs),Aw(i,o,r,D,k),Iw(D,k,h),null!==k.contentQueries&&(o.flags|=4),(null!==k.hostBindings||null!==k.hostAttrs||0!==k.hostVars)&&(o.flags|=64);const z=k.type.prototype;!y&&(z.ngOnChanges||z.ngOnInit||z.ngDoCheck)&&((i.preOrderHooks??=[]).push(o.index),y=!0),!w&&(z.ngOnChanges||z.ngDoCheck)&&((i.preOrderCheckHooks??=[]).push(o.index),w=!0),D++}!function Cw(i,r,o){const h=r.directiveEnd,m=i.data,y=r.attrs,w=[];let D=null,S=null;for(let k=r.directiveStart;k<h;k++){const z=m[k],H=o?o.get(z):null,ct=H?H.outputs:null;D=Tv(z.inputs,k,D,H?H.inputs:null),S=Tv(z.outputs,k,S,ct);const mt=null===D||null===y||el(r)?null:hh(D,k,y);w.push(mt)}null!==D&&(D.hasOwnProperty("class")&&(r.flags|=8),D.hasOwnProperty("style")&&(r.flags|=16)),r.initialInputs=w,r.inputs=D,r.outputs=S}(i,o,m)}function Av(i,r,o){const l=o.directiveStart,h=o.directiveEnd,m=o.index,y=function U1(){return Re.lFrame.currentDirectiveIndex}();try{Us(m);for(let w=l;w<h;w++){const D=i.data[w],S=r[w];ey(w),(null!==D.hostBindings||0!==D.hostVars||null!==D.hostAttrs)&&Sw(D,S)}}finally{Us(-1),ey(y)}}function Sw(i,r){null!==i.hostBindings&&i.hostBindings(1,r)}function Al(i,r,o){r.componentOffset=o,(i.components??=[]).push(r.index)}function Iw(i,r,o){if(o){if(r.exportAs)for(let l=0;l<r.exportAs.length;l++)o[r.exportAs[l]]=i;ss(r)&&(o[""]=i)}}function Aw(i,r,o,l,h){i.data[l]=h;const m=h.factory||(h.factory=bo(h.type)),y=new yc(m,ss(h),re);i.blueprint[l]=y,o[l]=y,function Iv(i,r,o,l,h){const m=h.hostBindings;if(m){let y=i.hostBindingOpCodes;null===y&&(y=i.hostBindingOpCodes=[]);const w=~r.index;(function Tw(i){let r=i.length;for(;r>0;){const o=i[--r];if("number"==typeof o&&o<0)return o}return 0})(y)!=w&&y.push(w),y.push(o,l,m)}}(i,r,l,ka(i,o,h.hostVars,ln),h)}function So(i,r,o,l,h,m){const y=er(i,r);!function Rv(i,r,o,l,h,m,y){if(null==m)i.removeAttribute(r,h,o);else{const w=null==y?zt(m):y(m,l||"",h);i.setAttribute(r,h,w,o)}}(r[en],y,m,i.value,o,l,h)}function pS(i,r,o,l,h,m){const y=m[r];if(null!==y)for(let w=0;w<y.length;)Rw(l,o,y[w++],y[w++],y[w++])}function Rw(i,r,o,l,h){const m=jr(null);try{const y=i.inputTransforms;null!==y&&y.hasOwnProperty(l)&&(h=y[l].call(r,h)),null!==i.setInput?i.setInput(r,h,o,l):r[l]=h}finally{jr(m)}}function hh(i,r,o){let l=null,h=0;for(;h<o.length;){const m=o[h];if(0!==m)if(5!==m){if("number"==typeof m)break;if(i.hasOwnProperty(m)){null===l&&(l=[]);const y=i[m];for(let w=0;w<y.length;w+=2)if(y[w]===r){l.push(m,y[w+1],o[h+1]);break}}h+=2}else h+=2;else h+=4}return l}function jc(i,r,o,l){return[i,!0,!1,r,null,0,l,o,null,null,null]}function Wm(i,r){const o=i.contentQueries;if(null!==o)for(let l=0;l<o.length;l+=2){const m=o[l+1];if(-1!==m){const y=i.data[m];wt(o[l]),y.contentQueries(2,r[m],m)}}}function Ym(i,r){return i[sc]?i[Fp][Fo]=r:i[sc]=r,i[Fp]=r,r}function ff(i,r,o){wt(0);const l=jr(null);try{r(i,o)}finally{jr(l)}}function Xm(i){return i[os]||(i[os]=[])}function Pw(i){return i.cleanup||(i.cleanup=[])}function Fa(i,r){const o=i[il],l=o?o.get(ys,null):null;l&&l.handleError(r)}function Km(i,r,o,l,h){for(let m=0;m<o.length;){const y=o[m++],w=o[m++];Rw(i.data[y],r[y],l,w,h)}}function Qm(i,r){const o=wo(r,i),l=o[vt];!function Pv(i,r){for(let o=r.length;o<i.blueprint.length;o++)r.push(i.blueprint[o])}(l,o);const h=o[xi];null!==h&&null===o[No]&&(o[No]=Ml(h,o[il])),Ov(l,o,o[zi])}function Ov(i,r,o){Xn(r);try{const l=i.viewQuery;null!==l&&ff(1,l,o);const h=i.template;null!==h&&Bc(i,r,h,1,o),i.firstCreatePass&&(i.firstCreatePass=!1),i.staticContentQueries&&Wm(i,r),i.staticViewQueries&&ff(2,i.viewQuery,o);const m=i.components;null!==m&&function Ow(i,r){for(let o=0;o<r.length;o++)Qm(i,r[o])}(r,m)}catch(l){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),l}finally{r[sn]&=-5,Yp()}}let Pl=(()=>{class i{constructor(){this.all=new Set,this.queue=new Map}create(o,l,h){const m=typeof Zone>"u"?null:Zone.current,y=function Hp(i,r,o){const l=Object.create(S1);o&&(l.consumerAllowSignalWrites=!0),l.fn=i,l.schedule=r;const h=y=>{l.cleanupFn=y};return l.ref={notify:()=>j_(l),run:()=>{if(l.dirty=!1,l.hasRun&&!fd(l))return;l.hasRun=!0;const y=V_(l);try{l.cleanupFn(),l.cleanupFn=Gp,l.fn(h)}finally{dd(l,y)}},cleanup:()=>l.cleanupFn()},l.ref}(o,S=>{this.all.has(S)&&this.queue.set(S,m)},h);let w;this.all.add(y),y.notify();const D=()=>{y.cleanup(),w?.(),this.all.delete(y),this.queue.delete(y)};return w=l?.onDestroy(D),{destroy:D}}flush(){if(0!==this.queue.size)for(const[o,l]of this.queue)this.queue.delete(o),l?l.run(()=>o.run()):o.run()}get isQueueEmpty(){return 0===this.queue.size}static#t=this.\u0275prov=he({token:i,providedIn:"root",factory:()=>new i})}return i})();function pf(i,r,o){let l=o?i.styles:null,h=o?i.classes:null,m=0;if(null!==r)for(let y=0;y<r.length;y++){const w=r[y];"number"==typeof w?m=w:1==m?h=vp(h,w):2==m&&(l=vp(l,w+": "+r[++y]+";"))}o?i.styles=l:i.stylesWithoutHost=l,o?i.classes=h:i.classesWithoutHost=h}function fh(i,r,o,l,h=!1){for(;null!==o;){const m=r[o.index];null!==m&&l.push(an(m)),Br(m)&&Lw(m,l);const y=o.type;if(8&y)fh(i,r,o.child,l);else if(32&y){const w=jd(o,r);let D;for(;D=w();)l.push(D)}else if(16&y){const w=Py(r,o);if(Array.isArray(w))l.push(...w);else{const D=Zu(r[Ii]);fh(D[vt],D,w,l,!0)}}o=h?o.projectionNext:o.next}return l}function Lw(i,r){for(let o=Wi;o<i.length;o++){const l=i[o],h=l[vt].firstChild;null!==h&&fh(l[vt],l,h,r)}i[zo]!==i[xi]&&r.push(i[zo])}function bs(i,r,o,l=!0){const h=r[Su],m=h.rendererFactory,y=h.afterRenderEventManager;m.begin?.(),y?.begin();try{ph(i,r,i.template,o)}catch(D){throw l&&Fa(r,D),D}finally{m.end?.(),h.effectManager?.flush(),y?.end()}}function ph(i,r,o,l){const h=r[sn];if(256!=(256&h)){r[Su].effectManager?.flush(),Xn(r);try{L1(r),function Eo(i){return Re.lFrame.bindingIndex=i}(i.bindingStartIndex),null!==o&&Bc(i,r,o,2,l);const y=3==(3&h);if(y){const S=i.preOrderCheckHooks;null!==S&&_c(r,S,null)}else{const S=i.preOrderHooks;null!==S&&Uu(r,S,0,null),wd(r,0)}if(function gf(i){for(let r=Sy(i);null!==r;r=Vd(r)){if(!r[L_])continue;const o=r[ol];for(let l=0;l<o.length;l++){nT(o[l])}}}(r),mh(r,2),null!==i.contentQueries&&Wm(i,r),y){const S=i.contentCheckHooks;null!==S&&_c(r,S)}else{const S=i.contentHooks;null!==S&&Uu(r,S,1),wd(r,1)}!function cS(i,r){const o=i.hostBindingOpCodes;if(null===o)return;const l=lh(r,io);try{for(let h=0;h<o.length;h++){const m=o[h];if(m<0)Us(~m);else{const y=m,w=o[++h],D=o[++h];V1(w,y),l.dirty=!1;const S=V_(l);try{D(2,r[y])}finally{dd(l,S)}}}}finally{null===r[io]&&vs(r,io),Us(-1)}}(i,r);const w=i.components;null!==w&&Nw(r,w,0);const D=i.viewQuery;if(null!==D&&ff(2,D,l),y){const S=i.viewCheckHooks;null!==S&&_c(r,S)}else{const S=i.viewHooks;null!==S&&Uu(r,S,2),wd(r,2)}!0===i.firstUpdatePass&&(i.firstUpdatePass=!1),r[sn]&=-73,Bo(r)}finally{Yp()}}}function mh(i,r){for(let o=Sy(i);null!==o;o=Vd(o))for(let l=Wi;l<o.length;l++)Fw(o[l],r)}function Jm(i,r,o){Fw(wo(r,i),o)}function Fw(i,r){if(!function eT(i){return 128==(128&i[sn])}(i))return;const o=i[vt],l=i[sn];if(80&l&&0===r||1024&l||2===r)ph(o,i,o.template,i[zi]);else if(i[Tu]>0){mh(i,1);const h=o.components;null!==h&&Nw(i,h,1)}}function Nw(i,r,o){for(let l=0;l<r.length;l++)Jm(i,r[l],o)}class Xs{get rootNodes(){const r=this._lView,o=r[vt];return fh(o,r,o.firstChild,[])}constructor(r,o){this._lView=r,this._cdRefInjectingView=o,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[zi]}set context(r){this._lView[zi]=r}get destroyed(){return 256==(256&this._lView[sn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const r=this._lView[di];if(Br(r)){const o=r[8],l=o?o.indexOf(this):-1;l>-1&&(Wu(r,l),bi(o,l))}this._attachedToViewContainer=!1}mn(this._lView[vt],this._lView)}onDestroy(r){!function F1(i,r){if(256==(256&i[sn]))throw new Jt(911,!1);null===i[ya]&&(i[ya]=[]),i[ya].push(r)}(this._lView,r)}markForCheck(){Il(this._cdRefInjectingView||this._lView)}detach(){this._lView[sn]&=-129}reattach(){this._lView[sn]|=128}detectChanges(){bs(this._lView[vt],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Jt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Tb(i,r){Tc(i,r,r[en],2,null,null)}(this._lView[vt],this._lView)}attachToAppRef(r){if(this._attachedToViewContainer)throw new Jt(902,!1);this._appRef=r}}class tg extends Xs{constructor(r){super(r),this._view=r}detectChanges(){const r=this._view;bs(r[vt],r,r[zi],!1)}checkNoChanges(){}get context(){return null}}class zw extends Pa{constructor(r){super(),this.ngModule=r}resolveComponentFactory(r){const o=In(r);return new gh(o,this.ngModule)}}function kv(i){const r=[];for(let o in i)i.hasOwnProperty(o)&&r.push({propName:i[o],templateName:o});return r}class mS{constructor(r,o){this.injector=r,this.parentInjector=o}get(r,o,l){l=rc(l);const h=this.injector.get(r,Nm,l);return h!==Nm||o===Nm?h:this.parentInjector.get(r,o,l)}}class gh extends rf{get inputs(){const r=this.componentDef,o=r.inputTransforms,l=kv(r.inputs);if(null!==o)for(const h of l)o.hasOwnProperty(h.propName)&&(h.transform=o[h.propName]);return l}get outputs(){return kv(this.componentDef.outputs)}constructor(r,o){super(),this.componentDef=r,this.ngModule=o,this.componentType=r.type,this.selector=function g1(i){return i.map(kM).join(",")}(r.selectors),this.ngContentSelectors=r.ngContentSelectors?r.ngContentSelectors:[],this.isBoundToModule=!!o}create(r,o,l,h){let m=(h=h||this.ngModule)instanceof Gr?h:h?.injector;m&&null!==this.componentDef.getStandaloneInjector&&(m=this.componentDef.getStandaloneInjector(m)||m);const y=m?new mS(r,m):r,w=y.get(iw,null);if(null===w)throw new Jt(407,!1);const z={rendererFactory:w,sanitizer:y.get(ZT,null),effectManager:y.get(Pl,null),afterRenderEventManager:y.get(wv,null)},H=w.createRenderer(null,this.componentDef),J=this.componentDef.selectors[0][0]||"div",ct=l?function xw(i,r,o,l){const m=l.get(Um,!1)||o===Lo.ShadowDom,y=i.selectRootElement(r,m);return function bw(i){uf(i)}(y),y}(H,l,this.componentDef.encapsulation,y):Ud(H,J,function Bw(i){const r=i.toLowerCase();return"svg"===r?"svg":"math"===r?"math":null}(J)),Wt=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let Et=null;null!==ct&&(Et=Ml(ct,y,!0));const je=Gm(0,null,null,1,0,null,null,null,null,null,null),tn=lf(null,je,null,Wt,null,null,z,H,y,null,Et);let Vn,Xo;Xn(tn);try{const cu=this.componentDef;let f_,Y2=null;cu.findHostDirectiveDefs?(f_=[],Y2=new Map,cu.findHostDirectiveDefs(cu,f_,Y2),f_.push(cu)):f_=[cu];const R5=function jw(i,r){const o=i[vt],l=Cn;return i[l]=r,On(o,l,2,"#host",null)}(tn,ct),P5=function _S(i,r,o,l,h,m,y){const w=h[vt];!function eg(i,r,o,l){for(const h of i)r.mergedAttrs=Eu(r.mergedAttrs,h.hostAttrs);null!==r.mergedAttrs&&(pf(r,r.mergedAttrs,!0),null!==o&&ky(l,o,r))}(l,i,r,y);let D=null;null!==r&&(D=Ml(r,h[il]));const S=m.rendererFactory.createRenderer(r,o);let k=16;o.signals?k=4096:o.onPush&&(k=64);const z=lf(h,Mv(o),null,k,h[i.index],i,m,S,null,null,D);return w.firstCreatePass&&Al(w,i,l.length-1),Ym(h,z),h[i.index]=z}(R5,ct,cu,f_,tn,z,H);Xo=k1(je,Cn),ct&&function Lv(i,r,o,l){if(l)Ap(i,o,["ng-version",WT.full]);else{const{attrs:h,classes:m}=function LM(i){const r=[],o=[];let l=1,h=2;for(;l<i.length;){let m=i[l];if("string"==typeof m)2===h?""!==m&&r.push(m,i[++l]):8===h&&o.push(m);else{if(!xo(h))break;h=m}l++}return{attrs:r,classes:o}}(r.selectors[0]);h&&Ap(i,o,h),m&&m.length>0&&Ku(i,o,m.join(" "))}}(H,cu,ct,l),void 0!==o&&function Vw(i,r,o){const l=i.projection=[];for(let h=0;h<r.length;h++){const m=o[h];l.push(null!=m?Array.from(m):null)}}(Xo,this.ngContentSelectors,o),Vn=function yS(i,r,o,l,h,m){const y=nr(),w=h[vt],D=er(y,h);Zr(w,h,y,o,null,l);for(let k=0;k<o.length;k++)xr(hl(h,w,y.directiveStart+k,y),h);Av(w,h,y),D&&xr(D,h);const S=hl(h,w,y.directiveStart+y.componentOffset,y);if(i[zi]=h[zi]=S,null!==m)for(const k of m)k(S,r);return cf(w,y,i),S}(P5,cu,f_,Y2,tn,[ng]),Ov(je,tn,null)}finally{Yp()}return new gS(this.componentType,Vn,oh(Xo,tn),tn,Xo)}}class gS extends lv{constructor(r,o,l,h,m){super(),this.location=l,this._rootLView=h,this._tNode=m,this.previousInputValues=null,this.instance=o,this.hostView=this.changeDetectorRef=new tg(h),this.componentType=r}setInput(r,o){const l=this._tNode.inputs;let h;if(null!==l&&(h=l[r])){if(this.previousInputValues??=new Map,this.previousInputValues.has(r)&&Object.is(this.previousInputValues.get(r),o))return;const m=this._rootLView;Km(m[vt],m,h,r,o),this.previousInputValues.set(r,o),Il(wo(this._tNode.index,m))}}get injector(){return new ir(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(r){this.hostView.onDestroy(r)}}function ng(){const i=nr();gc(Ft()[vt],i)}function _h(i){let r=function Uw(i){return Object.getPrototypeOf(i.prototype).constructor}(i.type),o=!0;const l=[i];for(;r;){let h;if(ss(i))h=r.\u0275cmp||r.\u0275dir;else{if(r.\u0275cmp)throw new Jt(903,!1);h=r.\u0275dir}if(h){if(o){l.push(h);const y=i;y.inputs=Vc(i.inputs),y.inputTransforms=Vc(i.inputTransforms),y.declaredInputs=Vc(i.declaredInputs),y.outputs=Vc(i.outputs);const w=h.hostBindings;w&&yh(i,w);const D=h.viewQuery,S=h.contentQueries;if(D&&rg(i,D),S&&og(i,S),Xh(i.inputs,h.inputs),Xh(i.declaredInputs,h.declaredInputs),Xh(i.outputs,h.outputs),null!==h.inputTransforms&&(null===y.inputTransforms&&(y.inputTransforms={}),Xh(y.inputTransforms,h.inputTransforms)),ss(h)&&h.data.animation){const k=i.data;k.animation=(k.animation||[]).concat(h.data.animation)}}const m=h.features;if(m)for(let y=0;y<m.length;y++){const w=m[y];w&&w.ngInherit&&w(i),w===_h&&(o=!1)}}r=Object.getPrototypeOf(r)}!function ig(i){let r=0,o=null;for(let l=i.length-1;l>=0;l--){const h=i[l];h.hostVars=r+=h.hostVars,h.hostAttrs=Eu(h.hostAttrs,o=Eu(o,h.hostAttrs))}}(l)}function Vc(i){return i===is?{}:i===Gn?[]:i}function rg(i,r){const o=i.viewQuery;i.viewQuery=o?(l,h)=>{r(l,h),o(l,h)}:r}function og(i,r){const o=i.contentQueries;i.contentQueries=o?(l,h,m)=>{r(l,h,m),o(l,h,m)}:r}function yh(i,r){const o=i.hostBindings;i.hostBindings=o?(l,h)=>{r(l,h),o(l,h)}:r}function Oi(i,r,o){return!Object.is(i[r],o)&&(i[r]=o,!0)}function $c(i,r,o,l){const h=Ft();return Oi(h,zn(),r)&&(Nn(),So(Ue(),h,i,r,o,l)),$c}function wf(i,r,o,l,h,m,y,w){const D=Ft(),S=Nn(),k=i+Cn,z=S.firstCreatePass?function oE(i,r,o,l,h,m,y,w,D){const S=r.consts,k=On(r,i,4,y||null,sl(S,w));hf(r,o,k,sl(S,D)),gc(r,k);const z=k.tView=Gm(2,k,l,h,m,r.directiveRegistry,r.pipeRegistry,null,r.schemas,S,null);return null!==r.queries&&(r.queries.template(r,k),z.queries=r.queries.embeddedTView(k)),k}(k,S,D,r,o,l,h,m,y):S.data[k];jo(z,!1);const H=Th(S,D,z,i);Vu()&&mm(S,D,H,z),xr(H,D),Ym(D,D[k]=jc(H,D,H,z)),uc(z)&&uh(S,D,z),null!=y&&Dv(D,z,w)}let Th=function sE(i,r,o,l){return Mr(!0),r[en].createComment("")};function Hv(i,r,o,l,h){const y=h?"class":"style";Km(i,o,r.inputs[y],y,l)}function Vt(i,r,o,l){const h=Ft(),m=Nn(),y=Cn+i,w=h[en],D=m.firstCreatePass?function Gv(i,r,o,l,h,m){const y=r.consts,D=On(r,i,2,l,sl(y,h));return hf(r,o,D,sl(y,m)),null!==D.attrs&&pf(D,D.attrs,!1),null!==D.mergedAttrs&&pf(D,D.mergedAttrs,!0),null!==r.queries&&r.queries.elementStart(r,D),D}(y,m,h,r,o,l):m.data[y],S=qv(m,h,D,w,r,i);h[y]=S;const k=uc(D);return jo(D,!0),ky(w,S,D),32!=(32&D.flags)&&Vu()&&mm(m,h,S,D),0===function Xt(){return Re.lFrame.elementDepthCount}()&&xr(S,h),function N1(){Re.lFrame.elementDepthCount++}(),k&&(uh(m,h,D),cf(m,D,h)),null!==l&&Dv(h,D),Vt}function Zt(){let i=nr();Dr()?function js(){Re.lFrame.isParent=!1}():(i=i.parent,jo(i,!1));const r=i;(function ee(i){return Re.skipHydrationRootTNode===i})(r)&&function J_(){Re.skipHydrationRootTNode=null}(),function z1(){Re.lFrame.elementDepthCount--}();const o=Nn();return o.firstCreatePass&&(gc(o,i),hd(i)&&o.queries.elementEnd(i)),null!=r.classesWithoutHost&&function Cd(i){return 0!=(8&i.flags)}(r)&&Hv(o,r,Ft(),r.classesWithoutHost,!0),null!=r.stylesWithoutHost&&function vc(i){return 0!=(16&i.flags)}(r)&&Hv(o,r,Ft(),r.stylesWithoutHost,!1),Zt}function ke(i,r,o,l){return Vt(i,r,o,l),Zt(),ke}let qv=(i,r,o,l,h,m)=>(Mr(!0),Ud(l,h,function cl(){return Re.lFrame.currentNamespace}()));function Zc(i){return!!i&&"function"==typeof i.then}function Yv(i){return!!i&&"function"==typeof i.subscribe}function Na(i,r,o,l){const h=Ft(),m=Nn(),y=nr();return function hE(i,r,o,l,h,m,y){const w=uc(l),S=i.firstCreatePass&&Pw(i),k=r[zi],z=Xm(r);let H=!0;if(3&l.type||y){const mt=er(l,r),Pt=y?y(mt):mt,Wt=z.length,Et=y?tn=>y(an(tn[l.index])):l.index;let je=null;if(!y&&w&&(je=function uE(i,r,o,l){const h=i.cleanup;if(null!=h)for(let m=0;m<h.length-1;m+=2){const y=h[m];if(y===o&&h[m+1]===l){const w=r[os],D=h[m+2];return w.length>D?w[D]:null}"string"==typeof y&&(m+=2)}return null}(i,r,h,l.index)),null!==je)(je.__ngLastListenerFn__||je).__ngNextListenerFn__=m,je.__ngLastListenerFn__=m,H=!1;else{m=Xv(l,r,k,m,!1);const tn=o.listen(Pt,h,m);z.push(m,tn),S&&S.push(h,Et,Wt,Wt+1)}}else m=Xv(l,r,k,m,!1);const J=l.outputs;let ct;if(H&&null!==J&&(ct=J[h])){const mt=ct.length;if(mt)for(let Pt=0;Pt<mt;Pt+=2){const Vn=r[ct[Pt]][ct[Pt+1]].subscribe(m),Xo=z.length;z.push(m,Vn),S&&S.push(h,l.index,Xo,-(Xo+1))}}}(m,h,h[en],y,i,r,l),Na}function dE(i,r,o,l){try{return cs(6,r,o),!1!==o(l)}catch(h){return Fa(i,h),!1}finally{cs(7,r,o)}}function Xv(i,r,o,l,h){return function m(y){if(y===Function)return l;Il(i.componentOffset>-1?wo(i.index,r):r);let D=dE(r,o,l,y),S=m.__ngNextListenerFn__;for(;S;)D=dE(r,o,S,y)&&D,S=S.__ngNextListenerFn__;return h&&!1===D&&y.preventDefault(),D}}function hg(i,r){return i<<17|r<<2}function za(i){return i>>17&32767}function Mf(i){return 2|i}function ea(i){return(131068&i)>>2}function Ih(i,r){return-131069&i|r<<2}function dg(i){return 1|i}function Ll(i,r,o,l,h){const m=i[o+1],y=null===r;let w=l?za(m):ea(m),D=!1;for(;0!==w&&(!1===D||y);){const k=i[w+1];yE(i[w],r)&&(D=!0,i[w+1]=l?dg(k):Mf(k)),w=l?za(k):ea(k)}D&&(i[o+1]=l?Mf(m):dg(m))}function yE(i,r){return null===i||null==r||(Array.isArray(i)?i[1]:i)===r||!(!Array.isArray(i)||"string"!=typeof r)&&Do(i,r)>=0}function fg(i,r){return function Wr(i,r,o,l){const h=Ft(),m=Nn(),y=function Vo(i){const r=Re.lFrame,o=r.bindingIndex;return r.bindingIndex=r.bindingIndex+i,o}(2);m.firstUpdatePass&&function s0(i,r,o,l){const h=i.data;if(null===h[o+1]){const m=h[Vr()],y=function Ah(i,r){return r>=i.expandoStartIndex}(i,o);(function u0(i,r){return 0!=(i.flags&(r?8:16))})(m,l)&&null===r&&!y&&(r=!1),r=function SE(i,r,o,l){const h=function ll(i){const r=Re.lFrame.currentDirectiveIndex;return-1===r?null:i[r]}(i);let m=l?r.residualClasses:r.residualStyles;if(null===h)0===(l?r.classBindings:r.styleBindings)&&(o=Rh(o=a0(null,i,r,o,l),r.attrs,l),m=null);else{const y=r.directiveStylingLast;if(-1===y||i[y]!==h)if(o=a0(h,i,r,o,l),null===m){let D=function IE(i,r,o){const l=o?r.classBindings:r.styleBindings;if(0!==ea(l))return i[za(l)]}(i,r,l);void 0!==D&&Array.isArray(D)&&(D=a0(null,i,r,D[1],l),D=Rh(D,r.attrs,l),function AE(i,r,o,l){i[za(o?r.classBindings:r.styleBindings)]=l}(i,r,l,D))}else m=function VS(i,r,o){let l;const h=r.directiveEnd;for(let m=1+r.directiveStylingLast;m<h;m++)l=Rh(l,i[m].hostAttrs,o);return Rh(l,r.attrs,o)}(i,r,l)}return void 0!==m&&(l?r.residualClasses=m:r.residualStyles=m),o}(h,m,r,l),function zS(i,r,o,l,h,m){let y=m?r.classBindings:r.styleBindings,w=za(y),D=ea(y);i[l]=o;let k,S=!1;if(Array.isArray(o)?(k=o[1],(null===k||Do(o,k)>0)&&(S=!0)):k=o,h)if(0!==D){const H=za(i[w+1]);i[l+1]=hg(H,w),0!==H&&(i[H+1]=Ih(i[H+1],l)),i[w+1]=function FS(i,r){return 131071&i|r<<17}(i[w+1],l)}else i[l+1]=hg(w,0),0!==w&&(i[w+1]=Ih(i[w+1],l)),w=l;else i[l+1]=hg(D,0),0===w?w=l:i[D+1]=Ih(i[D+1],l),D=l;S&&(i[l+1]=Mf(i[l+1])),Ll(i,k,l,!0),Ll(i,k,l,!1),function n0(i,r,o,l,h){const m=h?i.residualClasses:i.residualStyles;null!=m&&"string"==typeof r&&Do(m,r)>=0&&(o[l+1]=dg(o[l+1]))}(r,k,i,l,m),y=hg(w,D),m?r.classBindings=y:r.styleBindings=y}(h,m,r,o,y,l)}}(m,i,y,l),r!==ln&&Oi(h,y,r)&&function pg(i,r,o,l,h,m,y,w){if(!(3&r.type))return;const D=i.data,S=D[w+1],k=function _E(i){return 1==(1&i)}(S)?c0(D,r,o,h,ea(S),y):void 0;Af(k)||(Af(m)||function Df(i){return 2==(2&i)}(S)&&(m=c0(D,null,o,h,w,y)),function gm(i,r,o,l,h){if(r)h?i.addClass(o,l):i.removeClass(o,l);else{let m=-1===l.indexOf("-")?void 0:Ta.DashCase;null==h?i.removeStyle(o,l,m):("string"==typeof h&&h.endsWith("!important")&&(h=h.slice(0,-10),m|=Ta.Important),i.setStyle(o,l,h,m))}}(l,y,function yd(i,r){return an(r[i])}(Vr(),o),h,m))}(m,m.data[Vr()],h,h[en],i,h[y+1]=function PE(i,r){return null==i||""===i||("string"==typeof r?i+=r:"object"==typeof i&&(i=qi(function qs(i){return i instanceof Bb?i.changingThisBreaksApplicationSecurity:i}(i)))),i}(r,o),l,y)}(i,r,null,!0),fg}function a0(i,r,o,l,h){let m=null;const y=o.directiveEnd;let w=o.directiveStylingLast;for(-1===w?w=o.directiveStart:w++;w<y&&(m=r[w],l=Rh(l,m.hostAttrs,h),m!==i);)w++;return null!==i&&(o.directiveStylingLast=w),l}function Rh(i,r,o){const l=o?1:2;let h=-1;if(null!==r)for(let m=0;m<r.length;m++){const y=r[m];"number"==typeof y?h=y:h===l&&(Array.isArray(i)||(i=void 0===i?[]:["",i]),fn(i,y,!!o||r[++m]))}return void 0===i?null:i}function c0(i,r,o,l,h,m){const y=null===r;let w;for(;h>0;){const D=i[h],S=Array.isArray(D),k=S?D[1]:D,z=null===k;let H=o[h+1];H===ln&&(H=z?Gn:void 0);let J=z?Rd(H,l):k===l?H:void 0;if(S&&!Af(J)&&(J=Rd(D,l)),Af(J)&&(w=J,y))return w;const ct=i[h+1];h=y?za(ct):ea(ct)}if(null!==r){let D=m?r.residualClasses:r.residualStyles;null!=D&&(w=Rd(D,l))}return w}function Af(i){return void 0!==i}function Ee(i,r=""){const o=Ft(),l=Nn(),h=i+Cn,m=l.firstCreatePass?On(l,h,1,r,null):l.data[h],y=OE(l,o,m,r,i);o[h]=y,Vu()&&mm(l,o,y,m),jo(m,!1)}let OE=(i,r,o,l,h)=>(Mr(!0),function Hs(i,r){return i.createText(r)}(r[en],l));function gg(i,r,o){const l=Ft();return Oi(l,zn(),r)&&function To(i,r,o,l,h,m,y,w){const D=er(r,o);let k,S=r.inputs;!w&&null!=S&&(k=S[l])?(Km(i,o,k,l,h),cc(r)&&function dS(i,r){const o=wo(r,i);16&o[sn]||(o[sn]|=64)}(o,r.index)):3&r.type&&(l=function Dw(i){return"class"===i?"className":"for"===i?"htmlFor":"formaction"===i?"formAction":"innerHtml"===i?"innerHTML":"readonly"===i?"readOnly":"tabindex"===i?"tabIndex":i}(l),h=null!=y?y(h,r.value||"",l):h,m.setProperty(D,l,h))}(Nn(),Ue(),l,i,r,l[en],o,!0),gg}const zl="en-US";let yg=zl;class jl{}class Rg{}class q0 extends jl{constructor(r,o,l){super(),this._parent=o,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new zw(this);const h=no(r);this._bootstrapComponents=Ws(h.bootstrap),this._r3Injector=mv(r,o,[{provide:jl,useValue:this},{provide:Pa,useValue:this.componentFactoryResolver},...l],qi(r),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(r)}get injector(){return this._r3Injector}destroy(){const r=this._r3Injector;!r.destroyed&&r.destroy(),this.destroyCbs.forEach(o=>o()),this.destroyCbs=null}onDestroy(r){this.destroyCbs.push(r)}}class Z0 extends Rg{constructor(r){super(),this.moduleType=r}create(r){return new q0(this.moduleType,r,[])}}class W0 extends jl{constructor(r){super(),this.componentFactoryResolver=new zw(this),this.instance=null;const o=new Qd([...r.providers,{provide:jl,useValue:this},{provide:Pa,useValue:this.componentFactoryResolver}],r.parent||Ra(),r.debugName,new Set(["environment"]));this.injector=o,r.runEnvironmentInitializers&&o.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(r){this.injector.onDestroy(r)}}function Pg(i,r,o=null){return new W0({providers:i,parent:r,debugName:o,runEnvironmentInitializers:!0}).injector}let fC=(()=>{class i{constructor(o){this._injector=o,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(o){if(!o.standalone)return null;if(!this.cachedInjectors.has(o)){const l=Em(0,o.type),h=l.length>0?Pg([l],this._injector,`Standalone[${o.type.name}]`):null;this.cachedInjectors.set(o,h)}return this.cachedInjectors.get(o)}ngOnDestroy(){try{for(const o of this.cachedInjectors.values())null!==o&&o.destroy()}finally{this.cachedInjectors.clear()}}static#t=this.\u0275prov=he({token:i,providedIn:"environment",factory:()=>new i(St(Gr))})}return i})();function Y0(i){i.getStandaloneInjector=r=>r.get(fC).getOrCreateStandaloneInjector(i)}function OI(){return this._results[Symbol.iterator]()}class ex{static#t=Symbol.iterator;get changes(){return this._changes||(this._changes=new dr)}constructor(r=!1){this._emitDistinctChangesOnly=r,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const o=ex.prototype;o[Symbol.iterator]||(o[Symbol.iterator]=OI)}get(r){return this._results[r]}map(r){return this._results.map(r)}filter(r){return this._results.filter(r)}find(r){return this._results.find(r)}reduce(r,o){return this._results.reduce(r,o)}forEach(r){this._results.forEach(r)}some(r){return this._results.some(r)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(r,o){const l=this;l.dirty=!1;const h=function Uo(i){return i.flat(Number.POSITIVE_INFINITY)}(r);(this._changesDetected=!function fT(i,r,o){if(i.length!==r.length)return!1;for(let l=0;l<i.length;l++){let h=i[l],m=r[l];if(o&&(h=o(h),m=o(m)),m!==h)return!1}return!0}(l._results,h,o))&&(l._results=h,l.length=h.length,l.last=h[this.length-1],l.first=h[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function kI(i,r,o,l=!0){const h=r[vt];if(function Ib(i,r,o,l){const h=Wi+l,m=o.length;l>0&&(o[h-1][Fo]=r),l<m-Wi?(r[Fo]=o[h],Ur(o,Wi+l,r)):(o.push(r),r[Fo]=null),r[di]=o;const y=r[Iu];null!==y&&o!==y&&function Ab(i,r){const o=i[ol];r[Ii]!==r[di][di][Ii]&&(i[L_]=!0),null===o?i[ol]=[r]:o.push(r)}(y,r);const w=r[Bs];null!==w&&w.insertView(i),r[sn]|=128}(h,r,i,o),l){const m=Gs(o,i),y=r[en],w=fm(y,i[zo]);null!==w&&function Mb(i,r,o,l,h,m){l[xi]=h,l[yr]=r,Tc(i,l,o,1,h,m)}(h,i[yr],y,r,w,m)}}let ra=(()=>{class i{static#t=this.__NG_ELEMENT_ID__=kC}return i})();const FI=ra,NI=class extends FI{constructor(r,o,l){super(),this._declarationLView=r,this._declarationTContainer=o,this.elementRef=l}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(r,o){return this.createEmbeddedViewImpl(r,o)}createEmbeddedViewImpl(r,o,l){const h=function OC(i,r,o,l){const h=r.tView,w=lf(i,h,o,4096&i[sn]?4096:16,null,r,null,null,null,l?.injector??null,l?.hydrationInfo??null);w[Iu]=i[r.index];const S=i[Bs];return null!==S&&(w[Bs]=S.createEmbeddedView(h)),Ov(h,w,o),w}(this._declarationLView,this._declarationTContainer,r,{injector:o,hydrationInfo:l});return new Xs(h)}};function kC(){return Zf(nr(),Ft())}function Zf(i,r){return 4&i.type?new NI(r,i,oh(i,r)):null}let Io=(()=>{class i{static#t=this.__NG_ELEMENT_ID__=NC}return i})();function NC(){return Ng(nr(),Ft())}const jI=Io,zC=class extends jI{constructor(r,o,l){super(),this._lContainer=r,this._hostTNode=o,this._hostLView=l}get element(){return oh(this._hostTNode,this._hostLView)}get injector(){return new ir(this._hostTNode,this._hostLView)}get parentInjector(){const r=Td(this._hostTNode,this._hostLView);if(xc(r)){const o=bc(r,this._hostLView),l=hs(r);return new ir(o[vt].data[l+8],o)}return new ir(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(r){const o=BC(this._lContainer);return null!==o&&o[r]||null}get length(){return this._lContainer.length-Wi}createEmbeddedView(r,o,l){let h,m;"number"==typeof l?h=l:null!=l&&(h=l.index,m=l.injector);const w=r.createEmbeddedViewImpl(o||{},m,null);return this.insertImpl(w,h,false),w}createComponent(r,o,l,h,m){const y=r&&!function Ad(i){return"function"==typeof i}(r);let w;if(y)w=o;else{const mt=o||{};w=mt.index,l=mt.injector,h=mt.projectableNodes,m=mt.environmentInjector||mt.ngModuleRef}const D=y?r:new gh(In(r)),S=l||this.parentInjector;if(!m&&null==D.ngModule){const Pt=(y?S:this.parentInjector).get(Gr,null);Pt&&(m=Pt)}In(D.componentType??{});const J=D.create(S,h,null,m);return this.insertImpl(J.hostView,w,false),J}insert(r,o){return this.insertImpl(r,o,!1)}insertImpl(r,o,l){const h=r._lView;if(function X_(i){return Br(i[di])}(h)){const D=this.indexOf(r);if(-1!==D)this.detach(D);else{const S=h[di],k=new zC(S,S[yr],S[di]);k.detach(k.indexOf(r))}}const y=this._adjustIndex(o),w=this._lContainer;return kI(w,h,y,!l),r.attachToViewContainerRef(),Ur(Fg(w),y,r),r}move(r,o){return this.insert(r,o)}indexOf(r){const o=BC(this._lContainer);return null!==o?o.indexOf(r):-1}remove(r){const o=this._adjustIndex(r,-1),l=Wu(this._lContainer,o);l&&(bi(Fg(this._lContainer),o),mn(l[vt],l))}detach(r){const o=this._adjustIndex(r,-1),l=Wu(this._lContainer,o);return l&&null!=bi(Fg(this._lContainer),o)?new Xs(l):null}_adjustIndex(r,o=0){return r??this.length+o}};function BC(i){return i[8]}function Fg(i){return i[8]||(i[8]=[])}function Ng(i,r){let o;const l=r[i.index];return Br(l)?o=l:(o=jc(l,r,null,i),r[i.index]=o,Ym(r,o)),Yf(o,r,i,l),new zC(o,i,r)}let Yf=function Jc(i,r,o,l){if(i[zo])return;let h;h=8&o.type?an(l):function jC(i,r){const o=i[en],l=o.createComment(""),h=er(r,i);return $i(o,fm(o,h),l,function ST(i,r){return i.nextSibling(r)}(o,h),!1),l}(r,o),i[zo]=h};class ox{constructor(r){this.queryList=r,this.matches=null}clone(){return new ox(this.queryList)}setDirty(){this.queryList.setDirty()}}class sx{constructor(r=[]){this.queries=r}createEmbeddedView(r){const o=r.queries;if(null!==o){const l=null!==r.contentQueries?r.contentQueries[0]:o.length,h=[];for(let m=0;m<l;m++){const y=o.getByIndex(m);h.push(this.queries[y.indexInDeclarationView].clone())}return new sx(h)}return null}insertView(r){this.dirtyQueriesWithMatches(r)}detachView(r){this.dirtyQueriesWithMatches(r)}dirtyQueriesWithMatches(r){for(let o=0;o<this.queries.length;o++)null!==HC(r,o).matches&&this.queries[o].setDirty()}}class VC{constructor(r,o,l=null){this.predicate=r,this.flags=o,this.read=l}}class ax{constructor(r=[]){this.queries=r}elementStart(r,o){for(let l=0;l<this.queries.length;l++)this.queries[l].elementStart(r,o)}elementEnd(r){for(let o=0;o<this.queries.length;o++)this.queries[o].elementEnd(r)}embeddedTView(r){let o=null;for(let l=0;l<this.length;l++){const h=null!==o?o.length:0,m=this.getByIndex(l).embeddedTView(r,h);m&&(m.indexInDeclarationView=l,null!==o?o.push(m):o=[m])}return null!==o?new ax(o):null}template(r,o){for(let l=0;l<this.queries.length;l++)this.queries[l].template(r,o)}getByIndex(r){return this.queries[r]}get length(){return this.queries.length}track(r){this.queries.push(r)}}class lx{constructor(r,o=-1){this.metadata=r,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=o}elementStart(r,o){this.isApplyingToNode(o)&&this.matchTNode(r,o)}elementEnd(r){this._declarationNodeIndex===r.index&&(this._appliesToNextNode=!1)}template(r,o){this.elementStart(r,o)}embeddedTView(r,o){return this.isApplyingToNode(r)?(this.crossesNgTemplate=!0,this.addMatch(-r.index,o),new lx(this.metadata)):null}isApplyingToNode(r){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const o=this._declarationNodeIndex;let l=r.parent;for(;null!==l&&8&l.type&&l.index!==o;)l=l.parent;return o===(null!==l?l.index:-1)}return this._appliesToNextNode}matchTNode(r,o){const l=this.metadata.predicate;if(Array.isArray(l))for(let h=0;h<l.length;h++){const m=l[h];this.matchTNodeWithReadOption(r,o,$I(o,m)),this.matchTNodeWithReadOption(r,o,wc(o,r,m,!1,!1))}else l===ra?4&o.type&&this.matchTNodeWithReadOption(r,o,-1):this.matchTNodeWithReadOption(r,o,wc(o,r,l,!1,!1))}matchTNodeWithReadOption(r,o,l){if(null!==l){const h=this.metadata.read;if(null!==h)if(h===qr||h===Io||h===ra&&4&o.type)this.addMatch(o.index,-2);else{const m=wc(o,r,h,!1,!1);null!==m&&this.addMatch(o.index,m)}else this.addMatch(o.index,l)}}addMatch(r,o){null===this.matches?this.matches=[r,o]:this.matches.push(r,o)}}function $I(i,r){const o=i.localNames;if(null!==o)for(let l=0;l<o.length;l+=2)if(o[l]===r)return o[l+1];return null}function GI(i,r,o,l){return-1===o?function HI(i,r){return 11&i.type?oh(i,r):4&i.type?Zf(i,r):null}(r,i):-2===o?function qI(i,r,o){return o===qr?oh(r,i):o===ra?Zf(r,i):o===Io?Ng(r,i):void 0}(i,r,l):hl(i,i[vt],o,r)}function UC(i,r,o,l){const h=r[Bs].queries[l];if(null===h.matches){const m=i.data,y=o.matches,w=[];for(let D=0;D<y.length;D+=2){const S=y[D];w.push(S<0?null:GI(r,m[S],y[D+1],o.metadata.read))}h.matches=w}return h.matches}function zg(i,r,o,l){const h=i.queries.getByIndex(o),m=h.matches;if(null!==m){const y=UC(i,r,h,o);for(let w=0;w<m.length;w+=2){const D=m[w];if(D>0)l.push(y[w/2]);else{const S=m[w+1],k=r[-D];for(let z=Wi;z<k.length;z++){const H=k[z];H[Iu]===H[di]&&zg(H[vt],H,S,l)}if(null!==k[ol]){const z=k[ol];for(let H=0;H<z.length;H++){const J=z[H];zg(J[vt],J,S,l)}}}}}return l}function Bg(i){const r=Ft(),o=Nn(),l=Bu();wt(l+1);const h=HC(o,l);if(i.dirty&&function tT(i){return 4==(4&i[sn])}(r)===(2==(2&h.metadata.flags))){if(null===h.matches)i.reset([]);else{const m=h.crossesNgTemplate?zg(o,r,l,[]):UC(o,r,h,l);i.reset(m,GT),i.notifyOnChanges()}return!0}return!1}function Xf(i,r,o){const l=Nn();l.firstCreatePass&&(function tu(i,r,o){null===i.queries&&(i.queries=new ax),i.queries.track(new lx(r,o))}(l,new VC(i,r,o),-1),2==(2&r)&&(l.staticViewQueries=!0)),function ux(i,r,o){const l=new ex(4==(4&o));(function Ew(i,r,o,l){const h=Xm(r);h.push(o),i.firstCreatePass&&Pw(i).push(l,h.length-1)})(i,r,l,l.destroy),null===r[Bs]&&(r[Bs]=new sx),r[Bs].queries.push(new ox(l))}(l,Ft(),r)}function HC(i,r){return i.queries.getByIndex(r)}const Gg=new le("Application Initializer");let vx=(()=>{class i{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((o,l)=>{this.resolve=o,this.reject=l}),this.appInits=fe(Gg,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const o=[];for(const h of this.appInits){const m=h();if(Zc(m))o.push(m);else if(Yv(m)){const y=new Promise((w,D)=>{m.subscribe({complete:w,error:D})});o.push(y)}}const l=()=>{this.done=!0,this.resolve()};Promise.all(o).then(()=>{l()}).catch(h=>{this.reject(h)}),0===o.length&&l(),this.initialized=!0}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),qg=(()=>{class i{log(o){console.log(o)}warn(o){console.warn(o)}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"platform"})}return i})();const sa=new le("LocaleId",{providedIn:"root",factory:()=>fe(sa,En.Optional|En.SkipSelf)||function aA(){return typeof $localize<"u"&&$localize.locale||zl}()});let cD=(()=>{class i{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Er(!1)}add(){this.hasPendingTasks.next(!0);const o=this.taskId++;return this.pendingTasks.add(o),o}remove(o){this.pendingTasks.delete(o),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();class hA{constructor(r,o){this.ngModuleFactory=r,this.componentFactories=o}}let uD=(()=>{class i{compileModuleSync(o){return new Z0(o)}compileModuleAsync(o){return Promise.resolve(this.compileModuleSync(o))}compileModuleAndAllComponentsSync(o){const l=this.compileModuleSync(o),m=Ws(no(o).declarations).reduce((y,w)=>{const D=In(w);return D&&y.push(new gh(D)),y},[]);return new hA(l,m)}compileModuleAndAllComponentsAsync(o){return Promise.resolve(this.compileModuleAndAllComponentsSync(o))}clearCache(){}clearCacheFor(o){}getModuleId(o){}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();const t=new le(""),n=new le("");let u,s=(()=>{class i{constructor(o,l,h){this._ngZone=o,this.registry=l,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,u||(function c(i){u=i}(h),h.addToWindow(l)),this._watchAngularEvents(),o.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Dn.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let o=this._callbacks.pop();clearTimeout(o.timeoutId),o.doneCb(this._didWork)}this._didWork=!1});else{let o=this.getPendingTasks();this._callbacks=this._callbacks.filter(l=>!l.updateCb||!l.updateCb(o)||(clearTimeout(l.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(o=>({source:o.source,creationLocation:o.creationLocation,data:o.data})):[]}addCallback(o,l,h){let m=-1;l&&l>0&&(m=setTimeout(()=>{this._callbacks=this._callbacks.filter(y=>y.timeoutId!==m),o(this._didWork,this.getPendingTasks())},l)),this._callbacks.push({doneCb:o,timeoutId:m,updateCb:h})}whenStable(o,l,h){if(h&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(o,l,h),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(o){this.registry.registerApplication(o,this)}unregisterApplication(o){this.registry.unregisterApplication(o)}findProviders(o,l,h){return[]}static#t=this.\u0275fac=function(l){return new(l||i)(St(Dn),St(a),St(n))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac})}return i})(),a=(()=>{class i{constructor(){this._applications=new Map}registerApplication(o,l){this._applications.set(o,l)}unregisterApplication(o){this._applications.delete(o)}unregisterAllApplications(){this._applications.clear()}getTestability(o){return this._applications.get(o)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(o,l=!0){return u?.findTestabilityInTree(this,o,l)??null}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"platform"})}return i})(),d=null;const f=new le("AllowMultipleToken"),p=new le("PlatformDestroyListeners"),g=new le("appBootstrapListener");class E{constructor(r,o){this.name=r,this.token=o}}function P(i,r,o=[]){const l=`Platform: ${r}`,h=new le(l);return(m=[])=>{let y=F();if(!y||y.injector.get(f,!1)){const w=[...o,...m,{provide:h,useValue:!0}];i?i(w):function C(i){if(d&&!d.get(f,!1))throw new Jt(400,!1);(function x(){!function Vp(i){md=i}(()=>{throw new Jt(600,!1)})})(),d=i;const r=i.get(N);(function T(i){i.get(tv,null)?.forEach(o=>o())})(i)}(function O(i=[],r){return hr.create({name:r,providers:[{provide:Mm,useValue:"platform"},{provide:p,useValue:new Set([()=>d=null])},...i]})}(w,l))}return function I(i){const r=F();if(!r)throw new Jt(401,!1);return r}()}}function F(){return d?.get(N)??null}let N=(()=>{class i{constructor(o){this._injector=o,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(o,l){const h=function V(i="zone.js",r){return"noop"===i?new jm:"zone.js"===i?new Dn(r):i}(l?.ngZone,function B(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:i?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:i?.runCoalescing??!1}}({eventCoalescing:l?.ngZoneEventCoalescing,runCoalescing:l?.ngZoneRunCoalescing}));return h.run(()=>{const m=function dC(i,r,o){return new q0(i,r,o)}(o.moduleType,this.injector,function at(i){return[{provide:Dn,useFactory:i},{provide:th,multi:!0,useFactory:()=>{const r=fe(K,{optional:!0});return()=>r.initialize()}},{provide:nt,useFactory:Y},{provide:cw,useFactory:xv}]}(()=>h)),y=m.injector.get(ys,null);return h.runOutsideAngular(()=>{const w=h.onError.subscribe({next:D=>{y.handleError(D)}});m.onDestroy(()=>{X(this._modules,m),w.unsubscribe()})}),function U(i,r,o){try{const l=o();return Zc(l)?l.catch(h=>{throw r.runOutsideAngular(()=>i.handleError(h)),h}):l}catch(l){throw r.runOutsideAngular(()=>i.handleError(l)),l}}(y,h,()=>{const w=m.injector.get(vx);return w.runInitializers(),w.donePromise.then(()=>(function C0(i){Fr(i,"Expected localeId to be defined"),"string"==typeof i&&(yg=i.toLowerCase().replace(/_/g,"-"))}(m.injector.get(sa,zl)||zl),this._moduleDoBootstrap(m),m))})})}bootstrapModule(o,l=[]){const h=q({},l);return function _(i,r,o){const l=new Z0(o);return Promise.resolve(l)}(0,0,o).then(m=>this.bootstrapModuleFactory(m,h))}_moduleDoBootstrap(o){const l=o.injector.get(j);if(o._bootstrapComponents.length>0)o._bootstrapComponents.forEach(h=>l.bootstrap(h));else{if(!o.instance.ngDoBootstrap)throw new Jt(-403,!1);o.instance.ngDoBootstrap(l)}this._modules.push(o)}onDestroy(o){this._destroyListeners.push(o)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Jt(404,!1);this._modules.slice().forEach(l=>l.destroy()),this._destroyListeners.forEach(l=>l());const o=this._injector.get(p,null);o&&(o.forEach(l=>l()),o.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#t=this.\u0275fac=function(l){return new(l||i)(St(hr))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"platform"})}return i})();function q(i,r){return Array.isArray(r)?r.reduce(q,i):{...i,...r}}let j=(()=>{class i{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=fe(nt),this.zoneIsStable=fe(cw),this.componentTypes=[],this.components=[],this.isStable=fe(cD).hasPendingTasks.pipe(rn(o=>o?Fe(!1):this.zoneIsStable),ks(),x_()),this._injector=fe(Gr)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(o,l){const h=o instanceof rf;if(!this._injector.get(vx).done)throw!h&&function nl(i){const r=In(i)||Ji(i)||Zi(i);return null!==r&&r.standalone}(o),new Jt(405,!1);let y;y=h?o:this._injector.get(Pa).resolveComponentFactory(o),this.componentTypes.push(y.componentType);const w=function b(i){return i.isBoundToModule}(y)?void 0:this._injector.get(jl),S=y.create(hr.NULL,[],l||y.selector,w),k=S.location.nativeElement,z=S.injector.get(t,null);return z?.registerApplication(k),S.onDestroy(()=>{this.detachView(S.hostView),X(this.components,S),z?.unregisterApplication(k)}),this._loadComponent(S),S}tick(){if(this._runningTick)throw new Jt(101,!1);try{this._runningTick=!0;for(let o of this._views)o.detectChanges()}catch(o){this.internalErrorHandler(o)}finally{this._runningTick=!1}}attachView(o){const l=o;this._views.push(l),l.attachToAppRef(this)}detachView(o){const l=o;X(this._views,l),l.detachFromAppRef()}_loadComponent(o){this.attachView(o.hostView),this.tick(),this.components.push(o);const l=this._injector.get(g,[]);l.push(...this._bootstrapListeners),l.forEach(h=>h(o))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(o=>o()),this._views.slice().forEach(o=>o.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(o){return this._destroyListeners.push(o),()=>X(this._destroyListeners,o)}destroy(){if(this._destroyed)throw new Jt(406,!1);const o=this._injector;o.destroy&&!o.destroyed&&o.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function X(i,r){const o=i.indexOf(r);o>-1&&i.splice(o,1)}const nt=new le("",{providedIn:"root",factory:()=>fe(ys).handleError.bind(void 0)});function Y(){const i=fe(Dn),r=fe(ys);return o=>i.runOutsideAngular(()=>r.handleError(o))}let K=(()=>{class i{constructor(){this.zone=fe(Dn),this.applicationRef=fe(j)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();let Ot=(()=>{class i{static#t=this.__NG_ELEMENT_ID__=Lt}return i})();function Lt(i){return function Ut(i,r,o){if(cc(i)&&!o){const l=wo(i.index,r);return new Xs(l,l)}return 47&i.type?new Xs(r[Ii],r):null}(nr(),Ft(),16==(16&i))}const Sx=P(null,"core",[]);let $l=(()=>{class i{constructor(o){}static#t=this.\u0275fac=function(l){return new(l||i)(St(j))};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({})}return i})(),MA=null;function Qg(){return MA}class cL{}const ii=new le("DocumentToken");let TA=(()=>{class i{historyGo(o){throw new Error("Not implemented")}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:function(){return fe(hL)},providedIn:"platform"})}return i})();const uL=new le("Location Initialized");let hL=(()=>{class i extends TA{constructor(){super(),this._doc=fe(ii),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Qg().getBaseHref(this._doc)}onPopState(o){const l=Qg().getGlobalEventTarget(this._doc,"window");return l.addEventListener("popstate",o,!1),()=>l.removeEventListener("popstate",o)}onHashChange(o){const l=Qg().getGlobalEventTarget(this._doc,"window");return l.addEventListener("hashchange",o,!1),()=>l.removeEventListener("hashchange",o)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(o){this._location.pathname=o}pushState(o,l,h){this._history.pushState(o,l,h)}replaceState(o,l,h){this._history.replaceState(o,l,h)}forward(){this._history.forward()}back(){this._history.back()}historyGo(o=0){this._history.go(o)}getState(){return this._history.state}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:function(){return new i},providedIn:"platform"})}return i})();function SA(i,r){if(0==i.length)return r;if(0==r.length)return i;let o=0;return i.endsWith("/")&&o++,r.startsWith("/")&&o++,2==o?i+r.substring(1):1==o?i+r:i+"/"+r}function WR(i){const r=i.match(/#|\?|$/),o=r&&r.index||i.length;return i.slice(0,o-("/"===i[o-1]?1:0))+i.slice(o)}function ru(i){return i&&"?"!==i[0]?"?"+i:i}let sp=(()=>{class i{historyGo(o){throw new Error("Not implemented")}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:function(){return fe(XR)},providedIn:"root"})}return i})();const YR=new le("appBaseHref");let XR=(()=>{class i extends sp{constructor(o,l){super(),this._platformLocation=o,this._removeListenerFns=[],this._baseHref=l??this._platformLocation.getBaseHrefFromDOM()??fe(ii).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(o){this._removeListenerFns.push(this._platformLocation.onPopState(o),this._platformLocation.onHashChange(o))}getBaseHref(){return this._baseHref}prepareExternalUrl(o){return SA(this._baseHref,o)}path(o=!1){const l=this._platformLocation.pathname+ru(this._platformLocation.search),h=this._platformLocation.hash;return h&&o?`${l}${h}`:l}pushState(o,l,h,m){const y=this.prepareExternalUrl(h+ru(m));this._platformLocation.pushState(o,l,y)}replaceState(o,l,h,m){const y=this.prepareExternalUrl(h+ru(m));this._platformLocation.replaceState(o,l,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(o=0){this._platformLocation.historyGo?.(o)}static#t=this.\u0275fac=function(l){return new(l||i)(St(TA),St(YR,8))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),dL=(()=>{class i extends sp{constructor(o,l){super(),this._platformLocation=o,this._baseHref="",this._removeListenerFns=[],null!=l&&(this._baseHref=l)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(o){this._removeListenerFns.push(this._platformLocation.onPopState(o),this._platformLocation.onHashChange(o))}getBaseHref(){return this._baseHref}path(o=!1){let l=this._platformLocation.hash;return null==l&&(l="#"),l.length>0?l.substring(1):l}prepareExternalUrl(o){const l=SA(this._baseHref,o);return l.length>0?"#"+l:l}pushState(o,l,h,m){let y=this.prepareExternalUrl(h+ru(m));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.pushState(o,l,y)}replaceState(o,l,h,m){let y=this.prepareExternalUrl(h+ru(m));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.replaceState(o,l,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(o=0){this._platformLocation.historyGo?.(o)}static#t=this.\u0275fac=function(l){return new(l||i)(St(TA),St(YR,8))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac})}return i})(),Rx=(()=>{class i{constructor(o){this._subject=new dr,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=o;const l=this._locationStrategy.getBaseHref();this._basePath=function mL(i){if(new RegExp("^(https?:)?//").test(i)){const[,o]=i.split(/\/\/[^\/]+/);return o}return i}(WR(KR(l))),this._locationStrategy.onPopState(h=>{this._subject.emit({url:this.path(!0),pop:!0,state:h.state,type:h.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(o=!1){return this.normalize(this._locationStrategy.path(o))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(o,l=""){return this.path()==this.normalize(o+ru(l))}normalize(o){return i.stripTrailingSlash(function pL(i,r){if(!i||!r.startsWith(i))return r;const o=r.substring(i.length);return""===o||["/",";","?","#"].includes(o[0])?o:r}(this._basePath,KR(o)))}prepareExternalUrl(o){return o&&"/"!==o[0]&&(o="/"+o),this._locationStrategy.prepareExternalUrl(o)}go(o,l="",h=null){this._locationStrategy.pushState(h,"",o,l),this._notifyUrlChangeListeners(this.prepareExternalUrl(o+ru(l)),h)}replaceState(o,l="",h=null){this._locationStrategy.replaceState(h,"",o,l),this._notifyUrlChangeListeners(this.prepareExternalUrl(o+ru(l)),h)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(o=0){this._locationStrategy.historyGo?.(o)}onUrlChange(o){return this._urlChangeListeners.push(o),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(l=>{this._notifyUrlChangeListeners(l.url,l.state)})),()=>{const l=this._urlChangeListeners.indexOf(o);this._urlChangeListeners.splice(l,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(o="",l){this._urlChangeListeners.forEach(h=>h(o,l))}subscribe(o,l,h){return this._subject.subscribe({next:o,error:l,complete:h})}static#t=this.normalizeQueryParams=ru;static#e=this.joinWithSlash=SA;static#n=this.stripTrailingSlash=WR;static#i=this.\u0275fac=function(l){return new(l||i)(St(sp))};static#r=this.\u0275prov=he({token:i,factory:function(){return function fL(){return new Rx(St(sp))}()},providedIn:"root"})}return i})();function KR(i){return i.replace(/\/index.html$/,"")}let dP=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({})}return i})();const fP="browser";function pP(i){return"server"===i}let kF=(()=>{class i{static#t=this.\u0275prov=he({token:i,providedIn:"root",factory:()=>new LF(St(ii),window)})}return i})();class LF{constructor(r,o){this.document=r,this.window=o,this.offset=()=>[0,0]}setOffset(r){this.offset=Array.isArray(r)?()=>r:r}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(r){this.supportsScrolling()&&this.window.scrollTo(r[0],r[1])}scrollToAnchor(r){if(!this.supportsScrolling())return;const o=function FF(i,r){const o=i.getElementById(r)||i.getElementsByName(r)[0];if(o)return o;if("function"==typeof i.createTreeWalker&&i.body&&"function"==typeof i.body.attachShadow){const l=i.createTreeWalker(i.body,NodeFilter.SHOW_ELEMENT);let h=l.currentNode;for(;h;){const m=h.shadowRoot;if(m){const y=m.getElementById(r)||m.querySelector(`[name="${r}"]`);if(y)return y}h=l.nextNode()}}return null}(this.document,r);o&&(this.scrollToElement(o),o.focus())}setHistoryScrollRestoration(r){this.supportsScrolling()&&(this.window.history.scrollRestoration=r)}scrollToElement(r){const o=r.getBoundingClientRect(),l=o.left+this.window.pageXOffset,h=o.top+this.window.pageYOffset,m=this.offset();this.window.scrollTo(l-m[0],h-m[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class sN extends cL{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class GA extends sN{static makeCurrent(){!function lL(i){MA||(MA=i)}(new GA)}onAndCancel(r,o,l){return r.addEventListener(o,l),()=>{r.removeEventListener(o,l)}}dispatchEvent(r,o){r.dispatchEvent(o)}remove(r){r.parentNode&&r.parentNode.removeChild(r)}createElement(r,o){return(o=o||this.getDefaultDocument()).createElement(r)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(r){return r.nodeType===Node.ELEMENT_NODE}isShadowRoot(r){return r instanceof DocumentFragment}getGlobalEventTarget(r,o){return"window"===o?window:"document"===o?r:"body"===o?r.body:null}getBaseHref(r){const o=function aN(){return Lx=Lx||document.querySelector("base"),Lx?Lx.getAttribute("href"):null}();return null==o?null:function lN(i){zD=zD||document.createElement("a"),zD.setAttribute("href",i);const r=zD.pathname;return"/"===r.charAt(0)?r:`/${r}`}(o)}resetBaseElement(){Lx=null}getUserAgent(){return window.navigator.userAgent}getCookie(r){return function JL(i,r){r=encodeURIComponent(r);for(const o of i.split(";")){const l=o.indexOf("="),[h,m]=-1==l?[o,""]:[o.slice(0,l),o.slice(l+1)];if(h.trim()===r)return decodeURIComponent(m)}return null}(document.cookie,r)}}let zD,Lx=null,uN=(()=>{class i{build(){return new XMLHttpRequest}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac})}return i})();const qA=new le("EventManagerPlugins");let vP=(()=>{class i{constructor(o,l){this._zone=l,this._eventNameToPlugin=new Map,o.forEach(h=>{h.manager=this}),this._plugins=o.slice().reverse()}addEventListener(o,l,h){return this._findPluginFor(l).addEventListener(o,l,h)}getZone(){return this._zone}_findPluginFor(o){let l=this._eventNameToPlugin.get(o);if(l)return l;if(l=this._plugins.find(m=>m.supports(o)),!l)throw new Jt(5101,!1);return this._eventNameToPlugin.set(o,l),l}static#t=this.\u0275fac=function(l){return new(l||i)(St(qA),St(Dn))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac})}return i})();class xP{constructor(r){this._doc=r}}const ZA="ng-app-id";let bP=(()=>{class i{constructor(o,l,h,m={}){this.doc=o,this.appId=l,this.nonce=h,this.platformId=m,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=pP(m),this.resetHostNodes()}addStyles(o){for(const l of o)1===this.changeUsageCount(l,1)&&this.onStyleAdded(l)}removeStyles(o){for(const l of o)this.changeUsageCount(l,-1)<=0&&this.onStyleRemoved(l)}ngOnDestroy(){const o=this.styleNodesInDOM;o&&(o.forEach(l=>l.remove()),o.clear());for(const l of this.getAllStyles())this.onStyleRemoved(l);this.resetHostNodes()}addHost(o){this.hostNodes.add(o);for(const l of this.getAllStyles())this.addStyleToHost(o,l)}removeHost(o){this.hostNodes.delete(o)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(o){for(const l of this.hostNodes)this.addStyleToHost(l,o)}onStyleRemoved(o){const l=this.styleRef;l.get(o)?.elements?.forEach(h=>h.remove()),l.delete(o)}collectServerRenderedStyles(){const o=this.doc.head?.querySelectorAll(`style[${ZA}="${this.appId}"]`);if(o?.length){const l=new Map;return o.forEach(h=>{null!=h.textContent&&l.set(h.textContent,h)}),l}return null}changeUsageCount(o,l){const h=this.styleRef;if(h.has(o)){const m=h.get(o);return m.usage+=l,m.usage}return h.set(o,{usage:l,elements:[]}),l}getStyleElement(o,l){const h=this.styleNodesInDOM,m=h?.get(l);if(m?.parentNode===o)return h.delete(l),m.removeAttribute(ZA),m;{const y=this.doc.createElement("style");return this.nonce&&y.setAttribute("nonce",this.nonce),y.textContent=l,this.platformIsServer&&y.setAttribute(ZA,this.appId),y}}addStyleToHost(o,l){const h=this.getStyleElement(o,l);o.appendChild(h);const m=this.styleRef,y=m.get(l)?.elements;y?y.push(h):m.set(l,{elements:[h],usage:1})}resetHostNodes(){const o=this.hostNodes;o.clear(),o.add(this.doc.head)}static#t=this.\u0275fac=function(l){return new(l||i)(St(ii),St(Am),St(_s,8),St(Cl))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac})}return i})();const WA={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},YA=/%COMP%/g,pN=new le("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function EP(i,r){return r.map(o=>o.replace(YA,i))}let CP=(()=>{class i{constructor(o,l,h,m,y,w,D,S=null){this.eventManager=o,this.sharedStylesHost=l,this.appId=h,this.removeStylesOnCompDestroy=m,this.doc=y,this.platformId=w,this.ngZone=D,this.nonce=S,this.rendererByCompId=new Map,this.platformIsServer=pP(w),this.defaultRenderer=new XA(o,y,D,this.platformIsServer)}createRenderer(o,l){if(!o||!l)return this.defaultRenderer;this.platformIsServer&&l.encapsulation===Lo.ShadowDom&&(l={...l,encapsulation:Lo.Emulated});const h=this.getOrCreateRenderer(o,l);return h instanceof MP?h.applyToHost(o):h instanceof KA&&h.applyStyles(),h}getOrCreateRenderer(o,l){const h=this.rendererByCompId;let m=h.get(l.id);if(!m){const y=this.doc,w=this.ngZone,D=this.eventManager,S=this.sharedStylesHost,k=this.removeStylesOnCompDestroy,z=this.platformIsServer;switch(l.encapsulation){case Lo.Emulated:m=new MP(D,S,l,this.appId,k,y,w,z);break;case Lo.ShadowDom:return new yN(D,S,o,l,y,w,this.nonce,z);default:m=new KA(D,S,l,k,y,w,z)}h.set(l.id,m)}return m}ngOnDestroy(){this.rendererByCompId.clear()}static#t=this.\u0275fac=function(l){return new(l||i)(St(vP),St(bP),St(Am),St(pN),St(ii),St(Cl),St(Dn),St(_s))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac})}return i})();class XA{constructor(r,o,l,h){this.eventManager=r,this.doc=o,this.ngZone=l,this.platformIsServer=h,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(r,o){return o?this.doc.createElementNS(WA[o]||o,r):this.doc.createElement(r)}createComment(r){return this.doc.createComment(r)}createText(r){return this.doc.createTextNode(r)}appendChild(r,o){(DP(r)?r.content:r).appendChild(o)}insertBefore(r,o,l){r&&(DP(r)?r.content:r).insertBefore(o,l)}removeChild(r,o){r&&r.removeChild(o)}selectRootElement(r,o){let l="string"==typeof r?this.doc.querySelector(r):r;if(!l)throw new Jt(-5104,!1);return o||(l.textContent=""),l}parentNode(r){return r.parentNode}nextSibling(r){return r.nextSibling}setAttribute(r,o,l,h){if(h){o=h+":"+o;const m=WA[h];m?r.setAttributeNS(m,o,l):r.setAttribute(o,l)}else r.setAttribute(o,l)}removeAttribute(r,o,l){if(l){const h=WA[l];h?r.removeAttributeNS(h,o):r.removeAttribute(`${l}:${o}`)}else r.removeAttribute(o)}addClass(r,o){r.classList.add(o)}removeClass(r,o){r.classList.remove(o)}setStyle(r,o,l,h){h&(Ta.DashCase|Ta.Important)?r.style.setProperty(o,l,h&Ta.Important?"important":""):r.style[o]=l}removeStyle(r,o,l){l&Ta.DashCase?r.style.removeProperty(o):r.style[o]=""}setProperty(r,o,l){r[o]=l}setValue(r,o){r.nodeValue=o}listen(r,o,l){if("string"==typeof r&&!(r=Qg().getGlobalEventTarget(this.doc,r)))throw new Error(`Unsupported event target ${r} for event ${o}`);return this.eventManager.addEventListener(r,o,this.decoratePreventDefault(l))}decoratePreventDefault(r){return o=>{if("__ngUnwrap__"===o)return r;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>r(o)):r(o))&&o.preventDefault()}}}function DP(i){return"TEMPLATE"===i.tagName&&void 0!==i.content}class yN extends XA{constructor(r,o,l,h,m,y,w,D){super(r,m,y,D),this.sharedStylesHost=o,this.hostEl=l,this.shadowRoot=l.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const S=EP(h.id,h.styles);for(const k of S){const z=document.createElement("style");w&&z.setAttribute("nonce",w),z.textContent=k,this.shadowRoot.appendChild(z)}}nodeOrShadowRoot(r){return r===this.hostEl?this.shadowRoot:r}appendChild(r,o){return super.appendChild(this.nodeOrShadowRoot(r),o)}insertBefore(r,o,l){return super.insertBefore(this.nodeOrShadowRoot(r),o,l)}removeChild(r,o){return super.removeChild(this.nodeOrShadowRoot(r),o)}parentNode(r){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(r)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class KA extends XA{constructor(r,o,l,h,m,y,w,D){super(r,m,y,w),this.sharedStylesHost=o,this.removeStylesOnCompDestroy=h,this.styles=D?EP(D,l.styles):l.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class MP extends KA{constructor(r,o,l,h,m,y,w,D){const S=h+"-"+l.id;super(r,o,l,m,y,w,D,S),this.contentAttr=function mN(i){return"_ngcontent-%COMP%".replace(YA,i)}(S),this.hostAttr=function gN(i){return"_nghost-%COMP%".replace(YA,i)}(S)}applyToHost(r){this.applyStyles(),this.setAttribute(r,this.hostAttr,"")}createElement(r,o){const l=super.createElement(r,o);return super.setAttribute(l,this.contentAttr,""),l}}let vN=(()=>{class i extends xP{constructor(o){super(o)}supports(o){return!0}addEventListener(o,l,h){return o.addEventListener(l,h,!1),()=>this.removeEventListener(o,l,h)}removeEventListener(o,l,h){return o.removeEventListener(l,h)}static#t=this.\u0275fac=function(l){return new(l||i)(St(ii))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac})}return i})();const TP=["alt","control","meta","shift"],xN={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},bN={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey};let wN=(()=>{class i extends xP{constructor(o){super(o)}supports(o){return null!=i.parseEventName(o)}addEventListener(o,l,h){const m=i.parseEventName(l),y=i.eventCallback(m.fullKey,h,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Qg().onAndCancel(o,m.domEventName,y))}static parseEventName(o){const l=o.toLowerCase().split("."),h=l.shift();if(0===l.length||"keydown"!==h&&"keyup"!==h)return null;const m=i._normalizeKey(l.pop());let y="",w=l.indexOf("code");if(w>-1&&(l.splice(w,1),y="code."),TP.forEach(S=>{const k=l.indexOf(S);k>-1&&(l.splice(k,1),y+=S+".")}),y+=m,0!=l.length||0===m.length)return null;const D={};return D.domEventName=h,D.fullKey=y,D}static matchEventFullKeyCode(o,l){let h=xN[o.key]||o.key,m="";return l.indexOf("code.")>-1&&(h=o.code,m="code."),!(null==h||!h)&&(h=h.toLowerCase()," "===h?h="space":"."===h&&(h="dot"),TP.forEach(y=>{y!==h&&(0,bN[y])(o)&&(m+=y+".")}),m+=h,m===l)}static eventCallback(o,l,h){return m=>{i.matchEventFullKeyCode(m,o)&&h.runGuarded(()=>l(m))}}static _normalizeKey(o){return"esc"===o?"escape":o}static#t=this.\u0275fac=function(l){return new(l||i)(St(ii))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac})}return i})();const MN=P(Sx,"browser",[{provide:Cl,useValue:fP},{provide:tv,useValue:function EN(){GA.makeCurrent()},multi:!0},{provide:ii,useFactory:function DN(){return function Qu(i){Ly=i}(document),document},deps:[]}]),TN=new le(""),AP=[{provide:n,useClass:class cN{addToWindow(r){Ke.getAngularTestability=(l,h=!0)=>{const m=r.findTestabilityInTree(l,h);if(null==m)throw new Jt(5103,!1);return m},Ke.getAllAngularTestabilities=()=>r.getAllTestabilities(),Ke.getAllAngularRootElements=()=>r.getAllRootElements(),Ke.frameworkStabilizers||(Ke.frameworkStabilizers=[]),Ke.frameworkStabilizers.push(l=>{const h=Ke.getAllAngularTestabilities();let m=h.length,y=!1;const w=function(D){y=y||D,m--,0==m&&l(y)};h.forEach(D=>{D.whenStable(w)})})}findTestabilityInTree(r,o,l){return null==o?null:r.getTestability(o)??(l?Qg().isShadowRoot(o)?this.findTestabilityInTree(r,o.host,!0):this.findTestabilityInTree(r,o.parentElement,!0):null)}},deps:[]},{provide:t,useClass:s,deps:[Dn,a,n]},{provide:s,useClass:s,deps:[Dn,a,n]}],RP=[{provide:Mm,useValue:"root"},{provide:ys,useFactory:function CN(){return new ys},deps:[]},{provide:qA,useClass:vN,multi:!0,deps:[ii,Dn,Cl]},{provide:qA,useClass:wN,multi:!0,deps:[ii]},CP,bP,vP,{provide:iw,useExisting:CP},{provide:class NF{},useClass:uN,deps:[]},[]];let SN=(()=>{class i{constructor(o){}static withServerTransition(o){return{ngModule:i,providers:[{provide:Am,useValue:o.appId}]}}static#t=this.\u0275fac=function(l){return new(l||i)(St(TN,12))};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({providers:[...RP,...AP],imports:[dP,$l]})}return i})(),PP=(()=>{class i{constructor(o){this._doc=o}getTitle(){return this._doc.title}setTitle(o){this._doc.title=o||""}static#t=this.\u0275fac=function(l){return new(l||i)(St(ii))};static#e=this.\u0275prov=he({token:i,factory:function(l){let h=null;return h=l?new l:function AN(){return new PP(St(ii))}(),h},providedIn:"root"})}return i})();function FP(i,r=0){return function LN(i){return!isNaN(parseFloat(i))&&!isNaN(Number(i))}(i)?Number(i):r}function BD(i){return Array.isArray(i)?i:[i]}function pr(i){return null==i?"":"string"==typeof i?i:`${i}px`}function t_(i){return i instanceof qr?i.nativeElement:i}typeof window<"u"&&window;const{isArray:FN}=Array;function NP(i){return Yn(r=>function NN(i,r){return FN(r)?i(...r):i(r)}(i,r))}const zN=["addListener","removeListener"],BN=["addEventListener","removeEventListener"],jN=["on","off"];function JA(i,r,o,l){if(Pn(o)&&(l=o,o=void 0),l)return JA(i,r,o).pipe(NP(l));const[h,m]=function $N(i){return Pn(i.addEventListener)&&Pn(i.removeEventListener)}(i)?BN.map(y=>w=>i[y](r,w,o)):function VN(i){return Pn(i.addListener)&&Pn(i.removeListener)}(i)?zN.map(zP(i,r)):function UN(i){return Pn(i.on)&&Pn(i.off)}(i)?jN.map(zP(i,r)):[];if(!h&&It(i))return Ti(y=>JA(y,r,o))(pn(i));if(!h)throw new TypeError("Invalid event target");return new jn(y=>{const w=(...D)=>y.next(1<D.length?D:D[0]);return h(w),()=>m(w)})}function zP(i,r){return o=>l=>i[o](r,l)}class HN extends st{constructor(r,o){super()}schedule(r,o=0){return this}}const jD={setInterval(i,r,...o){const{delegate:l}=jD;return l?.setInterval?l.setInterval(i,r,...o):setInterval(i,r,...o)},clearInterval(i){const{delegate:r}=jD;return(r?.clearInterval||clearInterval)(i)},delegate:void 0};class t2 extends HN{constructor(r,o){super(r,o),this.scheduler=r,this.work=o,this.pending=!1}schedule(r,o=0){var l;if(this.closed)return this;this.state=r;const h=this.id,m=this.scheduler;return null!=h&&(this.id=this.recycleAsyncId(m,h,o)),this.pending=!0,this.delay=o,this.id=null!==(l=this.id)&&void 0!==l?l:this.requestAsyncId(m,this.id,o),this}requestAsyncId(r,o,l=0){return jD.setInterval(r.flush.bind(r,this),l)}recycleAsyncId(r,o,l=0){if(null!=l&&this.delay===l&&!1===this.pending)return o;null!=o&&jD.clearInterval(o)}execute(r,o){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const l=this._execute(r,o);if(l)return l;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(r,o){let h,l=!1;try{this.work(r)}catch(m){l=!0,h=m||new Error("Scheduled action threw falsy error")}if(l)return this.unsubscribe(),h}unsubscribe(){if(!this.closed){const{id:r,scheduler:o}=this,{actions:l}=o;this.work=this.state=this.scheduler=null,this.pending=!1,te(l,this),null!=r&&(this.id=this.recycleAsyncId(o,r,null)),this.delay=null,super.unsubscribe()}}}const Fx={schedule(i){let r=requestAnimationFrame,o=cancelAnimationFrame;const{delegate:l}=Fx;l&&(r=l.requestAnimationFrame,o=l.cancelAnimationFrame);const h=r(m=>{o=void 0,i(m)});return new st(()=>o?.(h))},requestAnimationFrame(...i){const{delegate:r}=Fx;return(r?.requestAnimationFrame||requestAnimationFrame)(...i)},cancelAnimationFrame(...i){const{delegate:r}=Fx;return(r?.cancelAnimationFrame||cancelAnimationFrame)(...i)},delegate:void 0},BP={now:()=>(BP.delegate||Date).now(),delegate:void 0};class Nx{constructor(r,o=Nx.now){this.schedulerActionCtor=r,this.now=o}schedule(r,o=0,l){return new this.schedulerActionCtor(this,r).schedule(l,o)}}Nx.now=BP.now;class e2 extends Nx{constructor(r,o=Nx.now){super(r,o),this.actions=[],this._active=!1}flush(r){const{actions:o}=this;if(this._active)return void o.push(r);let l;this._active=!0;do{if(l=r.execute(r.state,r.delay))break}while(r=o.shift());if(this._active=!1,l){for(;r=o.shift();)r.unsubscribe();throw l}}}new class qN extends e2{flush(r){this._active=!0;const o=this._scheduled;this._scheduled=void 0;const{actions:l}=this;let h;r=r||l.shift();do{if(h=r.execute(r.state,r.delay))break}while((r=l[0])&&r.id===o&&l.shift());if(this._active=!1,h){for(;(r=l[0])&&r.id===o&&l.shift();)r.unsubscribe();throw h}}}(class GN extends t2{constructor(r,o){super(r,o),this.scheduler=r,this.work=o}requestAsyncId(r,o,l=0){return null!==l&&l>0?super.requestAsyncId(r,o,l):(r.actions.push(this),r._scheduled||(r._scheduled=Fx.requestAnimationFrame(()=>r.flush(void 0))))}recycleAsyncId(r,o,l=0){var h;if(null!=l?l>0:this.delay>0)return super.recycleAsyncId(r,o,l);const{actions:m}=r;null!=o&&(null===(h=m[m.length-1])||void 0===h?void 0:h.id)!==o&&(Fx.cancelAnimationFrame(o),r._scheduled=void 0)}});let n2,WN=1;const VD={};function jP(i){return i in VD&&(delete VD[i],!0)}const YN={setImmediate(i){const r=WN++;return VD[r]=!0,n2||(n2=Promise.resolve()),n2.then(()=>jP(r)&&i()),r},clearImmediate(i){jP(i)}},{setImmediate:XN,clearImmediate:KN}=YN,UD={setImmediate(...i){const{delegate:r}=UD;return(r?.setImmediate||XN)(...i)},clearImmediate(i){const{delegate:r}=UD;return(r?.clearImmediate||KN)(i)},delegate:void 0},r2=(new class JN extends e2{flush(r){this._active=!0;const o=this._scheduled;this._scheduled=void 0;const{actions:l}=this;let h;r=r||l.shift();do{if(h=r.execute(r.state,r.delay))break}while((r=l[0])&&r.id===o&&l.shift());if(this._active=!1,h){for(;(r=l[0])&&r.id===o&&l.shift();)r.unsubscribe();throw h}}}(class QN extends t2{constructor(r,o){super(r,o),this.scheduler=r,this.work=o}requestAsyncId(r,o,l=0){return null!==l&&l>0?super.requestAsyncId(r,o,l):(r.actions.push(this),r._scheduled||(r._scheduled=UD.setImmediate(r.flush.bind(r,void 0))))}recycleAsyncId(r,o,l=0){var h;if(null!=l?l>0:this.delay>0)return super.recycleAsyncId(r,o,l);const{actions:m}=r;null!=o&&(null===(h=m[m.length-1])||void 0===h?void 0:h.id)!==o&&(UD.clearImmediate(o),r._scheduled===o&&(r._scheduled=void 0))}}),new e2(t2)),ez=r2;function VP(i=0,r,o=ez){let l=-1;return null!=r&&(a1(r)?o=r:l=r),new jn(h=>{let m=function iz(i){return i instanceof Date&&!isNaN(i)}(i)?+i-o.now():i;m<0&&(m=0);let y=0;return o.schedule(function(){h.closed||(h.next(y++),0<=l?this.schedule(void 0,l):h.complete())},m)})}function UP(i,r=r2){return function nz(i){return Di((r,o)=>{let l=!1,h=null,m=null,y=!1;const w=()=>{if(m?.unsubscribe(),m=null,l){l=!1;const S=h;h=null,o.next(S)}y&&o.complete()},D=()=>{m=null,y&&o.complete()};r.subscribe(hi(o,S=>{l=!0,h=S,m||pn(i(S)).subscribe(m=hi(o,w,D))},()=>{y=!0,(!l||!m||m.closed)&&o.complete()}))})}(()=>VP(i,r))}function Po(i,r){return Di((o,l)=>{let h=0;o.subscribe(hi(l,m=>i.call(r,m,h++)&&l.next(m)))})}let o2;try{o2=typeof Intl<"u"&&Intl.v8BreakIterator}catch{o2=!1}let zx,ap,s2,Gl=(()=>{class i{constructor(o){this._platformId=o,this.isBrowser=this._platformId?function OF(i){return i===fP}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!o2)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static#t=this.\u0275fac=function(l){return new(l||i)(St(Cl))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function $D(i){return function rz(){if(null==zx&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>zx=!0}))}finally{zx=zx||!1}return zx}()?i:!!i.capture}function oz(){if(null==ap){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return ap=!1,ap;if("scrollBehavior"in document.documentElement.style)ap=!0;else{const i=Element.prototype.scrollTo;ap=!!i&&!/\{\s*\[native code\]\s*\}/.test(i.toString())}}return ap}function a2(){let i=typeof document<"u"&&document?document.activeElement:null;for(;i&&i.shadowRoot;){const r=i.shadowRoot.activeElement;if(r===i)break;i=r}return i}function $h(i){return i.composedPath?i.composedPath()[0]:i.target}function l2(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}const lz=new le("cdk-dir-doc",{providedIn:"root",factory:function cz(){return fe(ii)}}),uz=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let c2=(()=>{class i{constructor(o){this.value="ltr",this.change=new dr,o&&(this.value=function hz(i){const r=i?.toLowerCase()||"";return"auto"===r&&typeof navigator<"u"&&navigator?.language?uz.test(navigator.language)?"rtl":"ltr":"rtl"===r?"rtl":"ltr"}((o.body?o.body.dir:null)||(o.documentElement?o.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static#t=this.\u0275fac=function(l){return new(l||i)(St(lz,8))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Bx=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({})}return i})(),fz=(()=>{class i{constructor(o,l,h){this._ngZone=o,this._platform=l,this._scrolled=new kn,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=h}register(o){this.scrollContainers.has(o)||this.scrollContainers.set(o,o.elementScrolled().subscribe(()=>this._scrolled.next(o)))}deregister(o){const l=this.scrollContainers.get(o);l&&(l.unsubscribe(),this.scrollContainers.delete(o))}scrolled(o=20){return this._platform.isBrowser?new jn(l=>{this._globalSubscription||this._addGlobalListener();const h=o>0?this._scrolled.pipe(UP(o)).subscribe(l):this._scrolled.subscribe(l);return this._scrolledCount++,()=>{h.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Fe()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((o,l)=>this.deregister(l)),this._scrolled.complete()}ancestorScrolled(o,l){const h=this.getAncestorScrollContainers(o);return this.scrolled(l).pipe(Po(m=>!m||h.indexOf(m)>-1))}getAncestorScrollContainers(o){const l=[];return this.scrollContainers.forEach((h,m)=>{this._scrollableContainsElement(m,o)&&l.push(m)}),l}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(o,l){let h=t_(l),m=o.getElementRef().nativeElement;do{if(h==m)return!0}while(h=h.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>JA(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static#t=this.\u0275fac=function(l){return new(l||i)(St(Dn),St(Gl),St(ii,8))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),HP=(()=>{class i{constructor(o,l,h){this._platform=o,this._change=new kn,this._changeListener=m=>{this._change.next(m)},this._document=h,l.runOutsideAngular(()=>{if(o.isBrowser){const m=this._getWindow();m.addEventListener("resize",this._changeListener),m.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const o=this._getWindow();o.removeEventListener("resize",this._changeListener),o.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const o={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),o}getViewportRect(){const o=this.getViewportScrollPosition(),{width:l,height:h}=this.getViewportSize();return{top:o.top,left:o.left,bottom:o.top+h,right:o.left+l,height:h,width:l}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const o=this._document,l=this._getWindow(),h=o.documentElement,m=h.getBoundingClientRect();return{top:-m.top||o.body.scrollTop||l.scrollY||h.scrollTop||0,left:-m.left||o.body.scrollLeft||l.scrollX||h.scrollLeft||0}}change(o=20){return o>0?this._change.pipe(UP(o)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const o=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:o.innerWidth,height:o.innerHeight}:{width:0,height:0}}static#t=this.\u0275fac=function(l){return new(l||i)(St(Gl),St(Dn),St(ii,8))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),GP=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({})}return i})(),qP=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({imports:[Bx,GP,Bx,GP]})}return i})();function ua(i){return i<=0?()=>ts:Di((r,o)=>{let l=0;r.subscribe(hi(o,h=>{++l<=i&&(o.next(h),i<=l&&o.complete())}))})}function GD(i){return Di((r,o)=>{pn(i).subscribe(hi(o,()=>o.complete(),Wl)),!o.closed&&r.subscribe(o)})}class u2{attach(r){return this._attachedHost=r,r.attach(this)}detach(){let r=this._attachedHost;null!=r&&(this._attachedHost=null,r.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(r){this._attachedHost=r}}class h2 extends u2{constructor(r,o,l,h,m){super(),this.component=r,this.viewContainerRef=o,this.injector=l,this.componentFactoryResolver=h,this.projectableNodes=m}}class ZP extends u2{constructor(r,o,l,h){super(),this.templateRef=r,this.viewContainerRef=o,this.context=l,this.injector=h}get origin(){return this.templateRef.elementRef}attach(r,o=this.context){return this.context=o,super.attach(r)}detach(){return this.context=void 0,super.detach()}}class mz extends u2{constructor(r){super(),this.element=r instanceof qr?r.nativeElement:r}}class d2{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(r){return r instanceof h2?(this._attachedPortal=r,this.attachComponentPortal(r)):r instanceof ZP?(this._attachedPortal=r,this.attachTemplatePortal(r)):this.attachDomPortal&&r instanceof mz?(this._attachedPortal=r,this.attachDomPortal(r)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(r){this._disposeFn=r}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class gz extends d2{constructor(r,o,l,h,m){super(),this.outletElement=r,this._componentFactoryResolver=o,this._appRef=l,this._defaultInjector=h,this.attachDomPortal=y=>{const w=y.element,D=this._document.createComment("dom-portal");w.parentNode.insertBefore(D,w),this.outletElement.appendChild(w),this._attachedPortal=y,super.setDisposeFn(()=>{D.parentNode&&D.parentNode.replaceChild(w,D)})},this._document=m}attachComponentPortal(r){const l=(r.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(r.component);let h;return r.viewContainerRef?(h=r.viewContainerRef.createComponent(l,r.viewContainerRef.length,r.injector||r.viewContainerRef.injector,r.projectableNodes||void 0),this.setDisposeFn(()=>h.destroy())):(h=l.create(r.injector||this._defaultInjector||hr.NULL),this._appRef.attachView(h.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(h.hostView),h.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(h)),this._attachedPortal=r,h}attachTemplatePortal(r){let o=r.viewContainerRef,l=o.createEmbeddedView(r.templateRef,r.context,{injector:r.injector});return l.rootNodes.forEach(h=>this.outletElement.appendChild(h)),l.detectChanges(),this.setDisposeFn(()=>{let h=o.indexOf(l);-1!==h&&o.remove(h)}),this._attachedPortal=r,l}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(r){return r.hostView.rootNodes[0]}}let f2=(()=>{class i extends d2{constructor(o,l,h){super(),this._componentFactoryResolver=o,this._viewContainerRef=l,this._isInitialized=!1,this.attached=new dr,this.attachDomPortal=m=>{const y=m.element,w=this._document.createComment("dom-portal");m.setAttachedHost(this),y.parentNode.insertBefore(w,y),this._getRootNode().appendChild(y),this._attachedPortal=m,super.setDisposeFn(()=>{w.parentNode&&w.parentNode.replaceChild(y,w)})},this._document=h}get portal(){return this._attachedPortal}set portal(o){this.hasAttached()&&!o&&!this._isInitialized||(this.hasAttached()&&super.detach(),o&&super.attach(o),this._attachedPortal=o||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(o){o.setAttachedHost(this);const l=null!=o.viewContainerRef?o.viewContainerRef:this._viewContainerRef,m=(o.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(o.component),y=l.createComponent(m,l.length,o.injector||l.injector,o.projectableNodes||void 0);return l!==this._viewContainerRef&&this._getRootNode().appendChild(y.hostView.rootNodes[0]),super.setDisposeFn(()=>y.destroy()),this._attachedPortal=o,this._attachedRef=y,this.attached.emit(y),y}attachTemplatePortal(o){o.setAttachedHost(this);const l=this._viewContainerRef.createEmbeddedView(o.templateRef,o.context,{injector:o.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=o,this._attachedRef=l,this.attached.emit(l),l}_getRootNode(){const o=this._viewContainerRef.element.nativeElement;return o.nodeType===o.ELEMENT_NODE?o:o.parentNode}static#t=this.\u0275fac=function(l){return new(l||i)(re(Pa),re(Io),re(ii))};static#e=this.\u0275dir=Ui({type:i,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[_h]})}return i})(),qD=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({})}return i})();const WP=oz();class _z{constructor(r,o){this._viewportRuler=r,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=o}attach(){}enable(){if(this._canBeEnabled()){const r=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=r.style.left||"",this._previousHTMLStyles.top=r.style.top||"",r.style.left=pr(-this._previousScrollPosition.left),r.style.top=pr(-this._previousScrollPosition.top),r.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const r=this._document.documentElement,l=r.style,h=this._document.body.style,m=l.scrollBehavior||"",y=h.scrollBehavior||"";this._isEnabled=!1,l.left=this._previousHTMLStyles.left,l.top=this._previousHTMLStyles.top,r.classList.remove("cdk-global-scrollblock"),WP&&(l.scrollBehavior=h.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),WP&&(l.scrollBehavior=m,h.scrollBehavior=y)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const o=this._document.body,l=this._viewportRuler.getViewportSize();return o.scrollHeight>l.height||o.scrollWidth>l.width}}class yz{constructor(r,o,l,h){this._scrollDispatcher=r,this._ngZone=o,this._viewportRuler=l,this._config=h,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(r){this._overlayRef=r}enable(){if(this._scrollSubscription)return;const r=this._scrollDispatcher.scrolled(0).pipe(Po(o=>!o||!this._overlayRef.overlayElement.contains(o.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=r.subscribe(()=>{const o=this._viewportRuler.getViewportScrollPosition().top;Math.abs(o-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=r.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class YP{enable(){}disable(){}attach(){}}function p2(i,r){return r.some(o=>i.bottom<o.top||i.top>o.bottom||i.right<o.left||i.left>o.right)}function XP(i,r){return r.some(o=>i.top<o.top||i.bottom>o.bottom||i.left<o.left||i.right>o.right)}class vz{constructor(r,o,l,h){this._scrollDispatcher=r,this._viewportRuler=o,this._ngZone=l,this._config=h,this._scrollSubscription=null}attach(r){this._overlayRef=r}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const o=this._overlayRef.overlayElement.getBoundingClientRect(),{width:l,height:h}=this._viewportRuler.getViewportSize();p2(o,[{width:l,height:h,bottom:h,right:l,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let xz=(()=>{class i{constructor(o,l,h,m){this._scrollDispatcher=o,this._viewportRuler=l,this._ngZone=h,this.noop=()=>new YP,this.close=y=>new yz(this._scrollDispatcher,this._ngZone,this._viewportRuler,y),this.block=()=>new _z(this._viewportRuler,this._document),this.reposition=y=>new vz(this._scrollDispatcher,this._viewportRuler,this._ngZone,y),this._document=m}static#t=this.\u0275fac=function(l){return new(l||i)(St(fz),St(HP),St(Dn),St(ii))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();class KP{constructor(r){if(this.scrollStrategy=new YP,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,r){const o=Object.keys(r);for(const l of o)void 0!==r[l]&&(this[l]=r[l])}}}class bz{constructor(r,o){this.connectionPair=r,this.scrollableViewProperties=o}}let QP=(()=>{class i{constructor(o){this._attachedOverlays=[],this._document=o}ngOnDestroy(){this.detach()}add(o){this.remove(o),this._attachedOverlays.push(o)}remove(o){const l=this._attachedOverlays.indexOf(o);l>-1&&this._attachedOverlays.splice(l,1),0===this._attachedOverlays.length&&this.detach()}static#t=this.\u0275fac=function(l){return new(l||i)(St(ii))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),wz=(()=>{class i extends QP{constructor(o,l){super(o),this._ngZone=l,this._keydownListener=h=>{const m=this._attachedOverlays;for(let y=m.length-1;y>-1;y--)if(m[y]._keydownEvents.observers.length>0){const w=m[y]._keydownEvents;this._ngZone?this._ngZone.run(()=>w.next(h)):w.next(h);break}}}add(o){super.add(o),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}static#t=this.\u0275fac=function(l){return new(l||i)(St(ii),St(Dn,8))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Ez=(()=>{class i extends QP{constructor(o,l,h){super(o),this._platform=l,this._ngZone=h,this._cursorStyleIsSet=!1,this._pointerDownListener=m=>{this._pointerDownEventTarget=$h(m)},this._clickListener=m=>{const y=$h(m),w="click"===m.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:y;this._pointerDownEventTarget=null;const D=this._attachedOverlays.slice();for(let S=D.length-1;S>-1;S--){const k=D[S];if(k._outsidePointerEvents.observers.length<1||!k.hasAttached())continue;if(k.overlayElement.contains(y)||k.overlayElement.contains(w))break;const z=k._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>z.next(m)):z.next(m)}}}add(o){if(super.add(o),!this._isAttached){const l=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(l)):this._addEventListeners(l),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=l.style.cursor,l.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const o=this._document.body;o.removeEventListener("pointerdown",this._pointerDownListener,!0),o.removeEventListener("click",this._clickListener,!0),o.removeEventListener("auxclick",this._clickListener,!0),o.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(o.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(o){o.addEventListener("pointerdown",this._pointerDownListener,!0),o.addEventListener("click",this._clickListener,!0),o.addEventListener("auxclick",this._clickListener,!0),o.addEventListener("contextmenu",this._clickListener,!0)}static#t=this.\u0275fac=function(l){return new(l||i)(St(ii),St(Gl),St(Dn,8))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),ZD=(()=>{class i{constructor(o,l){this._platform=l,this._document=o}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const o="cdk-overlay-container";if(this._platform.isBrowser||l2()){const h=this._document.querySelectorAll(`.${o}[platform="server"], .${o}[platform="test"]`);for(let m=0;m<h.length;m++)h[m].remove()}const l=this._document.createElement("div");l.classList.add(o),l2()?l.setAttribute("platform","test"):this._platform.isBrowser||l.setAttribute("platform","server"),this._document.body.appendChild(l),this._containerElement=l}static#t=this.\u0275fac=function(l){return new(l||i)(St(ii),St(Gl))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();class jx{constructor(r,o,l,h,m,y,w,D,S,k=!1){this._portalOutlet=r,this._host=o,this._pane=l,this._config=h,this._ngZone=m,this._keyboardDispatcher=y,this._document=w,this._location=D,this._outsideClickDispatcher=S,this._animationsDisabled=k,this._backdropElement=null,this._backdropClick=new kn,this._attachments=new kn,this._detachments=new kn,this._locationChanges=st.EMPTY,this._backdropClickHandler=z=>this._backdropClick.next(z),this._backdropTransitionendHandler=z=>{this._disposeBackdrop(z.target)},this._keydownEvents=new kn,this._outsidePointerEvents=new kn,h.scrollStrategy&&(this._scrollStrategy=h.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=h.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(r){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const o=this._portalOutlet.attach(r);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(ua(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof o?.onDestroy&&o.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),o}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const r=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),r}dispose(){const r=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,r&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(r){r!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=r,this.hasAttached()&&(r.attach(this),this.updatePosition()))}updateSize(r){this._config={...this._config,...r},this._updateElementSize()}setDirection(r){this._config={...this._config,direction:r},this._updateElementDirection()}addPanelClass(r){this._pane&&this._toggleClasses(this._pane,r,!0)}removePanelClass(r){this._pane&&this._toggleClasses(this._pane,r,!1)}getDirection(){const r=this._config.direction;return r?"string"==typeof r?r:r.value:"ltr"}updateScrollStrategy(r){r!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=r,this.hasAttached()&&(r.attach(this),r.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const r=this._pane.style;r.width=pr(this._config.width),r.height=pr(this._config.height),r.minWidth=pr(this._config.minWidth),r.minHeight=pr(this._config.minHeight),r.maxWidth=pr(this._config.maxWidth),r.maxHeight=pr(this._config.maxHeight)}_togglePointerEvents(r){this._pane.style.pointerEvents=r?"":"none"}_attachBackdrop(){const r="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(r)})}):this._backdropElement.classList.add(r)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const r=this._backdropElement;if(r){if(this._animationsDisabled)return void this._disposeBackdrop(r);r.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{r.addEventListener("transitionend",this._backdropTransitionendHandler)}),r.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(r)},500))}}_toggleClasses(r,o,l){const h=BD(o||[]).filter(m=>!!m);h.length&&(l?r.classList.add(...h):r.classList.remove(...h))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const r=this._ngZone.onStable.pipe(GD(Yh(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),r.unsubscribe())})})}_disposeScrollStrategy(){const r=this._scrollStrategy;r&&(r.disable(),r.detach&&r.detach())}_disposeBackdrop(r){r&&(r.removeEventListener("click",this._backdropClickHandler),r.removeEventListener("transitionend",this._backdropTransitionendHandler),r.remove(),this._backdropElement===r&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const JP="cdk-overlay-connected-position-bounding-box",Cz=/([A-Za-z%]+)$/;class Dz{get positions(){return this._preferredPositions}constructor(r,o,l,h,m){this._viewportRuler=o,this._document=l,this._platform=h,this._overlayContainer=m,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new kn,this._resizeSubscription=st.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(r)}attach(r){this._validatePositions(),r.hostElement.classList.add(JP),this._overlayRef=r,this._boundingBox=r.hostElement,this._pane=r.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const r=this._originRect,o=this._overlayRect,l=this._viewportRect,h=this._containerRect,m=[];let y;for(let w of this._preferredPositions){let D=this._getOriginPoint(r,h,w),S=this._getOverlayPoint(D,o,w),k=this._getOverlayFit(S,o,l,w);if(k.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(w,D);this._canFitWithFlexibleDimensions(k,S,l)?m.push({position:w,origin:D,overlayRect:o,boundingBoxRect:this._calculateBoundingBoxRect(D,w)}):(!y||y.overlayFit.visibleArea<k.visibleArea)&&(y={overlayFit:k,overlayPoint:S,originPoint:D,position:w,overlayRect:o})}if(m.length){let w=null,D=-1;for(const S of m){const k=S.boundingBoxRect.width*S.boundingBoxRect.height*(S.position.weight||1);k>D&&(D=k,w=S)}return this._isPushed=!1,void this._applyPosition(w.position,w.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(y.position,y.originPoint);this._applyPosition(y.position,y.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&lp(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(JP),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const r=this._lastPosition;if(r){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const o=this._getOriginPoint(this._originRect,this._containerRect,r);this._applyPosition(r,o)}else this.apply()}withScrollableContainers(r){return this._scrollables=r,this}withPositions(r){return this._preferredPositions=r,-1===r.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(r){return this._viewportMargin=r,this}withFlexibleDimensions(r=!0){return this._hasFlexibleDimensions=r,this}withGrowAfterOpen(r=!0){return this._growAfterOpen=r,this}withPush(r=!0){return this._canPush=r,this}withLockedPosition(r=!0){return this._positionLocked=r,this}setOrigin(r){return this._origin=r,this}withDefaultOffsetX(r){return this._offsetX=r,this}withDefaultOffsetY(r){return this._offsetY=r,this}withTransformOriginOn(r){return this._transformOriginSelector=r,this}_getOriginPoint(r,o,l){let h,m;if("center"==l.originX)h=r.left+r.width/2;else{const y=this._isRtl()?r.right:r.left,w=this._isRtl()?r.left:r.right;h="start"==l.originX?y:w}return o.left<0&&(h-=o.left),m="center"==l.originY?r.top+r.height/2:"top"==l.originY?r.top:r.bottom,o.top<0&&(m-=o.top),{x:h,y:m}}_getOverlayPoint(r,o,l){let h,m;return h="center"==l.overlayX?-o.width/2:"start"===l.overlayX?this._isRtl()?-o.width:0:this._isRtl()?0:-o.width,m="center"==l.overlayY?-o.height/2:"top"==l.overlayY?0:-o.height,{x:r.x+h,y:r.y+m}}_getOverlayFit(r,o,l,h){const m=eO(o);let{x:y,y:w}=r,D=this._getOffset(h,"x"),S=this._getOffset(h,"y");D&&(y+=D),S&&(w+=S);let H=0-w,J=w+m.height-l.height,ct=this._subtractOverflows(m.width,0-y,y+m.width-l.width),mt=this._subtractOverflows(m.height,H,J),Pt=ct*mt;return{visibleArea:Pt,isCompletelyWithinViewport:m.width*m.height===Pt,fitsInViewportVertically:mt===m.height,fitsInViewportHorizontally:ct==m.width}}_canFitWithFlexibleDimensions(r,o,l){if(this._hasFlexibleDimensions){const h=l.bottom-o.y,m=l.right-o.x,y=tO(this._overlayRef.getConfig().minHeight),w=tO(this._overlayRef.getConfig().minWidth);return(r.fitsInViewportVertically||null!=y&&y<=h)&&(r.fitsInViewportHorizontally||null!=w&&w<=m)}return!1}_pushOverlayOnScreen(r,o,l){if(this._previousPushAmount&&this._positionLocked)return{x:r.x+this._previousPushAmount.x,y:r.y+this._previousPushAmount.y};const h=eO(o),m=this._viewportRect,y=Math.max(r.x+h.width-m.width,0),w=Math.max(r.y+h.height-m.height,0),D=Math.max(m.top-l.top-r.y,0),S=Math.max(m.left-l.left-r.x,0);let k=0,z=0;return k=h.width<=m.width?S||-y:r.x<this._viewportMargin?m.left-l.left-r.x:0,z=h.height<=m.height?D||-w:r.y<this._viewportMargin?m.top-l.top-r.y:0,this._previousPushAmount={x:k,y:z},{x:r.x+k,y:r.y+z}}_applyPosition(r,o){if(this._setTransformOrigin(r),this._setOverlayElementStyles(o,r),this._setBoundingBoxStyles(o,r),r.panelClass&&this._addPanelClasses(r.panelClass),this._lastPosition=r,this._positionChanges.observers.length){const l=this._getScrollVisibility(),h=new bz(r,l);this._positionChanges.next(h)}this._isInitialRender=!1}_setTransformOrigin(r){if(!this._transformOriginSelector)return;const o=this._boundingBox.querySelectorAll(this._transformOriginSelector);let l,h=r.overlayY;l="center"===r.overlayX?"center":this._isRtl()?"start"===r.overlayX?"right":"left":"start"===r.overlayX?"left":"right";for(let m=0;m<o.length;m++)o[m].style.transformOrigin=`${l} ${h}`}_calculateBoundingBoxRect(r,o){const l=this._viewportRect,h=this._isRtl();let m,y,w,k,z,H;if("top"===o.overlayY)y=r.y,m=l.height-y+this._viewportMargin;else if("bottom"===o.overlayY)w=l.height-r.y+2*this._viewportMargin,m=l.height-w+this._viewportMargin;else{const J=Math.min(l.bottom-r.y+l.top,r.y),ct=this._lastBoundingBoxSize.height;m=2*J,y=r.y-J,m>ct&&!this._isInitialRender&&!this._growAfterOpen&&(y=r.y-ct/2)}if("end"===o.overlayX&&!h||"start"===o.overlayX&&h)H=l.width-r.x+this._viewportMargin,k=r.x-this._viewportMargin;else if("start"===o.overlayX&&!h||"end"===o.overlayX&&h)z=r.x,k=l.right-r.x;else{const J=Math.min(l.right-r.x+l.left,r.x),ct=this._lastBoundingBoxSize.width;k=2*J,z=r.x-J,k>ct&&!this._isInitialRender&&!this._growAfterOpen&&(z=r.x-ct/2)}return{top:y,left:z,bottom:w,right:H,width:k,height:m}}_setBoundingBoxStyles(r,o){const l=this._calculateBoundingBoxRect(r,o);!this._isInitialRender&&!this._growAfterOpen&&(l.height=Math.min(l.height,this._lastBoundingBoxSize.height),l.width=Math.min(l.width,this._lastBoundingBoxSize.width));const h={};if(this._hasExactPosition())h.top=h.left="0",h.bottom=h.right=h.maxHeight=h.maxWidth="",h.width=h.height="100%";else{const m=this._overlayRef.getConfig().maxHeight,y=this._overlayRef.getConfig().maxWidth;h.height=pr(l.height),h.top=pr(l.top),h.bottom=pr(l.bottom),h.width=pr(l.width),h.left=pr(l.left),h.right=pr(l.right),h.alignItems="center"===o.overlayX?"center":"end"===o.overlayX?"flex-end":"flex-start",h.justifyContent="center"===o.overlayY?"center":"bottom"===o.overlayY?"flex-end":"flex-start",m&&(h.maxHeight=pr(m)),y&&(h.maxWidth=pr(y))}this._lastBoundingBoxSize=l,lp(this._boundingBox.style,h)}_resetBoundingBoxStyles(){lp(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){lp(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(r,o){const l={},h=this._hasExactPosition(),m=this._hasFlexibleDimensions,y=this._overlayRef.getConfig();if(h){const k=this._viewportRuler.getViewportScrollPosition();lp(l,this._getExactOverlayY(o,r,k)),lp(l,this._getExactOverlayX(o,r,k))}else l.position="static";let w="",D=this._getOffset(o,"x"),S=this._getOffset(o,"y");D&&(w+=`translateX(${D}px) `),S&&(w+=`translateY(${S}px)`),l.transform=w.trim(),y.maxHeight&&(h?l.maxHeight=pr(y.maxHeight):m&&(l.maxHeight="")),y.maxWidth&&(h?l.maxWidth=pr(y.maxWidth):m&&(l.maxWidth="")),lp(this._pane.style,l)}_getExactOverlayY(r,o,l){let h={top:"",bottom:""},m=this._getOverlayPoint(o,this._overlayRect,r);return this._isPushed&&(m=this._pushOverlayOnScreen(m,this._overlayRect,l)),"bottom"===r.overlayY?h.bottom=this._document.documentElement.clientHeight-(m.y+this._overlayRect.height)+"px":h.top=pr(m.y),h}_getExactOverlayX(r,o,l){let y,h={left:"",right:""},m=this._getOverlayPoint(o,this._overlayRect,r);return this._isPushed&&(m=this._pushOverlayOnScreen(m,this._overlayRect,l)),y=this._isRtl()?"end"===r.overlayX?"left":"right":"end"===r.overlayX?"right":"left","right"===y?h.right=this._document.documentElement.clientWidth-(m.x+this._overlayRect.width)+"px":h.left=pr(m.x),h}_getScrollVisibility(){const r=this._getOriginRect(),o=this._pane.getBoundingClientRect(),l=this._scrollables.map(h=>h.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:XP(r,l),isOriginOutsideView:p2(r,l),isOverlayClipped:XP(o,l),isOverlayOutsideView:p2(o,l)}}_subtractOverflows(r,...o){return o.reduce((l,h)=>l-Math.max(h,0),r)}_getNarrowedViewportRect(){const r=this._document.documentElement.clientWidth,o=this._document.documentElement.clientHeight,l=this._viewportRuler.getViewportScrollPosition();return{top:l.top+this._viewportMargin,left:l.left+this._viewportMargin,right:l.left+r-this._viewportMargin,bottom:l.top+o-this._viewportMargin,width:r-2*this._viewportMargin,height:o-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(r,o){return"x"===o?null==r.offsetX?this._offsetX:r.offsetX:null==r.offsetY?this._offsetY:r.offsetY}_validatePositions(){}_addPanelClasses(r){this._pane&&BD(r).forEach(o=>{""!==o&&-1===this._appliedPanelClasses.indexOf(o)&&(this._appliedPanelClasses.push(o),this._pane.classList.add(o))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(r=>{this._pane.classList.remove(r)}),this._appliedPanelClasses=[])}_getOriginRect(){const r=this._origin;if(r instanceof qr)return r.nativeElement.getBoundingClientRect();if(r instanceof Element)return r.getBoundingClientRect();const o=r.width||0,l=r.height||0;return{top:r.y,bottom:r.y+l,left:r.x,right:r.x+o,height:l,width:o}}}function lp(i,r){for(let o in r)r.hasOwnProperty(o)&&(i[o]=r[o]);return i}function tO(i){if("number"!=typeof i&&null!=i){const[r,o]=i.split(Cz);return o&&"px"!==o?null:parseFloat(r)}return i||null}function eO(i){return{top:Math.floor(i.top),right:Math.floor(i.right),bottom:Math.floor(i.bottom),left:Math.floor(i.left),width:Math.floor(i.width),height:Math.floor(i.height)}}const nO="cdk-global-overlay-wrapper";class Mz{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(r){const o=r.getConfig();this._overlayRef=r,this._width&&!o.width&&r.updateSize({width:this._width}),this._height&&!o.height&&r.updateSize({height:this._height}),r.hostElement.classList.add(nO),this._isDisposed=!1}top(r=""){return this._bottomOffset="",this._topOffset=r,this._alignItems="flex-start",this}left(r=""){return this._xOffset=r,this._xPosition="left",this}bottom(r=""){return this._topOffset="",this._bottomOffset=r,this._alignItems="flex-end",this}right(r=""){return this._xOffset=r,this._xPosition="right",this}start(r=""){return this._xOffset=r,this._xPosition="start",this}end(r=""){return this._xOffset=r,this._xPosition="end",this}width(r=""){return this._overlayRef?this._overlayRef.updateSize({width:r}):this._width=r,this}height(r=""){return this._overlayRef?this._overlayRef.updateSize({height:r}):this._height=r,this}centerHorizontally(r=""){return this.left(r),this._xPosition="center",this}centerVertically(r=""){return this.top(r),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const r=this._overlayRef.overlayElement.style,o=this._overlayRef.hostElement.style,l=this._overlayRef.getConfig(),{width:h,height:m,maxWidth:y,maxHeight:w}=l,D=!("100%"!==h&&"100vw"!==h||y&&"100%"!==y&&"100vw"!==y),S=!("100%"!==m&&"100vh"!==m||w&&"100%"!==w&&"100vh"!==w),k=this._xPosition,z=this._xOffset,H="rtl"===this._overlayRef.getConfig().direction;let J="",ct="",mt="";D?mt="flex-start":"center"===k?(mt="center",H?ct=z:J=z):H?"left"===k||"end"===k?(mt="flex-end",J=z):("right"===k||"start"===k)&&(mt="flex-start",ct=z):"left"===k||"start"===k?(mt="flex-start",J=z):("right"===k||"end"===k)&&(mt="flex-end",ct=z),r.position=this._cssPosition,r.marginLeft=D?"0":J,r.marginTop=S?"0":this._topOffset,r.marginBottom=this._bottomOffset,r.marginRight=D?"0":ct,o.justifyContent=mt,o.alignItems=S?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const r=this._overlayRef.overlayElement.style,o=this._overlayRef.hostElement,l=o.style;o.classList.remove(nO),l.justifyContent=l.alignItems=r.marginTop=r.marginBottom=r.marginLeft=r.marginRight=r.position="",this._overlayRef=null,this._isDisposed=!0}}let Tz=(()=>{class i{constructor(o,l,h,m){this._viewportRuler=o,this._document=l,this._platform=h,this._overlayContainer=m}global(){return new Mz}flexibleConnectedTo(o){return new Dz(o,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static#t=this.\u0275fac=function(l){return new(l||i)(St(HP),St(ii),St(Gl),St(ZD))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Sz=0,n_=(()=>{class i{constructor(o,l,h,m,y,w,D,S,k,z,H,J){this.scrollStrategies=o,this._overlayContainer=l,this._componentFactoryResolver=h,this._positionBuilder=m,this._keyboardDispatcher=y,this._injector=w,this._ngZone=D,this._document=S,this._directionality=k,this._location=z,this._outsideClickDispatcher=H,this._animationsModuleType=J}create(o){const l=this._createHostElement(),h=this._createPaneElement(l),m=this._createPortalOutlet(h),y=new KP(o);return y.direction=y.direction||this._directionality.value,new jx(m,l,h,y,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(o){const l=this._document.createElement("div");return l.id="cdk-overlay-"+Sz++,l.classList.add("cdk-overlay-pane"),o.appendChild(l),l}_createHostElement(){const o=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(o),o}_createPortalOutlet(o){return this._appRef||(this._appRef=this._injector.get(j)),new gz(o,this._componentFactoryResolver,this._appRef,this._injector,this._document)}static#t=this.\u0275fac=function(l){return new(l||i)(St(xz),St(ZD),St(Pa),St(Tz),St(wz),St(hr),St(Dn),St(ii),St(c2),St(Rx),St(Ez),St(Jd,8))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();const Rz={provide:new le("cdk-connected-overlay-scroll-strategy"),deps:[n_],useFactory:function Az(i){return()=>i.scrollStrategies.reposition()}};let iO=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({providers:[n_,Rz],imports:[Bx,qD,qP,qP]})}return i})();function oO(i,...r){return r.length?r.some(o=>i[o]):i.altKey||i.shiftKey||i.ctrlKey||i.metaKey}function sO(i){return Po((r,o)=>i<=o)}let Nz=(()=>{class i{create(o){return typeof MutationObserver>"u"?null:new MutationObserver(o)}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),zz=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({providers:[Nz]})}return i})();const{isArray:Bz}=Array,{getPrototypeOf:jz,prototype:Vz,keys:Uz}=Object;function WD(...i){const r=Qa(i),o=function wM(i){return Pn(_p(i))?i.pop():void 0}(i),{args:l,keys:h}=function $z(i){if(1===i.length){const r=i[0];if(Bz(r))return{args:r,keys:null};if(function Hz(i){return i&&"object"==typeof i&&jz(i)===Vz}(r)){const o=Uz(r);return{args:o.map(l=>r[l]),keys:o}}}return{args:i,keys:null}}(i);if(0===l.length)return Gi([],r);const m=new jn(function qz(i,r,o=Rs){return l=>{aO(r,()=>{const{length:h}=i,m=new Array(h);let y=h,w=h;for(let D=0;D<h;D++)aO(r,()=>{const S=Gi(i[D],r);let k=!1;S.subscribe(hi(l,z=>{m[D]=z,k||(k=!0,w--),w||l.next(o(m.slice()))},()=>{--y||l.complete()}))},l)},l)}}(l,r,h?y=>function Gz(i,r){return i.reduce((o,l,h)=>(o[l]=r[h],o),{})}(h,y):Rs));return o?m.pipe(NP(o)):m}function aO(i,r,o){i?eo(o,i,r):r()}function YD(...i){return function Zz(){return Ka(1)}()(Gi(i,Qa(i)))}function XD(...i){const r=Qa(i);return Di((o,l)=>{(r?YD(i,o,r):YD(i,o)).subscribe(l)})}const lO=new Set;let cp,Yz=(()=>{class i{constructor(o,l){this._platform=o,this._nonce=l,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):Kz}matchMedia(o){return(this._platform.WEBKIT||this._platform.BLINK)&&function Xz(i,r){if(!lO.has(i))try{cp||(cp=document.createElement("style"),r&&(cp.nonce=r),cp.setAttribute("type","text/css"),document.head.appendChild(cp)),cp.sheet&&(cp.sheet.insertRule(`@media ${i} {body{ }}`,0),lO.add(i))}catch(o){console.error(o)}}(o,this._nonce),this._matchMedia(o)}static#t=this.\u0275fac=function(l){return new(l||i)(St(Gl),St(_s,8))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function Kz(i){return{matches:"all"===i||""===i,media:i,addListener:()=>{},removeListener:()=>{}}}let Qz=(()=>{class i{constructor(o,l){this._mediaMatcher=o,this._zone=l,this._queries=new Map,this._destroySubject=new kn}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(o){return cO(BD(o)).some(h=>this._registerQuery(h).mql.matches)}observe(o){let m=WD(cO(BD(o)).map(y=>this._registerQuery(y).observable));return m=YD(m.pipe(ua(1)),m.pipe(sO(1),function Wz(i,r=r2){return Di((o,l)=>{let h=null,m=null,y=null;const w=()=>{if(h){h.unsubscribe(),h=null;const S=m;m=null,l.next(S)}};function D(){const S=y+i,k=r.now();if(k<S)return h=this.schedule(void 0,S-k),void l.add(h);w()}o.subscribe(hi(l,S=>{m=S,y=r.now(),h||(h=r.schedule(D,i),l.add(h))},()=>{w(),l.complete()},void 0,()=>{m=h=null}))})}(0))),m.pipe(Yn(y=>{const w={matches:!1,breakpoints:{}};return y.forEach(({matches:D,query:S})=>{w.matches=w.matches||D,w.breakpoints[S]=D}),w}))}_registerQuery(o){if(this._queries.has(o))return this._queries.get(o);const l=this._mediaMatcher.matchMedia(o),m={observable:new jn(y=>{const w=D=>this._zone.run(()=>y.next(D));return l.addListener(w),()=>{l.removeListener(w)}}).pipe(XD(l),Yn(({matches:y})=>({query:o,matches:y})),GD(this._destroySubject)),mql:l};return this._queries.set(o,m),m}static#t=this.\u0275fac=function(l){return new(l||i)(St(Yz),St(Dn))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function cO(i){return i.map(r=>r.split(",")).reduce((r,o)=>r.concat(o)).map(r=>r.trim())}let KD=(()=>{class i{constructor(o){this._platform=o}isDisabled(o){return o.hasAttribute("disabled")}isVisible(o){return function n3(i){return!!(i.offsetWidth||i.offsetHeight||"function"==typeof i.getClientRects&&i.getClientRects().length)}(o)&&"visible"===getComputedStyle(o).visibility}isTabbable(o){if(!this._platform.isBrowser)return!1;const l=function e3(i){try{return i.frameElement}catch{return null}}(function h3(i){return i.ownerDocument&&i.ownerDocument.defaultView||window}(o));if(l&&(-1===fO(l)||!this.isVisible(l)))return!1;let h=o.nodeName.toLowerCase(),m=fO(o);return o.hasAttribute("contenteditable")?-1!==m:!("iframe"===h||"object"===h||this._platform.WEBKIT&&this._platform.IOS&&!function c3(i){let r=i.nodeName.toLowerCase(),o="input"===r&&i.type;return"text"===o||"password"===o||"select"===r||"textarea"===r}(o))&&("audio"===h?!!o.hasAttribute("controls")&&-1!==m:"video"===h?-1!==m&&(null!==m||this._platform.FIREFOX||o.hasAttribute("controls")):o.tabIndex>=0)}isFocusable(o,l){return function u3(i){return!function o3(i){return function a3(i){return"input"==i.nodeName.toLowerCase()}(i)&&"hidden"==i.type}(i)&&(function r3(i){let r=i.nodeName.toLowerCase();return"input"===r||"select"===r||"button"===r||"textarea"===r}(i)||function s3(i){return function l3(i){return"a"==i.nodeName.toLowerCase()}(i)&&i.hasAttribute("href")}(i)||i.hasAttribute("contenteditable")||dO(i))}(o)&&!this.isDisabled(o)&&(l?.ignoreVisibility||this.isVisible(o))}static#t=this.\u0275fac=function(l){return new(l||i)(St(Gl))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function dO(i){if(!i.hasAttribute("tabindex")||void 0===i.tabIndex)return!1;let r=i.getAttribute("tabindex");return!(!r||isNaN(parseInt(r,10)))}function fO(i){if(!dO(i))return null;const r=parseInt(i.getAttribute("tabindex")||"",10);return isNaN(r)?-1:r}class d3{get enabled(){return this._enabled}set enabled(r){this._enabled=r,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(r,this._startAnchor),this._toggleAnchorTabIndex(r,this._endAnchor))}constructor(r,o,l,h,m=!1){this._element=r,this._checker=o,this._ngZone=l,this._document=h,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,m||this.attachAnchors()}destroy(){const r=this._startAnchor,o=this._endAnchor;r&&(r.removeEventListener("focus",this.startAnchorListener),r.remove()),o&&(o.removeEventListener("focus",this.endAnchorListener),o.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(r){return new Promise(o=>{this._executeOnStable(()=>o(this.focusInitialElement(r)))})}focusFirstTabbableElementWhenReady(r){return new Promise(o=>{this._executeOnStable(()=>o(this.focusFirstTabbableElement(r)))})}focusLastTabbableElementWhenReady(r){return new Promise(o=>{this._executeOnStable(()=>o(this.focusLastTabbableElement(r)))})}_getRegionBoundary(r){const o=this._element.querySelectorAll(`[cdk-focus-region-${r}], [cdkFocusRegion${r}], [cdk-focus-${r}]`);return"start"==r?o.length?o[0]:this._getFirstTabbableElement(this._element):o.length?o[o.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(r){const o=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(o){if(!this._checker.isFocusable(o)){const l=this._getFirstTabbableElement(o);return l?.focus(r),!!l}return o.focus(r),!0}return this.focusFirstTabbableElement(r)}focusFirstTabbableElement(r){const o=this._getRegionBoundary("start");return o&&o.focus(r),!!o}focusLastTabbableElement(r){const o=this._getRegionBoundary("end");return o&&o.focus(r),!!o}hasAttached(){return this._hasAttached}_getFirstTabbableElement(r){if(this._checker.isFocusable(r)&&this._checker.isTabbable(r))return r;const o=r.children;for(let l=0;l<o.length;l++){const h=o[l].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(o[l]):null;if(h)return h}return null}_getLastTabbableElement(r){if(this._checker.isFocusable(r)&&this._checker.isTabbable(r))return r;const o=r.children;for(let l=o.length-1;l>=0;l--){const h=o[l].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(o[l]):null;if(h)return h}return null}_createAnchor(){const r=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,r),r.classList.add("cdk-visually-hidden"),r.classList.add("cdk-focus-trap-anchor"),r.setAttribute("aria-hidden","true"),r}_toggleAnchorTabIndex(r,o){r?o.setAttribute("tabindex","0"):o.removeAttribute("tabindex")}toggleAnchors(r){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(r,this._startAnchor),this._toggleAnchorTabIndex(r,this._endAnchor))}_executeOnStable(r){this._ngZone.isStable?r():this._ngZone.onStable.pipe(ua(1)).subscribe(r)}}let m2=(()=>{class i{constructor(o,l,h){this._checker=o,this._ngZone=l,this._document=h}create(o,l=!1){return new d3(o,this._checker,this._ngZone,this._document,l)}static#t=this.\u0275fac=function(l){return new(l||i)(St(KD),St(Dn),St(ii))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function pO(i){return 0===i.buttons||0===i.detail}function mO(i){const r=i.touches&&i.touches[0]||i.changedTouches&&i.changedTouches[0];return!(!r||-1!==r.identifier||null!=r.radiusX&&1!==r.radiusX||null!=r.radiusY&&1!==r.radiusY)}const f3=new le("cdk-input-modality-detector-options"),p3={ignoreKeys:[18,17,224,91,16]},i_=$D({passive:!0,capture:!0});let m3=(()=>{class i{get mostRecentModality(){return this._modality.value}constructor(o,l,h,m){this._platform=o,this._mostRecentTarget=null,this._modality=new Er(null),this._lastTouchMs=0,this._onKeydown=y=>{this._options?.ignoreKeys?.some(w=>w===y.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=$h(y))},this._onMousedown=y=>{Date.now()-this._lastTouchMs<650||(this._modality.next(pO(y)?"keyboard":"mouse"),this._mostRecentTarget=$h(y))},this._onTouchstart=y=>{mO(y)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=$h(y))},this._options={...p3,...m},this.modalityDetected=this._modality.pipe(sO(1)),this.modalityChanged=this.modalityDetected.pipe(ks()),o.isBrowser&&l.runOutsideAngular(()=>{h.addEventListener("keydown",this._onKeydown,i_),h.addEventListener("mousedown",this._onMousedown,i_),h.addEventListener("touchstart",this._onTouchstart,i_)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,i_),document.removeEventListener("mousedown",this._onMousedown,i_),document.removeEventListener("touchstart",this._onTouchstart,i_))}static#t=this.\u0275fac=function(l){return new(l||i)(St(Gl),St(Dn),St(ii),St(f3,8))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();const _3=new le("cdk-focus-monitor-default-options"),QD=$D({passive:!0,capture:!0});let g2=(()=>{class i{constructor(o,l,h,m,y){this._ngZone=o,this._platform=l,this._inputModalityDetector=h,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new kn,this._rootNodeFocusAndBlurListener=w=>{for(let S=$h(w);S;S=S.parentElement)"focus"===w.type?this._onFocus(w,S):this._onBlur(w,S)},this._document=m,this._detectionMode=y?.detectionMode||0}monitor(o,l=!1){const h=t_(o);if(!this._platform.isBrowser||1!==h.nodeType)return Fe();const m=function az(i){if(function sz(){if(null==s2){const i=typeof document<"u"?document.head:null;s2=!(!i||!i.createShadowRoot&&!i.attachShadow)}return s2}()){const r=i.getRootNode?i.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&r instanceof ShadowRoot)return r}return null}(h)||this._getDocument(),y=this._elementInfo.get(h);if(y)return l&&(y.checkChildren=!0),y.subject;const w={checkChildren:l,subject:new kn,rootNode:m};return this._elementInfo.set(h,w),this._registerGlobalListeners(w),w.subject}stopMonitoring(o){const l=t_(o),h=this._elementInfo.get(l);h&&(h.subject.complete(),this._setClasses(l),this._elementInfo.delete(l),this._removeGlobalListeners(h))}focusVia(o,l,h){const m=t_(o);m===this._getDocument().activeElement?this._getClosestElementsInfo(m).forEach(([w,D])=>this._originChanged(w,l,D)):(this._setOrigin(l),"function"==typeof m.focus&&m.focus(h))}ngOnDestroy(){this._elementInfo.forEach((o,l)=>this.stopMonitoring(l))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(o){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(o)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:o&&this._isLastInteractionFromInputLabel(o)?"mouse":"program"}_shouldBeAttributedToTouch(o){return 1===this._detectionMode||!!o?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(o,l){o.classList.toggle("cdk-focused",!!l),o.classList.toggle("cdk-touch-focused","touch"===l),o.classList.toggle("cdk-keyboard-focused","keyboard"===l),o.classList.toggle("cdk-mouse-focused","mouse"===l),o.classList.toggle("cdk-program-focused","program"===l)}_setOrigin(o,l=!1){this._ngZone.runOutsideAngular(()=>{this._origin=o,this._originFromTouchInteraction="touch"===o&&l,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(o,l){const h=this._elementInfo.get(l),m=$h(o);!h||!h.checkChildren&&l!==m||this._originChanged(l,this._getFocusOrigin(m),h)}_onBlur(o,l){const h=this._elementInfo.get(l);!h||h.checkChildren&&o.relatedTarget instanceof Node&&l.contains(o.relatedTarget)||(this._setClasses(l),this._emitOrigin(h,null))}_emitOrigin(o,l){o.subject.observers.length&&this._ngZone.run(()=>o.subject.next(l))}_registerGlobalListeners(o){if(!this._platform.isBrowser)return;const l=o.rootNode,h=this._rootNodeFocusListenerCount.get(l)||0;h||this._ngZone.runOutsideAngular(()=>{l.addEventListener("focus",this._rootNodeFocusAndBlurListener,QD),l.addEventListener("blur",this._rootNodeFocusAndBlurListener,QD)}),this._rootNodeFocusListenerCount.set(l,h+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(GD(this._stopInputModalityDetector)).subscribe(m=>{this._setOrigin(m,!0)}))}_removeGlobalListeners(o){const l=o.rootNode;if(this._rootNodeFocusListenerCount.has(l)){const h=this._rootNodeFocusListenerCount.get(l);h>1?this._rootNodeFocusListenerCount.set(l,h-1):(l.removeEventListener("focus",this._rootNodeFocusAndBlurListener,QD),l.removeEventListener("blur",this._rootNodeFocusAndBlurListener,QD),this._rootNodeFocusListenerCount.delete(l))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(o,l,h){this._setClasses(o,l),this._emitOrigin(h,l),this._lastFocusOrigin=l}_getClosestElementsInfo(o){const l=[];return this._elementInfo.forEach((h,m)=>{(m===o||h.checkChildren&&m.contains(o))&&l.push([m,h])}),l}_isLastInteractionFromInputLabel(o){const{_mostRecentTarget:l,mostRecentModality:h}=this._inputModalityDetector;if("mouse"!==h||!l||l===o||"INPUT"!==o.nodeName&&"TEXTAREA"!==o.nodeName||o.disabled)return!1;const m=o.labels;if(m)for(let y=0;y<m.length;y++)if(m[y].contains(l))return!0;return!1}static#t=this.\u0275fac=function(l){return new(l||i)(St(Dn),St(Gl),St(m3),St(ii,8),St(_3,8))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();const _O="cdk-high-contrast-black-on-white",yO="cdk-high-contrast-white-on-black",_2="cdk-high-contrast-active";let vO=(()=>{class i{constructor(o,l){this._platform=o,this._document=l,this._breakpointSubscription=fe(Qz).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const o=this._document.createElement("div");o.style.backgroundColor="rgb(1,2,3)",o.style.position="absolute",this._document.body.appendChild(o);const l=this._document.defaultView||window,h=l&&l.getComputedStyle?l.getComputedStyle(o):null,m=(h&&h.backgroundColor||"").replace(/ /g,"");switch(o.remove(),m){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const o=this._document.body.classList;o.remove(_2,_O,yO),this._hasCheckedHighContrastMode=!0;const l=this.getHighContrastMode();1===l?o.add(_2,_O):2===l&&o.add(_2,yO)}}static#t=this.\u0275fac=function(l){return new(l||i)(St(Gl),St(ii))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),y3=(()=>{class i{constructor(o){o._applyBodyHighContrastModeCssClasses()}static#t=this.\u0275fac=function(l){return new(l||i)(St(vO))};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({imports:[zz]})}return i})();function JD(i){return new jn(r=>{pn(i()).subscribe(r)})}function v3(i,r){}class tM{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}}let xO=(()=>{class i extends d2{constructor(o,l,h,m,y,w,D,S){super(),this._elementRef=o,this._focusTrapFactory=l,this._config=m,this._interactivityChecker=y,this._ngZone=w,this._overlayRef=D,this._focusMonitor=S,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this.attachDomPortal=k=>{this._portalOutlet.hasAttached();const z=this._portalOutlet.attachDomPortal(k);return this._contentAttached(),z},this._document=h,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(o){this._portalOutlet.hasAttached();const l=this._portalOutlet.attachComponentPortal(o);return this._contentAttached(),l}attachTemplatePortal(o){this._portalOutlet.hasAttached();const l=this._portalOutlet.attachTemplatePortal(o);return this._contentAttached(),l}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(o,l){this._interactivityChecker.isFocusable(o)||(o.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const h=()=>{o.removeEventListener("blur",h),o.removeEventListener("mousedown",h),o.removeAttribute("tabindex")};o.addEventListener("blur",h),o.addEventListener("mousedown",h)})),o.focus(l)}_focusByCssSelector(o,l){let h=this._elementRef.nativeElement.querySelector(o);h&&this._forceFocus(h,l)}_trapFocus(){const o=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||o.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(l=>{l||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const o=this._config.restoreFocus;let l=null;if("string"==typeof o?l=this._document.querySelector(o):"boolean"==typeof o?l=o?this._elementFocusedBeforeDialogWasOpened:null:o&&(l=o),this._config.restoreFocus&&l&&"function"==typeof l.focus){const h=a2(),m=this._elementRef.nativeElement;(!h||h===this._document.body||h===m||m.contains(h))&&(this._focusMonitor?(this._focusMonitor.focusVia(l,this._closeInteractionType),this._closeInteractionType=null):l.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const o=this._elementRef.nativeElement,l=a2();return o===l||o.contains(l)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=a2())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}static#t=this.\u0275fac=function(l){return new(l||i)(re(qr),re(m2),re(ii,8),re(tM),re(KD),re(Dn),re(jx),re(g2))};static#e=this.\u0275cmp=Ni({type:i,selectors:[["cdk-dialog-container"]],viewQuery:function(l,h){if(1&l&&Xf(f2,7),2&l){let m;Bg(m=function cx(){return function Vl(i,r){return i[Bs].queries[r].queryList}(Ft(),Bu())}())&&(h._portalOutlet=m.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(l,h){2&l&&$c("id",h._config.id||null)("role",h._config.role)("aria-modal",h._config.ariaModal)("aria-labelledby",h._config.ariaLabel?null:h._ariaLabelledByQueue[0])("aria-label",h._config.ariaLabel)("aria-describedby",h._config.ariaDescribedBy||null)},features:[_h],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(l,h){1&l&&wf(0,v3,0,0,"ng-template",0)},dependencies:[f2],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2})}return i})();class y2{constructor(r,o){this.overlayRef=r,this.config=o,this.closed=new kn,this.disableClose=o.disableClose,this.backdropClick=r.backdropClick(),this.keydownEvents=r.keydownEvents(),this.outsidePointerEvents=r.outsidePointerEvents(),this.id=o.id,this.keydownEvents.subscribe(l=>{27===l.keyCode&&!this.disableClose&&!oO(l)&&(l.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=r.detachments().subscribe(()=>{!1!==o.closeOnOverlayDetachments&&this.close()})}close(r,o){if(this.containerInstance){const l=this.closed;this.containerInstance._closeInteractionType=o?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),l.next(r),l.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(r="",o=""){return this.overlayRef.updateSize({width:r,height:o}),this}addPanelClass(r){return this.overlayRef.addPanelClass(r),this}removePanelClass(r){return this.overlayRef.removePanelClass(r),this}}const bO=new le("DialogScrollStrategy"),x3=new le("DialogData"),b3=new le("DefaultDialogConfig"),E3={provide:bO,deps:[n_],useFactory:function w3(i){return()=>i.scrollStrategies.block()}};let C3=0,wO=(()=>{class i{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(o,l,h,m,y,w){this._overlay=o,this._injector=l,this._defaultOptions=h,this._parentDialog=m,this._overlayContainer=y,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new kn,this._afterOpenedAtThisLevel=new kn,this._ariaHiddenElements=new Map,this.afterAllClosed=JD(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(XD(void 0))),this._scrollStrategy=w}open(o,l){(l={...this._defaultOptions||new tM,...l}).id=l.id||"cdk-dialog-"+C3++,l.id&&this.getDialogById(l.id);const m=this._getOverlayConfig(l),y=this._overlay.create(m),w=new y2(y,l),D=this._attachContainer(y,w,l);return w.containerInstance=D,this._attachDialogContent(o,w,D,l),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(w),w.closed.subscribe(()=>this._removeOpenDialog(w,!0)),this.afterOpened.next(w),w}closeAll(){v2(this.openDialogs,o=>o.close())}getDialogById(o){return this.openDialogs.find(l=>l.id===o)}ngOnDestroy(){v2(this._openDialogsAtThisLevel,o=>{!1===o.config.closeOnDestroy&&this._removeOpenDialog(o,!1)}),v2(this._openDialogsAtThisLevel,o=>o.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(o){const l=new KP({positionStrategy:o.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:o.scrollStrategy||this._scrollStrategy(),panelClass:o.panelClass,hasBackdrop:o.hasBackdrop,direction:o.direction,minWidth:o.minWidth,minHeight:o.minHeight,maxWidth:o.maxWidth,maxHeight:o.maxHeight,width:o.width,height:o.height,disposeOnNavigation:o.closeOnNavigation});return o.backdropClass&&(l.backdropClass=o.backdropClass),l}_attachContainer(o,l,h){const m=h.injector||h.viewContainerRef?.injector,y=[{provide:tM,useValue:h},{provide:y2,useValue:l},{provide:jx,useValue:o}];let w;h.container?"function"==typeof h.container?w=h.container:(w=h.container.type,y.push(...h.container.providers(h))):w=xO;const D=new h2(w,h.viewContainerRef,hr.create({parent:m||this._injector,providers:y}),h.componentFactoryResolver);return o.attach(D).instance}_attachDialogContent(o,l,h,m){if(o instanceof ra){const y=this._createInjector(m,l,h,void 0);let w={$implicit:m.data,dialogRef:l};m.templateContext&&(w={...w,..."function"==typeof m.templateContext?m.templateContext():m.templateContext}),h.attachTemplatePortal(new ZP(o,null,w,y))}else{const y=this._createInjector(m,l,h,this._injector),w=h.attachComponentPortal(new h2(o,m.viewContainerRef,y,m.componentFactoryResolver));l.componentRef=w,l.componentInstance=w.instance}}_createInjector(o,l,h,m){const y=o.injector||o.viewContainerRef?.injector,w=[{provide:x3,useValue:o.data},{provide:y2,useValue:l}];return o.providers&&("function"==typeof o.providers?w.push(...o.providers(l,o,h)):w.push(...o.providers)),o.direction&&(!y||!y.get(c2,null,{optional:!0}))&&w.push({provide:c2,useValue:{value:o.direction,change:Fe()}}),hr.create({parent:y||m,providers:w})}_removeOpenDialog(o,l){const h=this.openDialogs.indexOf(o);h>-1&&(this.openDialogs.splice(h,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((m,y)=>{m?y.setAttribute("aria-hidden",m):y.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),l&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const o=this._overlayContainer.getContainerElement();if(o.parentElement){const l=o.parentElement.children;for(let h=l.length-1;h>-1;h--){const m=l[h];m!==o&&"SCRIPT"!==m.nodeName&&"STYLE"!==m.nodeName&&!m.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(m,m.getAttribute("aria-hidden")),m.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const o=this._parentDialog;return o?o._getAfterAllClosed():this._afterAllClosedAtThisLevel}static#t=this.\u0275fac=function(l){return new(l||i)(St(n_),St(hr),St(b3,8),St(i,12),St(ZD),St(bO))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac})}return i})();function v2(i,r){let o=i.length;for(;o--;)r(i[o])}let D3=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({providers:[wO,E3],imports:[iO,qD,y3,qD]})}return i})();const T3=new le("mat-sanity-checks",{providedIn:"root",factory:function M3(){return!0}});let DO=(()=>{class i{constructor(o,l,h){this._sanityChecks=l,this._document=h,this._hasDoneGlobalChecks=!1,o._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(o){return!l2()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[o])}static#t=this.\u0275fac=function(l){return new(l||i)(St(vO),St(T3,8),St(ii))};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({imports:[Bx,Bx]})}return i})();const MO=$D({passive:!0,capture:!0});class A3{constructor(){this._events=new Map,this._delegateEventHandler=r=>{const o=$h(r);o&&this._events.get(r.type)?.forEach((l,h)=>{(h===o||h.contains(o))&&l.forEach(m=>m.handleEvent(r))})}}addHandler(r,o,l,h){const m=this._events.get(o);if(m){const y=m.get(l);y?y.add(h):m.set(l,new Set([h]))}else this._events.set(o,new Map([[l,new Set([h])]])),r.runOutsideAngular(()=>{document.addEventListener(o,this._delegateEventHandler,MO)})}removeHandler(r,o,l){const h=this._events.get(r);if(!h)return;const m=h.get(o);m&&(m.delete(l),0===m.size&&h.delete(o),0===h.size&&(this._events.delete(r),document.removeEventListener(r,this._delegateEventHandler,MO)))}}class x2{static#t=this._eventManager=new A3;constructor(r,o,l,h){this._target=r,this._ngZone=o,this._platform=h,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,h.isBrowser&&(this._containerElement=t_(l))}fadeInRipple(r,o,l={}){const h=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),m={...TO,...l.animation},y=l.radius||function P3(i,r,o){const l=Math.max(Math.abs(i-o.left),Math.abs(i-o.right)),h=Math.max(Math.abs(r-o.top),Math.abs(r-o.bottom));return Math.sqrt(l*l+h*h)}(r,o,h),w=r-h.left,D=o-h.top,S=m.enterDuration,k=document.createElement("div");k.classList.add("mat-ripple-element"),k.style.left=w-y+"px",k.style.top=D-y+"px",k.style.height=2*y+"px",k.style.width=2*y+"px",null!=l.color&&(k.style.backgroundColor=l.color),k.style.transitionDuration=`${S}ms`,this._containerElement.appendChild(k);const z=window.getComputedStyle(k),J=z.transitionDuration,ct="none"===z.transitionProperty||"0s"===J||"0s, 0s"===J||0===h.width&&0===h.height,mt=new I3(this,k,l,ct);k.style.transform="scale3d(1, 1, 1)",mt.state=0,l.persistent||(this._mostRecentTransientRipple=mt);return!ct&&(S||m.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const Wt=()=>this._finishRippleTransition(mt),Et=()=>this._destroyRipple(mt);k.addEventListener("transitionend",Wt),k.addEventListener("transitioncancel",Et)}),this._activeRipples.set(mt,null),(ct||!S)&&this._finishRippleTransition(mt),mt}fadeOutRipple(r){if(2===r.state||3===r.state)return;const o=r.element,l={...TO,...r.config.animation};o.style.transitionDuration=`${l.exitDuration}ms`,o.style.opacity="0",r.state=2,(r._animationForciblyDisabledThroughCss||!l.exitDuration)&&this._finishRippleTransition(r)}fadeOutAll(){this._getActiveRipples().forEach(r=>r.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(r=>{r.config.persistent||r.fadeOut()})}setupTriggerEvents(r){const o=t_(r);!this._platform.isBrowser||!o||o===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=o,IO.forEach(l=>{x2._eventManager.addHandler(this._ngZone,l,o,this)}))}handleEvent(r){"mousedown"===r.type?this._onMousedown(r):"touchstart"===r.type?this._onTouchStart(r):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{AO.forEach(o=>{this._triggerElement.addEventListener(o,this,SO)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(r){0===r.state?this._startFadeOutTransition(r):2===r.state&&this._destroyRipple(r)}_startFadeOutTransition(r){const o=r===this._mostRecentTransientRipple,{persistent:l}=r.config;r.state=1,!l&&(!o||!this._isPointerDown)&&r.fadeOut()}_destroyRipple(r){const o=this._activeRipples.get(r)??null;this._activeRipples.delete(r),this._activeRipples.size||(this._containerRect=null),r===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),r.state=3,null!==o&&(r.element.removeEventListener("transitionend",o.onTransitionEnd),r.element.removeEventListener("transitioncancel",o.onTransitionCancel)),r.element.remove()}_onMousedown(r){const o=pO(r),l=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!o&&!l&&(this._isPointerDown=!0,this.fadeInRipple(r.clientX,r.clientY,this._target.rippleConfig))}_onTouchStart(r){if(!this._target.rippleDisabled&&!mO(r)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const o=r.changedTouches;if(o)for(let l=0;l<o.length;l++)this.fadeInRipple(o[l].clientX,o[l].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(r=>{!r.config.persistent&&(1===r.state||r.config.terminateOnPointerUp&&0===r.state)&&r.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const r=this._triggerElement;r&&(IO.forEach(o=>x2._eventManager.removeHandler(o,r,this)),this._pointerUpEventsRegistered&&AO.forEach(o=>r.removeEventListener(o,this,SO)))}}function k3(i,r){}class nM{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}}const b2="mdc-dialog--open",NO="mdc-dialog--opening",zO="mdc-dialog--closing";let N3=(()=>{class i extends xO{constructor(o,l,h,m,y,w,D,S){super(o,l,h,m,y,w,D,S),this._animationStateChanged=new dr}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(o){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:o})}static#t=this.\u0275fac=function(l){return new(l||i)(re(qr),re(m2),re(ii,8),re(nM),re(KD),re(Dn),re(jx),re(g2))};static#e=this.\u0275cmp=Ni({type:i,selectors:[["ng-component"]],features:[_h],decls:0,vars:0,template:function(l,h){},encapsulation:2})}return i})();const BO="--mat-dialog-transition-duration";function jO(i){return null==i?null:"number"==typeof i?i:i.endsWith("ms")?FP(i.substring(0,i.length-2)):i.endsWith("s")?1e3*FP(i.substring(0,i.length-1)):"0"===i?0:null}let z3=(()=>{class i extends N3{constructor(o,l,h,m,y,w,D,S,k){super(o,l,h,m,y,w,D,k),this._animationMode=S,this._animationsEnabled="NoopAnimations"!==this._animationMode,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?jO(this._config.enterAnimationDuration)??150:0,this._exitAnimationDuration=this._animationsEnabled?jO(this._config.exitAnimationDuration)??75:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}ngOnDestroy(){super.ngOnDestroy(),null!==this._animationTimer&&clearTimeout(this._animationTimer)}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(BO,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(NO,b2)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(b2),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(b2),this._animationsEnabled?(this._hostElement.style.setProperty(BO,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(zO)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_clearAnimationClasses(){this._hostElement.classList.remove(NO,zO)}_waitForAnimationToComplete(o,l){null!==this._animationTimer&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(l,o)}_requestAnimationFrame(o){this._ngZone.runOutsideAngular(()=>{"function"==typeof requestAnimationFrame?requestAnimationFrame(o):o()})}static#t=this.\u0275fac=function(l){return new(l||i)(re(qr),re(m2),re(ii,8),re(nM),re(KD),re(Dn),re(jx),re(Jd,8),re(g2))};static#e=this.\u0275cmp=Ni({type:i,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:8,hostBindings:function(l,h){2&l&&(gg("id",h._config.id),$c("aria-modal",h._config.ariaModal)("role",h._config.role)("aria-labelledby",h._config.ariaLabel?null:h._ariaLabelledByQueue[0])("aria-label",h._config.ariaLabel)("aria-describedby",h._config.ariaDescribedBy||null),fg("_mat-animation-noopable",!h._animationsEnabled))},features:[_h],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(l,h){1&l&&(Vt(0,"div",0)(1,"div",1),wf(2,k3,0,0,"ng-template",2),Zt()())},dependencies:[f2],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;transform:scale(0.8);opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{transform:none;opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{display:block;width:100%;height:100%}.mat-mdc-dialog-container{--mdc-dialog-container-elevation-shadow:0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12);--mdc-dialog-container-shadow-color:#000;--mdc-dialog-container-shape:4px;--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition-duration:var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container{transition:none}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-actions{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2})}return i})();class VO{constructor(r,o,l){this._ref=r,this._containerInstance=l,this._afterOpened=new kn,this._beforeClosed=new kn,this._state=0,this.disableClose=o.disableClose,this.id=r.id,l._animationStateChanged.pipe(Po(h=>"opened"===h.state),ua(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),l._animationStateChanged.pipe(Po(h=>"closed"===h.state),ua(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),r.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Yh(this.backdropClick(),this.keydownEvents().pipe(Po(h=>27===h.keyCode&&!this.disableClose&&!oO(h)))).subscribe(h=>{this.disableClose||(h.preventDefault(),UO(this,"keydown"===h.type?"keyboard":"mouse"))})}close(r){this._result=r,this._containerInstance._animationStateChanged.pipe(Po(o=>"closing"===o.state),ua(1)).subscribe(o=>{this._beforeClosed.next(r),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),o.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(r){let o=this._ref.config.positionStrategy;return r&&(r.left||r.right)?r.left?o.left(r.left):o.right(r.right):o.centerHorizontally(),r&&(r.top||r.bottom)?r.top?o.top(r.top):o.bottom(r.bottom):o.centerVertically(),this._ref.updatePosition(),this}updateSize(r="",o=""){return this._ref.updateSize(r,o),this}addPanelClass(r){return this._ref.addPanelClass(r),this}removePanelClass(r){return this._ref.removePanelClass(r),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}function UO(i,r,o){return i._closeInteractionType=r,i.close(o)}const B3=new le("MatMdcDialogData"),j3=new le("mat-mdc-dialog-default-options"),$O=new le("mat-mdc-dialog-scroll-strategy"),U3={provide:$O,deps:[n_],useFactory:function V3(i){return()=>i.scrollStrategies.block()}};let $3=0,H3=(()=>{class i{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const o=this._parentDialog;return o?o._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(o,l,h,m,y,w,D,S,k,z){this._overlay=o,this._defaultOptions=h,this._parentDialog=m,this._dialogRefConstructor=D,this._dialogContainerType=S,this._dialogDataToken=k,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new kn,this._afterOpenedAtThisLevel=new kn,this._idPrefix="mat-dialog-",this.dialogConfigClass=nM,this.afterAllClosed=JD(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(XD(void 0))),this._scrollStrategy=w,this._dialog=l.get(wO)}open(o,l){let h;(l={...this._defaultOptions||new nM,...l}).id=l.id||`${this._idPrefix}${$3++}`,l.scrollStrategy=l.scrollStrategy||this._scrollStrategy();const m=this._dialog.open(o,{...l,positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:l},{provide:tM,useValue:l}]},templateContext:()=>({dialogRef:h}),providers:(y,w,D)=>(h=new this._dialogRefConstructor(y,l,D),h.updatePosition(l?.position),[{provide:this._dialogContainerType,useValue:D},{provide:this._dialogDataToken,useValue:w.data},{provide:this._dialogRefConstructor,useValue:h}])});return h.componentRef=m.componentRef,h.componentInstance=m.componentInstance,this.openDialogs.push(h),this.afterOpened.next(h),h.afterClosed().subscribe(()=>{const y=this.openDialogs.indexOf(h);y>-1&&(this.openDialogs.splice(y,1),this.openDialogs.length||this._getAfterAllClosed().next())}),h}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(o){return this.openDialogs.find(l=>l.id===o)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(o){let l=o.length;for(;l--;)o[l].close()}static#t=this.\u0275fac=function(l){Cv()};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac})}return i})(),w2=(()=>{class i extends H3{constructor(o,l,h,m,y,w,D,S){super(o,l,m,w,D,y,VO,z3,B3,S),this._idPrefix="mat-mdc-dialog-"}static#t=this.\u0275fac=function(l){return new(l||i)(St(n_),St(hr),St(Rx,8),St(j3,8),St($O),St(i,12),St(ZD),St(Jd,8))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac})}return i})(),HO=(()=>{class i{constructor(o,l,h){this.dialogRef=o,this._elementRef=l,this._dialog=h,this.type="button"}ngOnInit(){this.dialogRef||(this.dialogRef=function G3(i,r){let o=i.nativeElement.parentElement;for(;o&&!o.classList.contains("mat-mdc-dialog-container");)o=o.parentElement;return o?r.find(l=>l.id===o.id):null}(this._elementRef,this._dialog.openDialogs))}ngOnChanges(o){const l=o._matDialogClose||o._matDialogCloseResult;l&&(this.dialogResult=l.currentValue)}_onButtonClick(o){UO(this.dialogRef,0===o.screenX&&0===o.screenY?"keyboard":"mouse",this.dialogResult)}static#t=this.\u0275fac=function(l){return new(l||i)(re(VO,8),re(qr),re(w2))};static#e=this.\u0275dir=Ui({type:i,selectors:[["","mat-dialog-close",""],["","matDialogClose",""]],hostVars:2,hostBindings:function(l,h){1&l&&Na("click",function(y){return h._onButtonClick(y)}),2&l&&$c("aria-label",h.ariaLabel||null)("type",h.type)},inputs:{ariaLabel:["aria-label","ariaLabel"],type:"type",dialogResult:["mat-dialog-close","dialogResult"],_matDialogClose:["matDialogClose","_matDialogClose"]},exportAs:["matDialogClose"],features:[wa]})}return i})(),GO=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275dir=Ui({type:i,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"]})}return i})(),qO=(()=>{class i{constructor(){this.align="start"}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275dir=Ui({type:i,selectors:[["","mat-dialog-actions",""],["mat-dialog-actions"],["","matDialogActions",""]],hostAttrs:[1,"mat-mdc-dialog-actions","mdc-dialog__actions"],hostVars:4,hostBindings:function(l,h){2&l&&fg("mat-mdc-dialog-actions-align-center","center"===h.align)("mat-mdc-dialog-actions-align-end","end"===h.align)},inputs:{align:"align"}})}return i})(),ZO=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({providers:[w2,U3],imports:[D3,iO,qD,DO,DO]})}return i})();const iM=qh(i=>function(){i(this),this.name="EmptyError",this.message="no elements in sequence"});function Ux(i,r){const o=Pn(i)?i:()=>i,l=h=>h.error(o());return new jn(r?h=>r.schedule(l,0,h):l)}function E2(){return Di((i,r)=>{let o=null;i._refCount++;const l=hi(r,void 0,void 0,void 0,()=>{if(!i||i._refCount<=0||0<--i._refCount)return void(o=null);const h=i._connection,m=o;o=null,h&&(!m||h===m)&&h.unsubscribe(),r.unsubscribe()});i.subscribe(l),l.closed||(o=i.connect())})}class YO extends jn{constructor(r,o){super(),this.source=r,this.subjectFactory=o,this._subject=null,this._refCount=0,this._connection=null,Or(r)&&(this.lift=r.lift)}_subscribe(r){return this.getSubject().subscribe(r)}getSubject(){const r=this._subject;return(!r||r.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:r}=this;this._subject=this._connection=null,r?.unsubscribe()}connect(){let r=this._connection;if(!r){r=this._connection=new st;const o=this.getSubject();r.add(this.source.subscribe(hi(o,void 0,()=>{this._teardown(),o.complete()},l=>{this._teardown(),o.error(l)},()=>this._teardown()))),r.closed&&(this._connection=null,r=st.EMPTY)}return r}refCount(){return E2()(this)}}function rM(i){return Di((r,o)=>{let l=!1;r.subscribe(hi(o,h=>{l=!0,o.next(h)},()=>{l||o.next(i),o.complete()}))})}function XO(i=Z3){return Di((r,o)=>{let l=!1;r.subscribe(hi(o,h=>{l=!0,o.next(h)},()=>l?o.complete():o.error(i())))})}function Z3(){return new iM}function up(i,r){const o=arguments.length>=2;return l=>l.pipe(i?Po((h,m)=>i(h,m,l)):Rs,ua(1),o?rM(r):XO(()=>new iM))}function $x(i,r){return Pn(r)?Ti(i,r,1):Ti(i,1)}function _o(i,r,o){const l=Pn(i)||r||o?{next:i,error:r,complete:o}:i;return l?Di((h,m)=>{var y;null===(y=l.subscribe)||void 0===y||y.call(l);let w=!0;h.subscribe(hi(m,D=>{var S;null===(S=l.next)||void 0===S||S.call(l,D),m.next(D)},()=>{var D;w=!1,null===(D=l.complete)||void 0===D||D.call(l),m.complete()},D=>{var S;w=!1,null===(S=l.error)||void 0===S||S.call(l,D),m.error(D)},()=>{var D,S;w&&(null===(D=l.unsubscribe)||void 0===D||D.call(l)),null===(S=l.finalize)||void 0===S||S.call(l)}))}):Rs}function hp(i){return Di((r,o)=>{let m,l=null,h=!1;l=r.subscribe(hi(o,void 0,void 0,y=>{m=pn(i(y,hp(i)(r))),l?(l.unsubscribe(),l=null,m.subscribe(o)):h=!0})),h&&(l.unsubscribe(),l=null,m.subscribe(o))})}function C2(i){return i<=0?()=>ts:Di((r,o)=>{let l=[];r.subscribe(hi(o,h=>{l.push(h),i<l.length&&l.shift()},()=>{for(const h of l)o.next(h);o.complete()},void 0,()=>{l=null}))})}function D2(i){return Di((r,o)=>{try{r.subscribe(o)}finally{o.add(i)}})}const bn="primary",Hx=Symbol("RouteTitle");class Q3{constructor(r){this.params=r||{}}has(r){return Object.prototype.hasOwnProperty.call(this.params,r)}get(r){if(this.has(r)){const o=this.params[r];return Array.isArray(o)?o[0]:o}return null}getAll(r){if(this.has(r)){const o=this.params[r];return Array.isArray(o)?o:[o]}return[]}get keys(){return Object.keys(this.params)}}function r_(i){return new Q3(i)}function J3(i,r,o){const l=o.path.split("/");if(l.length>i.length||"full"===o.pathMatch&&(r.hasChildren()||l.length<i.length))return null;const h={};for(let m=0;m<l.length;m++){const y=l[m],w=i[m];if(y.startsWith(":"))h[y.substring(1)]=w;else if(y!==w.path)return null}return{consumed:i.slice(0,l.length),posParams:h}}function ql(i,r){const o=i?Object.keys(i):void 0,l=r?Object.keys(r):void 0;if(!o||!l||o.length!=l.length)return!1;let h;for(let m=0;m<o.length;m++)if(h=o[m],!KO(i[h],r[h]))return!1;return!0}function KO(i,r){if(Array.isArray(i)&&Array.isArray(r)){if(i.length!==r.length)return!1;const o=[...i].sort(),l=[...r].sort();return o.every((h,m)=>l[m]===h)}return i===r}function QO(i){return i.length>0?i[i.length-1]:null}function Hh(i){return function q3(i){return!!i&&(i instanceof jn||Pn(i.lift)&&Pn(i.subscribe))}(i)?i:Zc(i)?Gi(Promise.resolve(i)):Fe(i)}const eB={exact:function ek(i,r,o){if(!dp(i.segments,r.segments)||!oM(i.segments,r.segments,o)||i.numberOfChildren!==r.numberOfChildren)return!1;for(const l in r.children)if(!i.children[l]||!ek(i.children[l],r.children[l],o))return!1;return!0},subset:nk},JO={exact:function nB(i,r){return ql(i,r)},subset:function iB(i,r){return Object.keys(r).length<=Object.keys(i).length&&Object.keys(r).every(o=>KO(i[o],r[o]))},ignored:()=>!0};function tk(i,r,o){return eB[o.paths](i.root,r.root,o.matrixParams)&&JO[o.queryParams](i.queryParams,r.queryParams)&&!("exact"===o.fragment&&i.fragment!==r.fragment)}function nk(i,r,o){return ik(i,r,r.segments,o)}function ik(i,r,o,l){if(i.segments.length>o.length){const h=i.segments.slice(0,o.length);return!(!dp(h,o)||r.hasChildren()||!oM(h,o,l))}if(i.segments.length===o.length){if(!dp(i.segments,o)||!oM(i.segments,o,l))return!1;for(const h in r.children)if(!i.children[h]||!nk(i.children[h],r.children[h],l))return!1;return!0}{const h=o.slice(0,i.segments.length),m=o.slice(i.segments.length);return!!(dp(i.segments,h)&&oM(i.segments,h,l)&&i.children[bn])&&ik(i.children[bn],r,m,l)}}function oM(i,r,o){return r.every((l,h)=>JO[o](i[h].parameters,l.parameters))}class o_{constructor(r=new fi([],{}),o={},l=null){this.root=r,this.queryParams=o,this.fragment=l}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=r_(this.queryParams)),this._queryParamMap}toString(){return sB.serialize(this)}}class fi{constructor(r,o){this.segments=r,this.children=o,this.parent=null,Object.values(o).forEach(l=>l.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return sM(this)}}class Gx{constructor(r,o){this.path=r,this.parameters=o}get parameterMap(){return this._parameterMap||(this._parameterMap=r_(this.parameters)),this._parameterMap}toString(){return sk(this)}}function dp(i,r){return i.length===r.length&&i.every((o,l)=>o.path===r[l].path)}let qx=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:function(){return new M2},providedIn:"root"})}return i})();class M2{parse(r){const o=new _B(r);return new o_(o.parseRootSegment(),o.parseQueryParams(),o.parseFragment())}serialize(r){const o=`/${Zx(r.root,!0)}`,l=function cB(i){const r=Object.keys(i).map(o=>{const l=i[o];return Array.isArray(l)?l.map(h=>`${aM(o)}=${aM(h)}`).join("&"):`${aM(o)}=${aM(l)}`}).filter(o=>!!o);return r.length?`?${r.join("&")}`:""}(r.queryParams);return`${o}${l}${"string"==typeof r.fragment?`#${function aB(i){return encodeURI(i)}(r.fragment)}`:""}`}}const sB=new M2;function sM(i){return i.segments.map(r=>sk(r)).join("/")}function Zx(i,r){if(!i.hasChildren())return sM(i);if(r){const o=i.children[bn]?Zx(i.children[bn],!1):"",l=[];return Object.entries(i.children).forEach(([h,m])=>{h!==bn&&l.push(`${h}:${Zx(m,!1)}`)}),l.length>0?`${o}(${l.join("//")})`:o}{const o=function oB(i,r){let o=[];return Object.entries(i.children).forEach(([l,h])=>{l===bn&&(o=o.concat(r(h,l)))}),Object.entries(i.children).forEach(([l,h])=>{l!==bn&&(o=o.concat(r(h,l)))}),o}(i,(l,h)=>h===bn?[Zx(i.children[bn],!1)]:[`${h}:${Zx(l,!1)}`]);return 1===Object.keys(i.children).length&&null!=i.children[bn]?`${sM(i)}/${o[0]}`:`${sM(i)}/(${o.join("//")})`}}function rk(i){return encodeURIComponent(i).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function aM(i){return rk(i).replace(/%3B/gi,";")}function T2(i){return rk(i).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function lM(i){return decodeURIComponent(i)}function ok(i){return lM(i.replace(/\+/g,"%20"))}function sk(i){return`${T2(i.path)}${function lB(i){return Object.keys(i).map(r=>`;${T2(r)}=${T2(i[r])}`).join("")}(i.parameters)}`}const uB=/^[^\/()?;#]+/;function S2(i){const r=i.match(uB);return r?r[0]:""}const hB=/^[^\/()?;=#]+/,fB=/^[^=?&#]+/,mB=/^[^&#]+/;class _B{constructor(r){this.url=r,this.remaining=r}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new fi([],{}):new fi([],this.parseChildren())}parseQueryParams(){const r={};if(this.consumeOptional("?"))do{this.parseQueryParam(r)}while(this.consumeOptional("&"));return r}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const r=[];for(this.peekStartsWith("(")||r.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),r.push(this.parseSegment());let o={};this.peekStartsWith("/(")&&(this.capture("/"),o=this.parseParens(!0));let l={};return this.peekStartsWith("(")&&(l=this.parseParens(!1)),(r.length>0||Object.keys(o).length>0)&&(l[bn]=new fi(r,o)),l}parseSegment(){const r=S2(this.remaining);if(""===r&&this.peekStartsWith(";"))throw new Jt(4009,!1);return this.capture(r),new Gx(lM(r),this.parseMatrixParams())}parseMatrixParams(){const r={};for(;this.consumeOptional(";");)this.parseParam(r);return r}parseParam(r){const o=function dB(i){const r=i.match(hB);return r?r[0]:""}(this.remaining);if(!o)return;this.capture(o);let l="";if(this.consumeOptional("=")){const h=S2(this.remaining);h&&(l=h,this.capture(l))}r[lM(o)]=lM(l)}parseQueryParam(r){const o=function pB(i){const r=i.match(fB);return r?r[0]:""}(this.remaining);if(!o)return;this.capture(o);let l="";if(this.consumeOptional("=")){const y=function gB(i){const r=i.match(mB);return r?r[0]:""}(this.remaining);y&&(l=y,this.capture(l))}const h=ok(o),m=ok(l);if(r.hasOwnProperty(h)){let y=r[h];Array.isArray(y)||(y=[y],r[h]=y),y.push(m)}else r[h]=m}parseParens(r){const o={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const l=S2(this.remaining),h=this.remaining[l.length];if("/"!==h&&")"!==h&&";"!==h)throw new Jt(4010,!1);let m;l.indexOf(":")>-1?(m=l.slice(0,l.indexOf(":")),this.capture(m),this.capture(":")):r&&(m=bn);const y=this.parseChildren();o[m]=1===Object.keys(y).length?y[bn]:new fi([],y),this.consumeOptional("//")}return o}peekStartsWith(r){return this.remaining.startsWith(r)}consumeOptional(r){return!!this.peekStartsWith(r)&&(this.remaining=this.remaining.substring(r.length),!0)}capture(r){if(!this.consumeOptional(r))throw new Jt(4011,!1)}}function ak(i){return i.segments.length>0?new fi([],{[bn]:i}):i}function lk(i){const r={};for(const l of Object.keys(i.children)){const m=lk(i.children[l]);if(l===bn&&0===m.segments.length&&m.hasChildren())for(const[y,w]of Object.entries(m.children))r[y]=w;else(m.segments.length>0||m.hasChildren())&&(r[l]=m)}return function yB(i){if(1===i.numberOfChildren&&i.children[bn]){const r=i.children[bn];return new fi(i.segments.concat(r.segments),r.children)}return i}(new fi(i.segments,r))}function fp(i){return i instanceof o_}function ck(i){let r;const h=ak(function o(m){const y={};for(const D of m.children){const S=o(D);y[D.outlet]=S}const w=new fi(m.url,y);return m===i&&(r=w),w}(i.root));return r??h}function uk(i,r,o,l){let h=i;for(;h.parent;)h=h.parent;if(0===r.length)return I2(h,h,h,o,l);const m=function xB(i){if("string"==typeof i[0]&&1===i.length&&"/"===i[0])return new dk(!0,0,i);let r=0,o=!1;const l=i.reduce((h,m,y)=>{if("object"==typeof m&&null!=m){if(m.outlets){const w={};return Object.entries(m.outlets).forEach(([D,S])=>{w[D]="string"==typeof S?S.split("/"):S}),[...h,{outlets:w}]}if(m.segmentPath)return[...h,m.segmentPath]}return"string"!=typeof m?[...h,m]:0===y?(m.split("/").forEach((w,D)=>{0==D&&"."===w||(0==D&&""===w?o=!0:".."===w?r++:""!=w&&h.push(w))}),h):[...h,m]},[]);return new dk(o,r,l)}(r);if(m.toRoot())return I2(h,h,new fi([],{}),o,l);const y=function bB(i,r,o){if(i.isAbsolute)return new uM(r,!0,0);if(!o)return new uM(r,!1,NaN);if(null===o.parent)return new uM(o,!0,0);const l=cM(i.commands[0])?0:1;return function wB(i,r,o){let l=i,h=r,m=o;for(;m>h;){if(m-=h,l=l.parent,!l)throw new Jt(4005,!1);h=l.segments.length}return new uM(l,!1,h-m)}(o,o.segments.length-1+l,i.numberOfDoubleDots)}(m,h,i),w=y.processChildren?Yx(y.segmentGroup,y.index,m.commands):fk(y.segmentGroup,y.index,m.commands);return I2(h,y.segmentGroup,w,o,l)}function cM(i){return"object"==typeof i&&null!=i&&!i.outlets&&!i.segmentPath}function Wx(i){return"object"==typeof i&&null!=i&&i.outlets}function I2(i,r,o,l,h){let y,m={};l&&Object.entries(l).forEach(([D,S])=>{m[D]=Array.isArray(S)?S.map(k=>`${k}`):`${S}`}),y=i===r?o:hk(i,r,o);const w=ak(lk(y));return new o_(w,m,h)}function hk(i,r,o){const l={};return Object.entries(i.children).forEach(([h,m])=>{l[h]=m===r?o:hk(m,r,o)}),new fi(i.segments,l)}class dk{constructor(r,o,l){if(this.isAbsolute=r,this.numberOfDoubleDots=o,this.commands=l,r&&l.length>0&&cM(l[0]))throw new Jt(4003,!1);const h=l.find(Wx);if(h&&h!==QO(l))throw new Jt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class uM{constructor(r,o,l){this.segmentGroup=r,this.processChildren=o,this.index=l}}function fk(i,r,o){if(i||(i=new fi([],{})),0===i.segments.length&&i.hasChildren())return Yx(i,r,o);const l=function CB(i,r,o){let l=0,h=r;const m={match:!1,pathIndex:0,commandIndex:0};for(;h<i.segments.length;){if(l>=o.length)return m;const y=i.segments[h],w=o[l];if(Wx(w))break;const D=`${w}`,S=l<o.length-1?o[l+1]:null;if(h>0&&void 0===D)break;if(D&&S&&"object"==typeof S&&void 0===S.outlets){if(!mk(D,S,y))return m;l+=2}else{if(!mk(D,{},y))return m;l++}h++}return{match:!0,pathIndex:h,commandIndex:l}}(i,r,o),h=o.slice(l.commandIndex);if(l.match&&l.pathIndex<i.segments.length){const m=new fi(i.segments.slice(0,l.pathIndex),{});return m.children[bn]=new fi(i.segments.slice(l.pathIndex),i.children),Yx(m,0,h)}return l.match&&0===h.length?new fi(i.segments,{}):l.match&&!i.hasChildren()?A2(i,r,o):l.match?Yx(i,0,h):A2(i,r,o)}function Yx(i,r,o){if(0===o.length)return new fi(i.segments,{});{const l=function EB(i){return Wx(i[0])?i[0].outlets:{[bn]:i}}(o),h={};if(Object.keys(l).some(m=>m!==bn)&&i.children[bn]&&1===i.numberOfChildren&&0===i.children[bn].segments.length){const m=Yx(i.children[bn],r,o);return new fi(i.segments,m.children)}return Object.entries(l).forEach(([m,y])=>{"string"==typeof y&&(y=[y]),null!==y&&(h[m]=fk(i.children[m],r,y))}),Object.entries(i.children).forEach(([m,y])=>{void 0===l[m]&&(h[m]=y)}),new fi(i.segments,h)}}function A2(i,r,o){const l=i.segments.slice(0,r);let h=0;for(;h<o.length;){const m=o[h];if(Wx(m)){const D=DB(m.outlets);return new fi(l,D)}if(0===h&&cM(o[0])){l.push(new Gx(i.segments[r].path,pk(o[0]))),h++;continue}const y=Wx(m)?m.outlets[bn]:`${m}`,w=h<o.length-1?o[h+1]:null;y&&w&&cM(w)?(l.push(new Gx(y,pk(w))),h+=2):(l.push(new Gx(y,{})),h++)}return new fi(l,{})}function DB(i){const r={};return Object.entries(i).forEach(([o,l])=>{"string"==typeof l&&(l=[l]),null!==l&&(r[o]=A2(new fi([],{}),0,l))}),r}function pk(i){const r={};return Object.entries(i).forEach(([o,l])=>r[o]=`${l}`),r}function mk(i,r,o){return i==o.path&&ql(r,o.parameters)}const Xx="imperative";class Zl{constructor(r,o){this.id=r,this.url=o}}class hM extends Zl{constructor(r,o,l="imperative",h=null){super(r,o),this.type=0,this.navigationTrigger=l,this.restoredState=h}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Gh extends Zl{constructor(r,o,l){super(r,o),this.urlAfterRedirects=l,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Kx extends Zl{constructor(r,o,l,h){super(r,o),this.reason=l,this.code=h,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class s_ extends Zl{constructor(r,o,l,h){super(r,o),this.reason=l,this.code=h,this.type=16}}class dM extends Zl{constructor(r,o,l,h){super(r,o),this.error=l,this.target=h,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class gk extends Zl{constructor(r,o,l,h){super(r,o),this.urlAfterRedirects=l,this.state=h,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class MB extends Zl{constructor(r,o,l,h){super(r,o),this.urlAfterRedirects=l,this.state=h,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class TB extends Zl{constructor(r,o,l,h,m){super(r,o),this.urlAfterRedirects=l,this.state=h,this.shouldActivate=m,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class SB extends Zl{constructor(r,o,l,h){super(r,o),this.urlAfterRedirects=l,this.state=h,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class IB extends Zl{constructor(r,o,l,h){super(r,o),this.urlAfterRedirects=l,this.state=h,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class AB{constructor(r){this.route=r,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class RB{constructor(r){this.route=r,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class PB{constructor(r){this.snapshot=r,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class OB{constructor(r){this.snapshot=r,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class kB{constructor(r){this.snapshot=r,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class LB{constructor(r){this.snapshot=r,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class _k{constructor(r,o,l){this.routerEvent=r,this.position=o,this.anchor=l,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class R2{}class P2{constructor(r){this.url=r}}class FB{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Qx,this.attachRef=null}}let Qx=(()=>{class i{constructor(){this.contexts=new Map}onChildOutletCreated(o,l){const h=this.getOrCreateContext(o);h.outlet=l,this.contexts.set(o,h)}onChildOutletDestroyed(o){const l=this.getContext(o);l&&(l.outlet=null,l.attachRef=null)}onOutletDeactivated(){const o=this.contexts;return this.contexts=new Map,o}onOutletReAttached(o){this.contexts=o}getOrCreateContext(o){let l=this.getContext(o);return l||(l=new FB,this.contexts.set(o,l)),l}getContext(o){return this.contexts.get(o)||null}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();class yk{constructor(r){this._root=r}get root(){return this._root.value}parent(r){const o=this.pathFromRoot(r);return o.length>1?o[o.length-2]:null}children(r){const o=O2(r,this._root);return o?o.children.map(l=>l.value):[]}firstChild(r){const o=O2(r,this._root);return o&&o.children.length>0?o.children[0].value:null}siblings(r){const o=k2(r,this._root);return o.length<2?[]:o[o.length-2].children.map(h=>h.value).filter(h=>h!==r)}pathFromRoot(r){return k2(r,this._root).map(o=>o.value)}}function O2(i,r){if(i===r.value)return r;for(const o of r.children){const l=O2(i,o);if(l)return l}return null}function k2(i,r){if(i===r.value)return[r];for(const o of r.children){const l=k2(i,o);if(l.length)return l.unshift(r),l}return[]}class au{constructor(r,o){this.value=r,this.children=o}toString(){return`TreeNode(${this.value})`}}function a_(i){const r={};return i&&i.children.forEach(o=>r[o.value.outlet]=o),r}class vk extends yk{constructor(r,o){super(r),this.snapshot=o,L2(this,r)}toString(){return this.snapshot.toString()}}function xk(i,r){const o=function NB(i,r){const y=new fM([],{},{},"",{},bn,r,null,{});return new wk("",new au(y,[]))}(0,r),l=new Er([new Gx("",{})]),h=new Er({}),m=new Er({}),y=new Er({}),w=new Er(""),D=new l_(l,h,y,w,m,bn,r,o.root);return D.snapshot=o.root,new vk(new au(D,[]),o)}class l_{constructor(r,o,l,h,m,y,w,D){this.urlSubject=r,this.paramsSubject=o,this.queryParamsSubject=l,this.fragmentSubject=h,this.dataSubject=m,this.outlet=y,this.component=w,this._futureSnapshot=D,this.title=this.dataSubject?.pipe(Yn(S=>S[Hx]))??Fe(void 0),this.url=r,this.params=o,this.queryParams=l,this.fragment=h,this.data=m}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Yn(r=>r_(r)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Yn(r=>r_(r)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function bk(i,r="emptyOnly"){const o=i.pathFromRoot;let l=0;if("always"!==r)for(l=o.length-1;l>=1;){const h=o[l],m=o[l-1];if(h.routeConfig&&""===h.routeConfig.path)l--;else{if(m.component)break;l--}}return function zB(i){return i.reduce((r,o)=>({params:{...r.params,...o.params},data:{...r.data,...o.data},resolve:{...o.data,...r.resolve,...o.routeConfig?.data,...o._resolvedData}}),{params:{},data:{},resolve:{}})}(o.slice(l))}class fM{get title(){return this.data?.[Hx]}constructor(r,o,l,h,m,y,w,D,S){this.url=r,this.params=o,this.queryParams=l,this.fragment=h,this.data=m,this.outlet=y,this.component=w,this.routeConfig=D,this._resolve=S}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=r_(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=r_(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(l=>l.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class wk extends yk{constructor(r,o){super(o),this.url=r,L2(this,o)}toString(){return Ek(this._root)}}function L2(i,r){r.value._routerState=i,r.children.forEach(o=>L2(i,o))}function Ek(i){const r=i.children.length>0?` { ${i.children.map(Ek).join(", ")} } `:"";return`${i.value}${r}`}function F2(i){if(i.snapshot){const r=i.snapshot,o=i._futureSnapshot;i.snapshot=o,ql(r.queryParams,o.queryParams)||i.queryParamsSubject.next(o.queryParams),r.fragment!==o.fragment&&i.fragmentSubject.next(o.fragment),ql(r.params,o.params)||i.paramsSubject.next(o.params),function tB(i,r){if(i.length!==r.length)return!1;for(let o=0;o<i.length;++o)if(!ql(i[o],r[o]))return!1;return!0}(r.url,o.url)||i.urlSubject.next(o.url),ql(r.data,o.data)||i.dataSubject.next(o.data)}else i.snapshot=i._futureSnapshot,i.dataSubject.next(i._futureSnapshot.data)}function N2(i,r){const o=ql(i.params,r.params)&&function rB(i,r){return dp(i,r)&&i.every((o,l)=>ql(o.parameters,r[l].parameters))}(i.url,r.url);return o&&!(!i.parent!=!r.parent)&&(!i.parent||N2(i.parent,r.parent))}let z2=(()=>{class i{constructor(){this.activated=null,this._activatedRoute=null,this.name=bn,this.activateEvents=new dr,this.deactivateEvents=new dr,this.attachEvents=new dr,this.detachEvents=new dr,this.parentContexts=fe(Qx),this.location=fe(Io),this.changeDetector=fe(Ot),this.environmentInjector=fe(Gr),this.inputBinder=fe(pM,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(o){if(o.name){const{firstChange:l,previousValue:h}=o.name;if(l)return;this.isTrackedInParentContexts(h)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(h)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(o){return this.parentContexts.getContext(o)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const o=this.parentContexts.getContext(this.name);o?.route&&(o.attachRef?this.attach(o.attachRef,o.route):this.activateWith(o.route,o.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Jt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Jt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Jt(4012,!1);this.location.detach();const o=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(o.instance),o}attach(o,l){this.activated=o,this._activatedRoute=l,this.location.insert(o.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(o.instance)}deactivate(){if(this.activated){const o=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(o)}}activateWith(o,l){if(this.isActivated)throw new Jt(4013,!1);this._activatedRoute=o;const h=this.location,y=o.snapshot.component,w=this.parentContexts.getOrCreateContext(this.name).children,D=new BB(o,w,h.injector);this.activated=h.createComponent(y,{index:h.length,injector:D,environmentInjector:l??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275dir=Ui({type:i,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[wa]})}return i})();class BB{constructor(r,o,l){this.route=r,this.childContexts=o,this.parent=l}get(r,o){return r===l_?this.route:r===Qx?this.childContexts:this.parent.get(r,o)}}const pM=new le("");let Ck=(()=>{class i{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(o){this.unsubscribeFromRouteData(o),this.subscribeToRouteData(o)}unsubscribeFromRouteData(o){this.outletDataSubscriptions.get(o)?.unsubscribe(),this.outletDataSubscriptions.delete(o)}subscribeToRouteData(o){const{activatedRoute:l}=o,h=WD([l.queryParams,l.params,l.data]).pipe(rn(([m,y,w],D)=>(w={...m,...y,...w},0===D?Fe(w):Promise.resolve(w)))).subscribe(m=>{if(!o.isActivated||!o.activatedComponentRef||o.activatedRoute!==l||null===l.component)return void this.unsubscribeFromRouteData(o);const y=function aL(i){const r=In(i);if(!r)return null;const o=new gh(r);return{get selector(){return o.selector},get type(){return o.componentType},get inputs(){return o.inputs},get outputs(){return o.outputs},get ngContentSelectors(){return o.ngContentSelectors},get isStandalone(){return r.standalone},get isSignal(){return r.signals}}}(l.component);if(y)for(const{templateName:w}of y.inputs)o.activatedComponentRef.setInput(w,m[w]);else this.unsubscribeFromRouteData(o)});this.outletDataSubscriptions.set(o,h)}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac})}return i})();function Jx(i,r,o){if(o&&i.shouldReuseRoute(r.value,o.value.snapshot)){const l=o.value;l._futureSnapshot=r.value;const h=function VB(i,r,o){return r.children.map(l=>{for(const h of o.children)if(i.shouldReuseRoute(l.value,h.value.snapshot))return Jx(i,l,h);return Jx(i,l)})}(i,r,o);return new au(l,h)}{if(i.shouldAttach(r.value)){const m=i.retrieve(r.value);if(null!==m){const y=m.route;return y.value._futureSnapshot=r.value,y.children=r.children.map(w=>Jx(i,w)),y}}const l=function UB(i){return new l_(new Er(i.url),new Er(i.params),new Er(i.queryParams),new Er(i.fragment),new Er(i.data),i.outlet,i.component,i)}(r.value),h=r.children.map(m=>Jx(i,m));return new au(l,h)}}const B2="ngNavigationCancelingError";function Dk(i,r){const{redirectTo:o,navigationBehaviorOptions:l}=fp(r)?{redirectTo:r,navigationBehaviorOptions:void 0}:r,h=Mk(!1,0,r);return h.url=o,h.navigationBehaviorOptions=l,h}function Mk(i,r,o){const l=new Error("NavigationCancelingError: "+(i||""));return l[B2]=!0,l.cancellationCode=r,o&&(l.url=o),l}function Tk(i){return i&&i[B2]}let Sk=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275cmp=Ni({type:i,selectors:[["ng-component"]],standalone:!0,features:[Y0],decls:1,vars:0,template:function(l,h){1&l&&ke(0,"router-outlet")},dependencies:[z2],encapsulation:2})}return i})();function j2(i){const r=i.children&&i.children.map(j2),o=r?{...i,children:r}:{...i};return!o.component&&!o.loadComponent&&(r||o.loadChildren)&&o.outlet&&o.outlet!==bn&&(o.component=Sk),o}function $a(i){return i.outlet||bn}function t1(i){if(!i)return null;if(i.routeConfig?._injector)return i.routeConfig._injector;for(let r=i.parent;r;r=r.parent){const o=r.routeConfig;if(o?._loadedInjector)return o._loadedInjector;if(o?._injector)return o._injector}return null}class XB{constructor(r,o,l,h,m){this.routeReuseStrategy=r,this.futureState=o,this.currState=l,this.forwardEvent=h,this.inputBindingEnabled=m}activate(r){const o=this.futureState._root,l=this.currState?this.currState._root:null;this.deactivateChildRoutes(o,l,r),F2(this.futureState.root),this.activateChildRoutes(o,l,r)}deactivateChildRoutes(r,o,l){const h=a_(o);r.children.forEach(m=>{const y=m.value.outlet;this.deactivateRoutes(m,h[y],l),delete h[y]}),Object.values(h).forEach(m=>{this.deactivateRouteAndItsChildren(m,l)})}deactivateRoutes(r,o,l){const h=r.value,m=o?o.value:null;if(h===m)if(h.component){const y=l.getContext(h.outlet);y&&this.deactivateChildRoutes(r,o,y.children)}else this.deactivateChildRoutes(r,o,l);else m&&this.deactivateRouteAndItsChildren(o,l)}deactivateRouteAndItsChildren(r,o){r.value.component&&this.routeReuseStrategy.shouldDetach(r.value.snapshot)?this.detachAndStoreRouteSubtree(r,o):this.deactivateRouteAndOutlet(r,o)}detachAndStoreRouteSubtree(r,o){const l=o.getContext(r.value.outlet),h=l&&r.value.component?l.children:o,m=a_(r);for(const y of Object.keys(m))this.deactivateRouteAndItsChildren(m[y],h);if(l&&l.outlet){const y=l.outlet.detach(),w=l.children.onOutletDeactivated();this.routeReuseStrategy.store(r.value.snapshot,{componentRef:y,route:r,contexts:w})}}deactivateRouteAndOutlet(r,o){const l=o.getContext(r.value.outlet),h=l&&r.value.component?l.children:o,m=a_(r);for(const y of Object.keys(m))this.deactivateRouteAndItsChildren(m[y],h);l&&(l.outlet&&(l.outlet.deactivate(),l.children.onOutletDeactivated()),l.attachRef=null,l.route=null)}activateChildRoutes(r,o,l){const h=a_(o);r.children.forEach(m=>{this.activateRoutes(m,h[m.value.outlet],l),this.forwardEvent(new LB(m.value.snapshot))}),r.children.length&&this.forwardEvent(new OB(r.value.snapshot))}activateRoutes(r,o,l){const h=r.value,m=o?o.value:null;if(F2(h),h===m)if(h.component){const y=l.getOrCreateContext(h.outlet);this.activateChildRoutes(r,o,y.children)}else this.activateChildRoutes(r,o,l);else if(h.component){const y=l.getOrCreateContext(h.outlet);if(this.routeReuseStrategy.shouldAttach(h.snapshot)){const w=this.routeReuseStrategy.retrieve(h.snapshot);this.routeReuseStrategy.store(h.snapshot,null),y.children.onOutletReAttached(w.contexts),y.attachRef=w.componentRef,y.route=w.route.value,y.outlet&&y.outlet.attach(w.componentRef,w.route.value),F2(w.route.value),this.activateChildRoutes(r,null,y.children)}else{const w=t1(h.snapshot);y.attachRef=null,y.route=h,y.injector=w,y.outlet&&y.outlet.activateWith(h,y.injector),this.activateChildRoutes(r,null,y.children)}}else this.activateChildRoutes(r,null,l)}}class Ik{constructor(r){this.path=r,this.route=this.path[this.path.length-1]}}class mM{constructor(r,o){this.component=r,this.route=o}}function KB(i,r,o){const l=i._root;return e1(l,r?r._root:null,o,[l.value])}function c_(i,r){const o=Symbol(),l=r.get(i,o);return l===o?"function"!=typeof i||function E_(i){return null!==tl(i)}(i)?r.get(i):i:l}function e1(i,r,o,l,h={canDeactivateChecks:[],canActivateChecks:[]}){const m=a_(r);return i.children.forEach(y=>{(function JB(i,r,o,l,h={canDeactivateChecks:[],canActivateChecks:[]}){const m=i.value,y=r?r.value:null,w=o?o.getContext(i.value.outlet):null;if(y&&m.routeConfig===y.routeConfig){const D=function t4(i,r,o){if("function"==typeof o)return o(i,r);switch(o){case"pathParamsChange":return!dp(i.url,r.url);case"pathParamsOrQueryParamsChange":return!dp(i.url,r.url)||!ql(i.queryParams,r.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!N2(i,r)||!ql(i.queryParams,r.queryParams);default:return!N2(i,r)}}(y,m,m.routeConfig.runGuardsAndResolvers);D?h.canActivateChecks.push(new Ik(l)):(m.data=y.data,m._resolvedData=y._resolvedData),e1(i,r,m.component?w?w.children:null:o,l,h),D&&w&&w.outlet&&w.outlet.isActivated&&h.canDeactivateChecks.push(new mM(w.outlet.component,y))}else y&&n1(r,w,h),h.canActivateChecks.push(new Ik(l)),e1(i,null,m.component?w?w.children:null:o,l,h)})(y,m[y.value.outlet],o,l.concat([y.value]),h),delete m[y.value.outlet]}),Object.entries(m).forEach(([y,w])=>n1(w,o.getContext(y),h)),h}function n1(i,r,o){const l=a_(i),h=i.value;Object.entries(l).forEach(([m,y])=>{n1(y,h.component?r?r.children.getContext(m):null:r,o)}),o.canDeactivateChecks.push(new mM(h.component&&r&&r.outlet&&r.outlet.isActivated?r.outlet.component:null,h))}function r1(i){return"function"==typeof i}function Ak(i){return i instanceof iM||"EmptyError"===i?.name}const gM=Symbol("INITIAL_VALUE");function u_(){return rn(i=>WD(i.map(r=>r.pipe(ua(1),XD(gM)))).pipe(Yn(r=>{for(const o of r)if(!0!==o){if(o===gM)return gM;if(!1===o||o instanceof o_)return o}return!0}),Po(r=>r!==gM),ua(1)))}function Rk(i){return function Xl(...i){return Za(i)}(_o(r=>{if(fp(r))throw Dk(0,r)}),Yn(r=>!0===r))}class _M{constructor(r){this.segmentGroup=r||null}}class Pk{constructor(r){this.urlTree=r}}function h_(i){return Ux(new _M(i))}function Ok(i){return Ux(new Pk(i))}class x4{constructor(r,o){this.urlSerializer=r,this.urlTree=o}noMatchError(r){return new Jt(4002,!1)}lineralizeSegments(r,o){let l=[],h=o.root;for(;;){if(l=l.concat(h.segments),0===h.numberOfChildren)return Fe(l);if(h.numberOfChildren>1||!h.children[bn])return Ux(new Jt(4e3,!1));h=h.children[bn]}}applyRedirectCommands(r,o,l){return this.applyRedirectCreateUrlTree(o,this.urlSerializer.parse(o),r,l)}applyRedirectCreateUrlTree(r,o,l,h){const m=this.createSegmentGroup(r,o.root,l,h);return new o_(m,this.createQueryParams(o.queryParams,this.urlTree.queryParams),o.fragment)}createQueryParams(r,o){const l={};return Object.entries(r).forEach(([h,m])=>{if("string"==typeof m&&m.startsWith(":")){const w=m.substring(1);l[h]=o[w]}else l[h]=m}),l}createSegmentGroup(r,o,l,h){const m=this.createSegments(r,o.segments,l,h);let y={};return Object.entries(o.children).forEach(([w,D])=>{y[w]=this.createSegmentGroup(r,D,l,h)}),new fi(m,y)}createSegments(r,o,l,h){return o.map(m=>m.path.startsWith(":")?this.findPosParam(r,m,h):this.findOrReturn(m,l))}findPosParam(r,o,l){const h=l[o.path.substring(1)];if(!h)throw new Jt(4001,!1);return h}findOrReturn(r,o){let l=0;for(const h of o){if(h.path===r.path)return o.splice(l),h;l++}return r}}const V2={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function b4(i,r,o,l,h){const m=U2(i,r,o);return m.matched?(l=function HB(i,r){return i.providers&&!i._injector&&(i._injector=Pg(i.providers,r,`Route: ${i.path}`)),i._injector??r}(r,l),function _4(i,r,o,l){const h=r.canMatch;return h&&0!==h.length?Fe(h.map(y=>{const w=c_(y,i);return Hh(function s4(i){return i&&r1(i.canMatch)}(w)?w.canMatch(r,o):i.runInContext(()=>w(r,o)))})).pipe(u_(),Rk()):Fe(!0)}(l,r,o).pipe(Yn(y=>!0===y?m:{...V2}))):Fe(m)}function U2(i,r,o){if(""===r.path)return"full"===r.pathMatch&&(i.hasChildren()||o.length>0)?{...V2}:{matched:!0,consumedSegments:[],remainingSegments:o,parameters:{},positionalParamSegments:{}};const h=(r.matcher||J3)(o,i,r);if(!h)return{...V2};const m={};Object.entries(h.posParams??{}).forEach(([w,D])=>{m[w]=D.path});const y=h.consumed.length>0?{...m,...h.consumed[h.consumed.length-1].parameters}:m;return{matched:!0,consumedSegments:h.consumed,remainingSegments:o.slice(h.consumed.length),parameters:y,positionalParamSegments:h.posParams??{}}}function kk(i,r,o,l){return o.length>0&&function C4(i,r,o){return o.some(l=>yM(i,r,l)&&$a(l)!==bn)}(i,o,l)?{segmentGroup:new fi(r,E4(l,new fi(o,i.children))),slicedSegments:[]}:0===o.length&&function D4(i,r,o){return o.some(l=>yM(i,r,l))}(i,o,l)?{segmentGroup:new fi(i.segments,w4(i,0,o,l,i.children)),slicedSegments:o}:{segmentGroup:new fi(i.segments,i.children),slicedSegments:o}}function w4(i,r,o,l,h){const m={};for(const y of l)if(yM(i,o,y)&&!h[$a(y)]){const w=new fi([],{});m[$a(y)]=w}return{...h,...m}}function E4(i,r){const o={};o[bn]=r;for(const l of i)if(""===l.path&&$a(l)!==bn){const h=new fi([],{});o[$a(l)]=h}return o}function yM(i,r,o){return(!(i.hasChildren()||r.length>0)||"full"!==o.pathMatch)&&""===o.path}class I4{constructor(r,o,l,h,m,y,w){this.injector=r,this.configLoader=o,this.rootComponentType=l,this.config=h,this.urlTree=m,this.paramsInheritanceStrategy=y,this.urlSerializer=w,this.allowRedirects=!0,this.applyRedirects=new x4(this.urlSerializer,this.urlTree)}noMatchError(r){return new Jt(4002,!1)}recognize(){const r=kk(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,r,bn).pipe(hp(o=>{if(o instanceof Pk)return this.allowRedirects=!1,this.urlTree=o.urlTree,this.match(o.urlTree);throw o instanceof _M?this.noMatchError(o):o}),Yn(o=>{const l=new fM([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},bn,this.rootComponentType,null,{}),h=new au(l,o),m=new wk("",h),y=function vB(i,r,o=null,l=null){return uk(ck(i),r,o,l)}(l,[],this.urlTree.queryParams,this.urlTree.fragment);return y.queryParams=this.urlTree.queryParams,m.url=this.urlSerializer.serialize(y),this.inheritParamsAndData(m._root),{state:m,tree:y}}))}match(r){return this.processSegmentGroup(this.injector,this.config,r.root,bn).pipe(hp(l=>{throw l instanceof _M?this.noMatchError(l):l}))}inheritParamsAndData(r){const o=r.value,l=bk(o,this.paramsInheritanceStrategy);o.params=Object.freeze(l.params),o.data=Object.freeze(l.data),r.children.forEach(h=>this.inheritParamsAndData(h))}processSegmentGroup(r,o,l,h){return 0===l.segments.length&&l.hasChildren()?this.processChildren(r,o,l):this.processSegment(r,o,l,l.segments,h,!0)}processChildren(r,o,l){const h=[];for(const m of Object.keys(l.children))"primary"===m?h.unshift(m):h.push(m);return Gi(h).pipe($x(m=>{const y=l.children[m],w=function WB(i,r){const o=i.filter(l=>$a(l)===r);return o.push(...i.filter(l=>$a(l)!==r)),o}(o,m);return this.processSegmentGroup(r,w,y,m)}),function Y3(i,r){return Di(function W3(i,r,o,l,h){return(m,y)=>{let w=o,D=r,S=0;m.subscribe(hi(y,k=>{const z=S++;D=w?i(D,k,z):(w=!0,k),l&&y.next(D)},h&&(()=>{w&&y.next(D),y.complete()})))}}(i,r,arguments.length>=2,!0))}((m,y)=>(m.push(...y),m)),rM(null),function X3(i,r){const o=arguments.length>=2;return l=>l.pipe(i?Po((h,m)=>i(h,m,l)):Rs,C2(1),o?rM(r):XO(()=>new iM))}(),Ti(m=>{if(null===m)return h_(l);const y=Lk(m);return function A4(i){i.sort((r,o)=>r.value.outlet===bn?-1:o.value.outlet===bn?1:r.value.outlet.localeCompare(o.value.outlet))}(y),Fe(y)}))}processSegment(r,o,l,h,m,y){return Gi(o).pipe($x(w=>this.processSegmentAgainstRoute(w._injector??r,o,w,l,h,m,y).pipe(hp(D=>{if(D instanceof _M)return Fe(null);throw D}))),up(w=>!!w),hp(w=>{if(Ak(w))return function T4(i,r,o){return 0===r.length&&!i.children[o]}(l,h,m)?Fe([]):h_(l);throw w}))}processSegmentAgainstRoute(r,o,l,h,m,y,w){return function M4(i,r,o,l){return!!($a(i)===l||l!==bn&&yM(r,o,i))&&("**"===i.path||U2(r,i,o).matched)}(l,h,m,y)?void 0===l.redirectTo?this.matchSegmentAgainstRoute(r,h,l,m,y,w):w&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(r,h,o,l,m,y):h_(h):h_(h)}expandSegmentAgainstRouteUsingRedirect(r,o,l,h,m,y){return"**"===h.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(r,l,h,y):this.expandRegularSegmentAgainstRouteUsingRedirect(r,o,l,h,m,y)}expandWildCardWithParamsAgainstRouteUsingRedirect(r,o,l,h){const m=this.applyRedirects.applyRedirectCommands([],l.redirectTo,{});return l.redirectTo.startsWith("/")?Ok(m):this.applyRedirects.lineralizeSegments(l,m).pipe(Ti(y=>{const w=new fi(y,{});return this.processSegment(r,o,w,y,h,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(r,o,l,h,m,y){const{matched:w,consumedSegments:D,remainingSegments:S,positionalParamSegments:k}=U2(o,h,m);if(!w)return h_(o);const z=this.applyRedirects.applyRedirectCommands(D,h.redirectTo,k);return h.redirectTo.startsWith("/")?Ok(z):this.applyRedirects.lineralizeSegments(h,z).pipe(Ti(H=>this.processSegment(r,l,o,H.concat(S),y,!1)))}matchSegmentAgainstRoute(r,o,l,h,m,y){let w;if("**"===l.path){const D=h.length>0?QO(h).parameters:{};w=Fe({snapshot:new fM(h,D,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Fk(l),$a(l),l.component??l._loadedComponent??null,l,Nk(l)),consumedSegments:[],remainingSegments:[]}),o.children={}}else w=b4(o,l,h,r).pipe(Yn(({matched:D,consumedSegments:S,remainingSegments:k,parameters:z})=>D?{snapshot:new fM(S,z,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Fk(l),$a(l),l.component??l._loadedComponent??null,l,Nk(l)),consumedSegments:S,remainingSegments:k}:null));return w.pipe(rn(D=>null===D?h_(o):this.getChildConfig(r=l._injector??r,l,h).pipe(rn(({routes:S})=>{const k=l._loadedInjector??r,{snapshot:z,consumedSegments:H,remainingSegments:J}=D,{segmentGroup:ct,slicedSegments:mt}=kk(o,H,J,S);if(0===mt.length&&ct.hasChildren())return this.processChildren(k,S,ct).pipe(Yn(Wt=>null===Wt?null:[new au(z,Wt)]));if(0===S.length&&0===mt.length)return Fe([new au(z,[])]);const Pt=$a(l)===m;return this.processSegment(k,S,ct,mt,Pt?bn:m,!0).pipe(Yn(Wt=>[new au(z,Wt)]))}))))}getChildConfig(r,o,l){return o.children?Fe({routes:o.children,injector:r}):o.loadChildren?void 0!==o._loadedRoutes?Fe({routes:o._loadedRoutes,injector:o._loadedInjector}):function g4(i,r,o,l){const h=r.canLoad;return void 0===h||0===h.length?Fe(!0):Fe(h.map(y=>{const w=c_(y,i);return Hh(function n4(i){return i&&r1(i.canLoad)}(w)?w.canLoad(r,o):i.runInContext(()=>w(r,o)))})).pipe(u_(),Rk())}(r,o,l).pipe(Ti(h=>h?this.configLoader.loadChildren(r,o).pipe(_o(m=>{o._loadedRoutes=m.routes,o._loadedInjector=m.injector})):function v4(i){return Ux(Mk(!1,3))}())):Fe({routes:[],injector:r})}}function R4(i){const r=i.value.routeConfig;return r&&""===r.path}function Lk(i){const r=[],o=new Set;for(const l of i){if(!R4(l)){r.push(l);continue}const h=r.find(m=>l.value.routeConfig===m.value.routeConfig);void 0!==h?(h.children.push(...l.children),o.add(h)):r.push(l)}for(const l of o){const h=Lk(l.children);r.push(new au(l.value,h))}return r.filter(l=>!o.has(l))}function Fk(i){return i.data||{}}function Nk(i){return i.resolve||{}}function zk(i){return"string"==typeof i.title||null===i.title}function $2(i){return rn(r=>{const o=i(r);return o?Gi(o).pipe(Yn(()=>r)):Fe(r)})}const d_=new le("ROUTES");let H2=(()=>{class i{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=fe(uD)}loadComponent(o){if(this.componentLoaders.get(o))return this.componentLoaders.get(o);if(o._loadedComponent)return Fe(o._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(o);const l=Hh(o.loadComponent()).pipe(Yn(Bk),_o(m=>{this.onLoadEndListener&&this.onLoadEndListener(o),o._loadedComponent=m}),D2(()=>{this.componentLoaders.delete(o)})),h=new YO(l,()=>new kn).pipe(E2());return this.componentLoaders.set(o,h),h}loadChildren(o,l){if(this.childrenLoaders.get(l))return this.childrenLoaders.get(l);if(l._loadedRoutes)return Fe({routes:l._loadedRoutes,injector:l._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(l);const m=function z4(i,r,o,l){return Hh(i.loadChildren()).pipe(Yn(Bk),Ti(h=>h instanceof Rg||Array.isArray(h)?Fe(h):Gi(r.compileModuleAsync(h))),Yn(h=>{l&&l(i);let m,y,w=!1;return Array.isArray(h)?(y=h,!0):(m=h.create(o).injector,y=m.get(d_,[],{optional:!0,self:!0}).flat()),{routes:y.map(j2),injector:m}}))}(l,this.compiler,o,this.onLoadEndListener).pipe(D2(()=>{this.childrenLoaders.delete(l)})),y=new YO(m,()=>new kn).pipe(E2());return this.childrenLoaders.set(l,y),y}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function Bk(i){return function B4(i){return i&&"object"==typeof i&&"default"in i}(i)?i.default:i}let vM=(()=>{class i{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new kn,this.transitionAbortSubject=new kn,this.configLoader=fe(H2),this.environmentInjector=fe(Gr),this.urlSerializer=fe(qx),this.rootContexts=fe(Qx),this.inputBindingEnabled=null!==fe(pM,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Fe(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=h=>this.events.next(new RB(h)),this.configLoader.onLoadStartListener=h=>this.events.next(new AB(h))}complete(){this.transitions?.complete()}handleNavigationRequest(o){const l=++this.navigationId;this.transitions?.next({...this.transitions.value,...o,id:l})}setupNavigations(o,l,h){return this.transitions=new Er({id:0,currentUrlTree:l,currentRawUrl:l,currentBrowserUrl:l,extractedUrl:o.urlHandlingStrategy.extract(l),urlAfterRedirects:o.urlHandlingStrategy.extract(l),rawUrl:l,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Xx,restoredState:null,currentSnapshot:h.snapshot,targetSnapshot:null,currentRouterState:h,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Po(m=>0!==m.id),Yn(m=>({...m,extractedUrl:o.urlHandlingStrategy.extract(m.rawUrl)})),rn(m=>{this.currentTransition=m;let y=!1,w=!1;return Fe(m).pipe(_o(D=>{this.currentNavigation={id:D.id,initialUrl:D.rawUrl,extractedUrl:D.extractedUrl,trigger:D.source,extras:D.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),rn(D=>{const S=D.currentBrowserUrl.toString(),k=!o.navigated||D.extractedUrl.toString()!==S||S!==D.currentUrlTree.toString();if(!k&&"reload"!==(D.extras.onSameUrlNavigation??o.onSameUrlNavigation)){const H="";return this.events.next(new s_(D.id,this.urlSerializer.serialize(D.rawUrl),H,0)),D.resolve(null),ts}if(o.urlHandlingStrategy.shouldProcessUrl(D.rawUrl))return Fe(D).pipe(rn(H=>{const J=this.transitions?.getValue();return this.events.next(new hM(H.id,this.urlSerializer.serialize(H.extractedUrl),H.source,H.restoredState)),J!==this.transitions?.getValue()?ts:Promise.resolve(H)}),function P4(i,r,o,l,h,m){return Ti(y=>function S4(i,r,o,l,h,m,y="emptyOnly"){return new I4(i,r,o,l,h,y,m).recognize()}(i,r,o,l,y.extractedUrl,h,m).pipe(Yn(({state:w,tree:D})=>({...y,targetSnapshot:w,urlAfterRedirects:D}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,o.config,this.urlSerializer,o.paramsInheritanceStrategy),_o(H=>{m.targetSnapshot=H.targetSnapshot,m.urlAfterRedirects=H.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:H.urlAfterRedirects};const J=new gk(H.id,this.urlSerializer.serialize(H.extractedUrl),this.urlSerializer.serialize(H.urlAfterRedirects),H.targetSnapshot);this.events.next(J)}));if(k&&o.urlHandlingStrategy.shouldProcessUrl(D.currentRawUrl)){const{id:H,extractedUrl:J,source:ct,restoredState:mt,extras:Pt}=D,Wt=new hM(H,this.urlSerializer.serialize(J),ct,mt);this.events.next(Wt);const Et=xk(0,this.rootComponentType).snapshot;return this.currentTransition=m={...D,targetSnapshot:Et,urlAfterRedirects:J,extras:{...Pt,skipLocationChange:!1,replaceUrl:!1}},Fe(m)}{const H="";return this.events.next(new s_(D.id,this.urlSerializer.serialize(D.extractedUrl),H,1)),D.resolve(null),ts}}),_o(D=>{const S=new MB(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot);this.events.next(S)}),Yn(D=>(this.currentTransition=m={...D,guards:KB(D.targetSnapshot,D.currentSnapshot,this.rootContexts)},m)),function l4(i,r){return Ti(o=>{const{targetSnapshot:l,currentSnapshot:h,guards:{canActivateChecks:m,canDeactivateChecks:y}}=o;return 0===y.length&&0===m.length?Fe({...o,guardsResult:!0}):function c4(i,r,o,l){return Gi(i).pipe(Ti(h=>function m4(i,r,o,l,h){const m=r&&r.routeConfig?r.routeConfig.canDeactivate:null;return m&&0!==m.length?Fe(m.map(w=>{const D=t1(r)??h,S=c_(w,D);return Hh(function o4(i){return i&&r1(i.canDeactivate)}(S)?S.canDeactivate(i,r,o,l):D.runInContext(()=>S(i,r,o,l))).pipe(up())})).pipe(u_()):Fe(!0)}(h.component,h.route,o,r,l)),up(h=>!0!==h,!0))}(y,l,h,i).pipe(Ti(w=>w&&function e4(i){return"boolean"==typeof i}(w)?function u4(i,r,o,l){return Gi(r).pipe($x(h=>YD(function d4(i,r){return null!==i&&r&&r(new PB(i)),Fe(!0)}(h.route.parent,l),function h4(i,r){return null!==i&&r&&r(new kB(i)),Fe(!0)}(h.route,l),function p4(i,r,o){const l=r[r.length-1],m=r.slice(0,r.length-1).reverse().map(y=>function QB(i){const r=i.routeConfig?i.routeConfig.canActivateChild:null;return r&&0!==r.length?{node:i,guards:r}:null}(y)).filter(y=>null!==y).map(y=>JD(()=>Fe(y.guards.map(D=>{const S=t1(y.node)??o,k=c_(D,S);return Hh(function r4(i){return i&&r1(i.canActivateChild)}(k)?k.canActivateChild(l,i):S.runInContext(()=>k(l,i))).pipe(up())})).pipe(u_())));return Fe(m).pipe(u_())}(i,h.path,o),function f4(i,r,o){const l=r.routeConfig?r.routeConfig.canActivate:null;if(!l||0===l.length)return Fe(!0);const h=l.map(m=>JD(()=>{const y=t1(r)??o,w=c_(m,y);return Hh(function i4(i){return i&&r1(i.canActivate)}(w)?w.canActivate(r,i):y.runInContext(()=>w(r,i))).pipe(up())}));return Fe(h).pipe(u_())}(i,h.route,o))),up(h=>!0!==h,!0))}(l,m,i,r):Fe(w)),Yn(w=>({...o,guardsResult:w})))})}(this.environmentInjector,D=>this.events.next(D)),_o(D=>{if(m.guardsResult=D.guardsResult,fp(D.guardsResult))throw Dk(0,D.guardsResult);const S=new TB(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot,!!D.guardsResult);this.events.next(S)}),Po(D=>!!D.guardsResult||(this.cancelNavigationTransition(D,"",3),!1)),$2(D=>{if(D.guards.canActivateChecks.length)return Fe(D).pipe(_o(S=>{const k=new SB(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(k)}),rn(S=>{let k=!1;return Fe(S).pipe(function O4(i,r){return Ti(o=>{const{targetSnapshot:l,guards:{canActivateChecks:h}}=o;if(!h.length)return Fe(o);let m=0;return Gi(h).pipe($x(y=>function k4(i,r,o,l){const h=i.routeConfig,m=i._resolve;return void 0!==h?.title&&!zk(h)&&(m[Hx]=h.title),function L4(i,r,o,l){const h=function F4(i){return[...Object.keys(i),...Object.getOwnPropertySymbols(i)]}(i);if(0===h.length)return Fe({});const m={};return Gi(h).pipe(Ti(y=>function N4(i,r,o,l){const h=t1(r)??l,m=c_(i,h);return Hh(m.resolve?m.resolve(r,o):h.runInContext(()=>m(r,o)))}(i[y],r,o,l).pipe(up(),_o(w=>{m[y]=w}))),C2(1),function K3(i){return Yn(()=>i)}(m),hp(y=>Ak(y)?ts:Ux(y)))}(m,i,r,l).pipe(Yn(y=>(i._resolvedData=y,i.data=bk(i,o).resolve,h&&zk(h)&&(i.data[Hx]=h.title),null)))}(y.route,l,i,r)),_o(()=>m++),C2(1),Ti(y=>m===h.length?Fe(o):ts))})}(o.paramsInheritanceStrategy,this.environmentInjector),_o({next:()=>k=!0,complete:()=>{k||this.cancelNavigationTransition(S,"",2)}}))}),_o(S=>{const k=new IB(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(k)}))}),$2(D=>{const S=k=>{const z=[];k.routeConfig?.loadComponent&&!k.routeConfig._loadedComponent&&z.push(this.configLoader.loadComponent(k.routeConfig).pipe(_o(H=>{k.component=H}),Yn(()=>{})));for(const H of k.children)z.push(...S(H));return z};return WD(S(D.targetSnapshot.root)).pipe(rM(),ua(1))}),$2(()=>this.afterPreactivation()),Yn(D=>{const S=function jB(i,r,o){const l=Jx(i,r._root,o?o._root:void 0);return new vk(l,r)}(o.routeReuseStrategy,D.targetSnapshot,D.currentRouterState);return this.currentTransition=m={...D,targetRouterState:S},m}),_o(()=>{this.events.next(new R2)}),((i,r,o,l)=>Yn(h=>(new XB(r,h.targetRouterState,h.currentRouterState,o,l).activate(i),h)))(this.rootContexts,o.routeReuseStrategy,D=>this.events.next(D),this.inputBindingEnabled),ua(1),_o({next:D=>{y=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Gh(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects))),o.titleStrategy?.updateTitle(D.targetRouterState.snapshot),D.resolve(!0)},complete:()=>{y=!0}}),GD(this.transitionAbortSubject.pipe(_o(D=>{throw D}))),D2(()=>{y||w||this.cancelNavigationTransition(m,"",1),this.currentNavigation?.id===m.id&&(this.currentNavigation=null)}),hp(D=>{if(w=!0,Tk(D))this.events.next(new Kx(m.id,this.urlSerializer.serialize(m.extractedUrl),D.message,D.cancellationCode)),function $B(i){return Tk(i)&&fp(i.url)}(D)?this.events.next(new P2(D.url)):m.resolve(!1);else{this.events.next(new dM(m.id,this.urlSerializer.serialize(m.extractedUrl),D,m.targetSnapshot??void 0));try{m.resolve(o.errorHandler(D))}catch(S){m.reject(S)}}return ts}))}))}cancelNavigationTransition(o,l,h){const m=new Kx(o.id,this.urlSerializer.serialize(o.extractedUrl),l,h);this.events.next(m),o.resolve(!1)}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function jk(i){return i!==Xx}let Vk=(()=>{class i{buildTitle(o){let l,h=o.root;for(;void 0!==h;)l=this.getResolvedTitleForRoute(h)??l,h=h.children.find(m=>m.outlet===bn);return l}getResolvedTitleForRoute(o){return o.data[Hx]}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:function(){return fe(j4)},providedIn:"root"})}return i})(),j4=(()=>{class i extends Vk{constructor(o){super(),this.title=o}updateTitle(o){const l=this.buildTitle(o);void 0!==l&&this.title.setTitle(l)}static#t=this.\u0275fac=function(l){return new(l||i)(St(PP))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),V4=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:function(){return fe($4)},providedIn:"root"})}return i})();class U4{shouldDetach(r){return!1}store(r,o){}shouldAttach(r){return!1}retrieve(r){return null}shouldReuseRoute(r,o){return r.routeConfig===o.routeConfig}}let $4=(()=>{class i extends U4{static#t=this.\u0275fac=function(){let o;return function(h){return(o||(o=function nm(i){return ga(()=>{const r=i.prototype.constructor,o=r[rs]||Gu(r),l=Object.prototype;let h=Object.getPrototypeOf(i.prototype).constructor;for(;h&&h!==l;){const m=h[rs]||Gu(h);if(m&&m!==o)return m;h=Object.getPrototypeOf(h)}return m=>new m})}(i)))(h||i)}}();static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();const xM=new le("",{providedIn:"root",factory:()=>({})});let H4=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:function(){return fe(G4)},providedIn:"root"})}return i})(),G4=(()=>{class i{shouldProcessUrl(o){return!0}extract(o){return o}merge(o,l){return o}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var o1=function(i){return i[i.COMPLETE=0]="COMPLETE",i[i.FAILED=1]="FAILED",i[i.REDIRECTING=2]="REDIRECTING",i}(o1||{});function Uk(i,r){i.events.pipe(Po(o=>o instanceof Gh||o instanceof Kx||o instanceof dM||o instanceof s_),Yn(o=>o instanceof Gh||o instanceof s_?o1.COMPLETE:o instanceof Kx&&(0===o.code||1===o.code)?o1.REDIRECTING:o1.FAILED),Po(o=>o!==o1.REDIRECTING),ua(1)).subscribe(()=>{r()})}function q4(i){throw i}function Z4(i,r,o){return r.parse("/")}const W4={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Y4={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Ds=(()=>{class i{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=fe(qg),this.isNgZoneEnabled=!1,this._events=new kn,this.options=fe(xM,{optional:!0})||{},this.pendingTasks=fe(cD),this.errorHandler=this.options.errorHandler||q4,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||Z4,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=fe(H4),this.routeReuseStrategy=fe(V4),this.titleStrategy=fe(Vk),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=fe(d_,{optional:!0})?.flat()??[],this.navigationTransitions=fe(vM),this.urlSerializer=fe(qx),this.location=fe(Rx),this.componentInputBindingEnabled=!!fe(pM,{optional:!0}),this.eventsSubscription=new st,this.isNgZoneEnabled=fe(Dn)instanceof Dn&&Dn.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new o_,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=xk(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(o=>{this.lastSuccessfulId=o.id,this.currentPageId=this.browserPageId},o=>{this.console.warn(`Unhandled Navigation Error: ${o}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const o=this.navigationTransitions.events.subscribe(l=>{try{const{currentTransition:h}=this.navigationTransitions;if(null===h)return void($k(l)&&this._events.next(l));if(l instanceof hM)jk(h.source)&&(this.browserUrlTree=h.extractedUrl);else if(l instanceof s_)this.rawUrlTree=h.rawUrl;else if(l instanceof gk){if("eager"===this.urlUpdateStrategy){if(!h.extras.skipLocationChange){const m=this.urlHandlingStrategy.merge(h.urlAfterRedirects,h.rawUrl);this.setBrowserUrl(m,h)}this.browserUrlTree=h.urlAfterRedirects}}else if(l instanceof R2)this.currentUrlTree=h.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(h.urlAfterRedirects,h.rawUrl),this.routerState=h.targetRouterState,"deferred"===this.urlUpdateStrategy&&(h.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,h),this.browserUrlTree=h.urlAfterRedirects);else if(l instanceof Kx)0!==l.code&&1!==l.code&&(this.navigated=!0),(3===l.code||2===l.code)&&this.restoreHistory(h);else if(l instanceof P2){const m=this.urlHandlingStrategy.merge(l.url,h.currentRawUrl),y={skipLocationChange:h.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||jk(h.source)};this.scheduleNavigation(m,Xx,null,y,{resolve:h.resolve,reject:h.reject,promise:h.promise})}l instanceof dM&&this.restoreHistory(h,!0),l instanceof Gh&&(this.navigated=!0),$k(l)&&this._events.next(l)}catch(h){this.navigationTransitions.transitionAbortSubject.next(h)}});this.eventsSubscription.add(o)}resetRootComponentType(o){this.routerState.root.component=o,this.navigationTransitions.rootComponentType=o}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const o=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Xx,o)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(o=>{const l="popstate"===o.type?"popstate":"hashchange";"popstate"===l&&setTimeout(()=>{this.navigateToSyncWithBrowser(o.url,l,o.state)},0)}))}navigateToSyncWithBrowser(o,l,h){const m={replaceUrl:!0},y=h?.navigationId?h:null;if(h){const D={...h};delete D.navigationId,delete D.\u0275routerPageId,0!==Object.keys(D).length&&(m.state=D)}const w=this.parseUrl(o);this.scheduleNavigation(w,l,y,m)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(o){this.config=o.map(j2),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(o,l={}){const{relativeTo:h,queryParams:m,fragment:y,queryParamsHandling:w,preserveFragment:D}=l,S=D?this.currentUrlTree.fragment:y;let z,k=null;switch(w){case"merge":k={...this.currentUrlTree.queryParams,...m};break;case"preserve":k=this.currentUrlTree.queryParams;break;default:k=m||null}null!==k&&(k=this.removeEmptyProps(k));try{z=ck(h?h.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof o[0]||!o[0].startsWith("/"))&&(o=[]),z=this.currentUrlTree.root}return uk(z,o,k,S??null)}navigateByUrl(o,l={skipLocationChange:!1}){const h=fp(o)?o:this.parseUrl(o),m=this.urlHandlingStrategy.merge(h,this.rawUrlTree);return this.scheduleNavigation(m,Xx,null,l)}navigate(o,l={skipLocationChange:!1}){return function X4(i){for(let r=0;r<i.length;r++)if(null==i[r])throw new Jt(4008,!1)}(o),this.navigateByUrl(this.createUrlTree(o,l),l)}serializeUrl(o){return this.urlSerializer.serialize(o)}parseUrl(o){let l;try{l=this.urlSerializer.parse(o)}catch(h){l=this.malformedUriErrorHandler(h,this.urlSerializer,o)}return l}isActive(o,l){let h;if(h=!0===l?{...W4}:!1===l?{...Y4}:l,fp(o))return tk(this.currentUrlTree,o,h);const m=this.parseUrl(o);return tk(this.currentUrlTree,m,h)}removeEmptyProps(o){return Object.keys(o).reduce((l,h)=>{const m=o[h];return null!=m&&(l[h]=m),l},{})}scheduleNavigation(o,l,h,m,y){if(this.disposed)return Promise.resolve(!1);let w,D,S;y?(w=y.resolve,D=y.reject,S=y.promise):S=new Promise((z,H)=>{w=z,D=H});const k=this.pendingTasks.add();return Uk(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(k))}),this.navigationTransitions.handleNavigationRequest({source:l,restoredState:h,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:o,extras:m,resolve:w,reject:D,promise:S,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),S.catch(z=>Promise.reject(z))}setBrowserUrl(o,l){const h=this.urlSerializer.serialize(o);if(this.location.isCurrentPathEqualTo(h)||l.extras.replaceUrl){const y={...l.extras.state,...this.generateNgRouterState(l.id,this.browserPageId)};this.location.replaceState(h,"",y)}else{const m={...l.extras.state,...this.generateNgRouterState(l.id,this.browserPageId+1)};this.location.go(h,"",m)}}restoreHistory(o,l=!1){if("computed"===this.canceledNavigationResolution){const m=this.currentPageId-this.browserPageId;0!==m?this.location.historyGo(m):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===m&&(this.resetState(o),this.browserUrlTree=o.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(l&&this.resetState(o),this.resetUrlToCurrentUrlTree())}resetState(o){this.routerState=o.currentRouterState,this.currentUrlTree=o.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,o.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(o,l){return"computed"===this.canceledNavigationResolution?{navigationId:o,\u0275routerPageId:l}:{navigationId:o}}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function $k(i){return!(i instanceof R2||i instanceof P2)}class Hk{}let J4=(()=>{class i{constructor(o,l,h,m,y){this.router=o,this.injector=h,this.preloadingStrategy=m,this.loader=y}setUpPreloading(){this.subscription=this.router.events.pipe(Po(o=>o instanceof Gh),$x(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(o,l){const h=[];for(const m of l){m.providers&&!m._injector&&(m._injector=Pg(m.providers,o,`Route: ${m.path}`));const y=m._injector??o,w=m._loadedInjector??y;(m.loadChildren&&!m._loadedRoutes&&void 0===m.canLoad||m.loadComponent&&!m._loadedComponent)&&h.push(this.preloadConfig(y,m)),(m.children||m._loadedRoutes)&&h.push(this.processRoutes(w,m.children??m._loadedRoutes))}return Gi(h).pipe(Ka())}preloadConfig(o,l){return this.preloadingStrategy.preload(l,()=>{let h;h=l.loadChildren&&void 0===l.canLoad?this.loader.loadChildren(o,l):Fe(null);const m=h.pipe(Ti(y=>null===y?Fe(void 0):(l._loadedRoutes=y.routes,l._loadedInjector=y.injector,this.processRoutes(y.injector??o,y.routes))));return l.loadComponent&&!l._loadedComponent?Gi([m,this.loader.loadComponent(l)]).pipe(Ka()):m})}static#t=this.\u0275fac=function(l){return new(l||i)(St(Ds),St(uD),St(Gr),St(Hk),St(H2))};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();const q2=new le("");let Gk=(()=>{class i{constructor(o,l,h,m,y={}){this.urlSerializer=o,this.transitions=l,this.viewportScroller=h,this.zone=m,this.options=y,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},y.scrollPositionRestoration=y.scrollPositionRestoration||"disabled",y.anchorScrolling=y.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(o=>{o instanceof hM?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=o.navigationTrigger,this.restoredId=o.restoredState?o.restoredState.navigationId:0):o instanceof Gh?(this.lastId=o.id,this.scheduleScrollEvent(o,this.urlSerializer.parse(o.urlAfterRedirects).fragment)):o instanceof s_&&0===o.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(o,this.urlSerializer.parse(o.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(o=>{o instanceof _k&&(o.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(o.position):o.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(o.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(o,l){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new _k(o,"popstate"===this.lastSource?this.store[this.restoredId]:null,l))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#t=this.\u0275fac=function(l){Cv()};static#e=this.\u0275prov=he({token:i,factory:i.\u0275fac})}return i})();function lu(i,r){return{\u0275kind:i,\u0275providers:r}}function Zk(){const i=fe(hr);return r=>{const o=i.get(j);if(r!==o.components[0])return;const l=i.get(Ds),h=i.get(Wk);1===i.get(Z2)&&l.initialNavigation(),i.get(Yk,null,En.Optional)?.setUpPreloading(),i.get(q2,null,En.Optional)?.init(),l.resetRootComponentType(o.componentTypes[0]),h.closed||(h.next(),h.complete(),h.unsubscribe())}}const Wk=new le("",{factory:()=>new kn}),Z2=new le("",{providedIn:"root",factory:()=>1}),Yk=new le("");function r5(i){return lu(0,[{provide:Yk,useExisting:J4},{provide:Hk,useExisting:i}])}const Xk=new le("ROUTER_FORROOT_GUARD"),s5=[Rx,{provide:qx,useClass:M2},Ds,Qx,{provide:l_,useFactory:function qk(i){return i.routerState.root},deps:[Ds]},H2,[]];function a5(){return new E("Router",Ds)}let W2=(()=>{class i{constructor(o){}static forRoot(o,l){return{ngModule:i,providers:[s5,[],{provide:d_,multi:!0,useValue:o},{provide:Xk,useFactory:h5,deps:[[Ds,new Sr,new Pd]]},{provide:xM,useValue:l||{}},l?.useHash?{provide:sp,useClass:dL}:{provide:sp,useClass:XR},{provide:q2,useFactory:()=>{const i=fe(kF),r=fe(Dn),o=fe(xM),l=fe(vM),h=fe(qx);return o.scrollOffset&&i.setOffset(o.scrollOffset),new Gk(h,l,i,r,o)}},l?.preloadingStrategy?r5(l.preloadingStrategy).\u0275providers:[],{provide:E,multi:!0,useFactory:a5},l?.initialNavigation?d5(l):[],l?.bindToComponentInputs?lu(8,[Ck,{provide:pM,useExisting:Ck}]).\u0275providers:[],[{provide:Kk,useFactory:Zk},{provide:g,multi:!0,useExisting:Kk}]]}}static forChild(o){return{ngModule:i,providers:[{provide:d_,multi:!0,useValue:o}]}}static#t=this.\u0275fac=function(l){return new(l||i)(St(Xk,8))};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({})}return i})();function h5(i){return"guarded"}function d5(i){return["disabled"===i.initialNavigation?lu(3,[{provide:Gg,multi:!0,useFactory:()=>{const r=fe(Ds);return()=>{r.setUpLocationChangeListener()}}},{provide:Z2,useValue:2}]).\u0275providers:[],"enabledBlocking"===i.initialNavigation?lu(2,[{provide:Z2,useValue:0},{provide:Gg,multi:!0,deps:[hr],useFactory:r=>{const o=r.get(uL,Promise.resolve());return()=>o.then(()=>new Promise(l=>{const h=r.get(Ds),m=r.get(Wk);Uk(h,()=>{l(!0)}),r.get(vM).afterPreactivation=()=>(l(!0),m.closed?Fe(void 0):m),h.initialNavigation()}))}}]).\u0275providers:[]]}const Kk=new le("");let p5=(()=>{class i{constructor(){this.title="my-wedding"}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275cmp=Ni({type:i,selectors:[["app-root"]],decls:1,vars:0,template:function(l,h){1&l&&ke(0,"router-outlet")},dependencies:[z2]})}return i})(),m5=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({imports:[dP,W2,ZO]})}return i})(),g5=(()=>{class i{constructor(o){this.router=o}navigate(){this.router.navigate(["/invitation"])}static#t=this.\u0275fac=function(l){return new(l||i)(re(Ds))};static#e=this.\u0275cmp=Ni({type:i,selectors:[["page-envelope"]],decls:15,vars:0,consts:[[1,"bg"],[1,"container","d-flex","align-items-center","align-content-between","altura"],[1,"row"],[1,"col-xs-6","col-md-6"],[1,"animate__animated","animate__fadeIn","animate__slow","display-1","text-center"],[1,"animate__animated","animate__fadeIn","animate__slow","animate__delay-1s","display-2","text-center"],[1,"animate__animated","animate__fadeIn","animate__slow","animate__delay-1s","display-6","text-center"],[1,"col-xs-6","col-md-6","animate__animated","animate__fadeInRight","animate__delay-1s","justify-content-center","align-items-center","d-flex"],["src","assets/photos/envelope.png","alt","",1,"animate__animated","animate__bounce","animate__delay-2s",3,"click"]],template:function(l,h){1&l&&(Vt(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"p",4),Ee(5," Estas cordialmente invitado a nuestra boda "),Zt(),ke(6,"br"),Vt(7,"p",5),Ee(8," Carlos "),Zt(),Vt(9,"p",6),Ee(10," & "),Zt(),Vt(11,"p",5),Ee(12," Carolina "),Zt()(),Vt(13,"div",7)(14,"img",8),Na("click",function(){return h.navigate()}),Zt()()()()())},styles:[".bg[_ngcontent-%COMP%]{background-image:url(https://carlosrdzcas.github.io/MyWedding/assets/photos/bgpapiro.jpg);background-size:cover}img[_ngcontent-%COMP%]{width:100%;height:450px}*[_ngcontent-%COMP%]{font-family:HarryPotter;font-weight:bolder}.altura[_ngcontent-%COMP%]{height:100vh}p[_ngcontent-%COMP%]{color:#5f603e}button[_ngcontent-%COMP%]{height:50px;width:150px;justify-content:center;font-size:large}@media (max-width: 728px){img[_ngcontent-%COMP%]{margin-top:20px;width:75%;height:220px}}@font-face{font-family:HarryPotter;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/harry-potter/Harry-Potter.ttf)}"]})}return i})(),_5=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275cmp=Ni({type:i,selectors:[["wedding-our-photo"]],decls:10,vars:0,consts:[[1,"center","justify-content-around"],[1,"center"],["src","assets/photos/us4.png","alt","Novio",1,"card-img","image-photo","animate__animated","animate__fadeIn","animate__delay-1s"],[1,"card-img-overlay","d-flex","justify-content-center","animate__animated","animate__slideInDown","animate__delay-1s"],[1,"text-light","fw-bolder","p-2","display-3"],[1,"mt-4","text-center"]],template:function(l,h){1&l&&(Vt(0,"div",0)(1,"div",1),ke(2,"img",2),Zt(),Vt(3,"div",3)(4,"div",4)(5,"p",5),Ee(6,"Nuestra Boda"),Zt(),Vt(7,"p",5),Ee(8,"Carlos & Carolina"),Zt(),ke(9,"p"),Zt()()())},styles:[".image-photo[_ngcontent-%COMP%]{height:100vh;background-repeat:no-repeat}.textsize[_ngcontent-%COMP%]{height:100px;width:100px}.glass[_ngcontent-%COMP%]{-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);border-radius:30px;width:-moz-fit-content;width:fit-content;background-color:#0003}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}*[_ngcontent-%COMP%]{font-family:GreatVibes}@media screen and (max-width: 767px){.image-photo[_ngcontent-%COMP%]{height:100vh;background-repeat:no-repeat}}"]})}return i})(),y5=(()=>{class i{constructor(){this.audio=new Audio("assets/audio/todocambio.mpeg")}ngOnInit(){this.audio.load(),this.audio.play()}playSound(o){this.audio.muted=!1,this.audio.paused?(this.audio.play(),o.textContent="Pause"):(this.audio.pause(),o.textContent="Play")}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275cmp=Ni({type:i,selectors:[["wedding-fab"]],decls:4,vars:0,consts:[[1,"title","fw-bolder","position-absolute","bottom-0","end-0","rounded-circle","m-5"],["id","sonido","type","button",1,"btn","btn-success","btn-lg","float",3,"click"],[1,"icon"]],template:function(l,h){1&l&&(Vt(0,"div",0)(1,"button",1),Na("click",function(y){return h.playSound(y.target)}),Vt(2,"i",2),Ee(3,"Pause"),Zt()()())},styles:[".float[_ngcontent-%COMP%]{position:fixed;bottom:1rem;right:1rem}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}@font-face{font-family:Monteserrat;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/montserrat/Montserrat-Regular.ttf)}.body[_ngcontent-%COMP%]{font-family:Monteserrat}"]})}return i})();VP(0,1e3);let v5=(()=>{class i{ngOnInit(){const o=new Date("2024-05-25 17:00:00");function h(k,z,H){k.textContent=H,z.textContent=H}function m(k,z){const H=function l(k){const z=k.querySelector(".segment-display"),H=z.querySelector(".segment-display__top"),J=z.querySelector(".segment-display__bottom"),ct=z.querySelector(".segment-overlay"),mt=ct.querySelector(".segment-overlay__top"),Pt=ct.querySelector(".segment-overlay__bottom");return{segmentDisplayTop:H,segmentDisplayBottom:J,segmentOverlay:ct,segmentOverlayTop:mt,segmentOverlayBottom:Pt}}(k);parseInt(H.segmentDisplayTop.textContent,10)!==z&&(H.segmentOverlay.classList.add("flip"),h(H.segmentDisplayTop,H.segmentOverlayBottom,z),H.segmentOverlay.addEventListener("animationend",function J(){H.segmentOverlay.classList.remove("flip"),h(H.segmentDisplayBottom,H.segmentOverlayTop,z),removeEventListener("animationend",J)}))}function y(k,z){const H=Math.floor(z/10)||0,J=z%10||0,mt=document.getElementById(k).querySelectorAll(".time-segment");m(mt[0],H),m(mt[1],J)}function D(){const k=function w(k){let z=0,H=0,J=0,ct=0;const mt=new Date,Pt=mt>=k;return Pt?{complete:Pt,seconds:0,minutes:0,hours:0,days:0}:(z=Math.abs(Date.UTC(k.getFullYear(),k.getMonth(),k.getDate(),k.getHours(),k.getMinutes(),k.getSeconds())-Date.UTC(mt.getFullYear(),mt.getMonth(),mt.getDate(),mt.getHours(),mt.getMinutes(),mt.getSeconds()))/1e3,H=Math.floor(z/60),J=Math.floor(H/60),ct=Math.floor(J/24),J-=24*ct,H=H-24*ct*60-60*J,z=z-24*ct*60*60-60*J*60-60*H,{complete:Pt,seconds:z,minutes:H,hours:J,days:ct})}(o);return y("seconds",k.seconds),y("minutes",k.minutes),y("hours",k.hours),y("days",k.days),k.complete}const S=setInterval(()=>{D()&&clearInterval(S)},1e3);D()}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275cmp=Ni({type:i,selectors:[["wedding-invitacion"]],decls:81,vars:0,consts:[[1,"col","text-justify","text-center","p-4"],[1,"title","fw-bolder","display-4","font-weight-bold"],[1,"body","display-6"],[1,"row"],[1,"countdown","justify-content-around","d-flex","row-"],["id","days",1,"time-section"],[1,"time-group"],[1,"time-segment"],[1,"segment-display"],[1,"segment-display__top"],[1,"segment-display__bottom"],[1,"segment-overlay"],[1,"segment-overlay__top"],[1,"segment-overlay__bottom"],[1,"body"],["id","hours",1,"time-section"],["id","minutes",1,"time-section"],["id","seconds",1,"time-section"]],template:function(l,h){1&l&&(Vt(0,"div",0)(1,"div")(2,"p",1),Ee(3,"Te invitamos a nuestra boda"),Zt()(),Vt(4,"div")(5,"p",2),Ee(6,"Faltan"),Zt()(),Vt(7,"div",3)(8,"div",4)(9,"div",5)(10,"div",6)(11,"div",7)(12,"div",8),ke(13,"div",9)(14,"div",10),Vt(15,"div",11),ke(16,"div",12)(17,"div",13),Zt()()(),Vt(18,"div",7)(19,"div",8),ke(20,"div",9)(21,"div",10),Vt(22,"div",11),ke(23,"div",12)(24,"div",13),Zt()()()(),Vt(25,"p",14),Ee(26,"Dias"),Zt()(),Vt(27,"div",15)(28,"div",6)(29,"div",7)(30,"div",8),ke(31,"div",9)(32,"div",10),Vt(33,"div",11),ke(34,"div",12)(35,"div",13),Zt()()(),Vt(36,"div",7)(37,"div",8),ke(38,"div",9)(39,"div",10),Vt(40,"div",11),ke(41,"div",12)(42,"div",13),Zt()()()(),Vt(43,"p",14),Ee(44,"Horas"),Zt()(),Vt(45,"div",16)(46,"div",6)(47,"div",7)(48,"div",8),ke(49,"div",9)(50,"div",10),Vt(51,"div",11),ke(52,"div",12)(53,"div",13),Zt()()(),Vt(54,"div",7)(55,"div",8),ke(56,"div",9)(57,"div",10),Vt(58,"div",11),ke(59,"div",12)(60,"div",13),Zt()()()(),Vt(61,"p",14),Ee(62,"Minutos"),Zt()(),Vt(63,"div",17)(64,"div",6)(65,"div",7)(66,"div",8),ke(67,"div",9)(68,"div",10),Vt(69,"div",11),ke(70,"div",12)(71,"div",13),Zt()()(),Vt(72,"div",7)(73,"div",8),ke(74,"div",9)(75,"div",10),Vt(76,"div",11),ke(77,"div",12)(78,"div",13),Zt()()()(),Vt(79,"p",14),Ee(80,"Segundos"),Zt()()()()())},styles:["@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}@font-face{font-family:Monteserrat;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/montserrat/Montserrat-Regular.ttf)}.body[_ngcontent-%COMP%]{font-family:Monteserrat}.title[_ngcontent-%COMP%]{font-family:GreatVibes}.bg[_ngcontent-%COMP%]{background-image:url(https://carlosrdzcas.github.io/MyWedding/assets/photos/bgpapiro.jpg);background-size:cover}*[_ngcontent-%COMP%]{box-sizing:border-box}.countdown[_ngcontent-%COMP%]{margin:80px auto;width:50%;display:flex;gap:30px;font-family:Monteserrat}.time-section[_ngcontent-%COMP%]{font-size:30px}.time-group[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:10px}.time-segment[_ngcontent-%COMP%]{display:block;font-size:100px;font-weight:900;width:70px}.segment-display[_ngcontent-%COMP%]{position:relative;height:100%}.segment-display__top[_ngcontent-%COMP%], .segment-display__bottom[_ngcontent-%COMP%]{overflow:hidden;text-align:center;width:100%;height:50%;position:relative}.segment-display__top[_ngcontent-%COMP%]{line-height:1.5;color:#eee;background-color:#111}.segment-display__bottom[_ngcontent-%COMP%]{line-height:0;color:#fff;background-color:#333}.segment-overlay[_ngcontent-%COMP%]{position:absolute;display:block;top:0;perspective:400px;height:100%;width:70px}.segment-overlay__top[_ngcontent-%COMP%], .segment-overlay__bottom[_ngcontent-%COMP%]{position:absolute;overflow:hidden;display:block;text-align:center;width:100%;height:50%}.segment-overlay__top[_ngcontent-%COMP%]{top:0;display:block;line-height:1.5;color:#fff;background-color:#111;transform-origin:bottom}.segment-overlay__bottom[_ngcontent-%COMP%]{display:block;bottom:0;line-height:0;color:#eee;background-color:#333;border-top:2px solid black;transform-origin:top}.segment-overlay.flip[_ngcontent-%COMP%]   .segment-overlay__top[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_flip-top .8s linear}.segment-overlay.flip[_ngcontent-%COMP%]   .segment-overlay__bottom[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_flip-bottom .8s linear}@keyframes _ngcontent-%COMP%_flip-top{0%{-webkit-transform:rotateX(0deg)}50%,to{-webkit-transform:rotateX(-90deg)}}@keyframes _ngcontent-%COMP%_flip-bottom{0%,50%{-webkit-transform:rotateX(90deg)}to{-webkit-transform:rotateX(0deg)}}@keyframes _ngcontent-%COMP%_flip-top{0%{transform:rotateX(0)}50%,to{transform:rotateX(-90deg)}}@keyframes _ngcontent-%COMP%_flip-bottom{0%,50%{transform:rotateX(90deg)}to{transform:rotateX(0)}}@media screen and (max-width: 800px){.countdown[_ngcontent-%COMP%]{margin:4px auto;width:50%;display:flex;gap:10px;font-family:Monteserrat}.time-section[_ngcontent-%COMP%]{font-size:15px}.time-group[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:3px}.time-segment[_ngcontent-%COMP%]{display:block;font-size:50px;font-weight:900;width:40px}.segment-display[_ngcontent-%COMP%]{position:relative;height:100%}.segment-display__top[_ngcontent-%COMP%], .segment-display__bottom[_ngcontent-%COMP%]{overflow:hidden;text-align:center;width:100%;height:50%;position:relative}.segment-display__top[_ngcontent-%COMP%]{line-height:1.5;color:#eee;background-color:#111}.segment-display__bottom[_ngcontent-%COMP%]{line-height:0;color:#fff;background-color:#333}.segment-overlay[_ngcontent-%COMP%]{position:absolute;top:0;perspective:400px;height:100%;width:40px}.segment-overlay__top[_ngcontent-%COMP%], .segment-overlay__bottom[_ngcontent-%COMP%]{position:absolute;overflow:hidden;text-align:center;width:100%;height:50%}.segment-overlay__top[_ngcontent-%COMP%]{top:0;line-height:1.5;color:#fff;background-color:#111;transform-origin:bottom}.segment-overlay__bottom[_ngcontent-%COMP%]{bottom:0;line-height:0;color:#eee;background-color:#333;border-top:2px solid black;transform-origin:top}.segment-overlay.flip[_ngcontent-%COMP%]   .segment-overlay__top[_ngcontent-%COMP%]{animation:flip-top .8s linear}.segment-overlay.flip[_ngcontent-%COMP%]   .segment-overlay__bottom[_ngcontent-%COMP%]{animation:flip-bottom .8s linear}}"]})}return i})();var bM=hu(574);let x5=(()=>{class i{ngOnInit(){this.mapa=new bM.Map({accessToken:"pk.eyJ1IjoiY2FybG9zOTg1NiIsImEiOiJjbDQzNHIyamMxaTJoM2pweDE1dGdsODZ6In0.F8JVwEIzHcWD8XTnzV3JPw",container:"mapa",style:"mapbox://styles/mapbox/streets-v12",center:[-99.5396777,27.4561691],zoom:16.6}),this.crearMarcador(-99.5396777,27.4561691)}crearMarcador(o,l){new bM.Marker({draggable:!1,color:"#FF0000"}).setLngLat([o,l]).addTo(this.mapa)}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275cmp=Ni({type:i,selectors:[["wedding-dialog-iglesia"]],decls:7,vars:0,consts:[[1,"tam"],[1,"title","fw-bolder","p-3","fw-bold"],["id","mapa"],["mat-button","","mat-dialog-close","",1,"body","btn","btn-danger"]],template:function(l,h){1&l&&(Vt(0,"div",0)(1,"h3",1),Ee(2,"Ubicacion de la Iglesia"),Zt(),ke(3,"mat-dialog-content",2),Vt(4,"mat-dialog-actions")(5,"button",3),Ee(6,"Cerrar"),Zt()()())},dependencies:[HO,GO,qO],styles:["[_nghost-%COMP%]{display:block}.tam[_ngcontent-%COMP%]{height:85vh;width:100vw}#mapa[_ngcontent-%COMP%]{height:80vh;width:100vw}*[_ngcontent-%COMP%]{z-index:1}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}@font-face{font-family:Monteserrat;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/montserrat/Montserrat-Regular.ttf)}.body[_ngcontent-%COMP%]{font-family:Monteserrat}"]})}return i})(),b5=(()=>{class i{ngOnInit(){this.mapa=new bM.Map({accessToken:"pk.eyJ1IjoiY2FybG9zOTg1NiIsImEiOiJjbDQzNHIyamMxaTJoM2pweDE1dGdsODZ6In0.F8JVwEIzHcWD8XTnzV3JPw",container:"mapa",style:"mapbox://styles/mapbox/streets-v12",center:[-99.5163921,27.4663813],zoom:16.6}),this.crearMarcador(-99.5163921,27.4663813)}crearMarcador(o,l){new bM.Marker({draggable:!1,color:"#FF0000"}).setLngLat([o,l]).addTo(this.mapa)}static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275cmp=Ni({type:i,selectors:[["wedding-dialog-salon"]],decls:7,vars:0,consts:[[1,"tam"],[1,"title","fw-bolder","p-3","fw-bold"],["id","mapa"],["mat-button","","mat-dialog-close","",1,"body","btn","btn-danger"]],template:function(l,h){1&l&&(Vt(0,"div",0)(1,"h3",1),Ee(2,"Ubicacion de la Recepcion"),Zt(),ke(3,"mat-dialog-content",2),Vt(4,"mat-dialog-actions")(5,"button",3),Ee(6,"Cerrar"),Zt()()())},dependencies:[HO,GO,qO],styles:["[_nghost-%COMP%]{display:block}.tam[_ngcontent-%COMP%]{height:85vh;width:100vw}#mapa[_ngcontent-%COMP%]{height:80vh;width:100vw}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}@font-face{font-family:Monteserrat;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/montserrat/Montserrat-Regular.ttf)}.body[_ngcontent-%COMP%]{font-family:Monteserrat}"]})}return i})(),w5=(()=>{class i{constructor(o){this.dialog=o}openDialogIglesia(){this.dialog.open(x5).afterClosed().subscribe(l=>{})}openDialogSalon(){this.dialog.open(b5).afterClosed().subscribe(l=>{})}static#t=this.\u0275fac=function(l){return new(l||i)(re(w2))};static#e=this.\u0275cmp=Ni({type:i,selectors:[["wedding-lugares"]],decls:45,vars:0,consts:[[1,"bg"],[1,"row"],[1,"col-sm","p-4","text-justify","text-center"],[1,"col"],[1,"title","fw-bolder","display-4"],["src","https://cdn-icons-png.flaticon.com/512/89/89016.png","alt","",1,"icon"],[1,"body","row","mt-5","justify-content-evenly"],[1,"col","mb-1"],["src","https://carlosrdzcas.github.io/MyWedding/assets/photos/footprints.png","alt","",1,"footprints"],[1,"body","col"],[1,"body","mt-5"],[1,"body","btn","btn-success",3,"click"],["src","https://cdn-icons-png.flaticon.com/512/7182/7182837.png","alt","",1,"icon"],[1,"body","mt-3"]],template:function(l,h){1&l&&(Vt(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"p",4),Ee(5,"Ceremonia Religiosa"),Zt(),ke(6,"img",5),Zt(),Vt(7,"div",6)(8,"div",3)(9,"p"),Ee(10,"25 Mayo"),Zt()(),Vt(11,"div",7),ke(12,"img",8),Zt(),Vt(13,"div",9)(14,"p"),Ee(15,"05:00 PM"),Zt()()(),Vt(16,"div",10)(17,"p"),Ee(18,"Iglesia Santa Elena"),Zt()(),Vt(19,"div")(20,"button",11),Na("click",function(){return h.openDialogIglesia()}),Ee(21," Ver Ubicacion "),Zt()()(),Vt(22,"div",2)(23,"div",3)(24,"p",4),Ee(25,"Recepcion"),Zt(),ke(26,"img",12),Zt(),Vt(27,"div",6)(28,"div",3),ke(29,"br"),Vt(30,"p"),Ee(31,"25 Mayo"),Zt()(),Vt(32,"div",3),ke(33,"img",8),Zt(),Vt(34,"div",3)(35,"p"),Ee(36,"07:00 PM"),Zt(),Vt(37,"p"),Ee(38,"12:30 AM"),Zt()()(),Vt(39,"div",13)(40,"p"),Ee(41,"ARA Salon Terraza Alberca"),Zt()(),Vt(42,"div")(43,"button",11),Na("click",function(){return h.openDialogSalon()}),Ee(44," Ver Ubicacion "),Zt()()()()())},styles:[".icon[_ngcontent-%COMP%]{height:85px;width:85px}.footprints[_ngcontent-%COMP%]{height:30px;transform:rotate(90deg)}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}@font-face{font-family:Monteserrat;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/montserrat/Montserrat-Regular.ttf)}.body[_ngcontent-%COMP%]{font-family:Monteserrat}button[_ngcontent-%COMP%]{position:relative}"]})}return i})(),E5=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275cmp=Ni({type:i,selectors:[["wedding-us"]],decls:10,vars:0,consts:[[1,"p-2","bg-color","mt-3","text-center"],[1,"title","fw-bolder","display-3"],["src","assets/photos/novios2.jpeg","alt","",1,"rounded-circle","img-size"],[1,"body","mt-3"],[1,"text-justify"]],template:function(l,h){1&l&&(Vt(0,"div",0)(1,"p",1),Ee(2,"Nosotros"),Zt(),Vt(3,"div"),ke(4,"img",2),Zt(),Vt(5,"div",3)(6,"p",4),Ee(7," Esta es una historia de amor. Una historia de amor, de c\xf3mo dos personas se encontraron, de c\xf3mo se enamoraron y llegaron a compartir una vida juntos. Sab\xedamos que suceder\xeda, pero no sab\xedamos cu\xe1ndo, c\xf3mo o por qu\xe9, as\xed que dejamos que sucediera cuando sucediera, sin expectativas ni suposiciones. "),Zt(),Vt(8,"p"),Ee(9," Solo podemos decir que nuestra vida en este momento est\xe1 completa y estamos listos para compartir el resto de nuestras vidas juntos. "),Zt()()())},styles:['.img-size[_ngcontent-%COMP%]{height:180px;width:180px}.bg-color[_ngcontent-%COMP%]{width:100vw;position:relative}.bg-color[_ngcontent-%COMP%]:before{content:"";opacity:.7;inset:0;position:absolute;z-index:-1;background:rgba(113,143,62,.3);box-shadow:0 4px 30px #0000001a;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}@font-face{font-family:Monteserrat;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/montserrat/Montserrat-Regular.ttf)}.body[_ngcontent-%COMP%]{font-family:Monteserrat}']})}return i})(),C5=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275cmp=Ni({type:i,selectors:[["weeding-dresscode"]],decls:13,vars:0,consts:[[1,"bg-color","col","p-4","text-justify","text-center"],[1,"display-4","title","fw-bolder"],["src","assets/photos/dresscode.png","alt","",1,"icon"],[1,"display-5","body","pt-4"],[1,"display-6","body"],[1,"row","justify-content-around"],[1,"col"],["src","assets/photos/red2.png","alt","",1,"imgsize"],["src","assets/photos/white2.png","alt","",1,"imgsize"]],template:function(l,h){1&l&&(Vt(0,"div",0)(1,"p",1),Ee(2,"Codigo de Vestimenta"),Zt(),ke(3,"img",2),Vt(4,"h4",3),Ee(5,"Formal"),Zt(),Vt(6,"p",4),Ee(7,"Evitar usar los siguientes colores"),Zt(),Vt(8,"div",5)(9,"div",6),ke(10,"img",7),Zt(),Vt(11,"div",6),ke(12,"img",8),Zt()()())},styles:['.icon[_ngcontent-%COMP%]{height:85px;width:85px}.bg-color[_ngcontent-%COMP%]{width:100vw;position:relative}.bg-color[_ngcontent-%COMP%]:before{content:"";opacity:.7;inset:0;position:absolute;z-index:-1;background:rgba(113,143,62,.3);box-shadow:0 4px 30px #0000001a;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}.imgsize[_ngcontent-%COMP%]{height:300px;width:300px;border-radius:20px}.circleRed[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:25px;border-style:ridge;border-width:1px;border-color:#505050;background:red}.circleWhite[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:25px;border-style:ridge;border-width:1px;border-color:#505050;background:rgb(255,255,255)}.circleNude[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:25px;border-style:ridge;border-width:1px;border-color:#505050;background:#ebc8b2}.circleTag[_ngcontent-%COMP%]{justify-content:center}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}@font-face{font-family:Monteserrat;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/montserrat/Montserrat-Regular.ttf)}.body[_ngcontent-%COMP%]{font-family:Monteserrat}']})}return i})(),D5=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275cmp=Ni({type:i,selectors:[["weeding-gift"]],decls:21,vars:0,consts:[[1,"col","p-4","text-justify","text-center"],[1,"display-4","title","fw-bolder"],["src","assets/photos/giftbox.png","alt","",1,"icon"],[1,"display-6","body","pt-5"],[1,"row","mt-5","justify-content-evenly"],[1,"col","body"],[1,"title","fw-bolder"],[1,"body","col"]],template:function(l,h){1&l&&(Vt(0,"div",0)(1,"h4",1),Ee(2,"Regalos"),Zt(),ke(3,"img",2),Vt(4,"p",3),Ee(5,"El mejor regalo es su presencia en este dia tan especial, pero si gustan dejar un obsequio aqui les dejamos los datos"),Zt(),Vt(6,"div",4)(7,"div",5)(8,"h1",6),Ee(9,"Lluvia de sobres"),Zt(),Vt(10,"span"),Ee(11,"En la recepcion podran dejar su sobre"),Zt()(),Vt(12,"div",7)(13,"h1",6),Ee(14,"Transferencia"),Zt(),Vt(15,"p"),Ee(16,"Banco: Banorte"),Zt(),Vt(17,"p"),Ee(18,"Clabe: 0000000000000000000"),Zt(),Vt(19,"p"),Ee(20,"Nombre: Carlos Daniel Rodriguez Castro"),Zt()()()())},styles:[".icon[_ngcontent-%COMP%]{height:85px;width:85px}.divider[_ngcontent-%COMP%]{border-left:2.5px solid rgb(26,26,26);height:45px;width:3px;position:absolute;left:50%;margin-left:-3px;margin-top:-12px}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}@font-face{font-family:Monteserrat;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/montserrat/Montserrat-Regular.ttf)}.body[_ngcontent-%COMP%]{font-family:Monteserrat}"]})}return i})(),M5=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275cmp=Ni({type:i,selectors:[["wedding-confirmation"]],decls:9,vars:0,consts:[[1,"col","p-4","text-justify","text-center"],[1,"title","fw-bolder","display-4"],["src","assets/photos/confirmation.png","alt","",1,"icon"],["type","button",1,"body","btn","btn-success","btn-lg"]],template:function(l,h){1&l&&(Vt(0,"div",0)(1,"h4",1),Ee(2,"Confirma tu asistencia"),Zt(),ke(3,"br")(4,"img",2),Vt(5,"div"),ke(6,"br"),Vt(7,"button",3),Ee(8,"Whatsapp"),Zt()()())},styles:[".icon[_ngcontent-%COMP%]{height:85px;width:85px}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}@font-face{font-family:Monteserrat;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/montserrat/Montserrat-Regular.ttf)}.body[_ngcontent-%COMP%]{font-family:Monteserrat}"]})}return i})(),T5=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275cmp=Ni({type:i,selectors:[["wedding-intinerario"]],decls:68,vars:0,consts:[[1,"timeline-section"],[1,"quidditchdiv"],["src","assets/photos/quidditch.png","alt","",1,"quidditch"],[1,"timeline-items"],[1,"timeline-item"],[1,"timeline-dot"],[1,"body","timeline-date"],[1,"timeline-content"],[1,"title","fw-bolder"],["src","assets/photos/iglesia.png","alt",""],[1,"timeline-date"],["src","assets/photos/copas.png","alt",""],["src","assets/photos/pareja.png","alt",""],["src","assets/photos/camara.png","alt",""],["src","assets/photos/cena.png","alt",""],["src","assets/photos/pastel.png","alt",""],["src","assets/photos/carro.png","alt",""]],template:function(l,h){1&l&&(Vt(0,"section",0)(1,"div",1),ke(2,"img",2),Zt(),Vt(3,"div",3)(4,"div",4),ke(5,"div",5),Vt(6,"div",6),Ee(7,"5:00 PM"),Zt(),Vt(8,"div",7)(9,"h1",8),Ee(10,"Ceremonia Religiosa"),Zt(),ke(11,"img",9),Zt()(),Vt(12,"div",4),ke(13,"div",5),Vt(14,"div",10),Ee(15,"7:30 PM"),Zt(),Vt(16,"div",7)(17,"h1",8),Ee(18,"Apertura de Recepcion"),Zt(),ke(19,"img",11),Zt()(),Vt(20,"div",4),ke(21,"div",5),Vt(22,"div",10),Ee(23,"8:10 PM"),Zt(),Vt(24,"div",7)(25,"h1",8),Ee(26,"Entrada de los Novios"),Zt(),ke(27,"img",12),Zt()(),Vt(28,"div",4),ke(29,"div",5),Vt(30,"div",10),Ee(31,"8:30 PM"),Zt(),Vt(32,"div",7)(33,"h1",8),Ee(34,"Fotografias con los novios"),Zt(),ke(35,"img",13),Zt()(),Vt(36,"div",4),ke(37,"div",5),Vt(38,"div",10),Ee(39,"8:50 PM"),Zt(),Vt(40,"div",7)(41,"h1",8),Ee(42,"Cena"),Zt(),ke(43,"img",14),Zt()(),Vt(44,"div",4),ke(45,"div",5),Vt(46,"div",10),Ee(47,"9:40 PM"),Zt(),Vt(48,"div",7)(49,"h1",8),Ee(50,"Apertura de pista"),Zt(),ke(51,"img",11),Zt()(),Vt(52,"div",4),ke(53,"div",5),Vt(54,"div",10),Ee(55,"11:30 PM"),Zt(),Vt(56,"div",7)(57,"h1",8),Ee(58,"Pastel"),Zt(),ke(59,"img",15),Zt()(),Vt(60,"div",4),ke(61,"div",5),Vt(62,"div",10),Ee(63,"01:00 AM"),Zt(),Vt(64,"div",7)(65,"h1",8),Ee(66,"Cierre de Recepcion"),Zt(),ke(67,"img",16),Zt()()()())},styles:['*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box}.quidditchdiv[_ngcontent-%COMP%]{display:flex;justify-content:center}.quidditch[_ngcontent-%COMP%]{height:100px}.timeline-section[_ngcontent-%COMP%]{min-height:100vh;padding:50px 15px}.timeline-items[_ngcontent-%COMP%]{max-width:1000px;margin:auto;display:flex;flex-wrap:wrap;position:relative}.timeline-items[_ngcontent-%COMP%]:before{content:"";position:absolute;height:100%;background-color:#2f363e;left:calc(50% - 1px)}.timeline-item[_ngcontent-%COMP%]{background:url(https://carlosrdzcas.github.io/MyWedding/assets/photos/footprints90.png) no-repeat;background-position:center;background-size:55px;margin-bottom:15px;width:100%;position:relative}.timeline-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}.timeline-item[_ngcontent-%COMP%]:nth-child(odd){padding-right:calc(50% + 30px);text-align:right}.timeline-item[_ngcontent-%COMP%]:nth-child(2n){padding-left:calc(50% + 30px)}.timeline-dot[_ngcontent-%COMP%]{height:16px;width:16px;position:absolute;left:calc(50% - 8px);border-radius:50%;top:10px}.timeline-date[_ngcontent-%COMP%]{font-size:18px;color:#556b2f;font-weight:bolder;margin:6px 0 15px}.timeline-content[_ngcontent-%COMP%]{padding:5px;border-radius:5px}.timeline-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:20px;color:#000;margin:0 0 10px;text-transform:capitalize;font-weight:500}.timeline-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:70px}@media (max-width: 767px){.timeline-item[_ngcontent-%COMP%]{background:url(https://carlosrdzcas.github.io/MyWedding/assets/photos/footprints90.png) no-repeat;background-position:left;background-size:55px;margin-bottom:15px;width:100%;position:relative}.quidditchdiv[_ngcontent-%COMP%]{display:flex;justify-content:start;left:0}.timeline-items[_ngcontent-%COMP%]:before{left:7px}.timeline-item[_ngcontent-%COMP%]:nth-child(odd){padding-right:0;text-align:left}.timeline-item[_ngcontent-%COMP%]:nth-child(odd), .timeline-item[_ngcontent-%COMP%]:nth-child(2n){padding-left:50px}.timeline-dot[_ngcontent-%COMP%]{left:0}}@font-face{font-family:GreatVibes;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/great-vibes/GreatVibes-Regular.ttf)}.title[_ngcontent-%COMP%]{font-family:GreatVibes}@font-face{font-family:Monteserrat;src:url(https://carlosrdzcas.github.io/MyWedding/assets/fonts/montserrat/Montserrat-Regular.ttf)}.body[_ngcontent-%COMP%]{font-family:Monteserrat}']})}return i})();const S5=[{path:"envelope",component:g5},{path:"invitation",component:(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275cmp=Ni({type:i,selectors:[["page-invitation"]],decls:10,vars:0,consts:[[1,"parallax","col"]],template:function(l,h){1&l&&(Vt(0,"div",0),ke(1,"wedding-our-photo")(2,"wedding-invitacion")(3,"wedding-us")(4,"wedding-lugares")(5,"wedding-intinerario")(6,"wedding-fab")(7,"weeding-dresscode")(8,"weeding-gift")(9,"wedding-confirmation"),Zt())},dependencies:[_5,y5,v5,w5,E5,C5,D5,M5,T5],styles:['[_nghost-%COMP%]{display:block}.parallax[_ngcontent-%COMP%]{width:100vw;min-height:500px;position:relative}.parallax[_ngcontent-%COMP%]:before{content:"";background:url(https://carlosrdzcas.github.io/MyWedding/assets/photos/marauders.jpg);background-attachment:fixed;background-position:center;background-repeat:no-repeat;background-size:cover;opacity:.2;inset:0;position:absolute;z-index:-1}']})}return i})()},{path:"**",redirectTo:"envelope"}];let I5=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275mod=Vi({type:i});static#n=this.\u0275inj=ji({imports:[W2.forRoot(S5),W2]})}return i})(),A5=(()=>{class i{static#t=this.\u0275fac=function(l){return new(l||i)};static#e=this.\u0275mod=Vi({type:i,bootstrap:[p5]});static#n=this.\u0275inj=ji({imports:[SN,I5,m5,ZO]})}return i})();MN().bootstrapModule(A5).catch(i=>console.error(i))},574:function(p_){p_.exports=function(){"use strict";var uu,hu,Pn;function qh(te,st){if(uu)if(hu){var Ko="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+uu+")(sharedChunk); ("+hu+")(sharedChunk); self.onerror = null;",Ms={};uu(Ms),Pn=st(Ms),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Pn.workerUrl=window.URL.createObjectURL(new Blob([Ko],{type:"text/javascript"})))}else hu=st;else uu=st}return qh(0,function(te){var st=typeof self<"u"?self:{},Ko="3.1.2";let Ms;const Le={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Ms){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ms=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch{Ms=e}}return Ms},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Le.API_URL)return null;try{const e=new URL(Le.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},yo={supported:!1,testSupport:function(e){!Wl&&ha&&(Ha?pp(e):Qo=e)}};let Qo,ha,Wl=!1,Ha=!1;function pp(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,ha),e.isContextLost())return;yo.supported=!0}catch{}e.deleteTexture(t),Wl=!0}st.document&&(ha=st.document.createElement("img"),ha.onload=function(){Qo&&pp(Qo),Qo=null,Ha=!0},ha.onerror=function(){Wl=!0,Qo=null},ha.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Zh="01";function Jr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ts=Ss;function Ss(e,t,n,s){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=s}Ss.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,s=0;s<8;s++){var a=this.sampleCurveX(n)-e;if(Math.abs(a)<t)return n;var c=this.sampleCurveDerivativeX(n);if(Math.abs(c)<1e-6)break;n-=a/c}var u=0,d=1;for(n=e,s=0;s<20&&(a=this.sampleCurveX(n),!(Math.abs(a-e)<t));s++)e>a?u=n:d=n,n=.5*(d-u)+u;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var mp=Jr(Ts),Ga=Is;function Is(e,t){this.x=e,this.y=t}Is.prototype={clone:function(){return new Is(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),s=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=s,this},_rotateAround:function(e,t){var n=Math.cos(e),s=Math.sin(e),a=t.y+s*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-s*(this.y-t.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Is.convert=function(e){return e instanceof Is?e:Array.isArray(e)?new Is(e[0],e[1]):e};var et=Jr(Ga);function Xe(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Xe(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!Xe(e[n],t[n]))return!1;return!0}return e===t}const Yl=Math.PI/180,As=180/Math.PI;function De(e){return e*Yl}function ki(e){return e*As}const g_=[[0,0],[1,0],[1,1],[0,1]];function qa(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function Rs(e){let t=1/0,n=1/0,s=-1/0,a=-1/0;for(const c of e)t=Math.min(t,c.x),n=Math.min(n,c.y),s=Math.max(s,c.x),a=Math.max(a,c.y);return{min:new et(t,n),max:new et(s,a)}}function Xl(e,t,n=0,s=!0){const a=new et(n,n),c=e.sub(a),u=t.add(a),d=[c,new et(u.x,c.y),u,new et(c.x,u.y)];return s&&d.push(c.clone()),d}function Za(e,t,n,s){const a=new mp(e,t,n,s);return function(c){return a.solve(c)}}const jn=Za(.25,.1,.25,1);function Qt(e,t,n){return Math.min(n,Math.max(t,e))}function Ps(e,t,n){return(n=Qt((n-e)/(t-e),0,1))*n*(3-2*n)}function Os(e,t,n){const s=n-t,a=((e-t)%s+s)%s+t;return a===t?n:a}function Kl(e,t,n){if(!e.length)return n(null,[]);let s=e.length;const a=new Array(e.length);let c=null;e.forEach((u,d)=>{t(u,(f,p)=>{f&&(c=f),a[d]=p,0==--s&&n(c,a)})})}function kn(e){const t=[];for(const n in e)t.push(e[n]);return t}function qt(e,...t){for(const n of t)for(const s in n)e[s]=n[s];return e}function Or(e,t){const n={};for(let s=0;s<t.length;s++){const a=t[s];a in e&&(n[a]=e[a])}return n}let Di=1;function hi(){return Di++}function gp(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Yn(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function du(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Bi(e,t){e.forEach(n=>{t[n]&&(t[n]=t[n].bind(t))})}function Wa(e,t){return-1!==e.indexOf(t,e.length-t.length)}function fu(e,t,n){const s={};for(const a in e)s[a]=t.call(n||this,e[a],a,e);return s}function At(e,t,n){const s={};for(const a in e)t.call(n||this,e[a],a,e)&&(s[a]=e[a]);return s}function $(e){return Array.isArray(e)?e.map($):"object"==typeof e&&e?fu(e,$):e}const W={};function tt(e){W[e]||(typeof console<"u"&&console.warn(e),W[e]=!0)}function bt(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function Mt(e){let t=0;for(let n,s,a=0,c=e.length,u=c-1;a<c;u=a++)n=e[a],s=e[u],t+=(s.x-n.x)*(n.y+s.y);return t}function $t([e,t,n]){const s=De(t+90),a=De(n);return{x:e*Math.cos(s)*Math.sin(a),y:e*Math.sin(s)*Math.sin(a),z:e*Math.cos(a),azimuthal:t,polar:n}}function ne(e,t,n){const s=Math.sqrt(e*e+t*t+n*n),a=s>0?Math.acos(n/s)*As:0;let c=0!==e||0!==t?Math.atan2(-t,-e)*As+90:0;return c<0&&(c+=360),[s,c,a]}function Ct(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ae(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,a,c)=>{const u=a||c;return t[s]=!u||u.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t}let ge=null;function _e(){return!!st.document.fullscreenElement||!!st.document.webkitFullscreenElement}function Ln(e){try{const t=st[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function si(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function Hi(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]}function ai(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]}function Un(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]}const $n="mapbox-tiles";let kr,Jo,mr=500,wr=50;function pu(){try{return st.caches}catch{}}function to(){pu()&&!kr&&(kr=st.caches.open($n))}function da(e){const t=e.indexOf("?");if(t<0)return e;const s=function(a){const c=a.indexOf("?");return c>0?a.slice(c+1).split("&"):[]}(e).filter(a=>{const c=a.split("=");return"language"===c[0]||"worldview"===c[0]});return s.length?`${e.slice(0,t)}?${s.join("&")}`:e.slice(0,t)}let Ya=1/0;function mu(e){Ya++,Ya>wr&&(e.getActor().send("enforceCacheSizeLimit",mr),Ya=0)}const pt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(pt);class _t extends Error{constructor(t,n,s){401===n&&pn(s)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Tt=Ct()?()=>self.worker&&self.worker.referrer:()=>("blob:"===st.location.protocol?st.parent:st).location.href,Rt=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(Tt())&&!/^\w+:/.test(n))){if(st.fetch&&st.Request&&st.AbortController&&st.Request.prototype.hasOwnProperty("signal"))return function(s,a){const c=new st.AbortController,u=new st.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Tt(),referrerPolicy:s.referrerPolicy,signal:c.signal});let d=!1,f=!1;const p=(g=u.url).indexOf("sku=")>0&&pn(g);var g;"json"===s.type&&u.headers.set("Accept","application/json");const _=(x,b,E)=>{if(f)return;if(x&&"SecurityError"!==x.message&&tt(x.toString()),b&&E)return v(b);const C=Date.now();st.fetch(u).then(M=>{if(M.ok){const T=p?M.clone():null;return v(M,T,C)}return a(new _t(M.statusText,M.status,s.url))}).catch(M=>{"AbortError"!==M.name&&a(new Error(`${M.message} ${s.url}`))})},v=(x,b,E)=>{("arrayBuffer"===s.type?x.arrayBuffer():"json"===s.type?x.json():x.text()).then(C=>{f||(b&&E&&function(M,T,R){if(to(),!kr)return;const P={status:T.status,statusText:T.statusText,headers:new st.Headers};T.headers.forEach((L,F)=>P.headers.set(F,L));const I=ae(T.headers.get("Cache-Control")||"");if(I["no-store"])return;I["max-age"]&&P.headers.set("Expires",new Date(R+1e3*I["max-age"]).toUTCString());const O=P.headers.get("Expires");O&&(new Date(O).getTime()-R<42e4||function(L,F){if(void 0===Jo)try{new Response(new ReadableStream),Jo=!0}catch{Jo=!1}Jo?F(L.body):L.blob().then(F)}(T,L=>{const F=new st.Response(L,P);to(),kr&&kr.then(N=>N.put(da(M.url),F)).catch(N=>tt(N.message))}))}(u,b,E),d=!0,a(null,C,x.headers.get("Cache-Control"),x.headers.get("Expires")))}).catch(C=>{f||a(new Error(C.message))})};return p?function(x,b){if(to(),!kr)return b(null);const E=da(x.url);kr.then(C=>{C.match(E).then(M=>{const T=function(R){if(!R)return!1;const P=new Date(R.headers.get("Expires")||0),I=ae(R.headers.get("Cache-Control")||"");return P>Date.now()&&!I["no-cache"]}(M);C.delete(E),T&&C.put(E,M.clone()),b(null,M,T)}).catch(b)}).catch(b)}(u,_):_(null,null),{cancel:()=>{f=!0,d||c.abort()}}}(e,t);if(Ct()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(s,a){const c=new st.XMLHttpRequest;c.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(c.responseType="arraybuffer");for(const u in s.headers)c.setRequestHeader(u,s.headers[u]);return"json"===s.type&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials="include"===s.credentials,c.onerror=()=>{a(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||0===c.status)&&null!==c.response){let u=c.response;if("json"===s.type)try{u=JSON.parse(c.response)}catch(d){return a(d)}a(null,u,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else a(new _t(c.statusText,c.status,s.url))},c.send(s.body),{cancel:()=>c.abort()}}(e,t)},It=function(e,t){return Rt(qt(e,{type:"json"}),t)},Nt=function(e,t){return Rt(qt(e,{type:"arrayBuffer"}),t)};function jt(e){const t=st.document.createElement("a");return t.href=e,t.protocol===st.document.location.protocol&&t.host===st.document.location.host}const kt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Kt,Bt;Kt=[],Bt=0;const Ie=function(e,t){if(yo.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Bt>=Le.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Kt.push(c),c}Bt++;let n=!1;const s=()=>{if(!n)for(n=!0,Bt--;Kt.length&&Bt<Le.MAX_PARALLEL_IMAGE_REQUESTS;){const c=Kt.shift(),{requestParameters:u,callback:d,cancelled:f}=c;f||(c.cancel=Ie(u,d).cancel)}},a=Nt(e,(c,u,d,f)=>{s(),c?t(c):u&&(st.createImageBitmap?function(p,g){const _=new st.Blob([new Uint8Array(p)],{type:"image/png"});st.createImageBitmap(_).then(v=>{g(null,v)}).catch(v=>{g(new Error(`Could not load image because of ${v.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(u,(p,g)=>t(p,g,d,f)):function(p,g){const _=new st.Image,v=st.URL;_.onload=()=>{g(null,_),v.revokeObjectURL(_.src),_.onload=null,st.requestAnimationFrame(()=>{_.src=kt})},_.onerror=()=>g(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const x=new st.Blob([new Uint8Array(p)],{type:"image/png"});_.src=p.byteLength?v.createObjectURL(x):kt}(u,(p,g)=>t(p,g,d,f)))});return{cancel:()=>{a.cancel(),s()}}},wn="NO_ACCESS_TOKEN";class ce{constructor(t,n,s){this._transformRequestFn=t,this._customAccessToken=n,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const t=function(){let n="";for(let s=0;s<10;s++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Zh,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeStyleURL(t,n){if(!_n(t))return t;const s=Li(t);return s.params.push(`sdk=js-${Ko}`),s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeGlyphsURL(t,n){if(!_n(t))return t;const s=Li(t);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeModelURL(t,n){if(!_n(t))return t;const s=Li(t);return s.path=`/models/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeSourceURL(t,n,s,a){if(!_n(t))return t;const c=Li(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),s&&c.params.push(`language=${s}`),a&&c.params.push(`worldview=${a}`),this._makeAPIURL(c,this._customAccessToken||n)}normalizeSpriteURL(t,n,s,a){const c=Li(t);return _n(t)?(c.path=`/styles/v1${c.path}/sprite${n}${s}`,this._makeAPIURL(c,this._customAccessToken||a)):(c.path+=`${n}${s}`,Lr(c))}normalizeTileURL(t,n,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!_n(t))return t;const a=Li(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||s&&"raster"!==a.authority&&512===s?"@2x":""}${yo.supported?".webp":"$1"}`),"raster"===a.authority?a.path=`/${Le.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${Le.TILE_URL_VERSION}${a.path}`);const c=this._customAccessToken||function(u){for(const d of u){const f=d.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(a.params)||Le.ACCESS_TOKEN;return Le.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,c)}canonicalizeTileURL(t,n){const s=Li(t);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return t;let a="mapbox://";s.path.match(/^\/raster\/v1\//)?a+=`raster/${s.path.replace(`/${Le.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${s.path.replace(`/${Le.TILE_URL_VERSION}/`,"")}`;let c=s.params;return n&&(c=c.filter(u=>!u.match(/^access_token=/))),c.length&&(a+=`?${c.join("&")}`),a}canonicalizeTileset(t,n){const s=!!n&&_n(n),a=[];for(const c of t.tiles||[])pn(c)?a.push(this.canonicalizeTileURL(c,s)):a.push(c);return a}_makeAPIURL(t,n){const s="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=Li(Le.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,"http"===t.protocol){const c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if("/"!==a.path&&(t.path=`${a.path}${t.path}`),!Le.REQUIRE_ACCESS_TOKEN)return Lr(t);if(n=n||Le.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===n[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return t.params=t.params.filter(c=>-1===c.indexOf("access_token")),t.params.push(`access_token=${n||""}`),Lr(t)}}function _n(e){return 0===e.indexOf("mapbox:")}function pn(e){return Le.API_URL_REGEX.test(e)}function pi(e){return Le.API_CDN_URL_REGEX.test(e)}function Mi(e){return Le.API_STYLE_REGEX.test(e)&&!gr(e)}function gr(e){return Le.API_SPRITE_REGEX.test(e)}const Oo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Li(e){const t=e.match(Oo);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Lr(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const _r="mapbox.eventData";function eo(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(st.atob(t[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Xa{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=eo(Le.ACCESS_TOKEN);let s="";return s=n&&n.u?st.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(a,c)=>String.fromCharCode(+("0x"+c)))):Le.ACCESS_TOKEN||"",t?`${_r}.${t}:${s}`:`${_r}:${s}`}fetchEventData(){const t=Ln("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{const a=st.localStorage.getItem(n);a&&(this.eventData=JSON.parse(a));const c=st.localStorage.getItem(s);c&&(this.anonId=c)}catch{tt("Unable to read from LocalStorage")}}saveEventData(){const t=Ln("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{st.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&st.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{tt("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,s,a){if(!Le.EVENTS_URL)return;const c=Li(Le.EVENTS_URL);c.params.push(`access_token=${a||Le.ACCESS_TOKEN||""}`);const u={event:this.type,created:new Date(t).toISOString()},d=n?qt(u,n):u,f={url:Lr(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([d])};var g;this.pendingRequest=(g=p=>{this.pendingRequest=null,s(p),this.saveEventData(),this.processRequests(a)},Rt(qt(f,{method:"POST"}),g))}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const Ti=new class extends Xa{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){Le.EVENTS_URL&&Le.ACCESS_TOKEN&&Array.isArray(e)&&e.some(n=>_n(n)||pn(n))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=eo(Le.ACCESS_TOKEN),n=t?t.u:Le.ACCESS_TOKEN;let s=n!==this.eventData.tokenU;du(this.anonId)||(this.anonId=gp(),s=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const c=new Date(this.eventData.lastSuccess),u=new Date(a),d=(a-this.eventData.lastSuccess)/864e5;s=s||d>=1||d<-1||c.getDate()!==u.getDate()}else s=!0;s?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ko,skuId:Zh,"enabled.telemetry":!1,userId:this.anonId},c=>{c||(this.eventData.lastSuccess=a,this.eventData.tokenU=n)},e):this.processRequests()}},Ka=Ti.postTurnstileEvent.bind(Ti),ts=new class extends Xa{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,n,s){this.skuToken=t,this.errorCb=s,Le.EVENTS_URL&&(n||Le.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(wn)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),du(this.anonId)||(this.anonId=gp()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ko,skuId:Zh,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):t&&(this.success[t]=!0)},e))}},X2=ts.postMapLoadEvent.bind(ts),s1=new class extends Xa{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){Le.EVENTS_URL&&(e||Le.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,performanceData:n}=this.queue.shift(),s=function(a){const c=st.performance.getEntriesByType("resource"),u=st.performance.getEntriesByType("mark"),d=function(v){const x={};if(v)for(const b in v)if("other"!==b)for(const E of v[b]){const C=`${b}ResolveRangeMin`,M=`${b}ResolveRangeMax`,T=`${b}RequestCount`,R=`${b}RequestCachedCount`;x[C]=Math.min(x[C]||1/0,E.startTime),x[M]=Math.max(x[M]||-1/0,E.responseEnd);const P=I=>{void 0===x[I]&&(x[I]=0),++x[I]};void 0!==E.transferSize&&0===E.transferSize&&P(R),P(T)}return x}(function(v,x){const b={};if(v)for(const E of v){const C=x(E);void 0===b[C]&&(b[C]=[]),b[C].push(E)}return b}(c,EM)),f=st.devicePixelRatio,p=st.navigator.connection||st.navigator.mozConnection||st.navigator.webkitConnection,g={counters:[],metadata:[],attributes:[]},_=(v,x,b)=>{null!=b&&v.push({name:x,value:b.toString()})};for(const v in d)_(g.counters,v,d[v]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(_(g.counters,"interactionRangeMin",a.interactionRange[0]),_(g.counters,"interactionRangeMax",a.interactionRange[1])),u)for(const v of Object.keys(Wh)){const x=Wh[v],b=u.find(E=>E.name===x);b&&_(g.counters,x,b.startTime)}return _(g.counters,"visibilityHidden",a.visibilityHidden),_(g.attributes,"style",function(v){if(v)for(const x of v){const b=x.name.split("?")[0];if(Mi(b)){const E=b.split("/").slice(-2);if(2===E.length)return`mapbox://styles/${E[0]}/${E[1]}`}}}(c)),_(g.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),_(g.attributes,"fogEnabled",a.fogEnabled?"true":"false"),_(g.attributes,"projection",a.projection),_(g.attributes,"zoom",a.zoom),_(g.metadata,"devicePixelRatio",f),_(g.metadata,"connectionEffectiveType",p?p.effectiveType:void 0),_(g.metadata,"navigatorUserAgent",st.navigator.userAgent),_(g.metadata,"screenWidth",st.screen.width),_(g.metadata,"screenHeight",st.screen.height),_(g.metadata,"windowWidth",st.innerWidth),_(g.metadata,"windowHeight",st.innerHeight),_(g.metadata,"mapWidth",a.width/f),_(g.metadata,"mapHeight",a.height/f),_(g.metadata,"webglRenderer",a.renderer),_(g.metadata,"webglVendor",a.vendor),_(g.metadata,"sdkVersion",Ko),_(g.metadata,"sdkIdentifier","mapbox-gl-js"),g}(n);for(const a of s.metadata);for(const a of s.counters);for(const a of s.attributes);this.postEvent(t,s,()=>{},e)}},a1=s1.postPerformanceEvent.bind(s1),_p=new class extends Xa{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,n,s){if(!Le.API_URL||!Le.SESSION_PATH)return;const a=Li(Le.API_URL+Le.SESSION_PATH);a.params.push(`sku=${t||""}`),a.params.push(`access_token=${s||Le.ACCESS_TOKEN||""}`);const c={url:Lr(a),headers:{"Content-Type":"text/plain"}};var d;this.pendingRequest=(d=u=>{this.pendingRequest=null,n(u),this.saveEventData(),this.processRequests(s)},Rt(qt(c,{method:"GET"}),d))}getSessionAPI(e,t,n,s){this.skuToken=t,this.errorCb=s,Le.SESSION_PATH&&Le.API_URL&&(n||Le.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(wn)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):t&&(this.success[t]=!0)},e)}},wM=_p.getSessionAPI.bind(_p),Qa=new Set;function l1(e,t){t?Qa.add(e):Qa.delete(e)}const Wh={create:"create",load:"load",fullLoad:"fullLoad"},__={mark(e){st.performance.mark(e)},measure(e,t,n){st.performance.measure(e,t,n)}};function EM(e){const t=e.name.split("?")[0];return pi(t)&&t.includes("mapbox-gl.js")?"javascript":pi(t)&&t.includes("mapbox-gl.css")?"css":Le.API_FONTS_REGEX.test(t)?"fontRange":gr(t)?"sprite":Mi(t)?"style":Le.API_TILEJSON_REGEX.test(t)?"tilejson":"other"}const CM=st.performance;function c1(e){const t=e?e.url.toString():void 0;return CM.getEntriesByName(t)}var u1=yp;function yp(e){return t=e,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var s,a,c=new Blob([""],{type:"text/javascript"}),u=URL.createObjectURL(c);try{a=new Worker(u),s=!0}catch{s=!1}return a&&a.terminate(),URL.revokeObjectURL(u),s}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var s=document.createElement("canvas");s.width=s.height=1;var a=s.getContext("2d");if(!a)return!1;var c=a.getImageData(0,0,1,1);return c&&c.width===s.width}()||(void 0===y_[n=t&&t.failIfMajorPerformanceCaveat]&&(y_[n]=function(s){var a,u,d,f,c=(u=s,d=document.createElement("canvas"),(f=Object.create(yp.webGLContextAttributes)).failIfMajorPerformanceCaveat=u,d.getContext("webgl",f)||d.getContext("experimental-webgl",f));if(!c)return!1;try{a=c.createShader(c.VERTEX_SHADER)}catch{return!1}return!(!a||c.isContextLost())&&(c.shaderSource(a,"void main() {}"),c.compileShader(a),!0===c.getShaderParameter(a,c.COMPILE_STATUS))}(n)),!y_[n]||document.documentMode));var t,n}var y_={};let v_,Gi,Yh,Er,Fe;function x_(){return null==v_&&(v_=st.OffscreenCanvas&&new st.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof st.createImageBitmap),v_}yp.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const xe={now:()=>void 0!==Er?Er:st.performance.now(),setNow(e){Er=e},restoreNow(){Er=void 0},frame(e){const t=st.requestAnimationFrame(e);return{cancel:()=>st.cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:n,height:s}=e;Fe||(Fe=st.document.createElement("canvas"));const a=Fe.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(n>Fe.width||s>Fe.height)&&(Fe.width=n,Fe.height=s),a.clearRect(-t,-t,n+2*t,s+2*t),a.drawImage(e,0,0,n,s),a.getImageData(-t,-t,n+2*t,s+2*t)},resolveURL:e=>(Gi||(Gi=st.document.createElement("a")),Gi.href=e,Gi.href),get devicePixelRatio(){return st.devicePixelRatio},get prefersReducedMotion(){return!!st.matchMedia&&(null==Yh&&(Yh=st.matchMedia("(prefers-reduced-motion: reduce)")),Yh.matches)},hasCanvasFingerprintNoise(){if(!x_())return!1;const e=new st.OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let n=0;for(let a=0;a<e.width;++a)t.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,t.fillRect(a,0,1,1);const s=t.getImageData(0,0,e.width,e.height);n=0;for(let a=0;a<s.data.length;++a)if(a%4!=3&&n++!==s.data[a])return!0;return!1}};function rn(e,t,n){const s=st.document.createElement(e);return void 0!==t&&(s.className=t),n&&n.appendChild(s),s}function ks(e,t,n){const s=st.document.createElementNS("http://www.w3.org/2000/svg",e);for(const a of Object.keys(t))s.setAttributeNS(null,a,t[a]);return n&&n.appendChild(s),s}const Ql=st.document&&st.document.documentElement.style,Hn=Ql&&void 0!==Ql.userSelect?"userSelect":"WebkitUserSelect";let Xh;function qi(){Ql&&Hn&&(Xh=Ql[Hn],Ql[Hn]="none")}function vp(){Ql&&Hn&&(Ql[Hn]=Xh)}function b_(e){e.preventDefault(),e.stopPropagation(),st.removeEventListener("click",b_,!0)}function Kh(){st.addEventListener("click",b_,!0),st.setTimeout(()=>{st.removeEventListener("click",b_,!0)},0)}function Ge(e,t){const n=e.getBoundingClientRect();return DM(e,n,t)}function gu(e,t){const n=e.getBoundingClientRect(),s=[];for(let a=0;a<t.length;a++)s.push(DM(e,n,t[a]));return s}function xp(e){return void 0!==st.InstallTrigger&&2===e.button&&e.ctrlKey&&st.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function DM(e,t,n){const s=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new et((n.clientX-t.left)*s,(n.clientY-t.top)*s)}function w_(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function Jt(e,t,n){if(n&&n[e]){const s=n[e].indexOf(t);-1!==s&&n[e].splice(s,1)}}class Dt{constructor(t,n={}){qt(this,n),this.type=t}}class zt extends Dt{constructor(t,n={}){super("error",qt({error:t},n))}}class Be{on(t,n){return this._listeners=this._listeners||{},w_(t,n,this._listeners),this}off(t,n){return Jt(t,n,this._listeners),Jt(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},w_(t,n,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,n){"string"==typeof t&&(t=new Dt(t,n||{}));const s=t.type;if(this.listens(s)){t.target=this;const a=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const d of a)d.call(this,t);const c=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const d of c)Jt(s,d,this._oneTimeListeners),d.call(this,t);const u=this._eventedParent;u&&(qt(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t))}else t instanceof zt&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var rt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Yt{constructor(t,n,s,a){this.message=(t?`${t}: `:"")+s,a&&(this.identifier=a),null!=n&&n.__line__&&(this.line=n.__line__)}}class Jl extends Yt{}function es(e,...t){for(const n of t)for(const s in n)e[s]=n[s];return e}function Fn(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Ja(e){if(Array.isArray(e))return e.map(Ja);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=Ja(e[n]);return t}return Fn(e)}class MM extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}var fa=MM;class pa{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[s,a]of n)this.bindings[s]=a}concat(t){return new pa(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var K2=pa;const Qh={kind:"null"},Ht={kind:"number"},on={kind:"string"},hn={kind:"boolean"},ns={kind:"color"},_u={kind:"object"},un={kind:"value"},Fr={kind:"collator"},Ve={kind:"formatted"},bp={kind:"resolvedImage"};function vo(e,t){return{kind:"array",itemType:e,N:t}}function Si(e){if("array"===e.kind){const t=Si(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const he=[Qh,Ht,on,hn,ns,Ve,_u,vo(un),bp];function wp(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!wp(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const n of he)if(!wp(n,t))return null}return`Expected ${Si(e)} but found ${Si(t)} instead.`}function ji(e,t){return t.some(n=>n.kind===e.kind)}function tl(e,t){return t.some(n=>"null"===n?null===e:"array"===n?Array.isArray(e):"object"===n?e&&!Array.isArray(e)&&"object"==typeof e:n===typeof e)}var E_,C_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ep(e){return(e=Math.round(e))<0?0:e>255?255:e}function yu(e){return Ep("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function tc(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Jh(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{E_={}.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in C_)return C_[n].slice();if("#"===n[0])return 4===n.length?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===n.length&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var s=n.indexOf("("),a=n.indexOf(")");if(-1!==s&&a+1===n.length){var c=n.substr(0,s),u=n.substr(s+1,a-(s+1)).split(","),d=1;switch(c){case"rgba":if(4!==u.length)return null;d=tc(u.pop());case"rgb":return 3!==u.length?null:[yu(u[0]),yu(u[1]),yu(u[2]),d];case"hsla":if(4!==u.length)return null;d=tc(u.pop());case"hsl":if(3!==u.length)return null;var f=(parseFloat(u[0])%360+360)%360/360,p=tc(u[1]),g=tc(u[2]),_=g<=.5?g*(p+1):g+p-g*p,v=2*g-_;return[Ep(255*Jh(v,_,f+1/3)),Ep(255*Jh(v,_,f)),Ep(255*Jh(v,_,f-1/3)),d];default:return null}}return null}}catch{}class Nr{constructor(t,n,s,a=1){this.r=t,this.g=n,this.b=s,this.a=a}static parse(t){if(!t)return;if(t instanceof Nr)return t;if("string"!=typeof t)return;const n=E_(t);return n?new Nr(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[t,n,s,a]=this.toArray();return`rgba(${Math.round(t)},${Math.round(n)},${Math.round(s)},${a})`}toArray(){const{r:t,g:n,b:s,a}=this;return 0===a?[0,0,0,0]:[255*t/a,255*n/a,255*s/a,a]}toArray01(){const{r:t,g:n,b:s,a}=this;return 0===a?[0,0,0,0]:[t/a,n/a,s/a,a]}toArray01Scaled(t){const{r:n,g:s,b:a,a:c}=this;return 0===c?[0,0,0]:[n/c*t,s/c*t,a/c*t]}toArray01PremultipliedAlpha(){const{r:t,g:n,b:s,a}=this;return[t,n,s,a]}toArray01Linear(){const{r:t,g:n,b:s,a}=this;return 0===a?[0,0,0,0]:[Math.pow(t/a,2.2),Math.pow(n/a,2.2),Math.pow(s/a,2.2),a]}}Nr.black=new Nr(0,0,0,1),Nr.white=new Nr(1,1,1,1),Nr.transparent=new Nr(0,0,0,0),Nr.red=new Nr(1,0,0,1),Nr.blue=new Nr(0,0,1,1);var Pe=Nr;class En{constructor(t,n,s){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class td{constructor(t,n,s,a,c){this.text=t.normalize?t.normalize():t,this.image=n,this.scale=s,this.fontStack=a,this.textColor=c}}class zr{constructor(t){this.sections=t}static fromString(t){return new zr([new td(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.namePrimary.length)}static factory(t){return t instanceof zr?t:zr.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const n of this.sections){if(n.image){t.push(["image",n.image.namePrimary]);continue}t.push(n.text);const s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(s)}return t}}class gi{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,n){return t?new gi({namePrimary:t,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function D_(e,t,n,s){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[e,t,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[e,t,n,s]:[e,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ed(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof Pe||e instanceof En||e instanceof zr||e instanceof gi)return!0;if(Array.isArray(e)){for(const t of e)if(!ed(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!ed(e[t]))return!1;return!0}return!1}function Ke(e){if(null===e)return Qh;if("string"==typeof e)return on;if("boolean"==typeof e)return hn;if("number"==typeof e)return Ht;if(e instanceof Pe)return ns;if(e instanceof En)return Fr;if(e instanceof zr)return Ve;if(e instanceof gi)return bp;if(Array.isArray(e)){const t=e.length;let n;for(const s of e){const a=Ke(s);if(n){if(n===a)continue;n=un;break}n=a}return vo(n||un,t)}return _u}function Cp(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Pe||e instanceof zr||e instanceof gi?e.toString():JSON.stringify(e)}class h1{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(2!==t.length)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ed(t[1]))return n.error("invalid value");const s=t[1];let a=Ke(s);const c=n.expectedType;return"array"!==a.kind||0!==a.N||!c||"array"!==c.kind||"number"==typeof c.N&&0!==c.N||(a=c),new h1(a,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Pe?["rgba"].concat(this.value.toArray()):this.value instanceof zr?this.value.serialize():this.value}}var ec=h1,Fi=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const Dp={string:on,number:Ht,boolean:hn,object:_u};class nd{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let s,a=1;const c=t[0];if("array"===c){let d,f;if(t.length>2){const p=t[1];if("string"!=typeof p||!(p in Dp)||"object"===p)return n.error('The item type argument of "array" must be one of string, number, boolean',1);d=Dp[p],a++}else d=un;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);f=t[2],a++}s=vo(d,f)}else s=Dp[c];const u=[];for(;a<t.length;a++){const d=n.parse(t[a],a,un);if(!d)return null;u.push(d)}return new nd(s,u)}evaluate(t){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(t);if(!wp(this.type,Ke(s)))return s;if(n===this.args.length-1)throw new Fi(`Expected value to be of type ${Si(this.type)}, but found ${Si(Ke(s))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,n=[t.kind];if("array"===t.kind){const s=t.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){n.push(s.kind);const a=t.N;("number"==typeof a||this.args.length>1)&&n.push(a)}}return n.concat(this.args.map(s=>s.serialize()))}}var ma=nd;class nc{constructor(t){this.type=Ve,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&"object"==typeof s)return n.error("First argument must be an image or text section.");const a=[];let c=!1;for(let u=1;u<=t.length-1;++u){const d=t[u];if(c&&"object"==typeof d&&!Array.isArray(d)){c=!1;let f=null;if(d["font-scale"]&&(f=n.parse(d["font-scale"],1,Ht),!f))return null;let p=null;if(d["text-font"]&&(p=n.parse(d["text-font"],1,vo(on)),!p))return null;let g=null;if(d["text-color"]&&(g=n.parse(d["text-color"],1,ns),!g))return null;const _=a[a.length-1];_.scale=f,_.font=p,_.textColor=g}else{const f=n.parse(t[u],1,un);if(!f)return null;const p=f.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,a.push({content:f,scale:null,font:null,textColor:null})}}return new nc(a)}evaluate(t){return new zr(this.sections.map(n=>{const s=n.content.evaluate(t);return Ke(s)===bp?new td("",s,null,null,null):new td(Cp(s),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const n of this.sections){t.push(n.content.serialize());const s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),t.push(s)}return t}}class Mp{constructor(t,n){this.type=bp,this.inputPrimary=t,this.inputSecondary=n}static parse(t,n){if(t.length<2)return n.error("Expected two or more arguments.");const s=n.parse(t[1],1,on);if(!s)return n.error("No image name provided.");if(2===t.length)return new Mp(s);const a=n.parse(t[2],1,on);return a?new Mp(s,a):n.error("Secondary image variant is not a string.")}evaluate(t){const n=gi.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&t.availableImages&&(n.available=t.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Sn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const Q2={"to-boolean":hn,"to-color":ns,"to-number":Ht,"to-string":on};class d1{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const s=t[0],a=[];let c=Qh;if("to-array"===s){if(!Array.isArray(t[1]))return null;const u=t[1].length;if(n.expectedType){if("array"!==n.expectedType.kind)return n.error(`Expected ${n.expectedType.kind} but found array.`);c=vo(n.expectedType.itemType,u)}else{if(!(u>0&&ed(t[1][0])))return null;c=vo(Ke(t[1][0]),u)}for(let d=0;d<u;d++){const f=t[1][d];let p;if("array"===Sn(f))p=n.parse(f,void 0,c.itemType);else{const g=Sn(f);if(g!==c.itemType.kind)return n.error(`Expected ${c.itemType.kind} but found ${g}.`);p=n.registry.literal.parse(["literal",void 0===f?null:f],n)}if(!p)return null;a.push(p)}}else{if(("to-boolean"===s||"to-string"===s)&&2!==t.length)return n.error("Expected one argument.");c=Q2[s];for(let u=1;u<t.length;u++){const d=n.parse(t[u],u,un);if(!d)return null;a.push(d)}}return new d1(c,a)}evaluate(t){if("boolean"===this.type.kind)return!!this.args[0].evaluate(t);if("color"===this.type.kind){let n,s;for(const a of this.args){if(n=a.evaluate(t),s=null,n instanceof Pe)return n;if("string"==typeof n){const c=t.parseColor(n);if(c)return c}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:D_(n[0],n[1],n[2],n[3]),!s))return new Pe(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Fi(s||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const s of this.args){if(n=s.evaluate(t),null===n)return 0;const a=Number(n);if(!isNaN(a))return a}throw new Fi(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?zr.fromString(Cp(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?gi.fromString(Cp(this.args[0].evaluate(t))):"array"===this.type.kind?this.args.map(n=>n.evaluate(t)):Cp(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new nc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Mp(this.args[0]).serialize();const t="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{t.push(n.serialize())}),t}}var vu=d1;const id=["Unknown","Point","LineString","Polygon"];var Tp=class{constructor(e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=e}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?id[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-e[0])+this.featureDistanceData.bearing[1]*(s*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Pe.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class Ls{constructor(t,n,s,a,c){this.name=t,this.type=n,this._evaluate=s,this.args=a,this._overloadIndex=c}evaluate(t){if(!this._evaluate){const n=Ls.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,n){const s=t[0],a=Ls.definitions[s];if(!a)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(a)?a[0]:a.type,u=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,d=[];let f=null,p=-1;for(const[g,_]of u){if(Array.isArray(g)&&g.length!==t.length-1)continue;d.push(g),p++,f=new O_(n.registry,n.path,null,n.scope,void 0,n.options);const v=[];let x=!1;for(let b=1;b<t.length;b++){const E=t[b],C=Array.isArray(g)?g[b-1]:g.type,M=f.parse(E,1+v.length,C);if(!M){x=!0;break}v.push(M)}if(!x)if(Array.isArray(g)&&g.length!==v.length)f.error(`Expected ${g.length} arguments, but found ${v.length} instead.`);else{for(let b=0;b<v.length;b++){const E=Array.isArray(g)?g[b]:g.type,C=v[b];f.concat(b+1).checkSubtype(E,C.type)}if(0===f.errors.length)return new Ls(s,c,_,v,p)}}if(1===d.length)n.errors.push(...f.errors);else{const g=(d.length?d:u.map(([v])=>v)).map(TM).join(" | "),_=[];for(let v=1;v<t.length;v++){const x=n.parse(t[v],1+_.length);if(!x)return null;_.push(Si(x.type))}n.error(`Expected arguments of type ${g}, but found (${_.join(", ")}) instead.`)}return null}static register(t,n){Ls.definitions=n;for(const s in n)t[s]=Ls}}function TM(e){return Array.isArray(e)?`(${e.map(Si).join(", ")})`:`(${Si(e.type)}...)`}var Fs=Ls;class Sp{constructor(t,n,s){this.type=Fr,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(2!==t.length)return n.error("Expected one argument.");const s=t[1];if("object"!=typeof s||Array.isArray(s))return n.error("Collator options argument must be an object.");const a=n.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,hn);if(!a)return null;const c=n.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,hn);if(!c)return null;let u=null;return s.locale&&(u=n.parse(s.locale,1,on),!u)?null:new Sp(a,c,u)}evaluate(t){return new En(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var M_={exports:{}};M_.exports=function(){function e(s,a,c,u,d){for(;u>c;){if(u-c>600){var f=u-c+1,p=a-c+1,g=Math.log(f),_=.5*Math.exp(2*g/3),v=.5*Math.sqrt(g*_*(f-_)/f)*(p-f/2<0?-1:1);e(s,a,Math.max(c,Math.floor(a-p*_/f+v)),Math.min(u,Math.floor(a+(f-p)*_/f+v)),d)}var x=s[a],b=c,E=u;for(t(s,c,a),d(s[u],x)>0&&t(s,c,u);b<E;){for(t(s,b,E),b++,E--;d(s[b],x)<0;)b++;for(;d(s[E],x)>0;)E--}0===d(s[c],x)?t(s,c,E):t(s,++E,u),E<=a&&(c=E+1),a<=E&&(u=E-1)}}function t(s,a,c){var u=s[a];s[a]=s[c],s[c]=u}function n(s,a){return s<a?-1:s>a?1:0}return function(s,a,c,u,d){e(s,a,c||0,u||s.length-1,d||n)}}();var xu=Jr(M_.exports);function SM(e){let t=0;for(let n,s,a=0,c=e.length,u=c-1;a<c;u=a++)n=e[a],s=e[u],t+=(s.x-n.x)*(n.y+s.y);return t}function ko(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function rd(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function St(e,t,n){const s=e[0]-t[0],a=e[1]-t[1],c=e[0]-n[0],u=e[1]-n[1];return s*u-c*a==0&&s*c<=0&&a*u<=0}function ic(e,t,n=!1){let s=!1;for(let d=0,f=t.length;d<f;d++){const p=t[d];for(let g=0,_=p.length,v=_-1;g<_;v=g++){const x=p[v],b=p[g];if(St(e,x,b))return n;(c=x)[1]>(a=e)[1]!=(u=b)[1]>a[1]&&a[0]<(u[0]-c[0])*(a[1]-c[1])/(u[1]-c[1])+c[0]&&(s=!s)}}var a,c,u;return s}function fe(e,t,n,s){const a=s[0]-n[0],c=s[1]-n[1],u=(e[0]-n[0])*c-a*(e[1]-n[1]),d=(t[0]-n[0])*c-a*(t[1]-n[1]);return u>0&&d<0||u<0&&d>0}function rc(e,t,n,s){return(a=[s[0]-n[0],s[1]-n[1]])[0]*(c=[t[0]-e[0],t[1]-e[1]])[1]-a[1]*c[0]!=0&&!(!fe(e,t,n,s)||!fe(n,s,e,t));var a,c}const Ns=8192;function od(e,t){const n=(180+e[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,a=Math.pow(2,t.z);return[Math.round(n*a*Ns),Math.round(s*a*Ns)]}function IM(e,t){for(let n=0;n<t.length;n++)if(ic(e,t[n]))return!0;return!1}function AM(e,t,n){for(const s of n)for(let a=0,c=s.length,u=c-1;a<c;u=a++)if(rc(e,t,s[u],s[a]))return!0;return!1}function f1(e,t){for(let n=0;n<e.length;++n)if(!ic(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(AM(e[n],e[n+1],t))return!1;return!0}function ga(e,t){for(let n=0;n<t.length;n++)if(f1(e,t[n]))return!0;return!1}function bu(e,t,n){const s=[];for(let a=0;a<e.length;a++){const c=[];for(let u=0;u<e[a].length;u++){const d=od(e[a][u],n);ko(t,d),c.push(d)}s.push(c)}return s}function Lo(e,t,n){const s=[];for(let a=0;a<e.length;a++){const c=bu(e[a],t,n);s.push(c)}return s}function is(e,t,n,s){if(e[0]<n[0]||e[0]>n[2]){const a=.5*s;let c=e[0]-n[0]>a?-s:n[0]-e[0]>a?s:0;0===c&&(c=e[0]-n[2]>a?-s:n[2]-e[0]>a?s:0),e[0]+=c}ko(t,e)}function Gn(e,t,n,s){const a=Math.pow(2,s.z)*Ns,c=[s.x*Ns,s.y*Ns],u=[];if(!e)return u;for(const d of e)for(const f of d){const p=[f.x+c[0],f.y+c[1]];is(p,t,n,a),u.push(p)}return u}function sd(e,t,n,s){const a=Math.pow(2,s.z)*Ns,c=[s.x*Ns,s.y*Ns],u=[];if(!e)return u;for(const f of e){const p=[];for(const g of f){const _=[g.x+c[0],g.y+c[1]];ko(t,_),p.push(_)}u.push(p)}if(t[2]-t[0]<=a/2){(d=t)[0]=d[1]=1/0,d[2]=d[3]=-1/0;for(const f of u)for(const p of f)is(p,t,n,a)}var d;return u}class oc{constructor(t,n){this.type=hn,this.geojson=t,this.geometries=n}static parse(t,n){if(2!==t.length)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ed(t[1])){const s=t[1];if("FeatureCollection"===s.type)for(let a=0;a<s.features.length;++a){const c=s.features[a].geometry.type;if("Polygon"===c||"MultiPolygon"===c)return new oc(s,s.features[a].geometry)}else if("Feature"===s.type){const a=s.geometry.type;if("Polygon"===a||"MultiPolygon"===a)return new oc(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new oc(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(n,s){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],u=n.canonicalID();if(!u)return!1;if("Polygon"===s.type){const d=bu(s.coordinates,c,u),f=Gn(n.geometry(),a,c,u);if(!rd(a,c))return!1;for(const p of f)if(!ic(p,d))return!1}if("MultiPolygon"===s.type){const d=Lo(s.coordinates,c,u),f=Gn(n.geometry(),a,c,u);if(!rd(a,c))return!1;for(const p of f)if(!IM(p,d))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(n,s){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],u=n.canonicalID();if(!u)return!1;if("Polygon"===s.type){const d=bu(s.coordinates,c,u),f=sd(n.geometry(),a,c,u);if(!rd(a,c))return!1;for(const p of f)if(!f1(p,d))return!1}if("MultiPolygon"===s.type){const d=Lo(s.coordinates,c,u),f=sd(n.geometry(),a,c,u);if(!rd(a,c))return!1;for(const p of f)if(!ga(p,d))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var ad=oc,T_={exports:{}};T_.exports=function(){var e={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},t=1/298.257223563,n=t*(2-t),s=Math.PI/180,a=function(p,g){if(void 0===p)throw new Error("No latitude given.");if(g&&!e[g])throw new Error("Unknown unit "+g+". Use one of: "+Object.keys(e).join(", "));var _=6378.137*s*(g?e[g]:1),v=Math.cos(p*s),x=1/(1-n*(1-v*v)),b=Math.sqrt(x);this.kx=_*b*v,this.ky=_*b*x*(1-n)},c={units:{configurable:!0}};function u(p,g){return p[0]===g[0]&&p[1]===g[1]}function d(p,g,_){var v=f(g[0]-p[0]);return[p[0]+v*_,p[1]+(g[1]-p[1])*_]}function f(p){for(;p<-180;)p+=360;for(;p>180;)p-=360;return p}return a.fromTile=function(p,g,_){var v=Math.PI*(1-2*(p+.5)/Math.pow(2,g)),x=Math.atan(.5*(Math.exp(v)-Math.exp(-v)))/s;return new a(x,_)},c.units.get=function(){return e},a.prototype.distance=function(p,g){var _=f(p[0]-g[0])*this.kx,v=(p[1]-g[1])*this.ky;return Math.sqrt(_*_+v*v)},a.prototype.bearing=function(p,g){var _=f(g[0]-p[0])*this.kx;return Math.atan2(_,(g[1]-p[1])*this.ky)/s},a.prototype.destination=function(p,g,_){var v=_*s;return this.offset(p,Math.sin(v)*g,Math.cos(v)*g)},a.prototype.offset=function(p,g,_){return[p[0]+g/this.kx,p[1]+_/this.ky]},a.prototype.lineDistance=function(p){for(var g=0,_=0;_<p.length-1;_++)g+=this.distance(p[_],p[_+1]);return g},a.prototype.area=function(p){for(var g=0,_=0;_<p.length;_++)for(var v=p[_],x=0,b=v.length,E=b-1;x<b;E=x++)g+=f(v[x][0]-v[E][0])*(v[x][1]+v[E][1])*(_?-1:1);return Math.abs(g)/2*this.kx*this.ky},a.prototype.along=function(p,g){var _=0;if(g<=0)return p[0];for(var v=0;v<p.length-1;v++){var x=p[v],b=p[v+1],E=this.distance(x,b);if((_+=E)>g)return d(x,b,(g-(_-E))/E)}return p[p.length-1]},a.prototype.pointToSegmentDistance=function(p,g,_){var v=g[0],x=g[1],b=f(_[0]-v)*this.kx,E=(_[1]-x)*this.ky,C=0;return 0===b&&0===E||((C=(f(p[0]-v)*this.kx*b+(p[1]-x)*this.ky*E)/(b*b+E*E))>1?(v=_[0],x=_[1]):C>0&&(v+=b/this.kx*C,x+=E/this.ky*C)),b=f(p[0]-v)*this.kx,E=(p[1]-x)*this.ky,Math.sqrt(b*b+E*E)},a.prototype.pointOnLine=function(p,g){for(var _,v,x,b,E=1/0,C=0;C<p.length-1;C++){var M=p[C][0],T=p[C][1],R=f(p[C+1][0]-M)*this.kx,P=(p[C+1][1]-T)*this.ky,I=0;0===R&&0===P||((I=(f(g[0]-M)*this.kx*R+(g[1]-T)*this.ky*P)/(R*R+P*P))>1?(M=p[C+1][0],T=p[C+1][1]):I>0&&(M+=R/this.kx*I,T+=P/this.ky*I));var O=(R=f(g[0]-M)*this.kx)*R+(P=(g[1]-T)*this.ky)*P;O<E&&(E=O,_=M,v=T,x=C,b=I)}return{point:[_,v],index:x,t:Math.max(0,Math.min(1,b))}},a.prototype.lineSlice=function(p,g,_){var v=this.pointOnLine(_,p),x=this.pointOnLine(_,g);if(v.index>x.index||v.index===x.index&&v.t>x.t){var b=v;v=x,x=b}var E=[v.point],C=v.index+1,M=x.index;!u(_[C],E[0])&&C<=M&&E.push(_[C]);for(var T=C+1;T<=M;T++)E.push(_[T]);return u(_[M],x.point)||E.push(x.point),E},a.prototype.lineSliceAlong=function(p,g,_){for(var v=0,x=[],b=0;b<_.length-1;b++){var E=_[b],C=_[b+1],M=this.distance(E,C);if((v+=M)>p&&0===x.length&&x.push(d(E,C,(p-(v-M))/M)),v>=g)return x.push(d(E,C,(g-(v-M))/M)),x;v>p&&x.push(C)}return x},a.prototype.bufferPoint=function(p,g){var _=g/this.ky,v=g/this.kx;return[p[0]-v,p[1]-_,p[0]+v,p[1]+_]},a.prototype.bufferBBox=function(p,g){var _=g/this.ky,v=g/this.kx;return[p[0]-v,p[1]-_,p[2]+v,p[3]+_]},a.prototype.insideBBox=function(p,g){return f(p[0]-g[0])>=0&&f(p[0]-g[2])<=0&&p[1]>=g[1]&&p[1]<=g[3]},Object.defineProperties(a,c),a}();var rs=Jr(T_.exports),wu={exports:{}};wu.exports=function(){var e=function(n,s){if(void 0===n&&(n=[]),void 0===s&&(s=t),this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};function t(n,s){return n<s?-1:n>s?1:0}return e.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var n=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),n}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(n){for(var s=this.data,a=this.compare,c=s[n];n>0;){var u=n-1>>1,d=s[u];if(a(c,d)>=0)break;s[n]=d,n=u}s[n]=c},e.prototype._down=function(n){for(var s=this.data,a=this.compare,c=this.length>>1,u=s[n];n<c;){var d=1+(n<<1),f=s[d],p=d+1;if(p<this.length&&a(s[p],f)<0&&(d=p,f=s[p]),a(f,u)>=0)break;s[n]=f,n=d}s[n]=u},e}();var Ip=Jr(wu.exports),ut=8192;function Ap(e,t){return t.dist-e.dist}const Rp=100,Pp=50;function Eu(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function ld(e){return e[1]-e[0]+1}function zs(e,t){const n=e[1]>=e[0]&&e[1]<t;return n||console.warn("Distance Expression: Index is out of range"),n}function S_(e,t){if(e[0]>e[1])return[null,null];const n=ld(e);if(t){if(2===n)return[e,null];const s=Math.floor(n/2);return[[e[0],e[0]+s],[e[0]+s,e[1]]]}{if(1===n)return[e,null];const s=Math.floor(n/2)-1;return[[e[0],e[0]+s],[e[0]+s+1,e[1]]]}}function el(e,t){const n=[1/0,1/0,-1/0,-1/0];if(!zs(t,e.length))return n;for(let s=t[0];s<=t[1];++s)ko(n,e[s]);return n}function Op(e){const t=[1/0,1/0,-1/0,-1/0];for(let n=0;n<e.length;++n)for(let s=0;s<e[n].length;++s)ko(t,e[n][s]);return t}function Cu(e,t,n){if(Eu(e)||Eu(t))return NaN;let s=0,a=0;return e[2]<t[0]&&(s=t[0]-e[2]),e[0]>t[2]&&(s=e[0]-t[2]),e[1]>t[3]&&(a=e[1]-t[3]),e[3]<t[1]&&(a=t[1]-e[3]),n.distance([0,0],[s,a])}function xo(e,t){const n=Math.pow(2,t.z);return[(a=(e.x/ut+t.x)/n,360*a-180),(s=(e.y/ut+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,a}function RM(e,t){const n=[];for(let s=0;s<e.length;++s)n.push(xo(e[s],t));return n}function I_(e,t,n){const s=n.pointOnLine(t,e).point;return n.distance(e,s)}function p1(e,t,n,s,a){const c=n.slice(s[0],s[1]+1);let u=1/0;for(let d=t[0];d<=t[1];++d)if(0===(u=Math.min(u,I_(e[d],c,a))))return 0;return u}function A_(e,t,n,s,a){const c=Math.min(a.pointToSegmentDistance(e,n,s),a.pointToSegmentDistance(t,n,s)),u=Math.min(a.pointToSegmentDistance(n,e,t),a.pointToSegmentDistance(s,e,t));return Math.min(c,u)}function PM(e,t,n,s,a){if(!zs(t,e.length)||!zs(s,n.length))return NaN;let c=1/0;for(let u=t[0];u<t[1];++u)for(let d=s[0];d<s[1];++d){if(rc(e[u],e[u+1],n[d],n[d+1]))return 0;c=Math.min(c,A_(e[u],e[u+1],n[d],n[d+1],a))}return c}function OM(e,t,n,s,a){if(!zs(t,e.length)||!zs(s,n.length))return NaN;let c=1/0;for(let u=t[0];u<=t[1];++u)for(let d=s[0];d<=s[1];++d)if(0===(c=Math.min(c,a.distance(e[u],n[d]))))return c;return c}function m1(e,t,n){if(ic(e,t,!0))return 0;let s=1/0;for(const a of t){const c=a.length;if(c<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[c-1]&&0===(s=Math.min(s,n.pointToSegmentDistance(e,a[c-1],a[0])))||0===(s=Math.min(s,I_(e,a,n))))return s}return s}function kM(e,t,n,s){if(!zs(t,e.length))return NaN;for(let c=t[0];c<=t[1];++c)if(ic(e[c],n,!0))return 0;let a=1/0;for(let c=t[0];c<t[1];++c)for(const u of n)for(let d=0,f=u.length,p=f-1;d<f;p=d++){if(rc(e[c],e[c+1],u[p],u[d]))return 0;a=Math.min(a,A_(e[c],e[c+1],u[p],u[d],s))}return a}function g1(e,t){for(const n of e)for(let s=0;s<=n.length-1;++s)if(ic(n[s],t,!0))return!0;return!1}function LM(e,t,n,s=1/0){const a=Op(e),c=Op(t);if(s!==1/0&&Cu(a,c,n)>=s)return s;if(rd(a,c)){if(g1(e,t))return 0}else if(g1(t,e))return 0;let u=s;for(const d of e)for(let f=0,p=d.length,g=p-1;f<p;g=f++)for(const _ of t)for(let v=0,x=_.length,b=x-1;v<x;b=v++){if(rc(d[g],d[f],_[b],_[v]))return 0;u=Math.min(u,A_(d[g],d[f],_[b],_[v],n))}return u}function Ni(e,t,n,s,a,c,u){if(null===c||null===u)return;const d=Cu(el(s,c),el(a,u),n);d<t&&e.push({dist:d,range1:c,range2:u})}function FM(e,t,n,s,a=1/0){let c=Math.min(s.distance(e[0],n[0][0]),a);if(0===c)return c;const u=new Ip([{dist:0,range1:[0,e.length-1],range2:[0,0]}],Ap),d=t?Pp:Rp,f=Op(n);for(;u.length;){const p=u.pop();if(p.dist>=c)continue;const g=p.range1;if(ld(g)<=d){if(!zs(g,e.length))return NaN;if(t){const _=kM(e,g,n,s);if(0===(c=Math.min(c,_)))return c}else for(let _=g[0];_<=g[1];++_){const v=m1(e[_],n,s);if(0===(c=Math.min(c,v)))return c}}else{const _=S_(g,t);if(null!==_[0]){const v=Cu(el(e,_[0]),f,s);v<c&&u.push({dist:v,range1:_[0],range2:[0,0]})}if(null!==_[1]){const v=Cu(el(e,_[1]),f,s);v<c&&u.push({dist:v,range1:_[1],range2:[0,0]})}}}return c}function _1(e,t,n,s,a,c=1/0){let u=Math.min(c,a.distance(e[0],n[0]));if(0===u)return u;const d=new Ip([{dist:0,range1:[0,e.length-1],range2:[0,n.length-1]}],Ap),f=t?Pp:Rp,p=s?Pp:Rp;for(;d.length;){const g=d.pop();if(g.dist>=u)continue;const _=g.range1,v=g.range2;if(ld(_)<=f&&ld(v)<=p){if(!zs(_,e.length)||!zs(v,n.length))return NaN;if(t&&s?u=Math.min(u,PM(e,_,n,v,a)):t||s?t&&!s?u=Math.min(u,p1(n,v,e,_,a)):!t&&s&&(u=Math.min(u,p1(e,_,n,v,a))):u=Math.min(u,OM(e,_,n,v,a)),0===u)return u}else{const x=S_(_,t),b=S_(v,s);Ni(d,u,a,e,n,x[0],b[0]),Ni(d,u,a,e,n,x[0],b[1]),Ni(d,u,a,e,n,x[1],b[0]),Ni(d,u,a,e,n,x[1],b[1])}}return u}function R_(e,t,n,s,a=1/0){let c=a;const u=el(e,[0,e.length-1]);for(const d of n)if(!(c!==1/0&&Cu(u,el(d,[0,d.length-1]),s)>=c)&&(c=Math.min(c,_1(e,t,d,!0,s,c)),0===c))return c;return c}function Vi(e,t,n,s,a=1/0){let c=a;const u=el(e,[0,e.length-1]);for(const d of n){if(c!==1/0&&Cu(u,Op(d),s)>=c)continue;const f=FM(e,t,d,s,c);if(isNaN(f))return f;if(0===(c=Math.min(c,f)))return c}return c}function P_(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class Du{constructor(t,n){this.type=Ht,this.geojson=t,this.geometries=n}static parse(t,n){if(2!==t.length)return n.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(ed(t[1])){const s=t[1];if("FeatureCollection"===s.type){for(let a=0;a<s.features.length;++a)if(P_(s.features[a].geometry.type))return new Du(s,s.features[a].geometry)}else if("Feature"===s.type){if(P_(s.geometry.type))return new Du(s,s.geometry)}else if(P_(s.type))return new Du(s,s)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const n=t.geometry(),s=t.canonicalID();if(null!=n&&null!=s){if("Point"===t.geometryType())return function(a,c,u){const d=[];for(const p of a)for(const g of p)d.push(xo(g,c));const f=new rs(d[0][1],"meters");return"Point"===u.type||"MultiPoint"===u.type||"LineString"===u.type?_1(d,!1,"Point"===u.type?[u.coordinates]:u.coordinates,"LineString"===u.type,f):"MultiLineString"===u.type?R_(d,!1,u.coordinates,f):"Polygon"===u.type||"MultiPolygon"===u.type?Vi(d,!1,"Polygon"===u.type?[u.coordinates]:u.coordinates,f):null}(n,s,this.geometries);if("LineString"===t.geometryType())return function(a,c,u){const d=[];for(const p of a){const g=[];for(const _ of p)g.push(xo(_,c));d.push(g)}const f=new rs(d[0][0][1],"meters");if("Point"===u.type||"MultiPoint"===u.type||"LineString"===u.type)return R_("Point"===u.type?[u.coordinates]:u.coordinates,"LineString"===u.type,d,f);if("MultiLineString"===u.type){let p=1/0;for(let g=0;g<u.coordinates.length;g++){const _=R_(u.coordinates[g],!0,d,f,p);if(isNaN(_))return _;if(0===(p=Math.min(p,_)))return p}return p}if("Polygon"===u.type||"MultiPolygon"===u.type){let p=1/0;for(let g=0;g<d.length;g++){const _=Vi(d[g],!0,"Polygon"===u.type?[u.coordinates]:u.coordinates,f,p);if(isNaN(_))return _;if(0===(p=Math.min(p,_)))return p}return p}return null}(n,s,this.geometries);if("Polygon"===t.geometryType())return function(a,c,u){const d=[];for(const p of function(g,_){const v=g.length;if(v<=1)return[g];const x=[];let b,E;for(let C=0;C<v;C++){const M=SM(g[C]);0!==M&&(g[C].area=Math.abs(M),void 0===E&&(E=M<0),E===M<0?(b&&x.push(b),b=[g[C]]):b.push(g[C]))}return b&&x.push(b),x}(a)){const g=[];for(let _=0;_<p.length;++_)g.push(RM(p[_],c));d.push(g)}const f=new rs(d[0][0][0][1],"meters");if("Point"===u.type||"MultiPoint"===u.type||"LineString"===u.type)return Vi("Point"===u.type?[u.coordinates]:u.coordinates,"LineString"===u.type,d,f);if("MultiLineString"===u.type){let p=1/0;for(let g=0;g<u.coordinates.length;g++){const _=Vi(u.coordinates[g],!0,d,f,p);if(isNaN(_))return _;if(0===(p=Math.min(p,_)))return p}return p}return"Polygon"===u.type||"MultiPolygon"===u.type?function(p,g,_){let v=1/0;for(const x of p)for(const b of g){const E=LM(x,b,_,v);if(isNaN(E))return E;if(0===(v=Math.min(v,E)))return v}return v}("Polygon"===u.type?[u.coordinates]:u.coordinates,d,f):null}(n,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Ui=Du;function Qi(e){if(e instanceof Fs&&("get"===e.name&&1===e.args.length||"feature-state"===e.name||"has"===e.name&&1===e.args.length||"properties"===e.name||"geometry-type"===e.name||"id"===e.name||/^filter-/.test(e.name))||e instanceof ad||e instanceof Ui)return!1;let t=!0;return e.eachChild(n=>{t&&!Qi(n)&&(t=!1)}),t}function In(e){if(e instanceof Fs&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(n=>{t&&!In(n)&&(t=!1)}),t}function Ji(e){if(e instanceof Fs&&"config"===e.name)return!1;let t=!0;return e.eachChild(n=>{t&&!Ji(n)&&(t=!1)}),t}function Zi(e,t){if(e instanceof Fs&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild(s=>{n&&!Zi(s,t)&&(n=!1)}),n}class nl{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(2!==t.length||"string"!=typeof t[1])return n.error("'var' expression requires exactly one string literal argument.");const s=t[1];return n.scope.has(s)?new nl(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var no=nl;class kp{constructor(t,n=[],s,a=new K2,c=[],u){this.registry=t,this.path=n,this.key=n.map(d=>`[${d}]`).join(""),this.scope=a,this.errors=c,this.expectedType=s,this.options=u}parse(t,n,s,a,c={}){return n||s?this.concat(n,s,a)._parse(t,c):this._parse(t,c)}_parse(t,n){function s(a,c,u){return"assert"===u?new ma(c,[a]):"coerce"===u?new vu(c,[a]):a}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a="string"==typeof t[0]?this.registry[t[0]]:void 0;if(a){let c=a.parse(t,this);if(!c)return null;if(this.expectedType){const u=this.expectedType,d=c.type;if("string"!==u.kind&&"number"!==u.kind&&"boolean"!==u.kind&&"object"!==u.kind&&"array"!==u.kind||"value"!==d.kind)if("color"!==u.kind&&"formatted"!==u.kind&&"resolvedImage"!==u.kind||"value"!==d.kind&&"string"!==d.kind){if(this.checkSubtype(u,d))return null}else c=s(c,u,n.typeAnnotation||"coerce");else c=s(c,u,n.typeAnnotation||"assert")}if(!(c instanceof ec)&&"resolvedImage"!==c.type.kind&&Mu(c)){const u=new Tp(this.options);try{c=new ec(c.type,c.evaluate(u))}catch(d){return this.error(d.message),null}}return c}return vu.parse(["to-array",t],this)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,s){const a="number"==typeof t?this.path.concat(t):this.path,c=s?this.scope.concat(s):this.scope;return new kp(this.registry,a,n||null,c,this.errors,this.options)}error(t,...n){const s=`${this.key}${n.map(a=>`[${a}]`).join("")}`;this.errors.push(new fa(s,t))}checkSubtype(t,n){const s=wp(t,n);return s&&this.error(s),s}}var O_=kp;function Mu(e){if(e instanceof no)return Mu(e.boundExpression);if(e instanceof Fs&&"error"===e.name||e instanceof Fs&&"config"===e.name||e instanceof Sp||e instanceof ad||e instanceof Ui)return!1;const t=e instanceof vu||e instanceof ma;let n=!0;return e.eachChild(s=>{n=t?n&&Mu(s):n&&s instanceof ec}),!!n&&Qi(e)&&Zi(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function Lp(e,t){const n=e.length-1;let s,a,c=0,u=n,d=0;for(;c<=u;)if(d=Math.floor((c+u)/2),s=e[d],a=e[d+1],s<=t){if(d===n||t<a)return d;c=d+1}else{if(!(s>t))throw new Fi("Input is not a number.");u=d-1}return 0}class k_{constructor(t,n,s){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[a,c]of s)this.labels.push(a),this.outputs.push(c)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(t[1],1,Ht);if(!s)return null;const a=[];let c=null;n.expectedType&&"value"!==n.expectedType.kind&&(c=n.expectedType);for(let u=1;u<t.length;u+=2){const d=1===u?-1/0:t[u],f=t[u+1],p=u,g=u+1;if("number"!=typeof d)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(a.length&&a[a.length-1][0]>=d)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',p);const _=n.parse(f,g,c);if(!_)return null;c=c||_.type,a.push([d,_])}return new k_(c,s,a)}evaluate(t){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(t);const a=this.input.evaluate(t);if(a<=n[0])return s[0].evaluate(t);const c=n.length;return a>=n[c-1]?s[c-1].evaluate(t):s[Lp(n,a)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&t.push(this.labels[n]),t.push(this.outputs[n].serialize());return t}}var xi=k_;function vt(e,t,n){return e*(1-n)+t*n}function sn(e,t,n){return e.map((s,a)=>vt(s,t[a],n))}var di=Object.freeze({__proto__:null,array:sn,color:function(e,t,n){return new Pe(vt(e.r,t.r,n),vt(e.g,t.g,n),vt(e.b,t.b,n),vt(e.a,t.a,n))},number:vt});const yr=4/29,os=6/29,zi=3*os*os,il=os*os*os,Su=Math.PI/180,en=180/Math.PI;function sc(e){return e>il?Math.pow(e,1/3):e/zi+yr}function Fp(e){return e>os?e*e*e:zi*(e-yr)}function rl(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Ii(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Iu(e){const t=Ii(e.r),n=Ii(e.g),s=Ii(e.b),a=sc((.4124564*t+.3575761*n+.1804375*s)/.95047),c=sc((.2126729*t+.7151522*n+.072175*s)/1);return{l:116*c-16,a:500*(a-c),b:200*(c-sc((.0193339*t+.119192*n+.9503041*s)/1.08883)),alpha:e.a}}function ac(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,s=isNaN(e.b)?t:t-e.b/200;return t=1*Fp(t),n=.95047*Fp(n),s=1.08883*Fp(s),new Pe(rl(3.2404542*n-1.5371385*t-.4985314*s),rl(-.969266*n+1.8760108*t+.041556*s),rl(.0556434*n-.2040259*t+1.0572252*s),e.alpha)}function Bs(e,t,n){const s=t-e;return e+n*(s>180||s<-180?s-360*Math.round(s/360):s)}const _a={forward:Iu,reverse:ac,interpolate:function(e,t,n){return{l:vt(e.l,t.l,n),a:vt(e.a,t.a,n),b:vt(e.b,t.b,n),alpha:vt(e.alpha,t.alpha,n)}}},Au={forward:function(e){const{l:t,a:n,b:s}=Iu(e),a=Math.atan2(s,n)*en;return{h:a<0?a+360:a,c:Math.sqrt(n*n+s*s),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Su,n=e.c;return ac({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:Bs(e.h,t.h,n),c:vt(e.c,t.c,n),l:vt(e.l,t.l,n),alpha:vt(e.alpha,t.alpha,n)}}};var ya=Object.freeze({__proto__:null,hcl:Au,lab:_a});class No{constructor(t,n,s,a,c){this.type=t,this.operator=n,this.interpolation=s,this.input=a,this.labels=[],this.outputs=[];for(const[u,d]of c)this.labels.push(u),this.outputs.push(d)}static interpolationFactor(t,n,s,a){let c=0;if("exponential"===t.name)c=lc(n,t.base,s,a);else if("linear"===t.name)c=lc(n,1,s,a);else if("cubic-bezier"===t.name){const u=t.controlPoints;c=new mp(u[0],u[1],u[2],u[3]).solve(lc(n,1,s,a))}return c}static parse(t,n){let[s,a,c,...u]=t;if(!Array.isArray(a)||0===a.length)return n.error("Expected an interpolation type expression.",1);if("linear"===a[0])a={name:"linear"};else if("exponential"===a[0]){const p=a[1];if("number"!=typeof p)return n.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:p}}else{if("cubic-bezier"!==a[0])return n.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const p=a.slice(1);if(4!==p.length||p.some(g=>"number"!=typeof g||g<0||g>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:p}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(c=n.parse(c,2,Ht),!c)return null;const d=[];let f=null;"interpolate-hcl"===s||"interpolate-lab"===s?f=ns:n.expectedType&&"value"!==n.expectedType.kind&&(f=n.expectedType);for(let p=0;p<u.length;p+=2){const g=u[p],_=u[p+1],v=p+3,x=p+4;if("number"!=typeof g)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(d.length&&d[d.length-1][0]>=g)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',v);const b=n.parse(_,x,f);if(!b)return null;f=f||b.type,d.push([g,b])}return"number"===f.kind||"color"===f.kind||"array"===f.kind&&"number"===f.itemType.kind&&"number"==typeof f.N?new No(f,s,a,c,d):n.error(`Type ${Si(f)} is not interpolatable.`)}evaluate(t){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(t);const a=this.input.evaluate(t);if(a<=n[0])return s[0].evaluate(t);const c=n.length;if(a>=n[c-1])return s[c-1].evaluate(t);const u=Lp(n,a),d=No.interpolationFactor(this.interpolation,a,n[u],n[u+1]),f=s[u].evaluate(t),p=s[u+1].evaluate(t);return"interpolate"===this.operator?di[this.type.kind.toLowerCase()](f,p,d):"interpolate-hcl"===this.operator?Au.reverse(Au.interpolate(Au.forward(f),Au.forward(p),d)):_a.reverse(_a.interpolate(_a.forward(f),_a.forward(p),d))}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,t,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function lc(e,t,n,s){const a=s-n,c=e-n;return 0===a?0:1===t?c/a:(Math.pow(t,c)-1)/(Math.pow(t,a)-1)}var io=No;class Cn{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let s=null;const a=n.expectedType;a&&"value"!==a.kind&&(s=a);const c=[];for(const d of t.slice(1)){const f=n.parse(d,1+c.length,s,void 0,{typeAnnotation:"omit"});if(!f)return null;s=s||f.type,c.push(f)}const u=a&&c.some(d=>wp(a,d.type));return new Cn(u?un:s,c)}evaluate(t){let n,s=null,a=0;for(const c of this.args){if(a++,s=c.evaluate(t),s&&s instanceof gi&&!s.available&&(n||(n=s),s=null,a===this.args.length))return n;if(null!==s)break}return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var NM=Cn;class cd{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let c=1;c<t.length-1;c+=2){const u=t[c];if("string"!=typeof u)return n.error(`Expected string, but found ${typeof u} instead.`,c);if(/[^a-zA-Z0-9_]/.test(u))return n.error("Variable names must contain only alphanumeric characters or '_'.",c);const d=n.parse(t[c+1],c+1);if(!d)return null;s.push([u,d])}const a=n.parse(t[t.length-1],t.length-1,n.expectedType,s);return a?new cd(s,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[n,s]of this.bindings)t.push(n,s.serialize());return t.push(this.result.serialize()),t}}var L_=cd;class zo{constructor(t,n,s){this.type=t,this.index=n,this.input=s}static parse(t,n){if(3!==t.length)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=n.parse(t[1],1,Ht),a=n.parse(t[2],2,vo(n.expectedType||un));return s&&a?new zo(a.type.itemType,s,a):null}evaluate(t){const n=this.index.evaluate(t),s=this.input.evaluate(t);if(n<0)throw new Fi(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new Fi(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new Fi(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Np=zo;class ol{constructor(t,n){this.type=hn,this.needle=t,this.haystack=n}static parse(t,n){if(3!==t.length)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=n.parse(t[1],1,un),a=n.parse(t[2],2,un);return s&&a?ji(s.type,[hn,on,Ht,Qh,un])?new ol(s,a):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Si(s.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(null==s)return!1;if(!tl(n,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${Si(Ke(n))} instead.`);if(!tl(s,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${Si(Ke(s))} instead.`);return s.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ud=ol;class Wi{constructor(t,n,s){this.type=Ht,this.needle=t,this.haystack=n,this.fromIndex=s}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=n.parse(t[1],1,un),a=n.parse(t[2],2,un);if(!s||!a)return null;if(!ji(s.type,[hn,on,Ht,Qh,un]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Si(s.type)} instead`);if(4===t.length){const c=n.parse(t[3],3,Ht);return c?new Wi(s,a,c):null}return new Wi(s,a)}evaluate(t){const n=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!tl(n,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${Si(Ke(n))} instead.`);if(!tl(s,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${Si(Ke(s))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(t);return s.indexOf(n,a)}return s.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var J2=Wi;class Cr{constructor(t,n,s,a,c,u){this.inputType=t,this.type=n,this.input=s,this.cases=a,this.outputs=c,this.otherwise=u}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let s,a;n.expectedType&&"value"!==n.expectedType.kind&&(a=n.expectedType);const c={},u=[];for(let p=2;p<t.length-1;p+=2){let g=t[p];const _=t[p+1];Array.isArray(g)||(g=[g]);const v=n.concat(p);if(0===g.length)return v.error("Expected at least one branch label.");for(const b of g){if("number"!=typeof b&&"string"!=typeof b)return v.error("Branch labels must be numbers or strings.");if("number"==typeof b&&Math.abs(b)>Number.MAX_SAFE_INTEGER)return v.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof b&&Math.floor(b)!==b)return v.error("Numeric branch labels must be integer values.");if(s){if(v.checkSubtype(s,Ke(b)))return null}else s=Ke(b);if(void 0!==c[String(b)])return v.error("Branch labels must be unique.");c[String(b)]=u.length}const x=n.parse(_,p,a);if(!x)return null;a=a||x.type,u.push(x)}const d=n.parse(t[1],1,un);if(!d)return null;const f=n.parse(t[t.length-1],t.length-1,a);return f?"value"!==d.type.kind&&n.concat(1).checkSubtype(s,d.type)?null:new Cr(s,a,d,c,u,f):null}evaluate(t){const n=this.input.evaluate(t);return(Ke(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],a={};for(const u of n){const d=a[this.cases[u]];void 0===d?(a[this.cases[u]]=s.length,s.push([this.cases[u],[u]])):s[d][1].push(u)}const c=u=>"number"===this.inputType.kind?Number(u):u;for(const[u,d]of s)t.push(1===d.length?c(d[0]):d.map(c)),t.push(this.outputs[u].serialize());return t.push(this.otherwise.serialize()),t}}var Br=Cr;class hd{constructor(t,n,s){this.type=t,this.branches=n,this.otherwise=s}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&"value"!==n.expectedType.kind&&(s=n.expectedType);const a=[];for(let u=1;u<t.length-1;u+=2){const d=n.parse(t[u],u,hn);if(!d)return null;const f=n.parse(t[u+1],u+1,s);if(!f)return null;a.push([d,f]),s=s||f.type}const c=n.parse(t[t.length-1],t.length-1,s);return c?new hd(s,a,c):null}evaluate(t){for(const[n,s]of this.branches)if(n.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,s]of this.branches)t(n),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var cc=hd;class uc{constructor(t,n,s,a){this.type=t,this.input=n,this.beginIndex=s,this.endIndex=a}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=n.parse(t[1],1,un),a=n.parse(t[2],2,Ht);if(!s||!a)return null;if(!ji(s.type,[vo(un),on,un]))return n.error(`Expected first argument to be of type array or string, but found ${Si(s.type)} instead`);if(4===t.length){const c=n.parse(t[3],3,Ht);return c?new uc(s.type,s,a,c):null}return new uc(s.type,s,a)}evaluate(t){const n=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!tl(n,["string","array"]))throw new Fi(`Expected first argument to be of type array or string, but found ${Si(Ke(n))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(t);return n.slice(s,a)}return n.slice(s)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ss=uc;function zp(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function y1(e,t,n,s){return 0===s.compare(t,n)}function Ru(e,t,n){const s="=="!==e&&"!="!==e;return class Qk{constructor(c,u,d){this.type=hn,this.lhs=c,this.rhs=u,this.collator=d,this.hasUntypedArgument="value"===c.type.kind||"value"===u.type.kind}static parse(c,u){if(3!==c.length&&4!==c.length)return u.error("Expected two or three arguments.");const d=c[0];let f=u.parse(c[1],1,un);if(!f)return null;if(!zp(d,f.type))return u.concat(1).error(`"${d}" comparisons are not supported for type '${Si(f.type)}'.`);let p=u.parse(c[2],2,un);if(!p)return null;if(!zp(d,p.type))return u.concat(2).error(`"${d}" comparisons are not supported for type '${Si(p.type)}'.`);if(f.type.kind!==p.type.kind&&"value"!==f.type.kind&&"value"!==p.type.kind)return u.error(`Cannot compare types '${Si(f.type)}' and '${Si(p.type)}'.`);s&&("value"===f.type.kind&&"value"!==p.type.kind?f=new ma(p.type,[f]):"value"!==f.type.kind&&"value"===p.type.kind&&(p=new ma(f.type,[p])));let g=null;if(4===c.length){if("string"!==f.type.kind&&"string"!==p.type.kind&&"value"!==f.type.kind&&"value"!==p.type.kind)return u.error("Cannot use collator to compare non-string types.");if(g=u.parse(c[3],3,Fr),!g)return null}return new Qk(f,p,g)}evaluate(c){const u=this.lhs.evaluate(c),d=this.rhs.evaluate(c);if(s&&this.hasUntypedArgument){const f=Ke(u),p=Ke(d);if(f.kind!==p.kind||"string"!==f.kind&&"number"!==f.kind)throw new Fi(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${f.kind}, ${p.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const f=Ke(u),p=Ke(d);if("string"!==f.kind||"string"!==p.kind)return t(c,u,d)}return this.collator?n(c,u,d,this.collator.evaluate(c)):t(c,u,d)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[e];return this.eachChild(u=>{c.push(u.serialize())}),c}}}const tR=Ru("==",function(e,t,n){return t===n},y1),zM=Ru("!=",function(e,t,n){return t!==n},function(e,t,n,s){return!y1(0,t,n,s)}),BM=Ru("<",function(e,t,n){return t<n},function(e,t,n,s){return s.compare(t,n)<0}),eR=Ru(">",function(e,t,n){return t>n},function(e,t,n,s){return s.compare(t,n)>0}),nR=Ru("<=",function(e,t,n){return t<=n},function(e,t,n,s){return s.compare(t,n)<=0}),iR=Ru(">=",function(e,t,n){return t>=n},function(e,t,n,s){return s.compare(t,n)>=0});class v1{constructor(t,n,s,a,c,u){this.type=on,this.number=t,this.locale=n,this.currency=s,this.unit=a,this.minFractionDigits=c,this.maxFractionDigits=u}static parse(t,n){if(3!==t.length)return n.error("Expected two arguments.");const s=n.parse(t[1],1,Ht);if(!s)return null;const a=t[2];if("object"!=typeof a||Array.isArray(a))return n.error("NumberFormat options argument must be an object.");let c=null;if(a.locale&&(c=n.parse(a.locale,1,on),!c))return null;let u=null;if(a.currency&&(u=n.parse(a.currency,1,on),!u))return null;let d=null;if(a.unit&&(d=n.parse(a.unit,1,on),!d))return null;let f=null;if(a["min-fraction-digits"]&&(f=n.parse(a["min-fraction-digits"],1,Ht),!f))return null;let p=null;return a["max-fraction-digits"]&&(p=n.parse(a["max-fraction-digits"],1,Ht),!p)?null:new v1(s,c,u,d,f,p)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class x1{constructor(t){this.type=Ht,this.input=t}static parse(t,n){if(2!==t.length)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=n.parse(t[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?n.error(`Expected argument of type string or array, but found ${Si(s.type)} instead.`):new x1(s):null}evaluate(t){const n=this.input.evaluate(t);if("string"==typeof n||Array.isArray(n))return n.length;throw new Fi(`Expected value to be of type string or array, but found ${Si(Ke(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(n=>{t.push(n.serialize())}),t}}function b1(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const jM={"==":tR,"!=":zM,">":eR,"<":BM,">=":iR,"<=":nR,array:ma,at:Np,boolean:ma,case:cc,coalesce:NM,collator:Sp,format:nc,image:Mp,in:ud,"index-of":J2,interpolate:io,"interpolate-hcl":io,"interpolate-lab":io,length:x1,let:L_,literal:ec,match:Br,number:ma,"number-format":v1,object:ma,slice:ss,step:xi,string:ma,"to-boolean":vu,"to-color":vu,"to-number":vu,"to-string":vu,var:no,within:ad,distance:Ui};function VM(e,[t,n,s,a]){t=t.evaluate(e),n=n.evaluate(e),s=s.evaluate(e);const c=a?a.evaluate(e):1,u=D_(t,n,s,c);if(u)throw new Fi(u);return new Pe(t/255*c,n/255*c,s/255*c,c)}function UM(e,[t,n,s,a]){t=t.evaluate(e),n=n.evaluate(e),s=s.evaluate(e);const c=a?a.evaluate(e):1,u=(g=n,_=s,v=c,"number"==typeof(p=t)&&p>=0&&p<=360?"number"==typeof g&&g>=0&&g<=100&&"number"==typeof _&&_>=0&&_<=100?void 0===v||"number"==typeof v&&v>=0&&v<=1?null:`Invalid hsla value [${[p,g,_,v].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof v?[p,g,_,v]:[p,g,_]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof v?[p,g,_,v]:[p,g,_]).join(", ")}]: 'h' must be between 0 and 360.`);var p,g,_,v;if(u)throw new Fi(u);const d=`hsla(${t}, ${n}%, ${s}%, ${c})`,f=Pe.parse(d);if(!f)throw new Fi(`Failed to parse HSLA color: ${d}`);return f}function $M(e,t){return e in t}function w1(e,t){const n=t[e];return void 0===n?null:n}function HM(e,t){switch(e){case"string":return String(t);case"number":return+t;case"boolean":return!!t;case"color":return Pe.parse(t)}return t}function F_(e,t,n,s){return void 0!==s&&(e=s*Math.round(e/s)),void 0!==t&&e<t&&(e=t),void 0!==n&&e>n&&(e=n),e}function N_(e,t,n){n.length&&(t+=`\x1f${n}`);const s=e.getConfig(t);if(!s)return null;const{type:a,value:c,values:u,minValue:d,maxValue:f,stepValue:p}=s,g=s.default.evaluate(e);let _=c?c.evaluate(e):g;return a&&(_=HM(a,_)),void 0!==c&&void 0!==_&&u&&!u.includes(_)&&(_=g,a&&(_=HM(a,_))),void 0===_||void 0===d&&void 0===f&&void 0===p||("number"==typeof _?_=F_(_,d,f,p):Array.isArray(_)&&(_=_.map(v=>"number"==typeof v?F_(v,d,f,p):v))),_}function Pu(e){return{type:e}}Fs.register(jM,{error:[{kind:"error"},[on],(e,[t])=>{throw new Fi(t.evaluate(e))}],typeof:[on,[un],(e,[t])=>Si(Ke(t.evaluate(e)))],"to-rgba":[vo(Ht,4),[ns],(e,[t])=>t.evaluate(e).toArray()],rgb:[ns,[Ht,Ht,Ht],VM],rgba:[ns,[Ht,Ht,Ht,Ht],VM],hsl:[ns,[Ht,Ht,Ht],UM],hsla:[ns,[Ht,Ht,Ht,Ht],UM],has:{type:hn,overloads:[[[on],(e,[t])=>$M(t.evaluate(e),e.properties())],[[on,_u],(e,[t,n])=>$M(t.evaluate(e),n.evaluate(e))]]},get:{type:un,overloads:[[[on],(e,[t])=>w1(t.evaluate(e),e.properties())],[[on,_u],(e,[t,n])=>w1(t.evaluate(e),n.evaluate(e))]]},config:{type:un,overloads:[[[on],(e,[t])=>N_(e,t.evaluate(e),"")],[[on,on],(e,[t,n])=>N_(e,t.evaluate(e),n.evaluate(e))]]},"feature-state":[un,[on],(e,[t])=>w1(t.evaluate(e),e.featureState||{})],properties:[_u,[],e=>e.properties()],"geometry-type":[on,[],e=>e.geometryType()],id:[un,[],e=>e.id()],zoom:[Ht,[],e=>e.globals.zoom],pitch:[Ht,[],e=>e.globals.pitch||0],"distance-from-center":[Ht,[],e=>e.distanceFromCenter()],"measure-light":[Ht,[on],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[Ht,[],e=>e.globals.heatmapDensity||0],"line-progress":[Ht,[],e=>e.globals.lineProgress||0],"raster-value":[Ht,[],e=>e.globals.rasterValue||0],"sky-radial-progress":[Ht,[],e=>e.globals.skyRadialProgress||0],accumulated:[un,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Ht,Pu(Ht),(e,t)=>{let n=0;for(const s of t)n+=s.evaluate(e);return n}],"*":[Ht,Pu(Ht),(e,t)=>{let n=1;for(const s of t)n*=s.evaluate(e);return n}],"-":{type:Ht,overloads:[[[Ht,Ht],(e,[t,n])=>t.evaluate(e)-n.evaluate(e)],[[Ht],(e,[t])=>-t.evaluate(e)]]},"/":[Ht,[Ht,Ht],(e,[t,n])=>t.evaluate(e)/n.evaluate(e)],"%":[Ht,[Ht,Ht],(e,[t,n])=>t.evaluate(e)%n.evaluate(e)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(e,[t,n])=>Math.pow(t.evaluate(e),n.evaluate(e))],sqrt:[Ht,[Ht],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Ht,[Ht],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Ht,[Ht],(e,[t])=>Math.log(t.evaluate(e))],log2:[Ht,[Ht],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Ht,[Ht],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Ht,[Ht],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Ht,[Ht],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Ht,[Ht],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Ht,[Ht],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Ht,[Ht],(e,[t])=>Math.atan(t.evaluate(e))],min:[Ht,Pu(Ht),(e,t)=>Math.min(...t.map(n=>n.evaluate(e)))],max:[Ht,Pu(Ht),(e,t)=>Math.max(...t.map(n=>n.evaluate(e)))],abs:[Ht,[Ht],(e,[t])=>Math.abs(t.evaluate(e))],round:[Ht,[Ht],(e,[t])=>{const n=t.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ht,[Ht],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Ht,[Ht],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[hn,[on,un],(e,[t,n])=>e.properties()[t.value]===n.value],"filter-id-==":[hn,[un],(e,[t])=>e.id()===t.value],"filter-type-==":[hn,[on],(e,[t])=>e.geometryType()===t.value],"filter-<":[hn,[on,un],(e,[t,n])=>{const s=e.properties()[t.value],a=n.value;return typeof s==typeof a&&s<a}],"filter-id-<":[hn,[un],(e,[t])=>{const n=e.id(),s=t.value;return typeof n==typeof s&&n<s}],"filter->":[hn,[on,un],(e,[t,n])=>{const s=e.properties()[t.value],a=n.value;return typeof s==typeof a&&s>a}],"filter-id->":[hn,[un],(e,[t])=>{const n=e.id(),s=t.value;return typeof n==typeof s&&n>s}],"filter-<=":[hn,[on,un],(e,[t,n])=>{const s=e.properties()[t.value],a=n.value;return typeof s==typeof a&&s<=a}],"filter-id-<=":[hn,[un],(e,[t])=>{const n=e.id(),s=t.value;return typeof n==typeof s&&n<=s}],"filter->=":[hn,[on,un],(e,[t,n])=>{const s=e.properties()[t.value],a=n.value;return typeof s==typeof a&&s>=a}],"filter-id->=":[hn,[un],(e,[t])=>{const n=e.id(),s=t.value;return typeof n==typeof s&&n>=s}],"filter-has":[hn,[un],(e,[t])=>t.value in e.properties()],"filter-has-id":[hn,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[hn,[vo(on)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[hn,[vo(un)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[hn,[on,vo(un)],(e,[t,n])=>n.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[hn,[on,vo(un)],(e,[t,n])=>function(s,a,c,u){for(;c<=u;){const d=c+u>>1;if(a[d]===s)return!0;a[d]>s?u=d-1:c=d+1}return!1}(e.properties()[t.value],n.value,0,n.value.length-1)],all:{type:hn,overloads:[[[hn,hn],(e,[t,n])=>t.evaluate(e)&&n.evaluate(e)],[Pu(hn),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:hn,overloads:[[[hn,hn],(e,[t,n])=>t.evaluate(e)||n.evaluate(e)],[Pu(hn),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[hn,[hn],(e,[t])=>!t.evaluate(e)],"is-supported-script":[hn,[on],(e,[t])=>{const n=e.globals&&e.globals.isSupportedScript;return!n||n(t.evaluate(e))}],upcase:[on,[on],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[on,[on],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[on,Pu(un),(e,t)=>t.map(n=>Cp(n.evaluate(e))).join("")],"resolved-locale":[on,[Fr],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[Ht,[Ht,Ht,un],(e,t)=>{const[n,s,a]=t.map(u=>u.evaluate(e));if(n>s||n===s)return n;let c;if("string"==typeof a)c=function(u){let d=0;if(0===u.length)return d;for(let f=0;f<u.length;f++)d=(d<<5)-d+u.charCodeAt(f),d&=d;return d}(a);else{if("number"!=typeof a)throw new Fi(`Invalid seed input: ${a}`);c=a}return n+b1(c)()*(s-n)}]});var Bp=jM;function GM(e){return{result:"success",value:e}}function bo(e){return{result:"error",value:e}}function va(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Ou(e){return"data-driven"===e["property-type"]}function qM(e){return va(e.expression,"measure-light")}function tr(e){return va(e.expression,"zoom")}function ku(e){return!!e.expression&&e.expression.interpolated}function jr(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function E1(e){return e}function z_(e,t){const n="color"===t.type,s=e.stops&&"object"==typeof e.stops[0][0],a=s||!(s||void 0!==e.property),c=e.type||(ku(t)?"exponential":"interval");if(n&&((e=es({},e)).stops&&(e.stops=e.stops.map(p=>[p[0],Pe.parse(p[1])])),e.default=Pe.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!ya[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let u,d,f;if("exponential"===c)u=j_;else if("interval"===c)u=B_;else if("categorical"===c){u=C1,d=Object.create(null);for(const p of e.stops)d[p[0]]=p[1];f=typeof e.stops[0][0]}else{if("identity"!==c)throw new Error(`Unknown function type "${c}"`);u=V_}if(s){const p={},g=[];for(let x=0;x<e.stops.length;x++){const b=e.stops[x],E=b[0].zoom;void 0===p[E]&&(p[E]={zoom:E,type:e.type,property:e.property,default:e.default,stops:[]},g.push(E)),p[E].stops.push([b[0].value,b[1]])}const _=[];for(const x of g)_.push([p[x].zoom,z_(p[x],t)]);const v={name:"linear"};return{kind:"composite",interpolationType:v,interpolationFactor:io.interpolationFactor.bind(void 0,v),zoomStops:_.map(x=>x[0]),evaluate:({zoom:x},b)=>j_({stops:_,base:e.base},t,x).evaluate(x,b)}}if(a){const p="exponential"===c?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:p,interpolationFactor:io.interpolationFactor.bind(void 0,p),zoomStops:e.stops.map(g=>g[0]),evaluate:({zoom:g})=>u(e,t,g,d,f)}}return{kind:"source",evaluate(p,g){const _=g&&g.properties?g.properties[e.property]:void 0;return void 0===_?Lu(e.default,t.default):u(e,t,_,d,f)}}}function Lu(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function C1(e,t,n,s,a){return Lu(typeof n===a?s[n]:void 0,e.default,t.default)}function B_(e,t,n){if("number"!==Sn(n))return Lu(e.default,t.default);const s=e.stops.length;if(1===s||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[s-1][0])return e.stops[s-1][1];const a=Lp(e.stops.map(c=>c[0]),n);return e.stops[a][1]}function j_(e,t,n){const s=void 0!==e.base?e.base:1;if("number"!==Sn(n))return Lu(e.default,t.default);const a=e.stops.length;if(1===a||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[a-1][0])return e.stops[a-1][1];const c=Lp(e.stops.map(g=>g[0]),n),u=function(g,_,v,x){const b=x-v,E=g-v;return 0===b?0:1===_?E/b:(Math.pow(_,E)-1)/(Math.pow(_,b)-1)}(n,s,e.stops[c][0],e.stops[c+1][0]),d=e.stops[c][1],f=e.stops[c+1][1];let p=di[t.type]||E1;if(e.colorSpace&&"rgb"!==e.colorSpace){const g=ya[e.colorSpace];p=(_,v)=>g.reverse(g.interpolate(g.forward(_),g.forward(v),u))}return"function"==typeof d.evaluate?{evaluate(...g){const _=d.evaluate.apply(void 0,g),v=f.evaluate.apply(void 0,g);if(void 0!==_&&void 0!==v)return p(_,v,u)}}:p(d,f,u)}function V_(e,t,n){return"color"===t.type?n=Pe.parse(n):"formatted"===t.type?n=zr.fromString(n.toString()):"resolvedImage"===t.type?n=gi.fromString(n.toString()):Sn(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),Lu(n,e.default,t.default)}class dd{constructor(t,n,s){var a;this.expression=t,this._warningHistory={},this._evaluator=new Tp(s),this._defaultValue=n?"color"===(a=n).type&&(jr(a.default)||Array.isArray(a.default))?new Pe(0,0,0,0):"color"===a.type?Pe.parse(a.default)||null:void 0===a.default?null:a.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(t,n,s,a,c,u,d,f){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=u,this._evaluator.featureTileCoord=d||null,this._evaluator.featureDistanceData=f||null,this.expression.evaluate(this._evaluator)}evaluate(t,n,s,a,c,u,d,f){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=u||null,this._evaluator.featureTileCoord=d||null,this._evaluator.featureDistanceData=f||null;try{const p=this.expression.evaluate(this._evaluator);if(null==p||"number"==typeof p&&p!=p)return this._defaultValue;if(this._enumValues&&!(p in this._enumValues))throw new Fi(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(p)} instead.`);return p}catch(p){return this._warningHistory[p.message]||(this._warningHistory[p.message]=!0,typeof console<"u"&&console.warn(p.message)),this._defaultValue}}}function fd(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Bp}function xa(e,t,n){const s=new O_(Bp,[],t?function(c){const u={color:ns,string:on,number:Ht,enum:on,boolean:hn,formatted:Ve,resolvedImage:bp};return"array"===c.type?vo(u[c.value]||un,c.length):u[c.type]}(t):void 0,void 0,void 0,n),a=s.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return a?GM(new dd(a,t,n)):bo(s.errors)}class jp{constructor(t,n,s){this.kind=t,this._styleExpression=n,this.isLightConstant=s,this.isStateDependent="constant"!==t&&!In(n.expression),this.isConfigDependent=!Ji(n.expression)}evaluateWithoutErrorHandling(t,n,s,a,c,u){return this._styleExpression.evaluateWithoutErrorHandling(t,n,s,a,c,u)}evaluate(t,n,s,a,c,u){return this._styleExpression.evaluate(t,n,s,a,c,u)}}class as{constructor(t,n,s,a,c){this.kind=t,this.zoomStops=s,this._styleExpression=n,this.isStateDependent="camera"!==t&&!In(n.expression),this.isLightConstant=c,this.isConfigDependent=!Ji(n.expression),this.interpolationType=a}evaluateWithoutErrorHandling(t,n,s,a,c,u){return this._styleExpression.evaluateWithoutErrorHandling(t,n,s,a,c,u)}evaluate(t,n,s,a,c,u){return this._styleExpression.evaluate(t,n,s,a,c,u)}interpolationFactor(t,n,s){return this.interpolationType?io.interpolationFactor(this.interpolationType,t,n,s):0}}function hc(e,t,n){if("error"===(e=xa(e,t,n)).result)return e;const s=e.value.expression,a=Qi(s);if(!a&&!Ou(t))return bo([new fa("","data expressions not supported")]);const c=Zi(s,["zoom","pitch","distance-from-center"]);if(!c&&!tr(t))return bo([new fa("","zoom expressions not supported")]);const u=Zi(s,["measure-light"]);if(!u&&!qM(t))return bo([new fa("","measure-light expression not supported")]);const d=t.expression&&t.expression.relaxZoomRestriction,f=pd(s);return f||c||d?f instanceof fa?bo([f]):f instanceof io&&!ku(t)?bo([new fa("",'"interpolate" expressions cannot be used with this property')]):GM(f?new as(a?"camera":"composite",e.value,f.labels,f instanceof io?f.interpolation:void 0,u):new jp(a?"constant":"source",e.value,u)):bo([new fa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ba{constructor(t,n){this._parameters=t,this._specification=n,es(this,z_(this._parameters,this._specification))}static deserialize(t){return new ba(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function pd(e){let t=null;if(e instanceof L_)t=pd(e.result);else if(e instanceof NM){for(const n of e.args)if(t=pd(n),t)break}else(e instanceof xi||e instanceof io)&&e.input instanceof Fs&&"zoom"===e.input.name&&(t=e);return t instanceof fa||e.eachChild(n=>{const s=pd(n);s instanceof fa?t=s:t&&s&&t!==s&&(t=new fa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ls(e){const t=e.key,n=e.value,s=e.valueSpec||{},a=e.objectElementValidators||{},c=e.style,u=e.styleSpec;let d=[];const f=Sn(n);if("object"!==f)return[new Yt(t,n,`object expected, ${f} found`)];for(const p in n){const g=p.split(".")[0];let _;a[g]?_=a[g]:s[g]?_=an:a["*"]?_=a["*"]:s["*"]&&(_=an),_?d=d.concat(_({key:(t&&`${t}.`)+p,value:n[p],valueSpec:s[g]||s["*"],style:c,styleSpec:u,object:n,objectKey:p},n)):d.push(new Jl(t,n[p],`unknown property "${p}"`))}for(const p in s)a[p]||s[p].required&&void 0===s[p].default&&void 0===n[p]&&d.push(new Yt(t,n,`missing required property "${p}"`));return d}function ZM(e){const t=e.value,n=e.valueSpec,s=e.style,a=e.styleSpec,c=e.key,u=e.arrayElementValidator||an;if("array"!==Sn(t))return[new Yt(c,t,`array expected, ${Sn(t)} found`)];if(n.length&&t.length!==n.length)return[new Yt(c,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Yt(c,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let d={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};a.$version<7&&(d.function=n.function),"object"===Sn(n.value)&&(d=n.value);let f=[];for(let p=0;p<t.length;p++)f=f.concat(u({array:t,arrayIndex:p,value:t[p],valueSpec:d,style:s,styleSpec:a,key:`${c}[${p}]`},!0));return f}function WM(e){const t=e.key,n=e.value,s=e.valueSpec;let a=Sn(n);if("number"===a&&n!=n&&(a="NaN"),"number"!==a)return[new Yt(t,n,`number expected, ${a} found`)];if("minimum"in s){let c=s.minimum;if("array"===Sn(s.minimum)&&(c=s.minimum[e.arrayIndex]),n<c)return[new Yt(t,n,`${n} is less than the minimum value ${c}`)]}if("maximum"in s){let c=s.maximum;if("array"===Sn(s.maximum)&&(c=s.maximum[e.arrayIndex]),n>c)return[new Yt(t,n,`${n} is greater than the maximum value ${c}`)]}return[]}function D1(e){const t=e.valueSpec,n=Fn(e.value.type);let s,a,c,u={};const d="categorical"!==n&&void 0===e.value.property,f=!d,p="array"===Sn(e.value.stops)&&"array"===Sn(e.value.stops[0])&&"object"===Sn(e.value.stops[0][0]),g=ls({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(x){if("identity"===n)return[new Yt(x.key,x.value,'identity function may not have a "stops" property')];let b=[];const E=x.value;return b=b.concat(ZM({key:x.key,value:E,valueSpec:x.valueSpec,style:x.style,styleSpec:x.styleSpec,arrayElementValidator:_})),"array"===Sn(E)&&0===E.length&&b.push(new Yt(x.key,E,"array must have at least one stop")),b},default:function(x){return an({key:x.key,value:x.value,valueSpec:t,style:x.style,styleSpec:x.styleSpec})}}});return"identity"===n&&d&&g.push(new Yt(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||g.push(new Yt(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!ku(e.valueSpec)&&g.push(new Yt(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(f&&!Ou(e.valueSpec)?g.push(new Yt(e.key,e.value,"property functions not supported")):d&&!tr(e.valueSpec)&&g.push(new Yt(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!p||void 0!==e.value.property||g.push(new Yt(e.key,e.value,'"property" property is required')),g;function _(x){let b=[];const E=x.value,C=x.key;if("array"!==Sn(E))return[new Yt(C,E,`array expected, ${Sn(E)} found`)];if(2!==E.length)return[new Yt(C,E,`array length 2 expected, length ${E.length} found`)];if(p){if("object"!==Sn(E[0]))return[new Yt(C,E,`object expected, ${Sn(E[0])} found`)];if(void 0===E[0].zoom)return[new Yt(C,E,"object stop key must have zoom")];if(void 0===E[0].value)return[new Yt(C,E,"object stop key must have value")];const M=Fn(E[0].zoom);if("number"!=typeof M)return[new Yt(C,E[0].zoom,"stop zoom values must be numbers")];if(c&&c>M)return[new Yt(C,E[0].zoom,"stop zoom values must appear in ascending order")];M!==c&&(c=M,a=void 0,u={}),b=b.concat(ls({key:`${C}[0]`,value:E[0],valueSpec:{zoom:{}},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{zoom:WM,value:v}}))}else b=b.concat(v({key:`${C}[0]`,value:E[0],valueSpec:{},style:x.style,styleSpec:x.styleSpec},E));return fd(Ja(E[1]))?b.concat([new Yt(`${C}[1]`,E[1],"expressions are not allowed in function stops.")]):b.concat(an({key:`${C}[1]`,value:E[1],valueSpec:t,style:x.style,styleSpec:x.styleSpec}))}function v(x,b){const E=Sn(x.value),C=Fn(x.value),M=null!==x.value?x.value:b;if(s){if(E!==s)return[new Yt(x.key,M,`${E} stop domain type must match previous stop domain type ${s}`)]}else s=E;if("number"!==E&&"string"!==E&&"boolean"!==E&&"number"!=typeof C&&"string"!=typeof C&&"boolean"!=typeof C)return[new Yt(x.key,M,"stop domain value must be a number, string, or boolean")];if("number"!==E&&"categorical"!==n){let T=`number expected, ${E} found`;return Ou(t)&&void 0===n&&(T+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Yt(x.key,M,T)]}return"categorical"!==n||"number"!==E||"number"==typeof C&&isFinite(C)&&Math.floor(C)===C?"categorical"!==n&&"number"===E&&"number"==typeof C&&"number"==typeof a&&void 0!==a&&C<a?[new Yt(x.key,M,"stop domain values must appear in ascending order")]:(a=C,"categorical"===n&&C in u?[new Yt(x.key,M,"stop domain values must be unique")]:(u[C]=!0,[])):[new Yt(x.key,M,`integer expected, found ${String(C)}`)]}}function dc(e){const t=("property"===e.expressionContext?hc:xa)(Ja(e.value),e.valueSpec);if("error"===t.result)return t.value.map(s=>new Yt(`${e.key}${s.key}`,e.value,s.message));const n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new Yt(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!In(n))return[new Yt(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return YM(n,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Zi(n,["zoom","feature-state"]))return[new Yt(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Qi(n))return[new Yt(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function YM(e,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const a of t.valueSpec.expression.parameters)n.delete(a);if(0===n.size)return[];const s=[];return e instanceof Fs&&n.has(e.name)?[new Yt(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild(a=>{s.push(...YM(a,t))}),s)}function md(e){const t=e.key,n=e.value,s=e.valueSpec,a=[];return Array.isArray(s.values)?-1===s.values.indexOf(Fn(n))&&a.push(new Yt(t,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(s.values).indexOf(Fn(n))&&a.push(new Yt(t,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),a}function gd(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!gd(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Vp(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};gd(e)||(e=$p(e));const n=e;let s=!0;try{s=function(p){if(!_d(p))return p;let g=Ja(p);return XM(g),g=Up(g),g}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const a=rt[`filter_${t}`],c=xa(s,a);let u=null;if("error"===c.result)throw new Error(c.value.map(p=>`${p.key}: ${p.message}`).join(", "));u=(p,g,_)=>c.value.evaluate(p,g,{},_);let d=null,f=null;if(s!==n){const p=xa(n,a);if("error"===p.result)throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));d=(g,_,v,x,b)=>p.value.evaluate(g,_,{},v,void 0,void 0,x,b),f=!Qi(p.value.expression)}return{filter:u,dynamicFilter:d||void 0,needGeometry:U_(s),needFeature:!!f}}function Up(e){if(!Array.isArray(e))return e;const t=function(n){if(KM.has(n[0]))for(let s=1;s<n.length;s++)if(_d(n[s]))return!0;return n}(e);return!0===t?t:t.map(n=>Up(n))}function XM(e){let t=!1;const n=[];if("case"===e[0]){for(let s=1;s<e.length-1;s+=2)t=t||_d(e[s]),n.push(e[s+1]);n.push(e[e.length-1])}else if("match"===e[0]){t=t||_d(e[1]);for(let s=2;s<e.length-1;s+=2)n.push(e[s+1]);n.push(e[e.length-1])}else if("step"===e[0]){t=t||_d(e[1]);for(let s=1;s<e.length-1;s+=2)n.push(e[s+1])}t&&(e.length=0,e.push("any",...n));for(let s=1;s<e.length;s++)XM(e[s])}function _d(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let n=1;n<e.length;n++)if(_d(e[n]))return!0;return!1}const KM=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function M1(e,t){return e<t?-1:e>t?1:0}function U_(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(U_(e[t]))return!0;return!1}function $p(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?$_(e[1],e[2],"=="):"!="===t?Hp($_(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?$_(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map($p))):"all"===t?["all"].concat(e.slice(1).map($p)):"none"===t?["all"].concat(e.slice(1).map($p).map(Hp)):"in"===t?T1(e[1],e.slice(2)):"!in"===t?Hp(T1(e[1],e.slice(2))):"has"===t?H_(e[1]):"!has"!==t||Hp(H_(e[1]));var n}function $_(e,t,n){switch(e){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,e,t]}}function T1(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",e,["literal",t.sort(M1)]]:["filter-in-small",e,["literal",t]]}}function H_(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Hp(e){return["!",e]}function Gp(e){return gd(Ja(e.value))?dc(es({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):S1(e)}function S1(e){const t=e.value,n=e.key;if("array"!==Sn(t))return[new Yt(n,t,`array expected, ${Sn(t)} found`)];const s=e.styleSpec;let a,c=[];if(t.length<1)return[new Yt(n,t,"filter array must have at least 1 element")];switch(c=c.concat(md({key:`${n}[0]`,value:t[0],valueSpec:s.filter_operator,style:e.style,styleSpec:e.styleSpec})),Fn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Fn(t[1])&&c.push(new Yt(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&c.push(new Yt(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(a=Sn(t[1]),"string"!==a&&c.push(new Yt(`${n}[1]`,t[1],`string expected, ${a} found`)));for(let u=2;u<t.length;u++)a=Sn(t[u]),"$type"===Fn(t[1])?c=c.concat(md({key:`${n}[${u}]`,value:t[u],valueSpec:s.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&c.push(new Yt(`${n}[${u}]`,t[u],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let u=1;u<t.length;u++)c=c.concat(S1({key:`${n}[${u}]`,value:t[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":a=Sn(t[1]),2!==t.length?c.push(new Yt(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==a&&c.push(new Yt(`${n}[1]`,t[1],`string expected, ${a} found`))}return c}function QM(e,t){const n=e.key,s=e.style,a=e.layer,c=e.styleSpec,u=e.value,d=e.objectKey,f=c[`${t}_${e.layerType}`];if(!f)return[];const p=d.match(/^(.*)-transition$/);if("paint"===t&&p&&f[p[1]]&&f[p[1]].transition)return an({key:n,value:u,valueSpec:c.transition,style:s,styleSpec:c});const g=e.valueSpec||f[d];if(!g)return[new Jl(n,u,`unknown property "${d}"`)];let _;if("string"===Sn(u)&&Ou(g)&&!g.tokens&&(_=/^{([^}]+)}$/.exec(u))){const x=`\`{ "type": "identity", "property": ${_?JSON.stringify(_[1]):'"_"'} }\``;return[new Yt(n,u,`"${d}" does not support interpolation syntax\nUse an identity property function instead: ${x}.`)]}const v=[];if("symbol"===e.layerType)"text-field"!==d||!s||s.glyphs||s.imports||v.push(new Yt(n,u,'use of "text-field" requires a style "glyphs" property')),"text-font"===d&&jr(Ja(u))&&"identity"===Fn(u.type)&&v.push(new Yt(n,u,'"text-font" does not support identity functions'));else if("model"===e.layerType&&"paint"===t&&a&&a.layout&&a.layout.hasOwnProperty("model-id")&&Ou(g)&&(qM(g)||tr(g))){const x=hc(Ja(u),g),b=x.value.expression||x.value._styleExpression.expression;b&&!Zi(b,["measure-light"])&&("model-emissive-strength"===d&&Qi(b)&&In(b)||v.push(new Yt(n,u,`${d} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return v.concat(an({key:e.key,value:u,valueSpec:g,style:s,styleSpec:c,expressionContext:"property",propertyType:t,propertyKey:d}))}function I1(e){return QM(e,"paint")}function wa(e){return QM(e,"layout")}function G_(e){let t=[];const n=e.value,s=e.key,a=e.style,c=e.styleSpec;n.type||n.ref||t.push(new Yt(s,n,'either "type" or "ref" is required'));let u=Fn(n.type);const d=Fn(n.ref);if(n.id){const f=Fn(n.id);for(let p=0;p<e.arrayIndex;p++){const g=a.layers[p];Fn(g.id)===f&&t.push(new Yt(s,n.id,`duplicate layer id "${n.id}", previously used at line ${g.id.__line__}`))}}if("ref"in n){let f;["type","source","source-layer","filter","layout"].forEach(p=>{p in n&&t.push(new Yt(s,n[p],`"${p}" is prohibited for ref layers`))}),a.layers.forEach(p=>{Fn(p.id)===d&&(f=p)}),f?f.ref?t.push(new Yt(s,n.ref,"ref cannot reference another ref layer")):u=Fn(f.type):"string"==typeof d&&t.push(new Yt(s,n.ref,`ref layer "${d}" not found`))}else if("background"!==u&&"sky"!==u&&"slot"!==u)if(n.source){const f=a.sources&&a.sources[n.source],p=f&&Fn(f.type);f?"vector"===p&&"raster"===u?t.push(new Yt(s,n.source,`layer "${n.id}" requires a raster source`)):"raster"===p&&"raster"!==u?t.push(new Yt(s,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==p||n["source-layer"]?"raster-dem"===p&&"hillshade"!==u?t.push(new Yt(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==u||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===p&&f.lineMetrics||t.push(new Yt(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Yt(s,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Yt(s,n.source,`source "${n.source}" not found`))}else t.push(new Yt(s,n,'missing required property "source"'));return t=t.concat(ls({key:s,value:n,valueSpec:c.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>an({key:`${s}.type`,value:n.type,valueSpec:c.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"}),filter:f=>Gp(es({layerType:u},f)),layout:f=>ls({layer:n,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":p=>wa(es({layerType:u},p))}}),paint:f=>ls({layer:n,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":p=>I1(es({layerType:u,layer:n},p))}})}})),t}function Fu(e){const t=e.value,n=e.key,s=Sn(t);return"string"!==s?[new Yt(n,t,`string expected, ${s} found`)]:[]}const A1={promoteId:function({key:e,value:t}){if("string"===Sn(t))return Fu({key:e,value:t});{const n=[];for(const s in t)n.push(...Fu({key:`${e}.${s}`,value:t[s]}));return n}}};function q_(e){const t=e.value,n=e.key,s=e.styleSpec,a=e.style;if(!t.type)return[new Yt(n,t,'"type" is required')];const c=Fn(t.type);let u=[];switch(["vector","raster","raster-dem"].includes(c)&&(t.url||t.tiles||u.push(new Yt(n,t,'Either "url" or "tiles" is required.'))),c){case"vector":case"raster":case"raster-dem":return u=u.concat(ls({key:n,value:t,valueSpec:s[`source_${c.replace("-","_")}`],style:e.style,styleSpec:s,objectElementValidators:A1})),u;case"geojson":if(u=ls({key:n,value:t,valueSpec:s.source_geojson,style:a,styleSpec:s,objectElementValidators:A1}),t.cluster)for(const d in t.clusterProperties){const[f,p]=t.clusterProperties[d],g="string"==typeof f?[f,["accumulated"],["get",d]]:f;u.push(...dc({key:`${n}.${d}.map`,value:p,expressionContext:"cluster-map"})),u.push(...dc({key:`${n}.${d}.reduce`,value:g,expressionContext:"cluster-reduce"}))}return u;case"video":return ls({key:n,value:t,valueSpec:s.source_video,style:a,styleSpec:s});case"image":return ls({key:n,value:t,valueSpec:s.source_image,style:a,styleSpec:s});case"canvas":return[new Yt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return md({key:`${n}.type`,value:t.type,valueSpec:{values:R1(s)},style:a,styleSpec:s})}}function R1(e){return e.source.reduce((t,n)=>{const s=e[n];return"enum"===s.type.type&&(t=t.concat(Object.keys(s.type.values))),t},[])}function P1(e){const t=e.value;let n=[];if(!t)return n;const s=Sn(t);return"string"!==s?(n=n.concat([new Yt(e.key,t,`string expected, "${s}" found`)]),n):(function(a){const c=-1===a.indexOf("://");try{return new URL(a,c?"http://example.com":void 0),!0}catch{return!1}}(t)||(n=n.concat([new Yt(e.key,t,`invalid url "${t}"`)])),n)}function qp(e){const t=e.value,n=e.styleSpec,s=n.light,a=e.style;let c=[];const u=Sn(t);if(void 0===t)return c;if("object"!==u)return c=c.concat([new Yt("light",t,`object expected, ${u} found`)]),c;for(const d in t){const f=d.match(/^(.*)-transition$/);c=c.concat(f&&s[f[1]]&&s[f[1]].transition?an({key:d,value:t[d],valueSpec:n.transition,style:a,styleSpec:n}):s[d]?an({key:d,value:t[d],valueSpec:s[d],style:a,styleSpec:n}):[new Yt(d,t[d],`unknown property "${d}"`)])}return c}function O1(e){const t=e.value;let n=[];if(!t)return n;const s=Sn(t);if("object"!==s)return n=n.concat([new Yt("light-3d",t,`object expected, ${s} found`)]),n;const a=e.styleSpec,c=a["light-3d"],u=e.key,d=e.style,f=e.style.lights;for(const _ of["type","id"])if(!(_ in t))return n=n.concat([new Yt("light-3d",t,`missing property ${_} on light`)]),n;if(t.type&&f)for(let _=0;_<e.arrayIndex;_++){const v=Fn(t.type),x=f[_];Fn(x.type)===v&&n.push(new Yt(u,t.id,`duplicate light type "${t.type}", previously defined at line ${x.id.__line__}`))}const p=`properties_light_${t.type}`;if(!(p in a))return n=n.concat([new Yt("light-3d",t,`Invalid light type ${t.type}`)]),n;const g=a[p];for(const _ in t)if("properties"===_){const v=t[_],x=Sn(v);if("object"!==x)return n=n.concat([new Yt("properties",v,`object expected, ${x} found`)]),n;for(const b in v)n=n.concat(g[b]?an({key:b,value:v[b],valueSpec:g[b],style:d,styleSpec:a}):[new Jl(e.key,v[b],`unknown property "${b}"`)])}else{const v=_.match(/^(.*)-transition$/);n=n.concat(v&&c[v[1]]&&c[v[1]].transition?an({key:_,value:t[_],valueSpec:a.transition,style:d,styleSpec:a}):c[_]?an({key:_,value:t[_],valueSpec:c[_],style:d,styleSpec:a}):[new Jl(_,t[_],`unknown property "${_}"`)])}return n}function cs(e){const t=e.value,n=e.key,s=e.style,a=e.styleSpec,c=a.terrain;let u=[];const d=Sn(t);if(void 0===t||"null"===d)return u;if("object"!==d)return u=u.concat([new Yt("terrain",t,`object expected, ${d} found`)]),u;for(const f in t){const p=f.match(/^(.*)-transition$/);u=u.concat(p&&c[p[1]]&&c[p[1]].transition?an({key:f,value:t[f],valueSpec:a.transition,style:s,styleSpec:a}):c[f]?an({key:f,value:t[f],valueSpec:c[f],style:s,styleSpec:a}):[new Jl(f,t[f],`unknown property "${f}"`)])}if(t.source){const f=s.sources&&s.sources[t.source],p=f&&Fn(f.type);f?"raster-dem"!==p&&u.push(new Yt(n,t.source,`terrain cannot be used with a source of type ${String(p)}, it only be used with a "raster-dem" source type`)):u.push(new Yt(n,t.source,`source "${t.source}" not found`))}else u.push(new Yt(n,t,'terrain is missing required property "source"'));return u}function Z_(e){const t=e.value,n=e.style,s=e.styleSpec,a=s.fog;let c=[];const u=Sn(t);if(void 0===t)return c;if("object"!==u)return c=c.concat([new Yt("fog",t,`object expected, ${u} found`)]),c;for(const d in t){const f=d.match(/^(.*)-transition$/);c=c.concat(f&&a[f[1]]&&a[f[1]].transition?an({key:d,value:t[d],valueSpec:s.transition,style:n,styleSpec:s}):a[d]?an({key:d,value:t[d],valueSpec:a[d],style:n,styleSpec:s}):[new Jl(d,t[d],`unknown property "${d}"`)])}return c}const W_={"*":()=>[],array:ZM,boolean:function(e){const t=e.value,n=e.key,s=Sn(t);return"boolean"!==s?[new Yt(n,t,`boolean expected, ${s} found`)]:[]},number:WM,color:function(e){const t=e.key,n=e.value,s=Sn(n);return"string"!==s?[new Yt(t,n,`color expected, ${s} found`)]:null===E_(n)?[new Yt(t,n,`color expected, "${n}" found`)]:[]},enum:md,filter:Gp,function:D1,layer:G_,object:ls,source:q_,model:P1,light:qp,"light-3d":O1,terrain:cs,fog:Z_,string:Fu,formatted:function(e){return 0===Fu(e).length?[]:dc(e)},resolvedImage:function(e){return 0===Fu(e).length?[]:dc(e)},projection:function(e){const t=e.value,n=e.styleSpec,s=n.projection,a=e.style;let c=[];const u=Sn(t);if("object"===u)for(const d in t)c=c.concat(an({key:d,value:t[d],valueSpec:s[d],style:a,styleSpec:n}));else"string"!==u&&(c=c.concat([new Yt("projection",t,`object or string expected, ${u} found`)]));return c},import:function(e){const{value:t,styleSpec:n}=e,{data:s,...a}=t;Object.defineProperty(a,"__line__",{value:t.__line__,enumerable:!1});let c=ls(es({},e,{value:a,valueSpec:n.import}));return""===Fn(a.id)&&c.push(new Yt(`${e.key}.id`,a,"import id can't be an empty string")),s&&(c=c.concat(yd(s,n,{key:`${e.key}.data`}))),c}};function an(e,t=!1){const n=e.value,s=e.valueSpec,a=e.styleSpec;if(s.expression&&jr(Fn(n)))return D1(e);if(s.expression&&fd(Ja(n)))return dc(e);if(s.type&&W_[s.type]){const c=W_[s.type](e);return!0===t&&c.length>0&&"array"===Sn(e.value)?dc(e):c}return ls(es({},e,{valueSpec:s.type?a[s.type]:s}))}function Y_(e){const t=e.value,n=e.key,s=Fu(e);return s.length||(-1===t.indexOf("{fontstack}")&&s.push(new Yt(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&s.push(new Yt(n,t,'"glyphs" url must include a "{range}" token'))),s}function yd(e,t=rt,n={}){return an({key:n.key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Y_,"*":()=>[]}})}function er(e,t=rt){return Bo(yd(e,t))}const JM=e=>Bo(q_(e)),k1=e=>Bo(qp(e)),Nu=e=>Bo(O1(e)),wo=e=>Bo(cs(e)),tT=e=>Bo(Z_(e)),eT=e=>Bo(G_(e)),X_=e=>Bo(Gp(e)),sl=e=>Bo(I1(e)),L1=e=>Bo(wa(e)),nT=e=>Bo(P1(e));function Bo(e){return e.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function vd(e,t){let n=!1;if(t&&t.length)for(const s of t)s instanceof Jl?tt(s.message):(e.fire(new zt(new Error(s.message))),n=!0);return n}var F1=Re,al=3;function Re(e,t,n){var s=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var a=new Int32Array(this.arrayBuffer);e=a[0],this.d=(t=a[1])+2*(n=a[2]);for(var c=0;c<this.d*this.d;c++){var u=a[al+c],d=a[al+c+1];s.push(u===d?null:a.subarray(u,d))}var f=a[al+s.length+1];this.keys=a.subarray(a[al+s.length],f),this.bboxes=a.subarray(f),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var p=0;p<this.d*this.d;p++)s.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var g=n/t*e;this.min=-g,this.max=e+g}Re.prototype.insert=function(e,t,n,s,a){this._forEachCell(t,n,s,a,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(a)},Re.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Re.prototype._insertCell=function(e,t,n,s,a,c){this.cells[a].push(c)},Re.prototype.query=function(e,t,n,s,a){var c=this.min,u=this.max;if(e<=c&&t<=c&&u<=n&&u<=s&&!a)return Array.prototype.slice.call(this.keys);var d=[];return this._forEachCell(e,t,n,s,this._queryCell,d,{},a),d},Re.prototype._queryCell=function(e,t,n,s,a,c,u,d){var f=this.cells[a];if(null!==f)for(var p=this.keys,g=this.bboxes,_=0;_<f.length;_++){var v=f[_];if(void 0===u[v]){var x=4*v;(d?d(g[x+0],g[x+1],g[x+2],g[x+3]):e<=g[x+2]&&t<=g[x+3]&&n>=g[x+0]&&s>=g[x+1])?(u[v]=!0,c.push(p[v])):u[v]=!1}}},Re.prototype._forEachCell=function(e,t,n,s,a,c,u,d){for(var f=this._convertToCellCoord(e),p=this._convertToCellCoord(t),g=this._convertToCellCoord(n),_=this._convertToCellCoord(s),v=f;v<=g;v++)for(var x=p;x<=_;x++){var b=this.d*x+v;if((!d||d(this._convertFromCellCoord(v),this._convertFromCellCoord(x),this._convertFromCellCoord(v+1),this._convertFromCellCoord(x+1)))&&a.call(this,e,t,n,s,b,c,u,d))return}},Re.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Re.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Re.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=al+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var a=new Int32Array(t+n+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var c=t,u=0;u<e.length;u++){var d=e[u];a[al+u]=c,a.set(d,c),c+=d.length}return a[al+e.length]=c,a.set(this.keys,c),a[al+e.length+1]=c+=this.keys.length,a.set(this.bboxes,c),c+=this.bboxes.length,a.buffer};var fc=Jr(F1);const K_={};function Xt(e,t,n={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),K_[t]={klass:e,omit:n.omit||[]}}Xt(Object,"Object"),fc.serialize=function(e,t){const n=e.toArrayBuffer();return t&&t.add(n),{buffer:n}},fc.deserialize=function(e){return new fc(e.buffer)},Object.defineProperty(fc,"name",{value:"Grid"}),Xt(fc,"Grid"),Xt(Pe,"Color"),Xt(Error,"Error"),Xt(_t,"AJAXError"),Xt(gi,"ResolvedImage"),Xt(ba,"StylePropertyFunction"),Xt(dd,"StyleExpression",{omit:["_evaluator"]}),Xt(as,"ZoomDependentExpression"),Xt(jp,"ZoomConstantExpression"),Xt(Fs,"CompoundExpression",{omit:["_evaluate"]});for(const e in Bp)K_[Bp[e]._classRegistryKey]||Xt(Bp[e],`Expression${e}`);function N1(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function z1(e){return st.ImageBitmap&&e instanceof st.ImageBitmap}function pc(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(N1(e)||z1(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){const n=e;return t&&t.add(n.buffer),n}if(e instanceof st.ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const s of e)n.push(pc(s,t));return n}if(e instanceof Map){const n={$name:"Map"};for(const[s,a]of e.entries())n[s]=pc(a);return n}if("object"==typeof e){const n=e.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const a=n.serialize?n.serialize(e,t):{};if(!n.serialize){for(const c in e)e.hasOwnProperty(c)&&(K_[s].omit.indexOf(c)>=0||(a[c]=pc(e[c],t)));e instanceof Error&&(a.message=e.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(a.$name=s),a}throw new Error("can't serialize object of type "+typeof e)}function us(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||N1(e)||z1(e)||ArrayBuffer.isView(e)||e instanceof st.ImageData)return e;if(Array.isArray(e))return e.map(us);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const a=new Map;for(const c of Object.keys(e))"$name"!==c&&a.set(c,us(e[c]));return a}const{klass:n}=K_[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(e);const s=Object.create(n.prototype);for(const a of Object.keys(e))"$name"!==a&&(s[a]=us(e[a]));return s}throw new Error("can't deserialize object of type "+typeof e)}const ee={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function Q_(e){for(const t of e)if(J_(t.charCodeAt(0)))return!0;return!1}function iT(e){for(const t of e)if(!rT(t.charCodeAt(0)))return!1;return!0}function rT(e){return!(ee.Arabic(e)||ee["Arabic Supplement"](e)||ee["Arabic Extended-A"](e)||ee["Arabic Presentation Forms-A"](e)||ee["Arabic Presentation Forms-B"](e))}function J_(e){return!(746!==e&&747!==e&&(e<4352||!(ee["Bopomofo Extended"](e)||ee.Bopomofo(e)||ee["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||ee["CJK Compatibility Ideographs"](e)||ee["CJK Compatibility"](e)||ee["CJK Radicals Supplement"](e)||ee["CJK Strokes"](e)||!(!ee["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||ee["CJK Unified Ideographs Extension A"](e)||ee["CJK Unified Ideographs"](e)||ee["Enclosed CJK Letters and Months"](e)||ee["Hangul Compatibility Jamo"](e)||ee["Hangul Jamo Extended-A"](e)||ee["Hangul Jamo Extended-B"](e)||ee["Hangul Jamo"](e)||ee["Hangul Syllables"](e)||ee.Hiragana(e)||ee["Ideographic Description Characters"](e)||ee.Kanbun(e)||ee["Kangxi Radicals"](e)||ee["Katakana Phonetic Extensions"](e)||ee.Katakana(e)&&12540!==e||!(!ee["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!ee["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||ee["Unified Canadian Aboriginal Syllabics"](e)||ee["Unified Canadian Aboriginal Syllabics Extended"](e)||ee["Vertical Forms"](e)||ee["Yijing Hexagram Symbols"](e)||ee["Yi Syllables"](e)||ee["Yi Radicals"](e))))}function Ft(e){return!(J_(e)||(t=e,ee["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||ee["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||ee["Letterlike Symbols"](t)||ee["Number Forms"](t)||ee["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||ee["Control Pictures"](t)&&9251!==t||ee["Optical Character Recognition"](t)||ee["Enclosed Alphanumerics"](t)||ee["Geometric Shapes"](t)||ee["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ee["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ee["CJK Symbols and Punctuation"](t)||ee.Katakana(t)||ee["Private Use Area"](t)||ee["CJK Compatibility Forms"](t)||ee["Small Form Variants"](t)||ee["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t}function Nn(e){return e>=1424&&e<=2303||ee["Arabic Presentation Forms-A"](e)||ee["Arabic Presentation Forms-B"](e)}function oT(e,t){return!(!t&&Nn(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||ee.Khmer(e))}function sT(e){for(const t of e)if(Nn(t.charCodeAt(0)))return!0;return!1}const nr="deferred",Zp="loading",mc="loaded";let jo=null,Dr="unavailable",js=null;const B1=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Dr="error"),jo&&jo(e)};function j1(){Wp.fire(new Dt("pluginStateChange",{pluginStatus:Dr,pluginURL:js}))}const Wp=new Be,vr=function(){return Dr},Vs=function(){if(Dr!==nr||!js)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Dr=Zp,j1(),js&&Nt({url:js},e=>{e?B1(e):(Dr=mc,j1())})},Eo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Dr===mc||null!=Eo.applyArabicShaping,isLoading:()=>Dr===Zp,setState(e){Dr=e.pluginStatus,js=e.pluginURL},isParsed:()=>null!=Eo.applyArabicShaping&&null!=Eo.processBidirectionalText&&null!=Eo.processStyledBidirectionalText,getPluginURL:()=>js};class zn{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(n,s){for(const a of n)if(!oT(a.charCodeAt(0),s))return!1;return!0}(t,Eo.isLoaded())}}class Vo{constructor(t,n,s){this.property=t,this.value=n,this.expression=function(a,c,u){if(jr(a))return new ba(a,c);if(fd(a)||Array.isArray(a)&&a.length>0){const d=hc(a,c,u);if("error"===d.result)throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=a;return"string"==typeof a&&"color"===c.type&&(d=Pe.parse(a)),{kind:"constant",isConfigDependent:!1,evaluate:()=>d}}}(void 0===n?t.specification.default:n,t.specification,s)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,n,s){return this.property.possiblyEvaluate(this,t,n,s)}}class ty{constructor(t,n){this.property=t,this.value=new Vo(t,void 0,n)}transitioned(t,n){return new V1(this.property,this.value,n,qt({},t.transition,this.transition),t.now)}untransitioned(){return new V1(this.property,this.value,null,{},0)}}class zu{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._options=n,this.isConfigDependent=!1}getValue(t){return $(this._values[t].value.value)}setValue(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new ty(this._values[t].property,this._options)),this._values[t].value=new Vo(this._values[t].property,null===n?void 0:$(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,n){n&&(this._options=n);const s=this._properties.properties;if(t)for(const a in t){const c=t[a];if(Wa(a,"-transition")){const u=a.slice(0,-11);s[u]&&this.setTransition(u,c)}else s[a]&&this.setValue(a,c)}}getTransition(t){return $(this._values[t].transition)}setTransition(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new ty(this._values[t].property)),this._values[t].transition=$(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(t[n]=s);const a=this.getTransition(n);void 0!==a&&(t[`${n}-transition`]=a)}return t}transitioned(t,n){const s=new U1(this._properties);for(const a of Object.keys(this._values))s._values[a]=this._values[a].transitioned(t,n._values[a]);return s}untransitioned(){const t=new U1(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class V1{constructor(t,n,s,a,c){const u=a.delay||0,d=a.duration||0;c=c||0,this.property=t,this.value=n,this.begin=c+u,this.end=this.begin+d,t.specification.transition&&(a.delay||a.duration)&&(this.prior=s)}possiblyEvaluate(t,n,s){const a=t.now||0,c=this.value.possiblyEvaluate(t,n,s),u=this.prior;if(u){if(a>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(a<this.begin)return u.possiblyEvaluate(t,n,s);{const d=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(u.possiblyEvaluate(t,n,s),c,qa(d))}}return c}}class U1{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,s){const a=new Bu(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(t,n,s);return a}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ey{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._options=n,this.isConfigDependent=!1}getValue(t){return $(this._values[t].value)}setValue(t,n){this._values[t]=new Vo(this._values[t].property,null===n?void 0:$(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(t[n]=s)}return t}possiblyEvaluate(t,n,s){const a=new Bu(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(t,n,s);return a}}class ll{constructor(t,n,s){this.property=t,this.value=n,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,n,s,a){return this.property.evaluate(this.value,this.parameters,t,n,s,a)}}class Bu{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class wt{constructor(t){this.specification=t}possiblyEvaluate(t,n){return t.expression.evaluate(n)}interpolate(t,n,s){const a=di[this.specification.type];return a?a(t,n,s):t}}class se{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,s,a){return new ll(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(n,null,{},s,a)}:t.expression,n)}interpolate(t,n,s){if("constant"!==t.value.kind||"constant"!==n.value.kind)return t;if(void 0===t.value.value||void 0===n.value.value)return new ll(this,{kind:"constant",value:void 0},t.parameters);const a=di[this.specification.type];return a?new ll(this,{kind:"constant",value:a(t.value.value,n.value.value,s)},t.parameters):t}evaluate(t,n,s,a,c,u){return"constant"===t.kind?t.value:t.evaluate(n,s,a,c,u)}}class ju{constructor(t){this.specification=t}possiblyEvaluate(t,n,s,a){return!!t.expression.evaluate(n,null,{},s,a)}interpolate(){return!1}}class Xn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new zn(0,{});for(const s in t){const a=t[s];a.specification.overridable&&this.overridableProperties.push(s);const c=this.defaultPropertyValues[s]=new Vo(a,void 0),u=this.defaultTransitionablePropertyValues[s]=new ty(a);this.defaultTransitioningPropertyValues[s]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=c.possiblyEvaluate(n)}}}Xt(se,"DataDrivenProperty"),Xt(wt,"DataConstantProperty"),Xt(ju,"ColorRampProperty");function ny(e){return e.indexOf("\x1f")>=0}function cr(e,t){return t?`${e}\x1f${t}`:e}function bd(e){const t=e.indexOf("\x1f");return t>=0?e.slice(0,t):e}const Yp="-transition";class Co extends Be{constructor(t,n,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&"slot"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),this.options=s,t.slot&&(this.slot=t.slot),n.layout&&(this._unevaluatedLayout=new ey(n.layout,s),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new zu(n.paint,s);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bu(n.paint)}}setScope(t){this.scope=t,this.fqid=cr(this.id,t)}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,s={}){if(null!=n&&this._validate(L1,`layers.${this.id}.layout.${t}`,t,n,s))return;if("custom"===this.type&&"visibility"===t)return void(this.visibility=n);const a=this._unevaluatedLayout;a._properties.properties[t]&&(a.setValue(t,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,"visibility"===t&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return Wa(t,Yp)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,s={}){if(null!=n&&this._validate(sl,`layers.${this.id}.paint.${t}`,t,n,s))return!1;const a=this._transitionablePaint,c=a._properties.properties;if(Wa(t,Yp)){const v=t.slice(0,-11);return c[v]&&a.setTransition(v,n||void 0),!1}if(!c[t])return!1;const u=a._values[t],d=u.value.isDataDriven(),f=u.value;a.setValue(t,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const p=a._values[t].value,g=p.isDataDriven(),_=Wa(t,"pattern")||"line-dasharray"===t;return g||d||_||this._handleOverridablePaintPropertyUpdate(t,f,p)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,n){return null}_handleOverridablePaintPropertyUpdate(t,n,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){return At({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,n)=>!(void 0===t||"layout"===n&&!Object.keys(t).length||"paint"===n&&!Object.keys(t).length))}_validate(t,n,s,a,c={}){return(!c||!1!==c.validate)&&vd(this,t.call(er,{key:n,layerType:this.type,objectKey:s,value:a,styleSpec:rt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof ll&&Ou(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Vp(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}class aT{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,n){this._updatedSourceCaches[t]=n,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const n=t.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(t.id),this.setDirty()}removeLayer(t){const n=t.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][t.id]=t,this._updatedLayers[n].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const n in this._updatedLayers)t[n]=t[n]||{},t[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)t[n]=t[n]||{},t[n].removedIds=Object.keys(this._removedLayers[n]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const Vr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Us{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ue{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function dn(e,t=1){let n=0,s=0;return{members:e.map(a=>{const c=Vr[a.type].BYTES_PER_ELEMENT,u=n=$1(n,Math.max(t,c)),d=a.components||1;return s=Math.max(s,c),n+=c*d,{name:a.name,type:a.type,components:d,offset:u}}),size:$1(n,Math.max(s,t)),alignment:t}}function $1(e,t){return Math.ceil(e/t)*t}class ro extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,n)}emplace(t,n,s){const a=2*t;return this.int16[a+0]=n,this.int16[a+1]=s,t}}ro.prototype.bytesPerElement=4,Xt(ro,"StructArrayLayout2i4");class Xp extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,n,s)}emplace(t,n,s,a){const c=3*t;return this.int16[c+0]=n,this.int16[c+1]=s,this.int16[c+2]=a,t}}Xp.prototype.bytesPerElement=6,Xt(Xp,"StructArrayLayout3i6");class cl extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,s,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,s,a)}emplace(t,n,s,a,c){const u=4*t;return this.int16[u+0]=n,this.int16[u+1]=s,this.int16[u+2]=a,this.int16[u+3]=c,t}}cl.prototype.bytesPerElement=8,Xt(cl,"StructArrayLayout4i8");class Kp extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,s,a,c)}emplace(t,n,s,a,c,u){const d=5*t;return this.int16[d+0]=n,this.int16[d+1]=s,this.int16[d+2]=a,this.int16[d+3]=c,this.int16[d+4]=u,t}}Kp.prototype.bytesPerElement=10,Xt(Kp,"StructArrayLayout5i10");class Vu extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c,u,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,s,a,c,u,d)}emplace(t,n,s,a,c,u,d,f){const p=6*t,g=12*t,_=3*t;return this.int16[p+0]=n,this.int16[p+1]=s,this.uint8[g+4]=a,this.uint8[g+5]=c,this.uint8[g+6]=u,this.uint8[g+7]=d,this.float32[_+2]=f,t}}Vu.prototype.bytesPerElement=12,Xt(Vu,"StructArrayLayout2i4ub1f12");class Mr extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,s,a)}emplace(t,n,s,a,c){const u=4*t;return this.float32[u+0]=n,this.float32[u+1]=s,this.float32[u+2]=a,this.float32[u+3]=c,t}}Mr.prototype.bytesPerElement=16,Xt(Mr,"StructArrayLayout4f16");class ul extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,s,a,c)}emplace(t,n,s,a,c,u){const d=6*t,f=3*t;return this.uint16[d+0]=n,this.uint16[d+1]=s,this.uint16[d+2]=a,this.uint16[d+3]=c,this.float32[f+2]=u,t}}ul.prototype.bytesPerElement=12,Xt(ul,"StructArrayLayout4ui1f12");class gc extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,s,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,s,a)}emplace(t,n,s,a,c){const u=4*t;return this.uint16[u+0]=n,this.uint16[u+1]=s,this.uint16[u+2]=a,this.uint16[u+3]=c,t}}gc.prototype.bytesPerElement=8,Xt(gc,"StructArrayLayout4ui8");class _c extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,s,a,c,u)}emplace(t,n,s,a,c,u,d){const f=6*t;return this.int16[f+0]=n,this.int16[f+1]=s,this.int16[f+2]=a,this.int16[f+3]=c,this.int16[f+4]=u,this.int16[f+5]=d,t}}_c.prototype.bytesPerElement=12,Xt(_c,"StructArrayLayout6i12");class Uu extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c,u,d,f,p,g,_,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,s,a,c,u,d,f,p,g,_,v)}emplace(t,n,s,a,c,u,d,f,p,g,_,v,x){const b=12*t;return this.int16[b+0]=n,this.int16[b+1]=s,this.int16[b+2]=a,this.int16[b+3]=c,this.uint16[b+4]=u,this.uint16[b+5]=d,this.uint16[b+6]=f,this.uint16[b+7]=p,this.int16[b+8]=g,this.int16[b+9]=_,this.int16[b+10]=v,this.int16[b+11]=x,t}}Uu.prototype.bytesPerElement=24,Xt(Uu,"StructArrayLayout4i4ui4i24");class wd extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,s,a,c,u)}emplace(t,n,s,a,c,u,d){const f=10*t,p=5*t;return this.int16[f+0]=n,this.int16[f+1]=s,this.int16[f+2]=a,this.float32[p+2]=c,this.float32[p+3]=u,this.float32[p+4]=d,t}}wd.prototype.bytesPerElement=20,Xt(wd,"StructArrayLayout3i3f20");class Qp extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}Qp.prototype.bytesPerElement=4,Xt(Qp,"StructArrayLayout1ul4");class Ea extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,n)}emplace(t,n,s){const a=2*t;return this.uint16[a+0]=n,this.uint16[a+1]=s,t}}Ea.prototype.bytesPerElement=4,Xt(Ea,"StructArrayLayout2ui4");class iy extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c,u,d,f,p,g,_,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,n,s,a,c,u,d,f,p,g,_,v,x)}emplace(t,n,s,a,c,u,d,f,p,g,_,v,x,b){const E=20*t,C=10*t;return this.int16[E+0]=n,this.int16[E+1]=s,this.int16[E+2]=a,this.int16[E+3]=c,this.int16[E+4]=u,this.float32[C+3]=d,this.float32[C+4]=f,this.float32[C+5]=p,this.float32[C+6]=g,this.int16[E+14]=_,this.uint32[C+8]=v,this.uint16[E+18]=x,this.uint16[E+19]=b,t}}iy.prototype.bytesPerElement=40,Xt(iy,"StructArrayLayout5i4f1i1ul2ui40");class Ca extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c,u,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,s,a,c,u,d)}emplace(t,n,s,a,c,u,d,f){const p=8*t;return this.int16[p+0]=n,this.int16[p+1]=s,this.int16[p+2]=a,this.int16[p+4]=c,this.int16[p+5]=u,this.int16[p+6]=d,this.int16[p+7]=f,t}}Ca.prototype.bytesPerElement=16,Xt(Ca,"StructArrayLayout3i2i2i16");class yc extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,s,a,c)}emplace(t,n,s,a,c,u){const d=4*t,f=8*t;return this.float32[d+0]=n,this.float32[d+1]=s,this.float32[d+2]=a,this.int16[f+6]=c,this.int16[f+7]=u,t}}yc.prototype.bytesPerElement=16,Xt(yc,"StructArrayLayout2f1f2i16");class ry extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,s,a)}emplace(t,n,s,a,c){const u=12*t,d=3*t;return this.uint8[u+0]=n,this.uint8[u+1]=s,this.float32[d+1]=a,this.float32[d+2]=c,t}}ry.prototype.bytesPerElement=12,Xt(ry,"StructArrayLayout2ub2f12");class Ai extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,n,s)}emplace(t,n,s,a){const c=3*t;return this.uint16[c+0]=n,this.uint16[c+1]=s,this.uint16[c+2]=a,t}}Ai.prototype.bytesPerElement=6,Xt(Ai,"StructArrayLayout3ui6");class Ed extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C,M,T,R,P,I){const O=this.length;return this.resize(O+1),this.emplace(O,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C,M,T,R,P,I)}emplace(t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C,M,T,R,P,I,O){const L=30*t,F=15*t,N=60*t;return this.int16[L+0]=n,this.int16[L+1]=s,this.int16[L+2]=a,this.float32[F+2]=c,this.float32[F+3]=u,this.uint16[L+8]=d,this.uint16[L+9]=f,this.uint32[F+5]=p,this.uint32[F+6]=g,this.uint32[F+7]=_,this.uint16[L+16]=v,this.uint16[L+17]=x,this.uint16[L+18]=b,this.float32[F+10]=E,this.float32[F+11]=C,this.uint8[N+48]=M,this.uint8[N+49]=T,this.uint8[N+50]=R,this.uint32[F+13]=P,this.int16[L+28]=I,this.uint8[N+58]=O,t}}Ed.prototype.bytesPerElement=60,Xt(Ed,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class H1 extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C,M,T,R,P,I,O,L,F,N,B,V,U,q,j,X,Q){const nt=this.length;return this.resize(nt+1),this.emplace(nt,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C,M,T,R,P,I,O,L,F,N,B,V,U,q,j,X,Q)}emplace(t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C,M,T,R,P,I,O,L,F,N,B,V,U,q,j,X,Q,nt){const Y=20*t,K=40*t,ot=80*t;return this.float32[Y+0]=n,this.float32[Y+1]=s,this.int16[K+4]=a,this.int16[K+5]=c,this.int16[K+6]=u,this.int16[K+7]=d,this.int16[K+8]=f,this.int16[K+9]=p,this.int16[K+10]=g,this.int16[K+11]=_,this.int16[K+12]=v,this.uint16[K+13]=x,this.uint16[K+14]=b,this.uint16[K+15]=E,this.uint16[K+16]=C,this.uint16[K+17]=M,this.uint16[K+18]=T,this.uint16[K+19]=R,this.uint16[K+20]=P,this.uint16[K+21]=I,this.uint16[K+22]=O,this.uint16[K+23]=L,this.uint16[K+24]=F,this.uint16[K+25]=N,this.uint16[K+26]=B,this.uint16[K+27]=V,this.uint32[Y+14]=U,this.float32[Y+15]=q,this.float32[Y+16]=j,this.float32[Y+17]=X,this.float32[Y+18]=Q,this.uint8[ot+76]=nt,t}}H1.prototype.bytesPerElement=80,Xt(H1,"StructArrayLayout2f9i15ui1ul4f1ub80");class Cd extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Cd.prototype.bytesPerElement=4,Xt(Cd,"StructArrayLayout1f4");class vc extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,s,a,c)}emplace(t,n,s,a,c,u){const d=5*t;return this.float32[d+0]=n,this.float32[d+1]=s,this.float32[d+2]=a,this.float32[d+3]=c,this.float32[d+4]=u,t}}vc.prototype.bytesPerElement=20,Xt(vc,"StructArrayLayout5f20");class G1 extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c,u,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,s,a,c,u,d)}emplace(t,n,s,a,c,u,d,f){const p=7*t;return this.float32[p+0]=n,this.float32[p+1]=s,this.float32[p+2]=a,this.float32[p+3]=c,this.float32[p+4]=u,this.float32[p+5]=d,this.float32[p+6]=f,t}}G1.prototype.bytesPerElement=28,Xt(G1,"StructArrayLayout7f28");class q1 extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,s,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,s,a)}emplace(t,n,s,a,c){const u=6*t;return this.uint32[3*t+0]=n,this.uint16[u+2]=s,this.uint16[u+3]=a,this.uint16[u+4]=c,t}}q1.prototype.bytesPerElement=12,Xt(q1,"StructArrayLayout1ul3ui12");class xc extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}xc.prototype.bytesPerElement=2,Xt(xc,"StructArrayLayout1ui2");class hs extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,n,s)}emplace(t,n,s,a){const c=3*t;return this.float32[c+0]=n,this.float32[c+1]=s,this.float32[c+2]=a,t}}hs.prototype.bytesPerElement=12,Xt(hs,"StructArrayLayout3f12");class Dd extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,n)}emplace(t,n,s){const a=2*t;return this.float32[a+0]=n,this.float32[a+1]=s,t}}Dd.prototype.bytesPerElement=8,Xt(Dd,"StructArrayLayout2f8");class bc extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C){const M=this.length;return this.resize(M+1),this.emplace(M,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C)}emplace(t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C,M){const T=16*t;return this.float32[T+0]=n,this.float32[T+1]=s,this.float32[T+2]=a,this.float32[T+3]=c,this.float32[T+4]=u,this.float32[T+5]=d,this.float32[T+6]=f,this.float32[T+7]=p,this.float32[T+8]=g,this.float32[T+9]=_,this.float32[T+10]=v,this.float32[T+11]=x,this.float32[T+12]=b,this.float32[T+13]=E,this.float32[T+14]=C,this.float32[T+15]=M,t}}bc.prototype.bytesPerElement=64,Xt(bc,"StructArrayLayout16f64");class $u extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s,a,c,u,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,s,a,c,u,d)}emplace(t,n,s,a,c,u,d,f){const p=10*t,g=5*t;return this.uint16[p+0]=n,this.uint16[p+1]=s,this.uint16[p+2]=a,this.uint16[p+3]=c,this.float32[g+2]=u,this.float32[g+3]=d,this.float32[g+4]=f,t}}$u.prototype.bytesPerElement=20,Xt($u,"StructArrayLayout4ui3f20");class Hu extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint8[1*t+0]=n,t}}Hu.prototype.bytesPerElement=1,Xt(Hu,"StructArrayLayout1ub1");class lT extends Us{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}lT.prototype.size=40;class Jp extends iy{get(t){return new lT(this,t)}}Xt(Jp,"CollisionBoxArray");class oy extends Us{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}oy.prototype.size=60;class Z1 extends Ed{get(t){return new oy(this,t)}}Xt(Z1,"PlacedSymbolArray");class ds extends Us{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}ds.prototype.size=80;class W1 extends H1{get(t){return new ds(this,t)}}Xt(W1,"SymbolInstanceArray");class Md extends Cd{getoffsetX(t){return this.float32[1*t+0]}}Xt(Md,"GlyphOffsetArray");class tm extends ro{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Xt(tm,"SymbolLineVertexArray");class sy extends Us{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}sy.prototype.size=12;class Td extends q1{get(t){return new sy(this,t)}}Xt(Td,"FeatureIndexArray");class em extends Ea{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Xt(em,"FillExtrusionCentroidArray");const cT=dn([{name:"a_pos",components:2,type:"Int16"}],4),Y1=dn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class yn{constructor(t=[]){this.segments=t}_prepareSegment(t,n,s,a){let c=this.segments[this.segments.length-1];return t>yn.MAX_VERTEX_ARRAY_LENGTH&&tt(`Max vertices per segment is ${yn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!c||c.vertexLength+t>yn.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==a)&&(c={vertexOffset:n,primitiveOffset:s,vertexLength:0,primitiveLength:0},void 0!==a&&(c.sortKey=a),this.segments.push(c)),c}prepareSegment(t,n,s,a){return this._prepareSegment(t,n.length,s.length,a)}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,s,a){return new yn([{vertexOffset:t,primitiveOffset:n,vertexLength:s,primitiveLength:a,vaos:{},sortKey:0}])}}function ay(e,t){return 256*(e=Qt(Math.floor(e),0,255))+Qt(Math.floor(t),0,255)}yn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xt(yn,"SegmentVector");const X1=dn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),uT=dn([{name:"a_dash",components:4,type:"Uint16"}]);var wc={exports:{}},hT={exports:function(t,n){var s,a,c,u,d,f,p,g;for(a=t.length-(s=3&t.length),c=n,d=3432918353,f=461845907,g=0;g<a;)p=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24,++g,c=27492+(65535&(u=5*(65535&(c=(c^=p=(65535&(p=(p=(65535&p)*d+(((p>>>16)*d&65535)<<16)&4294967295)<<15|p>>>17))*f+(((p>>>16)*f&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(p=0,s){case 3:p^=(255&t.charCodeAt(g+2))<<16;case 2:p^=(255&t.charCodeAt(g+1))<<8;case 1:c^=p=(65535&(p=(p=(65535&(p^=255&t.charCodeAt(g)))*d+(((p>>>16)*d&65535)<<16)&4294967295)<<15|p>>>17))*f+(((p>>>16)*f&65535)<<16)&4294967295}return c^=t.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0}}.exports,ly={exports:{}};ly.exports=function(t,n){for(var s,a=t.length,c=n^a,u=0;a>=4;)s=1540483477*(65535&(s=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24))+((1540483477*(s>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),a-=4,++u;switch(a){case 3:c^=(255&t.charCodeAt(u+2))<<16;case 2:c^=(255&t.charCodeAt(u+1))<<8;case 1:c=1540483477*(65535&(c^=255&t.charCodeAt(u)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var cy=hT,Sd=ly.exports;wc.exports=cy,wc.exports.murmur3=cy,wc.exports.murmur2=Sd;var uy=Jr(wc.exports);class ir{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,n,s,a){this.ids.push(K1(t)),this.positions.push(n,s,a)}eachPosition(t,n){const s=K1(t);let a=0,c=this.ids.length-1;for(;a<c;){const u=a+c>>1;this.ids[u]>=s?c=u:a=u+1}for(;this.ids[a]===s;)n(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(t,n){const s=new Float64Array(t.ids),a=new Uint32Array(t.positions);return nm(s,a,0,s.length-1),n&&(n.add(s.buffer),n.add(a.buffer)),{ids:s,positions:a}}static deserialize(t){const n=new ir;let s;n.ids=t.ids,n.positions=t.positions;for(const a of n.ids)a!==s&&n.uniqueIds.push(a),s=a;return n.indexed=!0,n}}function K1(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:uy(String(e))}function nm(e,t,n,s){for(;n<s;){const a=e[n+s>>1];let c=n-1,u=s+1;for(;;){do{c++}while(e[c]<a);do{u--}while(e[u]>a);if(c>=u)break;Gu(e,c,u),Gu(t,3*c,3*u),Gu(t,3*c+1,3*u+1),Gu(t,3*c+2,3*u+2)}u-n<s-u?(nm(e,t,n,u),n=u+1):(nm(e,t,u+1,s),s=u)}}function Gu(e,t,n){const s=e[t];e[t]=e[n],e[n]=s}Xt(ir,"FeaturePositionMap");class Da{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,n),this.initialized=!0),!!this.location}}class Ne extends Da{constructor(t){super(t),this.current=0}set(t,n,s){this.fetchUniformLocation(t,n)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class xt extends Da{constructor(t){super(t),this.current=0}set(t,n,s){this.fetchUniformLocation(t,n)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Me extends Da{constructor(t){super(t),this.current=[0,0]}set(t,n,s){this.fetchUniformLocation(t,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class be extends Da{constructor(t){super(t),this.current=[0,0,0]}set(t,n,s){this.fetchUniformLocation(t,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class rr extends Da{constructor(t){super(t),this.current=[0,0,0,0]}set(t,n,s){this.fetchUniformLocation(t,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Ec extends Da{constructor(t){super(t),this.current=Pe.transparent}set(t,n,s){this.fetchUniformLocation(t,n)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const hy=new Float32Array(16);class ye extends Da{constructor(t){super(t),this.current=hy}set(t,n,s){if(this.fetchUniformLocation(t,n)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let a=1;a<16;a++)if(s[a]!==this.current[a]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const rR=new Float32Array(9);class dy extends Da{constructor(t){super(t),this.current=rR}set(t,n,s){if(this.fetchUniformLocation(t,n))for(let a=0;a<9;a++)if(s[a]!==this.current[a]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}const oR=new Float32Array(4);class Q1 extends Da{constructor(t){super(t),this.current=oR}set(t,n,s){if(this.fetchUniformLocation(t,n))for(let a=0;a<4;a++)if(s[a]!==this.current[a]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}function J1(e){return[ay(255*e.r,255*e.g),ay(255*e.b,255*e.a)]}class im{constructor(t,n,s){this.value=t,this.uniformNames=n.map(a=>`u_${a}`),this.type=s}setUniform(t,n,s,a,c){n.set(t,c,a.constantOr(this.value))}getBinding(t,n){return"color"===this.type?new Ec(t):new xt(t)}}class Id{constructor(t,n){this.uniformNames=n.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,n,s,a,c){const u="u_pattern"===c||"u_dash"===c?this.pattern:"u_pixel_ratio"===c?this.pixelRatio:null;u&&n.set(t,c,u)}getBinding(t,n){return"u_pattern"===n||"u_dash"===n?new rr(t):new xt(t)}}class dl{constructor(t,n,s,a){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(c=>({name:`a_${c}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(t,n,s,a,c,u,d){const f=this.paintVertexArray.length,p=this.expression.evaluate(new zn(0,{brightness:u}),n,{},c,a,d);this.paintVertexArray.resize(t),this._setPaintValue(f,t,p)}updatePaintArray(t,n,s,a,c,u,d){const f=this.expression.evaluate({zoom:0,brightness:d},s,a,void 0,c);this._setPaintValue(t,n,f)}_setPaintValue(t,n,s){if("color"===this.type){const a=J1(s);for(let c=t;c<n;c++)this.paintVertexArray.emplace(c,a[0],a[1])}else{for(let a=t;a<n;a++)this.paintVertexArray.emplace(a,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Tr{constructor(t,n,s,a,c,u){this.expression=t,this.uniformNames=n.map(d=>`u_${d}_t`),this.type=s,this.useIntegerZoom=a,this.zoom=c,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,n,s,a,c,u,d){const f=this.expression.evaluate(new zn(this.zoom,{brightness:u}),n,{},c,a,d),p=this.expression.evaluate(new zn(this.zoom+1,{brightness:u}),n,{},c,a,d),g=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(g,t,f,p)}updatePaintArray(t,n,s,a,c,u,d){const f=this.expression.evaluate({zoom:this.zoom,brightness:d},s,a,void 0,c),p=this.expression.evaluate({zoom:this.zoom+1,brightness:d},s,a,void 0,c);this._setPaintValue(t,n,f,p)}_setPaintValue(t,n,s,a){if("color"===this.type){const c=J1(s),u=J1(a);for(let d=t;d<n;d++)this.paintVertexArray.emplace(d,c[0],c[1],u[0],u[1])}else{for(let c=t;c<n;c++)this.paintVertexArray.emplace(c,s,a);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n,s,a,c){const u=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,d=Qt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);n.set(t,c,d)}getBinding(t,n){return new xt(t)}}class fl{constructor(t,n,s,a,c){this.expression=t,this.layerId=c,this.paintVertexAttributes=("array"===s?uT:X1).members;for(let u=0;u<n.length;++u);this.paintVertexArray=new a}populatePaintArray(t,n,s){const a=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(a,t,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(t,n,s,a,c,u,d){this._setPaintValues(t,n,s.patterns&&s.patterns[this.layerId],u)}_setPaintValues(t,n,s,a){if(!a||!s)return;const c=a[s];if(!c)return;const{tl:u,br:d,pixelRatio:f}=c;for(let p=t;p<n;p++)this.paintVertexArray.emplace(p,u[0],u[1],d[0],d[1],f)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Cc{constructor(t,n,s=(()=>!0)){this.binders={},this._buffers=[];const a=[];for(const c in t.paint._values){const u=t.paint.get(c);if(!s(c)||!(u instanceof ll&&Ou(u.property.specification)))continue;const d=Ad(c,t.type),f=u.value,p=u.property.specification.type,g=!!u.property.useIntegerZoom,_="line-dasharray"===c||c.endsWith("pattern"),v="line-dasharray"===c&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==f.kind||v)if("source"===f.kind||v||_){const x=Dc(c,p,"source");this.binders[c]=_?new fl(f,d,p,x,t.id):new dl(f,d,p,x),a.push(`/a_${c}`)}else{const x=Dc(c,p,"composite");this.binders[c]=new Tr(f,d,p,g,n,x),a.push(`/z_${c}`)}else this.binders[c]=_?new Id(f.value,d):new im(f.value,d,p),a.push(`/u_${c}`)}this.cacheKey=a.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof dl||n instanceof Tr?n.maxValue:0}populatePaintArrays(t,n,s,a,c,u,d){for(const f in this.binders){const p=this.binders[f];(p instanceof dl||p instanceof Tr||p instanceof fl)&&p.populatePaintArray(t,n,s,a,c,u,d)}}setConstantPatternPositions(t){for(const n in this.binders){const s=this.binders[n];s instanceof Id&&s.setConstantPatternPositions(t)}}updatePaintArrays(t,n,s,a,c,u,d,f){let p=!1;const g=Object.keys(t),_=0!==g.length,v=_?g:n.uniqueIds;for(const x in this.binders){const b=this.binders[x];if((b instanceof dl||b instanceof Tr||b instanceof fl)&&(!0===b.expression.isStateDependent||!1===b.expression.isLightConstant)){const E=c.paint.get(x);b.expression=E.value;for(const C of v){const M=t[C.toString()];n.eachPosition(C,(T,R,P)=>{const I=a.feature(T);b.updatePaintArray(R,P,I,M,u,d,f)})}if(!_)for(const C of s.uniqueIds){const M=t[C.toString()];s.eachPosition(C,(T,R,P)=>{const I=a.feature(T);b.updatePaintArray(R,P,I,M,u,d,f)})}p=!0}}return p}defines(){const t=[];for(const n in this.binders){const s=this.binders[n];(s instanceof im||s instanceof Id)&&t.push(...s.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof dl||s instanceof Tr||s instanceof fl)for(let a=0;a<s.paintVertexAttributes.length;a++)t.push(s.paintVertexAttributes[a].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof im||s instanceof Id||s instanceof Tr)for(const a of s.uniformNames)t.push(a)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const n=[];for(const s in this.binders){const a=this.binders[s];if(a instanceof im||a instanceof Id||a instanceof Tr)for(const c of a.uniformNames)n.push({name:c,property:s,binding:a.getBinding(t,c)})}return n}setUniforms(t,n,s,a,c){for(const{name:u,property:d,binding:f}of s)this.binders[d].setUniform(t,f,c,a.get(d),u)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const n=this.binders[t];(n instanceof dl||n instanceof Tr||n instanceof fl)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(const n in this.binders){const s=this.binders[n];(s instanceof dl||s instanceof Tr||s instanceof fl)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof dl||n instanceof Tr||n instanceof fl)&&n.destroy()}}}class mi{constructor(t,n,s=(()=>!0)){this.programConfigurations={};for(const a of t)this.programConfigurations[a.id]=new Cc(a,n,s);this.needsUpload=!1,this._featureMap=new ir,this._featureMapWithoutIds=new ir,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,n,s,a,c,u,d,f){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(t,n,a,c,u,d,f);void 0!==n.id?this._featureMap.add(n.id,s,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,s,a,c,u){for(const d of s)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,n,d,a,c,u||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const dT={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ad(e,t){return dT[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const fT={"line-pattern":{source:ul,composite:ul},"fill-pattern":{source:ul,composite:ul},"fill-extrusion-pattern":{source:ul,composite:ul},"line-dasharray":{source:gc,composite:gc}},Uo={color:{source:Dd,composite:Mr},number:{source:Cd,composite:Dd}};function Dc(e,t,n){const s=fT[e];return s&&s[n]||Uo[t][n]}Xt(im,"ConstantBinder"),Xt(Id,"PatternConstantBinder"),Xt(dl,"SourceExpressionBinder"),Xt(fl,"PatternCompositeBinder"),Xt(Tr,"CompositeExpressionBinder"),Xt(Cc,"ProgramConfiguration",{omit:["_buffers"]}),Xt(mi,"ProgramConfigurationSet");class Ur{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof ve?new ve(t.lng,t.lat):ve.convert(t),this}setSouthWest(t){return this._sw=t instanceof ve?new ve(t.lng,t.lat):ve.convert(t),this}extend(t){const n=this._sw,s=this._ne;let a,c;if(t instanceof ve)a=t,c=t;else{if(!(t instanceof Ur))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Ur.convert(t)):this.extend(ve.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(ve.convert(t)):this;if(a=t._sw,c=t._ne,!a||!c)return this}return n||s?(n.lng=Math.min(a.lng,n.lng),n.lat=Math.min(a.lat,n.lat),s.lng=Math.max(c.lng,s.lng),s.lat=Math.max(c.lat,s.lat)):(this._sw=new ve(a.lng,a.lat),this._ne=new ve(c.lng,c.lat)),this}getCenter(){return new ve((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ve(this.getWest(),this.getNorth())}getSouthEast(){return new ve(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:s}=ve.convert(t);let a=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&a}static convert(t){return!t||t instanceof Ur?t:new Ur(t)}}var bi={},_i={};Object.defineProperty(_i,"__esModule",{value:!0}),_i.setMatrixArrayType=function(e){_i.ARRAY_TYPE=pT=e},_i.toRadian=function(e){return e*sR},_i.equals=function(e,t){return Math.abs(e-t)<=tb*Math.max(1,Math.abs(e),Math.abs(t))},_i.RANDOM=_i.ARRAY_TYPE=_i.EPSILON=void 0;var tb=1e-6;_i.EPSILON=tb;var pT=typeof Float32Array<"u"?Float32Array:Array;_i.ARRAY_TYPE=pT;var mT=Math.random;_i.RANDOM=mT;var sR=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var fn={};function Rd(e){return(Rd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(fn,"__esModule",{value:!0}),fn.create=function(){var e=new Do.ARRAY_TYPE(4);return Do.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},fn.clone=function(e){var t=new Do.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},fn.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},fn.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},fn.fromValues=function(e,t,n,s){var a=new Do.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=s,a},fn.set=function(e,t,n,s,a){return e[0]=t,e[1]=n,e[2]=s,e[3]=a,e},fn.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},fn.invert=function(e,t){var n=t[0],s=t[1],a=t[2],c=t[3],u=n*c-a*s;return u?(e[0]=c*(u=1/u),e[1]=-s*u,e[2]=-a*u,e[3]=n*u,e):null},fn.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},fn.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},fn.multiply=fy,fn.rotate=function(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3],d=Math.sin(n),f=Math.cos(n);return e[0]=s*f+c*d,e[1]=a*f+u*d,e[2]=s*-d+c*f,e[3]=a*-d+u*f,e},fn.scale=function(e,t,n){var s=t[1],a=t[2],c=t[3],u=n[0],d=n[1];return e[0]=t[0]*u,e[1]=s*u,e[2]=a*d,e[3]=c*d,e},fn.fromRotation=function(e,t){var n=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=n,e[2]=-n,e[3]=s,e},fn.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},fn.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},fn.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},fn.LDU=function(e,t,n,s){return e[2]=s[2]/s[0],n[0]=s[0],n[1]=s[1],n[3]=s[3]-e[2]*n[1],[e,t,n]},fn.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},fn.subtract=eb,fn.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},fn.equals=function(e,t){var n=e[0],s=e[1],a=e[2],c=e[3],u=t[0],d=t[1],f=t[2],p=t[3];return Math.abs(n-u)<=Do.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-d)<=Do.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-f)<=Do.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(c-p)<=Do.EPSILON*Math.max(1,Math.abs(c),Math.abs(p))},fn.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},fn.multiplyScalarAndAdd=function(e,t,n,s){return e[0]=t[0]+n[0]*s,e[1]=t[1]+n[1]*s,e[2]=t[2]+n[2]*s,e[3]=t[3]+n[3]*s,e},fn.sub=fn.mul=void 0;var Do=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Rd(e)&&"function"!=typeof e)return{default:e};var n=gT(void 0);if(n&&n.has(e))return n.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var u=a?Object.getOwnPropertyDescriptor(e,c):null;u&&(u.get||u.set)?Object.defineProperty(s,c,u):s[c]=e[c]}return s.default=e,n&&n.set(e,s),s}(_i);function gT(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(gT=function(s){return s?n:t})(e)}function fy(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3],d=n[0],f=n[1],p=n[2],g=n[3];return e[0]=s*d+c*f,e[1]=a*d+u*f,e[2]=s*p+c*g,e[3]=a*p+u*g,e}function eb(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}fn.mul=fy,fn.sub=eb;var Jn={};function py(e){return(py="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.create=function(){var e=new $s.ARRAY_TYPE(6);return $s.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},Jn.clone=function(e){var t=new $s.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},Jn.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},Jn.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},Jn.fromValues=function(e,t,n,s,a,c){var u=new $s.ARRAY_TYPE(6);return u[0]=e,u[1]=t,u[2]=n,u[3]=s,u[4]=a,u[5]=c,u},Jn.set=function(e,t,n,s,a,c,u){return e[0]=t,e[1]=n,e[2]=s,e[3]=a,e[4]=c,e[5]=u,e},Jn.invert=function(e,t){var n=t[0],s=t[1],a=t[2],c=t[3],u=t[4],d=t[5],f=n*c-s*a;return f?(e[0]=c*(f=1/f),e[1]=-s*f,e[2]=-a*f,e[3]=n*f,e[4]=(a*d-c*u)*f,e[5]=(s*u-n*d)*f,e):null},Jn.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},Jn.multiply=ib,Jn.rotate=function(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3],d=t[4],f=t[5],p=Math.sin(n),g=Math.cos(n);return e[0]=s*g+c*p,e[1]=a*g+u*p,e[2]=s*-p+c*g,e[3]=a*-p+u*g,e[4]=d,e[5]=f,e},Jn.scale=function(e,t,n){var s=t[1],a=t[2],c=t[3],u=t[4],d=t[5],f=n[0],p=n[1];return e[0]=t[0]*f,e[1]=s*f,e[2]=a*p,e[3]=c*p,e[4]=u,e[5]=d,e},Jn.translate=function(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3],d=t[4],f=t[5],p=n[0],g=n[1];return e[0]=s,e[1]=a,e[2]=c,e[3]=u,e[4]=s*p+c*g+d,e[5]=a*p+u*g+f,e},Jn.fromRotation=function(e,t){var n=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=n,e[2]=-n,e[3]=s,e[4]=0,e[5]=0,e},Jn.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},Jn.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},Jn.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},Jn.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},Jn.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},Jn.subtract=rm,Jn.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},Jn.multiplyScalarAndAdd=function(e,t,n,s){return e[0]=t[0]+n[0]*s,e[1]=t[1]+n[1]*s,e[2]=t[2]+n[2]*s,e[3]=t[3]+n[3]*s,e[4]=t[4]+n[4]*s,e[5]=t[5]+n[5]*s,e},Jn.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},Jn.equals=function(e,t){var n=e[0],s=e[1],a=e[2],c=e[3],u=e[4],d=e[5],f=t[0],p=t[1],g=t[2],_=t[3],v=t[4],x=t[5];return Math.abs(n-f)<=$s.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-p)<=$s.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-g)<=$s.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(c-_)<=$s.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(u-v)<=$s.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(d-x)<=$s.EPSILON*Math.max(1,Math.abs(d),Math.abs(x))},Jn.sub=Jn.mul=void 0;var $s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==py(e)&&"function"!=typeof e)return{default:e};var n=nb(void 0);if(n&&n.has(e))return n.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var u=a?Object.getOwnPropertyDescriptor(e,c):null;u&&(u.get||u.set)?Object.defineProperty(s,c,u):s[c]=e[c]}return s.default=e,n&&n.set(e,s),s}(_i);function nb(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(nb=function(s){return s?n:t})(e)}function ib(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3],d=t[4],f=t[5],p=n[0],g=n[1],_=n[2],v=n[3],x=n[4],b=n[5];return e[0]=s*p+c*g,e[1]=a*p+u*g,e[2]=s*_+c*v,e[3]=a*_+u*v,e[4]=s*x+c*b+d,e[5]=a*x+u*b+f,e}function rm(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}Jn.mul=ib,Jn.sub=rm;var vn={};function my(e){return(my="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(vn,"__esModule",{value:!0}),vn.create=function(){var e=new Sr.ARRAY_TYPE(9);return Sr.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},vn.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},vn.clone=function(e){var t=new Sr.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},vn.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},vn.fromValues=function(e,t,n,s,a,c,u,d,f){var p=new Sr.ARRAY_TYPE(9);return p[0]=e,p[1]=t,p[2]=n,p[3]=s,p[4]=a,p[5]=c,p[6]=u,p[7]=d,p[8]=f,p},vn.set=function(e,t,n,s,a,c,u,d,f,p){return e[0]=t,e[1]=n,e[2]=s,e[3]=a,e[4]=c,e[5]=u,e[6]=d,e[7]=f,e[8]=p,e},vn.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},vn.transpose=function(e,t){if(e===t){var n=t[1],s=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=s,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},vn.invert=function(e,t){var n=t[0],s=t[1],a=t[2],c=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=t[8],_=g*u-d*p,v=-g*c+d*f,x=p*c-u*f,b=n*_+s*v+a*x;return b?(e[0]=_*(b=1/b),e[1]=(-g*s+a*p)*b,e[2]=(d*s-a*u)*b,e[3]=v*b,e[4]=(g*n-a*f)*b,e[5]=(-d*n+a*c)*b,e[6]=x*b,e[7]=(-p*n+s*f)*b,e[8]=(u*n-s*c)*b,e):null},vn.adjoint=function(e,t){var n=t[0],s=t[1],a=t[2],c=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=t[8];return e[0]=u*g-d*p,e[1]=a*p-s*g,e[2]=s*d-a*u,e[3]=d*f-c*g,e[4]=n*g-a*f,e[5]=a*c-n*d,e[6]=c*p-u*f,e[7]=s*f-n*p,e[8]=n*u-s*c,e},vn.determinant=function(e){var t=e[3],n=e[4],s=e[5],a=e[6],c=e[7],u=e[8];return e[0]*(u*n-s*c)+e[1]*(-u*t+s*a)+e[2]*(c*t-n*a)},vn.multiply=Pd,vn.translate=function(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=t[8],v=n[0],x=n[1];return e[0]=s,e[1]=a,e[2]=c,e[3]=u,e[4]=d,e[5]=f,e[6]=v*s+x*u+p,e[7]=v*a+x*d+g,e[8]=v*c+x*f+_,e},vn.rotate=function(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=t[8],v=Math.sin(n),x=Math.cos(n);return e[0]=x*s+v*u,e[1]=x*a+v*d,e[2]=x*c+v*f,e[3]=x*u-v*s,e[4]=x*d-v*a,e[5]=x*f-v*c,e[6]=p,e[7]=g,e[8]=_,e},vn.scale=function(e,t,n){var s=n[0],a=n[1];return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},vn.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},vn.fromRotation=function(e,t){var n=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=n,e[2]=0,e[3]=-n,e[4]=s,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},vn.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},vn.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},vn.fromQuat=function(e,t){var n=t[0],s=t[1],a=t[2],c=t[3],u=n+n,d=s+s,f=a+a,p=n*u,g=s*u,_=s*d,v=a*u,x=a*d,b=a*f,E=c*u,C=c*d,M=c*f;return e[0]=1-_-b,e[3]=g-M,e[6]=v+C,e[1]=g+M,e[4]=1-p-b,e[7]=x-E,e[2]=v-C,e[5]=x+E,e[8]=1-p-_,e},vn.normalFromMat4=function(e,t){var n=t[0],s=t[1],a=t[2],c=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=t[8],_=t[9],v=t[10],x=t[11],b=t[12],E=t[13],C=t[14],M=t[15],T=n*d-s*u,R=n*f-a*u,P=n*p-c*u,I=s*f-a*d,O=s*p-c*d,L=a*p-c*f,F=g*E-_*b,N=g*C-v*b,B=g*M-x*b,V=_*C-v*E,U=_*M-x*E,q=v*M-x*C,j=T*q-R*U+P*V+I*B-O*N+L*F;return j?(e[0]=(d*q-f*U+p*V)*(j=1/j),e[1]=(f*B-u*q-p*N)*j,e[2]=(u*U-d*B+p*F)*j,e[3]=(a*U-s*q-c*V)*j,e[4]=(n*q-a*B+c*N)*j,e[5]=(s*B-n*U-c*F)*j,e[6]=(E*L-C*O+M*I)*j,e[7]=(C*P-b*L-M*R)*j,e[8]=(b*O-E*P+M*T)*j,e):null},vn.projection=function(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},vn.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},vn.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},vn.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},vn.subtract=ob,vn.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},vn.multiplyScalarAndAdd=function(e,t,n,s){return e[0]=t[0]+n[0]*s,e[1]=t[1]+n[1]*s,e[2]=t[2]+n[2]*s,e[3]=t[3]+n[3]*s,e[4]=t[4]+n[4]*s,e[5]=t[5]+n[5]*s,e[6]=t[6]+n[6]*s,e[7]=t[7]+n[7]*s,e[8]=t[8]+n[8]*s,e},vn.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},vn.equals=function(e,t){var n=e[0],s=e[1],a=e[2],c=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=e[8],_=t[0],v=t[1],x=t[2],b=t[3],E=t[4],C=t[5],M=t[6],T=t[7],R=t[8];return Math.abs(n-_)<=Sr.EPSILON*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(s-v)<=Sr.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(a-x)<=Sr.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(c-b)<=Sr.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(u-E)<=Sr.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(d-C)<=Sr.EPSILON*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(f-M)<=Sr.EPSILON*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(p-T)<=Sr.EPSILON*Math.max(1,Math.abs(p),Math.abs(T))&&Math.abs(g-R)<=Sr.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))},vn.sub=vn.mul=void 0;var Sr=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==my(e)&&"function"!=typeof e)return{default:e};var n=rb(void 0);if(n&&n.has(e))return n.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var u=a?Object.getOwnPropertyDescriptor(e,c):null;u&&(u.get||u.set)?Object.defineProperty(s,c,u):s[c]=e[c]}return s.default=e,n&&n.set(e,s),s}(_i);function rb(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(rb=function(s){return s?n:t})(e)}function Pd(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=t[8],v=n[0],x=n[1],b=n[2],E=n[3],C=n[4],M=n[5],T=n[6],R=n[7],P=n[8];return e[0]=v*s+x*u+b*p,e[1]=v*a+x*d+b*g,e[2]=v*c+x*f+b*_,e[3]=E*s+C*u+M*p,e[4]=E*a+C*d+M*g,e[5]=E*c+C*f+M*_,e[6]=T*s+R*u+P*p,e[7]=T*a+R*d+P*g,e[8]=T*c+R*f+P*_,e}function ob(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}vn.mul=Pd,vn.sub=ob;var Te={};function Od(e){return(Od="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(Te,"__esModule",{value:!0}),Te.create=function(){var e=new Kn.ARRAY_TYPE(16);return Kn.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},Te.clone=function(e){var t=new Kn.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Te.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Te.fromValues=function(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E){var C=new Kn.ARRAY_TYPE(16);return C[0]=e,C[1]=t,C[2]=n,C[3]=s,C[4]=a,C[5]=c,C[6]=u,C[7]=d,C[8]=f,C[9]=p,C[10]=g,C[11]=_,C[12]=v,C[13]=x,C[14]=b,C[15]=E,C},Te.set=function(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C){return e[0]=t,e[1]=n,e[2]=s,e[3]=a,e[4]=c,e[5]=u,e[6]=d,e[7]=f,e[8]=p,e[9]=g,e[10]=_,e[11]=v,e[12]=x,e[13]=b,e[14]=E,e[15]=C,e},Te.identity=sb,Te.transpose=function(e,t){if(e===t){var n=t[1],s=t[2],a=t[3],c=t[6],u=t[7],d=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=s,e[9]=c,e[11]=t[14],e[12]=a,e[13]=u,e[14]=d}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},Te.invert=function(e,t){var n=t[0],s=t[1],a=t[2],c=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=t[8],_=t[9],v=t[10],x=t[11],b=t[12],E=t[13],C=t[14],M=t[15],T=n*d-s*u,R=n*f-a*u,P=n*p-c*u,I=s*f-a*d,O=s*p-c*d,L=a*p-c*f,F=g*E-_*b,N=g*C-v*b,B=g*M-x*b,V=_*C-v*E,U=_*M-x*E,q=v*M-x*C,j=T*q-R*U+P*V+I*B-O*N+L*F;return j?(e[0]=(d*q-f*U+p*V)*(j=1/j),e[1]=(a*U-s*q-c*V)*j,e[2]=(E*L-C*O+M*I)*j,e[3]=(v*O-_*L-x*I)*j,e[4]=(f*B-u*q-p*N)*j,e[5]=(n*q-a*B+c*N)*j,e[6]=(C*P-b*L-M*R)*j,e[7]=(g*L-v*P+x*R)*j,e[8]=(u*U-d*B+p*F)*j,e[9]=(s*B-n*U-c*F)*j,e[10]=(b*O-E*P+M*T)*j,e[11]=(_*P-g*O-x*T)*j,e[12]=(d*N-u*V-f*F)*j,e[13]=(n*V-s*N+a*F)*j,e[14]=(E*R-b*I-C*T)*j,e[15]=(g*I-_*R+v*T)*j,e):null},Te.adjoint=function(e,t){var n=t[0],s=t[1],a=t[2],c=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=t[8],_=t[9],v=t[10],x=t[11],b=t[12],E=t[13],C=t[14],M=t[15];return e[0]=d*(v*M-x*C)-_*(f*M-p*C)+E*(f*x-p*v),e[1]=-(s*(v*M-x*C)-_*(a*M-c*C)+E*(a*x-c*v)),e[2]=s*(f*M-p*C)-d*(a*M-c*C)+E*(a*p-c*f),e[3]=-(s*(f*x-p*v)-d*(a*x-c*v)+_*(a*p-c*f)),e[4]=-(u*(v*M-x*C)-g*(f*M-p*C)+b*(f*x-p*v)),e[5]=n*(v*M-x*C)-g*(a*M-c*C)+b*(a*x-c*v),e[6]=-(n*(f*M-p*C)-u*(a*M-c*C)+b*(a*p-c*f)),e[7]=n*(f*x-p*v)-u*(a*x-c*v)+g*(a*p-c*f),e[8]=u*(_*M-x*E)-g*(d*M-p*E)+b*(d*x-p*_),e[9]=-(n*(_*M-x*E)-g*(s*M-c*E)+b*(s*x-c*_)),e[10]=n*(d*M-p*E)-u*(s*M-c*E)+b*(s*p-c*d),e[11]=-(n*(d*x-p*_)-u*(s*x-c*_)+g*(s*p-c*d)),e[12]=-(u*(_*C-v*E)-g*(d*C-f*E)+b*(d*v-f*_)),e[13]=n*(_*C-v*E)-g*(s*C-a*E)+b*(s*v-a*_),e[14]=-(n*(d*C-f*E)-u*(s*C-a*E)+b*(s*f-a*d)),e[15]=n*(d*v-f*_)-u*(s*v-a*_)+g*(s*f-a*d),e},Te.determinant=function(e){var t=e[0],n=e[1],s=e[2],a=e[3],c=e[4],u=e[5],d=e[6],f=e[7],p=e[8],g=e[9],_=e[10],v=e[11],x=e[12],b=e[13],E=e[14],C=e[15];return(t*u-n*c)*(_*C-v*E)-(t*d-s*c)*(g*C-v*b)+(t*f-a*c)*(g*E-_*b)+(n*d-s*u)*(p*C-v*x)-(n*f-a*u)*(p*E-_*x)+(s*f-a*d)*(p*b-g*x)},Te.multiply=ab,Te.translate=function(e,t,n){var s,a,c,u,d,f,p,g,_,v,x,b,E=n[0],C=n[1],M=n[2];return t===e?(e[12]=t[0]*E+t[4]*C+t[8]*M+t[12],e[13]=t[1]*E+t[5]*C+t[9]*M+t[13],e[14]=t[2]*E+t[6]*C+t[10]*M+t[14],e[15]=t[3]*E+t[7]*C+t[11]*M+t[15]):(a=t[1],c=t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=t[8],v=t[9],x=t[10],b=t[11],e[0]=s=t[0],e[1]=a,e[2]=c,e[3]=u,e[4]=d,e[5]=f,e[6]=p,e[7]=g,e[8]=_,e[9]=v,e[10]=x,e[11]=b,e[12]=s*E+d*C+_*M+t[12],e[13]=a*E+f*C+v*M+t[13],e[14]=c*E+p*C+x*M+t[14],e[15]=u*E+g*C+b*M+t[15]),e},Te.scale=function(e,t,n){var s=n[0],a=n[1],c=n[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*c,e[9]=t[9]*c,e[10]=t[10]*c,e[11]=t[11]*c,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Te.rotate=function(e,t,n,s){var a,c,u,d,f,p,g,_,v,x,b,E,C,M,T,R,P,I,O,L,F,N,B,V,U=s[0],q=s[1],j=s[2],X=Math.hypot(U,q,j);return X<Kn.EPSILON?null:(U*=X=1/X,q*=X,j*=X,a=Math.sin(n),c=Math.cos(n),f=t[1],p=t[2],g=t[3],v=t[5],x=t[6],b=t[7],C=t[9],M=t[10],T=t[11],O=U*q*(u=1-c)-j*a,L=q*q*u+c,F=j*q*u+U*a,N=U*j*u+q*a,B=q*j*u-U*a,V=j*j*u+c,e[0]=(d=t[0])*(R=U*U*u+c)+(_=t[4])*(P=q*U*u+j*a)+(E=t[8])*(I=j*U*u-q*a),e[1]=f*R+v*P+C*I,e[2]=p*R+x*P+M*I,e[3]=g*R+b*P+T*I,e[4]=d*O+_*L+E*F,e[5]=f*O+v*L+C*F,e[6]=p*O+x*L+M*F,e[7]=g*O+b*L+T*F,e[8]=d*N+_*B+E*V,e[9]=f*N+v*B+C*V,e[10]=p*N+x*B+M*V,e[11]=g*N+b*B+T*V,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},Te.rotateX=function(e,t,n){var s=Math.sin(n),a=Math.cos(n),c=t[4],u=t[5],d=t[6],f=t[7],p=t[8],g=t[9],_=t[10],v=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=c*a+p*s,e[5]=u*a+g*s,e[6]=d*a+_*s,e[7]=f*a+v*s,e[8]=p*a-c*s,e[9]=g*a-u*s,e[10]=_*a-d*s,e[11]=v*a-f*s,e},Te.rotateY=function(e,t,n){var s=Math.sin(n),a=Math.cos(n),c=t[0],u=t[1],d=t[2],f=t[3],p=t[8],g=t[9],_=t[10],v=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=c*a-p*s,e[1]=u*a-g*s,e[2]=d*a-_*s,e[3]=f*a-v*s,e[8]=c*s+p*a,e[9]=u*s+g*a,e[10]=d*s+_*a,e[11]=f*s+v*a,e},Te.rotateZ=function(e,t,n){var s=Math.sin(n),a=Math.cos(n),c=t[0],u=t[1],d=t[2],f=t[3],p=t[4],g=t[5],_=t[6],v=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=c*a+p*s,e[1]=u*a+g*s,e[2]=d*a+_*s,e[3]=f*a+v*s,e[4]=p*a-c*s,e[5]=g*a-u*s,e[6]=_*a-d*s,e[7]=v*a-f*s,e},Te.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},Te.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Te.fromRotation=function(e,t,n){var s,a,c,u=n[0],d=n[1],f=n[2],p=Math.hypot(u,d,f);return p<Kn.EPSILON?null:(u*=p=1/p,d*=p,f*=p,s=Math.sin(t),a=Math.cos(t),e[0]=u*u*(c=1-a)+a,e[1]=d*u*c+f*s,e[2]=f*u*c-d*s,e[3]=0,e[4]=u*d*c-f*s,e[5]=d*d*c+a,e[6]=f*d*c+u*s,e[7]=0,e[8]=u*f*c+d*s,e[9]=d*f*c-u*s,e[10]=f*f*c+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},Te.fromXRotation=function(e,t){var n=Math.sin(t),s=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Te.fromYRotation=function(e,t){var n=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Te.fromZRotation=function(e,t){var n=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Te.fromRotationTranslation=Mc,Te.fromQuat2=function(e,t){var n=new Kn.ARRAY_TYPE(3),s=-t[0],a=-t[1],c=-t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=s*s+a*a+c*c+u*u;return _>0?(n[0]=2*(d*u+g*s+f*c-p*a)/_,n[1]=2*(f*u+g*a+p*s-d*c)/_,n[2]=2*(p*u+g*c+d*a-f*s)/_):(n[0]=2*(d*u+g*s+f*c-p*a),n[1]=2*(f*u+g*a+p*s-d*c),n[2]=2*(p*u+g*c+d*a-f*s)),Mc(e,t,n),e},Te.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},Te.getScaling=qu,Te.getRotation=function(e,t){var n=new Kn.ARRAY_TYPE(3);qu(n,t);var s=1/n[0],a=1/n[1],c=1/n[2],u=t[0]*s,d=t[1]*a,f=t[2]*c,p=t[4]*s,g=t[5]*a,_=t[6]*c,v=t[8]*s,x=t[9]*a,b=t[10]*c,E=u+g+b,C=0;return E>0?(C=2*Math.sqrt(E+1),e[3]=.25*C,e[0]=(_-x)/C,e[1]=(v-f)/C,e[2]=(d-p)/C):u>g&&u>b?(C=2*Math.sqrt(1+u-g-b),e[3]=(_-x)/C,e[0]=.25*C,e[1]=(d+p)/C,e[2]=(v+f)/C):g>b?(C=2*Math.sqrt(1+g-u-b),e[3]=(v-f)/C,e[0]=(d+p)/C,e[1]=.25*C,e[2]=(_+x)/C):(C=2*Math.sqrt(1+b-u-g),e[3]=(d-p)/C,e[0]=(v+f)/C,e[1]=(_+x)/C,e[2]=.25*C),e},Te.fromRotationTranslationScale=function(e,t,n,s){var a=t[0],c=t[1],u=t[2],d=t[3],f=a+a,p=c+c,g=u+u,_=a*f,v=a*p,x=a*g,b=c*p,E=c*g,C=u*g,M=d*f,T=d*p,R=d*g,P=s[0],I=s[1],O=s[2];return e[0]=(1-(b+C))*P,e[1]=(v+R)*P,e[2]=(x-T)*P,e[3]=0,e[4]=(v-R)*I,e[5]=(1-(_+C))*I,e[6]=(E+M)*I,e[7]=0,e[8]=(x+T)*O,e[9]=(E-M)*O,e[10]=(1-(_+b))*O,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},Te.fromRotationTranslationScaleOrigin=function(e,t,n,s,a){var c=t[0],u=t[1],d=t[2],f=t[3],p=c+c,g=u+u,_=d+d,v=c*p,x=c*g,b=c*_,E=u*g,C=u*_,M=d*_,T=f*p,R=f*g,P=f*_,I=s[0],O=s[1],L=s[2],F=a[0],N=a[1],B=a[2],V=(1-(E+M))*I,U=(x+P)*I,q=(b-R)*I,j=(x-P)*O,X=(1-(v+M))*O,Q=(C+T)*O,nt=(b+R)*L,Y=(C-T)*L,K=(1-(v+E))*L;return e[0]=V,e[1]=U,e[2]=q,e[3]=0,e[4]=j,e[5]=X,e[6]=Q,e[7]=0,e[8]=nt,e[9]=Y,e[10]=K,e[11]=0,e[12]=n[0]+F-(V*F+j*N+nt*B),e[13]=n[1]+N-(U*F+X*N+Y*B),e[14]=n[2]+B-(q*F+Q*N+K*B),e[15]=1,e},Te.fromQuat=function(e,t){var n=t[0],s=t[1],a=t[2],c=t[3],u=n+n,d=s+s,f=a+a,p=n*u,g=s*u,_=s*d,v=a*u,x=a*d,b=a*f,E=c*u,C=c*d,M=c*f;return e[0]=1-_-b,e[1]=g+M,e[2]=v-C,e[3]=0,e[4]=g-M,e[5]=1-p-b,e[6]=x+E,e[7]=0,e[8]=v+C,e[9]=x-E,e[10]=1-p-_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Te.frustum=function(e,t,n,s,a,c,u){var d=1/(n-t),f=1/(a-s),p=1/(c-u);return e[0]=2*c*d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*c*f,e[6]=0,e[7]=0,e[8]=(n+t)*d,e[9]=(a+s)*f,e[10]=(u+c)*p,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*c*2*p,e[15]=0,e},Te.perspectiveNO=lb,Te.perspectiveZO=function(e,t,n,s,a){var c,u=1/Math.tan(t/2);return e[0]=u/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(e[10]=a*(c=1/(s-a)),e[14]=a*s*c):(e[10]=-1,e[14]=-s),e},Te.perspectiveFromFieldOfView=function(e,t,n,s){var a=Math.tan(t.upDegrees*Math.PI/180),c=Math.tan(t.downDegrees*Math.PI/180),u=Math.tan(t.leftDegrees*Math.PI/180),d=Math.tan(t.rightDegrees*Math.PI/180),f=2/(u+d),p=2/(a+c);return e[0]=f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=p,e[6]=0,e[7]=0,e[8]=-(u-d)*f*.5,e[9]=(a-c)*p*.5,e[10]=s/(n-s),e[11]=-1,e[12]=0,e[13]=0,e[14]=s*n/(n-s),e[15]=0,e},Te.orthoNO=_T,Te.orthoZO=function(e,t,n,s,a,c,u){var d=1/(t-n),f=1/(s-a),p=1/(c-u);return e[0]=-2*d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=p,e[11]=0,e[12]=(t+n)*d,e[13]=(a+s)*f,e[14]=c*p,e[15]=1,e},Te.lookAt=function(e,t,n,s){var a,c,u,d,f,p,g,_,v,x,b=t[0],E=t[1],C=t[2],M=s[0],T=s[1],R=s[2],P=n[0],I=n[1],O=n[2];return Math.abs(b-P)<Kn.EPSILON&&Math.abs(E-I)<Kn.EPSILON&&Math.abs(C-O)<Kn.EPSILON?sb(e):(g=b-P,_=E-I,v=C-O,a=T*(v*=x=1/Math.hypot(g,_,v))-R*(_*=x),c=R*(g*=x)-M*v,u=M*_-T*g,(x=Math.hypot(a,c,u))?(a*=x=1/x,c*=x,u*=x):(a=0,c=0,u=0),d=_*u-v*c,f=v*a-g*u,p=g*c-_*a,(x=Math.hypot(d,f,p))?(d*=x=1/x,f*=x,p*=x):(d=0,f=0,p=0),e[0]=a,e[1]=d,e[2]=g,e[3]=0,e[4]=c,e[5]=f,e[6]=_,e[7]=0,e[8]=u,e[9]=p,e[10]=v,e[11]=0,e[12]=-(a*b+c*E+u*C),e[13]=-(d*b+f*E+p*C),e[14]=-(g*b+_*E+v*C),e[15]=1,e)},Te.targetTo=function(e,t,n,s){var a=t[0],c=t[1],u=t[2],d=s[0],f=s[1],p=s[2],g=a-n[0],_=c-n[1],v=u-n[2],x=g*g+_*_+v*v;x>0&&(g*=x=1/Math.sqrt(x),_*=x,v*=x);var b=f*v-p*_,E=p*g-d*v,C=d*_-f*g;return(x=b*b+E*E+C*C)>0&&(b*=x=1/Math.sqrt(x),E*=x,C*=x),e[0]=b,e[1]=E,e[2]=C,e[3]=0,e[4]=_*C-v*E,e[5]=v*b-g*C,e[6]=g*E-_*b,e[7]=0,e[8]=g,e[9]=_,e[10]=v,e[11]=0,e[12]=a,e[13]=c,e[14]=u,e[15]=1,e},Te.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},Te.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},Te.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},Te.subtract=_y,Te.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},Te.multiplyScalarAndAdd=function(e,t,n,s){return e[0]=t[0]+n[0]*s,e[1]=t[1]+n[1]*s,e[2]=t[2]+n[2]*s,e[3]=t[3]+n[3]*s,e[4]=t[4]+n[4]*s,e[5]=t[5]+n[5]*s,e[6]=t[6]+n[6]*s,e[7]=t[7]+n[7]*s,e[8]=t[8]+n[8]*s,e[9]=t[9]+n[9]*s,e[10]=t[10]+n[10]*s,e[11]=t[11]+n[11]*s,e[12]=t[12]+n[12]*s,e[13]=t[13]+n[13]*s,e[14]=t[14]+n[14]*s,e[15]=t[15]+n[15]*s,e},Te.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},Te.equals=function(e,t){var n=e[0],s=e[1],a=e[2],c=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=e[8],_=e[9],v=e[10],x=e[11],b=e[12],E=e[13],C=e[14],M=e[15],T=t[0],R=t[1],P=t[2],I=t[3],O=t[4],L=t[5],F=t[6],N=t[7],B=t[8],V=t[9],U=t[10],q=t[11],j=t[12],X=t[13],Q=t[14],nt=t[15];return Math.abs(n-T)<=Kn.EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(s-R)<=Kn.EPSILON*Math.max(1,Math.abs(s),Math.abs(R))&&Math.abs(a-P)<=Kn.EPSILON*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(c-I)<=Kn.EPSILON*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(u-O)<=Kn.EPSILON*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(d-L)<=Kn.EPSILON*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(f-F)<=Kn.EPSILON*Math.max(1,Math.abs(f),Math.abs(F))&&Math.abs(p-N)<=Kn.EPSILON*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(g-B)<=Kn.EPSILON*Math.max(1,Math.abs(g),Math.abs(B))&&Math.abs(_-V)<=Kn.EPSILON*Math.max(1,Math.abs(_),Math.abs(V))&&Math.abs(v-U)<=Kn.EPSILON*Math.max(1,Math.abs(v),Math.abs(U))&&Math.abs(x-q)<=Kn.EPSILON*Math.max(1,Math.abs(x),Math.abs(q))&&Math.abs(b-j)<=Kn.EPSILON*Math.max(1,Math.abs(b),Math.abs(j))&&Math.abs(E-X)<=Kn.EPSILON*Math.max(1,Math.abs(E),Math.abs(X))&&Math.abs(C-Q)<=Kn.EPSILON*Math.max(1,Math.abs(C),Math.abs(Q))&&Math.abs(M-nt)<=Kn.EPSILON*Math.max(1,Math.abs(M),Math.abs(nt))},Te.sub=Te.mul=Te.ortho=Te.perspective=void 0;var Kn=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Od(e)&&"function"!=typeof e)return{default:e};var n=gy(void 0);if(n&&n.has(e))return n.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var u=a?Object.getOwnPropertyDescriptor(e,c):null;u&&(u.get||u.set)?Object.defineProperty(s,c,u):s[c]=e[c]}return s.default=e,n&&n.set(e,s),s}(_i);function gy(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(gy=function(s){return s?n:t})(e)}function sb(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ab(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=t[8],v=t[9],x=t[10],b=t[11],E=t[12],C=t[13],M=t[14],T=t[15],R=n[0],P=n[1],I=n[2],O=n[3];return e[0]=R*s+P*d+I*_+O*E,e[1]=R*a+P*f+I*v+O*C,e[2]=R*c+P*p+I*x+O*M,e[3]=R*u+P*g+I*b+O*T,e[4]=(R=n[4])*s+(P=n[5])*d+(I=n[6])*_+(O=n[7])*E,e[5]=R*a+P*f+I*v+O*C,e[6]=R*c+P*p+I*x+O*M,e[7]=R*u+P*g+I*b+O*T,e[8]=(R=n[8])*s+(P=n[9])*d+(I=n[10])*_+(O=n[11])*E,e[9]=R*a+P*f+I*v+O*C,e[10]=R*c+P*p+I*x+O*M,e[11]=R*u+P*g+I*b+O*T,e[12]=(R=n[12])*s+(P=n[13])*d+(I=n[14])*_+(O=n[15])*E,e[13]=R*a+P*f+I*v+O*C,e[14]=R*c+P*p+I*x+O*M,e[15]=R*u+P*g+I*b+O*T,e}function Mc(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3],d=s+s,f=a+a,p=c+c,g=s*d,_=s*f,v=s*p,x=a*f,b=a*p,E=c*p,C=u*d,M=u*f,T=u*p;return e[0]=1-(x+E),e[1]=_+T,e[2]=v-M,e[3]=0,e[4]=_-T,e[5]=1-(g+E),e[6]=b+C,e[7]=0,e[8]=v+M,e[9]=b-C,e[10]=1-(g+x),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function qu(e,t){var n=t[4],s=t[5],a=t[6],c=t[8],u=t[9],d=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(n,s,a),e[2]=Math.hypot(c,u,d),e}function lb(e,t,n,s,a){var c,u=1/Math.tan(t/2);return e[0]=u/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(e[10]=(a+s)*(c=1/(s-a)),e[14]=2*a*s*c):(e[10]=-1,e[14]=-2*s),e}function _T(e,t,n,s,a,c,u){var d=1/(t-n),f=1/(s-a),p=1/(c-u);return e[0]=-2*d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*p,e[11]=0,e[12]=(t+n)*d,e[13]=(a+s)*f,e[14]=(u+c)*p,e[15]=1,e}function _y(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}Te.perspective=lb,Te.ortho=_T,Te.mul=ab,Te.sub=_y;var Ce={},Ae={};function yy(e){return(yy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.create=kd,Ae.clone=function(e){var t=new Ma.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Ae.length=vy,Ae.fromValues=function(e,t,n){var s=new Ma.ARRAY_TYPE(3);return s[0]=e,s[1]=t,s[2]=n,s},Ae.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Ae.set=function(e,t,n,s){return e[0]=t,e[1]=n,e[2]=s,e},Ae.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},Ae.subtract=ub,Ae.multiply=xy,Ae.divide=yT,Ae.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},Ae.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},Ae.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},Ae.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},Ae.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},Ae.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},Ae.scaleAndAdd=function(e,t,n,s){return e[0]=t[0]+n[0]*s,e[1]=t[1]+n[1]*s,e[2]=t[2]+n[2]*s,e},Ae.distance=by,Ae.squaredDistance=vT,Ae.squaredLength=hb,Ae.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},Ae.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},Ae.normalize=function(e,t){var n=t[0],s=t[1],a=t[2],c=n*n+s*s+a*a;return c>0&&(c=1/Math.sqrt(c)),e[0]=t[0]*c,e[1]=t[1]*c,e[2]=t[2]*c,e},Ae.dot=db,Ae.cross=function(e,t,n){var s=t[0],a=t[1],c=t[2],u=n[0],d=n[1],f=n[2];return e[0]=a*f-c*d,e[1]=c*u-s*f,e[2]=s*d-a*u,e},Ae.lerp=function(e,t,n,s){var a=t[0],c=t[1],u=t[2];return e[0]=a+s*(n[0]-a),e[1]=c+s*(n[1]-c),e[2]=u+s*(n[2]-u),e},Ae.hermite=function(e,t,n,s,a,c){var u=c*c,d=u*(2*c-3)+1,f=u*(c-2)+c,p=u*(c-1),g=u*(3-2*c);return e[0]=t[0]*d+n[0]*f+s[0]*p+a[0]*g,e[1]=t[1]*d+n[1]*f+s[1]*p+a[1]*g,e[2]=t[2]*d+n[2]*f+s[2]*p+a[2]*g,e},Ae.bezier=function(e,t,n,s,a,c){var u=1-c,d=u*u,f=c*c,p=d*u,g=3*c*d,_=3*f*u,v=f*c;return e[0]=t[0]*p+n[0]*g+s[0]*_+a[0]*v,e[1]=t[1]*p+n[1]*g+s[1]*_+a[1]*v,e[2]=t[2]*p+n[2]*g+s[2]*_+a[2]*v,e},Ae.random=function(e,t){t=t||1;var n=2*Ma.RANDOM()*Math.PI,s=2*Ma.RANDOM()-1,a=Math.sqrt(1-s*s)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=s*t,e},Ae.transformMat4=function(e,t,n){var s=t[0],a=t[1],c=t[2],u=n[3]*s+n[7]*a+n[11]*c+n[15];return e[0]=(n[0]*s+n[4]*a+n[8]*c+n[12])/(u=u||1),e[1]=(n[1]*s+n[5]*a+n[9]*c+n[13])/u,e[2]=(n[2]*s+n[6]*a+n[10]*c+n[14])/u,e},Ae.transformMat3=function(e,t,n){var s=t[0],a=t[1],c=t[2];return e[0]=s*n[0]+a*n[3]+c*n[6],e[1]=s*n[1]+a*n[4]+c*n[7],e[2]=s*n[2]+a*n[5]+c*n[8],e},Ae.transformQuat=function(e,t,n){var s=n[0],a=n[1],c=n[2],u=t[0],d=t[1],f=t[2],p=a*f-c*d,g=c*u-s*f,_=s*d-a*u,v=a*_-c*g,x=c*p-s*_,b=s*g-a*p,E=2*n[3];return g*=E,_*=E,x*=2,b*=2,e[0]=u+(p*=E)+(v*=2),e[1]=d+g+x,e[2]=f+_+b,e},Ae.rotateX=function(e,t,n,s){var a=[],c=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],c[0]=a[0],c[1]=a[1]*Math.cos(s)-a[2]*Math.sin(s),c[2]=a[1]*Math.sin(s)+a[2]*Math.cos(s),e[0]=c[0]+n[0],e[1]=c[1]+n[1],e[2]=c[2]+n[2],e},Ae.rotateY=function(e,t,n,s){var a=[],c=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],c[0]=a[2]*Math.sin(s)+a[0]*Math.cos(s),c[1]=a[1],c[2]=a[2]*Math.cos(s)-a[0]*Math.sin(s),e[0]=c[0]+n[0],e[1]=c[1]+n[1],e[2]=c[2]+n[2],e},Ae.rotateZ=function(e,t,n,s){var a=[],c=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],c[0]=a[0]*Math.cos(s)-a[1]*Math.sin(s),c[1]=a[0]*Math.sin(s)+a[1]*Math.cos(s),c[2]=a[2],e[0]=c[0]+n[0],e[1]=c[1]+n[1],e[2]=c[2]+n[2],e},Ae.angle=function(e,t){var n=e[0],s=e[1],a=e[2],c=t[0],u=t[1],d=t[2],f=Math.sqrt(n*n+s*s+a*a)*Math.sqrt(c*c+u*u+d*d),p=f&&db(e,t)/f;return Math.acos(Math.min(Math.max(p,-1),1))},Ae.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},Ae.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},Ae.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},Ae.equals=function(e,t){var n=e[0],s=e[1],a=e[2],c=t[0],u=t[1],d=t[2];return Math.abs(n-c)<=Ma.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-u)<=Ma.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(a-d)<=Ma.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},Ae.forEach=Ae.sqrLen=Ae.len=Ae.sqrDist=Ae.dist=Ae.div=Ae.mul=Ae.sub=void 0;var Ma=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==yy(e)&&"function"!=typeof e)return{default:e};var n=cb(void 0);if(n&&n.has(e))return n.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var u=a?Object.getOwnPropertyDescriptor(e,c):null;u&&(u.get||u.set)?Object.defineProperty(s,c,u):s[c]=e[c]}return s.default=e,n&&n.set(e,s),s}(_i);function cb(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(cb=function(s){return s?n:t})(e)}function kd(){var e=new Ma.ARRAY_TYPE(3);return Ma.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function vy(e){return Math.hypot(e[0],e[1],e[2])}function ub(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function xy(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function yT(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function by(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function vT(e,t){var n=t[0]-e[0],s=t[1]-e[1],a=t[2]-e[2];return n*n+s*s+a*a}function hb(e){var t=e[0],n=e[1],s=e[2];return t*t+n*n+s*s}function db(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Ae.sub=ub,Ae.mul=xy,Ae.div=yT,Ae.dist=by,Ae.sqrDist=vT,Ae.len=vy,Ae.sqrLen=hb;var fs,aR=(fs=kd(),function(e,t,n,s,a,c){var u,d;for(t||(t=3),n||(n=0),d=s?Math.min(s*t+n,e.length):e.length,u=n;u<d;u+=t)fs[0]=e[u],fs[1]=e[u+1],fs[2]=e[u+2],a(fs,fs,c),e[u]=fs[0],e[u+1]=fs[1],e[u+2]=fs[2];return e});Ae.forEach=aR;var qe={};function Ld(e){return(Ld="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(qe,"__esModule",{value:!0}),qe.create=bT,qe.clone=function(e){var t=new ps.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},qe.fromValues=function(e,t,n,s){var a=new ps.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=s,a},qe.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},qe.set=function(e,t,n,s,a){return e[0]=t,e[1]=n,e[2]=s,e[3]=a,e},qe.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},qe.subtract=wT,qe.multiply=ET,qe.divide=fb,qe.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},qe.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},qe.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},qe.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},qe.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},qe.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},qe.scaleAndAdd=function(e,t,n,s){return e[0]=t[0]+n[0]*s,e[1]=t[1]+n[1]*s,e[2]=t[2]+n[2]*s,e[3]=t[3]+n[3]*s,e},qe.distance=Fd,qe.squaredDistance=Nd,qe.length=wy,qe.squaredLength=Ey,qe.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},qe.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},qe.normalize=function(e,t){var n=t[0],s=t[1],a=t[2],c=t[3],u=n*n+s*s+a*a+c*c;return u>0&&(u=1/Math.sqrt(u)),e[0]=n*u,e[1]=s*u,e[2]=a*u,e[3]=c*u,e},qe.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},qe.cross=function(e,t,n,s){var a=n[0]*s[1]-n[1]*s[0],c=n[0]*s[2]-n[2]*s[0],u=n[0]*s[3]-n[3]*s[0],d=n[1]*s[2]-n[2]*s[1],f=n[1]*s[3]-n[3]*s[1],p=n[2]*s[3]-n[3]*s[2],g=t[0],_=t[1],v=t[2],x=t[3];return e[0]=_*p-v*f+x*d,e[1]=-g*p+v*u-x*c,e[2]=g*f-_*u+x*a,e[3]=-g*d+_*c-v*a,e},qe.lerp=function(e,t,n,s){var a=t[0],c=t[1],u=t[2],d=t[3];return e[0]=a+s*(n[0]-a),e[1]=c+s*(n[1]-c),e[2]=u+s*(n[2]-u),e[3]=d+s*(n[3]-d),e},qe.random=function(e,t){var n,s,a,c,u,d;t=t||1;do{u=(n=2*ps.RANDOM()-1)*n+(s=2*ps.RANDOM()-1)*s}while(u>=1);do{d=(a=2*ps.RANDOM()-1)*a+(c=2*ps.RANDOM()-1)*c}while(d>=1);var f=Math.sqrt((1-u)/d);return e[0]=t*n,e[1]=t*s,e[2]=t*a*f,e[3]=t*c*f,e},qe.transformMat4=function(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3];return e[0]=n[0]*s+n[4]*a+n[8]*c+n[12]*u,e[1]=n[1]*s+n[5]*a+n[9]*c+n[13]*u,e[2]=n[2]*s+n[6]*a+n[10]*c+n[14]*u,e[3]=n[3]*s+n[7]*a+n[11]*c+n[15]*u,e},qe.transformQuat=function(e,t,n){var s=t[0],a=t[1],c=t[2],u=n[0],d=n[1],f=n[2],p=n[3],g=p*s+d*c-f*a,_=p*a+f*s-u*c,v=p*c+u*a-d*s,x=-u*s-d*a-f*c;return e[0]=g*p+x*-u+_*-f-v*-d,e[1]=_*p+x*-d+v*-u-g*-f,e[2]=v*p+x*-f+g*-d-_*-u,e[3]=t[3],e},qe.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},qe.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},qe.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},qe.equals=function(e,t){var n=e[0],s=e[1],a=e[2],c=e[3],u=t[0],d=t[1],f=t[2],p=t[3];return Math.abs(n-u)<=ps.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-d)<=ps.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-f)<=ps.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(c-p)<=ps.EPSILON*Math.max(1,Math.abs(c),Math.abs(p))},qe.forEach=qe.sqrLen=qe.len=qe.sqrDist=qe.dist=qe.div=qe.mul=qe.sub=void 0;var ps=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Ld(e)&&"function"!=typeof e)return{default:e};var n=xT(void 0);if(n&&n.has(e))return n.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var u=a?Object.getOwnPropertyDescriptor(e,c):null;u&&(u.get||u.set)?Object.defineProperty(s,c,u):s[c]=e[c]}return s.default=e,n&&n.set(e,s),s}(_i);function xT(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(xT=function(s){return s?n:t})(e)}function bT(){var e=new ps.ARRAY_TYPE(4);return ps.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function wT(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function ET(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function fb(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function Fd(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function Nd(e,t){var n=t[0]-e[0],s=t[1]-e[1],a=t[2]-e[2],c=t[3]-e[3];return n*n+s*s+a*a+c*c}function wy(e){return Math.hypot(e[0],e[1],e[2],e[3])}function Ey(e){var t=e[0],n=e[1],s=e[2],a=e[3];return t*t+n*n+s*s+a*a}qe.sub=wT,qe.mul=ET,qe.div=fb,qe.dist=Fd,qe.sqrDist=Nd,qe.len=wy,qe.sqrLen=Ey;var pb=function(){var e=bT();return function(t,n,s,a,c,u){var d,f;for(n||(n=4),s||(s=0),f=a?Math.min(a*n+s,t.length):t.length,d=s;d<f;d+=n)e[0]=t[d],e[1]=t[d+1],e[2]=t[d+2],e[3]=t[d+3],c(e,e,u),t[d]=e[0],t[d+1]=e[1],t[d+2]=e[2],t[d+3]=e[3];return t}}();function pl(e){return(pl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}qe.forEach=pb,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.create=Cy,Ce.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},Ce.setAxisAngle=gb,Ce.getAxisAngle=function(e,t){var n=2*Math.acos(t[3]),s=Math.sin(n/2);return s>ml.EPSILON?(e[0]=t[0]/s,e[1]=t[1]/s,e[2]=t[2]/s):(e[0]=1,e[1]=0,e[2]=0),n},Ce.getAngle=function(e,t){var n=vb(e,t);return Math.acos(2*n*n-1)},Ce.multiply=Dy,Ce.rotateX=function(e,t,n){n*=.5;var s=t[0],a=t[1],c=t[2],u=t[3],d=Math.sin(n),f=Math.cos(n);return e[0]=s*f+u*d,e[1]=a*f+c*d,e[2]=c*f-a*d,e[3]=u*f-s*d,e},Ce.rotateY=function(e,t,n){n*=.5;var s=t[0],a=t[1],c=t[2],u=t[3],d=Math.sin(n),f=Math.cos(n);return e[0]=s*f-c*d,e[1]=a*f+u*d,e[2]=c*f+s*d,e[3]=u*f-a*d,e},Ce.rotateZ=function(e,t,n){n*=.5;var s=t[0],a=t[1],c=t[2],u=t[3],d=Math.sin(n),f=Math.cos(n);return e[0]=s*f+a*d,e[1]=a*f-s*d,e[2]=c*f+u*d,e[3]=u*f-c*d,e},Ce.calculateW=function(e,t){var n=t[0],s=t[1],a=t[2];return e[0]=n,e[1]=s,e[2]=a,e[3]=Math.sqrt(Math.abs(1-n*n-s*s-a*a)),e},Ce.exp=sm,Ce.ln=_b,Ce.pow=function(e,t,n){return _b(e,t),My(e,e,n),sm(e,e),e},Ce.slerp=am,Ce.random=function(e){var t=ml.RANDOM(),n=ml.RANDOM(),s=ml.RANDOM(),a=Math.sqrt(1-t),c=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*n),e[1]=a*Math.cos(2*Math.PI*n),e[2]=c*Math.sin(2*Math.PI*s),e[3]=c*Math.cos(2*Math.PI*s),e},Ce.invert=function(e,t){var n=t[0],s=t[1],a=t[2],c=t[3],u=n*n+s*s+a*a+c*c,d=u?1/u:0;return e[0]=-n*d,e[1]=-s*d,e[2]=-a*d,e[3]=c*d,e},Ce.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},Ce.fromMat3=yb,Ce.fromEuler=function(e,t,n,s){var a=.5*Math.PI/180;t*=a,n*=a,s*=a;var c=Math.sin(t),u=Math.cos(t),d=Math.sin(n),f=Math.cos(n),p=Math.sin(s),g=Math.cos(s);return e[0]=c*f*g-u*d*p,e[1]=u*d*g+c*f*p,e[2]=u*f*p-c*d*g,e[3]=u*f*g+c*d*p,e},Ce.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Ce.setAxes=Ce.sqlerp=Ce.rotationTo=Ce.equals=Ce.exactEquals=Ce.normalize=Ce.sqrLen=Ce.squaredLength=Ce.len=Ce.length=Ce.lerp=Ce.dot=Ce.scale=Ce.mul=Ce.add=Ce.set=Ce.copy=Ce.fromValues=Ce.clone=void 0;var ml=om(_i),mb=om(vn),$o=om(Ae),Ir=om(qe);function Ta(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Ta=function(s){return s?n:t})(e)}function om(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==pl(e)&&"function"!=typeof e)return{default:e};var n=Ta(t);if(n&&n.has(e))return n.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var u=a?Object.getOwnPropertyDescriptor(e,c):null;u&&(u.get||u.set)?Object.defineProperty(s,c,u):s[c]=e[c]}return s.default=e,n&&n.set(e,s),s}function Cy(){var e=new ml.ARRAY_TYPE(4);return ml.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function gb(e,t,n){n*=.5;var s=Math.sin(n);return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=Math.cos(n),e}function Dy(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3],d=n[0],f=n[1],p=n[2],g=n[3];return e[0]=s*g+u*d+a*p-c*f,e[1]=a*g+u*f+c*d-s*p,e[2]=c*g+u*p+s*f-a*d,e[3]=u*g-s*d-a*f-c*p,e}function sm(e,t){var n=t[0],s=t[1],a=t[2],c=t[3],u=Math.sqrt(n*n+s*s+a*a),d=Math.exp(c),f=u>0?d*Math.sin(u)/u:0;return e[0]=n*f,e[1]=s*f,e[2]=a*f,e[3]=d*Math.cos(u),e}function _b(e,t){var n=t[0],s=t[1],a=t[2],c=t[3],u=Math.sqrt(n*n+s*s+a*a),d=u>0?Math.atan2(u,c)/u:0;return e[0]=n*d,e[1]=s*d,e[2]=a*d,e[3]=.5*Math.log(n*n+s*s+a*a+c*c),e}function am(e,t,n,s){var a,c,u,d,f,p=t[0],g=t[1],_=t[2],v=t[3],x=n[0],b=n[1],E=n[2],C=n[3];return(c=p*x+g*b+_*E+v*C)<0&&(c=-c,x=-x,b=-b,E=-E,C=-C),1-c>ml.EPSILON?(a=Math.acos(c),u=Math.sin(a),d=Math.sin((1-s)*a)/u,f=Math.sin(s*a)/u):(d=1-s,f=s),e[0]=d*p+f*x,e[1]=d*g+f*b,e[2]=d*_+f*E,e[3]=d*v+f*C,e}function yb(e,t){var n,s=t[0]+t[4]+t[8];if(s>0)n=Math.sqrt(s+1),e[3]=.5*n,e[0]=(t[5]-t[7])*(n=.5/n),e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var c=(a+1)%3,u=(a+2)%3;n=Math.sqrt(t[3*a+a]-t[3*c+c]-t[3*u+u]+1),e[a]=.5*n,e[3]=(t[3*c+u]-t[3*u+c])*(n=.5/n),e[c]=(t[3*c+a]+t[3*a+c])*n,e[u]=(t[3*u+a]+t[3*a+u])*n}return e}Ce.clone=Ir.clone,Ce.fromValues=Ir.fromValues,Ce.copy=Ir.copy,Ce.set=Ir.set,Ce.add=Ir.add,Ce.mul=Dy;var My=Ir.scale;Ce.scale=My;var vb=Ir.dot;Ce.dot=vb,Ce.lerp=Ir.lerp;var xb=Ir.length;Ce.length=xb,Ce.len=xb;var $r=Ir.squaredLength;Ce.squaredLength=$r,Ce.sqrLen=$r;var zd=Ir.normalize;Ce.normalize=zd,Ce.exactEquals=Ir.exactEquals,Ce.equals=Ir.equals;var Ho,lm,xr,Bd=(Ho=$o.create(),lm=$o.fromValues(1,0,0),xr=$o.fromValues(0,1,0),function(e,t,n){var s=$o.dot(t,n);return s<-.999999?($o.cross(Ho,lm,t),$o.len(Ho)<1e-6&&$o.cross(Ho,xr,t),$o.normalize(Ho,Ho),gb(e,Ho,Math.PI),e):s>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):($o.cross(Ho,t,n),e[0]=Ho[0],e[1]=Ho[1],e[2]=Ho[2],e[3]=1+s,zd(e,e))});Ce.rotationTo=Bd;var cm,um,CT=(cm=Cy(),um=Cy(),function(e,t,n,s,a,c){return am(cm,t,a,c),am(um,n,s,c),am(e,cm,um,2*c*(1-c)),e});Ce.sqlerp=CT;var Go,DT=(Go=mb.create(),function(e,t,n,s){return Go[0]=n[0],Go[3]=n[1],Go[6]=n[2],Go[1]=s[0],Go[4]=s[1],Go[7]=s[2],Go[2]=-t[0],Go[5]=-t[1],Go[8]=-t[2],zd(e,yb(e,Go))});Ce.setAxes=DT;var Ze={};function Ty(e){return(Ty="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.create=function(){var e=new Ar.ARRAY_TYPE(8);return Ar.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},Ze.clone=function(e){var t=new Ar.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},Ze.fromValues=function(e,t,n,s,a,c,u,d){var f=new Ar.ARRAY_TYPE(8);return f[0]=e,f[1]=t,f[2]=n,f[3]=s,f[4]=a,f[5]=c,f[6]=u,f[7]=d,f},Ze.fromRotationTranslationValues=function(e,t,n,s,a,c,u){var d=new Ar.ARRAY_TYPE(8);d[0]=e,d[1]=t,d[2]=n,d[3]=s;var f=.5*a,p=.5*c,g=.5*u;return d[4]=f*s+p*n-g*t,d[5]=p*s+g*e-f*n,d[6]=g*s+f*t-p*e,d[7]=-f*e-p*t-g*n,d},Ze.fromRotationTranslation=wb,Ze.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},Ze.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Ze.fromMat4=function(e,t){var n=Sa.create();bb.getRotation(n,t);var s=new Ar.ARRAY_TYPE(3);return bb.getTranslation(s,t),wb(e,n,s),e},Ze.copy=Zu,Ze.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Ze.set=function(e,t,n,s,a,c,u,d,f){return e[0]=t,e[1]=n,e[2]=s,e[3]=a,e[4]=c,e[5]=u,e[6]=d,e[7]=f,e},Ze.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},Ze.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},Ze.getTranslation=function(e,t){var n=t[4],s=t[5],a=t[6],c=t[7],u=-t[0],d=-t[1],f=-t[2],p=t[3];return e[0]=2*(n*p+c*u+s*f-a*d),e[1]=2*(s*p+c*d+a*u-n*f),e[2]=2*(a*p+c*f+n*d-s*u),e},Ze.translate=function(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3],d=.5*n[0],f=.5*n[1],p=.5*n[2],g=t[4],_=t[5],v=t[6],x=t[7];return e[0]=s,e[1]=a,e[2]=c,e[3]=u,e[4]=u*d+a*p-c*f+g,e[5]=u*f+c*d-s*p+_,e[6]=u*p+s*f-a*d+v,e[7]=-s*d-a*f-c*p+x,e},Ze.rotateX=function(e,t,n){var s=-t[0],a=-t[1],c=-t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=d*u+g*s+f*c-p*a,v=f*u+g*a+p*s-d*c,x=p*u+g*c+d*a-f*s,b=g*u-d*s-f*a-p*c;return Sa.rotateX(e,t,n),e[4]=_*(u=e[3])+b*(s=e[0])+v*(c=e[2])-x*(a=e[1]),e[5]=v*u+b*a+x*s-_*c,e[6]=x*u+b*c+_*a-v*s,e[7]=b*u-_*s-v*a-x*c,e},Ze.rotateY=function(e,t,n){var s=-t[0],a=-t[1],c=-t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=d*u+g*s+f*c-p*a,v=f*u+g*a+p*s-d*c,x=p*u+g*c+d*a-f*s,b=g*u-d*s-f*a-p*c;return Sa.rotateY(e,t,n),e[4]=_*(u=e[3])+b*(s=e[0])+v*(c=e[2])-x*(a=e[1]),e[5]=v*u+b*a+x*s-_*c,e[6]=x*u+b*c+_*a-v*s,e[7]=b*u-_*s-v*a-x*c,e},Ze.rotateZ=function(e,t,n){var s=-t[0],a=-t[1],c=-t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=d*u+g*s+f*c-p*a,v=f*u+g*a+p*s-d*c,x=p*u+g*c+d*a-f*s,b=g*u-d*s-f*a-p*c;return Sa.rotateZ(e,t,n),e[4]=_*(u=e[3])+b*(s=e[0])+v*(c=e[2])-x*(a=e[1]),e[5]=v*u+b*a+x*s-_*c,e[6]=x*u+b*c+_*a-v*s,e[7]=b*u-_*s-v*a-x*c,e},Ze.rotateByQuatAppend=function(e,t,n){var s=n[0],a=n[1],c=n[2],u=n[3],d=t[0],f=t[1],p=t[2],g=t[3];return e[0]=d*u+g*s+f*c-p*a,e[1]=f*u+g*a+p*s-d*c,e[2]=p*u+g*c+d*a-f*s,e[3]=g*u-d*s-f*a-p*c,e[4]=(d=t[4])*u+(g=t[7])*s+(f=t[5])*c-(p=t[6])*a,e[5]=f*u+g*a+p*s-d*c,e[6]=p*u+g*c+d*a-f*s,e[7]=g*u-d*s-f*a-p*c,e},Ze.rotateByQuatPrepend=function(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3],d=n[0],f=n[1],p=n[2],g=n[3];return e[0]=s*g+u*d+a*p-c*f,e[1]=a*g+u*f+c*d-s*p,e[2]=c*g+u*p+s*f-a*d,e[3]=u*g-s*d-a*f-c*p,e[4]=s*(g=n[7])+u*(d=n[4])+a*(p=n[6])-c*(f=n[5]),e[5]=a*g+u*f+c*d-s*p,e[6]=c*g+u*p+s*f-a*d,e[7]=u*g-s*d-a*f-c*p,e},Ze.rotateAroundAxis=function(e,t,n,s){if(Math.abs(s)<Ar.EPSILON)return Zu(e,t);var a=Math.hypot(n[0],n[1],n[2]);s*=.5;var c=Math.sin(s),u=c*n[0]/a,d=c*n[1]/a,f=c*n[2]/a,p=Math.cos(s),g=t[0],_=t[1],v=t[2],x=t[3];e[0]=g*p+x*u+_*f-v*d,e[1]=_*p+x*d+v*u-g*f,e[2]=v*p+x*f+g*d-_*u,e[3]=x*p-g*u-_*d-v*f;var b=t[4],E=t[5],C=t[6],M=t[7];return e[4]=b*p+M*u+E*f-C*d,e[5]=E*p+M*d+C*u-b*f,e[6]=C*p+M*f+b*d-E*u,e[7]=M*p-b*u-E*d-C*f,e},Ze.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e},Ze.multiply=Eb,Ze.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e},Ze.lerp=function(e,t,n,s){var a=1-s;return Cb(t,n)<0&&(s=-s),e[0]=t[0]*a+n[0]*s,e[1]=t[1]*a+n[1]*s,e[2]=t[2]*a+n[2]*s,e[3]=t[3]*a+n[3]*s,e[4]=t[4]*a+n[4]*s,e[5]=t[5]*a+n[5]*s,e[6]=t[6]*a+n[6]*s,e[7]=t[7]*a+n[7]*s,e},Ze.invert=function(e,t){var n=Vd(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e},Ze.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},Ze.normalize=function(e,t){var n=Vd(t);if(n>0){n=Math.sqrt(n);var s=t[0]/n,a=t[1]/n,c=t[2]/n,u=t[3]/n,d=t[4],f=t[5],p=t[6],g=t[7],_=s*d+a*f+c*p+u*g;e[0]=s,e[1]=a,e[2]=c,e[3]=u,e[4]=(d-s*_)/n,e[5]=(f-a*_)/n,e[6]=(p-c*_)/n,e[7]=(g-u*_)/n}return e},Ze.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},Ze.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},Ze.equals=function(e,t){var n=e[0],s=e[1],a=e[2],c=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=t[0],_=t[1],v=t[2],x=t[3],b=t[4],E=t[5],C=t[6],M=t[7];return Math.abs(n-g)<=Ar.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(s-_)<=Ar.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(a-v)<=Ar.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(c-x)<=Ar.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(u-b)<=Ar.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-E)<=Ar.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(f-C)<=Ar.EPSILON*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(p-M)<=Ar.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))},Ze.sqrLen=Ze.squaredLength=Ze.len=Ze.length=Ze.dot=Ze.mul=Ze.setReal=Ze.getReal=void 0;var Ar=jd(_i),Sa=jd(Ce),bb=jd(Te);function hm(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(hm=function(s){return s?n:t})(e)}function jd(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==Ty(e)&&"function"!=typeof e)return{default:e};var n=hm(t);if(n&&n.has(e))return n.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var u=a?Object.getOwnPropertyDescriptor(e,c):null;u&&(u.get||u.set)?Object.defineProperty(s,c,u):s[c]=e[c]}return s.default=e,n&&n.set(e,s),s}function wb(e,t,n){var s=.5*n[0],a=.5*n[1],c=.5*n[2],u=t[0],d=t[1],f=t[2],p=t[3];return e[0]=u,e[1]=d,e[2]=f,e[3]=p,e[4]=s*p+a*f-c*d,e[5]=a*p+c*u-s*f,e[6]=c*p+s*d-a*u,e[7]=-s*u-a*d-c*f,e}function Zu(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Eb(e,t,n){var s=t[0],a=t[1],c=t[2],u=t[3],d=n[4],f=n[5],p=n[6],g=n[7],_=t[4],v=t[5],x=t[6],b=t[7],E=n[0],C=n[1],M=n[2],T=n[3];return e[0]=s*T+u*E+a*M-c*C,e[1]=a*T+u*C+c*E-s*M,e[2]=c*T+u*M+s*C-a*E,e[3]=u*T-s*E-a*C-c*M,e[4]=s*g+u*d+a*p-c*f+_*T+b*E+v*M-x*C,e[5]=a*g+u*f+c*d-s*p+v*T+b*C+x*E-_*M,e[6]=c*g+u*p+s*f-a*d+x*T+b*M+_*C-v*E,e[7]=u*g-s*d-a*f-c*p+b*T-_*E-v*C-x*M,e}Ze.getReal=Sa.copy,Ze.setReal=Sa.copy,Ze.mul=Eb;var Cb=Sa.dot;Ze.dot=Cb;var Sy=Sa.length;Ze.length=Sy,Ze.len=Sy;var Vd=Sa.squaredLength;Ze.squaredLength=Vd,Ze.sqrLen=Vd;var Oe={};function gl(e){return(gl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.create=dm,Oe.clone=function(e){var t=new Hs.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},Oe.fromValues=function(e,t){var n=new Hs.ARRAY_TYPE(2);return n[0]=e,n[1]=t,n},Oe.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},Oe.set=function(e,t,n){return e[0]=t,e[1]=n,e},Oe.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},Oe.subtract=Ud,Oe.multiply=Db,Oe.divide=Mb,Oe.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},Oe.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},Oe.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},Oe.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},Oe.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},Oe.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},Oe.scaleAndAdd=function(e,t,n,s){return e[0]=t[0]+n[0]*s,e[1]=t[1]+n[1]*s,e},Oe.distance=Tb,Oe.squaredDistance=Sb,Oe.length=Ib,Oe.squaredLength=Ab,Oe.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},Oe.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},Oe.normalize=function(e,t){var n=t[0],s=t[1],a=n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e},Oe.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},Oe.cross=function(e,t,n){var s=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=s,e},Oe.lerp=function(e,t,n,s){var a=t[0],c=t[1];return e[0]=a+s*(n[0]-a),e[1]=c+s*(n[1]-c),e},Oe.random=function(e,t){t=t||1;var n=2*Hs.RANDOM()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},Oe.transformMat2=function(e,t,n){var s=t[0],a=t[1];return e[0]=n[0]*s+n[2]*a,e[1]=n[1]*s+n[3]*a,e},Oe.transformMat2d=function(e,t,n){var s=t[0],a=t[1];return e[0]=n[0]*s+n[2]*a+n[4],e[1]=n[1]*s+n[3]*a+n[5],e},Oe.transformMat3=function(e,t,n){var s=t[0],a=t[1];return e[0]=n[0]*s+n[3]*a+n[6],e[1]=n[1]*s+n[4]*a+n[7],e},Oe.transformMat4=function(e,t,n){var s=t[0],a=t[1];return e[0]=n[0]*s+n[4]*a+n[12],e[1]=n[1]*s+n[5]*a+n[13],e},Oe.rotate=function(e,t,n,s){var a=t[0]-n[0],c=t[1]-n[1],u=Math.sin(s),d=Math.cos(s);return e[0]=a*d-c*u+n[0],e[1]=a*u+c*d+n[1],e},Oe.angle=function(e,t){var n=e[0],s=e[1],a=t[0],c=t[1],u=Math.sqrt(n*n+s*s)*Math.sqrt(a*a+c*c);return Math.acos(Math.min(Math.max(u&&(n*a+s*c)/u,-1),1))},Oe.zero=function(e){return e[0]=0,e[1]=0,e},Oe.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},Oe.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Oe.equals=function(e,t){var n=e[0],s=e[1],a=t[0],c=t[1];return Math.abs(n-a)<=Hs.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(s-c)<=Hs.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},Oe.forEach=Oe.sqrLen=Oe.sqrDist=Oe.dist=Oe.div=Oe.mul=Oe.sub=Oe.len=void 0;var Hs=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==gl(e)&&"function"!=typeof e)return{default:e};var n=Iy(void 0);if(n&&n.has(e))return n.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var u=a?Object.getOwnPropertyDescriptor(e,c):null;u&&(u.get||u.set)?Object.defineProperty(s,c,u):s[c]=e[c]}return s.default=e,n&&n.set(e,s),s}(_i);function Iy(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Iy=function(s){return s?n:t})(e)}function dm(){var e=new Hs.ARRAY_TYPE(2);return Hs.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function Ud(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function Db(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function Mb(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function Tb(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function Sb(e,t){var n=t[0]-e[0],s=t[1]-e[1];return n*n+s*s}function Ib(e){return Math.hypot(e[0],e[1])}function Ab(e){var t=e[0],n=e[1];return t*t+n*n}Oe.len=Ib,Oe.sub=Ud,Oe.mul=Db,Oe.div=Mb,Oe.dist=Tb,Oe.sqrDist=Sb,Oe.sqrLen=Ab;var Rb=function(){var e=dm();return function(t,n,s,a,c,u){var d,f;for(n||(n=2),s||(s=0),f=a?Math.min(a*n+s,t.length):t.length,d=s;d<f;d+=n)e[0]=t[d],e[1]=t[d+1],c(e,e,u),t[d]=e[0],t[d+1]=e[1];return t}}();function Wu(e){return(Wu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Oe.forEach=Rb,Object.defineProperty(bi,"__esModule",{value:!0});var mn=bi.vec4=G=bi.vec3=bi.vec2=bi.quat2=ur=bi.quat=it=bi.mat4=$i=bi.mat3=bi.mat2d=Yu=bi.mat2=bi.glMatrix=void 0,Ay=ms(_i);bi.glMatrix=Ay;var MT=ms(fn),Yu=bi.mat2=MT,Ry=ms(Jn);bi.mat2d=Ry;var Pb=ms(vn),$i=bi.mat3=Pb,Ob=ms(Te),it=bi.mat4=Ob,TT=ms(Ce),ur=bi.quat=TT,fm=ms(Ze);bi.quat2=fm;var ST=ms(Oe);bi.vec2=ST;var kb=ms(Ae),G=bi.vec3=kb,Lb=ms(qe);function pm(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(pm=function(s){return s?n:t})(e)}function ms(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==Wu(e)&&"function"!=typeof e)return{default:e};var n=pm(t);if(n&&n.has(e))return n.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var u=a?Object.getOwnPropertyDescriptor(e,c):null;u&&(u.get||u.set)?Object.defineProperty(s,c,u):s[c]=e[c]}return s.default=e,n&&n.set(e,s),s}mn=bi.vec4=Lb;const mm=dn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:_l}=mm,Py=dn([{name:"a_pos_3",components:3,type:"Int16"}]);var Gs=dn([{name:"a_pos",type:"Int16",components:2}]),$d={};!function(n){function s(c,u,d){var f=a(256*c,256*(u=Math.pow(2,d)-u-1),d),p=a(256*(c+1),256*(u+1),d);return f[0]+","+f[1]+","+p[0]+","+p[1]}function a(c,u,d){var f=2*Math.PI*6378137/256/Math.pow(2,d);return[c*f-2*Math.PI*6378137/2,u*f-2*Math.PI*6378137/2]}n.getURL=function(c,u,d,f,p,g){return g=g||{},c+"?"+["bbox="+s(d,f,p),"format="+(g.format||"image/png"),"service="+(g.service||"WMS"),"version="+(g.version||"1.1.1"),"request="+(g.request||"GetMap"),"srs="+(g.srs||"EPSG:3857"),"width="+(g.width||256),"height="+(g.height||256),"layers="+u].join("&")},n.getTileBBox=s,n.getMercCoords=a,Object.defineProperty(n,"__esModule",{value:!0})}($d);var Fb=$d;class oo{constructor(t,n,s){this.z=t,this.x=n,this.y=s,this.key=Xu(0,t,t,n,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n){const s=Fb.getTileBBox(this.x,this.y,this.z),a=function(c,u,d){let f,p="";for(let g=c;g>0;g--)f=1<<g-1,p+=(u&f?1:0)+(d&f?2:0);return p}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Tc{constructor(t,n){this.wrap=t,this.canonical=n,this.key=Xu(t,n.z,n.z,n.x,n.y)}}class nn{constructor(t,n,s,a,c){this.overscaledZ=t,this.wrap=n,this.canonical=new oo(s,+a,+c),this.key=0===n&&t===s?this.canonical.key:Xu(n,t,s,a,c)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const n=this.canonical.z-t;return t>this.canonical.z?new nn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new nn(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n=!0){if(this.overscaledZ===t&&n)return this.key;if(t>this.canonical.z)return Xu(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-t;return Xu(this.wrap*+n,t,t,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new nn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,a=2*this.canonical.y;return[new nn(n,this.wrap,n,s,a),new nn(n,this.wrap,n,s+1,a),new nn(n,this.wrap,n,s,a+1),new nn(n,this.wrap,n,s+1,a+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new nn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new nn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Tc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Xu(e,t,n,s,a){const c=1<<Math.min(n,22);let u=c*(a%c)+s%c;return e&&n<22&&(u+=c*c*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*u+n)+(t-n)}const Nb=[e=>{let t=e.canonical.x-1,n=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,n--),new nn(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,n=e.wrap;return t===1<<e.canonical.z&&(t=0,n++),new nn(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>new nn(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new nn(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];Xt(oo,"CanonicalTileID"),Xt(nn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class gm{constructor(t,n){this.pos=t,this.dir=n}intersectsPlane(t,n,s){const a=G.dot(n,this.dir);if(Math.abs(a)<1e-6)return!1;const c=((t[0]-this.pos[0])*n[0]+(t[1]-this.pos[1])*n[1]+(t[2]-this.pos[2])*n[2])/a;return s[0]=this.pos[0]+this.dir[0]*c,s[1]=this.pos[1]+this.dir[1]*c,s[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(t,n,s){if(G.equals(this.pos,t)||0===n)return s[0]=s[1]=s[2]=0,!1;const[a,c,u]=this.dir,d=this.pos[0]-t[0],f=this.pos[1]-t[1],p=this.pos[2]-t[2],g=a*a+c*c+u*u,_=2*(d*a+f*c+p*u),v=_*_-4*g*(d*d+f*f+p*p-n*n);if(v<0){const x=Math.max(-_/2,0),b=d+a*x,E=f+c*x,C=p+u*x,M=Math.hypot(b,E,C);return s[0]=b*n/M,s[1]=E*n/M,s[2]=C*n/M,!1}{const x=(-_-Math.sqrt(v))/(2*g);if(x<0){const b=Math.hypot(d,f,p);return s[0]=d*n/b,s[1]=f*n/b,s[2]=p*n/b,!1}return s[0]=d+a*x,s[1]=f+c*x,s[2]=p+u*x,!0}}}class Oy{constructor(t,n,s,a,c){this.TL=t,this.TR=n,this.BR=s,this.BL=a,this.horizon=c}static fromInvProjectionMatrix(t,n,s){const a=[-1,1,1],c=[1,1,1],u=[1,-1,1],d=[-1,-1,1],f=G.transformMat4(a,a,t),p=G.transformMat4(c,c,t),g=G.transformMat4(u,u,t),_=G.transformMat4(d,d,t);return new Oy(f,p,g,_,n/s)}}function Ku(e,t,n){let s=1/0,a=-1/0;const c=[];for(const u of e){G.sub(c,u,t);const d=G.dot(c,n);s=Math.min(s,d),a=Math.max(a,d)}return[s,a]}function ky(e,t){let n=!0;for(let s=0;s<e.planes.length;s++){const a=e.planes[s];let c=0;for(let u=0;u<t.length;u++)c+=G.dot(a,t[u])+a[3]>=0;if(0===c)return 0;c!==t.length&&(n=!1)}return n?2:1}function Hd(e,t){for(const n of e.projections){const s=Ku(t,e.points[0],n.axis);if(n.projection[1]<s[0]||n.projection[0]>s[1])return 0}return 1}function _m(e,t){let n=0;const s=[0,0,0,0];for(let a=0;a<e.length;a++)s[0]=e[a][0],s[1]=e[a][1],s[2]=e[a][2],s[3]=1,mn.dot(s,t)>=0&&n++;return n}class so{constructor(t,n){this.points=t||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=qn.fromPoints(this.points),this.projections=[],this.frustumEdges=[G.sub([],this.points[2],this.points[3]),G.sub([],this.points[0],this.points[3]),G.sub([],this.points[4],this.points[0]),G.sub([],this.points[5],this.points[1]),G.sub([],this.points[6],this.points[2]),G.sub([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const a=[0,-s[2],s[1]],c=[s[2],0,-s[0]];this.projections.push({axis:a,projection:Ku(this.points,this.points[0],a)}),this.projections.push({axis:c,projection:Ku(this.points,this.points[0],c)})}}static fromInvProjectionMatrix(t,n,s,a){const c=Math.pow(2,s),u=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(p=>{const g=mn.transformMat4([],p,t),_=1/g[3]/n*c;return mn.mul(g,g,[_,_,a?1/g[3]:_,_])}),d=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(p=>{const g=G.sub([],u[p[0]],u[p[1]]),_=G.sub([],u[p[2]],u[p[1]]),v=G.normalize([],G.cross([],g,_)),x=-G.dot(v,u[p[1]]);return v.concat(x)}),f=[];for(let p=0;p<u.length;p++)f.push([u[p][0],u[p][1],u[p][2]]);return new so(f,d)}intersectsPrecise(t,n,s){for(let a=0;a<n.length;a++)if(!_m(t,n[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!_m(t,this.planes[a]))return 0;for(const a of s)for(const c of this.frustumEdges){const u=G.cross([],a,c),d=G.length(u);if(0===d)continue;G.scale(u,u,1/d);const f=Ku(this.points,this.points[0],u),p=Ku(t,this.points[0],u);if(f[0]>p[1]||p[0]>f[1])return 0}return 1}}class qn{static fromPoints(t){const n=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const a of t)G.min(n,n,a),G.max(s,s,a);return new qn(n,s)}static fromTileIdAndHeight(t,n,s){const a=1<<t.canonical.z,c=t.canonical.x,u=t.canonical.y;return new qn([c/a,u/a,n],[(c+1)/a,(u+1)/a,s])}static applyTransform(t,n){const s=t.getCorners();for(let a=0;a<s.length;++a)G.transformMat4(s[a],s[a],n);return qn.fromPoints(s)}static projectAabbCorners(t,n){const s=t.getCorners();for(let a=0;a<s.length;++a)G.transformMat4(s[a],s[a],n);return s}constructor(t,n){this.min=t,this.max=n,this.center=G.scale([],G.add([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],s=G.clone(this.min),a=G.clone(this.max);for(let c=0;c<n.length;c++)s[c]=n[c]?this.min[c]:this.center[c],a[c]=n[c]?this.center[c]:this.max[c];return a[2]=this.max[2],new qn(s,a)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,n=this.max;return[[t[0],t[1],t[2]],[n[0],t[1],t[2]],[n[0],n[1],t[2]],[t[0],n[1],t[2]],[t[0],t[1],n[2]],[n[0],t[1],n[2]],[n[0],n[1],n[2]],[t[0],n[1],n[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?ky(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?ky(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,n){return n||this.intersects(t)?Hd(t,this.getCorners()):0}intersectsPreciseFlat(t,n){return n||this.intersectsFlat(t)?Hd(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let n=0;n<3;++n)if(this.min[n]>t.max[n]||t.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],t.min[n]),this.max[n]=Math.max(this.max[n],t.max[n])}encapsulatePoint(t){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],t[n]),this.max[n]=Math.max(this.max[n],t[n])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}Xt(qn,"Aabb");const Gd=5,Sc=6,Rr=ut/Math.PI/2,Ly=16383,yl=[64,32,16],Hr=-Rr,ao=Rr,zb=[new qn([Hr,Hr,Hr],[ao,ao,ao]),new qn([Hr,Hr,Hr],[0,0,ao]),new qn([0,Hr,Hr],[ao,0,ao]),new qn([Hr,0,Hr],[0,ao,ao]),new qn([0,0,Hr],[ao,ao,ao])];function qd(e){return e*Rr/Ic}function Fy(e,t,n,s=!0){const a=G.scale([],e._camera.position,e.worldSize),c=[t,n,1,1];mn.transformMat4(c,c,e.pixelMatrixInverse),mn.scale(c,c,1/c[3]);const u=G.sub([],c,a),d=G.normalize([],u),f=e.globeMatrix,p=[f[12],f[13],f[14]],g=G.sub([],p,a),_=G.length(g),v=G.normalize([],g),x=e.worldSize/(2*Math.PI),b=G.dot(v,d),E=Math.asin(x/_);if(E<Math.acos(b)){if(!s)return null;const V=[],U=[];G.scale(V,d,_/b),G.normalize(U,G.sub(U,V,g)),G.normalize(d,G.add(d,g,G.scale(d,U,Math.tan(E)*_)))}const C=[];new gm(a,d).closestPointOnSphere(p,x,C);const M=G.normalize([],si(f,0)),T=G.normalize([],si(f,1)),R=G.normalize([],si(f,2)),P=G.dot(M,C),I=G.dot(T,C),O=G.dot(R,C),L=ki(Math.asin(-I/x));let F=ki(Math.atan2(P,O));F=e.center.lng+function(V,U){const q=(U-V+180)%360-180;return q<-180?q+360:q}(e.center.lng,F);const N=Ri(F),B=Qt(wi(L),0,1);return new We(N,B)}class Bb{constructor(t,n,s){this.a=G.sub([],t,s),this.b=G.sub([],n,s),this.center=s;const a=G.normalize([],this.a),c=G.normalize([],this.b);this.angle=Math.acos(G.dot(a,c))}}function Ny(e,t){if(0===e.angle)return null;let n;return n=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),n<0||n>1?null:function(s,a,c,u){const d=Math.sin(c);return s*(Math.sin((1-u)*c)/d)+a*(Math.sin(u*c)/d)}(e.a[t],e.b[t],e.angle,Qt(n,0,1))+e.center[t]}function Mo(e){if(e.z<=1)return zb[e.z+2*e.y+e.x];const t=zy(vl(e));return qn.fromPoints(t)}function Ia(e,t,n){return G.scale(e,e,1-n),G.scaleAndAdd(e,e,t,n)}function jb(e,t){const n=ti(t.zoom);if(0===n)return Mo(e);const s=vl(e),a=zy(s),c=Ri(s.getWest())*t.worldSize,u=Ri(s.getEast())*t.worldSize,d=wi(s.getNorth())*t.worldSize,f=wi(s.getSouth())*t.worldSize,p=[c,d,0],g=[u,d,0],_=[c,f,0],v=[u,f,0],x=it.invert([],t.globeMatrix);return G.transformMat4(p,p,x),G.transformMat4(g,g,x),G.transformMat4(_,_,x),G.transformMat4(v,v,x),a[0]=Ia(a[0],_,n),a[1]=Ia(a[1],v,n),a[2]=Ia(a[2],g,n),a[3]=Ia(a[3],p,n),qn.fromPoints(a)}function Vb(e,t,n){for(const s of e)G.transformMat4(s,s,t),G.scale(s,s,n)}function qs(e,t,n,s){const a=t/e.worldSize,c=e.globeMatrix;if(n.z<=1){const N=Mo(n).getCorners();return Vb(N,c,a),qn.fromPoints(N)}const u=vl(n,s),d=zy(u);Vb(d,c,a);const f=Number.MAX_VALUE,p=[-f,-f,-f],g=[f,f,f];if(u.contains(e.center)){for(const V of d)G.min(g,g,V),G.max(p,p,V);p[2]=0;const N=e.point,B=[N.x*a,N.y*a,0];return G.min(g,g,B),G.max(p,p,B),new qn(g,p)}const _=[c[12]*a,c[13]*a,c[14]*a],v=u.getCenter(),x=Qt(e.center.lat,-li,li),b=Qt(v.lat,-li,li),E=Ri(e.center.lng),C=wi(x);let M=E-Ri(v.lng);const T=C-wi(b);M>.5?M-=1:M<-.5&&(M+=1);let R=0;if(Math.abs(M)>Math.abs(T))R=M>=0?1:3;else{R=T>=0?0:2;const N=[c[4]*a,c[5]*a,c[6]*a],B=-Math.sin(De(T>=0?u.getSouth():u.getNorth()))*Rr;G.scaleAndAdd(_,_,N,B)}const P=d[R],I=d[(R+1)%4],O=new Bb(P,I,_),L=[Ny(O,0)||P[0],Ny(O,1)||P[1],Ny(O,2)||P[2]],F=ti(e.zoom);if(F>0){const N=function({x:V,y:U,z:q},j,X,Q,nt){const Y=1/(1<<q);let K=V*Y,ot=K+Y,at=U*Y,lt=at+Y,dt=0;const ft=(K+ot)/2-Q;return ft>.5?dt=-1:ft<-.5&&(dt=1),K=((K+dt)*j-(Q*=j))*X+Q,ot=((ot+dt)*j-Q)*X+Q,at=(at*j-(nt*=j))*X+nt,lt=(lt*j-nt)*X+nt,[[K,lt,0],[ot,lt,0],[ot,at,0],[K,at,0]]}(n,t,e._pixelsPerMercatorPixel,E,C);for(let V=0;V<d.length;V++)Ia(d[V],N[V],F);const B=G.add([],N[R],N[(R+1)%4]);G.scale(B,B,.5),Ia(L,B,F)}for(const N of d)G.min(g,g,N),G.max(p,p,N);return g[2]=Math.min(P[2],I[2]),G.min(g,g,L),G.max(p,p,L),new qn(g,p)}function vl({x:e,y:t,z:n},s=!1){const a=1/(1<<n),c=new ve(or(e*a),t===(1<<n)-1&&s?-90:Ei((t+1)*a)),u=new ve(or((e+1)*a),0===t&&s?90:Ei(t*a));return new Ur(c,u)}function zy(e){const t=De(e.getNorth()),n=De(e.getSouth()),s=Math.cos(t),a=Math.cos(n),c=Math.sin(t),u=Math.sin(n),d=e.getWest(),f=e.getEast();return[Zd(a,u,d),Zd(a,u,f),Zd(s,c,f),Zd(s,c,d)]}function Zd(e,t,n,s=Rr){return n=De(n),[e*Math.sin(n)*s,-t*s,e*Math.cos(n)*s]}function lo(e,t,n){return Zd(Math.cos(De(e)),Math.sin(De(e)),t,n)}function ym(e,t,n,s){const a=1<<n.z,c=(e/ut+n.x)/a;return lo(Ei((t/ut+n.y)/a),or(c),s)}function By({min:e,max:t}){return Ly/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const IT=new Float64Array(16);function Aa(e){const t=By(e),n=it.fromScaling(IT,[t,t,t]);return it.translate(n,n,G.negate([],e.min))}function jy(e){const t=it.fromTranslation(IT,e.min),n=1/By(e);return it.scale(t,t,[n,n,n])}function Vy(e){const t=ut/(2*Math.PI);return e/(2*Math.PI)/t}function Ub(e,t){return ut/(512*Math.pow(2,e))*By(Mo(t))}function $b(e,t,n,s,a){const c=Vy(n),u=[e,t,-n/(2*Math.PI)],d=it.identity(new Float64Array(16));return it.translate(d,d,u),it.scale(d,d,[c,c,c]),it.rotateX(d,d,De(-a)),it.rotateY(d,d,De(-s)),d}function vm(e){const t=e.pixelsPerMeter,n=t/An(1,e.center.lat),s=it.identity(new Float64Array(16));return it.translate(s,s,[e.point.x,e.point.y,0]),it.scale(s,s,[n,n,t]),Float32Array.from(s)}function ti(e){return Ps(Gd,Sc,e)}function Ju(e,t,n){const s=it.identity(new Float64Array(16)),a=(t/(1<<e)-.5)*Math.PI*2;return it.rotateY(s,n.globeMatrix,a),Float32Array.from(s)}function Uy(e,t,n){const s=ti(n.zoom),a=e.style.map._antialias,c=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===s&&!a&&!c}function $y(e,t,n,s){const a=t.getNorth(),c=t.getSouth(),u=t.getWest(),d=t.getEast(),f=1<<e.z,p=d-u,g=a-c,_=p/64,v=-g/yl[n],x=[0,_,0,v,0,0,a,u,0];if(e.z>0){const b=180/s;$i.multiply(x,x,[b/p+1,0,0,0,b/g+1,0,-.5*b/_,.5*b/v,1])}return x[2]=f,x[5]=e.x,x[8]=e.y,x}function Hb(e){const t=li-5;e=Qt(e,-t,t)/t*90;const n=Math.pow(Math.abs(Math.sin(De(e))),3);return Math.round(n*(yl.length-1))}function AT(e){const t=[0,0,0],n=it.identity(new Float64Array(16));return it.multiply(n,e.pixelMatrix,e.globeMatrix),G.transformMat4(t,t,n),new et(t[0],t[1])}function RT(e,t){const n=lo(t.lat,t.lng),s=function(c){const u=lo(c._center.lat,c._center.lng),d=G.fromValues(0,1,0);let f=G.cross([],d,u);const p=it.fromRotation([],-c.angle,u);f=G.transformMat4(f,f,p),it.fromRotation(p,-c._pitch,f);const g=G.normalize([],u);return G.scale(g,g,qd(c.cameraToCenterDistance/c.pixelsPerMeter)),G.transformMat4(g,g,p),G.add([],u,g)}(e),a=G.subtract([],s,n);return G.angle(a,n)}function Hy(e,t){return RT(e,t)>Math.PI/2*1.01}const xm=De(85),Gy=Math.cos(xm),lR=Math.sin(xm);class cR{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,n){const s=new ro,a=new Ai,c=[],u=t+1+2,d=n[0]+1,f=n[0]+1+(1+n.length),p=(g,_,v)=>{let x=g===u-1?g-2:0===g?g:g-1;return x+=v?24575:0,[x,_]};for(let g=0;g<u;++g)s.emplaceBack(...p(g,0,!0));for(let g=0;g<d;++g)for(let _=0;_<u;++_)s.emplaceBack(...p(_,g,(0===_||_===u-1)&&!0));for(let g=0;g<n.length;++g){const _=n[g];for(let v=0;v<u;++v)s.emplaceBack(...p(v,_,!0))}for(let g=0;g<n.length;++g){const _=a.length,v=n[g]+1+2,x=new Ai;for(let C=0;C<v-1;C++){const M=C===v-2,T=M?u*(f-n.length+g-C):u;for(let R=0;R<u-1;R++){const P=C*u+R;0===C||M||0===R||R===u-2?(x.emplaceBack(P+1,P,P+T),x.emplaceBack(P+T,P+T+1,P+1)):(a.emplaceBack(P+1,P,P+T),a.emplaceBack(P+T,P+T+1,P+1))}}const b=yn.simpleSegment(0,_,s.length,a.length-_);for(let C=0;C<x.uint16.length;C+=3)a.emplaceBack(x.uint16[C],x.uint16[C+1],x.uint16[C+2]);const E=yn.simpleSegment(0,_,s.length,a.length-_);c.push({withoutSkirts:b,withSkirts:E})}return{vertices:s,indices:a,segments:c}}_createGrid(t){const n=this._fillGridMeshWithLods(64,yl);this._gridSegments=n.segments,this._gridBuffer=t.createVertexBuffer(n.vertices,Gs.members),this._gridIndexBuffer=t.createIndexBuffer(n.indices,!0)}_createPoles(t){const n=new Ai;for(let d=0;d<=64;d++)n.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=t.createIndexBuffer(n,!0);const s=new vc,a=new vc,c=new vc,u=new vc;this._poleSegments=[];for(let d=0,f=0;d<Gd;d++){const p=360/(1<<d);s.emplaceBack(0,-Rr,0,.5,0),a.emplaceBack(0,-Rr,0,.5,1),c.emplaceBack(0,-Rr,0,.5,.5),u.emplaceBack(0,-Rr,0,.5,.5);for(let g=0;g<=64;g++){let _=g/64,v=0;const x=vt(0,p,_),[b,E,C]=Zd(Gy,lR,x,Rr);s.emplaceBack(b,E,C,_,v),a.emplaceBack(b,E,C,_,1-v);const M=De(x);_=.5+.5*Math.sin(M),v=.5+.5*Math.cos(M),c.emplaceBack(b,E,C,_,v),u.emplaceBack(b,E,C,_,1-v)}this._poleSegments.push(yn.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(s,_l,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,_l,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(c,_l,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(u,_l,!1)}getGridBuffers(t,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}}const Ic=6371008.8,qy=2*Math.PI*Ic;class xl{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xl(Os(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,s=this.lat*n,a=t.lat*n,c=Math.sin(s)*Math.sin(a)+Math.cos(s)*Math.cos(a)*Math.cos((t.lng-this.lng)*n);return Ic*Math.acos(Math.min(c,1))}toBounds(t=0){const n=360*t/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new Ur(new xl(this.lng-s,this.lat-n),new xl(this.lng+s,this.lat+n))}toEcef(t){const n=qd(t);return lo(this.lat,this.lng,Rr+n)}static convert(t){if(t instanceof xl)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new xl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new xl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var ve=xl;const PT=0,Gb=25.5;function Ac(e){return qy*Math.cos(e*Math.PI/180)}function Ri(e){return(180+e)/360}function wi(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function An(e,t){return e/Ac(t)}function or(e){return 360*e-180}function Ei(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function qb(e,t){return e*Ac(Ei(t))}const li=85.051129;function Zy(e){return Math.cos(De(Qt(e,-li,li)))}function bl(e,t){const n=Qt(t,PT,Gb),s=Math.pow(2,n);return Zy(e)*qy/(512*s)}function Wy(e){return 1/Math.cos(e*Math.PI/180)}function Wd(e,t=0){const n=Math.exp(Math.PI*(1-(e.y+t/ut)/(1<<e.z)*2));return 80150034*n/(n*n+1)/ut/(1<<e.z)}class We{constructor(t,n,s=0){this.x=+t,this.y=+n,this.z=+s}static fromLngLat(t,n=0){const s=ve.convert(t);return new We(Ri(s.lng),wi(s.lat),An(n,s.lat))}toLngLat(){return new ve(or(this.x),Ei(this.y))}toAltitude(){return qb(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/qy*Wy(Ei(this.y))}}function bm(e,t,n,s,a,c,u,d,f){const p=(t+s)/2,g=(n+a)/2,_=new et(p,g);d(_),function(v,x,b,E,C,M){const T=b-C,R=E-M;return Math.abs((E-x)*T-(b-v)*R)/Math.hypot(T,R)}(_.x,_.y,c.x,c.y,u.x,u.y)>=f?(bm(e,t,n,p,g,c,_,d,f),bm(e,p,g,s,a,_,u,d,f)):e.push(u)}function OT(e,t,n){let s=e[0],a=s.x,c=s.y;t(s);const u=[s];for(let d=1;d<e.length;d++){const f=e[d],{x:p,y:g}=f;t(f),bm(u,a,c,p,g,s,f,t,n),a=p,c=g,s=f}return u}function Zb(e,t,n,s){if(s(t,n)){const a=t.add(n)._mult(.5);Zb(e,t,a,s),Zb(e,a,n,s)}else e.push(n)}function Yd(e,t){let n=e[0];const s=[n];for(let a=1;a<e.length;a++){const c=e[a];Zb(s,n,c,t),n=c}return s}const le=Math.pow(2,14)-1,th=-le-1;function Wb(e,t){const n=Math.round(e.x*t),s=Math.round(e.y*t);return e.x=Qt(n,th,le),e.y=Qt(s,th,le),(n<e.x||n>e.x+1||s<e.y||s>e.y+1)&&tt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function gs(e,t,n){const s=e.loadGeometry(),a=e.extent,c=ut/a;if(t&&n&&n.projection.isReprojectedInTileSpace){const u=1<<t.z,{scale:d,x:f,y:p,projection:g}=n,_=v=>{const x=or((t.x+v.x/a)/u),b=Ei((t.y+v.y/a)/u),E=g.project(x,b);v.x=(E.x*d-f)*a,v.y=(E.y*d-p)*a};for(let v=0;v<s.length;v++)if(1!==e.type)s[v]=OT(s[v],_,1);else{const x=[];for(const b of s[v])b.x<0||b.x>=a||b.y<0||b.y>=a||(_(b),x.push(b));s[v]=x}}for(const u of s)for(const d of u)Wb(d,c);return s}function Zs(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?gs(e):[]}}function Xd(e,t,n,s,a){e.emplaceBack(2*t+(s+1)/2,2*n+(a+1)/2)}function wm(e,t,n){e.emplaceBack(t.x,t.y,t.z,16384*n[0],16384*n[1],16384*n[2])}class Em{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new ro,this.indexArray=new Ai,this.segments=new yn,this.programConfigurations=new mi(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,s,a){const c=this.layers[0],u=[];let d=null;"circle"===c.type&&(d=c.layout.get("circle-sort-key"));for(const{feature:p,id:g,index:_,sourceLayerIndex:v}of t){const x=this.layers[0]._featureFilter.needGeometry,b=Zs(p,x);if(!this.layers[0]._featureFilter.filter(new zn(this.zoom),b,s))continue;const E=d?d.evaluate(b,{},s):void 0,C={id:g,properties:p.properties,type:p.type,sourceLayerIndex:v,index:_,geometry:x?b.geometry:gs(p,s,a),patterns:{},sortKey:E};u.push(C)}d&&u.sort((p,g)=>p.sortKey-g.sortKey);let f=null;"globe"===a.projection.name&&(this.globeExtVertexArray=new _c,f=a.projection);for(const p of u){const{geometry:g,index:_,sourceLayerIndex:v}=p,x=t[_].feature;this.addFeature(p,g,_,n.availableImages,s,f,n.brightness),n.featureIndex.insert(x,g,_,v,this.index)}}update(t,n,s,a,c){const u=0!==Object.keys(t).length;u&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,n,u?this.stateDependentLayers:this.layers,s,a,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cT.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Y1.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,n,s,a,c,u,d){for(const f of n)for(const p of f){const g=p.x,_=p.y;if(g<0||g>=ut||_<0||_>=ut)continue;if(u){const b=u.projectTilePoint(g,_,c),E=u.upVector(c,g,_),C=this.globeExtVertexArray;wm(C,b,E),wm(C,b,E),wm(C,b,E),wm(C,b,E)}const v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),x=v.vertexLength;Xd(this.layoutVertexArray,g,_,-1,-1),Xd(this.layoutVertexArray,g,_,1,-1),Xd(this.layoutVertexArray,g,_,1,1),Xd(this.layoutVertexArray,g,_,-1,1),this.indexArray.emplaceBack(x,x+1,x+2),this.indexArray.emplaceBack(x,x+2,x+3),v.vertexLength+=4,v.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},a,c,d)}}function Yy(e,t){for(let n=0;n<e.length;n++)if(El(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(El(e,t[n]))return!0;return!!Ky(e,t)}function Cm(e,t,n){return!!El(e,t)||!!Dm(t,e,n)}function kT(e,t){if(1===e.length)return wl(t,e[0]);for(let n=0;n<t.length;n++){const s=t[n];for(let a=0;a<s.length;a++)if(El(e,s[a]))return!0}for(let n=0;n<e.length;n++)if(wl(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Ky(e,t[n]))return!0;return!1}function Xy(e,t,n){if(e.length>1){if(Ky(e,t))return!0;for(let s=0;s<t.length;s++)if(Dm(t[s],e,n))return!0}for(let s=0;s<e.length;s++)if(Dm(e[s],t,n))return!0;return!1}function Ky(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const s=e[n],a=e[n+1];for(let c=0;c<t.length-1;c++)if(Qy(s,a,t[c],t[c+1]))return!0}return!1}function Qy(e,t,n,s){return bt(e,n,s)!==bt(t,n,s)&&bt(e,t,n)!==bt(e,t,s)}function Dm(e,t,n){const s=n*n;if(1===t.length)return e.distSqr(t[0])<s;for(let a=1;a<t.length;a++)if(Jy(e,t[a-1],t[a])<s)return!0;return!1}function Jy(e,t,n){const s=t.distSqr(n);if(0===s)return e.distSqr(t);const a=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/s;return e.distSqr(a<0?t:a>1?n:n.sub(t)._mult(a)._add(t))}function wl(e,t){let n,s,a,c=!1;for(let u=0;u<e.length;u++){n=e[u];for(let d=0,f=n.length-1;d<n.length;f=d++)s=n[d],a=n[f],s.y>t.y!=a.y>t.y&&t.x<(a.x-s.x)*(t.y-s.y)/(a.y-s.y)+s.x&&(c=!c)}return c}function El(e,t){let n=!1;for(let s=0,a=e.length-1;s<e.length;a=s++){const c=e[s],u=e[a];c.y>t.y!=u.y>t.y&&t.x<(u.x-c.x)*(t.y-c.y)/(u.y-c.y)+c.x&&(n=!n)}return n}function Mm(e,t,n,s,a){for(const u of e)if(t<=u.x&&n<=u.y&&s>=u.x&&a>=u.y)return!0;const c=[new et(t,n),new et(t,a),new et(s,a),new et(s,n)];if(e.length>2)for(const u of c)if(El(e,u))return!0;for(let u=0;u<e.length-1;u++)if(Tm(e[u],e[u+1],c))return!0;return!1}function Tm(e,t,n){const s=n[0],a=n[2];if(e.x<s.x&&t.x<s.x||e.x>a.x&&t.x>a.x||e.y<s.y&&t.y<s.y||e.y>a.y&&t.y>a.y)return!1;const c=bt(e,t,n[0]);return c!==bt(e,t,n[1])||c!==bt(e,t,n[2])||c!==bt(e,t,n[3])}function eh(e,t,n,s,a,c){let u=t.y-e.y,d=e.x-t.x;if(c=c||0){const f=u*u+d*d;if(0===f)return!0;const p=Math.sqrt(f);u/=p,d/=p}return!((n.x-e.x)*u+(n.y-e.y)*d-c<0||(s.x-e.x)*u+(s.y-e.y)*d-c<0||(a.x-e.x)*u+(a.y-e.y)*d-c<0)}function Kd(e,t,n,s,a,c,u){return!(eh(e,t,s,a,c,u)||eh(t,n,s,a,c,u)||eh(n,e,s,a,c,u)||eh(s,a,e,t,n,u)||eh(a,c,e,t,n,u)||eh(c,s,e,t,n,u))}function Ra(e,t,n){const s=t.paint.get(e).value;return"constant"===s.kind?s.value:n.programConfigurations.get(t.id).getMaxValue(e)}function Gr(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Qd(e,t,n,s,a){if(!t[0]&&!t[1])return e;const c=et.convert(t)._mult(a);"viewport"===n&&c._rotate(-s);const u=[];for(let d=0;d<e.length;d++)u.push(e[d].sub(c));return u}function Sm(e,t,n,s){const a=et.convert(e)._mult(s);return"viewport"===t&&a._rotate(-n),a}Xt(Em,"CircleBucket",{omit:["layers"]});const LT=new Xn({"circle-sort-key":new se(rt.layout_circle["circle-sort-key"]),visibility:new wt(rt.layout_circle.visibility)});var FT={paint:new Xn({"circle-radius":new se(rt.paint_circle["circle-radius"]),"circle-color":new se(rt.paint_circle["circle-color"]),"circle-blur":new se(rt.paint_circle["circle-blur"]),"circle-opacity":new se(rt.paint_circle["circle-opacity"]),"circle-translate":new wt(rt.paint_circle["circle-translate"]),"circle-translate-anchor":new wt(rt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wt(rt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wt(rt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new se(rt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new se(rt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new se(rt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new wt(rt.paint_circle["circle-emissive-strength"])}),layout:LT};const Yb=it.create(),nh=(e,t,n,s,a,c)=>{const u=e.transform,d="globe"===u.projection.name;let f;if("map"===c.paint.get("circle-pitch-alignment"))if(d){const g=Ub(u.zoom,t.canonical)*u._pixelsPerMercatorPixel;f=Float32Array.from([g,0,0,g])}else f=u.calculatePixelsToTileUnitsMatrix(n);else f=new Float32Array([u.pixelsToGLUnits[0],0,0,u.pixelsToGLUnits[1]]);const p={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(u.projection),u_matrix:e.translatePosMatrix(t.projMatrix,n,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_device_pixel_ratio:xe.devicePixelRatio,u_extrude_scale:f,u_inv_rot_matrix:Yb,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:c.paint.get("circle-emissive-strength")};if(d){p.u_inv_rot_matrix=s,p.u_merc_center=a,p.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],p.u_zoom_transition=ti(u.zoom);const g=a[0]*ut,_=a[1]*ut;p.u_up_dir=u.projection.upVector(new oo(0,0,0),g,_)}return p},Xb=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function Kb(e,t,n,s,a,c,u,d,f){if(c&&e.queryGeometry.isAboveHorizon)return!1;c&&(f*=e.pixelToTileUnitsFactor);const p=e.tileID.canonical,g=n.projection.upVectorScale(p,n.center.lat,n.worldSize).metersToTile;for(const _ of t)for(const v of _){const x=v.add(d),b=a&&n.elevation?n.elevation.exaggeration()*a.getElevationAt(x.x,x.y,!0):0,E=n.projection.projectTilePoint(x.x,x.y,p);if(b>0){const R=n.projection.upVector(p,x.x,x.y);E.x+=R[0]*g*b,E.y+=R[1]*g*b,E.z+=R[2]*g*b}const C=c?x:NT(E.x,E.y,E.z,s),M=c?e.tilespaceRays.map(R=>zT(R,b)):e.queryGeometry.screenGeometry,T=mn.transformMat4([],[E.x,E.y,E.z,1],s);if(!u&&c?f*=T[3]/n.cameraToCenterDistance:u&&!c&&(f*=n.cameraToCenterDistance/T[3]),c){const R=Ei((v.y/ut+p.y)/(1<<p.z));f/=n.projection.pixelsPerMeter(R,1)/An(1,R)}if(Cm(M,C,f))return!0}return!1}function NT(e,t,n,s){const a=mn.transformMat4([],[e,t,n,1],s);return new et(a[0]/a[3],a[1]/a[3])}const Im=G.fromValues(0,0,0),Am=G.fromValues(0,0,1);function zT(e,t){const n=G.create();return Im[2]=t,e.intersectsPlane(Im,Am,n),new et(n[0],n[1])}class tv extends Em{}function Cl(e,{width:t,height:n},s,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==t*n*s)throw new RangeError("mismatched image size")}else a=new Uint8Array(t*n*s);return e.width=t,e.height=n,e.data=a,e}function BT(e,t,n){const{width:s,height:a}=t;s===e.width&&a===e.height||(Jd(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,s),height:Math.min(e.height,a)},n),e.width=s,e.height=a,e.data=t.data)}function Jd(e,t,n,s,a,c){if(0===a.width||0===a.height)return t;if(a.width>e.width||a.height>e.height||n.x>e.width-a.width||n.y>e.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>t.width||a.height>t.height||s.x>t.width-a.width||s.y>t.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const u=e.data,d=t.data;for(let f=0;f<a.height;f++){const p=((n.y+f)*e.width+n.x)*c,g=((s.y+f)*t.width+s.x)*c;for(let _=0;_<a.width*c;_++)d[g+_]=u[p+_]}return t}Xt(tv,"HeatmapBucket",{omit:["layers"]});class _s{constructor(t,n){Cl(this,t,1,n)}resize(t){BT(this,new _s(t),1)}clone(){return new _s({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,s,a,c){Jd(t,n,s,a,c,1)}}class yi{constructor(t,n){Cl(this,t,4,n)}resize(t){BT(this,new yi(t),4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new yi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,s,a,c){Jd(t,n,s,a,c,4)}}class jT{constructor(t,n){this.width=t.width,this.height=t.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}Xt(_s,"AlphaImage"),Xt(yi,"RGBAImage");const uR=new Xn({visibility:new wt(rt.layout_heatmap.visibility)});var Rm={paint:new Xn({"heatmap-radius":new se(rt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new se(rt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wt(rt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ju(rt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wt(rt.paint_heatmap["heatmap-opacity"])}),layout:uR};function Pm(e){const t={},n=e.resolution||256,s=e.clips?e.clips.length:1,a=e.image||new yi({width:n,height:s}),c=(u,d,f)=>{t[e.evaluationKey]=f;const p=e.expression.evaluate(t);p&&(a.data[u+d+0]=Math.floor(255*p.r/p.a),a.data[u+d+1]=Math.floor(255*p.g/p.a),a.data[u+d+2]=Math.floor(255*p.b/p.a),a.data[u+d+3]=Math.floor(255*p.a))};if(e.clips)for(let u=0,d=0;u<s;++u,d+=4*n)for(let f=0,p=0;f<n;f++,p+=4){const g=f/(n-1),{start:_,end:v}=e.clips[u];c(d,p,_*(1-g)+v*g)}else for(let u=0,d=0;u<n;u++,d+=4)c(0,d,u/(n-1));return a}const ev=new Xn({visibility:new wt(rt.layout_hillshade.visibility)});var nv={paint:new Xn({"hillshade-illumination-direction":new wt(rt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new wt(rt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wt(rt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wt(rt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wt(rt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wt(rt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new wt(rt.paint_hillshade["hillshade-emissive-strength"])}),layout:ev};const ih=dn([{name:"a_pos",components:2,type:"Int16"}],4),{members:iv}=ih;var tf={exports:{}};function Dl(e,t,n){n=n||2;var s,a,c,u,d,f,p,g=t&&t.length,_=g?t[0]*n:e.length,v=ef(e,0,_,n,!0),x=[];if(!v||v.next===v.prev)return x;if(g&&(v=function(E,C,M,T){var R,P,I,O=[];for(R=0,P=C.length;R<P;R++)(I=ef(E,C[R]*T,R<P-1?C[R+1]*T:E.length,T,!1))===I.next&&(I.steiner=!0),O.push(UT(I));for(O.sort(nf),R=0;R<O.length;R++)M=VT(O[R],M);return M}(e,t,v,n)),e.length>80*n){s=c=e[0],a=u=e[1];for(var b=n;b<_;b+=n)(d=e[b])<s&&(s=d),(f=e[b+1])<a&&(a=f),d>c&&(c=d),f>u&&(u=f);p=0!==(p=Math.max(c-s,u-a))?32767/p:0}return Rc(v,x,n,s,a,p,0),x}function ef(e,t,n,s,a){var c,u;if(a===lv(e,t,n,s)>0)for(c=t;c<n;c+=s)u=av(c,e[c],e[c+1],u);else for(c=n-s;c>=t;c-=s)u=av(c,e[c],e[c+1],u);return u&&km(u,u.next)&&(kc(u),u=u.next),u}function qo(e,t){if(!e)return e;t||(t=e);var n,s=e;do{if(n=!1,s.steiner||!km(s,s.next)&&0!==Pi(s.prev,s,s.next))s=s.next;else{if(kc(s),(s=t=s.prev)===s.next)break;n=!0}}while(n||s!==t);return t}function Rc(e,t,n,s,a,c,u){if(e){!u&&c&&function(g,_,v,x){var b=g;do{0===b.z&&(b.z=sv(b.x,b.y,_,v,x)),b.prevZ=b.prev,b.nextZ=b.next,b=b.next}while(b!==g);b.prevZ.nextZ=null,b.prevZ=null,function(E){var C,M,T,R,P,I,O,L,F=1;do{for(M=E,E=null,P=null,I=0;M;){for(I++,T=M,O=0,C=0;C<F&&(O++,T=T.nextZ);C++);for(L=F;O>0||L>0&&T;)0!==O&&(0===L||!T||M.z<=T.z)?(R=M,M=M.nextZ,O--):(R=T,T=T.nextZ,L--),P?P.nextZ=R:E=R,R.prevZ=P,P=R;M=T}P.nextZ=null,F*=2}while(I>1)}(b)}(e,s,a,c);for(var d,f,p=e;e.prev!==e.next;)if(d=e.prev,f=e.next,c?Om(e,s,a,c):rv(e))t.push(d.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),kc(e),e=f.next,p=f.next;else if((e=f)===p){u?1===u?Rc(e=hR(qo(e),t,n),t,n,s,a,c,2):2===u&&ov(e,t,n,s,a,c):Rc(qo(e),t,n,s,a,c,1);break}}}function rv(e){var t=e.prev,n=e,s=e.next;if(Pi(t,n,s)>=0)return!1;for(var a=t.x,c=n.x,u=s.x,d=t.y,f=n.y,p=s.y,g=a<c?a<u?a:u:c<u?c:u,_=d<f?d<p?d:p:f<p?f:p,v=a>c?a>u?a:u:c>u?c:u,x=d>f?d>p?d:p:f>p?f:p,b=s.next;b!==t;){if(b.x>=g&&b.x<=v&&b.y>=_&&b.y<=x&&Ml(a,d,c,f,u,p,b.x,b.y)&&Pi(b.prev,b,b.next)>=0)return!1;b=b.next}return!0}function Om(e,t,n,s){var a=e.prev,c=e,u=e.next;if(Pi(a,c,u)>=0)return!1;for(var d=a.x,f=c.x,p=u.x,g=a.y,_=c.y,v=u.y,x=d<f?d<p?d:p:f<p?f:p,b=g<_?g<v?g:v:_<v?_:v,E=d>f?d>p?d:p:f>p?f:p,C=g>_?g>v?g:v:_>v?_:v,M=sv(x,b,t,n,s),T=sv(E,C,t,n,s),R=e.prevZ,P=e.nextZ;R&&R.z>=M&&P&&P.z<=T;){if(R.x>=x&&R.x<=E&&R.y>=b&&R.y<=C&&R!==a&&R!==u&&Ml(d,g,f,_,p,v,R.x,R.y)&&Pi(R.prev,R,R.next)>=0||(R=R.prevZ,P.x>=x&&P.x<=E&&P.y>=b&&P.y<=C&&P!==a&&P!==u&&Ml(d,g,f,_,p,v,P.x,P.y)&&Pi(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;R&&R.z>=M;){if(R.x>=x&&R.x<=E&&R.y>=b&&R.y<=C&&R!==a&&R!==u&&Ml(d,g,f,_,p,v,R.x,R.y)&&Pi(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;P&&P.z<=T;){if(P.x>=x&&P.x<=E&&P.y>=b&&P.y<=C&&P!==a&&P!==u&&Ml(d,g,f,_,p,v,P.x,P.y)&&Pi(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function hR(e,t,n){var s=e;do{var a=s.prev,c=s.next.next;!km(a,c)&&$T(a,s,s.next,c)&&Oc(a,c)&&Oc(c,a)&&(t.push(a.i/n|0),t.push(s.i/n|0),t.push(c.i/n|0),kc(s),kc(s.next),s=e=c),s=s.next}while(s!==e);return qo(s)}function ov(e,t,n,s,a,c){var u=e;do{for(var d=u.next.next;d!==u.prev;){if(u.i!==d.i&&Jb(u,d)){var f=tw(u,d);return u=qo(u,u.next),f=qo(f,f.next),Rc(u,t,n,s,a,c,0),void Rc(f,t,n,s,a,c,0)}d=d.next}u=u.next}while(u!==e)}function nf(e,t){return e.x-t.x}function VT(e,t){var n=function(a,c){var u,d=c,f=a.x,p=a.y,g=-1/0;do{if(p<=d.y&&p>=d.next.y&&d.next.y!==d.y){var _=d.x+(p-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(_<=f&&_>g&&(g=_,u=d.x<d.next.x?d:d.next,_===f))return u}d=d.next}while(d!==c);if(!u)return null;var v,x=u,b=u.x,E=u.y,C=1/0;d=u;do{f>=d.x&&d.x>=b&&f!==d.x&&Ml(p<E?f:g,p,b,E,p<E?g:f,p,d.x,d.y)&&(v=Math.abs(p-d.y)/(f-d.x),Oc(d,a)&&(v<C||v===C&&(d.x>u.x||d.x===u.x&&Qb(u,d)))&&(u=d,C=v)),d=d.next}while(d!==x);return u}(e,t);if(!n)return t;var s=tw(n,e);return qo(s,s.next),qo(n,n.next)}function Qb(e,t){return Pi(e.prev,e,t.prev)<0&&Pi(t.next,e,e.next)<0}function sv(e,t,n,s,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function UT(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Ml(e,t,n,s,a,c,u,d){return(a-u)*(t-d)>=(e-u)*(c-d)&&(e-u)*(s-d)>=(n-u)*(t-d)&&(n-u)*(c-d)>=(a-u)*(s-d)}function Jb(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(n,s){var a=n;do{if(a.i!==n.i&&a.next.i!==n.i&&a.i!==s.i&&a.next.i!==s.i&&$T(a,a.next,n,s))return!0;a=a.next}while(a!==n);return!1}(e,t)&&(Oc(e,t)&&Oc(t,e)&&function(n,s){var a=n,c=!1,u=(n.x+s.x)/2,d=(n.y+s.y)/2;do{a.y>d!=a.next.y>d&&a.next.y!==a.y&&u<(a.next.x-a.x)*(d-a.y)/(a.next.y-a.y)+a.x&&(c=!c),a=a.next}while(a!==n);return c}(e,t)&&(Pi(e.prev,e,t.prev)||Pi(e,t.prev,t))||km(e,t)&&Pi(e.prev,e,e.next)>0&&Pi(t.prev,t,t.next)>0)}function Pi(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function km(e,t){return e.x===t.x&&e.y===t.y}function $T(e,t,n,s){var a=Pc(Pi(e,t,n)),c=Pc(Pi(e,t,s)),u=Pc(Pi(n,s,e)),d=Pc(Pi(n,s,t));return a!==c&&u!==d||!(0!==a||!Lm(e,n,t))||!(0!==c||!Lm(e,s,t))||!(0!==u||!Lm(n,e,s))||!(0!==d||!Lm(n,t,s))}function Lm(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Pc(e){return e>0?1:e<0?-1:0}function Oc(e,t){return Pi(e.prev,e,e.next)<0?Pi(e,t,e.next)>=0&&Pi(e,e.prev,t)>=0:Pi(e,t,e.prev)<0||Pi(e,e.next,t)<0}function tw(e,t){var n=new rh(e.i,e.x,e.y),s=new rh(t.i,t.x,t.y),a=e.next,c=t.prev;return e.next=t,t.prev=e,n.next=a,a.prev=n,s.next=n,n.prev=s,c.next=s,s.prev=c,s}function av(e,t,n,s){var a=new rh(e,t,n);return s?(a.next=s.next,a.prev=s,s.next.prev=a,s.next=a):(a.prev=a,a.next=a),a}function kc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function rh(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function lv(e,t,n,s){for(var a=0,c=t,u=n-s;c<n;c+=s)a+=(e[u]-e[c])*(e[c+1]+e[u+1]),u=c;return a}tf.exports=Dl,tf.exports.default=Dl,Dl.deviation=function(e,t,n,s){var a=t&&t.length,c=Math.abs(lv(e,0,a?t[0]*n:e.length,n));if(a)for(var u=0,d=t.length;u<d;u++)c-=Math.abs(lv(e,t[u]*n,u<d-1?t[u+1]*n:e.length,n));var f=0;for(u=0;u<s.length;u+=3){var p=s[u]*n,g=s[u+1]*n,_=s[u+2]*n;f+=Math.abs((e[p]-e[_])*(e[g+1]-e[p+1])-(e[p]-e[g])*(e[_+1]-e[p+1]))}return 0===c&&0===f?0:Math.abs((f-c)/c)},Dl.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},s=0,a=0;a<e.length;a++){for(var c=0;c<e[a].length;c++)for(var u=0;u<t;u++)n.vertices.push(e[a][c][u]);a>0&&n.holes.push(s+=e[a-1].length)}return n};var rf=Jr(tf.exports);function cv(e,t){const n=e.length;if(n<=1)return[e];const s=[];let a,c;for(let u=0;u<n;u++){const d=Mt(e[u]);0!==d&&(e[u].area=Math.abs(d),void 0===c&&(c=d<0),c===d<0?(a&&s.push(a),a=[e[u]]):a.push(e[u]))}if(a&&s.push(a),t>1)for(let u=0;u<s.length;u++)s[u].length<=t||(xu(s[u],t,1,s[u].length-1,ew),s[u]=s[u].slice(0,t));return s}function ew(e,t){return t.area-e.area}function nw(e,t,n){const s=n.patternDependencies;let a=!1;for(const c of t){const u=c.paint.get(`${e}-pattern`);u.isConstant()||(a=!0);const d=u.constantOr(null);d&&(a=!0,s[d]=!0)}return a}function uv(e,t,n,s,a){const c=a.patternDependencies;for(const u of t){const d=u.paint.get(`${e}-pattern`).value;if("constant"!==d.kind){let f=d.evaluate({zoom:s},n,{},a.availableImages);f=f&&f.name?f.name:f,c[f]=!0,n.patterns[u.id]=f}}return n}class Pa{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ro,this.indexArray=new Ai,this.indexArray2=new Ea,this.programConfigurations=new mi(t.layers,t.zoom),this.segments=new yn,this.segments2=new yn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=t.projection}populate(t,n,s,a){this.hasPattern=nw("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),u=[];for(const{feature:d,id:f,index:p,sourceLayerIndex:g}of t){const _=this.layers[0]._featureFilter.needGeometry,v=Zs(d,_);if(!this.layers[0]._featureFilter.filter(new zn(this.zoom),v,s))continue;const x=c?c.evaluate(v,{},s,n.availableImages):void 0,b={id:f,properties:d.properties,type:d.type,sourceLayerIndex:g,index:p,geometry:_?v.geometry:gs(d,s,a),patterns:{},sortKey:x};u.push(b)}c&&u.sort((d,f)=>d.sortKey-f.sortKey);for(const d of u){const{geometry:f,index:p,sourceLayerIndex:g}=d;if(this.hasPattern){const _=uv("fill",this.layers,d,this.zoom,n);this.patternFeatures.push(_)}else this.addFeature(d,f,p,s,{},n.availableImages,n.brightness);n.featureIndex.insert(t[p].feature,f,p,g,this.index)}}update(t,n,s,a,c){const u=0!==Object.keys(t).length;u&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,n,u?this.stateDependentLayers:this.layers,s,a,c)}addFeatures(t,n,s,a,c,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,s,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,iv),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,s,a,c,u=[],d){for(const f of cv(n,500)){let p=0;for(const E of f)p+=E.length;const g=this.segments.prepareSegment(p,this.layoutVertexArray,this.indexArray),_=g.vertexLength,v=[],x=[];for(const E of f){if(0===E.length)continue;E!==f[0]&&x.push(v.length/2);const C=this.segments2.prepareSegment(E.length,this.layoutVertexArray,this.indexArray2),M=C.vertexLength;this.layoutVertexArray.emplaceBack(E[0].x,E[0].y),this.indexArray2.emplaceBack(M+E.length-1,M),v.push(E[0].x),v.push(E[0].y);for(let T=1;T<E.length;T++)this.layoutVertexArray.emplaceBack(E[T].x,E[T].y),this.indexArray2.emplaceBack(M+T-1,M+T),v.push(E[T].x),v.push(E[T].y);C.vertexLength+=E.length,C.primitiveLength+=E.length}const b=rf(v,x);for(let E=0;E<b.length;E+=3)this.indexArray.emplaceBack(_+b[E],_+b[E+1],_+b[E+2]);g.vertexLength+=p,g.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,c,u,a,d)}}Xt(Pa,"FillBucket",{omit:["layers","patternFeatures"]});const HT=new Xn({"fill-sort-key":new se(rt.layout_fill["fill-sort-key"]),visibility:new wt(rt.layout_fill.visibility)});var oh={paint:new Xn({"fill-antialias":new wt(rt.paint_fill["fill-antialias"]),"fill-opacity":new se(rt.paint_fill["fill-opacity"]),"fill-color":new se(rt.paint_fill["fill-color"]),"fill-outline-color":new se(rt.paint_fill["fill-outline-color"]),"fill-translate":new wt(rt.paint_fill["fill-translate"]),"fill-translate-anchor":new wt(rt.paint_fill["fill-translate-anchor"]),"fill-pattern":new se(rt.paint_fill["fill-pattern"]),"fill-emissive-strength":new wt(rt.paint_fill["fill-emissive-strength"])}),layout:HT};const qr=dn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),GT=dn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),iw=dn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Fm=dn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),qT=dn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:ZT}=qr;var Oa={},WT=Ga,Nm=sf;function sf(e,t,n,s,a){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=s,this._values=a,e.readFields(hv,this,t)}function hv(e,t,n){1==e?t.id=n.readVarint():2==e?function(s,a){for(var c=s.readVarint()+s.pos;s.pos<c;){var u=a._keys[s.readVarint()],d=a._values[s.readVarint()];a.properties[u]=d}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function rw(e){for(var t,n,s=0,a=0,c=e.length,u=c-1;a<c;u=a++)s+=((n=e[u]).x-(t=e[a]).x)*(t.y+n.y);return s}sf.types=["Unknown","Point","LineString","Polygon"],sf.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,s=1,a=0,c=0,u=0,d=[];e.pos<n;){if(a<=0){var f=e.readVarint();s=7&f,a=f>>3}if(a--,1===s||2===s)c+=e.readSVarint(),u+=e.readSVarint(),1===s&&(t&&d.push(t),t=[]),t.push(new WT(c,u));else{if(7!==s)throw new Error("unknown command "+s);t&&t.push(t[0].clone())}}return t&&d.push(t),d},sf.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,s=0,a=0,c=0,u=1/0,d=-1/0,f=1/0,p=-1/0;e.pos<t;){if(s<=0){var g=e.readVarint();n=7&g,s=g>>3}if(s--,1===n||2===n)(a+=e.readSVarint())<u&&(u=a),a>d&&(d=a),(c+=e.readSVarint())<f&&(f=c),c>p&&(p=c);else if(7!==n)throw new Error("unknown command "+n)}return[u,f,d,p]},sf.prototype.toGeoJSON=function(e,t,n){var s,a,c=this.extent*Math.pow(2,n),u=this.extent*e,d=this.extent*t,f=this.loadGeometry(),p=sf.types[this.type];function g(x){for(var b=0;b<x.length;b++){var E=x[b];x[b]=[360*(E.x+u)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(E.y+d)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var _=[];for(s=0;s<f.length;s++)_[s]=f[s][0];g(f=_);break;case 2:for(s=0;s<f.length;s++)g(f[s]);break;case 3:for(f=function(x){var b=x.length;if(b<=1)return[x];for(var E,C,M=[],T=0;T<b;T++){var R=rw(x[T]);0!==R&&(void 0===C&&(C=R<0),C===R<0?(E&&M.push(E),E=[x[T]]):E.push(x[T]))}return E&&M.push(E),M}(f),s=0;s<f.length;s++)for(a=0;a<f[s].length;a++)g(f[s][a])}1===f.length?f=f[0]:p="Multi"+p;var v={type:"Feature",geometry:{type:p,coordinates:f},properties:this.properties};return"id"in this&&(v.id=this.id),v};var YT=Nm,ow=dv;function dv(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(XT,this,t),this.length=this._features.length}function XT(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(s){for(var a=null,c=s.readVarint()+s.pos;s.pos<c;){var u=s.readVarint()>>3;a=1===u?s.readString():2===u?s.readFloat():3===u?s.readDouble():4===u?s.readVarint64():5===u?s.readVarint():6===u?s.readSVarint():7===u?s.readBoolean():null}return a}(n))}dv.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new YT(this._pbf,t,this.extent,this._keys,this._values)};var sw=ow;function KT(e,t,n){if(3===e){var s=new sw(n,n.readVarint()+n.pos);s.length&&(t[s.name]=s)}}var fv=Oa.VectorTile=function(e,t){this.layers=e.readFields(KT,{},t)},pv=Oa.VectorTileFeature=Nm;function af(e,t,n,s){const a=[],c=0===s?(u,d,f,p,g,_)=>{u.push(new et(_,f+(_-d)/(p-d)*(g-f)))}:(u,d,f,p,g,_)=>{u.push(new et(d+(_-f)/(g-f)*(p-d),_))};for(const u of e){const d=[];for(const f of u){if(f.length<=2)continue;const p=[];for(let v=0;v<f.length-1;v++){const x=f[v].x,b=f[v].y,E=f[v+1].x,C=f[v+1].y,M=0===s?x:b,T=0===s?E:C;M<t?T>t&&c(p,x,b,E,C,t):M>n?T<n&&c(p,x,b,E,C,n):p.push(f[v]),T<t&&M>=t&&c(p,x,b,E,C,t),T>n&&M<=n&&c(p,x,b,E,C,n)}let g=f[f.length-1];const _=0===s?g.x:g.y;_>=t&&_<=n&&p.push(g),p.length&&(g=p[p.length-1],p[0].x===g.x&&p[0].y===g.y||p.push(p[0]),d.push(p))}d.length&&a.push(d)}return a}Oa.VectorTileLayer=ow;class mv{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const s=t[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}var hr={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(e,t,n,s,a){var c,u,d=8*a-s-1,f=(1<<d)-1,p=f>>1,g=-7,_=n?a-1:0,v=n?-1:1,x=e[t+_];for(_+=v,c=x&(1<<-g)-1,x>>=-g,g+=d;g>0;c=256*c+e[t+_],_+=v,g-=8);for(u=c&(1<<-g)-1,c>>=-g,g+=s;g>0;u=256*u+e[t+_],_+=v,g-=8);if(0===c)c=1-p;else{if(c===f)return u?NaN:1/0*(x?-1:1);u+=Math.pow(2,s),c-=p}return(x?-1:1)*u*Math.pow(2,c-s)},write:function(e,t,n,s,a,c){var u,d,f,p=8*c-a-1,g=(1<<p)-1,_=g>>1,v=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,x=s?0:c-1,b=s?1:-1,E=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(d=isNaN(t)?1:0,u=g):(u=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-u))<1&&(u--,f*=2),(t+=u+_>=1?v/f:v*Math.pow(2,1-_))*f>=2&&(u++,f/=2),u+_>=g?(d=0,u=g):u+_>=1?(d=(t*f-1)*Math.pow(2,a),u+=_):(d=t*Math.pow(2,_-1)*Math.pow(2,a),u=0));a>=8;e[n+x]=255&d,x+=b,d/=256,a-=8);for(u=u<<a|d,p+=a;p>0;e[n+x]=255&u,x+=b,u/=256,p-=8);e[n+x-b]|=128*E}},gv=Zn,_v=hr;function Zn(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Zn.Varint=0,Zn.Fixed64=1,Zn.Bytes=2,Zn.Fixed32=5;var ys=4294967296,zm=1/ys,aw=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Tl(e){return e.type===Zn.Bytes?e.readVarint()+e.pos:e.pos+1}function Bm(e,t,n){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(s);for(var a=n.pos-1;a>=e;a--)n.buf[a+s]=n.buf[a]}function dr(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function lw(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function QT(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function dR(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function Dn(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function JT(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function yv(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function tS(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function eS(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function ah(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Lc(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function vv(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}Zn.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),a=s>>3,c=this.pos;this.type=7&s,e(a,t,this),this.pos===c&&this.skip(s)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=ah(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=vv(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=ah(this.buf,this.pos)+ah(this.buf,this.pos+4)*ys;return this.pos+=8,e},readSFixed64:function(){var e=ah(this.buf,this.pos)+vv(this.buf,this.pos+4)*ys;return this.pos+=8,e},readFloat:function(){var e=_v.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=_v.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,s=this.buf;return t=127&(n=s[this.pos++]),n<128?t:(t|=(127&(n=s[this.pos++]))<<7,n<128?t:(t|=(127&(n=s[this.pos++]))<<14,n<128?t:(t|=(127&(n=s[this.pos++]))<<21,n<128?t:function(a,c,u){var d,f,p=u.buf;if(d=(112&(f=p[u.pos++]))>>4,f<128||(d|=(127&(f=p[u.pos++]))<<3,f<128)||(d|=(127&(f=p[u.pos++]))<<10,f<128)||(d|=(127&(f=p[u.pos++]))<<17,f<128)||(d|=(127&(f=p[u.pos++]))<<24,f<128)||(d|=(1&(f=p[u.pos++]))<<31,f<128))return function sh(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}(a,d,c);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=s[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&aw?aw.decode(this.buf.subarray(t,e)):function(n,s,a){for(var c="",u=s;u<a;){var d,f,p,g=n[u],_=null,v=g>239?4:g>223?3:g>191?2:1;if(u+v>a)break;1===v?g<128&&(_=g):2===v?128==(192&(d=n[u+1]))&&(_=(31&g)<<6|63&d)<=127&&(_=null):3===v?(f=n[u+2],128==(192&(d=n[u+1]))&&128==(192&f)&&((_=(15&g)<<12|(63&d)<<6|63&f)<=2047||_>=55296&&_<=57343)&&(_=null)):4===v&&(f=n[u+2],p=n[u+3],128==(192&(d=n[u+1]))&&128==(192&f)&&128==(192&p)&&((_=(15&g)<<18|(63&d)<<12|(63&f)<<6|63&p)<=65535||_>=1114112)&&(_=null)),null===_?(_=65533,v=1):_>65535&&(_-=65536,c+=String.fromCharCode(_>>>10&1023|55296),_=56320|1023&_),c+=String.fromCharCode(_),u+=v}return c}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Zn.Bytes)return e.push(this.readVarint(t));var n=Tl(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Zn.Bytes)return e.push(this.readSVarint());var t=Tl(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Zn.Bytes)return e.push(this.readBoolean());var t=Tl(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Zn.Bytes)return e.push(this.readFloat());var t=Tl(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Zn.Bytes)return e.push(this.readDouble());var t=Tl(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Zn.Bytes)return e.push(this.readFixed32());var t=Tl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Zn.Bytes)return e.push(this.readSFixed32());var t=Tl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Zn.Bytes)return e.push(this.readFixed64());var t=Tl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Zn.Bytes)return e.push(this.readSFixed64());var t=Tl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Zn.Varint)for(;this.buf[this.pos++]>127;);else if(t===Zn.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Zn.Fixed32)this.pos+=4;else{if(t!==Zn.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Lc(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Lc(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Lc(this.buf,-1&e,this.pos),Lc(this.buf,Math.floor(e*zm),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Lc(this.buf,-1&e,this.pos),Lc(this.buf,Math.floor(e*zm),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,n){var s,a,c,d;if(t>=0?(s=t%4294967296|0,a=t/4294967296|0):(a=~(-t/4294967296),4294967295^(s=~(-t%4294967296))?s=s+1|0:(s=0,a=a+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),c=s,(d=n).buf[d.pos++]=127&c|128,c>>>=7,d.buf[d.pos++]=127&c|128,c>>>=7,d.buf[d.pos++]=127&c|128,c>>>=7,d.buf[d.pos++]=127&c|128,d.buf[d.pos]=127&(c>>>=7),function(c,u){var d=(7&c)<<4;u.buf[u.pos++]|=d|((c>>>=3)?128:0),c&&(u.buf[u.pos++]=127&c|((c>>>=7)?128:0),c&&(u.buf[u.pos++]=127&c|((c>>>=7)?128:0),c&&(u.buf[u.pos++]=127&c|((c>>>=7)?128:0),c&&(u.buf[u.pos++]=127&c|((c>>>=7)?128:0),c&&(u.buf[u.pos++]=127&c)))))}(a,n)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(s,a,c){for(var u,d,f=0;f<a.length;f++){if((u=a.charCodeAt(f))>55295&&u<57344){if(!d){u>56319||f+1===a.length?(s[c++]=239,s[c++]=191,s[c++]=189):d=u;continue}if(u<56320){s[c++]=239,s[c++]=191,s[c++]=189,d=u;continue}u=d-55296<<10|u-56320|65536,d=null}else d&&(s[c++]=239,s[c++]=191,s[c++]=189,d=null);u<128?s[c++]=u:(u<2048?s[c++]=u>>6|192:(u<65536?s[c++]=u>>12|224:(s[c++]=u>>18|240,s[c++]=u>>12&63|128),s[c++]=u>>6&63|128),s[c++]=63&u|128)}return c}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&Bm(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),_v.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),_v.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var s=this.pos-n;s>=128&&Bm(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(e,t,n){this.writeTag(e,Zn.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,dr,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,lw,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Dn,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,QT,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,dR,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,JT,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,yv,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,tS,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,eS,t)},writeBytesField:function(e,t){this.writeTag(e,Zn.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Zn.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Zn.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Zn.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Zn.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Zn.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Zn.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Zn.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Zn.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Zn.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var jm=Jr(gv);const cw=["tile","layer","source","sourceLayer","state"];class xv{constructor(t,n,s,a,c){this.type="Feature",this._vectorTileFeature=t,this._z=n,this._x=s,this._y=a,this.properties=t.properties,this.id=c}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const n of cw)void 0!==this[n]&&(t[n]=this[n]);return t}}class nS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,s){const a=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][a]=this.stateChanges[t][a]||{},qt(this.stateChanges[t][a],s),null===this.deletedStates[t]){this.deletedStates[t]={};for(const c in this.state[t])c!==a&&(this.deletedStates[t][c]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][a]){this.deletedStates[t][a]={};for(const c in this.state[t][a])s[c]||(this.deletedStates[t][a][c]=null)}else for(const c in s)this.deletedStates[t]&&this.deletedStates[t][a]&&null===this.deletedStates[t][a][c]&&delete this.deletedStates[t][a][c]}removeFeatureState(t,n,s){if(null===this.deletedStates[t])return;const a=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&void 0!==n)null!==this.deletedStates[t][a]&&(this.deletedStates[t][a]=this.deletedStates[t][a]||{},this.deletedStates[t][a][s]=null);else if(void 0!==n)if(this.stateChanges[t]&&this.stateChanges[t][a])for(s in this.deletedStates[t][a]={},this.stateChanges[t][a])this.deletedStates[t][a][s]=null;else this.deletedStates[t][a]=null;else this.deletedStates[t]=null}getState(t,n){const s=String(n),a=qt({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const c=this.deletedStates[t][n];if(null===c)return{};for(const u in c)delete a[u]}return a}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const s={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const c={};for(const u in this.stateChanges[a])this.state[a][u]||(this.state[a][u]={}),qt(this.state[a][u],this.stateChanges[a][u]),c[u]=this.state[a][u];s[a]=c}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const c={};if(null===this.deletedStates[a])for(const u in this.state[a])c[u]={},this.state[a][u]={};else for(const u in this.deletedStates[a]){if(null===this.deletedStates[a][u])this.state[a][u]={};else if(this.state[a][u])for(const d of Object.keys(this.deletedStates[a][u]))delete this.state[a][u][d];c[u]=this.state[a][u]}s[a]=s[a]||{},qt(s[a],c)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const a in t)t[a].setFeatureState(s,n)}}class uw{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,n){const s=this.toIdx(t,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(t,n){return this.leaves[this.toIdx(t,n)]}toIdx(t,n){return n*this.size+t}}function hw(e,t,n,s){let a=0,c=Number.MAX_VALUE;for(let u=0;u<3;u++)if(Math.abs(s[u])<1e-15){if(n[u]<e[u]||n[u]>t[u])return null}else{const d=1/s[u];let f=(e[u]-n[u])*d,p=(t[u]-n[u])*d;if(f>p){const g=f;f=p,p=g}if(f>a&&(a=f),p<c&&(c=p),a>c)return null}return a}function bv(e,t,n,s,a,c,u,d,f,p,g){const _=s-e,v=a-t,x=c-n,b=u-e,E=d-t,C=f-n,M=g[1]*C-g[2]*E,T=g[2]*b-g[0]*C,R=g[0]*E-g[1]*b,P=_*M+v*T+x*R;if(Math.abs(P)<1e-15)return null;const I=1/P,O=p[0]-e,L=p[1]-t,F=p[2]-n,N=(O*M+L*T+F*R)*I;if(N<0||N>1)return null;const B=L*x-F*v,V=F*_-O*x,U=O*v-L*_,q=(g[0]*B+g[1]*V+g[2]*U)*I;return q<0||N+q>1?null:(b*B+E*V+C*U)*I}function Fc(e,t,n){return(e-t)/(n-t)}function Ws(e,t,n,s,a,c,u,d,f){const p=1<<n,g=c-s,_=u-a,v=(e+1)/p*g+s,x=(t+0)/p*_+a,b=(t+1)/p*_+a;d[0]=(e+0)/p*g+s,d[1]=x,f[0]=v,f[1]=b}class Nc{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(c){const u=Math.ceil(Math.log2(c.dim/8)),d=[];let f=Math.ceil(Math.pow(2,u));const p=1/f,g=(x,b,E,C,M)=>{const T=C?1:0,R=(x+1)*E-T,P=b*E,I=(b+1)*E-T;M[0]=x*E,M[1]=P,M[2]=R,M[3]=I};let _=new uw(f);const v=[];for(let x=0;x<f*f;x++){g(x%f,Math.floor(x/f),p,!1,v);const b=Sl(v[0],v[1],c),E=Sl(v[2],v[1],c),C=Sl(v[2],v[3],c),M=Sl(v[0],v[3],c);_.minimums.push(Math.min(b,E,C,M)),_.maximums.push(Math.max(b,E,C,M)),_.leaves.push(1)}for(d.push(_),f/=2;f>=1;f/=2){const x=d[d.length-1];_=new uw(f);for(let b=0;b<f*f;b++){g(b%f,Math.floor(b/f),2,!0,v);const E=x.getElevation(v[0],v[1]),C=x.getElevation(v[2],v[1]),M=x.getElevation(v[2],v[3]),T=x.getElevation(v[0],v[3]),R=x.isLeaf(v[0],v[1]),P=x.isLeaf(v[2],v[1]),I=x.isLeaf(v[2],v[3]),O=x.isLeaf(v[0],v[3]),L=Math.min(E.min,C.min,M.min,T.min),F=Math.max(E.max,C.max,M.max,T.max),N=R&&P&&I&&O;_.maximums.push(F),_.minimums.push(L),_.leaves.push(F-L<=5&&N?1:0)}d.push(_)}return d}(this.dem),s=n.length-1,a=n[s];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(t,n,s,a,c,u,d=1){return hw([t,n,-100],[s,a,this.maximums[0]*d],c,u)}raycast(t,n,s,a,c,u,d=1){if(!this.nodeCount)return null;const f=this.raycastRoot(t,n,s,a,c,u,d);if(null==f)return null;const p=[],g=[],_=[],v=[],x=[{idx:0,t:f,nodex:0,nodey:0,depth:0}];for(;x.length>0;){const{idx:b,t:E,nodex:C,nodey:M,depth:T}=x.pop();if(this.leaves[b]){Ws(C,M,T,t,n,s,a,_,v);const P=1<<T,I=(C+0)/P,O=(C+1)/P,L=(M+0)/P,F=(M+1)/P,N=Sl(I,L,this.dem)*d,B=Sl(O,L,this.dem)*d,V=Sl(O,F,this.dem)*d,U=Sl(I,F,this.dem)*d,q=bv(_[0],_[1],N,v[0],_[1],B,v[0],v[1],V,c,u),j=bv(v[0],v[1],V,_[0],v[1],U,_[0],_[1],N,c,u),X=Math.min(null!==q?q:Number.MAX_VALUE,null!==j?j:Number.MAX_VALUE);if(X!==Number.MAX_VALUE)return X;{const Q=G.scaleAndAdd([],c,u,E);if(dw(N,B,U,V,Fc(Q[0],_[0],v[0]),Fc(Q[1],_[1],v[1]))>=Q[2])return E}continue}let R=0;for(let P=0;P<this._siblingOffset.length;P++){Ws((C<<1)+this._siblingOffset[P][0],(M<<1)+this._siblingOffset[P][1],T+1,t,n,s,a,_,v),_[2]=-100,v[2]=this.maximums[this.childOffsets[b]+P]*d;const I=hw(_,v,c,u);if(null!=I){const O=I;p[P]=O;let L=!1;for(let F=0;F<R&&!L;F++)O>=p[g[F]]&&(g.splice(F,0,P),L=!0);L||(g[R]=P),R++}}for(let P=0;P<R;P++){const I=g[P];x.push({idx:this.childOffsets[b]+I,t:p[I],nodex:(C<<1)+this._siblingOffset[I][0],nodey:(M<<1)+this._siblingOffset[I][1],depth:T+1})}}return null}_addNode(t,n,s){return this.minimums.push(t),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(t,n,s,a,c){if(1===t[a].isLeaf(n,s))return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const u=a-1,d=t[u];let f=0,p=0;for(let g=0;g<this._siblingOffset.length;g++){const _=2*n+this._siblingOffset[g][0],v=2*s+this._siblingOffset[g][1],x=d.getElevation(_,v),b=d.isLeaf(_,v),E=this._addNode(x.min,x.max,b);b&&(f|=1<<g),p||(p=E)}for(let g=0;g<this._siblingOffset.length;g++)f&1<<g||this._construct(t,2*n+this._siblingOffset[g][0],2*s+this._siblingOffset[g][1],u,p+g)}}function dw(e,t,n,s,a,c){return vt(vt(e,n,c),vt(t,s,c),a)}function Sl(e,t,n){const s=n.dim,a=Qt(e*s-.5,0,s-1),c=Qt(t*s-.5,0,s-1),u=Math.floor(a),d=Math.floor(c),f=Math.min(u+1,s-1),p=Math.min(d+1,s-1);return dw(n.get(u,d),n.get(f,d),n.get(u,p),n.get(f,p),a-u,c-d)}const fw={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function pw(e,t,n){return(256*e*256+256*t+n)/10-1e4}function wv(e,t,n){return 256*e+t+n/256-32768}class Il{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,n,s,a=!1){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return tt(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const c=this.dim=n.height-2,u=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let f=0;f<c;f++)u[this._idx(-1,f)]=u[this._idx(0,f)],u[this._idx(c,f)]=u[this._idx(c-1,f)],u[this._idx(f,-1)]=u[this._idx(f,0)],u[this._idx(f,c)]=u[this._idx(f,c-1)];u[this._idx(-1,-1)]=u[this._idx(0,0)],u[this._idx(c,-1)]=u[this._idx(c-1,0)],u[this._idx(-1,c)]=u[this._idx(0,c-1)],u[this._idx(c,c)]=u[this._idx(c-1,c-1)]}const d="terrarium"===s?wv:pw;for(let f=0;f<u.length;++f){const p=4*f;this.floatView[f]=d(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}this._timestamp=xe.now()}_buildQuadTree(){this._tree=new Nc(this)}get(t,n,s=!1){s&&(t=Qt(t,-1,this.dim),n=Qt(n,-1,this.dim));const a=this._idx(t,n);return this.floatView[a]}set(t,n,s){const a=this._idx(t,n),c=this.floatView[a];return this.floatView[a]=s,s-c}static getUnpackVector(t){return fw[t]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}static pack(t,n){const s=[0,0,0,0],a=Il.getUnpackVector(n);let c=Math.floor((t+a[3])/a[2]);return s[2]=c%256,c=Math.floor(c/256),s[1]=c%256,c=Math.floor(c/256),s[0]=c,s}getPixels(){return new jT({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,n,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let a=n*this.dim,c=n*this.dim+this.dim,u=s*this.dim,d=s*this.dim+this.dim;switch(n){case-1:a=c-1;break;case 1:c=a+1}switch(s){case-1:u=d-1;break;case 1:d=u+1}const f=-n*this.dim,p=-s*this.dim;for(let g=u;g<d;g++)for(let _=a;_<c;_++){const v=4*this._idx(_,g),x=4*this._idx(_+f,g+p);this.pixels[v+0]=t.pixels[x+0],this.pixels[v+1]=t.pixels[x+1],this.pixels[v+2]=t.pixels[x+2],this.pixels[v+3]=t.pixels[x+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Xt(Il,"DEMData"),Xt(Nc,"DemMinMaxQuadTree",{omit:["dem"]});class Vm{isDataAvailableAtPoint(t){const n=this._source();if(this.isUsingMockSource()||!n||t.y<0||t.y>1)return!1;const s=n.getSource().maxzoom,a=1<<s,c=Math.floor(t.x),u=Math.floor((t.x-c)*a),d=Math.floor(t.y*a),f=this.findDEMTileFor(new nn(s,c,s,u,d));return!(!f||!f.dem)}getAtPointOrZero(t,n=0){return this.getAtPoint(t,n)||0}getAtPoint(t,n,s=!0){if(this.isUsingMockSource())return null;null==n&&(n=null);const a=this._source();if(!a||t.y<0||t.y>1)return n;const c=a.getSource().maxzoom,u=1<<c,d=Math.floor(t.x),f=t.x-d,p=new nn(c,d,c,Math.floor(f*u),Math.floor(t.y*u)),g=this.findDEMTileFor(p);if(!g||!g.dem)return n;const _=g.dem,v=1<<g.tileID.canonical.z,x=(f*v-g.tileID.canonical.x)*_.dim,b=(t.y*v-g.tileID.canonical.y)*_.dim,E=Math.floor(x),C=Math.floor(b);return(s?this.exaggeration():1)*vt(vt(_.get(E,C),_.get(E,C+1),b-C),vt(_.get(E+1,C),_.get(E+1,C+1),b-C),x-E)}getAtTileOffset(t,n,s){const a=1<<t.canonical.z;return this.getAtPointOrZero(new We(t.wrap+(t.canonical.x+n/ut)/a,(t.canonical.y+s/ut)/a))}getAtTileOffsetFunc(t,n,s,a){return c=>{const u=this.getAtTileOffset(t,c.x,c.y),d=a.upVector(t.canonical,c.x,c.y),f=a.upVectorScale(t.canonical,n,s).metersToTile;return G.scale(d,d,u*f),d}}getForTilePoints(t,n,s,a){if(this.isUsingMockSource())return!1;const c=zc.create(this,t,a);return!!c&&(n.forEach(u=>{u[2]=this.exaggeration()*c.getElevationAt(u[0],u[1],s)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(t);if(!n||!n.dem)return null;const s=n.dem.tree,a=n.tileID,c=1<<t.canonical.z-a.canonical.z;let u=t.canonical.x/c-a.canonical.x,d=t.canonical.y/c-a.canonical.y,f=0;for(let p=0;p<t.canonical.z-a.canonical.z&&!s.leaves[f];p++){u*=2,d*=2;const g=2*Math.floor(d)+Math.floor(u);f=s.childOffsets[f]+g,u%=1,d%=1}return{min:this.exaggeration()*s.minimums[f],max:this.exaggeration()*s.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,n,s){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(0===t.length)return null;let n=!1,s=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const c of t){const u=this.getMinMaxForTile(c.tileID);u&&(s=Math.min(s,u.min),a=Math.max(a,u.max),n=!0)}return n?{min:s,max:a}:null}}class zc{constructor(t,n,s){this._demTile=t,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(t,n,s){const a=s||t.findDEMTileFor(n);if(!a||!a.dem)return;const c=a.dem,u=a.tileID,d=1<<n.canonical.z-u.canonical.z;return new zc(a,c.dim/ut/d,[(n.canonical.x/d-u.canonical.x)*c.dim,(n.canonical.y/d-u.canonical.y)*c.dim])}tileCoordToPixel(t,n){const s=n*this._scale+this._offset[1],a=Math.floor(t*this._scale+this._offset[0]),c=Math.floor(s);return new et(a,c)}getElevationAt(t,n,s,a){const c=t*this._scale+this._offset[0],u=n*this._scale+this._offset[1],d=Math.floor(c),f=Math.floor(u),p=this._dem;return a=!!a,s?vt(vt(p.get(d,f,a),p.get(d,f+1,a),u-f),vt(p.get(d+1,f,a),p.get(d+1,f+1,a),u-f),c-d):p.get(d,f,a)}getElevationAtPixel(t,n,s){return this._dem.get(t,n,!!s)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*An(1,t)*this._dem.stride}}class Um{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new fc(ut,16,0),this.featureIndexArray=new Td,this.promoteId=n}insert(t,n,s,a,c,u=0){const d=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,a,c,u);const f=this.grid;for(let p=0;p<n.length;p++){const g=n[p],_=[1/0,1/0,-1/0,-1/0];for(let v=0;v<g.length;v++){const x=g[v];_[0]=Math.min(_[0],x.x),_[1]=Math.min(_[1],x.y),_[2]=Math.max(_[2],x.x),_[3]=Math.max(_[3],x.y)}_[0]<ut&&_[1]<ut&&_[2]>=0&&_[3]>=0&&f.insert(d,_[0],_[1],_[2],_[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new fv(new jm(this.rawTileData)).layers,this.sourceLayerCoder=new mv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,n,s,a){this.loadVTLayers();const c=t.params||{},u=Vp(c.filter),d=t.tileResult,f=t.transform,p=d.bufferedTilespaceBounds,g=this.grid.query(p.min.x,p.min.y,p.max.x,p.max.y,(b,E,C,M)=>Mm(d.bufferedTilespaceGeometry,b,E,C,M));g.sort(iS);let _=null;f.elevation&&g.length>0&&(_=zc.create(f.elevation,this.tileID));const v={};let x;for(let b=0;b<g.length;b++){const E=g[b];if(E===x)continue;x=E;const C=this.featureIndexArray.get(E);let M=null;this.loadMatchingFeature(v,C,u,c.layers,c.availableImages,n,s,a,(T,R,P,I=0)=>(M||(M=gs(T,this.tileID.canonical,t.tileTransform)),R.queryIntersectsFeature(d,T,P,M,this.z,t.transform,t.pixelPosMatrix,_,I)))}return v}loadMatchingFeature(t,n,s,a,c,u,d,f,p){const{featureIndex:g,bucketIndex:_,sourceLayerIndex:v,layoutVertexArrayOffset:x}=n,b=this.bucketLayerIDs[_];if(a&&!function(T,R){for(let P=0;P<T.length;P++)if(R.indexOf(T[P])>=0)return!0;return!1}(a,b))return;const E=this.sourceLayerCoder.decode(v),C=this.vtLayers[E].feature(g);if(s.needGeometry){const T=Zs(C,!0);if(!s.filter(new zn(this.tileID.overscaledZ),T,this.tileID.canonical))return}else if(!s.filter(new zn(this.tileID.overscaledZ),C))return;const M=this.getId(C,E);for(let T=0;T<b.length;T++){const R=b[T];if(a&&a.indexOf(R)<0)continue;const P=u[R];if(!P)continue;let I={};void 0!==M&&f&&(I=f.getState(P.sourceLayer||"_geojsonTileLayer",M));const O=qt({},d[R]);O.paint=mw(O.paint,P.paint,C,I,c),O.layout=mw(O.layout,P.layout,C,I,c);const L=!p||p(C,P,I,x);if(!L)continue;const F=new xv(C,this.z,this.x,this.y,M);F.layer=O;let N=t[R];void 0===N&&(N=t[R]=[]),N.push({featureIndex:g,feature:F,intersectionZ:L})}}lookupSymbolFeatures(t,n,s,a,c,u,d,f){const p={};this.loadVTLayers();const g=Vp(c);for(const _ of t)this.loadMatchingFeature(p,{bucketIndex:s,sourceLayerIndex:a,featureIndex:_,layoutVertexArrayOffset:0},g,u,d,f,n);return p}loadFeature(t){const{featureIndex:n,sourceLayerIndex:s}=t;this.loadVTLayers();const a=this.sourceLayerCoder.decode(s),c=this.vtFeatures[a];if(c[n])return c[n];const u=this.vtLayers[a].feature(n);return c[n]=u,u}hasLayer(t){for(const n of this.bucketLayerIDs)for(const s of n)if(t===s)return!0;return!1}getId(t,n){let s=t.id;if(this.promoteId){const a="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=a&&(s=t.properties[a]),"boolean"==typeof s&&(s=Number(s))}return s}}function mw(e,t,n,s,a){return fu(e,(c,u)=>{const d=t instanceof Bu?t.get(u):null;return d&&d.evaluate?d.evaluate(n,s,a):d})}function iS(e,t){return t-e}Xt(Um,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const rS=dn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),oS=dn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),gw=dn([{name:"a_projected_pos",components:4,type:"Float32"}],4);dn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const fR=dn([{name:"a_z_offset",components:1,type:"Float32"}],4),sS=dn([{name:"a_texb",components:2,type:"Uint16"}]),pR=dn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),mR=dn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ev=dn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_w=dn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);dn([{name:"triangle",components:3,type:"Uint16"}]),dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),dn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),dn([{type:"Float32",name:"offsetX"}]),dn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Yi=24;const co=128;function yw(e,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new zn(e+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:a}=n;let c=0;for(;c<s.length&&s[c]<=e;)c++;c=Math.max(0,c-1);let u=c;for(;u<s.length&&s[u]<e+1;)u++;u=Math.min(s.length-1,u);const d=s[c],f=s[u];return"composite"===n.kind?{kind:"composite",minZoom:d,maxZoom:f,interpolationType:a}:{kind:"camera",minZoom:d,maxZoom:f,minSize:n.evaluate(new zn(d)),maxSize:n.evaluate(new zn(f)),interpolationType:a}}}function lh(e,{uSize:t,uSizeT:n},{lowerSize:s,upperSize:a}){return"source"===e.kind?s/co:"composite"===e.kind?vt(s/co,a/co,n):t}function vs(e,t){let n=0,s=0;if("constant"===e.kind)s=e.layoutSize;else if("source"!==e.kind){const{interpolationType:a,minZoom:c,maxZoom:u}=e,d=a?Qt(io.interpolationFactor(a,t,c,u),0,1):0;"camera"===e.kind?s=vt(e.minSize,e.maxSize,d):n=d}return{uSizeT:n,uSize:s}}var aS=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:co,evaluateSizeForFeature:lh,evaluateSizeForZoom:vs,getSizeData:yw});function vw(e,t,n){return e.sections.forEach(s=>{s.text=function(a,c,u){const d=c.layout.get("text-transform").evaluate(u,{});return"uppercase"===d?a=a.toLocaleUpperCase():"lowercase"===d&&(a=a.toLocaleLowerCase()),Eo.applyArabicShaping&&(a=Eo.applyArabicShaping(a)),a}(s.text,t,n)}),e}const ch={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function ln(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function lS(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}const $m=3;function re(e,t,n){t.glyphs=[],1===e&&n.readMessage(Cv,t)}function Cv(e,t,n){if(3===e){const{id:s,bitmap:a,width:c,height:u,left:d,top:f,advance:p}=n.readMessage(cS,{});t.glyphs.push({id:s,bitmap:new _s({width:c+2*$m,height:u+2*$m},a),metrics:{width:c,height:u,left:d,top:f,advance:p}})}else 4===e?t.ascender=n.readSVarint():5===e&&(t.descender=n.readSVarint())}function cS(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}const lf=$m,On={horizontal:1,vertical:2,horizontalOnly:3},Hm=-17;class ka{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const s=new ka;return s.scale=t||1,s.fontStack=n,s}static forImage(t){const n=new ka;return n.imageName=t,n}}class Bc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const s=new Bc;for(let a=0;a<t.sections.length;a++){const c=t.sections[a];c.image?s.addImageSection(c):s.addTextSection(c,n)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(n,s){let a="";for(let c=0;c<n.length;c++){const u=n.charCodeAt(c+1)||null,d=n.charCodeAt(c-1)||null;a+=!s&&(u&&Ft(u)&&!ch[n[c+1]]||d&&Ft(d)&&!ch[n[c-1]])||!ch[n[c]]?n[c]:ch[n[c]]}return a}(this.text,t)}trim(){let t=0;for(let s=0;s<this.text.length&&uh[this.text.charCodeAt(s)];s++)t++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&uh[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const s=new Bc;return s.text=this.text.substring(t,n),s.sectionIndex=this.sectionIndex.slice(t,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(ka.forText(t.scale,t.fontStack||n));const s=this.sections.length-1;for(let a=0;a<t.text.length;++a)this.sectionIndex.push(s)}addImageSection(t){const n=t.image?t.image.namePrimary:"";if(0===n.length)return void tt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(ka.forImage(n)),this.sectionIndex.push(this.sections.length-1)):tt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function cf(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b){const E=Bc.fromFeature(e,a);_===On.vertical&&E.verticalizePunctuation(v);let C=[];const M=function(O,L,F,N,B,V){if(!O)return[];const U=[],q=function(nt,Y,K,ot,at,lt){let dt=0;for(let ft=0;ft<nt.length();ft++){const gt=nt.getSection(ft);dt+=Mv(nt.getCodePoint(ft),gt,ot,at,Y,lt)}return dt/Math.max(1,Math.ceil(dt/K))}(O,L,F,N,B,V),j=O.text.indexOf("\u200b")>=0;let X=0;for(let nt=0;nt<O.length();nt++){const Y=O.getSection(nt),K=O.getCodePoint(nt);if(uh[K]||(X+=Mv(K,Y,N,B,L,V)),nt<O.length()-1){const ot=!((Q=K)<11904||!(ee["Bopomofo Extended"](Q)||ee.Bopomofo(Q)||ee["CJK Compatibility Forms"](Q)||ee["CJK Compatibility Ideographs"](Q)||ee["CJK Compatibility"](Q)||ee["CJK Radicals Supplement"](Q)||ee["CJK Strokes"](Q)||ee["CJK Symbols and Punctuation"](Q)||ee["CJK Unified Ideographs Extension A"](Q)||ee["CJK Unified Ideographs"](Q)||ee["Enclosed CJK Letters and Months"](Q)||ee["Halfwidth and Fullwidth Forms"](Q)||ee.Hiragana(Q)||ee["Ideographic Description Characters"](Q)||ee["Kangxi Radicals"](Q)||ee["Katakana Phonetic Extensions"](Q)||ee.Katakana(Q)||ee["Vertical Forms"](Q)||ee["Yi Radicals"](Q)||ee["Yi Syllables"](Q)));(Dv[K]||ot||Y.imageName)&&U.push(xw(nt+1,X,q,U,uS(K,O.getCodePoint(nt+1),ot&&j),!1))}}var Q;return bw(xw(O.length(),X,q,U,0,!0))}(E,p,c,t,s,x),{processBidirectionalText:T,processStyledBidirectionalText:R}=Eo;if(T&&1===E.sections.length){const O=T(E.toString(),M);for(const L of O){const F=new Bc;F.text=L,F.sections=E.sections;for(let N=0;N<L.length;N++)F.sectionIndex.push(0);C.push(F)}}else if(R){const O=R(E.text,E.sectionIndex,M);for(const L of O){const F=new Bc;F.text=L[0],F.sectionIndex=L[1],F.sections=E.sections,C.push(F)}}else C=function(O,L){const F=[],N=O.text;let B=0;for(const V of L)F.push(O.substring(B,V)),B=V;return B<N.length&&F.push(O.substring(B,N.length)),F}(E,M);const P=[],I={positionedLines:P,text:E.toString(),top:g[1],bottom:g[1],left:g[0],right:g[0],writingMode:_,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(O,L,F,N,B,V,U,q,j,X,Q,nt){let Y=0,K=0,ot=0;const at="right"===q?1:"left"===q?0:.5;let lt=!1;for(const Ot of B){const Lt=Ot.getSections();for(const Ut of Lt){if(Ut.imageName)continue;const Gt=L[Ut.fontStack];if(Gt&&(lt=void 0!==Gt.ascender&&void 0!==Gt.descender,!lt))break}if(!lt)break}let dt=0;for(const Ot of B){Ot.trim();const Lt=Ot.getMaxScale(),Ut=(Lt-1)*Yi,Gt={positionedGlyphs:[],lineOffset:0};O.positionedLines[dt]=Gt;const me=Gt.positionedGlyphs;let ie=0;if(!Ot.length()){K+=V,++dt;continue}let Je=0,$e=0;for(let ue=0;ue<Ot.length();ue++){const oe=Ot.getSection(ue),He=Ot.getSectionIndex(ue),Ye=Ot.getCodePoint(ue);let we=oe.scale,Mn=null,ei=null,gn=null,Wn=Yi,ui=0;const ni=!(j===On.horizontal||!Q&&!J_(Ye)||Q&&(uh[Ye]||(ft=Ye,ee.Arabic(ft)||ee["Arabic Supplement"](ft)||ee["Arabic Extended-A"](ft)||ee["Arabic Presentation Forms-A"](ft)||ee["Arabic Presentation Forms-B"](ft))));if(oe.imageName){const Bn=N[oe.imageName];if(!Bn)continue;gn=oe.imageName,O.iconsInText=O.iconsInText||!0,ei=Bn.paddedRect;const Tn=Bn.displaySize;we=we*Yi/nt,Mn={width:Tn[0],height:Tn[1],left:0,top:-lf,advance:ni?Tn[1]:Tn[0],localGlyph:!1},ui=lt?-Mn.height*we:Hm+Lt*Yi-Tn[1]*we,Wn=Mn.advance;const ar=(ni?Tn[0]:Tn[1])*we-Yi*Lt;ar>0&&ar>ie&&(ie=ar)}else{const Bn=F[oe.fontStack];if(!Bn)continue;Bn[Ye]&&(ei=Bn[Ye]);const Tn=L[oe.fontStack];if(!Tn)continue;const ar=Tn.glyphs[Ye];if(!ar)continue;if(Mn=ar.metrics,Wn=8203!==Ye?Yi:0,lt){const Ba=void 0!==Tn.ascender?Math.abs(Tn.ascender):0,aa=void 0!==Tn.descender?Math.abs(Tn.descender):0,ja=(Ba+aa)*we;Je<ja&&(Je=ja,$e=(Ba-aa)/2*we),ui=-Ba*we}else ui=Hm+(Lt-we)*Yi}ni?(O.verticalizable=!0,me.push({glyph:Ye,imageName:gn,x:Y,y:K+ui,vertical:ni,scale:we,localGlyph:Mn.localGlyph,fontStack:oe.fontStack,sectionIndex:He,metrics:Mn,rect:ei}),Y+=Wn*we+X):(me.push({glyph:Ye,imageName:gn,x:Y,y:K+ui,vertical:ni,scale:we,localGlyph:Mn.localGlyph,fontStack:oe.fontStack,sectionIndex:He,metrics:Mn,rect:ei}),Y+=Mn.advance*we+X)}0!==me.length&&(ot=Math.max(Y-X,ot),lt?ww(me,at,ie,$e,V*Lt/2):ww(me,at,ie,0,V/2)),Y=0;const pe=V*Lt+ie;Gt.lineOffset=Math.max(ie,Ut),K+=pe,++dt}var ft;const gt=K,{horizontalAlign:ht,verticalAlign:yt}=uf(U);(function(Ot,Lt,Ut,Gt,me,ie){const Je=(Lt-Ut)*me,$e=-ie*Gt;for(const pe of Ot)for(const ue of pe.positionedGlyphs)ue.x+=Je,ue.y+=$e})(O.positionedLines,at,ht,yt,ot,gt),O.top+=-yt*gt,O.bottom=O.top+gt,O.left+=-ht*ot,O.right=O.left+ot,O.hasBaseline=lt}(I,t,n,s,C,u,d,f,_,p,v,b),!function(O){for(const L of O)if(0!==L.positionedGlyphs.length)return!1;return!0}(P)&&I}const uh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Dv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Mv(e,t,n,s,a,c){if(t.imageName){const u=s[t.imageName];return u?u.displaySize[0]*t.scale*Yi/c+a:0}{const u=n[t.fontStack],d=u&&u.glyphs[e];return d?d.metrics.advance*t.scale+a:0}}function Gm(e,t,n,s){const a=Math.pow(e-t,2);return s?e<t?a/2:2*a:a+Math.abs(n)*n}function uS(e,t,n){let s=0;return 10===e&&(s-=1e4),n&&(s+=150),40!==e&&65288!==e||(s+=50),41!==t&&65289!==t||(s+=50),s}function xw(e,t,n,s,a,c){let u=null,d=Gm(t,n,a,c);for(const f of s){const p=Gm(t-f.x,n,a,c)+f.badness;p<=d&&(u=f,d=p)}return{index:e,x:t,priorBreak:u,badness:d}}function bw(e){return e?bw(e.priorBreak).concat(e.index):[]}function uf(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function ww(e,t,n,s,a){if(!(t||n||s||a))return;const c=e.length-1,u=e[c],d=(u.x+u.metrics.advance*u.scale)*t;for(let f=0;f<=c;f++)e[f].x-=d,e[f].y+=n+s+a}function hS(e,t,n,s){const{horizontalAlign:a,verticalAlign:c}=uf(s),u=n[0]-e.displaySize[0]*a,d=n[1]-e.displaySize[1]*c;return{imagePrimary:e,imageSecondary:t,top:d,bottom:d+e.displaySize[1],left:u,right:u+e.displaySize[0]}}function Ew(e,t,n,s,a,c){const u=e.imagePrimary;let d;if(u.content){const C=u.content,M=u.pixelRatio||1;d=[C[0]/M,C[1]/M,u.displaySize[0]-C[2]/M,u.displaySize[1]-C[3]/M]}const f=t.left*c,p=t.right*c;let g,_,v,x;"width"===n||"both"===n?(x=a[0]+f-s[3],_=a[0]+p+s[1]):(x=a[0]+(f+p-u.displaySize[0])/2,_=x+u.displaySize[0]);const b=t.top*c,E=t.bottom*c;return"height"===n||"both"===n?(g=a[1]+b-s[0],v=a[1]+E+s[2]):(g=a[1]+(b+E-u.displaySize[1])/2,v=g+u.displaySize[1]),{imagePrimary:u,imageSecondary:void 0,top:g,right:_,bottom:v,left:x,collisionPadding:d}}class La extends et{constructor(t,n,s,a,c){super(t,n),this.angle=a,this.z=s,void 0!==c&&(this.segment=c)}clone(){return new La(this.x,this.y,this.z,this.angle,this.segment)}}function Tv(e,t,n,s,a){if(void 0===t.segment)return!0;let c=t,u=t.segment+1,d=0;for(;d>-n/2;){if(u--,u<0)return!1;d-=e[u].dist(c),c=e[u]}d+=e[u].dist(e[u+1]),u++;const f=[];let p=0;for(;d<n/2;){const g=e[u],_=e[u+1];if(!_)return!1;let v=e[u-1].angleTo(g)-g.angleTo(_);for(v=Math.abs((v+3*Math.PI)%(2*Math.PI)-Math.PI),f.push({distance:d,angleDelta:v}),p+=v;d-f[0].distance>s;)p-=f.shift().angleDelta;if(p>a)return!1;u++,d+=g.dist(_)}return!0}function Sv(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function Cw(e,t,n){return e?.6*t*n:0}function Dw(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function To(e,t,n,s,a,c){const u=Cw(n,a,c),d=Dw(n,s)*c;let f=0;const p=Sv(e)/2;for(let g=0;g<e.length-1;g++){const _=e[g],v=e[g+1],x=_.dist(v);if(f+x>p){const b=(p-f)/x,E=vt(_.x,v.x,b),C=vt(_.y,v.y,b),M=new La(E,C,0,v.angleTo(_),g);return!u||Tv(e,M,d,u,t)?M:void 0}f+=x}}function dS(e,t,n,s,a,c,u,d,f){const p=Cw(s,c,u),g=Dw(s,a),_=g*u,v=0===e[0].x||e[0].x===f||0===e[0].y||e[0].y===f;return t-_<t/4&&(t=_+t/4),Mw(e,v?t/2*d%t:(g/2+2*c)*u*d%t,t,p,n,_,v,!1,f)}function Mw(e,t,n,s,a,c,u,d,f){const p=c/2,g=Sv(e);let _=0,v=t-n,x=[];for(let b=0;b<e.length-1;b++){const E=e[b],C=e[b+1],M=E.dist(C),T=C.angleTo(E);for(;v+n<_+M;){v+=n;const R=(v-_)/M,P=vt(E.x,C.x,R),I=vt(E.y,C.y,R);if(P>=0&&P<f&&I>=0&&I<f&&v-p>=0&&v+p<=g){const O=new La(P,I,0,T,b);s&&!Tv(e,O,c,s,a)||x.push(O)}}_+=M}return d||x.length||u||(x=Mw(e,_/2,n,s,a,c,u,!0,f)),x}function fS(e,t,n,s,a){const c=[];for(let u=0;u<e.length;u++){const d=e[u];let f;for(let p=0;p<d.length-1;p++){let g=d[p],_=d[p+1];g.x<t&&_.x<t||(g.x<t?g=new et(t,g.y+(t-g.x)/(_.x-g.x)*(_.y-g.y))._round():_.x<t&&(_=new et(t,g.y+(t-g.x)/(_.x-g.x)*(_.y-g.y))._round()),g.y<n&&_.y<n||(g.y<n?g=new et(g.x+(n-g.y)/(_.y-g.y)*(_.x-g.x),n)._round():_.y<n&&(_=new et(g.x+(n-g.y)/(_.y-g.y)*(_.x-g.x),n)._round()),g.x>=s&&_.x>=s||(g.x>=s?g=new et(s,g.y+(s-g.x)/(_.x-g.x)*(_.y-g.y))._round():_.x>=s&&(_=new et(s,g.y+(s-g.x)/(_.x-g.x)*(_.y-g.y))._round()),g.y>=a&&_.y>=a||(g.y>=a?g=new et(g.x+(a-g.y)/(_.y-g.y)*(_.x-g.x),a)._round():_.y>=a&&(_=new et(g.x+(a-g.y)/(_.y-g.y)*(_.x-g.x),a)._round()),f&&g.equals(f[f.length-1])||(f=[g],c.push(f)),f.push(_)))))}}return c}function hf(e){let t=0,n=0;for(const u of e)t+=u.w*u.h,n=Math.max(n,u.w);e.sort((u,d)=>d.h-u.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let a=0,c=0;for(const u of e)for(let d=s.length-1;d>=0;d--){const f=s[d];if(!(u.w>f.w||u.h>f.h)){if(u.x=f.x,u.y=f.y,c=Math.max(c,u.y+u.h),a=Math.max(a,u.x+u.w),u.w===f.w&&u.h===f.h){const p=s.pop();d<s.length&&(s[d]=p)}else u.h===f.h?(f.x+=u.w,f.w-=u.w):u.w===f.w?(f.y+=u.h,f.h-=u.h):(s.push({x:f.x+u.w,y:f.y,w:f.w-u.w,h:u.h}),f.y+=u.h,f.h-=u.h);break}}return{w:a,h:c,fill:t/(a*c)||0}}Xt(La,"Anchor");const Zr=1;class Iv{constructor(t,{pixelRatio:n,version:s,stretchX:a,stretchY:c,content:u}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=a,this.stretchY=c,this.content=u,this.version=s}get tl(){return[this.paddedRect.x+Zr,this.paddedRect.y+Zr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Zr,this.paddedRect.y+this.paddedRect.h-Zr]}get displaySize(){return[(this.paddedRect.w-2*Zr)/this.pixelRatio,(this.paddedRect.h-2*Zr)/this.pixelRatio]}}class Tw{constructor(t,n){const s={},a={};this.haveRenderCallbacks=[];const c=[];this.addImages(t,s,c),this.addImages(n,a,c);const{w:u,h:d}=hf(c),f=new yi({width:u||1,height:d||1});for(const p in t){const g=t[p],_=s[p].paddedRect;yi.copy(g.data,f,{x:0,y:0},{x:_.x+Zr,y:_.y+Zr},g.data)}for(const p in n){const g=n[p],_=a[p].paddedRect,v=_.x+Zr,x=_.y+Zr,b=g.data.width,E=g.data.height;yi.copy(g.data,f,{x:0,y:0},{x:v,y:x},g.data),yi.copy(g.data,f,{x:0,y:E-1},{x:v,y:x-1},{width:b,height:1}),yi.copy(g.data,f,{x:0,y:0},{x:v,y:x+E},{width:b,height:1}),yi.copy(g.data,f,{x:b-1,y:0},{x:v-1,y:x},{width:1,height:E}),yi.copy(g.data,f,{x:0,y:0},{x:v+b,y:x},{width:1,height:E})}this.image=f,this.iconPositions=s,this.patternPositions=a}addImages(t,n,s){for(const a in t){const c=t[a],u={x:0,y:0,w:c.data.width+2*Zr,h:c.data.height+2*Zr};s.push(u),n[a]=new Iv(u,c),c.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(t,n,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>t.hasImage(a,s)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const a in t.getUpdatedImages(s))this.patchUpdatedImage(this.iconPositions[a],t.getImage(a,s),n),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a,s),n)}patchUpdatedImage(t,n,s){if(!t||!n||t.version===n.version)return;t.version=n.version;const[a,c]=t.tl;s.update(n.data,void 0,{x:a,y:c})}}Xt(Iv,"ImagePosition"),Xt(Tw,"ImageAtlas");const df=1e20;function Av(e,t,n,s,a,c,u,d,f){for(let p=t;p<t+s;p++)Sw(e,n*c+p,c,a,u,d,f);for(let p=n;p<n+a;p++)Sw(e,p*c+t,1,s,u,d,f)}function Sw(e,t,n,s,a,c,u){c[0]=0,u[0]=-df,u[1]=df,a[0]=e[t];for(let d=1,f=0,p=0;d<s;d++){a[d]=e[t+d*n];const g=d*d;do{const _=c[f];p=(a[d]-a[_]+g-_*_)/(d-_)/2}while(p<=u[f]&&--f>-1);f++,c[f]=d,u[f]=p,u[f+1]=df}for(let d=0,f=0;d<s;d++){for(;u[f+1]<d;)f++;const p=c[f],g=d-p;e[t+d*n]=a[p]+g*g}}const xs=2;class Al{constructor(t,n,s){this.requestManager=t,this.localGlyphMode=n,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,n){this.urls[n]=t}getGlyphs(t,n,s){const a=[],c=this.urls[n]||Le.GLYPHS_URL;for(const u in t)for(const d of t[u])a.push({stack:u,id:d});Kl(a,({stack:u,id:d},f)=>{let p=this.entries[u];p||(p=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let g=p.glyphs[d];if(void 0!==g)return void f(null,{stack:u,id:d,glyph:g});if(g=this._tinySDF(p,u,d),g)return p.glyphs[d]=g,void f(null,{stack:u,id:d,glyph:g});const _=Math.floor(d/256);if(256*_>65535)return void f(new Error("glyphs > 65535 not supported"));if(p.ranges[_])return void f(null,{stack:u,id:d,glyph:g});let v=p.requests[_];v||(v=p.requests[_]=[],Al.loadGlyphRange(u,_,c,this.requestManager,(x,b)=>{if(b){p.ascender=b.ascender,p.descender=b.descender;for(const E in b.glyphs)this._doesCharSupportLocalGlyph(+E)||(p.glyphs[+E]=b.glyphs[+E]);p.ranges[_]=!0}for(const E of v)E(x,b);delete p.requests[_]})),v.push((x,b)=>{x?f(x):b&&f(null,{stack:u,id:d,glyph:b.glyphs[d]||null})})},(u,d)=>{if(u)s(u);else if(d){const f={};for(const{stack:p,id:g,glyph:_}of d)void 0===f[p]&&(f[p]={}),void 0===f[p].glyphs&&(f[p].glyphs={}),f[p].glyphs[g]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics},f[p].ascender=this.entries[p].ascender,f[p].descender=this.entries[p].descender;s(null,f)}})}_doesCharSupportLocalGlyph(t){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localFontFamily:!!this.localFontFamily&&(ee["CJK Unified Ideographs"](t)||ee["Hangul Syllables"](t)||ee.Hiragana(t)||ee.Katakana(t)||ee["CJK Symbols and Punctuation"](t)||ee["CJK Unified Ideographs Extension A"](t)||ee["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,n,s){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(s))return;let c=t.tinySDF;if(!c){let E="400";/bold/i.test(n)?E="900":/medium/i.test(n)?E="500":/light/i.test(n)&&(E="200"),c=t.tinySDF=new Al.TinySDF({fontFamily:a,fontWeight:E,fontSize:24*xs,buffer:3*xs,radius:8*xs}),c.fontWeight=E}if(this.localGlyphs[c.fontWeight][s])return this.localGlyphs[c.fontWeight][s];const u=String.fromCodePoint(s),{data:d,width:f,height:p,glyphWidth:g,glyphHeight:_,glyphLeft:v,glyphTop:x,glyphAdvance:b}=c.draw(u);return this.localGlyphs[c.fontWeight][s]={id:s,bitmap:new _s({width:f,height:p},d),metrics:{width:g/xs,height:_/xs,left:v/xs,top:x/xs-27,advance:b/xs,localGlyph:!0}}}}Al.loadGlyphRange=function(e,t,n,s,a){const c=256*t,u=c+255,d=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}",`${c}-${u}`),pt.Glyphs);Nt(d,(f,p)=>{if(f)a(f);else if(p){const g={},_=new jm(p).readFields(re,{});for(const v of _.glyphs)g[v.id]=v;a(null,{glyphs:g,ascender:_.ascender,descender:_.descender})}})},Al.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:s=.25,fontFamily:a="sans-serif",fontWeight:c="normal",fontStyle:u="normal"}={}){this.buffer=t,this.cutoff=s,this.radius=n;const d=this.size=e+4*t,f=this._createCanvas(d),p=this.ctx=f.getContext("2d",{willReadFrequently:!0});p.font=`${u} ${c} ${e}px ${a}`,p.textBaseline="alphabetic",p.textAlign="left",p.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:a,actualBoundingBoxRight:c}=this.ctx.measureText(e),u=Math.ceil(n),d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-a))),f=Math.min(this.size-this.buffer,u+Math.ceil(s)),p=d+2*this.buffer,g=f+2*this.buffer,_=Math.max(p*g,0),v=new Uint8ClampedArray(_),x={data:v,width:p,height:g,glyphWidth:d,glyphHeight:f,glyphTop:u,glyphLeft:0,glyphAdvance:t};if(0===d||0===f)return x;const{ctx:b,buffer:E,gridInner:C,gridOuter:M}=this;b.clearRect(E,E,d,f),b.fillText(e,E,E+u);const T=b.getImageData(E,E,d,f);M.fill(df,0,_),C.fill(0,0,_);for(let R=0;R<f;R++)for(let P=0;P<d;P++){const I=T.data[4*(R*d+P)+3]/255;if(0===I)continue;const O=(R+E)*p+P+E;if(1===I)M[O]=0,C[O]=df;else{const L=.5-I;M[O]=L>0?L*L:0,C[O]=L<0?L*L:0}}Av(M,0,0,p,g,p,this.f,this.v,this.z),Av(C,E,E,d,f,p,this.f,this.v,this.z);for(let R=0;R<_;R++){const P=Math.sqrt(M[R])-Math.sqrt(C[R]);v[R]=Math.round(255-255*(P/this.radius+this.cutoff))}return x}};const Rl=Zr;function Iw(e,t,n,s){const a=[],c=e.imagePrimary,u=c.pixelRatio,d=c.paddedRect.w-2*Rl,f=c.paddedRect.h-2*Rl,p=e.right-e.left,g=e.bottom-e.top,_=c.stretchX||[[0,d]],v=c.stretchY||[[0,f]],x=(V,U)=>V+U[1]-U[0],b=_.reduce(x,0),E=v.reduce(x,0),C=d-b,M=f-E;let T=0,R=b,P=0,I=E,O=0,L=C,F=0,N=M;if(c.content&&s){const V=c.content;T=qm(_,0,V[0]),P=qm(v,0,V[1]),R=qm(_,V[0],V[2]),I=qm(v,V[1],V[3]),O=V[0]-T,F=V[1]-P,L=V[2]-V[0]-R,N=V[3]-V[1]-I}const B=(V,U,q,j)=>{const X=Zm(V.stretch-T,R,p,e.left),Q=So(V.fixed-O,L,V.stretch,b),nt=Zm(U.stretch-P,I,g,e.top),Y=So(U.fixed-F,N,U.stretch,E),K=Zm(q.stretch-T,R,p,e.left),ot=So(q.fixed-O,L,q.stretch,b),at=Zm(j.stretch-P,I,g,e.top),lt=So(j.fixed-F,N,j.stretch,E),dt=new et(X,nt),ft=new et(K,nt),gt=new et(K,at),ht=new et(X,at),yt=new et(Q/u,Y/u),Ot=new et(ot/u,lt/u),Lt=t*Math.PI/180;if(Lt){const $e=Math.sin(Lt),pe=Math.cos(Lt),ue=[pe,-$e,$e,pe];dt._matMult(ue),ft._matMult(ue),ht._matMult(ue),gt._matMult(ue)}const Ut=V.stretch+V.fixed,Gt=q.stretch+q.fixed,me=U.stretch+U.fixed,ie=j.stretch+j.fixed,Je=e.imageSecondary;return{tl:dt,tr:ft,bl:ht,br:gt,texPrimary:{x:c.paddedRect.x+Rl+Ut,y:c.paddedRect.y+Rl+me,w:Gt-Ut,h:ie-me},texSecondary:Je?{x:Je.paddedRect.x+Rl+Ut,y:Je.paddedRect.y+Rl+me,w:Gt-Ut,h:ie-me}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yt,pixelOffsetBR:Ot,minFontScaleX:L/u/p,minFontScaleY:N/u/g,isSDF:n}};if(s&&(c.stretchX||c.stretchY)){const V=Aw(_,C,b),U=Aw(v,M,E);for(let q=0;q<V.length-1;q++){const j=V[q],X=V[q+1];for(let Q=0;Q<U.length-1;Q++)a.push(B(j,U[Q],X,U[Q+1]))}}else a.push(B({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:d+1},{fixed:0,stretch:f+1}));return a}function qm(e,t,n){let s=0;for(const a of e)s+=Math.max(t,Math.min(n,a[1]))-Math.max(t,Math.min(n,a[0]));return s}function Aw(e,t,n){const s=[{fixed:-Rl,stretch:0}];for(const[a,c]of e){const u=s[s.length-1];s.push({fixed:a-u.stretch,stretch:u.stretch}),s.push({fixed:a-u.stretch,stretch:u.stretch+(c-a)})}return s.push({fixed:t+Rl,stretch:n}),s}function Zm(e,t,n,s){return e/t*n+s}function So(e,t,n,s){return e-t*n/s}function Rv(e,t,n,s){const a=t+e.positionedLines[s].lineOffset;return 0===s?n+a/2:n+(a+(t+e.positionedLines[s-1].lineOffset))/2}function pS(e,t=1,n=!1){let s=1/0,a=1/0,c=-1/0,u=-1/0;const d=e[0];for(let x=0;x<d.length;x++){const b=d[x];(!x||b.x<s)&&(s=b.x),(!x||b.y<a)&&(a=b.y),(!x||b.x>c)&&(c=b.x),(!x||b.y>u)&&(u=b.y)}const f=Math.min(c-s,u-a);let p=f/2;const g=new Ip([],Rw);if(0===f)return new et(s,a);for(let x=s;x<c;x+=f)for(let b=a;b<u;b+=f)g.push(new hh(x+p,b+p,p,e));let _=function(x){let b=0,E=0,C=0;const M=x[0];for(let T=0,R=M.length,P=R-1;T<R;P=T++){const I=M[T],O=M[P],L=I.x*O.y-O.x*I.y;E+=(I.x+O.x)*L,C+=(I.y+O.y)*L,b+=3*L}return new hh(E/b,C/b,0,x)}(e),v=g.length;for(;g.length;){const x=g.pop();(x.d>_.d||!_.d)&&(_=x,n&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,v)),x.max-_.d<=t||(p=x.h/2,g.push(new hh(x.p.x-p,x.p.y-p,p,e)),g.push(new hh(x.p.x+p,x.p.y-p,p,e)),g.push(new hh(x.p.x-p,x.p.y+p,p,e)),g.push(new hh(x.p.x+p,x.p.y+p,p,e)),v+=4)}return n&&(console.log(`num probes: ${v}`),console.log(`best distance: ${_.d}`)),_.p}function Rw(e,t){return t.max-e.max}class hh{constructor(t,n,s,a){this.p=new et(t,n),this.h=s,this.d=function(c,u){let d=!1,f=1/0;for(let p=0;p<u.length;p++){const g=u[p];for(let _=0,v=g.length,x=v-1;_<v;x=_++){const b=g[_],E=g[x];b.y>c.y!=E.y>c.y&&c.x<(E.x-b.x)*(c.y-b.y)/(E.y-b.y)+b.x&&(d=!d),f=Math.min(f,Jy(c,b,E))}}return(d?1:-1)*Math.sqrt(f)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const jc=7,Wm=Number.POSITIVE_INFINITY,Ym=Math.sqrt(2);function ff(e,[t,n]){let s=0,a=0;if(n===Wm){t<0&&(t=0);const c=t/Ym;switch(e){case"top-right":case"top-left":a=c-jc;break;case"bottom-right":case"bottom-left":a=-c+jc;break;case"bottom":a=-t+jc;break;case"top":a=t-jc}switch(e){case"top-right":case"bottom-right":s=-c;break;case"top-left":case"bottom-left":s=c;break;case"left":s=t;break;case"right":s=-t}}else{switch(t=Math.abs(t),n=Math.abs(n),e){case"top-right":case"top-left":case"top":a=n-jc;break;case"bottom-right":case"bottom-left":case"bottom":a=-n+jc}switch(e){case"top-right":case"bottom-right":case"right":s=-t;break;case"top-left":case"bottom-left":case"left":s=t}}return[s,a]}function gR(e,t,n,s,a,c,u,d,f,p,g){e.createArrays(),e.tilePixelRatio=ut/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const _=e.layers[0].layout,v=e.layers[0]._unevaluatedLayout._values,x={};if("composite"===e.textSizeData.kind){const{minZoom:M,maxZoom:T}=e.textSizeData;x.compositeTextSizes=[v["text-size"].possiblyEvaluate(new zn(M),d),v["text-size"].possiblyEvaluate(new zn(T),d)]}if("composite"===e.iconSizeData.kind){const{minZoom:M,maxZoom:T}=e.iconSizeData;x.compositeIconSizes=[v["icon-size"].possiblyEvaluate(new zn(M),d),v["icon-size"].possiblyEvaluate(new zn(T),d)]}x.layoutTextSize=v["text-size"].possiblyEvaluate(new zn(f+1),d),x.layoutIconSize=v["icon-size"].possiblyEvaluate(new zn(f+1),d),x.textMaxSize=v["text-size"].possiblyEvaluate(new zn(18),d);const b="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement"),E=_.get("text-size");let C=!1;for(const M of e.features)if(M.icon&&M.icon.nameSecondary){C=!0;break}for(const M of e.features){const T=_.get("text-font").evaluate(M,{},d).join(","),R=E.evaluate(M,{},d),P=x.layoutTextSize.evaluate(M,{},d),I=(x.layoutIconSize.evaluate(M,{},d),{horizontal:{},vertical:void 0}),O=M.text;let L,F=[0,0];if(O){const V=O.toString(),U=_.get("text-letter-spacing").evaluate(M,{},d)*Yi,q=_.get("text-line-height").evaluate(M,{},d)*Yi,j=iT(V)?U:0,X=_.get("text-anchor").evaluate(M,{},d),Q=_.get("text-variable-anchor");if(!Q){const at=_.get("text-radial-offset").evaluate(M,{},d);F=at?ff(X,[at*Yi,Wm]):_.get("text-offset").evaluate(M,{},d).map(lt=>lt*Yi)}let nt=b?"center":_.get("text-justify").evaluate(M,{},d);const Y="point"===_.get("symbol-placement"),K=Y?_.get("text-max-width").evaluate(M,{},d)*Yi:1/0,ot=at=>{e.allowVerticalPlacement&&Q_(V)&&(I.vertical=cf(O,t,n,a,T,K,q,X,at,j,F,On.vertical,!0,P,R))};if(!b&&Q){const at="auto"===nt?Q.map(dt=>Xm(dt)):[nt];let lt=!1;for(let dt=0;dt<at.length;dt++){const ft=at[dt];if(!I.horizontal[ft])if(lt)I.horizontal[ft]=I.horizontal[0];else{const gt=cf(O,t,n,a,T,K,q,"center",ft,j,F,On.horizontal,!1,P,R);gt&&(I.horizontal[ft]=gt,lt=1===gt.positionedLines.length)}}ot("left")}else{if("auto"===nt&&(nt=Xm(X)),Y||_.get("text-writing-mode").indexOf("horizontal")>=0||!Q_(V)){const at=cf(O,t,n,a,T,K,q,X,nt,j,F,On.horizontal,!1,P,R);at&&(I.horizontal[nt]=at)}ot(Y?"left":nt)}}let N=!1;if(M.icon&&M.icon.namePrimary){const V=s[M.icon.namePrimary];V&&(L=hS(a[M.icon.namePrimary],M.icon.nameSecondary?a[M.icon.nameSecondary]:void 0,_.get("icon-offset").evaluate(M,{},d),_.get("icon-anchor").evaluate(M,{},d)),N=V.sdf,void 0===e.sdfIcons?e.sdfIcons=V.sdf:e.sdfIcons!==V.sdf&&tt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(V.pixelRatio!==e.pixelRatio||0!==_.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const B=Ys(I.horizontal)||I.vertical;e.iconsInText||(e.iconsInText=!!B&&B.iconsInText),(B||L)&&Pw(e,M,I,L,s,x,P,0,F,N,u,d,p,g,C)}c&&e.generateCollisionDebugBuffers(f,e.collisionBoxArray)}function Xm(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pw(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b){let E=c.textMaxSize.evaluate(t,{},_);void 0===E&&(E=u);const C=e.layers[0].layout,M=C.get("icon-offset").evaluate(t,{},_),T=Ys(n.horizontal)||n.vertical,R="globe"===v.name,P=Yi,I=u/P,O=e.tilePixelRatio*E/P,L=(X=e.overscaling,e.zoom>18&&X>2&&(X>>=1),Math.max(ut/(512*X),1)*C.get("symbol-spacing")),F=C.get("text-padding")*e.tilePixelRatio,N=C.get("icon-padding")*e.tilePixelRatio,B=De(C.get("text-max-angle")),V="map"===C.get("text-rotation-alignment")&&"point"!==C.get("symbol-placement"),U="map"===C.get("icon-rotation-alignment")&&"point"!==C.get("symbol-placement"),q=C.get("symbol-placement"),j=L/2;var X;const Q=C.get("icon-text-fit").evaluate(t,{},_),nt=C.get("icon-text-fit-padding").evaluate(t,{},_),Y="none"!==Q;let K;!1===e.hasAnyIconTextFit&&Y&&(e.hasAnyIconTextFit=!0),s&&Y&&(e.allowVerticalPlacement&&n.vertical&&(K=Ew(s,n.vertical,Q,nt,M,I)),T&&(s=Ew(s,T,Q,nt,M,I)));const ot=(at,lt,dt)=>{if(lt.x<0||lt.x>=ut||lt.y<0||lt.y>=ut)return;let ft=null;if(R){const{x:gt,y:ht,z:yt}=v.projectTilePoint(lt.x,lt.y,dt);ft={anchor:new La(gt,ht,yt,0,void 0),up:v.upVector(dt,lt.x,lt.y)}}!function(gt,ht,yt,Ot,Lt,Ut,Gt,me,ie,Je,$e,pe,ue,oe,He,Ye,we,Mn,ei,gn,Wn,ui,ni,Bn,Tn,ar,Ba){const aa=gt.addToLineVertexArray(ht,Ot);let ja,ip,rp,Xg,Cx,Dx,Mx,vD=0,xD=0,Tx=0,op=0,bD=-1,Kg=-1;const go={};let wD=uy("");const iu=yt?yt.anchor:ht,ED="none"!==ie.layout.get("icon-text-fit").evaluate(Wn,{},Tn);let CD=0,Sx=0;if(void 0===ie._unevaluatedLayout.getValue("text-radial-offset")?[CD,Sx]=ie.layout.get("text-offset").evaluate(Wn,{},Tn).map(Kr=>Kr*Yi):(CD=ie.layout.get("text-radial-offset").evaluate(Wn,{},Tn)*Yi,Sx=Wm),gt.allowVerticalPlacement&&Lt.vertical){const Kr=Lt.vertical;if(He)Dx=Pv(Kr),me&&(Mx=Pv(me));else{const Qr=ie.layout.get("text-rotate").evaluate(Wn,{},Tn)+90;rp=Qm(Je,iu,ht,$e,pe,ue,Kr,oe,Qr,Ye),me&&(Xg=Qm(Je,iu,ht,$e,pe,ue,me,Mn,Qr))}}if(Ut){const Kr=ie.layout.get("icon-rotate").evaluate(Wn,{},Tn),Qr=Iw(Ut,Kr,ni,ED),Vh=me?Iw(me,Kr,ni,ED):void 0;ip=Qm(Je,iu,ht,$e,pe,ue,Ut,Mn,Kr),vD=4*Qr.length;const Ax=gt.iconSizeData;let Hl=null;"source"===Ax.kind?(Hl=[co*ie.layout.get("icon-size").evaluate(Wn,{},Tn)],Hl[0]>Fa&&tt(`${gt.layerIds[0]}: Value for "icon-size" is >= ${dh}. Reduce your "icon-size".`)):"composite"===Ax.kind&&(Hl=[co*ui.compositeIconSizes[0].evaluate(Wn,{},Tn),co*ui.compositeIconSizes[1].evaluate(Wn,{},Tn)],(Hl[0]>Fa||Hl[1]>Fa)&&tt(`${gt.layerIds[0]}: Value for "icon-size" is >= ${dh}. Reduce your "icon-size".`)),gt.addSymbols(gt.icon,Qr,Hl,gn,ei,Wn,!1,yt,ht,aa.lineStartIndex,aa.lineLength,-1,Bn,Tn,ar,Ba),bD=gt.icon.placedSymbolArray.length-1,Vh&&(xD=4*Vh.length,gt.addSymbols(gt.icon,Vh,Hl,gn,ei,Wn,On.vertical,yt,ht,aa.lineStartIndex,aa.lineLength,-1,Bn,Tn,ar,Ba),Kg=gt.icon.placedSymbolArray.length-1)}for(const Kr in Lt.horizontal){const Qr=Lt.horizontal[Kr];ja||(wD=uy(Qr.text),He?Cx=Pv(Qr):ja=Qm(Je,iu,ht,$e,pe,ue,Qr,oe,ie.layout.get("text-rotate").evaluate(Wn,{},Tn),Ye));const Vh=1===Qr.positionedLines.length;if(Tx+=Km(gt,yt,ht,Qr,Gt,ie,He,Wn,Ye,aa,Lt.vertical?On.horizontal:On.horizontalOnly,Vh?Object.keys(Lt.horizontal):[Kr],go,bD,ui,Bn,Tn,ar),Vh)break}Lt.vertical&&(op+=Km(gt,yt,ht,Lt.vertical,Gt,ie,He,Wn,Ye,aa,On.vertical,["vertical"],go,Kg,ui,Bn,Tn,ar));let $l=-1;const Ix=(Kr,Qr)=>Kr?Math.max(Kr,Qr):Qr;$l=Ix(Cx,$l),$l=Ix(Dx,$l),$l=Ix(Mx,$l);const EA=$l>-1?1:0;gt.glyphOffsetArray.length>=vh.MAX_GLYPHS&&tt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Wn.sortKey&&gt.addToSortKeyRanges(gt.symbolInstances.length,Wn.sortKey),gt.symbolInstances.emplaceBack(ht.x,ht.y,iu.x,iu.y,iu.z,go.right>=0?go.right:-1,go.center>=0?go.center:-1,go.left>=0?go.left:-1,go.vertical>=0?go.vertical:-1,bD,Kg,wD,void 0!==ja?ja:gt.collisionBoxArray.length,void 0!==ja?ja+1:gt.collisionBoxArray.length,void 0!==rp?rp:gt.collisionBoxArray.length,void 0!==rp?rp+1:gt.collisionBoxArray.length,void 0!==ip?ip:gt.collisionBoxArray.length,void 0!==ip?ip+1:gt.collisionBoxArray.length,Xg||gt.collisionBoxArray.length,Xg?Xg+1:gt.collisionBoxArray.length,$e,Tx,op,vD,xD,EA,0,CD,Sx,$l,0,ED?1:0)}(e,lt,ft,at,n,s,a,K,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,F,V,f,0,N,U,M,t,c,p,g,_,x,b)};if("line"===q)for(const at of fS(t.geometry,0,0,ut,ut)){const lt=dS(at,L,B,n.vertical||T,s,P,O,e.overscaling,ut);for(const dt of lt)T&&Ov(e,T.text,j,dt)||ot(at,dt,_)}else if("line-center"===q){for(const at of t.geometry)if(at.length>1){const lt=To(at,B,n.vertical||T,s,P,O);lt&&ot(at,lt,_)}}else if("Polygon"===t.type)for(const at of cv(t.geometry,0)){const lt=pS(at,16);ot(at[0],new La(lt.x,lt.y,0,0,void 0),_)}else if("LineString"===t.type)for(const at of t.geometry)ot(at,new La(at[0].x,at[0].y,0,0,void 0),_);else if("Point"===t.type)for(const at of t.geometry)for(const lt of at)ot([lt],new La(lt.x,lt.y,0,0,void 0),_)}const dh=255,Fa=dh*co;function Km(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C,M){const T=function(I,O,L,F,N,B,V,U){const q=[];if(0===O.positionedLines.length)return q;const j=F.layout.get("text-rotate").evaluate(B,{})*Math.PI/180,X=function(ot){const at=ot[0],lt=ot[1],dt=at*lt;return dt>0?[at,-lt]:dt<0?[-at,lt]:0===at?[lt,at]:[lt,-at]}(L);let Q=Math.abs(O.top-O.bottom);for(const ot of O.positionedLines)Q-=ot.lineOffset;const nt=O.positionedLines.length,Y=Q/nt;let K=O.top-L[1];for(let ot=0;ot<nt;++ot){const at=O.positionedLines[ot];K=Rv(O,Y,K,ot);for(const lt of at.positionedGlyphs){if(!lt.rect)continue;const dt=lt.rect||{};let ft=lf+1,gt=!0,ht=1,yt=0;if(lt.imageName){const gn=V[lt.imageName];if(!gn)continue;if(gn.sdf){tt("SDF images are not supported in formatted text and will be ignored.");continue}gt=!1,ht=gn.pixelRatio,ft=Zr/ht}const Ot=(N||U)&&lt.vertical,Lt=lt.metrics.advance*lt.scale/2,Ut=lt.metrics,Gt=lt.rect;if(null===Gt)continue;U&&O.verticalizable&&(yt=lt.imageName?Lt-lt.metrics.width*lt.scale/2:0);const me=N?[lt.x+Lt,lt.y]:[0,0];let ie=[0,0],Je=[0,0],$e=!1;N||(Ot?(Je=[lt.x+Lt+X[0],lt.y+X[1]-yt],$e=!0):ie=[lt.x+Lt+L[0],lt.y+L[1]-yt]);const pe=Gt.w*lt.scale/(ht*(lt.localGlyph?xs:1)),ue=Gt.h*lt.scale/(ht*(lt.localGlyph?xs:1));let oe,He,Ye,we;if(Ot){const gn=lt.y-K,Wn=new et(-Lt,Lt-gn),ui=-Math.PI/2,ni=new et(...Je);oe=new et(-Lt+ie[0],ie[1]),oe._rotateAround(ui,Wn)._add(ni),oe.x+=-gn+Lt,oe.y-=(Ut.left-ft)*lt.scale;const Bn=lt.imageName?Ut.advance*lt.scale:Yi*lt.scale,Tn=String.fromCodePoint(lt.glyph);ln(Tn)?oe.x+=(1-ft)*lt.scale:lS(Tn)?oe.x+=Bn-Ut.height*lt.scale+(-ft-1)*lt.scale:oe.x+=lt.imageName||Ut.width+2*ft===Gt.w&&Ut.height+2*ft===Gt.h?(Bn-ue)/2:(Bn-(Ut.height+2*ft)*lt.scale)/2,He=new et(oe.x,oe.y-pe),Ye=new et(oe.x+ue,oe.y),we=new et(oe.x+ue,oe.y-pe)}else{const gn=(Ut.left-ft)*lt.scale-Lt+ie[0],Wn=(-Ut.top-ft)*lt.scale+ie[1],ui=gn+pe,ni=Wn+ue;oe=new et(gn,Wn),He=new et(ui,Wn),Ye=new et(gn,ni),we=new et(ui,ni)}if(j){let gn;gn=N?new et(0,0):$e?new et(X[0],X[1]):new et(L[0],L[1]),oe._rotateAround(j,gn),He._rotateAround(j,gn),Ye._rotateAround(j,gn),we._rotateAround(j,gn)}const Mn=new et(0,0),ei=new et(0,0);q.push({tl:oe,tr:He,bl:Ye,br:we,texPrimary:dt,texSecondary:void 0,writingMode:O.writingMode,glyphOffset:me,sectionIndex:lt.sectionIndex,isSDF:gt,pixelOffsetTL:Mn,pixelOffsetBR:ei,minFontScaleX:0,minFontScaleY:0})}}return q}(0,s,f,c,u,d,a,e.allowVerticalPlacement),R=e.textSizeData;let P=null;"source"===R.kind?(P=[co*c.layout.get("text-size").evaluate(d,{},C)],P[0]>Fa&&tt(`${e.layerIds[0]}: Value for "text-size" is >= ${dh}. Reduce your "text-size".`)):"composite"===R.kind&&(P=[co*b.compositeTextSizes[0].evaluate(d,{},C),co*b.compositeTextSizes[1].evaluate(d,{},C)],(P[0]>Fa||P[1]>Fa)&&tt(`${e.layerIds[0]}: Value for "text-size" is >= ${dh}. Reduce your "text-size".`)),e.addSymbols(e.text,T,P,f,u,d,g,t,n,p.lineStartIndex,p.lineLength,x,E,C,M,!1);for(const I of _)v[I]=e.text.placedSymbolArray.length-1;return 4*T.length}function Ys(e){for(const t in e)return e[t];return null}function Qm(e,t,n,s,a,c,u,d,f,p){let g=u.top,_=u.bottom,v=u.left,x=u.right;const b=u.collisionPadding;if(b&&(v-=b[0],g-=b[1],x+=b[2],_+=b[3]),f){const E=new et(v,g),C=new et(x,g),M=new et(v,_),T=new et(x,_),R=De(f);let P=new et(0,0);p&&(P=new et(p[0],p[1])),E._rotateAround(R,P),C._rotateAround(R,P),M._rotateAround(R,P),T._rotateAround(R,P),v=Math.min(E.x,C.x,M.x,T.x),x=Math.max(E.x,C.x,M.x,T.x),g=Math.min(E.y,C.y,M.y,T.y),_=Math.max(E.y,C.y,M.y,T.y)}return e.emplaceBack(t.x,t.y,t.z,n.x,n.y,v,g,x,_,d,s,a,c),e.length-1}function Pv(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function Ov(e,t,n,s){const a=e.compareText;if(t in a){const c=a[t];for(let u=c.length-1;u>=0;u--)if(s.dist(c[u])<n)return!0}else a[t]=[];return a[t].push(s),!1}function Ow(e,t){const n=e.fovAboveCenter,s=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,a=(e._camera.position[2]*e.worldSize-s)/Math.cos(e._pitch),c=Math.sin(n)*a/Math.sin(Math.max(Math.PI/2-e._pitch-n,.01)),u=Math.sin(e._pitch)*c+a;return Math.min(1.01*u,a*(1/e._horizonShift))}function Pl(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const n=Math.pow(2,-e.z),s=e.x*n,a=(e.x+1)*n,c=e.y*n,u=(e.y+1)*n,d=or(s),f=or(a),p=Ei(c),g=Ei(u),_=t.project(d,p),v=t.project(f,p),x=t.project(f,g),b=t.project(d,g);let E=Math.min(_.x,v.x,x.x,b.x),C=Math.min(_.y,v.y,x.y,b.y),M=Math.max(_.x,v.x,x.x,b.x),T=Math.max(_.y,v.y,x.y,b.y);const R=n/16;function P(O,L,F,N,B,V){const U=(F+B)/2,q=(N+V)/2,j=t.project(or(U),Ei(q)),X=Math.max(0,E-j.x,C-j.y,j.x-M,j.y-T);E=Math.min(E,j.x),M=Math.max(M,j.x),C=Math.min(C,j.y),T=Math.max(T,j.y),X>R&&(P(O,j,F,N,U,q),P(j,L,U,q,B,V))}P(_,v,s,c,a,c),P(v,x,a,c,a,u),P(x,b,a,u,s,u),P(b,_,s,u,s,c),E-=R,C-=R,M+=R,T+=R;const I=1/Math.max(M-E,T-C);return{scale:I,x:E*I,y:C*I,x2:M*I,y2:T*I,projection:t}}function kw(e,t,n,s,a,c,u,d,f){if("globe"===f.name)return qs(e,t,new oo(n,s,a),!1);const p=Pl({z:n,x:s,y:a},f);return new qn([(c+p.x/p.scale)*t,t*(p.y/p.scale),u],[(c+p.x2/p.scale)*t,t*(p.y2/p.scale),d])}function pf(e,{x:t,y:n},s=0){return new et(((t-s)*e.scale-e.x)*ut,(n*e.scale-e.y)*ut)}function fh(e,t,n=0){return G.fromValues(((t.x-n)*e.scale-e.x)*ut,(t.y*e.scale-e.y)*ut,qb(t.z,t.y))}const Lw=it.identity(new Float32Array(16));class bs{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,n){return{x:0,y:0,z:0}}unproject(t,n){return new ve(0,0)}projectTilePoint(t,n,s){return{x:t,y:n,z:0}}locationPoint(t,n,s=!0){return t._coordinatePoint(t.locationCoordinate(n),s)}pixelsPerMeter(t,n){return An(1,t)*n}pixelSpaceConversion(t,n,s){return 1}farthestPixelDistance(t){return Ow(t,t.pixelsPerMeter)}pointCoordinate(t,n,s,a){const c=t.horizonLineFromTop(!1),u=new et(n,Math.max(c,s));return t.rayIntersectionCoordinate(t.pointRayIntersection(u,a))}pointCoordinate3D(t,n,s){const a=new et(n,s);if(t.elevation)return t.elevation.pointCoordinate(a);{const c=this.pointCoordinate(t,a.x,a.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(t,n){if(t.elevation)return!this.pointCoordinate3D(t,n.x,n.y);const s=t.horizonLineFromTop();return n.y<s}createInversionMatrix(t,n){return Lw}createTileMatrix(t,n,s){let a,c,u;const d=s.canonical,f=it.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const p=Pl(d,this);a=1,c=p.x+s.wrap*p.scale,u=p.y,it.scale(f,f,[a/p.scale,a/p.scale,t.pixelsPerMeter/n])}else a=n/t.zoomScale(d.z),c=(d.x+Math.pow(2,d.z)*s.wrap)*a,u=d.y*a;return it.translate(f,f,[c,u,0]),it.scale(f,f,[a/ut,a/ut,1]),f}upVector(t,n,s){return[0,0,1]}upVectorScale(t,n,s){return{metersToTile:1}}}class _R extends bs{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[n,s]=this.parallels=t.parallels||[29.5,45.5],a=Math.sin(De(n));this.n=(a+Math.sin(De(s)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(t,n){const{n:s,c:a,r0:c}=this,u=De(t-this.center[0]),d=De(n),f=Math.sqrt(a-2*s*Math.sin(d))/s;return{x:f*Math.sin(u*s),y:f*Math.cos(u*s)-c,z:0}}unproject(t,n){const{n:s,c:a,r0:c}=this,u=c+n;let d=Math.atan2(t,Math.abs(u))*Math.sign(u);u*s<0&&(d-=Math.PI*Math.sign(t)*Math.sign(u));const f=De(this.center[0])*s;d=Os(d,-Math.PI-f,Math.PI-f);const p=Qt(ki(d/s)+this.center[0],-180,180),g=Math.asin(Qt((a-(t*t+u*u)*s*s)/(2*s),-1,1)),_=Qt(ki(g),-li,li);return new ve(p,_)}}const mf=1.340264,ph=-.081106,mh=893e-6,gf=.003796,Jm=Math.sqrt(3)/2;class Fw extends bs{project(t,n){n=n/180*Math.PI,t=t/180*Math.PI;const s=Math.asin(Jm*Math.sin(n)),a=s*s,c=a*a*a;return{x:.5*(t*Math.cos(s)/(Jm*(mf+3*ph*a+c*(7*mh+9*gf*a)))/Math.PI+.5),y:1-.5*(s*(mf+ph*a+c*(mh+gf*a))/Math.PI+1),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,a=s*s,c=a*a*a;for(let g,_,v,x=0;x<12&&(_=s*(mf+ph*a+c*(mh+gf*a))-n,v=mf+3*ph*a+c*(7*mh+9*gf*a),g=_/v,s=Qt(s-g,-Math.PI/3,Math.PI/3),a=s*s,c=a*a*a,!(Math.abs(g)<1e-12));++x);const u=Jm*t*(mf+3*ph*a+c*(7*mh+9*gf*a))/Math.cos(s),d=Math.asin(Math.sin(s)/Jm),f=Qt(180*u/Math.PI,-180,180),p=Qt(180*d/Math.PI,-li,li);return new ve(f,p)}}class Nw extends bs{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,n){return{x:.5+t/360,y:.5-n/360,z:0}}unproject(t,n){const s=360*(t-.5),a=Qt(360*(.5-n),-li,li);return new ve(s,a)}}const Xs=Math.PI/2;function tg(e){return Math.tan((Xs+e)/2)}class zw extends bs{constructor(t){super(t),this.center=t.center||[0,30];const[n,s]=this.parallels=t.parallels||[30,30];let a=De(n),c=De(s);this.southernCenter=a+c<0,this.southernCenter&&(a=-a,c=-c);const u=Math.cos(a),d=tg(a);this.n=a===c?Math.sin(a):Math.log(u/Math.cos(c))/Math.log(tg(c)/d),this.f=u*Math.pow(tg(a),this.n)/this.n}project(t,n){n=De(n),this.southernCenter&&(n=-n),t=De(t-this.center[0]);const s=1e-6,{n:a,f:c}=this;c>0?n<-Xs+s&&(n=-Xs+s):n>Xs-s&&(n=Xs-s);const u=c/Math.pow(tg(n),a);let d=u*Math.sin(a*t),f=c-u*Math.cos(a*t);return d=.5*(d/Math.PI+.5),f=.5*(f/Math.PI+.5),{x:d,y:this.southernCenter?f:1-f,z:0}}unproject(t,n){t=(2*t-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:s,f:a}=this,c=a-n,u=Math.sign(c),d=Math.sign(s)*Math.sqrt(t*t+c*c);let f=Math.atan2(t,Math.abs(c))*u;c*s<0&&(f-=Math.PI*Math.sign(t)*u);const p=Qt(ki(f/s)+this.center[0],-180,180),g=Qt(ki(2*Math.atan(Math.pow(a/d,1/s))-Xs),-li,li);return new ve(p,this.southernCenter?-g:g)}}class kv extends bs{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,n){return{x:Ri(t),y:wi(n),z:0}}unproject(t,n){const s=or(t),a=Ei(n);return new ve(s,a)}}const Bw=De(li);class mS extends bs{project(t,n){const s=(n=De(n))*n,a=s*s;return{x:.5*((t=De(t))*(.8707-.131979*s+a*(a*(.003971*s-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+a*(.028874*s-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,a=25,c=0,u=s*s;do{u=s*s;const p=u*u;c=(s*(1.007226+u*(.015085+p*(.028874*u-.044475-.005916*p)))-n)/(1.007226+u*(.045255+p*(.259866*u-.311325-.005916*11*p))),s=Qt(s-c,-Bw,Bw)}while(Math.abs(c)>1e-6&&--a>0);u=s*s;const d=Qt(ki(t/(.8707+u*(u*(u*u*u*(.003971-.001529*u)-.013791)-.131979))),-180,180),f=ki(s);return new ve(d,f)}}const gh=De(li);class gS extends bs{project(t,n){n=De(n),t=De(t);const s=Math.cos(n),a=2/Math.PI,c=Math.acos(s*Math.cos(t/2)),u=Math.sin(c)/c,d=.5*(t*a+2*s*Math.sin(t/2)/u)||0,f=.5*(n+Math.sin(n)/u)||0;return{x:.5*(d/Math.PI+.5),y:1-.5*(f/Math.PI+1),z:0}}unproject(t,n){let s=t=(2*t-.5)*Math.PI,a=n=(2*(1-n)-1)*Math.PI,c=25;const u=1e-6;let d=0,f=0;do{const p=Math.cos(a),g=Math.sin(a),_=2*g*p,v=g*g,x=p*p,b=Math.cos(s/2),E=Math.sin(s/2),C=2*b*E,M=E*E,T=1-x*b*b,R=T?1/T:0,P=T?Math.acos(p*b)*Math.sqrt(1/T):0,I=.5*(2*P*p*E+2*s/Math.PI)-t,O=.5*(P*g+a)-n,L=.5*R*(x*M+P*p*b*v)+1/Math.PI,F=R*(C*_/4-P*g*E),N=.125*R*(_*E-P*g*x*C),B=.5*R*(v*b+P*M*p)+.5,V=F*N-B*L;d=(O*F-I*B)/V,f=(I*N-O*L)/V,s=Qt(s-d,-Math.PI,Math.PI),a=Qt(a-f,-gh,gh)}while((Math.abs(d)>u||Math.abs(f)>u)&&--c>0);return new ve(ki(s),ki(a))}}class jw extends bs{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(De(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,n){const{scale:s,cosPhi:a}=this;return{x:De(t)*a*s+.5,y:-Math.sin(De(n))/a*s+.5,z:0}}unproject(t,n){const{scale:s,cosPhi:a}=this,c=-(n-.5)/s,u=Qt(ki((t-.5)/s)/a,-180,180),d=Math.asin(Qt(c*a,-1,1)),f=Qt(ki(d),-li,li);return new ve(u,f)}}class _S extends kv{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,n,s){const a=ym(t,n,s),c=Aa(Mo(s));return G.transformMat4(a,a,c),{x:a[0],y:a[1],z:a[2]}}locationPoint(t,n){const s=lo(n.lat,n.lng),a=G.normalize([],s),c=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(n),t._centerAltitude):t._centerAltitude,u=An(1,0)*ut*c;G.scaleAndAdd(s,s,a,u);const d=it.identity(new Float64Array(16));return it.multiply(d,t.pixelMatrix,t.globeMatrix),G.transformMat4(s,s,d),new et(s[0],s[1])}pixelsPerMeter(t,n){return An(1,0)*n}pixelSpaceConversion(t,n,s){const a=An(1,t)*n,c=vt(An(1,45)*n,a,s);return this.pixelsPerMeter(t,n)/c}createTileMatrix(t,n,s){const a=jy(Mo(s.canonical));return it.multiply(new Float64Array(16),t.globeMatrix,a)}createInversionMatrix(t,n){const{center:s}=t,a=Aa(Mo(n));return it.rotateY(a,a,De(s.lng)),it.rotateX(a,a,De(s.lat)),it.scale(a,a,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(t,n,s,a){return Fy(t,n,s,!0)||new We(0,0)}pointCoordinate3D(t,n,s){const a=this.pointCoordinate(t,n,s,0);return[a.x,a.y,a.z]}isPointAboveHorizon(t,n){return!Fy(t,n.x,n.y,!1)}farthestPixelDistance(t){const n=function(a,c){const u=a.cameraToCenterDistance,d=a._centerAltitude*c,f=a._camera,p=a._camera.forward(),g=G.add([],G.scale([],p,-u),[0,0,d]),_=a.worldSize/(2*Math.PI),v=[0,0,-_],x=a.width/a.height,b=Math.tan(a.fovAboveCenter),E=G.scale([],f.up(),b),C=G.scale([],f.right(),b*x),M=G.normalize([],G.add([],G.add([],p,E),C)),T=[];let R;if(new gm(g,M).closestPointOnSphere(v,_,T)){const P=G.add([],T,v),I=G.sub([],P,g);R=Math.cos(a.fovAboveCenter)*G.length(I)}else{const P=G.sub([],g,v),I=G.sub([],v,g);G.normalize(I,I);const O=G.length(P)-_;R=Math.sqrt(O*(O+2*_));const L=Math.acos(R/(_+O))-Math.acos(G.dot(p,I));R*=Math.cos(L)}return 1.01*R}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),s=ti(t.zoom);if(s>0){const a=Ow(t,An(1,t.center.lat)*t.worldSize),c=t.worldSize/(2*Math.PI),u=Math.max(t.width,t.height)/t.worldSize*Math.PI;return vt(n,a+c*(1-Math.cos(u)),Math.pow(s,10))}return n}upVector(t,n,s){return ym(n,s,t,1)}upVectorScale(t){return{metersToTile:qd(By(Mo(t)))}}}function eg(e){const t=e.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new kv(e);case"equirectangular":return new Nw(e);case"naturalEarth":return new mS(e);case"equalEarth":return new Fw(e);case"winkelTripel":return new gS(e);case"albers":return n?new jw(e):new _R(e);case"lambertConformalConic":return n?new jw(e):new zw(e);case"globe":return new _S(e)}throw new Error(`Invalid projection name: ${e.name}`)}const yS=new Xn({"symbol-placement":new wt(rt.layout_symbol["symbol-placement"]),"symbol-spacing":new wt(rt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wt(rt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new se(rt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wt(rt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new wt(rt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new wt(rt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new wt(rt.layout_symbol["icon-ignore-placement"]),"icon-optional":new wt(rt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wt(rt.layout_symbol["icon-rotation-alignment"]),"icon-size":new se(rt.layout_symbol["icon-size"]),"icon-text-fit":new se(rt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new se(rt.layout_symbol["icon-text-fit-padding"]),"icon-image":new se(rt.layout_symbol["icon-image"]),"icon-rotate":new se(rt.layout_symbol["icon-rotate"]),"icon-padding":new wt(rt.layout_symbol["icon-padding"]),"icon-keep-upright":new wt(rt.layout_symbol["icon-keep-upright"]),"icon-offset":new se(rt.layout_symbol["icon-offset"]),"icon-anchor":new se(rt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wt(rt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wt(rt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wt(rt.layout_symbol["text-rotation-alignment"]),"text-field":new se(rt.layout_symbol["text-field"]),"text-font":new se(rt.layout_symbol["text-font"]),"text-size":new se(rt.layout_symbol["text-size"]),"text-max-width":new se(rt.layout_symbol["text-max-width"]),"text-line-height":new se(rt.layout_symbol["text-line-height"]),"text-letter-spacing":new se(rt.layout_symbol["text-letter-spacing"]),"text-justify":new se(rt.layout_symbol["text-justify"]),"text-radial-offset":new se(rt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wt(rt.layout_symbol["text-variable-anchor"]),"text-anchor":new se(rt.layout_symbol["text-anchor"]),"text-max-angle":new wt(rt.layout_symbol["text-max-angle"]),"text-writing-mode":new wt(rt.layout_symbol["text-writing-mode"]),"text-rotate":new se(rt.layout_symbol["text-rotate"]),"text-padding":new wt(rt.layout_symbol["text-padding"]),"text-keep-upright":new wt(rt.layout_symbol["text-keep-upright"]),"text-transform":new se(rt.layout_symbol["text-transform"]),"text-offset":new se(rt.layout_symbol["text-offset"]),"text-allow-overlap":new wt(rt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new wt(rt.layout_symbol["text-ignore-placement"]),"text-optional":new wt(rt.layout_symbol["text-optional"]),visibility:new wt(rt.layout_symbol.visibility)});var Lv={paint:new Xn({"icon-opacity":new se(rt.paint_symbol["icon-opacity"]),"icon-emissive-strength":new se(rt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new se(rt.paint_symbol["text-emissive-strength"]),"icon-color":new se(rt.paint_symbol["icon-color"]),"icon-halo-color":new se(rt.paint_symbol["icon-halo-color"]),"icon-halo-width":new se(rt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new se(rt.paint_symbol["icon-halo-blur"]),"icon-translate":new wt(rt.paint_symbol["icon-translate"]),"icon-translate-anchor":new wt(rt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new se(rt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new se(rt.paint_symbol["text-opacity"]),"text-color":new se(rt.paint_symbol["text-color"],{runtimeType:ns,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new se(rt.paint_symbol["text-halo-color"]),"text-halo-width":new se(rt.paint_symbol["text-halo-width"]),"text-halo-blur":new se(rt.paint_symbol["text-halo-blur"]),"text-translate":new wt(rt.paint_symbol["text-translate"]),"text-translate-anchor":new wt(rt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new wt(rt.paint_symbol["icon-color-saturation"])}),layout:yS};class Vw{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Qh,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xt(Vw,"FormatSectionOverride",{omit:["defaultValue"]});class ng extends Co{constructor(t,n){super(t,Lv,n)}recalculate(t,n){super.recalculate(t,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const a=[];for(const c of s)a.indexOf(c)<0&&a.push(c);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,n,s,a){const c=this.layout.get(t).evaluate(n,{},s,a),u=this._unevaluatedLayout._values[t];return u.isDataDriven()||fd(u.value)||!c?c:(d=n.properties,c.replace(/{([^{}]+)}/g,(p,g)=>g in d?String(d[g]):""));var d}createBucket(t){return new vh(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Lv.paint.overridableProperties){if(!ng.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),s=new Vw(n),a=new dd(s,n.property.specification);let c=null;c="constant"===n.value.kind||"source"===n.value.kind?new jp("source",a):new as("composite",a,n.value.zoomStops,n.value._interpolationType),this.paint._values[t]=new ll(n.property,c,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&ng.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const s=t.get("text-field"),a=Lv.paint.properties[n];let c=!1;const u=d=>{for(const f of d)if(a.overrides&&a.overrides.hasOverride(f))return void(c=!0)};if("constant"===s.value.kind&&s.value.value instanceof zr)u(s.value.value.sections);else if("source"===s.value.kind){const d=p=>{c||(p instanceof ec&&Ke(p.value)===Ve?u(p.value.sections):p instanceof nc?u(p.sections):p.eachChild(d))},f=s.value;f._styleExpression&&d(f._styleExpression.expression)}return c}getProgramIds(){const t=0!==this.paint.get("icon-opacity").constantOr(1),n=0!==this.paint.get("text-opacity").constantOr(1),s=[];return t&&s.push("symbolIcon"),n&&s.push("symbolSDF"),s}getDefaultProgramParams(t,n){return{config:new Cc(this,n),overrideFog:!1}}}const Uw=pv.types,_h=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ig(e,t,n,s,a,c,u,d,f,p,g,_,v){const x=d?Math.min(Fa,Math.round(d[0])):0,b=d?Math.min(Fa,Math.round(d[1])):0;e.emplaceBack(t,n,Math.round(32*s),Math.round(32*a),c,u,(x<<1)+(f?1:0),b,16*p,16*g,256*_,256*v)}function Vc(e,t,n){e.emplaceBack(t,n)}function rg(e,t,n,s,a,c,u){e.emplaceBack(t,n,s,a,c,u)}function og(e,t,n,s,a){const c=5*t+2;e.float32[c+0]=n,e.float32[c+1]=s,e.float32[c+2]=a}function yh(e,t,n,s,a){e.emplaceBack(t,n,s,a),e.emplaceBack(t,n,s,a),e.emplaceBack(t,n,s,a),e.emplaceBack(t,n,s,a)}function vS(e){for(const t of e.sections)if(sT(t.text))return!0;return!1}class Fv{constructor(t){this.layoutVertexArray=new Uu,this.indexArray=new Ai,this.programConfigurations=t,this.segments=new yn,this.dynamicLayoutVertexArray=new Mr,this.opacityVertexArray=new Qp,this.placedSymbolArray=new Z1,this.iconTransitioningVertexArray=new Ea,this.globeExtVertexArray=new wd,this.zOffsetVertexArray=new Cd}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(t,n,s,a,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rS.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,gw.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,_h,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,sS.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,oS.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||c)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,fR.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||a)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Xt(Fv,"SymbolBuffers");class Nv{constructor(t,n,s){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new s,this.segments=new yn,this.collisionVertexArray=new ry,this.collisionVertexArrayExt=new Mr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,pR.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,mR.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Xt(Nv,"CollisionBuffers");class sg{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(u=>u.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=it.identity([]),this.placementViewportMatrix=it.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=yw(this.zoom,n["text-size"]),this.iconSizeData=yw(this.zoom,n["icon-size"]);const s=this.layers[0].layout,a=s.get("symbol-sort-key"),c=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==c&&void 0!==a.constantOr(1),this.sortFeaturesByY=("viewport-y"===c||"auto"===c&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(u=>On[u]),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=s.get("symbol-z-elevate")}createArrays(){this.text=new Fv(new mi(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Fv(new mi(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Md,this.lineVertexArray=new tm,this.symbolInstances=new W1}calculateGlyphDependencies(t,n,s,a,c){for(let u=0;u<t.length;u++){const d=t.codePointAt(u);if(void 0===d)break;if(n[d]=!0,a&&c&&d<=65535){const f=ch[t.charAt(u)];f&&(n[f.charCodeAt(0)]=!0)}}}populate(t,n,s,a){const c=this.layers[0],u=c.layout,d="globe"===this.projection.name,f=u.get("text-font"),p=u.get("text-field"),g=u.get("icon-image"),_=("constant"!==p.value.kind||p.value.value instanceof zr&&!p.value.value.isEmpty()||p.value.value.toString().length>0)&&("constant"!==f.value.kind||f.value.value.length>0),v="constant"!==g.value.kind||!!g.value.value||Object.keys(g.parameters).length>0,x=u.get("symbol-sort-key");if(this.features=[],!_&&!v)return;const b=n.iconDependencies,E=n.glyphDependencies,C=n.availableImages,M=new zn(this.zoom);for(const{feature:T,id:R,index:P,sourceLayerIndex:I}of t){const O=c._featureFilter.needGeometry,L=Zs(T,O);if(!c._featureFilter.filter(M,L,s))continue;if(O||(L.geometry=gs(T,s,a)),d&&1!==T.type&&s.z<=5){const V=L.geometry,U=.98078528056,q=(j,X)=>{const Q=ym(j.x,j.y,s,1),nt=ym(X.x,X.y,s,1);return G.dot(Q,nt)<U};for(let j=0;j<V.length;j++)V[j]=Yd(V[j],q)}let F,N;if(_){const V=c.getValueAndResolveTokens("text-field",L,s,C),U=zr.factory(V);vS(U)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===vr()||this.hasRTLText&&Eo.isParsed())&&(F=vw(U,c,L))}if(v){const V=c.getValueAndResolveTokens("icon-image",L,s,C);N=V instanceof gi?V:gi.fromString(V)}if(!F&&!N)continue;const B=this.sortFeaturesByKey?x.evaluate(L,{},s):void 0;if(this.features.push({id:R,text:F,icon:N,index:P,sourceLayerIndex:I,geometry:L.geometry,properties:T.properties,type:Uw[T.type],sortKey:B}),N&&(b[N.namePrimary]=!0,N.nameSecondary&&(b[N.nameSecondary]=!0)),F){const V=f.evaluate(L,{},s).join(","),U="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(On.vertical)>=0;for(const q of F.sections)if(q.image)b[q.image.namePrimary]=!0;else{const j=Q_(F.toString()),X=q.fontStack||V,Q=E[X]=E[X]||{};this.calculateGlyphDependencies(q.text,Q,U,this.allowVerticalPlacement,j)}}}"line"===u.get("symbol-placement")&&(this.features=function(T){const R={},P={},I=[];let O=0;function L(V){I.push(T[V]),O++}function F(V,U,q){const j=P[V];return delete P[V],P[U]=j,I[j].geometry[0].pop(),I[j].geometry[0]=I[j].geometry[0].concat(q[0]),j}function N(V,U,q){const j=R[U];return delete R[U],R[V]=j,I[j].geometry[0].shift(),I[j].geometry[0]=q[0].concat(I[j].geometry[0]),j}function B(V,U,q){const j=q?U[0][U[0].length-1]:U[0][0];return`${V}:${j.x}:${j.y}`}for(let V=0;V<T.length;V++){const U=T[V],q=U.geometry,j=U.text?U.text.toString():null;if(!j){L(V);continue}const X=B(j,q),Q=B(j,q,!0);if(X in P&&Q in R&&P[X]!==R[Q]){const nt=N(X,Q,q),Y=F(X,Q,I[nt].geometry);delete R[X],delete P[Q],P[B(j,I[Y].geometry,!0)]=Y,I[nt].geometry=null}else X in P?F(X,Q,q):Q in R?N(X,Q,q):(L(V),R[X]=O-1,P[Q]=O-1)}return I.filter(V=>V.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((T,R)=>T.sortKey-R.sortKey)}update(t,n,s,a,c){const u=0!==Object.keys(t).length;if(u&&!this.stateDependentLayers.length)return;const d=u?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,n,d,s,a,c),this.icon.programConfigurations.updatePaintArrays(t,n,d,s,a,c)}updateZOffset(){const t=(c,u,d)=>{s+=u,s>c.length&&c.resize(s);for(let f=-u;f<0;f++)c.emplace(f+s,d)},n=(c,u,d)=>{a+=u,a>c.length&&c.resize(a);for(let f=-u;f<0;f++)c.emplace(f+a,d)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,a=0;for(let c=0;c<this.symbolInstances.length;c++){const u=this.symbolInstances.get(c),{numHorizontalGlyphVertices:d,numVerticalGlyphVertices:f,numIconVertices:p}=u,g=u.zOffset,_=p>0;if((d>0||f>0)&&(t(this.text.zOffsetVertexArray,d,g),t(this.text.zOffsetVertexArray,f,g)),_){const{placedIconSymbolIndex:v,verticalPlacedIconSymbolIndex:x}=u;v>=0&&n(this.icon.zOffsetVertexArray,p,g),x>=0&&n(this.icon.zOffsetVertexArray,u.numVerticalIconVertices,g)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=eg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const s=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:a,y:c}of n)this.lineVertexArray.emplaceBack(a,c);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C){const M=t.indexArray,T=t.layoutVertexArray,R=t.globeExtVertexArray,P=t.segments.prepareSegment(4*n.length,T,M,this.canOverlap?u.sortKey:void 0),I=this.glyphOffsetArray.length,O=P.vertexLength,L=this.allowVerticalPlacement&&d===On.vertical?Math.PI/2:0,F=u.text&&u.text.sections;for(let B=0;B<n.length;B++){const{tl:V,tr:U,bl:q,br:j,texPrimary:X,texSecondary:Q,pixelOffsetTL:nt,pixelOffsetBR:Y,minFontScaleX:K,minFontScaleY:ot,glyphOffset:at,isSDF:lt,sectionIndex:dt}=n[B],ft=P.vertexLength,gt=at[1];if(ig(T,p.x,p.y,V.x,gt+V.y,X.x,X.y,s,lt,nt.x,nt.y,K,ot),ig(T,p.x,p.y,U.x,gt+U.y,X.x+X.w,X.y,s,lt,Y.x,nt.y,K,ot),ig(T,p.x,p.y,q.x,gt+q.y,X.x,X.y+X.h,s,lt,nt.x,Y.y,K,ot),ig(T,p.x,p.y,j.x,gt+j.y,X.x+X.w,X.y+X.h,s,lt,Y.x,Y.y,K,ot),f){const{x:ht,y:yt,z:Ot}=f.anchor,[Lt,Ut,Gt]=f.up;rg(R,ht,yt,Ot,Lt,Ut,Gt),rg(R,ht,yt,Ot,Lt,Ut,Gt),rg(R,ht,yt,Ot,Lt,Ut,Gt),rg(R,ht,yt,Ot,Lt,Ut,Gt),yh(t.dynamicLayoutVertexArray,ht,yt,Ot,L)}else yh(t.dynamicLayoutVertexArray,p.x,p.y,p.z,L);if(C){const ht=Q||X;Vc(t.iconTransitioningVertexArray,ht.x,ht.y),Vc(t.iconTransitioningVertexArray,ht.x+ht.w,ht.y),Vc(t.iconTransitioningVertexArray,ht.x,ht.y+ht.h),Vc(t.iconTransitioningVertexArray,ht.x+ht.w,ht.y+ht.h)}M.emplaceBack(ft,ft+1,ft+2),M.emplaceBack(ft+1,ft+2,ft+3),P.vertexLength+=4,P.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(at[0]),B!==n.length-1&&dt===n[B+1].sectionIndex||t.programConfigurations.populatePaintArrays(T.length,u,u.index,{},x,b,E,F&&F[dt])}const N=f?f.anchor:p;t.placedSymbolArray.emplaceBack(N.x,N.y,N.z,p.x,p.y,I,this.glyphOffsetArray.length-I,O,g,_,p.segment,s?s[0]:0,s?s[1]:0,a[0],a[1],d,0,!1,0,v,0)}_commitLayoutVertex(t,n,s,a,c,u,d){t.emplaceBack(n,s,a,c,u,Math.round(d.x),Math.round(d.y))}_addCollisionDebugVertices(t,n,s,a,c,u,d){const f=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),p=f.vertexLength,g=d.tileAnchorX,_=d.tileAnchorY;for(let x=0;x<4;x++)s.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,n,t.padding,d.zOffset),this._commitLayoutVertex(s.layoutVertexArray,a,c,u,g,_,new et(t.x1,t.y1)),this._commitLayoutVertex(s.layoutVertexArray,a,c,u,g,_,new et(t.x2,t.y1)),this._commitLayoutVertex(s.layoutVertexArray,a,c,u,g,_,new et(t.x2,t.y2)),this._commitLayoutVertex(s.layoutVertexArray,a,c,u,g,_,new et(t.x1,t.y2)),f.vertexLength+=4;const v=s.indexArray;v.emplaceBack(p,p+1),v.emplaceBack(p+1,p+2),v.emplaceBack(p+2,p+3),v.emplaceBack(p+3,p),f.primitiveLength+=4}_addTextDebugCollisionBoxes(t,n,s,a,c,u){for(let d=a;d<c;d++){const f=s.get(d),p=this.getSymbolInstanceTextSize(t,u,n,d);this._addCollisionDebugVertices(f,p,this.textCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,u)}}_addIconDebugCollisionBoxes(t,n,s,a,c,u){for(let d=a;d<c;d++){const f=s.get(d),p=this.getSymbolInstanceIconSize(t,n,u.placedIconSymbolIndex);this._addCollisionDebugVertices(f,p,this.iconCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,u)}}generateCollisionDebugBuffers(t,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Nv(Ca,Ev.members,Ea),this.iconCollisionBox=new Nv(Ca,Ev.members,Ea);const s=vs(this.iconSizeData,t),a=vs(this.textSizeData,t);for(let c=0;c<this.symbolInstances.length;c++){const u=this.symbolInstances.get(c);this._addTextDebugCollisionBoxes(a,t,n,u.textBoxStartIndex,u.textBoxEndIndex,u),this._addTextDebugCollisionBoxes(a,t,n,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u),this._addIconDebugCollisionBoxes(s,t,n,u.iconBoxStartIndex,u.iconBoxEndIndex,u),this._addIconDebugCollisionBoxes(s,t,n,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u)}}getSymbolInstanceTextSize(t,n,s,a){const c=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:a),u=lh(this.textSizeData,t,c)/Yi;return this.tilePixelRatio*u}getSymbolInstanceIconSize(t,n,s){const a=this.icon.placedSymbolArray.get(s),c=lh(this.iconSizeData,t,a);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(t,n,s,a){t.emplaceBack(n,-s,-s,a),t.emplaceBack(n,s,-s,a),t.emplaceBack(n,s,s,a),t.emplaceBack(n,-s,s,a)}_updateTextDebugCollisionBoxes(t,n,s,a,c,u){for(let d=a;d<c;d++){const f=s.get(d),p=this.getSymbolInstanceTextSize(t,u,n,d);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,p,f.padding,u.zOffset)}}_updateIconDebugCollisionBoxes(t,n,s,a,c,u){for(let d=a;d<c;d++){const f=s.get(d),p=this.getSymbolInstanceIconSize(t,n,u.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,p,f.padding,u.zOffset)}}updateCollisionDebugBuffers(t,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=vs(this.iconSizeData,t),a=vs(this.textSizeData,t);for(let c=0;c<this.symbolInstances.length;c++){const u=this.symbolInstances.get(c);this._updateTextDebugCollisionBoxes(a,t,n,u.textBoxStartIndex,u.textBoxEndIndex,u),this._updateTextDebugCollisionBoxes(a,t,n,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u),this._updateIconDebugCollisionBoxes(s,t,n,u.iconBoxStartIndex,u.iconBoxEndIndex,u),this._updateIconDebugCollisionBoxes(s,t,n,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,n,s,a,c,u,d,f,p){const g={};if(n<s){const{x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:M,projectedAnchorZ:T,tileAnchorX:R,tileAnchorY:P,featureIndex:I}=t.get(n);g.textBox={x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:M,projectedAnchorZ:T,tileAnchorX:R,tileAnchorY:P},g.textFeatureIndex=I}if(a<c){const{x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:M,projectedAnchorZ:T,tileAnchorX:R,tileAnchorY:P,featureIndex:I}=t.get(a);g.verticalTextBox={x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:M,projectedAnchorZ:T,tileAnchorX:R,tileAnchorY:P},g.verticalTextFeatureIndex=I}if(u<d){const{x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:M,projectedAnchorZ:T,tileAnchorX:R,tileAnchorY:P,featureIndex:I}=t.get(u);g.iconBox={x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:M,projectedAnchorZ:T,tileAnchorX:R,tileAnchorY:P},g.iconFeatureIndex=I}if(f<p){const{x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:M,projectedAnchorZ:T,tileAnchorX:R,tileAnchorY:P,featureIndex:I}=t.get(f);g.verticalIconBox={x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:M,projectedAnchorZ:T,tileAnchorX:R,tileAnchorY:P},g.verticalIconFeatureIndex=I}return g}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,n){const s=t.placedSymbolArray.get(n),a=s.vertexStartIndex+4*s.numGlyphs;for(let c=s.vertexStartIndex;c<a;c+=4)t.indexArray.emplaceBack(c,c+1,c+2),t.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(t),s=Math.cos(t),a=[],c=[],u=[];for(let d=0;d<this.symbolInstances.length;++d){u.push(d);const f=this.symbolInstances.get(d);a.push(0|Math.round(n*f.tileAnchorX+s*f.tileAnchorY)),c.push(f.featureIndex)}return u.sort((d,f)=>a[d]-a[f]||c[f]-c[d]),u}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:u,verticalPlacedTextSymbolIndex:d,placedIconSymbolIndex:f,verticalPlacedIconSymbolIndex:p}=s;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),c>=0&&c!==a&&this.addIndicesForPlacedSymbol(this.text,c),u>=0&&u!==c&&u!==a&&this.addIndicesForPlacedSymbol(this.text,u),d>=0&&this.addIndicesForPlacedSymbol(this.text,d),f>=0&&this.addIndicesForPlacedSymbol(this.icon,f),p>=0&&this.addIndicesForPlacedSymbol(this.icon,p)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Xt(sg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),sg.MAX_GLYPHS=65535,sg.addDynamicAttributes=yh;var vh=sg;const $w=dn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:xS}=$w,yR=dn([{name:"a_packed",components:4,type:"Float32"}]),{members:Hw}=yR,Gw=pv.types,vR=Math.cos(Math.PI/180*37.5);class Uc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Vu,this.layoutVertexArray2=new Mr,this.indexArray=new Ai,this.programConfigurations=new mi(t.layers,t.zoom),this.segments=new yn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,s,a){this.hasPattern=nw("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),u=[];for(const{feature:g,id:_,index:v,sourceLayerIndex:x}of t){const b=this.layers[0]._featureFilter.needGeometry,E=Zs(g,b);if(!this.layers[0]._featureFilter.filter(new zn(this.zoom),E,s))continue;const C=c?c.evaluate(E,{},s):void 0,M={id:_,properties:g.properties,type:g.type,sourceLayerIndex:x,index:v,geometry:b?E.geometry:gs(g,s,a),patterns:{},sortKey:C};u.push(M)}c&&u.sort((g,_)=>g.sortKey-_.sortKey);const{lineAtlas:d,featureIndex:f}=n,p=this.addConstantDashes(d);for(const g of u){const{geometry:_,index:v,sourceLayerIndex:x}=g;if(p&&this.addFeatureDashes(g,d),this.hasPattern){const b=uv("line",this.layers,g,this.zoom,n);this.patternFeatures.push(b)}else this.addFeature(g,_,v,s,d.positions,n.availableImages,n.brightness);f.insert(t[v].feature,_,v,x,this.index)}}addConstantDashes(t){let n=!1;for(const s of this.layers){const a=s.paint.get("line-dasharray").value,c=s.layout.get("line-cap").value;if("constant"!==a.kind||"constant"!==c.kind)n=!0;else{const u=c.value,d=a.value;if(!d)continue;t.addDash(d,u)}}return n}addFeatureDashes(t,n){const s=this.zoom;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,u=a.layout.get("line-cap").value;if("constant"===c.kind&&"constant"===u.kind)continue;let d,f;if("constant"===c.kind){if(d=c.value,!d)continue}else d=c.evaluate({zoom:s},t);f="constant"===u.kind?u.value:u.evaluate({zoom:s},t),n.addDash(d,f),t.patterns[a.id]=n.getKey(d,f)}}update(t,n,s,a,c){const u=0!==Object.keys(t).length;u&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,n,u?this.stateDependentLayers:this.layers,s,a,c)}addFeatures(t,n,s,a,c,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,s,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Hw)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xS),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,s,a,c,u,d){const f=this.layers[0].layout,p=f.get("line-join").evaluate(t,{}),g=f.get("line-cap").evaluate(t,{}),_=f.get("line-miter-limit"),v=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const x of n)this.addLine(x,t,p,g,_,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,c,u,a,d)}addLine(t,n,s,a,c,u){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let M=0;M<t.length-1;M++)this.totalDistance+=t[M].dist(t[M+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const d="Polygon"===Gw[n.type];let f=t.length;for(;f>=2&&t[f-1].equals(t[f-2]);)f--;let p=0;for(;p<f-1&&t[p].equals(t[p+1]);)p++;if(f<(d?3:2))return;"bevel"===s&&(c=1.05);const g=this.overscaling<=16?15*ut/(512*this.overscaling):0,_=this.segments.prepareSegment(10*f,this.layoutVertexArray,this.indexArray);let v,x,b,E,C;this.e1=this.e2=-1,d&&(v=t[f-2],C=t[p].sub(v)._unit()._perp());for(let M=p;M<f;M++){if(b=M===f-1?d?t[p+1]:void 0:t[M+1],b&&t[M].equals(b))continue;C&&(E=C),v&&(x=v),v=t[M],C=b?b.sub(v)._unit()._perp():E,E=E||C;let T=E.add(C);0===T.x&&0===T.y||T._unit();const R=E.x*C.x+E.y*C.y,P=T.x*C.x+T.y*C.y,I=0!==P?1/P:1/0,O=2*Math.sqrt(2-2*P),L=P<vR&&x&&b,F=E.x*C.y-E.y*C.x>0;if(L&&M>p){const V=v.dist(x);if(V>2*g){const U=v.sub(v.sub(x)._mult(g/V)._round());this.updateDistance(x,U),this.addCurrentVertex(U,E,0,0,_),x=U}}const N=x&&b;let B=N?s:d?"butt":a;if(N&&"round"===B&&(I<u?B="miter":I<=2&&(B="fakeround")),"miter"===B&&I>c&&(B="bevel"),"bevel"===B&&(I>2&&(B="flipbevel"),I<c&&(B="miter")),x&&this.updateDistance(x,v),"miter"===B)T._mult(I),this.addCurrentVertex(v,T,0,0,_);else if("flipbevel"===B){if(I>100)T=C.mult(-1);else{const V=I*E.add(C).mag()/E.sub(C).mag();T._perp()._mult(V*(F?-1:1))}this.addCurrentVertex(v,T,0,0,_),this.addCurrentVertex(v,T.mult(-1),0,0,_)}else if("bevel"===B||"fakeround"===B){const V=-Math.sqrt(I*I-1),U=F?V:0,q=F?0:V;if(x&&this.addCurrentVertex(v,E,U,q,_),"fakeround"===B){const j=Math.round(180*O/Math.PI/20);for(let X=1;X<j;X++){let Q=X/j;if(.5!==Q){const Y=Q-.5;Q+=Q*Y*(Q-1)*((1.0904+R*(R*(3.55645-1.43519*R)-3.2452))*Y*Y+(.848013+R*(.215638*R-1.06021)))}const nt=C.sub(E)._mult(Q)._add(E)._unit()._mult(F?-1:1);this.addHalfVertex(v,nt.x,nt.y,!1,F,0,_)}}b&&this.addCurrentVertex(v,C,-U,-q,_)}else if("butt"===B)this.addCurrentVertex(v,T,0,0,_);else if("square"===B){const V=x?1:-1;x||this.addCurrentVertex(v,T,V,V,_),this.addCurrentVertex(v,T,0,0,_),x&&this.addCurrentVertex(v,T,V,V,_)}else"round"===B&&(x&&(this.addCurrentVertex(v,E,0,0,_),this.addCurrentVertex(v,E,1,1,_,!0)),b&&(this.addCurrentVertex(v,C,-1,-1,_,!0),this.addCurrentVertex(v,C,0,0,_)));if(L&&M<f-1){const V=v.dist(b);if(V>2*g){const U=v.add(b.sub(v)._mult(g/V)._round());this.updateDistance(v,U),this.addCurrentVertex(U,C,0,0,_),v=U}}}}addCurrentVertex(t,n,s,a,c,u=!1){const d=n.y*a-n.x,f=-n.y-n.x*a;this.addHalfVertex(t,n.x+n.y*s,n.y-n.x*s,u,!1,s,c),this.addHalfVertex(t,d,f,u,!0,-a,c)}addHalfVertex({x:t,y:n},s,a,c,u,d,f){this.layoutVertexArray.emplaceBack((t<<1)+(c?1:0),(n<<1)+(u?1:0),Math.round(63*s)+128,Math.round(63*a)+128,1+(0===d?0:d<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const p=f.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,p),f.primitiveLength++),u?this.e2=p:this.e1=p}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}Xt(Uc,"LineBucket",{omit:["layers","patternFeatures"]});class Qn{constructor(t,n,s,a){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(n,a)}update(t,n,s){const{width:a,height:c}=t,{context:u}=this,{gl:d}=u,{HTMLImageElement:f,HTMLCanvasElement:p,HTMLVideoElement:g,ImageData:_,ImageBitmap:v}=st;if(d.bindTexture(d.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA&&(!n||!1!==n.premultiply)),s||this.size&&this.size[0]===a&&this.size[1]===c){const{x,y:b}=s||{x:0,y:0};if(t instanceof f||t instanceof p||t instanceof g||t instanceof _||v&&t instanceof v)d.texSubImage2D(d.TEXTURE_2D,0,x,b,d.RGBA,d.UNSIGNED_BYTE,t);else{let E=this.format,C=d.UNSIGNED_BYTE;this.format===d.R32F&&(E=d.RED,C=d.FLOAT),d.texSubImage2D(d.TEXTURE_2D,0,x,b,a,c,E,C,t.data)}}else if(this.size=[a,c],t instanceof f||t instanceof p||t instanceof g||t instanceof _||v&&t instanceof v){let x=this.format;this.format===d.R8&&(x=d.RED),d.texImage2D(d.TEXTURE_2D,0,this.format,x,d.UNSIGNED_BYTE,t)}else{let x=this.format,b=this.format,E=d.UNSIGNED_BYTE;this.format===d.DEPTH_COMPONENT&&(x=d.DEPTH_COMPONENT16,E=d.UNSIGNED_SHORT),this.format===d.R32F&&(E=d.FLOAT,b=d.RED),d.texImage2D(d.TEXTURE_2D,0,x,a,c,0,b,E,t.data)}this.useMipmap=!(!n||!n.useMipmap),this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(t,n){const{context:s}=this,{gl:a}=s;a.bindTexture(a.TEXTURE_2D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?t===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),n!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(t,n,s,a){const{context:c}=this,{gl:u}=c;u.bindTexture(u.TEXTURE_2D,this.texture),n!==this.magFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,n),this.magFilter=n),t!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?t===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),s!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,s),this.wrapS=s),a!==this.wrapT&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,a),this.wrapT=a)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class ag{constructor(t,n){this.context=t,this.texture=n}bind(t,n){const{context:s}=this,{gl:a}=s;a.bindTexture(a.TEXTURE_2D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,t),this.minFilter=t),n!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrapS=n)}}const br=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,n=0,s=0,a=0,c=0,u=0,d=0;for(1&t?a=c=u=32:n=s=d=32;(t>>=1)>1;){const p=n+a>>1,g=s+c>>1;1&t?(a=n,c=s,n=u,s=d):(n=a,s=c,a=u,c=d),u=p,d=g}const f=4*e;br[f+0]=n,br[f+1]=s,br[f+2]=a,br[f+3]=c}const ho=new Uint16Array(2178),Oi=new Uint8Array(1089),Qs=new Uint16Array(1089);function _f(e){return 0===e?-.03125:32===e?.03125:0}var fo=dn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const $c={type:2,extent:ut,loadGeometry:()=>[[new et(0,0),new et(ut+1,0),new et(ut+1,ut+1),new et(0,ut+1),new et(0,0)]]};class Js{constructor(t,n,s,a,c){this.tileID=t,this.uid=hi(),this.uses=0,this.tileSize=n,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=c,a&&a.style&&(this._lastUpdatedBrightness=a.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<xe.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Pl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,s){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(a,c){const u={};if(!c)return u;for(const d of a){const f=d.layerIds.map(p=>c.getLayer(p)).filter(Boolean);if(0!==f.length){d.layers=f,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(p=>f.filter(g=>g.id===p)[0]));for(const p of f)u[p.fqid]=d}}return u}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const c=this.buckets[a];if(c instanceof vh){if(this.hasSymbolBuckets=!0,!s)break;c.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const c=this.buckets[a];if(c instanceof vh&&c.hasRTLText){this.hasRTLText=!0,Eo.isLoading()||Eo.isLoaded()||"deferred"!==vr()||Vs();break}}this.queryPadding=0;for(const a in this.buckets){const c=this.buckets[a],u=n.style.getOwnLayer(a);if(!u)continue;const d=u.queryRadius(c);this.queryPadding=Math.max(this.queryPadding,d)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new Jp}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const s in this.buckets){const a=this.buckets[s];a.uploadPending()&&a.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Qn(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Qn(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Qn(t,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t,n,s){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,s),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const a=n.style.getBrightness();(this._lastUpdatedBrightness||a)&&(this._lastUpdatedBrightness&&a&&Math.abs(this._lastUpdatedBrightness-a)<.001||(this._lastUpdatedBrightness=a,this.updateBuckets(void 0,n)))}queryRenderedFeatures(t,n,s,a,c,u,d,f){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:d,transform:u,params:c,tileTransform:this.tileTransform},t,n,s):{}}querySourceFeatures(t,n){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const a=s.loadVTLayers(),c=n?n.sourceLayer:"",u=a._geojsonTileLayer||a[c];if(!u)return;const d=Vp(n&&n.filter),{z:f,x:p,y:g}=this.tileID.canonical,_={z:f,x:p,y:g};for(let v=0;v<u.length;v++){const x=u.feature(v);if(d.needGeometry){const C=Zs(x,!0);if(!d.filter(new zn(this.tileID.overscaledZ),C,this.tileID.canonical))continue}else if(!d.filter(new zn(this.tileID.overscaledZ),x))continue;const b=s.getId(x,c),E=new xv(x,f,p,g,b);E.tile=_,t.push(E)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const s=ae(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const s=Date.now();let a=!1;if(this.expirationTime>s)a=!1;else if(n)if(this.expirationTime<n)a=!0;else{const c=this.expirationTime-n;c?this.expirationTime=s+Math.max(c,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length&&n&&this.updateBuckets(t,n)}updateBuckets(t,n){if(!this.latestFeatureIndex)return;const s=this.latestFeatureIndex.loadVTLayers(),a=n.style.listImages(),c=n.style.getBrightness();for(const u in this.buckets){if(!n.style.hasLayer(u))continue;const d=this.buckets[u],f=d.layers[0].sourceLayer||"_geojsonTileLayer",p=s[f];let g={};if(t&&(g=t[f],!p||!g||0===Object.keys(g).length))continue;if(d.update(g,p,a,this.imageAtlas&&this.imageAtlas.patternPositions||{},c),d instanceof Uc||d instanceof Pa){const v=n.style.getOwnSourceCache(d.layers[0].source);n._terrain&&n._terrain.enabled&&v&&d.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(v.id,this.tileID)}const _=n&&n.style&&n.style.getOwnLayer(u);_&&(this.queryPadding=Math.max(this.queryPadding,_.queryRadius(d)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<xe.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=xe.now()+t}setTexture(t,n){const s=n.context,a=s.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof Qn?this.texture.update(t,{useMipmap:!0}):(this.texture=new Qn(s,t,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE))}setDependencies(t,n){const s={};for(const a of n)s[a]=!0;this.dependencies[t]=s}hasDependency(t,n){for(const s of t){const a=this.dependencies[s];if(a)for(const c of n)if(a[c])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const s=gs($c,this.tileID.canonical,this.tileTransform)[0],a=new ro,c=new xc;for(let u=0;u<s.length;u++){const{x:d,y:f}=s[u];a.emplaceBack(d,f),c.emplaceBack(u)}c.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(c),this._tileDebugBuffer=t.createVertexBuffer(a,Gs.members),this._tileDebugSegments=yn.simpleSegment(0,0,a.length,c.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const s=gs($c,this.tileID.canonical,this.tileTransform)[0];let a,c;if(this.isRaster){const u=function(d,f){const p=Pl(d,f),g=Math.pow(2,d.z);for(let C=0;C<33;C++)for(let M=0;M<33;M++){const T=or((d.x+(M+_f(M))/32)/g),R=Ei((d.y+(C+_f(C))/32)/g),P=f.project(T,R),I=33*C+M;ho[2*I+0]=Math.round((P.x*p.scale-p.x)*ut),ho[2*I+1]=Math.round((P.y*p.scale-p.y)*ut)}Oi.fill(0),Qs.fill(0);for(let C=2045;C>=0;C--){const M=4*C,T=br[M+0],R=br[M+1],P=br[M+2],I=br[M+3],O=T+P>>1,L=R+I>>1,F=O+L-R,N=L+T-O,B=33*R+T,V=33*I+P,U=33*L+O,q=Math.hypot((ho[2*B+0]+ho[2*V+0])/2-ho[2*U+0],(ho[2*B+1]+ho[2*V+1])/2-ho[2*U+1])>=16;Oi[U]=Oi[U]||(q?1:0),C<1022&&(Oi[U]=Oi[U]||Oi[33*(R+N>>1)+(T+F>>1)]||Oi[33*(I+N>>1)+(P+F>>1)])}const _=new cl,v=new Ai;let x=0;function b(C,M){const T=33*M+C;return 0===Qs[T]&&(_.emplaceBack(ho[2*T+0],ho[2*T+1],C*ut/32,M*ut/32),Qs[T]=++x),Qs[T]-1}function E(C,M,T,R,P,I){const O=C+T>>1,L=M+R>>1;if(Math.abs(C-P)+Math.abs(M-I)>1&&Oi[33*L+O])E(P,I,C,M,O,L),E(T,R,P,I,O,L);else{const F=b(C,M),N=b(T,R),B=b(P,I);v.emplaceBack(F,N,B)}}return E(0,0,32,32,32,0),E(32,32,0,0,0,32),{vertices:_,indices:v}}(this.tileID.canonical,n);a=u.vertices,c=u.indices}else{a=new cl,c=new Ai;for(const{x:d,y:f}of s)a.emplaceBack(d,f,0,0);const u=rf(a.int16,void 0,4);for(let d=0;d<u.length;d+=3)c.emplaceBack(u[d],u[d+1],u[d+2])}this._tileBoundsBuffer=t.createVertexBuffer(a,fo.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(c),this._tileBoundsSegments=yn.simpleSegment(0,0,a.length,c.length)}_makeGlobeTileDebugBuffers(t,n){const s=n.projection;if(!s||"globe"!==s.name||n.freezeTileCoverage)return;const a=this.tileID.canonical,c=Aa(jb(a,n)),u=ti(n.zoom);let d;u>0&&(d=it.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,a,n,c,d,u),this._makeGlobeTileDebugTextBuffer(t,a,n,c,d,u)}_globePoint(t,n,s,a,c,u,d){let f=ym(t,n,s);if(u){const p=1<<s.z,g=Ri(a.center.lng),_=wi(a.center.lat),v=(s.x+.5)/p-g;let x=0;v>.5?x=-1:v<-.5&&(x=1);let b=(t/ut+s.x)/p+x,E=(n/ut+s.y)/p;b=(b-g)*a._pixelsPerMercatorPixel+g,E=(E-_)*a._pixelsPerMercatorPixel+_;const C=[b*a.worldSize,E*a.worldSize,0];G.transformMat4(C,C,u),f=Ia(f,C,d)}return G.transformMat4(f,f,c)}_makeGlobeTileDebugBorderBuffer(t,n,s,a,c,u){const d=new ro,f=new xc,p=new Xp,g=(v,x,b,E,C)=>{const M=(b-v)/(C-1),T=(E-x)/(C-1),R=d.length;for(let P=0;P<C;P++){const I=v+P*M,O=x+P*T;d.emplaceBack(I,O);const L=this._globePoint(I,O,n,s,a,c,u);p.emplaceBack(L[0],L[1],L[2]),f.emplaceBack(R+P)}},_=ut;g(0,0,_,0,16),g(_,0,_,_,16),g(_,_,0,_,16),g(0,_,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(f),this._tileDebugBuffer=t.createVertexBuffer(d,Gs.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(p,Py.members),this._tileDebugSegments=yn.simpleSegment(0,0,d.length,f.length)}_makeGlobeTileDebugTextBuffer(t,n,s,a,c,u){const d=ut/4,f=new ro,p=new Ai,g=new Xp,_=25;p.reserve(32),f.reserve(_),g.reserve(_);const v=(x,b)=>_*x+b;for(let x=0;x<_;x++){const b=x*d;for(let E=0;E<_;E++){const C=E*d;f.emplaceBack(C,b);const M=this._globePoint(C,b,n,s,a,c,u);g.emplaceBack(M[0],M[1],M[2])}}for(let x=0;x<4;x++)for(let b=0;b<4;b++){const E=v(x,b),C=v(x,b+1),M=v(x+1,b),T=v(x+1,b+1);p.emplaceBack(E,C,M),p.emplaceBack(M,C,T)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(p),this._tileDebugTextBuffer=t.createVertexBuffer(f,Gs.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(g,Py.members),this._tileDebugTextSegments=yn.simpleSegment(0,0,_,32)}destroy(t=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof Qn&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class xh{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,s){const a=t.wrapped().key;void 0===this.data[a]&&(this.data[a]=[]);const c={value:n,timeout:void 0};if(void 0!==s&&(c.timeout=setTimeout(()=>{this.remove(t,c)},s)),this.data[a].push(c),this.order.push(a),this.order.length>this.max){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const s=t.wrapped().key,a=void 0===n?0:this.data[s].indexOf(n),c=this.data[s][a];return this.data[s].splice(a,1),c.timeout&&clearTimeout(c.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(c.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const s in this.data)for(const a of this.data[s])t(a.value)||n.push(a);for(const s of n)this.remove(s.value.tileID,s)}}let Hc=(()=>{class e{constructor(n,s,a,c){this.id=e.uniqueIdxCounter,e.uniqueIdxCounter++,this.context=n;const u=n.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||c||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=e.uniqueIdxCounter,e.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return e.uniqueIdxCounter=0,e})();const bh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class wh{constructor(t,n,s,a,c,u){this.length=n.length,this.attributes=s,this.itemSize=n.bytesPerElement,this.dynamicDraw=a,this.instanceCount=u,this.context=t;const d=t.gl;this.buffer=d.createBuffer(),t.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||c||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let s=0;s<this.attributes.length;s++){const a=n.attributes[this.attributes[s].name];void 0!==a&&t.enableVertexAttribArray(a)}}setVertexAttribPointers(t,n,s){for(let a=0;a<this.attributes.length;a++){const c=this.attributes[a],u=n.attributes[c.name];void 0!==u&&t.vertexAttribPointer(u,c.components,t[bh[c.type]],!1,this.itemSize,c.offset+this.itemSize*(s||0))}}setVertexAttribDivisor(t,n,s){for(let a=0;a<this.attributes.length;a++){const c=n.attributes[this.attributes[a].name];void 0!==c&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(c,s)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Rn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Eh extends Rn{getDefault(){return Pe.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ch extends Rn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Dh extends Rn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class qw extends Rn{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Zw extends Rn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ww extends Rn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Yw extends Rn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Xw extends Rn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Kw extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Qw extends Rn{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Jw extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class tE extends Rn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class zv extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class bS extends Rn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class xR extends Rn{getDefault(){return Pe.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class bR extends Rn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class wS extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class ES extends Rn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class wR extends Rn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let CS=class extends Rn{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class ER extends Rn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class DS extends Rn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class MS extends Rn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class TS extends Rn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Bv extends Rn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class yf extends Rn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class jv extends Rn{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class lg extends Rn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class eE extends Rn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class vf extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class nE extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Vv extends Rn{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class xf extends Vv{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class iE extends Vv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class SS extends Vv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class IS extends iE{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class AS{constructor(t,n,s,a,c){this.context=t,this.width=n,this.height=s;const u=this.framebuffer=t.gl.createFramebuffer();a&&(this.colorAttachment=new xf(t,u)),c&&(this.depthAttachmentType=c,this.depthAttachment="renderbuffer"===c?new iE(t,u):new SS(t,u))}destroy(){const t=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&t.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&t.deleteTexture(n)}t.deleteFramebuffer(this.framebuffer)}}class de{constructor(t,n,s){this.func=t,this.mask=n,this.range=s}}de.ReadOnly=!1,de.ReadWrite=!0,de.disabled=new de(519,de.ReadOnly,[0,1]);class Se{constructor(t,n,s,a,c,u){this.test=t,this.ref=n,this.mask=s,this.fail=a,this.depthFail=c,this.pass=u}}Se.disabled=new Se({func:519,mask:0},0,0,7680,7680,7680);class Qe{constructor(t,n,s,a){this.blendFunction=t,this.blendColor=n,this.mask=s,this.blendEquation=a}}Qe.Replace=[1,0,1,0],Qe.disabled=new Qe(Qe.Replace,Pe.transparent,[!1,!1,!1,!1]),Qe.unblended=new Qe(Qe.Replace,Pe.transparent,[!0,!0,!0,!0]),Qe.alphaBlended=new Qe([1,771,1,771],Pe.transparent,[!0,!0,!0,!0]),Qe.multiply=new Qe([774,0,774,0],Pe.transparent,[!0,!0,!0,!0]);class ze{constructor(t,n,s){this.enable=t,this.mode=n,this.frontFace=s}}ze.disabled=new ze(!1,1029,2305),ze.backCCW=new ze(!0,1029,2305),ze.backCW=new ze(!0,1029,2304),ze.frontCW=new ze(!0,1028,2304),ze.frontCCW=new ze(!0,1028,2305);class rE{constructor(t,n){this.gl=t,this.clearColor=new Eh(this),this.clearDepth=new Ch(this),this.clearStencil=new Dh(this),this.colorMask=new qw(this),this.depthMask=new Zw(this),this.stencilMask=new Ww(this),this.stencilFunc=new Yw(this),this.stencilOp=new Xw(this),this.stencilTest=new Kw(this),this.depthRange=new Qw(this),this.depthTest=new Jw(this),this.depthFunc=new tE(this),this.blend=new zv(this),this.blendFunc=new bS(this),this.blendColor=new xR(this),this.blendEquation=new bR(this),this.cullFace=new wS(this),this.cullFaceSide=new ES(this),this.frontFace=new wR(this),this.program=new CS(this),this.activeTexture=new ER(this),this.viewport=new DS(this),this.bindFramebuffer=new MS(this),this.bindRenderbuffer=new TS(this),this.bindTexture=new Bv(this),this.bindVertexBuffer=new yf(this),this.bindElementBuffer=new jv(this),this.bindVertexArrayOES=new lg(this),this.pixelStoreUnpack=new eE(this),this.pixelStoreUnpackPremultiplyAlpha=new vf(this),this.pixelStoreUnpackFlipY=new nE(this),this.options=n?{...n}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n,s){return new Hc(this,t,n,s)}createVertexBuffer(t,n,s,a,c){return new wh(this,t,n,s,a,c)}createRenderbuffer(t,n,s){const a=this.gl,c=a.createRenderbuffer();return this.bindRenderbuffer.set(c),a.renderbufferStorage(a.RENDERBUFFER,t,n,s),this.bindRenderbuffer.set(null),c}createFramebuffer(t,n,s,a){return new AS(this,t,n,s,a)}clear({color:t,depth:n,stencil:s,colorMask:a}){const c=this.gl;let u=0;t&&(u|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(a||[!0,!0,!0,!0])),void 0!==n&&(u|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==s&&(u|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(s),this.stencilMask.set(255)),c.clear(u)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){Xe(t.blendFunction,Qe.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class ws extends Be{constructor(t,n,s){super(),this.id=t,this._onlySymbols=s,n.on("data",a=>{"source"===a.dataType&&"metadata"===a.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===a.dataType&&"content"===a.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new xh(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new nS,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if("errored"!==n.state&&("loaded"!==n.state||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const s=this._tiles[n];s.upload(t),s.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return kn(this._tiles).map(t=>t.tileID).sort(oE).map(t=>t.key)}getRenderableIds(t,n){const s=[];for(const a in this._tiles)this._isIdRenderable(+a,t,n)&&s.push(this._tiles[a]);return t?s.sort((a,c)=>{const u=a.tileID,d=c.tileID,f=new et(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),p=new et(d.canonical.x,d.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-d.overscaledZ||p.y-f.y||p.x-f.x}).map(a=>a.tileID.key):s.map(a=>a.tileID).sort(oE).map(a=>a.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())&&(s||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const s=this._tiles[t];s&&("loading"!==s.state&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,t,n)))}_tileLoaded(t,n,s,a){if(a)if(t.state="errored",404!==a.status)this._source.fire(new zt(a,{tile:t}));else{if(!(t.tileID.key in this._loadedParentTiles))return void this._source.fire(new Dt("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const c=this.map.painter.terrain;this.update(this.transform,c.getScaledDemTileSize(),!0),c.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=xe.now(),"expired"===s&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Dt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let a=0;a<n.length;a++){const c=n[a];if(t.neighboringTiles&&t.neighboringTiles[c]){const u=this.getTileByID(c);s(t,u),s(u,t)}}function s(a,c){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let u=c.tileID.canonical.x-a.tileID.canonical.x;const d=c.tileID.canonical.y-a.tileID.canonical.y,f=Math.pow(2,a.tileID.canonical.z),p=c.tileID.key;0===u&&0===d||Math.abs(d)>1||(Math.abs(u)>1&&(1===Math.abs(u+f)?u+=f:1===Math.abs(u-f)&&(u-=f)),c.dem&&a.dem&&(a.dem.backfillBorder(c.dem,u,d),a.neighboringTiles&&a.neighboringTiles[p]&&(a.neighboringTiles[p].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,s,a){for(const c in this._tiles){let u=this._tiles[c];if(a[c]||!u.hasData()||u.tileID.overscaledZ<=n||u.tileID.overscaledZ>s)continue;let d=u.tileID;for(;u&&u.tileID.overscaledZ>n+1;){const p=u.tileID.scaledTo(u.tileID.overscaledZ-1);u=this._tiles[p.key],u&&u.hasData()&&(d=p)}let f=d;for(;f.overscaledZ>n;)if(f=f.scaledTo(f.overscaledZ-1),t[f.key]){a[d.key]=d;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const s=this._loadedParentTiles[t.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=t.overscaledZ-1;s>=n;s--){const a=t.scaledTo(s),c=this._getLoadedTile(a);if(c)return c}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const s=Math.ceil(t.width/n)+1,a=Math.ceil(t.height/n)+1,c=Math.floor(s*a*5),u="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,c):c,d="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(d)}handleWrapJump(t){const n=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,n){const s={};for(const a in this._tiles){const c=this._tiles[a];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+n),s[c.tileID.key]=c}this._tiles=s;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(t,n,s,a){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let c;if(this.updateCacheSize(t,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(f=>new nn(f.canonical.z,f.wrap,f.canonical.z,f.canonical.x,f.canonical.y)):(c=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(f=>this._source.hasTile(f)))):c=[],c.length>0&&this.castsShadows&&a&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!wf(this._source.type)){const f=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!s}),p=Math.min(f,this._source.maxzoom),g=t.extendTileCoverForShadows(c,a,p);for(const _ of g)this._shadowCasterTiles[_.key]=!0,c.push(_)}const u=this._updateRetainedTiles(c);if(wf(this._source.type)&&0!==c.length){const f={},p={},g=Object.keys(u);for(const v of g){const x=u[v],b=this._tiles[v];if(!b||b.fadeEndTime&&b.fadeEndTime<=xe.now())continue;const E=this.findLoadedParent(x,Math.max(x.overscaledZ-ws.maxOverzooming,this._source.minzoom));E&&(this._addTile(E.tileID),f[E.tileID.key]=E.tileID),p[v]=x}const _=c[c.length-1].overscaledZ;for(const v in this._tiles){const x=this._tiles[v];if(u[v]||!x.hasData())continue;let b=x.tileID;for(;b.overscaledZ>_;){b=b.scaledTo(b.overscaledZ-1);const E=this._tiles[b.key];if(E&&E.hasData()&&p[b.key]){u[v]=x.tileID;break}}}for(const v in f)u[v]||(this._coveredTiles[v]=!0,u[v]=f[v])}for(const f in u)this._tiles[f].clearFadeHold();const d=function(f,p){const g=[];for(const _ in f)_ in p||g.push(_);return g}(this._tiles,u);for(const f of d){const p=this._tiles[f];p.hasSymbolBuckets&&!p.holdingForFade()?p.setHoldDuration(this.map._fadeDuration):p.hasSymbolBuckets&&!p.symbolFadeFinished()||this._removeTile(+f)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(0===t.length)return n;const s={},a=t.reduce((p,g)=>Math.min(p,g.overscaledZ),1/0),c=t[0].overscaledZ,u=Math.max(c-ws.maxOverzooming,this._source.minzoom),d=Math.max(c+ws.maxUnderzooming,this._source.minzoom),f={};for(const p of t){const g=this._addTile(p);n[p.key]=p,g.hasData()||a<this._source.maxzoom&&(f[p.key]=p)}this._retainLoadedChildren(f,a,d,n);for(const p of t){let g=this._tiles[p.key];if(g.hasData())continue;if(p.canonical.z>=this._source.maxzoom){const v=p.children(this._source.maxzoom)[0],x=this.getTile(v);if(x&&x.hasData()){n[v.key]=v;continue}}else{const v=p.children(this._source.maxzoom);if(n[v[0].key]&&n[v[1].key]&&n[v[2].key]&&n[v[3].key])continue}let _=g.wasRequested();for(let v=p.overscaledZ-1;v>=u;--v){const x=p.scaledTo(v);if(s[x.key]||(s[x.key]=!0,g=this.getTile(x),!g&&_&&(g=this._addTile(x)),g&&(n[x.key]=x,_=g.wasRequested(),g.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let s,a=this._tiles[t].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){s=this._loadedParentTiles[a.key];break}n.push(a.key);const c=a.scaledTo(a.overscaledZ-1);if(s=this._getLoadedTile(c),s)break;a=c}for(const c of n)this._loadedParentTiles[c]=s}}_addTile(t){let n=this._tiles[t.key];if(n)return!0!==n.isExtraShadowCaster||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const s=!!n;if(!s){const a=this.map?this.map.painter:null;n=new Js(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n?(n.uses++,this._tiles[t.key]=n,s||this._source.fire(new Dt("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const s=n.getExpiryTimeout();s&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},s))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,s){const a=[],c=this.transform;if(!c)return a;const u="globe"===c.projection.name,d=Ri(c.center.lng);for(const f in this._tiles){const p=this._tiles[f];if(s&&p.clearQueryDebugViz(),p.holdingForFade())continue;let g;if(u){const _=p.tileID.canonical;if(0===_.z){const v=[Math.abs(Qt(d,...Th(_,-1))-d),Math.abs(Qt(d,...Th(_,1))-d)];g=[0,2*v.indexOf(Math.min(...v))-1]}else{const v=[Math.abs(Qt(d,...Th(_,-1))-d),Math.abs(Qt(d,...Th(_,0))-d),Math.abs(Qt(d,...Th(_,1))-d)];g=[v.indexOf(Math.min(...v))-1]}}else g=[0];for(const _ of g){const v=t.containsTile(p,c,n,_);v&&a.push(v)}}return a}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,n){const s=this.getRenderableIds(t,n).map(c=>this._tiles[c].tileID),a="globe"===this.transform.projection.name;for(const c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped()),c.expandedProjMatrix=a?this.transform.calculateProjMatrix(c.toUnwrapped(),!1,!0):c.projMatrix;return s}sortCoordinatesByDistance(t){const n=t.slice(),s=this.transform._camera.position,a=this.transform._camera.forward(),c={};for(const u of n){const d=1/(1<<u.canonical.z);c[u.key]=((u.canonical.x+.5)*d+u.wrap-s[0])*a[0]+((u.canonical.y+.5)*d-s[1])*a[1]-s[2]*a[2]}return n.sort((u,d)=>c[u.key]-c[d.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(wf(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=xe.now())return!0}return!1}setFeatureState(t,n,s){this._state.updateState(t=t||"_geojsonTileLayer",n,s)}removeFeatureState(t,n,s){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,s)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,s){const a=this._tiles[t];a&&a.setDependencies(n,s)}reloadTilesForDependencies(t,n){for(const s in this._tiles)this._tiles[s].hasDependency(t,n)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(t,n))}_preloadTiles(t,n){if(!this._sourceLoaded){const d=()=>{this._sourceLoaded&&(this._source.off("data",d),this._preloadTiles(t,n))};return void this._source.on("data",d)}const s=new Map,a=Array.isArray(t)?t:[t],c=this.map.painter.terrain,u=this.usedForTerrain&&c?c.getScaledDemTileSize():this._source.tileSize;for(const d of a){const f=d.coveringTiles({tileSize:u,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const p of f)s.set(p.key,p);this.usedForTerrain&&d.updateElevation(!1)}Kl(Array.from(s.values()),(d,f)=>{const p=new Js(d,this._source.tileSize*d.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(p,g=>{"raster-dem"===this._source.type&&p.dem&&this._backfillDEM(p),f(g,p)})},n)}}function oE(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),s=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||s-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function wf(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Th(e,t){const n=1<<e.z;return[e.x/n+t,(e.x+1)/n+t]}ws.maxOverzooming=10,ws.maxUnderzooming=3;const sE=dn([{name:"a_pos_3f",components:3,type:"Float32"}]),RS=dn([{name:"a_color_3f",components:3,type:"Float32"}]),PS=dn([{name:"a_color_4f",components:4,type:"Float32"}]),OS=dn([{name:"a_uv_2f",components:2,type:"Float32"}]),kS=dn([{name:"a_normal_3f",components:3,type:"Float32"}]),aE=dn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Hv=dn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class Gv{constructor(t=0,n=0,s=0,a=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(s)||s<0||isNaN(a)||a<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=s,this.right=a}interpolate(t,n,s){return null!=n.top&&null!=t.top&&(this.top=vt(t.top,n.top,s)),null!=n.bottom&&null!=t.bottom&&(this.bottom=vt(t.bottom,n.bottom,s)),null!=n.left&&null!=t.left&&(this.left=vt(t.left,n.left,s)),null!=n.right&&null!=t.right&&(this.right=vt(t.right,n.right,s)),this}getCenter(t,n){const s=Qt((this.left+t-this.right)/2,0,t),a=Qt((this.top+n-this.bottom)/2,0,n);return new et(s,a)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Gv(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Vt(e,t){const n=si(e,3);it.fromQuat(e,t),Hi(e,3,n)}function Zt(e,t){const n=ur.identity([]);return ur.rotateZ(n,n,-t),ur.rotateX(n,n,-e),n}function ke(e,t){const n=[e[0],e[1],0],s=[t[0],t[1],0];if(G.length(n)>=1e-15){const u=G.normalize([],n);G.scale(s,u,G.dot(s,u)),t[0]=s[0],t[1]=s[1]}const a=G.cross([],t,e);if(G.len(a)<1e-15)return null;const c=Math.atan2(-a[1],a[0]);return Zt(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),c)}class qv{constructor(t,n){this.position=t,this.orientation=n}get position(){return this._position}set position(t){if(t){const n=t instanceof We?t:new We(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=Os(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const s=this.position,a=this._elevation?this._elevation.getAtPointOrZero(We.fromLngLat(t)):0,c=We.fromLngLat(t,a),u=[c.x-s.x,c.y-s.y,c.z-s.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=ke(u,n)}setPitchBearing(t,n){this.orientation=Zt(De(t),De(-n))}}class cg{constructor(t,n){this._transform=it.identity([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new We(t[0],t[1],t[2])}get position(){const t=si(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&Hi(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||ur.identity([]),t&&Vt(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,n){this._orientation=Zt(t,n),Vt(this._transform,this._orientation)}forward(){const t=si(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=si(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=si(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const s=new Float64Array(16);return it.invert(s,this.getWorldToCamera(t,n)),s}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,s){const a=this.position;G.scale(a,a,-t);const c=new Float64Array(16);return it.fromScaling(c,[s,s,s]),it.translate(c,c,a),c[10]*=n,c}getWorldToCamera(t,n){const s=new Float64Array(16),a=new Float64Array(4),c=this.position;return ur.conjugate(a,this._orientation),G.scale(c,c,-t),it.fromQuat(s,a),it.translate(s,s,c),s[1]*=-1,s[5]*=-1,s[9]*=-1,s[13]*=-1,s[8]*=n,s[9]*=n,s[10]*=n,s[11]*=n,s}getCameraToClipPerspective(t,n,s,a){const c=new Float64Array(16);return it.perspective(c,t,n,s,a),c}getCameraToClipOrthographic(t,n,s,a,c,u){const d=new Float64Array(16);return it.ortho(d,t,n,s,a,c,u),d}getDistanceToElevation(t,n=!1){const s=0===t?0:An(t,n?Ei(this.position[1]):this.position[1]),a=this.forward();return(s-this.position[2])/a[2]}clone(){return new cg([...this.position],[...this.orientation])}}function lE(e,t){const n=Gc(e.projection,e.zoom,e.width,e.height),s=function(c,u,d,f,p){const g=new ve(d.lng-180*ta,d.lat),_=new ve(d.lng+180*ta,d.lat),v=c.project(g.lng,g.lat),x=c.project(_.lng,_.lat),b=-Math.atan2(x.y-v.y,x.x-v.x),E=We.fromLngLat(d);E.y=Qt(E.y,-1+ta,1-ta);const C=E.toLngLat(),M=c.project(C.lng,C.lat),T=We.fromLngLat(C);T.x+=ta;const R=T.toLngLat(),P=c.project(R.lng,R.lat),I=Wv(P.x-M.x,P.y-M.y,b),O=We.fromLngLat(C);O.y+=ta;const L=O.toLngLat(),F=c.project(L.lng,L.lat),N=Wv(F.x-M.x,F.y-M.y,b),B=Math.abs(I.x)/Math.abs(N.y),V=it.identity([]);it.rotateZ(V,V,-b*(1-(p?0:f)));const U=it.identity([]);return it.scale(U,U,[1,1-(1-B)*f,1]),U[4]=-N.x/N.y*f,it.rotateZ(U,U,b),it.multiply(U,V,U),U}(e.projection,0,e.center,n,t),a=cE(e);return it.scale(s,s,[a,a,1]),s}function cE(e){const t=e.projection,n=Gc(e.projection,e.zoom,e.width,e.height),s=Zv(t,e.center),a=Zv(t,ve.convert(t.center));return Math.pow(2,s*n+(1-n)*a)}function Gc(e,t,n,s,a=1/0){const c=e.range;if(!c)return 0;const u=Math.min(a,Math.max(n,s)),d=Math.log(u/1024)/Math.LN2;return Ps(c[0]+d,c[1]+d,t)}const ta=1/4e4;function Zv(e,t){const n=Qt(t.lat,-li,li),s=new ve(t.lng-180*ta,n),a=new ve(t.lng+180*ta,n),c=e.project(s.lng,n),u=e.project(a.lng,n),d=We.fromLngLat(s),f=We.fromLngLat(a),p=u.x-c.x,g=u.y-c.y,_=f.x-d.x,v=f.y-d.y,x=Math.sqrt((_*_+v*v)/(p*p+g*g));return Math.log(x)/Math.LN2}function Wv(e,t,n){const s=Math.cos(n),a=Math.sin(n);return{x:e*s-t*a,y:e*a+t*s}}function qc(e,t,n){return t*(ut/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}const Sh={unknown:0,flipRequired:1,flipNotRequired:2},LS=Math.tan(85*Math.PI/180);function Zc(e,t,n,s,a,c,u){const d=it.create();if(n)if("globe"===c.name){const f=function(p,g){const{x:_,y:v}=p.point,x=$b(_,v,p.worldSize/p._pixelsPerMercatorPixel,0,0);return it.multiply(x,x,jy(Mo(g)))}(a,t);it.multiply(d,d,f)}else{const f=Yu.invert([],u);d[0]=f[0],d[1]=f[1],d[4]=f[2],d[5]=f[3],s||it.rotateZ(d,d,a.angle)}else it.multiply(d,a.labelPlaneMatrix,e);return d}function Yv(e,t,n,s,a,c,u){const d=Zc(e,t,n,s,a,c,u);return"globe"===c.name&&n||(d[2]=d[6]=d[10]=d[14]=0),d}function Na(e,t,n,s,a,c,u){if(n){if("globe"===c.name){const d=Zc(e,t,n,s,a,c,u);return it.invert(d,d),it.multiply(d,e,d),d}{const d=it.clone(e),f=it.identity([]);return f[0]=u[0],f[1]=u[1],f[4]=u[2],f[5]=u[3],it.multiply(d,d,f),s||it.rotateZ(d,d,-a.angle),d}}return a.glCoordMatrix}function Zo(e,t,n,s){const a=[e,t,n,1];n?mn.transformMat4(a,a,s):Kv(a,a,s);const c=a[3];return a[0]/=c,a[1]/=c,a[2]/=c,a}function uE(e,t){return Math.min(.5+e/t*.5,1.5)}function hE(e,t){const n=e[0]/e[3],s=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&s>=-t[1]&&s<=t[1]}function dE(e,t,n,s,a,c,u,d,f,p){const g=n.transform,_=s?e.textSizeData:e.iconSizeData,v=vs(_,n.transform.zoom),x="globe"===g.projection.name,b=[256/n.width*2+1,256/n.height*2+1],E=s?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;E.clear();let C=null;x&&(C=s?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const M=e.lineVertexArray,T=s?e.text.placedSymbolArray:e.icon.placedSymbolArray,R=n.transform.width/n.transform.height;let P,I=!1;for(let O=0;O<T.length;O++){const L=T.get(O),{numGlyphs:F,writingMode:N}=L;if(N!==On.vertical||I||P===On.horizontal||(I=!0),P=N,(L.hidden||N===On.vertical)&&!I){Ol(F,E);continue}I=!1;const B=new et(L.tileAnchorX,L.tileAnchorY);let{x:V,y:U,z:q}=g.projection.projectTilePoint(B.x,B.y,p.canonical);if(f){const[dt,ft,gt]=f(B);V+=dt,U+=ft,q+=gt}const j=[V,U,q,1];if(mn.transformMat4(j,j,t),!hE(j,b)){Ol(F,E);continue}const X=j[3],Q=uE(n.transform.getCameraToCenterDistance(g.projection),X),nt=lh(_,v,L),Y=u?nt/Q:nt*Q,K=Zo(V,U,q,a);if(K[3]<=0){Ol(F,E);continue}let ot={};const at=u?null:f,lt=pE(L,Y,!1,d,t,a,c,e.glyphOffsetArray,M,E,C,K,B,ot,R,at,g.projection,p,u);I=lt.useVertical,at&&lt.needsFlipping&&(ot={}),(lt.notEnoughRoom||I||lt.needsFlipping&&pE(L,Y,!0,d,t,a,c,e.glyphOffsetArray,M,E,C,K,B,ot,R,at,g.projection,p,u).notEnoughRoom)&&Ol(F,E)}s?(e.text.dynamicLayoutVertexBuffer.updateData(E),C&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(C)):(e.icon.dynamicLayoutVertexBuffer.updateData(E),C&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(C))}function Xv(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E){const{lineStartIndex:C,glyphStartIndex:M,segment:T}=d,R=M+d.numGlyphs,P=C+d.lineLength,I=t.getoffsetX(M),O=t.getoffsetX(R-1),L=Ef(e*I,n,s,a,c,u,T,C,P,f,p,g,_,v,!0,x,b,E);if(!L)return null;const F=Ef(e*O,n,s,a,c,u,T,C,P,f,p,g,_,v,!0,x,b,E);return F?{first:L,last:F}:null}function fE(e,t,n,s){return e===On.horizontal&&Math.abs(s)>Math.abs(n)?{useVertical:!0}:e===On.vertical?s>0?{needsFlipping:!0}:null:t!==Sh.unknown&&(0===(a=n)||Math.abs(s/a)>LS)?t===Sh.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null;var a}function pE(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C,M,T){const R=t/24,P=e.lineOffsetX*R,I=e.lineOffsetY*R,{lineStartIndex:O,glyphStartIndex:L,numGlyphs:F,segment:N,writingMode:B,flipState:V}=e,U=O+e.lineLength,q=j=>{if(g){const[Y,K,ot]=j.up,at=p.length;og(g,at+0,Y,K,ot),og(g,at+1,Y,K,ot),og(g,at+2,Y,K,ot),og(g,at+3,Y,K,ot)}const[X,Q,nt]=j.point;yh(p,X,Q,nt,j.angle)};if(F>1){const j=Xv(R,d,P,I,n,_,v,e,f,c,x,E,!1,C,M,T);if(!j)return{notEnoughRoom:!0};if(s&&!n){let[X,Q,nt]=j.first.point,[Y,K,ot]=j.last.point;[X,Q]=Zo(X,Q,nt,u),[Y,K]=Zo(Y,K,ot,u);const at=fE(B,V,(Y-X)*b,K-Q);if(e.flipState=at&&at.needsFlipping?Sh.flipRequired:Sh.flipNotRequired,at)return at}q(j.first);for(let X=L+1;X<L+F-1;X++){const Q=Ef(R*d.getoffsetX(X),P,I,n,_,v,N,O,U,f,c,x,E,!1,!1,C,M,T);if(!Q)return p.length-=4*(X-L),{notEnoughRoom:!0};q(Q)}q(j.last)}else{if(s&&!n){const X=Zo(v.x,v.y,0,a),Q=O+N+1,nt=new et(f.getx(Q),f.gety(Q)),Y=Zo(nt.x,nt.y,0,a),K=Y[3]>0?Y:gE(v,nt,X,1,a,void 0,C,M.canonical),ot=fE(B,V,(K[0]-X[0])*b,K[1]-X[1]);if(e.flipState=ot&&ot.needsFlipping?Sh.flipRequired:Sh.flipNotRequired,ot)return ot}const j=Ef(R*d.getoffsetX(L),P,I,n,_,v,N,O,U,f,c,x,E,!1,!1,C,M,T);if(!j)return{notEnoughRoom:!0};q(j)}return{}}function mE(e,t,n,s,a){const{x:c,y:u,z:d}=s.projectTilePoint(e.x,e.y,t);if(!a)return Zo(c,u,d,n);const[f,p,g]=a(e);return Zo(c+f,u+p,d+g,n)}function gE(e,t,n,s,a,c,u,d){const f=mE(e.sub(t)._unit()._add(e),d,a,u,c);return G.sub(f,n,f),G.normalize(f,f),G.scaleAndAdd(f,n,f,s)}function Ef(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C,M){const T=s?e-t:e+t;let R=T>0?1:-1,P=0;s&&(R*=-1,P=Math.PI),R<0&&(P+=Math.PI);let I=d+u+(R>0?0:1)|0,O=a,L=a,F=0,N=0;const B=Math.abs(T),V=[],U=[];let q=c,j=q;const X=()=>gE(j,q,L,B-F+1,g,v,E,C.canonical);for(;F+N<=B;){if(I+=R,I<d||I>=f)return null;if(L=O,j=q,V.push(L),x&&U.push(j),q=new et(p.getx(I),p.gety(I)),O=_[I],!O){const ft=mE(q,C.canonical,g,E,v);O=ft[3]>0?_[I]=ft:X()}F+=N,N=G.distance(L,O)}b&&v&&(_[I]&&(O=X(),N=G.distance(L,O)),_[I]=O);const Q=(B-F)/N,nt=q.sub(j)._mult(Q)._add(j),Y=G.sub([],O,L),K=G.scaleAndAdd([],L,Y,Q);let ot=[0,0,1],at=Y[0],lt=Y[1];if(M&&(ot=E.upVector(C.canonical,nt.x,nt.y),0!==ot[0]||0!==ot[1]||1!==ot[2])){const ft=[ot[2],0,-ot[0]],gt=G.cross([],ot,ft);G.normalize(ft,ft),G.normalize(gt,gt),at=G.dot(Y,ft),lt=G.dot(Y,gt)}if(n){const ft=G.cross([],ot,Y);G.normalize(ft,ft),G.scaleAndAdd(K,K,ft,n*R)}const dt=P+Math.atan2(lt,at);return V.push(K),x&&U.push(nt),{point:K,angle:dt,path:V,tilePath:U,up:ot}}function Ol(e,t){const n=t.length,s=n+4*e;t.resize(s),t.float32.fill(-1/0,4*n,4*s)}function Kv(e,t,n){const s=t[0],a=t[1];return e[0]=n[0]*s+n[4]*a+n[12],e[1]=n[1]*s+n[5]*a+n[13],e[3]=n[3]*s+n[7]*a+n[15],e}const Qv=(e,t,n)=>(1-n)*e+n*t,Jv=e=>e*e*e*e*e;class ug{constructor(t,n,s,a,c,u,d){this.tileSize=512,this._renderWorldCopies=void 0===c||c,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=s??0,this._maxPitch=a??60,this.setProjection(u),this.setMaxBounds(d),this.width=0,this.height=0,this._center=new ve(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Gv,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new cg,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new ug(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(t,n=!1){const s=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||s)&&this._updateCameraOnTerrain(),(t||s)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return Or(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=eg(this.projectionOptions);const s=!Xe(n,this.getProjection());return s&&this._calcMatrices(),this.mercatorFromTransition=!1,s}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=eg({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return An(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new et(this.width,this.height)}get bearing(){return Os(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=Yu.create(),Yu.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=Qt(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=De(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const s=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&s.exaggeration()&&this._centerAltitudeValidForExaggeration!==s.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*s.exaggeration(),this._centerAltitudeValidForExaggeration=s.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=s.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],s=this.horizonLineFromTop();let a=0,c=0;for(let u=0;u<n.length;u++){const d=new et(n[u][0]*this.width,s+n[u][1]*(this.height-s)),f=t.pointCoordinate(d);if(!f)continue;const p=1/Math.hypot(f[0]-this._camera.position[0],f[1]-this._camera.position[1]);a+=f[3]*p,c+=p}return 0===c?NaN:a/c}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),s=this.pixelsPerMeter/this.worldSize*n,a=this._mercatorZfromZoom(t),c=this._mercatorZfromZoom(this._maxZoom),u=Math.max(a-s,c);this._setZoom(this._zoomFromMercatorZ(u))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let s;s=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const a=G.length(G.sub([],this._camera.position,s));return Qt(this._zoomFromMercatorZ(a),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!ur.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const s=[t.position.x,t.position.y,t.position.z];G.exactEquals(s,this._camera.position)||(this._setCameraPosition(s),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new qv;return n.position=new We(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!ur.length(t))return!1;ur.normalize(t,t);const n=G.transformQuat([],[0,0,-1],t),s=G.transformQuat([],[0,-1,0],t);if(s[2]<0)return!1;const a=ke(n,s);return!!a&&(this._camera.orientation=a,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,s=this.zoomScale(this.maxZoom)*this.tileSize,a=this.cameraToCenterDistance;t[2]=Qt(t[2],a/s,a/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,s){this._unmodified=!1,this._edgeInsets.interpolate(t,n,s),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new Tc(0,t)];if(this.renderWorldCopies){const s=this.pointCoordinate(new et(0,0)),a=this.pointCoordinate(new et(this.width,0)),c=this.pointCoordinate(new et(this.width,this.height)),u=this.pointCoordinate(new et(0,this.height)),d=Math.floor(Math.min(s.x,a.x,c.x,u.x)),f=Math.floor(Math.max(s.x,a.x,c.x,u.x)),p=1;for(let g=d-p;g<=f+p;g++)0!==g&&n.push(new Tc(g,t))}return n}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,n,s){let a=[];if(0===n[0]&&0===n[1])return a;for(const u of t){const d=u.canonical,f=u.overscaledZ,p=u.wrap,g=1<<d.z,_=d.x+1<g,v=d.x>0,x=d.y+1<g,b=d.y>0,E=u.wrap-(v?0:1),C=u.wrap+(_?0:1),M=v?d.x-1:g-1,T=_?d.x+1:0;n[0]<0?(a.push(new nn(f,C,d.z,T,d.y)),n[1]<0&&x&&(a.push(new nn(f,p,d.z,d.x,d.y+1)),a.push(new nn(f,C,d.z,T,d.y+1))),n[1]>0&&b&&(a.push(new nn(f,p,d.z,d.x,d.y-1)),a.push(new nn(f,C,d.z,T,d.y-1)))):n[0]>0?(a.push(new nn(f,E,d.z,M,d.y)),n[1]<0&&x&&(a.push(new nn(f,p,d.z,d.x,d.y+1)),a.push(new nn(f,E,d.z,M,d.y+1))),n[1]>0&&b&&(a.push(new nn(f,p,d.z,d.x,d.y-1)),a.push(new nn(f,E,d.z,M,d.y-1)))):n[1]<0&&x?a.push(new nn(f,p,d.z,d.x,d.y+1)):b&&a.push(new nn(f,p,d.z,d.x,d.y-1))}if(a.length>1){a.sort((f,p)=>f.overscaledZ-p.overscaledZ||f.wrap-p.wrap||f.canonical.z-p.canonical.z||f.canonical.x-p.canonical.x||f.canonical.y-p.canonical.y);let u=0,d=0;for(;d<a.length;)a[d].equals(a[u])?++d:a[++u]=a[d++];a.length=u+1}const c=[];for(const u of a)a.some(d=>u.isChildOf(d))||c.push(u);return a=c.filter(u=>!t.some(d=>!!(u.overscaledZ<s&&d.isChildOf(u))||u.equals(d)||u.isChildOf(d))),a}coveringTiles(t){let n=this.coveringZoomLevel(t);const s=n,a=this.elevation&&this.elevation.exaggeration(),c=a&&!t.isTerrainDEM,u="mercator"===this.projection.name;if(void 0!==t.minzoom&&n<t.minzoom)return[];void 0!==t.maxzoom&&n>t.maxzoom&&(n=t.maxzoom);const d=this.locationCoordinate(this.center),f=this.center.lat,p=1<<n,g=[p*d.x,p*d.y,0],_="globe"===this.projection.name,v=!_,x=so.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,v),b=_?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),E=p*An(1,this.center.lat),C=this._camera.position[2]/An(1,this.center.lat),M=[p*b.x,p*b.y,C*(v?1:E)],T=_||a,R=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),P=this.isLODDisabled(!0)?n:0;let I;if(this._elevation&&t.isTerrainDEM)I=1e4*this._elevation.exaggeration();else if(this._elevation){const Y=this._elevation.getMinMaxForVisibleTiles();I=Y?Y.max:this._centerAltitude}else I=this._centerAltitude;const O=t.isTerrainDEM?-I:this._elevation?this._elevation.getMinElevationBelowMSL():0,L=this.projection.isReprojectedInTileSpace?cE(this):1,F=Y=>{const ot=new We(Y.x+25e-6,Y.y,Y.z),at=new We(Y.x,Y.y+25e-6,Y.z),lt=Y.toLngLat(),dt=ot.toLngLat(),ft=at.toLngLat(),gt=this.locationCoordinate(lt),ht=this.locationCoordinate(dt),yt=this.locationCoordinate(ft),Ot=Math.hypot(ht.x-gt.x,ht.y-gt.y),Lt=Math.hypot(yt.x-gt.x,yt.y-gt.y);return Math.sqrt(Ot*Lt)*L/25e-6},N=Y=>{const K=I,ot=O;return{aabb:kw(this,p,0,0,0,Y,ot,K,this.projection),zoom:0,x:0,y:0,minZ:ot,maxZ:K,wrap:Y,fullyVisible:!1}},B=[];let V=[];const U=n,q=t.reparseOverscaled?s:n,j=Y=>Y*Y,X=j((C-this._centerAltitude)*E),Q=Y=>{if(!this._elevation||!Y.tileID||!u)return;const K=this._elevation.getMinMaxForTile(Y.tileID),ot=Y.aabb;K?(ot.min[2]=K.min,ot.max[2]=K.max,ot.center[2]=(ot.min[2]+ot.max[2])/2):(Y.shouldSplit=nt(Y),Y.shouldSplit||(ot.min[2]=ot.max[2]=ot.center[2]=this._centerAltitude))},nt=Y=>{if(Y.zoom<P)return!0;if(Y.zoom===U)return!1;if(null!=Y.shouldSplit)return Y.shouldSplit;const K=Y.aabb.distanceX(M),ot=Y.aabb.distanceY(M);let at=X,lt=1;if(_){at=j(Y.aabb.distanceZ(M));const gt=Math.pow(2,Y.zoom),ht=Ei((Y.y+1)/gt),yt=Ei(Y.y/gt),Ot=Math.min(Math.max(f,ht),yt),Lt=Ac(Ot)/Ac(f);if(lt=Ot===f?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Lt/this._mercatorScaleRatio),this.zoom<=Gd&&Y.zoom===U-1&&Lt>=.9)return!0}else if(c&&(at=j(Y.aabb.distanceZ(M)*E)),this.projection.isReprojectedInTileSpace&&s<=5){const gt=Math.pow(2,Y.zoom),ht=F(new We((Y.x+.5)/gt,(Y.y+.5)/gt));lt=ht>.85?1:ht}const dt=K*K+ot*ot+at;return dt<j((1<<U-Y.zoom)*R*lt*((gt,ht)=>{if(ht*j(.707)<gt)return 1;const yt=Math.sqrt(ht/gt);return yt/(1.4144271570014144+(Math.pow(1.1,yt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(at,X),dt))};if(this.renderWorldCopies)for(let Y=1;Y<=3;Y++)B.push(N(-Y)),B.push(N(Y));for(B.push(N(0));B.length>0;){const Y=B.pop(),K=Y.x,ot=Y.y;let at=Y.fullyVisible;const lt=()=>"globe"===this.projection.name&&(0===Y.y||Y.y===(1<<Y.zoom)-1);if(!at){let dt=T?Y.aabb.intersects(x):Y.aabb.intersectsFlat(x);if(0===dt&&lt()){const ft=new oo(Y.zoom,K,ot);dt=qs(this,p,ft,!0).intersects(x)}if(0===dt)continue;at=2===dt}if(Y.zoom!==U&&nt(Y))for(let dt=0;dt<4;dt++){const ft=(K<<1)+dt%2,gt=(ot<<1)+(dt>>1),ht={aabb:u?Y.aabb.quadrant(dt):kw(this,p,Y.zoom+1,ft,gt,Y.wrap,Y.minZ,Y.maxZ,this.projection),zoom:Y.zoom+1,x:ft,y:gt,wrap:Y.wrap,fullyVisible:at,tileID:void 0,shouldSplit:void 0,minZ:Y.minZ,maxZ:Y.maxZ};c&&!_&&(ht.tileID=new nn(Y.zoom+1===U?q:Y.zoom+1,Y.wrap,Y.zoom+1,ft,gt),Q(ht)),B.push(ht)}else{const dt=Y.zoom===U?q:Y.zoom;if(t.minzoom&&t.minzoom>dt)continue;if(!at){let yt=T?Y.aabb.intersectsPrecise(x):Y.aabb.intersectsPreciseFlat(x);if(0===yt&&lt()){const Ot=new oo(Y.zoom,K,ot);yt=qs(this,p,Ot,!0).intersectsPrecise(x)}if(0===yt)continue}const ft=g[0]-(.5+K+(Y.wrap<<Y.zoom))*(1<<n-Y.zoom),gt=g[1]-.5-ot,ht=Y.tileID?Y.tileID:new nn(dt,Y.wrap,Y.zoom,K,ot);V.push({tileID:ht,distanceSq:ft*ft+gt*gt})}}if(this.fogCullDistSq){const Y=this.fogCullDistSq,K=this.horizonLineFromTop();V=V.filter(ot=>{const at=[0,0,0,1],lt=[ut,ut,0,1],dt=this.calculateFogTileMatrix(ot.tileID.toUnwrapped());mn.transformMat4(at,at,dt),mn.transformMat4(lt,lt,dt);const ft=function(yt,Ot,Lt){let Ut=0;for(let Gt=0;Gt<2;++Gt)yt[Gt]>0&&(Ut+=(yt[Gt]-0)*(yt[Gt]-0)),Ot[Gt]<0&&(Ut+=(0-Ot[Gt])*(0-Ot[Gt]));return Ut}(mn.min([],at,lt),mn.max([],at,lt));if(0===ft)return!0;let gt=!1;const ht=this._elevation;if(ht&&ft>Y&&0!==K){const yt=this.calculateProjMatrix(ot.tileID.toUnwrapped());let Ot;t.isTerrainDEM||(Ot=ht.getMinMaxForTile(ot.tileID)),Ot||(Ot={min:O,max:I});const Lt=function(Gt){const me=Math.round((Gt+45+360)%360/90)%4;return g_[me]}(this.rotation),Ut=[Lt[0]*ut,Lt[1]*ut,Ot.max];G.transformMat4(Ut,Ut,yt),gt=(1-Ut[1])*this.height*.5<K}return ft<Y||gt})}return V.sort((Y,K)=>Y.distanceSq-K.distanceSq).map(Y=>Y.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=Qt(t.lat,-li,li),s=this.projection.project(t.lng,n);return new et(s.x*this.worldSize,s.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/An(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let s,a;const c=this.centerPoint;if("globe"===this.projection.name){const d=this.worldSize;s=(n.x-c.x)/d,a=(n.y-c.y)/d}else{const d=this.pointCoordinate(n),f=this.pointCoordinate(c);s=d.x-f.x,a=d.y-f.y}const u=this.locationCoordinate(t);this.setLocation(new We(u.x-s,u.y-a))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,n){const s=n?An(n,t.lat):void 0,a=this.projection.project(t.lng,t.lat);return new We(a.x,a.y,s)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,n){const s=n??this._centerAltitude,a=[t.x,t.y,0,1],c=[t.x,t.y,1,1];mn.transformMat4(a,a,this.pixelMatrixInverse),mn.transformMat4(c,c,this.pixelMatrixInverse);const u=c[3];mn.scale(a,a,1/a[3]),mn.scale(c,c,1/u);const d=a[2],f=c[2];return{p0:a,p1:c,t:d===f?0:(s-d)/(f-d)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],s=[t.x,t.y,1,1];return mn.transformMat4(n,n,this.pixelMatrixInverse),mn.transformMat4(s,s,this.pixelMatrixInverse),mn.scale(n,n,1/n[3]),mn.scale(s,s,1/s[3]),n[2]=An(n[2],this._center.lat)*this.worldSize,s[2]=An(s[2],this._center.lat)*this.worldSize,mn.scale(n,n,1/this.worldSize),mn.scale(s,s,1/this.worldSize),new gm([n[0],n[1],n[2]],G.normalize([],G.sub([],s,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:s,t:a}=t,c=An(n[2],this._center.lat),u=An(s[2],this._center.lat);return new We(vt(n[0],s[0],a)/this.worldSize,vt(n[1],s[1],a)/this.worldSize,vt(c,u,a))}pointCoordinate(t,n=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,n)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let n=this.projection.pointCoordinate3D(this,t.x,t.y);if(n)return new We(n[0],n[1],n[2]);let s=0,a=this.horizonLineFromTop();if(t.y>a)return this.pointCoordinate(t);const c=.02*a,u=t.clone();for(let d=0;d<10&&a-s>c;d++){u.y=vt(s,a,.66);const f=this.projection.pointCoordinate3D(this,u.x,u.y);f?(a=u.y,n=f):s=u.y}return n?new We(n[0],n[1],n[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=Sc)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const s=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,a=[t.x*this.worldSize,t.y*this.worldSize,s+t.toAltitude(),1];return mn.transformMat4(a,a,this.pixelMatrix),a[3]>0?new et(a[0]/a[3],a[1]/a[3]):new et(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,s=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,c=this.pointLocation3D(new et(n,t)),u=this.pointLocation3D(new et(a,t)),d=this.pointLocation3D(new et(a,s)),f=this.pointLocation3D(new et(n,s));let p=Math.min(c.lng,u.lng,d.lng,f.lng),g=Math.max(c.lng,u.lng,d.lng,f.lng),_=Math.min(c.lat,u.lat,d.lat,f.lat),v=Math.max(c.lat,u.lat,d.lat,f.lat);const x=Math.pow(2,-this.zoom)/16*270,b="globe"===this.projection.name?1:4,E=(C,M,T,R,P)=>{const I=(C+T)/2,O=(M+R)/2,L=new et(I,O),{lng:F,lat:N}=this.pointLocation3D(L),B=Math.max(0,p-F,_-N,F-g,N-v);p=Math.min(p,F),g=Math.max(g,F),_=Math.min(_,N),v=Math.max(v,N),(P<b||B>x)&&(E(C,M,I,O,P+1),E(I,O,T,R,P+1))};if(E(n,t,a,t,1),E(a,t,a,s,1),E(a,s,n,s,1),E(n,s,n,t,1),"globe"===this.projection.name){const[C,M]=function(T){const R=it.identity(new Float64Array(16));it.multiply(R,T.pixelMatrix,T.globeMatrix);const P=[0,Hr,0],I=[0,ao,0];return G.transformMat4(P,P,R),G.transformMat4(I,I,R),[P[0]>0&&P[0]<=T.width&&P[1]>0&&P[1]<=T.height&&!Hy(T,new ve(T.center.lat,90)),I[0]>0&&I[0]<=T.width&&I[1]>0&&I[1]<=T.height&&!Hy(T,new ve(T.center.lat,-90))]}(this);C?(v=90,g=180,p=-180):M&&(_=-90,g=180,p=-180)}return new Ur(new ve(p,_),new ve(g,v))}_getBoundsRectangular(t,n){const{top:s,left:a}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,u=this.width-this._edgeInsets.right,d=new et(a,s),f=new et(u,s),p=new et(u,c),g=new et(a,c);let _=this.pointCoordinate(d,t),v=this.pointCoordinate(f,t);const x=this.pointCoordinate(p,n),b=this.pointCoordinate(g,n),E=(C,M)=>(M.y-C.y)/(M.x-C.x);return _.y>1&&v.y>=0?_=new We((1-b.y)/E(b,_)+b.x,1):_.y<0&&v.y<=1&&(_=new We(-b.y/E(b,_)+b.x,0)),v.y>1&&_.y>=0?v=new We((1-x.y)/E(x,v)+x.x,1):v.y<0&&_.y<=1&&(v=new We(-x.y/E(x,v)+x.x,0)),(new Ur).extend(this.coordinateLocation(_)).extend(this.coordinateLocation(v)).extend(this.coordinateLocation(b)).extend(this.coordinateLocation(x))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=t.visibleDemTiles.reduce((s,a)=>{if(a.dem){const c=a.dem.tree;s.min=Math.min(s.min,c.minimums[0]),s.max=Math.max(s.max,c.maximums[0])}return s},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*t.exaggeration(),n.max*t.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,s=this.height/2-n*(1-this._horizonShift);return t?Math.max(0,s):s}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-li,this.maxLat=li,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=Ri(this.minLng)*this.tileSize,this.worldMaxX=Ri(this.maxLng)*this.tileSize,this.worldMinY=wi(this.maxLat)*this.tileSize,this.worldMaxY=wi(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,n){return this.projection.createTileMatrix(this,n,t)}calculateDistanceTileData(t){const n=t.key,s=this._distanceTileDataCache;if(s[n])return s[n];const a=t.canonical,c=1/this.height,u=this.cameraWorldSize,d=u/this.zoomScale(a.z),f=(a.x+Math.pow(2,a.z)*t.wrap)*d,p=a.y*d,g=this.point;g.x*=u/this.worldSize,g.y*=u/this.worldSize;const _=this.angle,v=Math.sin(-_),x=-Math.cos(-_);return s[n]={bearing:[v,x],center:[(g.x-f)*c,(g.y-p)*c],scale:d/ut*c},s[n]}calculateFogTileMatrix(t){const n=t.key,s=this._fogTileMatrixCache;if(s[n])return s[n];const a=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return it.multiply(a,this.worldToFogMatrix,a),s[n]=new Float32Array(a),s[n]}calculateProjMatrix(t,n=!1,s=!1){const a=t.key;let c;if(c=s?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,c[a])return c[a];const u=this.calculatePosMatrix(t,this.worldSize);let d;return d=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:s?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,it.multiply(u,d,u),c[a]=new Float32Array(u),c[a]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,s=this._pixelsToTileUnitsCache;if(s[n])return s[n];const a=function(c,u){const{scale:d}=c.tileTransform,f=d*ut/(c.tileSize*Math.pow(2,u.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return Yu.scale(new Float32Array(4),u.inverseAdjustmentMatrix,[f,f])}(t,this);return s[n]=a,s[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,n=it.fromScaling([],[t,t,t]);return it.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const n=An(1,this._center.lat)*this.worldSize,s=this._computeCameraPosition(n),a=this._camera.forward(),c=An(1,this._center.lat);s[2]/=c,a[2]/=c,G.normalize(a,a);const u=t.raycast(s,a,t.exaggeration());if(u){const d=G.scaleAndAdd([],s,a,u),f=new We(d[0],d[1],An(d[2],Ei(d[1]))),p=(f.z+G.length([f.x-s[0],f.y-s[1],f.z-s[2]*c]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(p),this._centerAltitude=f.toAltitude(),this._center=this.coordinateLocation(f),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const n=this._elevation,s=An(1,this._center.lat)*this.worldSize,a=this._computeCameraPosition(s),c=n.getAtPointOrZero(new We(...a)),u=this.pixelsPerMeter/this.worldSize*c,d=this._minimumHeightOverTerrain(),f=a[2]-u;if(f<=d)if(f<0||t){const p=this.locationCoordinate(this._center,this._centerAltitude),g=[a[0],a[1],p.z-a[2]],_=G.length(g);g[2]-=(d-f)/this._pixelsPerMercatorPixel;const v=G.length(g);if(0===v)return;G.scale(g,g,_/v*this._pixelsPerMercatorPixel),this._camera.position=[a[0],a[1],p.z*this._pixelsPerMercatorPixel-g[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const v=this.center;return v.lat=Qt(v.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(v.lng=Qt(v.lng,this.minLng,this.maxLng)),this.center=v,void(this._constraining=!1)}const n=this._unmodified,{x:s,y:a}=this.point;let c=0,u=s,d=a;const f=this.width/2,p=this.height/2,g=this.worldMinY*this.scale,_=this.worldMaxY*this.scale;if(a-p<g&&(d=g+p),a+p>_&&(d=_-p),_-g<this.height&&(c=Math.max(c,this.height/(_-g)),d=(_+g)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const v=this.worldMinX*this.scale,x=this.worldMaxX*this.scale,b=this.worldSize/2-(v+x)/2;u=(s+b+this.worldSize)%this.worldSize-b,u-f<v&&(u=v+f),u+f>x&&(u=x-f),x-v<this.width&&(c=Math.max(c,this.width/(x-v)),u=(x+v)/2)}u===s&&d===a||(this.center=this.unproject(new et(u,d))),c&&(this.zoom+=this.scaleZoom(c)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n="globe"===this.projection.name,s=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=An(1,this.center.lat)/An(1,45));const a=Gc(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,a),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const c="meters"===this.projection.zAxisUnit?s:1,u=this._camera.getWorldToCamera(this.worldSize,c);let d;const f=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(f[8]=2*-t.x/this.width,f[9]=2*t.y/this.height,this.isOrthographic){let N=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),B=N*this.aspect,V=-B,U=-N;B-=t.x,V-=t.x,N+=t.y,U+=t.y,d=this._camera.getCameraToClipOrthographic(V,B,U,N,this._nearZ,this._farZ),((q,j,X,Q)=>{for(let nt=0;nt<16;nt++)q[nt]=Qv(j[nt],X[nt],Q)})(d,d,f,Jv(this.pitch>=15?1:this.pitch/15))}else d=f;const p=it.mul([],f,u);let g=it.mul([],d,u);if(this.projection.isReprojectedInTileSpace){const N=this.locationCoordinate(this.center),B=it.identity([]);it.translate(B,B,[N.x*this.worldSize,N.y*this.worldSize,0]),it.multiply(B,B,lE(this)),it.translate(B,B,[-N.x*this.worldSize,-N.y*this.worldSize,0]),it.multiply(g,g,B),it.multiply(p,p,B),this.inverseAdjustmentMatrix=function(V){const U=lE(V,!0);return Yu.invert([],[U[0],U[1],U[4],U[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=it.scale([],g,[this.worldSize,this.worldSize,this.worldSize/c,1]),this.projMatrix=g,this.invProjMatrix=it.invert(new Float64Array(16),this.projMatrix),n){const N=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);N[8]=2*-t.x/this.width,N[9]=2*t.y/this.height,this.expandedFarZProjMatrix=it.mul([],N,u)}else this.expandedFarZProjMatrix=this.projMatrix;const _=it.invert([],d);this.frustumCorners=Oy.fromInvProjectionMatrix(_,this.horizonLineFromTop(),this.height),this.cameraFrustum=so.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const v=new Float32Array(16);it.identity(v),it.scale(v,v,[1,-1,1]),it.rotateX(v,v,this._pitch),it.rotateZ(v,v,this.angle);const x=it.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=it.clone(x);const b=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;x[8]=2*-t.x/this.width,x[9]=2*(t.y+b)/this.height,this.skyboxMatrix=it.multiply(v,x,v);const E=this.point,C=E.x,M=E.y,T=this.width%2/2,R=this.height%2/2,P=Math.cos(this.angle),I=Math.sin(this.angle),O=C-Math.round(C)+P*T+I*R,L=M-Math.round(M)+P*R+I*T,F=new Float64Array(g);if(it.translate(F,F,[O>.5?O-1:O,L>.5?L-1:L,0]),this.alignedProjMatrix=F,g=it.create(),it.scale(g,g,[this.width/2,-this.height/2,1]),it.translate(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=it.create(),it.scale(g,g,[1,-1,1]),it.translate(g,g,[-1,-1,0]),it.scale(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g,this.pixelMatrix=it.multiply(new Float64Array(16),this.labelPlaneMatrix,p),this._calcFogMatrices(),this._distanceTileDataCache={},g=it.invert(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=g,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=function(B){const{x:V,y:U}=B.point,{lng:q,lat:j}=B._center;return $b(V,U,B.worldSize,q,j)}(this);const N=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=G.transformMat4(N,N,u),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=g;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,s=this._camera.position,a=1/this.height/this._pixelsPerMercatorPixel,c=[t,t,n];G.scale(c,c,a),G.scale(s,s,-1),G.multiply(s,s,c);const u=it.create();it.translate(u,u,s),it.scale(u,u,c),this.mercatorFogMatrix=u,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,a)}_computeCameraPosition(t){const n=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,s=this._camera.forward(),a=this.point,c=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-t/this.worldSize*this._centerAltitude;return[a.x/this.worldSize-s[0]*c,a.y/this.worldSize-s[1]*c,t/this.worldSize*this._centerAltitude-s[2]*c]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),s=this._camera.position[2],a=t[2];let c=1;this.projection.wrap&&(this.center=this.center.wrap()),a>0&&(c=Math.min((n-s)/a,1)),this._camera.position=G.scaleAndAdd([],this._camera.position,t,c),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:s,bearing:a}=this._camera.getPitchBearing(),c=An(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,u=this._mercatorZfromZoom(this._maxZoom)*Math.cos(De(this._maxPitch)),d=Math.max((t[2]-c)/Math.cos(s),u),f=this._zoomFromMercatorZ(d);G.scaleAndAdd(t,t,n,d),this._pitch=Qt(s,De(this.minPitch),De(this.maxPitch)),this.angle=Os(a,-Math.PI,Math.PI),this._setZoom(Qt(f,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new We(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,s=Sc,a=0,c=1/0;for(;s-n>1e-6&&s>n;){const u=n+.5*(s-n),d=this.tileSize*Math.pow(2,u),f=this.getCameraToCenterDistance(this.projection,u,d),p=this.scaleZoom(f/(t*this.tileSize)),g=Math.abs(u-p);g<c&&(c=g,a=u),u<p?n=u:s=u}return a}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(tt("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const s=Math.min(t.x,n.x),a=Math.max(t.x,n.x),c=Math.min(t.y,n.y),u=Math.max(t.y,n.y);if(c<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const d=[new et(s,c),new et(a,u),new et(s,u),new et(a,c)],f=this.renderWorldCopies?-3:0,p=this.renderWorldCopies?4:1;for(const g of d){const _=this.pointRayIntersection(g);if(_.t<0)return!0;const v=this.rayIntersectionCoordinate(_);if(v.x<f||v.y<0||v.x>p||v.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+ki(this.fovAboveCenter)>88||this.anyCornerOffEdge(new et(0,0),new et(this.width,this.height))}zoomDeltaToMovement(t,n){const s=G.length(G.sub([],this._camera.position,t)),a=this._zoomFromMercatorZ(s)+n;return s-this._mercatorZfromZoom(a)}getCameraPoint(){if("globe"===this.projection.name){const t=function([n,s,a],c){const u=[n,s,a,1];mn.transformMat4(u,u,c);const d=u[3]=Math.max(u[3],1e-6);return u[0]/=d,u[1]/=d,u[2]/=d,u}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new et(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new et(0,t))}}getCameraToCenterDistance(t,n=this.zoom,s=this.worldSize){const a=Gc(t,n,this.width,this.height,1024),c=t.pixelSpaceConversion(this.center.lat,s,a);let u=.5/Math.tan(.5*this._fov)*this.height*c;return this.isOrthographic&&(u=Qv(1,u,Jv(this.pitch>=15?1:this.pitch/15))),u}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&it.multiply(t,t,this.globeMatrix),t}getFrustum(t){return so.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}function t0(e,t,n){it.identity(e),it.rotateZ(e,e,De(t[2])),it.rotateX(e,e,De(t[0])),it.rotateY(e,e,De(t[1])),it.scale(e,e,n),it.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Cf(e,t,n,s,a,c,u,d){const f=[n[0]-t[0],n[1]-t[1],0],p=[s[0]-t[0],s[1]-t[1],0];if(G.length(f)<1e-12||G.length(p)<1e-12)return ur.identity(e);const g=G.cross([],f,p);G.normalize(g,g),G.subtract(p,s,t),f[2]=(c-a)*d,p[2]=(u-a)*d;const _=f;return G.cross(_,f,p),G.normalize(_,_),ur.rotationTo(e,g,_)}function e0(e,t,n=!1){const s=ti(t.zoom),a=function(c,u,d){const f=u.worldSize,p=[c[12],c[13],c[14]],g=Ei(p[1]/f),_=or(p[0]/f),v=it.identity([]),x=An(1,g)*f,b=An(1,0)*f*bl(g,u.zoom),E=1/Vy(f);let C=b*E;if(d){const P=Gc(u.projection,u.zoom,u.width,u.height,1024);C=E*u.projection.pixelSpaceConversion(u.center.lat,f,P)}const M=lo(g,_);G.add(M,M,G.scale([],G.normalize([],M),x*C*p[2]));const T=function(P){const I=[P[0],P[1],P[2]];let O=[0,1,0];const L=G.cross([],O,I);return G.cross(O,I,L),0===G.squaredLength(O)&&(O=[0,1,0],G.cross(L,I,O)),G.normalize(L,L),G.normalize(O,O),G.normalize(I,I),[L[0],L[1],L[2],0,O[0],O[1],O[2],0,I[0],I[1],I[2],0,P[0],P[1],P[2],1]}(M);it.scale(v,v,[C,C,C*x]),it.translate(v,v,[-p[0],-p[1],-p[2]]);const R=it.multiply([],u.globeMatrix,T);return it.multiply(R,R,v),it.multiply(R,R,c),R}(e,t,n);return s>0?function(u,d,f){const p=(b,E,C)=>{const M=G.length(b),T=G.length(E),R=Ia(b,E,C);return G.scale(R,R,1/G.length(R)*vt(M,T,C))},g=p([u[0],u[1],u[2]],[d[0],d[1],d[2]],f),_=p([u[4],u[5],u[6]],[d[4],d[5],d[6]],f),v=p([u[8],u[9],u[10]],[d[8],d[9],d[10]],f),x=Ia([u[12],u[13],u[14]],[d[12],d[13],d[14]],f);return[g[0],g[1],g[2],0,_[0],_[1],_[2],0,v[0],v[1],v[2],0,x[0],x[1],x[2],1]}(a,function(u,d){const f=d.worldSize,p=An(1,0)*f*bl(d.center.lat,d.zoom)/Vy(f),g=An(1,d.center.lat)*f,_=it.identity([]);return it.rotateY(_,_,De(d.center.lng)),it.rotateX(_,_,De(d.center.lat)),it.translate(_,_,[0,0,Rr]),it.scale(_,_,[p,p,p*g]),it.translate(_,_,[d.point.x-.5*f,d.point.y-.5*f,0]),it.multiply(_,_,u),it.multiply(_,d.globeMatrix,_)}(e,t),s):a}const hg=[1,1,1];class za{constructor(t,n,s,a){this.id=t,this.position=null!=n?new ve(n[0],n[1]):new ve(0,0),this.orientation=s??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new qn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,n){if(it.multiply(t.matrix,n,t.matrix),t.meshes)for(const s of t.meshes){const a=qn.applyTransform(s.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(const s of t.children)this._applyTransformations(s,t.matrix)}computeBoundsAndApplyParent(){const t=it.identity([]);for(const n of this.nodes)this._applyTransformations(n,t)}_positionModelOnTerrain(t,n){const s=t.elevation;if(!s)return 0;const a=qn.projectAabbCorners(this.aabb,this.matrix),c=An(1,this.position.lat)*t.worldSize,u=function(M,T){const R=[0,0,1],P=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const I of P){const O=M[I.corners[0]],L=M[I.corners[1]],F=M[I.corners[2]],N=[L[0]-O[0],L[1]-O[1],T*(L[2]-O[2])],B=G.cross(N,N,[F[0]-O[0],F[1]-O[1],T*(F[2]-O[2])]);G.normalize(B,B),I.dotProductWithUp=G.dot(B,R)}return P.sort((I,O)=>I.dotProductWithUp-O.dotProductWithUp),P[0].corners}(a,c),d=a[u[0]],f=a[u[1]],p=a[u[2]],g=a[u[3]],_=s.getAtPointOrZero(new We(d[0]/t.worldSize,d[1]/t.worldSize),0),v=s.getAtPointOrZero(new We(f[0]/t.worldSize,f[1]/t.worldSize),0),x=s.getAtPointOrZero(new We(p[0]/t.worldSize,p[1]/t.worldSize),0),b=s.getAtPointOrZero(new We(g[0]/t.worldSize,g[1]/t.worldSize),0),E=(_+b)/2,C=(v+x)/2;return E>C?v<x?Cf(n,f,g,d,v,b,_,c):Cf(n,p,d,g,x,_,b,c):_<b?Cf(n,d,f,p,_,v,x,c):Cf(n,g,p,f,b,x,v,c),Math.max(E,C)}computeModelMatrix(t,n,s,a,c,u,d=!1){const f=t.transform,p=f.zoom,g=f.project(this.position),_=bl(this.position.lat,p),v=1/_;it.identity(this.matrix),it.translate(this.matrix,this.matrix,[g.x+a[0]*v,g.y+a[1]*v,a[2]]);let x=1,b=1;const E=f.worldSize;if(d){if("mercator"===f.projection.name){let R=0;f.elevation&&(R=f.elevation.getAtPointOrZero(new We(g.x/E,g.y/E),0));const P=mn.transformMat4([],[g.x,g.y,R,1],f.projMatrix)[3]/f.cameraToCenterDistance;x=P,b=P*bl(f.center.lat,p)}else if("globe"===f.projection.name){const R=e0(this.matrix,f),P=it.multiply([],f.projMatrix,R),I=[0,0,0,1];mn.transformMat4(I,I,P);const O=I[3]/f.cameraToCenterDistance,L=ti(p),F=f.projection.pixelsPerMeter(this.position.lat,E)*bl(this.position.lat,p),N=f.projection.pixelsPerMeter(f.center.lat,E)*bl(f.center.lat,p);x=O/vt(F,Zy(f.center.lat),L),b=O*_/F,x*=N,b*=N}}else x=v;it.scale(this.matrix,this.matrix,[x,x,b]);const C=[...this.matrix],M=this.orientation,T=[];if(t0(T,[M[0]+n[0],M[1]+n[1],M[2]+n[2]],s),it.multiply(this.matrix,C,T),c&&f.elevation){let R=0;const P=[];if(u&&f.elevation){R=this._positionModelOnTerrain(f,P);const I=it.fromQuat([],P),O=it.multiply([],I,T);it.multiply(this.matrix,C,O)}else R=f.elevation.getAtPointOrZero(new We(g.x/E,g.y/E),0);0!==R&&(this.matrix[14]+=R)}}upload(t){if(!this.uploaded){for(const n of this.nodes)Mf(n,t);for(const n of this.nodes)ea(n);this.uploaded=!0}}destroy(){for(const t of this.nodes)Ih(t)}}function Df(e,t,n=!1){e.uploaded||(e.gfxTexture=new Qn(t,e.image,n?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function FS(e,t,n){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,sE.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,kS.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,OS.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?RS:PS).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,Hv.members,!0)),e.segments=yn.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const s=e.material;s.pbrMetallicRoughness.baseColorTexture&&Df(s.pbrMetallicRoughness.baseColorTexture,t),s.pbrMetallicRoughness.metallicRoughnessTexture&&Df(s.pbrMetallicRoughness.metallicRoughnessTexture,t),s.normalTexture&&Df(s.normalTexture,t),s.occlusionTexture&&Df(s.occlusionTexture,t,n),s.emissionTexture&&Df(s.emissionTexture,t)}function Mf(e,t,n){if(e.meshes)for(const s of e.meshes)FS(s,t,n);if(e.children)for(const s of e.children)Mf(s,t,n)}function ea(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)ea(t)}function Ih(e){if(e.meshes)for(const n of e.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((t=n.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const n of e.children)Ih(n)}class _E{constructor(t,n){this.feature=t,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class dg{constructor(){this.instancedDataArray=new bc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class NS{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,n,s,a){this.tileToMeter=Wd(s);const c=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:u,id:d,index:f,sourceLayerIndex:p}of t){const g=Zs(u,c);if(!this.layers[0]._featureFilter.filter(new zn(this.zoom),g,s))continue;const _={id:d,sourceLayerIndex:p,index:f,geometry:c?g.geometry:gs(u,s,a),properties:u.properties,type:u.type,patterns:{}},v=this.addFeature(_,_.geometry,g);v&&n.featureIndex.insert(u,_.geometry,f,p,this.index,this.instancesPerModel[v].instancedDataArray.length)}this.lookup=null}update(t,n,s,a){for(const c in this.instancesPerModel){const u=this.instancesPerModel[c];for(const d in t)u.idToFeaturesIndex.hasOwnProperty(d)&&this.evaluate(u.features[u.idToFeaturesIndex[d]],t[d],u,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const n in this.instancesPerModel){const s=this.instancesPerModel[n];for(const a of s.features){const c=this.layers[0],u=a.feature,d=this.canonical,f=c.paint.get("model-rotation").evaluate(u,{},d),p=c.paint.get("model-scale").evaluate(u,{},d),g=c.paint.get("model-translation").evaluate(u,{},d);G.exactEquals(a.rotation,f)&&G.exactEquals(a.scale,p)&&G.exactEquals(a.translation,g)||(this.evaluate(a,a.featureStates,s,!0),t=!0)}}return t}isEmpty(){for(const t in this.instancesPerModel)if(0!==this.instancesPerModel[t].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const n in this.instancesPerModel){const s=this.instancesPerModel[n];s.instancedDataArray.length<0||0===s.instancedDataArray.length||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=t.createVertexBuffer(s.instancedDataArray,aE.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];0!==n.instancedDataArray.length&&n.instancedDataBuffer&&n.instancedDataBuffer.destroy()}}addFeature(t,n,s){const a=this.layers[0],c=a.layout.get("model-id").evaluate(s,{},this.canonical);if(!c)return tt(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),c;this.instancesPerModel[c]||(this.instancesPerModel[c]=new dg);const u=this.instancesPerModel[c],d=u.instancedDataArray,f=new _E(s,d.length);for(const p of n)for(const g of p){if(g.x<0||g.x>=ut||g.y<0||g.y>=ut)continue;const _=(this.lookupDim-1)/ut,v=this.lookupDim*(g.y*_|0)+g.x*_|0;if(this.lookup){if(0!==this.lookup[v])continue;this.lookup[v]=1}this.instanceCount++;const x=d.length;d.resize(x+1),u.instancesEvaluatedElevation.push(0),d.float32[16*x]=g.x,d.float32[16*x+1]=g.y}return f.instancedDataCount=u.instancedDataArray.length-f.instancedDataOffset,f.instancedDataCount>0&&(t.id&&(u.idToFeaturesIndex[t.id]=u.features.length),u.features.push(f),this.evaluate(f,{},u,!1)),c}evaluate(t,n,s,a){const c=this.layers[0],u=t.feature,d=this.canonical,f=t.rotation=c.paint.get("model-rotation").evaluate(u,n,d),p=t.scale=c.paint.get("model-scale").evaluate(u,n,d),g=t.translation=c.paint.get("model-translation").evaluate(u,n,d),_=c.paint.get("model-color").evaluate(u,n,d);_.a=c.paint.get("model-color-mix-intensity").evaluate(u,n,d);const v=[];this.maxVerticalOffset<g[2]&&(this.maxVerticalOffset=g[2]),this.maxScale=Math.max(Math.max(this.maxScale,p[0]),Math.max(p[1],p[2])),t0(v,f,p);const x=Math.round(100*_.a)+_.b/1.05;for(let b=0;b<t.instancedDataCount;++b){const E=t.instancedDataOffset+b,C=16*E,M=s.instancedDataArray.float32;let T=0;a&&(T=M[C+6]-s.instancesEvaluatedElevation[E]);const R=0|M[C+1];M[C]=(0|M[C])+_.r/1.05,M[C+1]=R+_.g/1.05,M[C+2]=x,M[C+3]=1/(d.z>10?this.tileToMeter:Wd(d,R)),M[C+4]=g[0],M[C+5]=g[1],M[C+6]=g[2]+T,M[C+7]=v[0],M[C+8]=v[1],M[C+9]=v[2],M[C+10]=v[4],M[C+11]=v[5],M[C+12]=v[6],M[C+13]=v[8],M[C+14]=v[9],M[C+15]=v[10],s.instancesEvaluatedElevation[E]=g[2]}}}Xt(NS,"ModelBucket",{omit:["layers"]}),Xt(dg,"PerModelAttributes"),Xt(_E,"ModelFeature");const CR=new Xn({visibility:new wt(rt.layout_model.visibility),"model-id":new se(rt.layout_model["model-id"])});var zS={paint:new Xn({"model-opacity":new wt(rt.paint_model["model-opacity"]),"model-rotation":new se(rt.paint_model["model-rotation"]),"model-scale":new se(rt.paint_model["model-scale"]),"model-translation":new se(rt.paint_model["model-translation"]),"model-color":new se(rt.paint_model["model-color"]),"model-color-mix-intensity":new se(rt.paint_model["model-color-mix-intensity"]),"model-type":new wt(rt.paint_model["model-type"]),"model-cast-shadows":new wt(rt.paint_model["model-cast-shadows"]),"model-receive-shadows":new wt(rt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new wt(rt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new se(rt.paint_model["model-emissive-strength"]),"model-roughness":new se(rt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new se(rt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new wt(rt.paint_model["model-cutoff-fade-range"])}),layout:CR};const n0=new Float32Array(262144),Ll=new Uint8Array(262144);function yE(e){let t=0;if(e.meshes)for(const n of e.meshes)t=Math.max(t,n.aabb.max[2]);if(e.children)for(const n of e.children)t=Math.max(t,yE(n));return t}const Xi=["","wall","door","roof","window","lamp","logo"];class r0{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:yE(t)}}}}class vE{constructor(t,n,s,a){this.nodes=t,this.id=n,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,s&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=a,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const s of n){const a=s.node;this.uploaded?this.updatePbrBuffer(a):Mf(a,t,!0)}for(const s of n)ea(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let n=!1;if(!t.meshes)return n;for(const s of t.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),n=!0);return n}needsReEvaluation(t,n,s){const a=t.transform.projectionOptions,c=t.style.getBrightness(),u=this.brightness!==c;return!!(!this.uploaded||this.dirty||a.name!==this.projection.name||Tf(s.paint.get("model-color").value,u)||Tf(s.paint.get("model-color-mix-intensity").value,u)||Tf(s.paint.get("model-roughness").value,u)||Tf(s.paint.get("model-emissive-strength").value,u)||Tf(s.paint.get("model-height-based-emissive-strength-multiplier").value,u))&&(this.projection=a,this.brightness=c,!0)}evaluateScale(t,n){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const s=this.getNodesInfo(),a=this.id.canonical;for(const c of s){const u=c.feature;c.evaluatedScale=n.paint.get("model-scale").evaluate(u,{},a)}}evaluate(t){const n=this.getNodesInfo();for(const s of n){if(!s.node.meshes)continue;const a=s.feature,c=s.node.meshes&&s.node.meshes[0].featureData,u=s.evaluatedColor[2],d=s.evaluatedRMEA[2],f=this.id.canonical;if(s.hasTranslucentParts=!1,c){for(let p=0;p<Xi.length;p++){const g=Xi[p];g.length&&(a.properties.part=g);const _=t.paint.get("model-color").evaluate(a,{},f),v=t.paint.get("model-color-mix-intensity").evaluate(a,{},f);s.evaluatedColor[p]=[_.r,_.g,_.b,v],s.evaluatedRMEA[p][0]=t.paint.get("model-roughness").evaluate(a,{},f),s.evaluatedRMEA[p][2]=t.paint.get("model-emissive-strength").evaluate(a,{},f),s.evaluatedRMEA[p][3]=_.a,s.emissionHeightBasedParams[p]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,{},f),!s.hasTranslucentParts&&_.a<1&&(s.hasTranslucentParts=!0)}delete a.properties.part,BS(s,u!==s.evaluatedColor[2]||d!==s.evaluatedRMEA[2])}s.evaluatedScale=t.paint.get("model-scale").evaluate(a,{},f),this.updatePbrBuffer(s.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,n,s,a){const c=t.findDEMTileFor(s);if(c&&(c.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(c.dem&&c.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=c.tileID.overscaledZ;const u=zc.create(t,s,c);if(!u)return;4&this.modelTraits&&this.updateDEM(t,u,s,a);for(const d of this.getNodesInfo()){const f=d.node;if(!f.footprint||!f.footprint.vertices||!f.footprint.vertices.length)continue;const p=f.footprint.vertices;let g=u.getElevationAt(p[0].x,p[0].y,!0,!0);for(let _=1;_<p.length;_++)g=Math.min(g,u.getElevationAt(p[_].x,p[_].y,!0,!0));f.elevation=g}}this.terrainTile=c.tileID.canonical,this.terrainExaggeration=n}}updateDEM(t,n,s,a){let c=n._dem._modifiedForSources[a];if(void 0===c&&(n._dem._modifiedForSources[a]=[],c=n._dem._modifiedForSources[a]),c.includes(s.canonical))return;const u=n._dem.dim;c.push(s.canonical);let d=!1;for(const f of this.getNodesInfo()){const p=f.node;if(!p.footprint||!p.footprint.grid)continue;const g=p.footprint.grid,_=n.tileCoordToPixel(g.min.x,g.min.y),v=n.tileCoordToPixel(g.max.x,g.max.y),x=Math.min(Math.min(u-v.y,_.x),Math.min(_.y,u-v.x));if(x<0)continue;const b=Qt(x,2,5);let E=Math.max(0,_.x-b),C=Math.max(0,_.y-b),M=Math.min(v.x+b,u-1),T=Math.min(v.y+b,u-1);for(let O=C;O<=T;++O)for(let L=E;L<=M;++L)Ll[O*u+L]=255;let R=0,P=0;for(let O=0;O<g.cellsY;++O)for(let L=0;L<g.cellsX;++L){if(!g.cells[O*g.cellsX+L])continue;const F=n.tileCoordToPixel(g.min.x+L/g.xScale,g.min.y+O/g.yScale),N=n.tileCoordToPixel(g.min.x+(L+1)/g.xScale,g.min.y+(O+1)/g.yScale);for(let B=F.y;B<=Math.min(N.y+1,u-1);++B)for(let V=F.x;V<=Math.min(N.x+1,u-1);++V)255===Ll[B*u+V]&&(Ll[B*u+V]=0,R+=n.getElevationAtPixel(V,B),P++)}const I=R/P;E=Math.max(1,_.x-b),C=Math.max(1,_.y-b),M=Math.min(v.x+b,u-2),T=Math.min(v.y+b,u-2),d=!0;for(let O=C;O<=T;++O)for(let L=E;L<=M;++L)0===Ll[O*u+L]&&(n0[O*u+L]=n._dem.set(L,O,I));for(let O=1;O<b;++O){E=Math.max(1,_.x-O),C=Math.max(1,_.y-O),M=Math.min(v.x+O,u-2),T=Math.min(v.y+O,u-2);for(let L=C;L<=T;++L)for(let F=E;F<=M;++F){const N=L*u+F;if(255===Ll[N]){let B=0,V=0,U=-1,q=-1;for(let j=-1;j<=1;++j)for(let X=-1;X<=1;++X){const Q=(L+j)*u+F+X;if(Ll[Q]>=O)continue;const nt=n0[Q],Y=Math.abs(nt);Y>V&&(B=nt,V=Y,U=X,q=j)}if(V>.1){const j=1-(O+.5*Math.abs(U*q))/b;let X=n._dem.get(F,L)+B*j;const Q=n._dem.get(F+U,L+q),nt=n._dem.get(F-U,L-q,!0);(X-Q)*(X-nt)>0&&(X=(Q+nt)/2),n0[N]=n._dem.set(F,L,X),Ll[N]=O}}}}}d&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=xe.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const t of this.nodes)this.nodesInfo.push(new r0(t));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const t of this.nodes)Ih(t);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const t=this.getNodesInfo();for(const n of t)ea(n.node),Ih(n.node)}isEmpty(){return!this.nodes.length}updateReplacement(t,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const s=n.getReplacementRegionsForTile(t.toUnwrapped()),a=this.getNodesInfo();for(let c=0;c<this.nodesInfo.length;c++){const u=a[c].node;a[c].hiddenByReplacement=!!u.footprint&&!s.find(d=>d.footprint===u.footprint)}}getHeightAtTileCoord(t,n){const s=this.getNodesInfo(),a=[];for(let c=0;c<this.nodesInfo.length;c++){const u=s[c],d=u.node.meshes[0];if(t<d.aabb.min[0]||n<d.aabb.min[1]||t>d.aabb.max[0]||n>d.aabb.max[1])continue;const f=(t-d.aabb.min[0])/(d.aabb.max[0]-d.aabb.min[0])*64|0,p=64*Math.min(63,(n-d.aabb.min[1])/(d.aabb.max[1]-d.aabb.min[1])*64|0)+Math.min(63,f);if(!(d.heightmap[p]<0&&u.node.footprint))return u.hiddenByReplacement?void 0:{height:d.heightmap[p],maxHeight:u.feature.properties.height,hidden:!1,verticalScale:u.evaluatedScale[2]};if(u.node.footprint.grid.query(new et(t,n),new et(t,n),a),a.length>0)return{height:void 0,maxHeight:u.feature.properties.height,hidden:u.hiddenByReplacement,verticalScale:u.evaluatedScale[2]}}}}function Tf(e,t){return!e.isLightConstant&&t}function xE(e,t,n,s,a,c,u,d){let f=(61440&t|(61440&t)>>4)>>8,p=(3840&t|(3840&t)>>4)>>4,g=240&t|(240&t)>>4;n[3]>0&&(f=vt(f,255*n[0],n[3]),p=vt(p,255*n[1],n[3]),g=vt(g,255*n[2],n[3]));const _=f<<8|p,v=g<<8|Math.floor(255*s[3]),x=function(O){const L=Qt(O,0,2);return Math.min(Math.round(.5*L*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],b=Qt(a[0],0,1),E=Qt(a[1],0,1),C=Qt(a[2],0,1),M=Qt(a[3],0,1);let T,R,P,I;if(b!==E&&u!==c&&E!==b){const O=u-c;R=1/(O*(E-b)),P=-(c+O*b)/(O*(E-b));const L=Qt(a[4],-1,1);I=Math.pow(10,L),T=255*C<<8|255*M}else T=65535,R=0,P=1,I=1;if(e.emplaceBack(_,v,x,T,R,P,I),d){const O=d.length;d.clear();for(let L=0;L<O;L++)d.emplaceBack(_,v,x,T,R,P,I)}}function BS(e,t){const n=e.node;let s=0;for(const a of n.meshes){if(n.lights&&n.lightMeshIndex===s||!a.featureData)continue;a.featureArray=new $u,a.featureArray.reserve(a.featureData.length);let c=t;for(const u of a.featureData){let d;const f=65535&u,p=(15&f)<8?15&f:0,g=u>>16&65535,_=e.evaluatedRMEA[p],v=e.evaluatedColor[p],x=e.emissionHeightBasedParams[p];if(c&&2===p&&n.lights&&(d=new $u,d.resize(10*n.lights.length)),xE(a.featureArray,g,v,_,x,a.aabb.min[2],a.aabb.max[2],d),d&&c){c=!1;const b=n.meshes[n.lightMeshIndex];b.featureArray=d,b.featureArray._trim()}}a.featureArray._trim(),s++}}Xt(vE,"Tiled3dModelBucket",{omit:["layers"]}),Xt(r0,"Tiled3dModelFeature");class bE{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const n=EE(new et(0,0),new et(ut,ut),t),s=[];for(const a of this._activeRegions){if(a.hiddenByOverlap||!wE(n,a))continue;const c=CE(a.min,a.max,t);s.push({min:c.min,max:c.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId})}return s}setSources(t){this._setSources(t.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const s=[];for(const a of n.cache.getVisibleCoordinates()){const c=n.cache.getTile(a).buckets[n.layer];if(c)for(const u of c.getNodesInfo()){const d=u.node;d.footprint&&s.push({footprint:d.footprint,id:a.toUnwrapped()})}}return s}})))}_addSource(t){const n=t.getFootprints();if(0!==n.length){for(const s of n){if(!s.footprint)continue;const a=EE(s.footprint.min,s.footprint.max,s.id);this._activeRegions.push({min:a.min,max:a.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:s.id,footprint:s.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((n,s)=>n.priority-s.priority||Sf(n.min,s.min)||Sf(n.max,s.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let n=0,s=0;for(;!t&&n!==this._activeRegions.length;){const a=this._activeRegions[n],c=this._prevRegions[s];t=a.priority!==c.priority||!Wc(a,c),++n,++s}}if(t){++this._updateTime;const n=s=>{const a=this._activeRegions;if(s>=a.length)return s;const c=a[s].priority;for(;s<a.length&&a[s].priority===c;)++s;return s};if(this._sourceIds.length>1){let s=0,a=n(s);for(;s!==a;){let c=s;const u=s;for(;c!==a;){const d=this._activeRegions[c];d.hiddenByOverlap=!1;for(let f=0;f<u;f++){const p=this._activeRegions[f];if(!p.hiddenByOverlap&&wE(d,p)&&(d.hiddenByOverlap=o0(d.footprint,d.tileId,p.footprint,p.tileId),d.hiddenByOverlap))break}++c}s=a,a=n(s)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=t.length-1;n>=0;n--)this._addSource(t[n]);this._computeReplacement()}}function Sf(e,t){return e.x-t.x||e.y-t.y}function Wc(e,t){return 0===Sf(e.min,t.min)&&0===Sf(e.max,t.max)}function wE(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function EE(e,t,n){const s=1/ut,a=1/(1<<n.canonical.z),c=(t.x*s+n.canonical.x)*a+n.wrap,u=(t.y*s+n.canonical.y)*a;return{min:new et((e.x*s+n.canonical.x)*a+n.wrap,(e.y*s+n.canonical.y)*a),max:new et(c,u)}}function CE(e,t,n){const s=1<<n.canonical.z,a=((t.x-n.wrap)*s-n.canonical.x)*ut,c=(t.y*s-n.canonical.y)*ut;return{min:new et(((e.x-n.wrap)*s-n.canonical.x)*ut,(e.y*s-n.canonical.y)*ut),max:new et(a,c)}}function DE(e,t,n,s,a,c,u){const d=e.indices,f=e.vertices,p=[];for(let g=s;g<s+a;g+=3){const _=t[n[g+0]+c],v=t[n[g+1]+c],x=t[n[g+2]+c],b=Math.min(_.x,v.x,x.x),E=Math.max(_.x,v.x,x.x),C=Math.min(_.y,v.y,x.y),M=Math.max(_.y,v.y,x.y);p.length=0,e.grid.query(new et(b,C),new et(E,M),p);for(let T=0;T<p.length;T++){const R=p[T];if(Kd(f[d[3*R+0]],f[d[3*R+1]],f[d[3*R+2]],_,v,x,u))return!0}}return!1}function o0(e,t,n,s){if(!e||!n)return!1;let a=e.vertices;if(!t.canonical.equals(s.canonical)||t.wrap!==s.wrap){if(n.vertices.length<e.vertices.length)return o0(n,s,e,t);const c=t.canonical,u=s.canonical,d=Math.pow(2,u.z-c.z);a=e.vertices.map(f=>new et(f.x*c.x*ut*d-u.x*ut,f.y*c.y*ut*d-u.y*ut))}return DE(n,a,e.indices,0,e.indices.length,0,0)}const DR=pv.types,ME=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],fg=["fill-extrusion-flood-light-ground-radius"],na=Math.pow(2,13),jS=Math.pow(2,15)-1,TE=new et(0,1),sr=2147483648;function Wr(e,t,n,s,a,c,u,d){e.emplaceBack((t<<1)+u,(n<<1)+c,(Math.floor(s*na)<<1)+a,Math.round(d))}function po(e,t,n,s,a,c){e.emplaceBack(t.x,t.y,(n.x<<1)+s,(n.y<<1)+a,c)}function Ah(e,t,n){e.emplaceBack(t.x,t.y,t.z,16384*n[0],16384*n[1],16384*n[2])}class s0{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class SE{constructor(){this.centroidXY=new et(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new et(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new et(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new et(this.max.x-this.min.x,this.max.y-this.min.y)}}class IE{constructor(){this.acc=new et(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,n){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=n.x,t.min.y=t.max.y=n.y)}appendEdge(t,n,s){this.accCount++,this.acc._add(n);let a=!!this.borders;n.x<t.min.x?(t.min.x=n.x,a=!0):n.x>t.max.x&&(t.max.x=n.x,a=!0),n.y<t.min.y?(t.min.y=n.y,a=!0):n.y>t.max.y&&(t.max.y=n.y,a=!0),((0===n.x||n.x===ut)&&n.x===s.x)!=((0===n.y||n.y===ut)&&n.y===s.y)&&this.processBorderOverlap(n,s),a&&this.checkBorderIntersection(n,s)}checkBorderIntersection(t,n){n.x<0!=t.x<0&&this.addBorderIntersection(0,vt(n.y,t.y,(0-n.x)/(t.x-n.x))),n.x>ut!=t.x>ut&&this.addBorderIntersection(1,vt(n.y,t.y,(ut-n.x)/(t.x-n.x))),n.y<0!=t.y<0&&this.addBorderIntersection(2,vt(n.x,t.x,(0-n.y)/(t.y-n.y))),n.y>ut!=t.y>ut&&this.addBorderIntersection(3,vt(n.x,t.x,(ut-n.y)/(t.y-n.y)))}addBorderIntersection(t,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[t];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(t,n){if(t.x===n.x){if(t.y===n.y)return;const s=0===t.x?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,t.y)}else{const s=0===t.y?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,t.x)}}centroid(){return 0===this.accCount?new et(0,0):new et(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,n)=>t+ +(n[0]!==Number.MAX_VALUE),0):0}}function AE(e,t){const n=e.add(t)._unit(),s=Qt(e.x*n.x+e.y*n.y,-1,1);var a,c,u;return a=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(a)))/4*jS*((c=e).x*(u=t).y-c.y*u.x<0?-1:1)}const VS=[e=>e.x<0,e=>e.x>ut,e=>e.y<0,e=>e.y>ut];function a0(e,t,n,s){const a=[4];if(0===s)return a;n._mult(s);const c=e.sub(n),u=t.sub(n),d=[e,t,c,u];for(let f=0;f<4;f++)for(const p of d)if(VS[f](p)){a.push(f);break}return a}class Rh{constructor(t){this.vertexArray=new Kp,this.indexArray=new Ai,this.programConfigurations=new mi(t.layers,t.zoom,n=>fg.includes(n)),this._segments=new yn,this.hiddenByLandmarkVertexArray=new Hu,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new yn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(t,n,s,a=!1){const c=t.length;if(c>2){let u=Math.max(0,this._segments.get().length-1);const d=this._segments._prepareSegment(4*c,this.vertexArray.length,2*this._segmentToGroundQuads[u].length);let f;u!==this._segments.get().length-1&&(u++,this._segmentToGroundQuads[u]=[],this._segmentToRegionTriCounts[u]=[0,0,0,0,0]);{const p=t[0],g=t[1];f=AE(p.sub(t[c-1])._perp()._unit(),g.sub(p)._perp()._unit())}for(let p=0;p<c;p++){const g=p===c-1?0:p+1,_=t[p],v=t[g],x=t[g===c-1?0:g+1],b=v.sub(_)._perp()._unit(),E=AE(b,x.sub(v)._perp()._unit()),C=f,M=E;if(pg(_,v,n)||a&&c0(_,n)&&c0(v,n)){f=E;continue}const T=d.vertexLength;po(this.vertexArray,_,v,1,1,C),po(this.vertexArray,_,v,1,0,C),po(this.vertexArray,_,v,0,1,M),po(this.vertexArray,_,v,0,0,M),d.vertexLength+=4;const R=a0(_,v,b,s);for(const P of R)this._segmentToGroundQuads[u].push({id:T,region:P}),this._segmentToRegionTriCounts[u][P]+=2,d.primitiveLength+=2;f=E}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),n=t.length;for(let s=0;s<n;s++)this._segmentToGroundQuads[s].sort((a,c)=>a.region-c.region);for(let s=0;s<n;s++){const a=this._segmentToGroundQuads[s],c=t[s],u=this._segmentToRegionTriCounts[s];u.reduce((f,p)=>f+p,0);let d=0;for(let f=0;f<=4;f++){const p=u[f];if(0!==p){let g=this.regionSegments[f];g||(g=this.regionSegments[f]=new yn);const _={vertexOffset:c.vertexOffset,primitiveOffset:c.primitiveOffset+d,vertexLength:c.vertexLength,primitiveLength:p};g.get().push(_)}d+=p}for(let f=0;f<a.length;f++){const p=a[f].id;this.indexArray.emplaceBack(p,p+1,p+3),this.indexArray.emplaceBack(p,p+3,p+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,n,s,a,c,u){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,n,s,a,c,u)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,GT.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,n,s,a,c,u){this.hasData()&&this.programConfigurations.updatePaintArrays(t,n,s,a,c,u)}updateHiddenByLandmark(t){if(!this.hasData())return;const n=t.groundVertexCount+t.groundVertexArrayOffset;if(0===t.groundVertexCount)return;const s=t.flags&sr?1:0;for(let a=t.groundVertexArrayOffset;a<n;++a)this.hiddenByLandmarkVertexArray.emplace(a,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,Fm.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const n=this.regionSegments[t];n&&n.destroy()}}}}class If{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ai,this.footprintVertices=new ro,this.footprintSegments=[],this.layoutVertexArray=new cl,this.centroidVertexArray=new em,this.indexArray=new Ai,this.programConfigurations=new mi(t.layers,t.zoom,n=>ME.includes(n)),this.segments=new yn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new Rh(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,n,s,a){this.features=[],this.hasPattern=nw("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Wd(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:c,id:u,index:d,sourceLayerIndex:f}of t){const p=this.layers[0]._featureFilter.needGeometry,g=Zs(c,p);if(!this.layers[0]._featureFilter.filter(new zn(this.zoom),g,s))continue;const _={id:u,sourceLayerIndex:f,index:d,geometry:p?g.geometry:gs(c,s,a),properties:c.properties,type:c.type,patterns:{}},v=this.layoutVertexArray.length;this.hasPattern?this.features.push(uv("fill-extrusion",this.layers,_,this.zoom,n)):this.addFeature(_,_.geometry,d,s,{},n.availableImages,a,n.brightness),n.featureIndex.insert(c,_.geometry,d,f,this.index,v)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,n,s,a,c,u){for(const d of this.features){const{geometry:f}=d;this.addFeature(d,f,d.index,n,s,a,c,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(t,n,s,a,c){const u=0!==Object.keys(t).length;if(u&&!this.stateDependentLayers.length)return;const d=u?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,n,d,s,a,c),this.groundEffect.update(t,n,d,s,a,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ZT),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,qT.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,iw.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,s,a,c,u,d,f){const p=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,g=[new et(0,0),new et(ut,ut)],_=d.projection,v="globe"===_.name,x="Polygon"===DR[t.type],b=new IE;b.centroidDataIndex=this.centroidData.length;const E=new SE,C=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},a)<=0,M=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},a);E.height=M,E.vertexArrayOffset=this.layoutVertexArray.length,E.groundVertexArrayOffset=this.groundEffect.vertexArray.length,v&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new _c);const T=cv(n,500);for(let F=T.length-1;F>=0;F--){const N=T[F];(0===N.length||(R=N[0]).every(B=>B.x<=0)||R.every(B=>B.x>=ut)||R.every(B=>B.y<=0)||R.every(B=>B.y>=ut))&&T.splice(F,1)}var R;let P;if(v)P=Ee(T,g,a);else{P=[];for(const F of T)P.push({polygon:F,bounds:g})}const I=x?this.edgeRadius:0,O=I>0&&this.zoom<17,L=(F,N)=>{if(0===F.length)return!1;const B=F[F.length-1];return N.x===B.x&&N.y===B.y};for(const{polygon:F,bounds:N}of P){let B=0,V=0;for(const X of F)x&&!X[0].equals(X[X.length-1])&&X.push(X[0]),V+=x?X.length-1:X.length;const U=this.segments.prepareSegment((x?5:4)*V,this.layoutVertexArray,this.indexArray);E.footprintSegIdx<0&&(E.footprintSegIdx=this.footprintSegments.length),E.polygonSegIdx<0&&(E.polygonSegIdx=this.polygonSegments.length);const q={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},j=new s0;if(j.vertexOffset=this.footprintVertices.length,j.indexOffset=3*this.footprintIndices.length,j.ringIndices=[],x){const X=[],Q=[];B=U.vertexLength;for(let Y=0;Y<F.length;Y++){const K=F[Y];K.length&&0!==Y&&Q.push(X.length/2);const ot=[];let at,lt;at=K[1].sub(K[0])._perp()._unit(),j.ringIndices.push(K.length-1);for(let dt=1;dt<K.length;dt++){const ft=K[dt],gt=K[dt===K.length-1?1:dt+1],ht=ft.clone();if(I){lt=gt.sub(ft)._perp()._unit();const yt=at.add(lt)._unit(),Ot=I*Math.min(4,1/(at.x*yt.x+at.y*yt.y));ht.x+=Ot*yt.x,ht.y+=Ot*yt.y,ht.x=Math.round(ht.x),ht.y=Math.round(ht.y),at=lt}!C||0!==I&&!O||L(ot,ht)||ot.push(ht),Wr(this.layoutVertexArray,ht.x,ht.y,0,0,1,1,0),U.vertexLength++,this.footprintVertices.emplaceBack(ft.x,ft.y),X.push(ft.x,ft.y),v&&Ah(this.layoutVertexExtArray,_.projectTilePoint(ht.x,ht.y,a),_.upVector(a,ht.x,ht.y))}C&&(0===I||O)&&(0!==ot.length&&L(ot,ot[0])&&ot.pop(),this.groundEffect.addData(ot,N,p))}const nt=rf(X,Q);for(let Y=0;Y<nt.length;Y+=3)this.footprintIndices.emplaceBack(j.vertexOffset+nt[Y+0],j.vertexOffset+nt[Y+1],j.vertexOffset+nt[Y+2]),this.indexArray.emplaceBack(B+nt[Y],B+nt[Y+2],B+nt[Y+1]),U.primitiveLength++;j.indexCount+=nt.length,j.vertexCount+=this.footprintVertices.length-j.vertexOffset}for(let X=0;X<F.length;X++){const Q=F[X];b.startRing(E,Q[0]);let nt=Q.length>4&&Af(Q[Q.length-2],Q[0],Q[1]),Y=I?US(Q[Q.length-2],Q[0],Q[1],I):0;const K=[];let ot,at,lt;at=Q[1].sub(Q[0])._perp()._unit();let dt=!0;for(let ft=1,gt=0;ft<Q.length;ft++){let ht=Q[ft-1],yt=Q[ft];const Ot=Q[ft===Q.length-1?1:ft+1];if(b.appendEdge(E,yt,ht),pg(yt,ht,N)){I&&(at=Ot.sub(yt)._perp()._unit(),dt=!dt);continue}const Lt=yt.sub(ht)._perp(),Ut=Lt.x/(Math.abs(Lt.x)+Math.abs(Lt.y)),Gt=Lt.y>0?1:0,me=ht.dist(yt);if(gt+me>32768&&(gt=0),I){lt=Ot.sub(yt)._perp()._unit();let pe=RE(ht,yt,Ot,l0(at,lt),I);isNaN(pe)&&(pe=0);const ue=yt.sub(ht)._unit();ht=ht.add(ue.mult(Y))._round(),yt=yt.add(ue.mult(-pe))._round(),Y=pe,at=lt,C&&this.zoom>=17&&(L(K,ht)||K.push(ht),L(K,yt)||K.push(yt))}const ie=U.vertexLength,Je=Q.length>4&&Af(ht,yt,Ot);let $e=PE(gt,nt,dt);if(Wr(this.layoutVertexArray,ht.x,ht.y,Ut,Gt,0,0,$e),Wr(this.layoutVertexArray,ht.x,ht.y,Ut,Gt,0,1,$e),gt+=me,$e=PE(gt,Je,!dt),nt=Je,Wr(this.layoutVertexArray,yt.x,yt.y,Ut,Gt,0,0,$e),Wr(this.layoutVertexArray,yt.x,yt.y,Ut,Gt,0,1,$e),U.vertexLength+=4,this.indexArray.emplaceBack(ie+0,ie+1,ie+2),this.indexArray.emplaceBack(ie+1,ie+3,ie+2),U.primitiveLength+=2,I){const pe=B+(1===ft?Q.length-2:ft-2),ue=1===ft?B:pe+1;if(this.indexArray.emplaceBack(ie+1,pe,ie+3),this.indexArray.emplaceBack(pe,ue,ie+3),U.primitiveLength+=2,void 0===ot&&(ot=ie),!pg(Ot,Q[ft],N)){const oe=ft===Q.length-1?ot:U.vertexLength;this.indexArray.emplaceBack(ie+2,ie+3,oe),this.indexArray.emplaceBack(ie+3,oe+1,oe),this.indexArray.emplaceBack(ie+3,ue,oe+1),U.primitiveLength+=3}dt=!dt}if(v){const pe=this.layoutVertexExtArray,ue=_.projectTilePoint(ht.x,ht.y,a),oe=_.projectTilePoint(yt.x,yt.y,a),He=_.upVector(a,ht.x,ht.y),Ye=_.upVector(a,yt.x,yt.y);Ah(pe,ue,He),Ah(pe,ue,He),Ah(pe,oe,Ye),Ah(pe,oe,Ye)}}x&&(B+=Q.length-1),C&&I&&this.zoom>=17&&(0!==K.length&&L(K,K[0])&&K.pop(),this.groundEffect.addData(K,N,p,I>0))}this.footprintSegments.push(j),q.triangleCount=this.indexArray.length-q.triangleArrayOffset,this.polygonSegments.push(q),++E.footprintSegLen,++E.polygonSegLen}if(E.vertexCount=this.layoutVertexArray.length-E.vertexArrayOffset,E.groundVertexCount=this.groundEffect.vertexArray.length-E.groundVertexArrayOffset,0!==E.vertexCount){if(E.centroidXY=b.borders?TE:this.encodeCentroid(b,E),this.centroidData.push(E),b.borders){this.featuresOnBorder.push(b);const F=this.featuresOnBorder.length-1;for(let N=0;N<b.borders.length;N++)b.borders[N][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[N].push(F)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,c,u,a,f),this.groundEffect.addPaintPropertiesData(t,s,c,u,a,f),this.maxHeight=Math.max(this.maxHeight,M)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((n,s)=>this.featuresOnBorder[n].borders[t][0]-this.featuresOnBorder[s].borders[t][0])}splitToSubtiles(){const t=[];for(let d=0;d<this.centroidData.length;d++){const f=this.centroidData[d],p=+(f.min.y+f.max.y>ut),g=2*p+(+(f.min.x+f.max.x>ut)^p);for(let _=0;_<f.polygonSegLen;_++){const v=f.polygonSegIdx+_;t.push({centroidIdx:d,subtile:g,polygonSegmentIdx:v,triangleSegmentIdx:this.polygonSegments[v].triangleSegIdx})}}const n=new Ai;t.sort((d,f)=>d.triangleSegmentIdx===f.triangleSegmentIdx?d.subtile-f.subtile:d.triangleSegmentIdx-f.triangleSegmentIdx);let s=0,a=0,c=0;for(const d of t){if(d.triangleSegmentIdx!==s)break;c++}const u=t.length;for(;a!==t.length;){s=t[a].triangleSegmentIdx;let d=0,f=a,p=a;for(let g=f;g<c&&t[g].subtile===d;g++)p++;for(;f!==c;){const g=t[f];d=g.subtile;const _=this.centroidData[g.centroidIdx].min.clone(),v=this.centroidData[g.centroidIdx].max.clone(),x={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let b=f;b<p;b++){const E=t[b],C=this.polygonSegments[E.polygonSegmentIdx],M=this.centroidData[E.centroidIdx].min,T=this.centroidData[E.centroidIdx].max,R=this.indexArray.uint16;for(let P=C.triangleArrayOffset;P<C.triangleArrayOffset+C.triangleCount;P++)n.emplaceBack(R[3*P],R[3*P+1],R[3*P+2]);x.primitiveLength+=C.triangleCount,_.x=Math.min(_.x,M.x),_.y=Math.min(_.y,M.y),v.x=Math.max(v.x,T.x),v.y=Math.max(v.y,T.y)}x.primitiveLength>0&&this.triangleSubSegments.push({segment:x,min:_,max:v}),f=p;for(let b=f;b<c&&t[b].subtile===t[f].subtile;b++)p++}a=c;for(let g=a;g<u&&t[g].triangleSegmentIdx===t[a].triangleSegmentIdx;g++)c++}n._trim(),this.indexArray=n}getVisibleSegments(t,n,s){let a=0,c=0;const u=1<<t.canonical.z;if(n){const E=n.getMinMaxForTile(t);E&&(a=E.min,c=E.max)}c+=this.maxHeight;const d=t.toUnwrapped();let f;const p=[d.canonical.x/u+d.wrap,d.canonical.y/u],g=[(d.canonical.x+1)/u+d.wrap,(d.canonical.y+1)/u],_=new yn,v=(E,C,M)=>[E[0]*(1-M[0])+C[0]*M[0],E[1]*(1-M[1])+C[1]*M[1]],x=[],b=[];for(const E of this.triangleSubSegments){x[0]=E.min.x/ut,x[1]=E.min.y/ut,b[0]=E.max.x/ut,b[1]=E.max.y/ut;const C=v(p,g,x),M=v(p,g,b);if(0===new qn([C[0],C[1],a],[M[0],M[1],c]).intersectsPrecise(s)){f&&(_.segments.push(f),f=void 0);continue}const T=E.segment;f&&f.vertexOffset!==T.vertexOffset&&(_.segments.push(f),f=void 0),f?(f.vertexLength+=T.vertexLength,f.primitiveLength+=T.primitiveLength):f={vertexOffset:T.vertexOffset,primitiveLength:T.primitiveLength,vertexLength:T.vertexLength,primitiveOffset:T.primitiveOffset,sortKey:void 0,vaos:{}}}return f&&_.segments.push(f),_}encodeCentroid(t,n){const s=t.centroid(),a=n.span(),c=Math.min(7,Math.round(a.x*this.tileToMeter/10)),u=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new et(Qt(s.x,1,ut-1)<<3|c,Qt(s.y,1,ut-1)<<3|u)}showCentroid(t){const n=this.centroidData[t.centroidDataIndex];n.flags&=sr,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const n=t.vertexArrayOffset,s=t.vertexCount+t.vertexArrayOffset,a=t.flags&sr?TE:t.centroidXY,c=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==a.y||c!==a.x){for(let u=n;u<s;++u)this.centroidVertexArray.emplace(u,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const s=n.getReplacementRegionsForTile(t.toUnwrapped());if(function(c,u){if(c.length!==u.length)return!1;for(let d=0;d<c.length;d++)if(c[d].sourceId!==u[d].sourceId||!Wc(c[d],u[d]))return!1;return!0}(this.activeReplacements,s))return;if(this.activeReplacements=s,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const c of this.centroidData)c.flags&=2147483647;const a=[];for(const c of this.activeReplacements){const u=Math.pow(2,c.footprintTileId.canonical.z-t.canonical.z);for(const d of this.centroidData)if(!(d.flags&sr||c.min.x>d.max.x||d.min.x>c.max.x||c.min.y>d.max.y||d.min.y>c.max.y))for(let f=0;f<d.footprintSegLen;f++){const p=this.footprintSegments[d.footprintSegIdx+f];if(a.length=0,OE(this.footprintVertices,p.vertexOffset,p.vertexCount,c.footprintTileId.canonical,t.canonical,a),DE(c.footprint,a,this.footprintIndices.uint16,p.indexOffset,p.indexCount,-p.vertexOffset,-u)){d.flags|=sr;break}}}for(const c of this.centroidData)this.writeCentroidToBuffer(c);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,n,s){let a=!1;for(let c=0;c<s.footprintSegLen;c++){const u=this.footprintSegments[s.footprintSegIdx+c];let d=0;for(const f of u.ringIndices){for(let p=d,g=f+d-1;p<f+d;g=p++){const _=this.footprintVertices.int16[2*(p+u.vertexOffset)+0],v=this.footprintVertices.int16[2*(p+u.vertexOffset)+1],x=this.footprintVertices.int16[2*(g+u.vertexOffset)+1];v>n!=x>n&&t<(this.footprintVertices.int16[2*(g+u.vertexOffset)+0]-_)*(n-v)/(x-v)+_&&(a=!a)}d=f}}return a}getHeightAtTileCoord(t,n){let s=Number.NEGATIVE_INFINITY,a=!0;const c=4*(t+ut)*ut+(n+ut);if(this.partLookup.hasOwnProperty(c)){const u=this.partLookup[c];return u?{height:u.height,hidden:!!(u.flags&sr)}:void 0}for(const u of this.centroidData)t>u.max.x||u.min.x>t||n>u.max.y||u.min.y>n||this.footprintContainsPoint(t,n,u)&&u&&u.height>s&&(s=u.height,this.partLookup[c]=u,a=!!(u.flags&sr));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:a};this.partLookup[c]=void 0}}function l0(e,t){const n=e.add(t)._unit();return e.x*n.x+e.y*n.y}function US(e,t,n,s){const a=t.sub(e)._perp()._unit(),c=n.sub(t)._perp()._unit();return RE(e,t,n,l0(a,c),s)}function RE(e,t,n,s,a){const c=Math.sqrt(1-s*s);return Math.min(e.dist(t)/3,t.dist(n)/3,a*c/s)}function pg(e,t,n){return e.x<n[0].x&&t.x<n[0].x||e.x>n[1].x&&t.x>n[1].x||e.y<n[0].y&&t.y<n[0].y||e.y>n[1].y&&t.y>n[1].y}function c0(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function Af(e,t,n){if(e.x<0||e.x>=ut||t.x<0||t.x>=ut||n.x<0||n.x>=ut)return!1;const s=n.sub(t),a=s.perp(),c=e.sub(t);return(s.x*c.x+s.y*c.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(c.x*c.x+c.y*c.y))>-.866&&a.x*c.x+a.y*c.y<0}function PE(e,t,n){const s=t?2|e:-3&e;return n?1|s:-2&s}function u0(){const e=Math.PI/32,t=Math.tan(e),n=Ic;return n*Math.sqrt(1+2*t*t)-n}function Ee(e,t,n){const s=1<<n.z,a=or(n.x/s),c=or((n.x+1)/s),u=Ei(n.y/s),d=Ei((n.y+1)/s);return function(f,p,g,_,v=0,x){const b=[];if(!f.length||!g||!_)return b;const E=(O,L)=>{for(const F of O)b.push({polygon:F,bounds:L})},C=Math.ceil(Math.log2(g)),M=Math.ceil(Math.log2(_)),T=C-M,R=[];for(let O=0;O<Math.abs(T);O++)R.push(T>0?0:1);for(let O=0;O<Math.min(C,M);O++)R.push(0),R.push(1);let P=f;if(P=af(P,p[0].y-v,p[1].y+v,1),P=af(P,p[0].x-v,p[1].x+v,0),!P.length)return b;const I=[];for(R.length?I.push({polygons:P,bounds:p,depth:0}):E(P,p);I.length;){const O=I.pop(),L=O.depth,F=R[L],N=O.bounds[0],B=O.bounds[1],V=0===F?N.x:N.y,U=0===F?B.x:B.y,q=x?x(F,V,U):.5*(V+U),j=af(O.polygons,V-v,q+v,F),X=af(O.polygons,q-v,U+v,F);if(j.length){const Q=[N,new et(0===F?q:B.x,1===F?q:B.y)];R.length>L+1?I.push({polygons:j,bounds:Q,depth:L+1}):E(j,Q)}if(X.length){const Q=[new et(0===F?q:N.x,1===F?q:N.y),B];R.length>L+1?I.push({polygons:X,bounds:Q,depth:L+1}):E(X,Q)}}return b}(e,t,Math.ceil((c-a)/11.25),Math.ceil((u-d)/11.25),1,(f,p,g)=>{if(0===f)return.5*(p+g);{const _=Ei((n.y+p/ut)/s);return(wi(.5*(Ei((n.y+g/ut)/s)+_))*s-n.y)*ut}})}function OE(e,t,n,s,a,c){const u=Math.pow(2,s.z-a.z);for(let d=0;d<n;d++){let f=e.int16[2*(d+t)+0],p=e.int16[2*(d+t)+1];f=(f+a.x*ut)*u-s.x*ut,p=(p+a.y*ut)*u-s.y*ut,c.push(new et(f,p))}}Xt(If,"FillExtrusionBucket",{omit:["layers","features"]}),Xt(SE,"PartData"),Xt(s0,"FootprintSegment"),Xt(IE,"BorderCentroidData"),Xt(Rh,"GroundEffect");const $S=new Xn({visibility:new wt(rt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new wt(rt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var HS={paint:new Xn({"fill-extrusion-opacity":new wt(rt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new se(rt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wt(rt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wt(rt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new se(rt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new se(rt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new se(rt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new wt(rt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new wt(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new wt(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new wt(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new wt(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new wt(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new wt(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new wt(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new se(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new se(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new wt(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new wt(rt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new wt(rt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new wt(rt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new wt(rt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:$S};class Yc extends et{constructor(t,n,s){super(t,n),this.z=s}}function Xc(e,t){return e.x*t.x+e.y*t.y}function h0(e,t){if(1===e.length){let n=0;const s=t[n++];let a;for(;!a||s.equals(a);)if(a=t[n++],!a)return 1/0;for(;n<t.length;n++){const c=t[n],u=e[0],d=a.sub(s),f=c.sub(s),p=u.sub(s),g=Xc(d,d),_=Xc(d,f),v=Xc(f,f),x=Xc(p,d),b=Xc(p,f),E=g*v-_*_,C=(v*x-_*b)/E,M=(g*b-_*x)/E,T=s.z*(1-C-M)+a.z*C+c.z*M;if(isFinite(T))return T}return 1/0}{let n=1/0;for(const s of t)n=Math.min(n,s.z);return n}}function d0(e,t,n,s,a,c,u,d){const f=u*a.getElevationAt(e,t,!0,!0),p=0!==c[0],g=p?0===c[1]?u*(c[0]/7-450):u*function(_,v,x){const b=Math.floor(v[0]/8),E=Math.floor(v[1]/8),C=10*(v[0]-8*b),M=10*(v[1]-8*E),T=_.getElevationAt(b,E,!0,!0),R=_.getMeterToDEM(x),P=Math.floor(.5*(C*R-1)),I=Math.floor(.5*(M*R-1)),O=_.tileCoordToPixel(b,E),L=2*P+1,F=2*I+1,N=(Y=L,K=F,[(X=_).getElevationAtPixel(Q=O.x-P,nt=O.y-I,!0),X.getElevationAtPixel(Q+K,nt,!0),X.getElevationAtPixel(Q,nt+K,!0),X.getElevationAtPixel(Q+Y,nt+K,!0)]),B=Math.abs(N[0]-N[1]),V=Math.abs(N[2]-N[3]),U=Math.abs(N[0]-N[2])+Math.abs(N[1]-N[3]),q=Math.min(.25,.5*R*(B+V)/L),j=Math.min(.25,.5*R*U/F);var X,Q,nt,Y,K;return T+Math.max(q*C,j*M)}(a,c,d):f;return{base:f+(0===n)?-1:n,top:p?Math.max(g+s,f+n+2):f+s}}const kE=new Xn({"line-cap":new se(rt.layout_line["line-cap"]),"line-join":new se(rt.layout_line["line-join"]),"line-miter-limit":new wt(rt.layout_line["line-miter-limit"]),"line-round-limit":new wt(rt.layout_line["line-round-limit"]),"line-sort-key":new se(rt.layout_line["line-sort-key"]),visibility:new wt(rt.layout_line.visibility)});var f0={paint:new Xn({"line-opacity":new se(rt.paint_line["line-opacity"]),"line-color":new se(rt.paint_line["line-color"]),"line-translate":new wt(rt.paint_line["line-translate"]),"line-translate-anchor":new wt(rt.paint_line["line-translate-anchor"]),"line-width":new se(rt.paint_line["line-width"]),"line-gap-width":new se(rt.paint_line["line-gap-width"]),"line-offset":new se(rt.paint_line["line-offset"]),"line-blur":new se(rt.paint_line["line-blur"]),"line-dasharray":new se(rt.paint_line["line-dasharray"]),"line-pattern":new se(rt.paint_line["line-pattern"]),"line-gradient":new ju(rt.paint_line["line-gradient"]),"line-trim-offset":new wt(rt.paint_line["line-trim-offset"]),"line-emissive-strength":new wt(rt.paint_line["line-emissive-strength"]),"line-border-width":new se(rt.paint_line["line-border-width"]),"line-border-color":new se(rt.paint_line["line-border-color"])}),layout:kE};const LE=(e,t,n,s,a,c,u)=>{const d=e.transform,f=d.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:m0(e,t,n,s),u_pixels_to_tile_units:f,u_device_pixel_ratio:c,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:zE(n)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:p0(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:u,u_emissive_strength:n.paint.get("line-emissive-strength")}},FE=(e,t,n,s,a)=>{const c=e.transform;return{u_matrix:m0(e,t,n,s),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:c.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:a,u_image:0,u_tile_units_to_pixels:p0(t,c),u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function p0(e,t){return 1/qc(e,1,t.tileZoom)}function m0(e,t,n,s){return e.translatePosMatrix(s||t.tileID.projMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const NE=e=>{const t=[];zE(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const n=e.paint.get("line-trim-offset");return 0===n[0]&&0===n[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER"),t};function zE(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const BE=new class extends se{possiblyEvaluate(e,t){return t=new zn(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,s){return t=qt({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,s)}}(f0.paint.properties["line-width"].specification);function jE(e,t){return t>0?t+2*e:e}BE.useIntegerZoom=!0;const GS=new Xn({visibility:new wt(rt.layout_background.visibility)});var qS={paint:new Xn({"background-color":new wt(rt.paint_background["background-color"]),"background-pattern":new wt(rt.paint_background["background-pattern"]),"background-opacity":new wt(rt.paint_background["background-opacity"]),"background-emissive-strength":new wt(rt.paint_background["background-emissive-strength"])}),layout:GS};const ZS=new Xn({visibility:new wt(rt.layout_raster.visibility)});var WS={paint:new Xn({"raster-opacity":new wt(rt.paint_raster["raster-opacity"]),"raster-color":new ju(rt.paint_raster["raster-color"]),"raster-color-mix":new wt(rt.paint_raster["raster-color-mix"]),"raster-color-range":new wt(rt.paint_raster["raster-color-range"]),"raster-hue-rotate":new wt(rt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wt(rt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wt(rt.paint_raster["raster-brightness-max"]),"raster-saturation":new wt(rt.paint_raster["raster-saturation"]),"raster-contrast":new wt(rt.paint_raster["raster-contrast"]),"raster-resampling":new wt(rt.paint_raster["raster-resampling"]),"raster-fade-duration":new wt(rt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new wt(rt.paint_raster["raster-emissive-strength"]),"raster-array-band":new wt(rt.paint_raster["raster-array-band"]),"raster-elevation":new wt(rt.paint_raster["raster-elevation"])}),layout:ZS};function VE(e,t,n,s,a,c,u,d){const f=[e,n,a,t,s,c,1,1,1],p=[u,d,1],g=$i.adjoint([],f),[_,v,x]=G.transformMat3(p,p,$i.transpose(g,g));return $i.multiply(f,[_,0,0,0,v,0,0,0,x],f)}class Wo extends Be{constructor(t,n,s,a){super(),this.id=t,this.dispatcher=s,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=n,this._dirty=!1}load(t,n){if(this._loaded=n||!1,this.fire(new Dt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=Ie(this.map._requestManager.transformRequest(this.url,pt.Image),(s,a)=>{if(this._imageRequest=null,this._loaded=!0,s)this.fire(new zt(s));else if(a){const{HTMLImageElement:c}=st;this.image=a instanceof c?xe.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new ag(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Dt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof ag||this.texture.destroy()}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=t[0][1],s=t[0][1];for(const c of t)c[1]>s&&(s=c[1]),c[1]<n&&(n=c[1]);const a=(s+n)/2;if(a>li?this.onNorthPole=!0:a<-li&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const c=t.map(We.fromLngLat);this.tileID=function(u){let d=1/0,f=1/0,p=-1/0,g=-1/0;for(const b of u)d=Math.min(d,b.x),f=Math.min(f,b.y),p=Math.max(p,b.x),g=Math.max(g,b.y);const _=Math.max(p-d,g-f),v=Math.max(0,Math.floor(-Math.log(_)/Math.LN2)),x=Math.pow(2,v);return new oo(v,Math.floor((d+p)/2*x),Math.floor((f+g)/2*x))}(c),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Dt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const f in this.tiles){const p=this.tiles[f];"loaded"!==p.state&&(p.state="loaded",p.texture=this.texture)}if(this._boundsArray)return;const n=Pl(this.tileID,this.map.transform.projection),[s,a,c,u]=this.coordinates.map(f=>{const p=n.projection.project(f[0],f[1]);return pf(n,p)._round()});this.perspectiveTransform=function(f,p,g,_,v,x,b,E,C,M){const T=VE(0,0,f,0,0,p,f,p),R=VE(g,_,v,x,b,E,C,M);return $i.multiply(R,$i.adjoint(T,T),R),[R[6]/R[8]*f/ut,R[7]/R[8]*p/ut]}(this.width,this.height,s.x,s.y,a.x,a.y,u.x,u.y,c.x,c.y);const d=this._boundsArray=new cl;d.emplaceBack(s.x,s.y,0,0),d.emplaceBack(a.x,a.y,ut,0),d.emplaceBack(u.x,u.y,0,ut),d.emplaceBack(c.x,c.y,ut,ut),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(d,fo.members),this.boundsSegments=yn.simpleSegment(0,0,4,2)}prepare(){const t=0!==Object.keys(this.tiles).length;if(this.tileID&&!t)return;const n=this.map.painter.context,s=n.gl;!this._dirty||this.texture instanceof ag||(this.texture?this.texture.update(this.image):(this.texture=new Qn(n,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(n)}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class YS extends Co{constructor(t){super(t,{}),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(t){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const XS=new Xn({visibility:new wt(rt.layout_sky.visibility)});var KS={paint:new Xn({"sky-type":new wt(rt.paint_sky["sky-type"]),"sky-atmosphere-sun":new wt(rt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new wt(rt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new wt(rt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new wt(rt.paint_sky["sky-gradient-radius"]),"sky-gradient":new ju(rt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new wt(rt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new wt(rt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new wt(rt.paint_sky["sky-opacity"])}),layout:XS};function g0(e,t,n){const s=[0,0,1],a=ur.identity([]);return ur.rotateY(a,a,n?-De(e)+Math.PI:De(e)),ur.rotateX(a,a,-De(t)),G.transformQuat(s,s,a),G.normalize(s,s)}var QS={paint:new Xn({})};const JS={circle:class extends Co{constructor(e,t){super(e,FT,t)}createBucket(e){return new Em(e)}queryRadius(e){const t=e;return Ra("circle-radius",this,t)+Ra("circle-stroke-width",this,t)+Gr(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,s,a,c,u,d){const f=Sm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,e.pixelToTileUnitsFactor),p=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return Kb(e,s,c,u,d,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),f,p)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const n=Xb(this);return{config:new Cc(this,t),defines:n,overrideFog:!1}}},heatmap:class extends Co{createBucket(e){return new tv(e)}constructor(e,t){super(e,Rm,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Pm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Ra("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,s,a,c,u,d){const f=this.paint.get("heatmap-radius").evaluate(t,n);return Kb(e,s,c,u,d,!0,!0,new et(0,0),f)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return"heatmap"===e?{config:new Cc(this,t),overrideFog:!1}:{}}},hillshade:class extends Co{constructor(e,t){super(e,nv,t)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends Co{constructor(e,t){super(e,oh,t)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(e,t){return{config:new Cc(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Pa(e)}queryRadius(){return Gr(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,s,a,c){return!e.queryGeometry.isAboveHorizon&&kT(Qd(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,e.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Co{constructor(e,t){super(e,HS,t),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new If(e)}queryRadius(){return Gr(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,n,s,a,c,u,d,f){const p=Sm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,e.pixelToTileUnitsFactor),g=this.paint.get("fill-extrusion-height").evaluate(t,n),_=this.paint.get("fill-extrusion-base").evaluate(t,n),v=[0,0],x=d&&c.elevation,b=c.elevation?c.elevation.exaggeration():1,E=e.tile.getBucket(this);if(x&&E instanceof If){const P=E.centroidVertexArray,I=f+1;I<P.length&&(v[0]=P.geta_centroid_pos0(I),v[1]=P.geta_centroid_pos1(I))}if(0===v[0]&&1===v[1])return!1;"globe"===c.projection.name&&(s=Ee([s],[new et(0,0),new et(ut,ut)],e.tileID.canonical).map(P=>P.polygon).flat());const C=x?d:null,[M,T]=(I=s,O=_,L=g,F=p,N=u,B=C,V=v,U=b,q=c.center.lat,"globe"===(P=c).projection.name?function(X,Q,nt,Y,K,ot,at,lt,dt,ft,gt){const ht=[],yt=[],Ot=X.projection.upVectorScale(gt,X.center.lat,X.worldSize).metersToTile,Lt=[0,0,0,1],Ut=[0,0,0,1],Gt=(ie,Je,$e,pe)=>{ie[0]=Je,ie[1]=$e,ie[2]=pe,ie[3]=1},me=u0();nt>0&&(nt+=me),Y+=me;for(const ie of Q){const Je=[],$e=[];for(const pe of ie){const ue=pe.x+K.x,oe=pe.y+K.y,He=X.projection.projectTilePoint(ue,oe,gt),Ye=X.projection.upVector(gt,pe.x,pe.y);let we=nt,Mn=Y;if(at){const ei=d0(ue,oe,nt,Y,at,lt,dt,ft);we+=ei.base,Mn+=ei.top}0!==nt?Gt(Lt,He.x+Ye[0]*Ot*we,He.y+Ye[1]*Ot*we,He.z+Ye[2]*Ot*we):Gt(Lt,He.x,He.y,He.z),Gt(Ut,He.x+Ye[0]*Ot*Mn,He.y+Ye[1]*Ot*Mn,He.z+Ye[2]*Ot*Mn),G.transformMat4(Lt,Lt,ot),G.transformMat4(Ut,Ut,ot),Je.push(new Yc(Lt[0],Lt[1],Lt[2])),$e.push(new Yc(Ut[0],Ut[1],Ut[2]))}ht.push(Je),yt.push($e)}return[ht,yt]}(P,I,O,L,F,N,B,V,U,q,e.tileID.canonical):B?function(X,Q,nt,Y,K,ot,at,lt,dt){const ft=[],gt=[],ht=[0,0,0,1];for(const yt of X){const Ot=[],Lt=[];for(const Ut of yt){const Gt=Ut.x+Y.x,me=Ut.y+Y.y,ie=d0(Gt,me,Q,nt,ot,at,lt,dt);ht[0]=Gt,ht[1]=me,ht[2]=ie.base,ht[3]=1,mn.transformMat4(ht,ht,K),ht[3]=Math.max(ht[3],1e-5);const Je=new Yc(ht[0]/ht[3],ht[1]/ht[3],ht[2]/ht[3]);ht[0]=Gt,ht[1]=me,ht[2]=ie.top,ht[3]=1,mn.transformMat4(ht,ht,K),ht[3]=Math.max(ht[3],1e-5);const $e=new Yc(ht[0]/ht[3],ht[1]/ht[3],ht[2]/ht[3]);Ot.push(Je),Lt.push($e)}ft.push(Ot),gt.push(Lt)}return[ft,gt]}(I,O,L,F,N,B,V,U,q):function(X,Q,nt,Y,K){const ot=[],at=[],lt=K[8]*Q,dt=K[9]*Q,ft=K[10]*Q,gt=K[11]*Q,ht=K[8]*nt,yt=K[9]*nt,Ot=K[10]*nt,Lt=K[11]*nt;for(const Ut of X){const Gt=[],me=[];for(const ie of Ut){const Je=ie.x+Y.x,$e=ie.y+Y.y,pe=K[0]*Je+K[4]*$e+K[12],ue=K[1]*Je+K[5]*$e+K[13],oe=K[2]*Je+K[6]*$e+K[14],He=K[3]*Je+K[7]*$e+K[15],Ye=pe+lt,we=ue+dt,Mn=oe+ft,ei=Math.max(He+gt,1e-5),gn=pe+ht,Wn=ue+yt,ui=oe+Ot,ni=Math.max(He+Lt,1e-5);Gt.push(new Yc(Ye/ei,we/ei,Mn/ei)),me.push(new Yc(gn/ni,Wn/ni,ui/ni))}ot.push(Gt),at.push(me)}return[ot,at]}(I,O,L,F,N)),R=e.queryGeometry;var P,I,O,L,F,N,B,V,U,q;return function(P,I,O){let L=1/0;kT(O,I)&&(L=h0(O,I[0]));for(let F=0;F<I.length;F++){const N=I[F],B=P[F];for(let V=0;V<N.length-1;V++){const U=N[V],q=[U,N[V+1],B[V+1],B[V],U];Yy(O,q)&&(L=Math.min(L,h0(O,q)))}}return L!==1/0&&L}(M,T,R.isPointQuery()?R.screenBounds:R.screenGeometry)}},line:class extends Co{constructor(e,t){super(e,f0,t),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof xi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=BE.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Uc(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const n=NE(this);return{config:new Cc(this,t),defines:n,overrideFog:!1}}queryRadius(e){const t=e,n=jE(Ra("line-width",this,t),Ra("line-gap-width",this,t)),s=Ra("line-offset",this,t);return n/2+Math.abs(s)+Gr(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,s,a,c){if(e.queryGeometry.isAboveHorizon)return!1;const u=Qd(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,e.pixelToTileUnitsFactor),d=e.pixelToTileUnitsFactor/2*jE(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),f=this.paint.get("line-offset").evaluate(t,n);return f&&(s=function(p,g){const _=[],v=new et(0,0);for(let x=0;x<p.length;x++){const b=p[x],E=[];for(let C=0;C<b.length;C++){const M=b[C],T=b[C+1],R=0===C?v:M.sub(b[C-1])._unit()._perp(),P=C===b.length-1?v:T.sub(M)._unit()._perp(),I=R._add(P)._unit();I._mult(1/(I.x*P.x+I.y*P.y)),E.push(I._mult(g)._add(M))}_.push(E)}return _}(s,f*e.pixelToTileUnitsFactor)),function(p,g,_){for(let v=0;v<g.length;v++){const x=g[v];if(p.length>=3)for(let b=0;b<x.length;b++)if(El(p,x[b]))return!0;if(Xy(p,x,_))return!0}return!1}(u,s,d)}isTileClipped(){return!0}},symbol:ng,background:class extends Co{constructor(e,t){super(e,qS,t)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:class extends Co{constructor(e,t){super(e,WS,t),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(e){return!(e&&e._source instanceof Wo)||!e._source.onNorthPole&&!e._source.onSouthPole&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-color"].value.expression,[t,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=Pm({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends Co{constructor(e,t){super(e,KS,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Pm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),a=!s,c=e.style.light,u=c.properties.get("position");return a&&"viewport"===c.properties.get("anchor")&&tt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?g0(u.azimuthal,90-u.polar,t):g0(s[0],90-s[1],t)}const n=this.paint.get("sky-gradient-center");return g0(n[0],90-n[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends Co{constructor(e,t){super(e,QS)}},model:class extends Co{constructor(e,t){super(e,zS,t)}createBucket(e){return new NS(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof as}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function mg(e,t){return"custom"===e.type?new YS(e):new JS[e.type](e,t)}function tI(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class UE extends Be{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new yi({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,n){if(this.loaded[n]!==t&&(this.loaded[n]=t,t)){for(const{ids:s,callback:a}of this.requestors)this._notify(s,n,a);this.requestors=[]}}hasImage(t,n){return!!this.getImage(t,n)}getImage(t,n){return this.images[n][t]}addImage(t,n,s){this._validate(t,s)&&(this.images[n][t]=s)}_validate(t,n){let s=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new zt(new Error(`Image "${t}" has invalid "stretchX" value`))),s=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new zt(new Error(`Image "${t}" has invalid "stretchY" value`))),s=!1),this._validateContent(n.content,n)||(this.fire(new zt(new Error(`Image "${t}" has invalid "content" value`))),s=!1),s}_validateStretch(t,n){if(!t)return!0;let s=0;for(const a of t){if(a[0]<s||a[1]<a[0]||n<a[1])return!1;s=a[1]}return!0}_validateContent(t,n){return!(t&&(4!==t.length||t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,n,s){s.version=this.images[n][t].version+1,this.images[n][t]=s,this.updatedImages[n][t]=!0}removeImage(t,n){const s=this.images[n][t];delete this.images[n][t],delete this.patterns[n][t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,n,s){let a=!0;const c=!!this.loaded[n];if(!c)for(const u of t)this.images[n][u]||(a=!1);c||a?this._notify(t,n,s):this.requestors.push({ids:t,scope:n,callback:s})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,n,s){const a={};for(const c of t){this.images[n][c]||this.fire(new Dt("styleimagemissing",{id:c}));const u=this.images[n][c];u?a[c]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,hasRenderCallback:!(!u.userImage||!u.userImage.render)}:tt(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,a)}getPixelSize(t){const{width:n,height:s}=this.atlasImage[t];return{width:n,height:s}}getPattern(t,n){const s=this.patterns[n][t],a=this.getImage(t,n);if(!a)return null;if(s&&s.position.version===a.version)return s.position;if(s)s.position.version=a.version;else{const c={w:a.data.width+2,h:a.data.height+2,x:0,y:0},u=new Iv(c,a);this.patterns[n][t]={bin:c,position:u}}return this._updatePatternAtlas(n),this.patterns[n][t].position}bind(t,n){const s=t.gl;let a=this.atlasTexture[n];a?this.dirty&&(a.update(this.atlasImage[n]),this.dirty=!1):(a=new Qn(t,this.atlasImage[n],s.RGBA),this.atlasTexture[n]=a),a.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(t){const n=[];for(const u in this.patterns[t])n.push(this.patterns[t][u].bin);const{w:s,h:a}=hf(n),c=this.atlasImage[t];c.resize({width:s||1,height:a||1});for(const u in this.patterns[t]){const{bin:d}=this.patterns[t][u],f=d.x+1,p=d.y+1,g=this.images[t][u].data,_=g.width,v=g.height;yi.copy(g,c,{x:0,y:0},{x:f,y:p},{width:_,height:v}),yi.copy(g,c,{x:0,y:v-1},{x:f,y:p-1},{width:_,height:1}),yi.copy(g,c,{x:0,y:0},{x:f,y:p+v},{width:_,height:1}),yi.copy(g,c,{x:_-1,y:0},{x:f-1,y:p},{width:1,height:v}),yi.copy(g,c,{x:0,y:0},{x:f+_,y:p},{width:1,height:v})}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,n){for(const s of t){if(this.callbackDispatchedThisFrame[n][s])continue;this.callbackDispatchedThisFrame[n][s]=!0;const a=this.images[n][s];tI(a)&&this.updateImage(s,n,a)}}}const $E=new Xn({anchor:new wt(rt.light.anchor),position:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return $t(e.expression.evaluate(t))}interpolate(e,t,n){return{x:vt(e.x,t.x,n),y:vt(e.y,t.y,n),z:vt(e.z,t.z,n),azimuthal:vt(e.azimuthal,t.azimuthal,n),polar:vt(e.polar,t.polar,n)}}}(rt.light.position),color:new wt(rt.light.color),intensity:new wt(rt.light.intensity)});class _0 extends Be{constructor(t,n="flat"){super(),this._transitionable=new zu($E),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n,s={}){this._validate(k1,t,s)||(this._transitionable.setTransitionOrValue(t),this.id=n)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,s){return(!s||!1!==s.validate)&&vd(this,t.call(er,qt({value:n,style:{glyphs:!0,sprite:!0},styleSpec:rt})))}}const HE=new Xn({source:new wt(rt.terrain.source),exaggeration:new wt(rt.terrain.exaggeration)});let GE=class extends Be{constructor(e,t,n,s){super(),this.scope=n,this._transitionable=new zu(HE,s),this._transitionable.setTransitionOrValue(e,s),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new zn(e)).get("exaggeration")}isZoomDependent(){const e=this._transitionable._values.exaggeration;return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof as}};const y0=45,v0=65,Fl=.05;function Rf(e,t,n,s){const a=Ps(y0,v0,n),[c,u]=gg(e,s);let d=1-Math.min(1,Math.exp((t-c)/(u-c)*-6));return d*=d*d,d=Math.min(1,1.00747*d),d*a*e.alpha}function gg(e,t){const n=.5/Math.tan(.5*t);return[e.range[0]+n,e.range[1]+n]}function x0(e,t,n,s,a){const c=G.transformMat4([],[t,n,s],a.mercatorFogMatrix);return Rf(e,G.length(c),a.pitch,a._fov)}function Nl(e,t,n,s,a,c,u){const d=[[n,s,0],[a,s,0],[a,c,0],[n,c,0]];let f=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(const g of d){const _=G.transformMat4([],g,t),v=G.length(_);f=Math.min(f,v),p=Math.max(p,v)}return[Rf(e,f,u.pitch,u._fov),Rf(e,p,u.pitch,u._fov)]}const eI=new Xn({range:new wt(rt.fog.range),color:new wt(rt.fog.color),"high-color":new wt(rt.fog["high-color"]),"space-color":new wt(rt.fog["space-color"]),"horizon-blend":new wt(rt.fog["horizon-blend"]),"star-intensity":new wt(rt.fog["star-intensity"]),"vertical-range":new wt(rt.fog["vertical-range"])});class nI extends Be{constructor(t,n){super(),this._transitionable=new zu(eI),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=n}get state(){const t=this._transform,n="globe"===t.projection.name,s=ti(t.zoom),a=this.properties.get("range"),c=[.5,3];return{range:n?[vt(c[0],a[0],s),vt(c[1],a[1],s)]:a,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n={}){if(this._validate(tT,t,n))return;const s=qt({},t);for(const a of Object.keys(rt.fog))void 0===s[a]&&(s[a]=rt.fog[a].default);this._transitionable.setTransitionOrValue(s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:Ps(y0,v0,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(s,a,c){const u=We.fromLngLat(a),d=c.elevation?c.elevation.getAtPointOrZero(u):0;return x0(s,u.x,u.y,d,c)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Nl(this.state,n,0,0,ut,ut,this._transform)}getOpacityForBounds(t,n,s,a,c){return this._transform.projection.supportsFog?Nl(this.state,t,n,s,a,c,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?gg(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const s of n){const a=t.points[s];let c;if(a[2]>=0)c=a;else{const u=t.points[s-4];c=sn(u,a,u[2]/(u[2]-a[2]))}if(x0(this.state,c[0],c[1],0,this._transform)>=Fl)return!0}return!1}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,s){return(!s||!1!==s.validate)&&vd(this,t.call(er,qt({value:n,style:{glyphs:!0,sprite:!0},styleSpec:rt})))}}class Ph{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class MR{constructor(){this.tasks={},this.taskQueue=[],Bi(["process"],this),this.invoker=new Ph(this.process),this.nextId=0}add(t,n){const s=this.nextId++,a=function({type:c,isSymbolTile:u,zoom:d}){return d=d||0,"message"===c?0:"maybePrepare"!==c||u?"parseTile"!==c||u?"parseTile"===c&&u?300-d:"maybePrepare"===c&&u?400-d:500:200-d:100-d}(n);if(0===a){Ct();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:t,metadata:n,priority:a,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){Ct();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const n=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let t=null,n=1/0;for(let a=0;a<this.taskQueue.length;a++){const c=this.tasks[this.taskQueue[a]];c.priority<n&&(n=c.priority,t=a)}if(null===t)return null;const s=this.taskQueue[t];return this.taskQueue.splice(t,1),s}remove(){this.invoker.remove()}}class Pr{constructor(t,n,s){this.target=t,this.parent=n,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Bi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new MR}send(t,n,s,a,c=!1,u){const d=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=u,this.callbacks[d]=s);const f=new Set;return this.target.postMessage({id:d,type:t,hasCallback:!!s,targetMapId:a,mustQueue:c,sourceMapId:this.mapId,data:pc(n,f)},f),{cancel:()=>{s&&delete this.callbacks[d],this.target.postMessage({id:d,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(t){const n=t.data,s=n.id;if(s&&(!n.targetMapId||this.mapId===n.targetMapId))if("<cancel>"===n.type){const a=this.cancelCallbacks[s];delete this.cancelCallbacks[s],a&&a.cancel()}else if(n.mustQueue||Ct()){const a=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,n),a&&a.metadata||{type:"message"})}else this.processTask(s,n)}processTask(t,n){if("<response>"===n.type){const s=this.callbacks[t];delete this.callbacks[t],s&&(n.error?s(us(n.error)):s(null,us(n.data)))}else{const s=new Set,a=n.hasCallback?(u,d)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:u?pc(u):null,data:pc(d,s)},s)}:u=>{},c=us(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,c,a);else if(this.parent.getWorkerSource){const u=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,u[0],c.source,c.scope)[u[1]](c,a)}else a(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let b0=(()=>{class e{constructor(n,s){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=hi();const a=this.workerPool.acquire(this.id);for(let c=0;c<a.length;c++){const u=new e.Actor(a[c],s,this.id);u.name=`Worker ${c}`,this.actors.push(u)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,s,a){Kl(this.actors,(c,u)=>{c.send(n,s,u)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return e.Actor=Pr,e})();class w0 extends Be{constructor(t,n,s,a){super(),this.scope=s,this._options=t,this.properties=new Bu(n),this._transitionable=new zu(n,new Map(a)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,n){this._options=t,this._transitionable.setTransitionOrValue(t.properties,n)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const qE=new Xn({color:new wt(rt.properties_light_ambient.color),intensity:new wt(rt.properties_light_ambient.intensity)}),TR=new Xn({direction:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([n,s]){const a=$t([1,n,s]);return{x:a.x,y:a.y,z:a.z}}(e.expression.evaluate(t))}interpolate(e,t,n){return{x:vt(e.x,t.x,n),y:vt(e.y,t.y,n),z:vt(e.z,t.z,n)}}}(rt.properties_light_directional.direction),color:new wt(rt.properties_light_directional.color),intensity:new wt(rt.properties_light_directional.intensity),"cast-shadows":new wt(rt.properties_light_directional["cast-shadows"]),"shadow-intensity":new wt(rt.properties_light_directional["shadow-intensity"])});class ci{constructor(t,n,s,a){this.screenBounds=t,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=s,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,a)}static createFromScreenPoints(t,n){let s,a;if(t instanceof et||"number"==typeof t[0]){const c=et.convert(t);s=[c],a=n.isPointAboveHorizon(c)}else{const c=et.convert(t[0]),u=et.convert(t[1]);s=[c,u],a=Xl(c,u).every(d=>n.isPointAboveHorizon(d))}return new ci(s,n.getCameraPoint(),a,n)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return Xl(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],s=1===this.screenBounds.length?this.screenBounds[0].add(new et(1,1)):this.screenBounds[1],a=Xl(n,s,0,!1);return this.cameraPoint.y>s.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<s.x?a.splice(3,0,this.cameraPoint):this.cameraPoint.x>=s.x?a[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(a[3]=this.cameraPoint)),function(c,u){const d=[];for(let f=0;f<c.length;f++){const p=Os(f-1,-1,c.length-1),g=Os(f+1,-1,c.length-1),_=c[f],v=c[g],x=c[p].sub(_).unit(),b=v.sub(_).unit(),E=b.angleWithSep(x.x,x.y),C=x.add(b).unit().mult(-1*u/Math.sin(E/2));d.push(_.add(C))}return d}(a,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],s=1===this.screenBounds.length?this.screenBounds[0].add(new et(1,1)):this.screenBounds[1],a=Xl(n,s,t),c=this.cameraPoint.clone();switch(3*((c.y>n.y)+(c.y>s.y))+((c.x>n.x)+(c.x>s.x))){case 0:a[0]=c,a[4]=c.clone();break;case 1:a.splice(1,0,c);break;case 2:a[1]=c;break;case 3:a.splice(4,0,c);break;case 5:a.splice(2,0,c);break;case 6:a[3]=c;break;case 7:a.splice(3,0,c);break;case 8:a[2]=c}return a}containsTile(t,n,s,a=0){const c=t.queryPadding/n._pixelsPerMercatorPixel+1,u=s?this._bufferedCameraMercator(c,n):this._bufferedScreenMercator(c,n);let d=t.tileID.wrap+(u.unwrapped?a:0);const f=u.polygon.map(C=>pf(t.tileTransform,C,d));if(!Mm(f,0,0,ut,ut))return;d=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?a:0);const p=this.screenGeometryMercator.polygon.map(C=>fh(t.tileTransform,C,d)),g=p.map(C=>new et(C[0],C[1])),_=n.getFreeCameraOptions().position||new We(0,0,0),v=fh(t.tileTransform,_,d),x=p.map(C=>{const M=G.sub(C,C,v);return G.normalize(M,M),new gm(v,M)}),b=qc(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:g,tilespaceRays:x,bufferedTilespaceGeometry:f,bufferedTilespaceBounds:(E=Rs(f),E.min.x=Qt(E.min.x,0,ut),E.min.y=Qt(E.min.y,0,ut),E.max.x=Qt(E.max.x,0,ut),E.max.y=Qt(E.max.y,0,ut),E),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:b};var E}_bufferedScreenMercator(t,n){const s=ZE(t);if(this._screenRaycastCache[s])return this._screenRaycastCache[s];{let a;return a="globe"===n.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),n):{polygon:this.bufferedScreenGeometry(t).map(c=>n.pointCoordinate3D(c)),unwrapped:!0},this._screenRaycastCache[s]=a,a}}_bufferedCameraMercator(t,n){const s=ZE(t);if(this._cameraRaycastCache[s])return this._cameraRaycastCache[s];{let a;return a="globe"===n.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),n):{polygon:this.bufferedCameraGeometry(t).map(c=>n.pointCoordinate3D(c)),unwrapped:!0},this._cameraRaycastCache[s]=a,a}}_projectAndResample(t,n){const s=function(c,u){const d=it.multiply([],u.pixelMatrix,u.globeMatrix),f=[0,-Rr,0,1],p=[0,Rr,0,1],g=[0,0,0,1];mn.transformMat4(f,f,d),mn.transformMat4(p,p,d),mn.transformMat4(g,g,d);const _=new et(f[0]/f[3],f[1]/f[3]),v=new et(p[0]/p[3],p[1]/p[3]),x=El(c,_)&&f[3]<g[3],b=El(c,v)&&p[3]<g[3];if(!x&&!b)return null;const E=function(L,F,N){for(let B=1;B<L.length;B++){const V=Pf(F.pointCoordinate3D(L[B-1]).x),U=Pf(F.pointCoordinate3D(L[B]).x);if(N<0){if(V<U)return{idx:B,t:-V/(U-1-V)}}else if(U<V)return{idx:B,t:(1-V)/(U+1-V)}}return null}(c,u,x?-1:1);if(!E)return null;const{idx:C,t:M}=E;let T=C>1?E0(c.slice(0,C),u):[],R=C<c.length?E0(c.slice(C),u):[];T=T.map(L=>new et(Pf(L.x),L.y)),R=R.map(L=>new et(Pf(L.x),L.y));const P=[...T];0===P.length&&P.push(R[R.length-1]);const I=vt(P[P.length-1].y,(0===R.length?T[0]:R[0]).y,M);let O;return O=x?[new et(0,I),new et(0,0),new et(1,0),new et(1,I)]:[new et(1,I),new et(1,1),new et(0,1),new et(0,I)],P.push(...O),0===R.length?P.push(T[0]):P.push(...R),{polygon:P.map(L=>new We(L.x,L.y)),unwrapped:!1}}(t,n);if(s)return s;const a=function(c,u){let d=!1,f=-1/0,p=0;for(let _=0;_<c.length-1;_++)c[_].x>f&&(f=c[_].x,p=_);for(let _=0;_<c.length-1;_++){const v=(p+_)%(c.length-1),x=c[v],b=c[v+1];Math.abs(x.x-b.x)>.5&&(x.x<b.x?(x.x+=1,0===v&&(c[c.length-1].x+=1)):(b.x+=1,v+1===c.length-1&&(c[0].x+=1)),d=!0)}const g=Ri(u.center.lng);return d&&g<Math.abs(g-1)&&c.forEach(_=>{_.x-=1}),{polygon:c,unwrapped:d}}(E0(t,n).map(c=>new et(Pf(c.x),c.y)),n);return{polygon:a.polygon.map(c=>new We(c.x,c.y)),unwrapped:a.unwrapped}}}function E0(e,t){return OT(e,n=>{const s=t.pointCoordinate3D(n);n.x=s.x,n.y=s.y},1/256)}function Pf(e){return e<0?1+e%1:e%1}function ZE(e){return 100*e|0}function zl(e,t,n,s,a){const c=function(u,d){if(u)return a(u);if(d){e.url&&d.tiles&&e.tiles&&delete e.tiles;const f=Or(qt(d,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(f.vectorLayers=d.vector_layers,f.vectorLayerIds=f.vectorLayers.map(p=>p.id)),f.tiles=t.canonicalizeTileset(f,e.url),a(null,f)}};return e.url?It(t.transformRequest(t.normalizeSourceURL(e.url,null,n,s),pt.Source),c):xe.frame(()=>c(null,e))}class _g{constructor(t,n,s){this.bounds=Ur.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=s||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),s=Math.floor(Ri(this.bounds.getWest())*n),a=Math.floor(wi(this.bounds.getNorth())*n),c=Math.ceil(Ri(this.bounds.getEast())*n),u=Math.ceil(wi(this.bounds.getSouth())*n);return t.x>=s&&t.x<c&&t.y>=a&&t.y<u}}class Of{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.image=new _s({width:t,height:n}),this.positions={},this.uploaded=!1}getDash(t,n){const s=this.getKey(t,n);return this.positions[s]}trim(){const t=this.width,n=this.height=Yn(this.nextRow);this.image.resize({width:t,height:n})}getKey(t,n){return t.join(",")+n}getDashRanges(t,n,s){const a=[];let c=t.length%2==1?-t[t.length-1]*s:0,u=t[0]*s,d=!0;a.push({left:c,right:u,isDash:d,zeroLength:0===t[0]});let f=t[0];for(let p=1;p<t.length;p++){d=!d;const g=t[p];c=f*s,f+=g,u=f*s,a.push({left:c,right:u,isDash:d,zeroLength:0===g})}return a}addRoundDash(t,n,s){const a=n/2;for(let c=-s;c<=s;c++){const u=this.width*(this.nextRow+s+c);let d=0,f=t[d];for(let p=0;p<this.width;p++){p/f.right>1&&(f=t[++d]);const g=Math.abs(p-f.left),_=Math.abs(p-f.right),v=Math.min(g,_);let x;const b=c/s*(a+1);if(f.isDash){const E=a-Math.abs(b);x=Math.sqrt(v*v+E*E)}else x=a-Math.sqrt(v*v+b*b);this.image.data[u+p]=Math.max(0,Math.min(255,x+128))}}}addRegularDash(t,n){for(let f=t.length-1;f>=0;--f){const p=t[f],g=t[f+1];p.zeroLength?t.splice(f,1):g&&g.isDash===p.isDash&&(g.left=p.left,t.splice(f,1))}const s=t[0],a=t[t.length-1];s.isDash===a.isDash&&(s.left=a.left-this.width,a.right=s.right+this.width);const c=this.width*this.nextRow;let u=0,d=t[u];for(let f=0;f<this.width;f++){f/d.right>1&&(d=t[++u]);const p=Math.abs(f-d.left),g=Math.abs(f-d.right),_=Math.min(p,g);this.image.data[c+f]=Math.max(0,Math.min(255,(d.isDash?_:-_)+n+128))}}addDash(t,n){const s=this.getKey(t,n);if(this.positions[s])return this.positions[s];const a="round"===n,c=a?7:0,u=2*c+1;if(this.nextRow+u>this.height)return tt("LineAtlas out of space"),null;0===t.length&&t.push(1);let d=0;for(let g=0;g<t.length;g++)t[g]<0&&(tt("Negative value is found in line dasharray, replacing values with 0"),t[g]=0),d+=t[g];if(0!==d){const g=this.width/d,_=this.getDashRanges(t,this.width,g);a?this.addRoundDash(_,g,c):this.addRegularDash(_,"square"===n?.5*g:0)}const f=this.nextRow+c;this.nextRow+=u;const p={tl:[f,c],br:[d,0]};return this.positions[s]=p,p}}Xt(Of,"LineAtlas");const kf=1*xs;class Yr{constructor(t){const n={},s=[];for(const d in t){const f=t[d],p=n[d]={};for(const g in f.glyphs){const _=f.glyphs[+g];if(!_||0===_.bitmap.width||0===_.bitmap.height)continue;const v=_.metrics.localGlyph?kf:1,x={x:0,y:0,w:_.bitmap.width+2*v,h:_.bitmap.height+2*v};s.push(x),p[g]=x}}const{w:a,h:c}=hf(s),u=new _s({width:a||1,height:c||1});for(const d in t){const f=t[d];for(const p in f.glyphs){const g=f.glyphs[+p];if(!g||0===g.bitmap.width||0===g.bitmap.height)continue;const _=n[d][p],v=g.metrics.localGlyph?kf:1;_s.copy(g.bitmap,u,{x:0,y:0},{x:_.x+v,y:_.y+v},g.bitmap)}}this.image=u,this.positions=n}}Xt(Yr,"GlyphAtlas");class SR{constructor(t){this.tileID=new nn(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Pl(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,n,s,a,c){this.status="parsing",this.data=t,this.collisionBoxArray=new Jp;const u=new mv(Object.keys(t.layers).sort()),d=new Um(this.tileID,this.promoteId);d.bucketLayerIDs=[];const f={},p=new Of(256,256),g={featureIndex:d,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:p,availableImages:s,brightness:this.brightness},_=n.familiesBySource[this.source];for(const T in _){const R=t.layers[T];if(!R)continue;let P=!1,I=!1,O=!1;for(const N of _[T])"symbol"===N[0].type?P=!0:I=!0,N[0].is3D()&&"model"!==N[0].type&&(O=!0);if(this.extraShadowCaster&&!O||!0===this.isSymbolTile&&!P||!1===this.isSymbolTile&&!I)continue;1===R.version&&tt(`Vector tile source "${this.source}" layer "${T}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const L=u.encode(T),F=[];for(let N=0;N<R.length;N++){const B=R.feature(N),V=d.getId(B,T);F.push({feature:B,id:V,index:N,sourceLayerIndex:L})}for(const N of _[T]){const B=N[0];(!this.extraShadowCaster||B.is3D()&&"model"!==B.type)&&(void 0!==this.isSymbolTile&&"symbol"===B.type!==this.isSymbolTile||B.minzoom&&this.zoom<Math.floor(B.minzoom)||B.maxzoom&&this.zoom>=B.maxzoom||"none"!==B.visibility&&(yg(N,this.zoom,g.brightness,s),(f[B.id]=B.createBucket({index:d.bucketLayerIDs.length,layers:N,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:L,sourceID:this.source,projection:this.projection.spec})).populate(F,g,this.tileID.canonical,this.tileTransform),d.bucketLayerIDs.push(N.map(V=>V.id))))}}let v,x,b,E;p.trim();const C={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},M=()=>{if(v)return this.status="done",c(v);if(this.extraShadowCaster)this.status="done",c(null,{buckets:kn(f).filter(T=>!T.isEmpty()),featureIndex:d,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:g.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(x&&b&&E){const T=new Yr(x),R=new Tw(b,E);for(const P in f){const I=f[P];I instanceof vh?(yg(I.layers,this.zoom,g.brightness,s),gR(I,x,T.positions,b,R.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):I.hasPattern&&(I instanceof Uc||I instanceof Pa||I instanceof If)&&(yg(I.layers,this.zoom,g.brightness,s),I.addFeatures(g,this.tileID.canonical,R.patternPositions,s,this.tileTransform,this.brightness))}this.status="done",c(null,{buckets:kn(f).filter(P=>!P.isEmpty()),featureIndex:d,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:T.image,lineAtlas:p,imageAtlas:R,brightness:g.brightness})}};if(!this.extraShadowCaster){const T=fu(g.glyphDependencies,I=>Object.keys(I).map(Number));Object.keys(T).length?a.send("getGlyphs",{uid:this.uid,stacks:T,scope:this.scope},(I,O)=>{v||(v=I,x=O,M())},void 0,!1,C):x={};const R=Object.keys(g.iconDependencies);R.length?a.send("getImages",{icons:R,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(I,O)=>{v||(v=I,b=O,M())},void 0,!1,C):b={};const P=Object.keys(g.patternDependencies);P.length?a.send("getImages",{icons:P,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(I,O)=>{v||(v=I,E=O,M())},void 0,!1,C):E={}}M()}}function yg(e,t,n,s){const a=new zn(t,{brightness:n});for(const c of e)c.recalculate(a,s)}class C0{constructor(t){this.entries={},this.scheduler=t}request(t,n,s,a){const c=this.entries[t]=this.entries[t]||{callbacks:[]};if(c.result){const[u,d]=c.result;return this.scheduler?this.scheduler.add(()=>{a(u,d)},n):a(u,d),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=s((u,d)=>{c.result=[u,d];for(const f of c.callbacks)this.scheduler?this.scheduler.add(()=>{f(u,d)},n):f(u,d);setTimeout(()=>delete this.entries[t],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(u=>u!==a),c.callbacks.length||(c.cancel(),delete this.entries[t]))}}}function WE(e,t,n){const s=JSON.stringify(e.request);return e.data&&(this.deduped.entries[s]={result:[null,e.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},a=>{const c=Nt(e.request,(u,d,f,p)=>{u?a(u):d&&a(null,{vectorTile:n?void 0:new fv(new jm(d)),rawData:d,cacheControl:f,expires:p})});return()=>{c.cancel(),a()}},t)}class D0 extends Be{constructor(t,n,s,a){if(super(),this.id=t,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,qt(this,Or(n,["url","scheme","tileSize","promoteId"])),this._options=qt({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a),this._tileWorkers={},this._deduped=new C0}load(t){this._loaded=!1,this.fire(new Dt("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map._worldview;this._tileJSONRequest=zl(this._options,this.map._requestManager,n,s,(a,c)=>{this._tileJSONRequest=null,this._loaded=!0,a?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),s&&2!==s.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new zt(a))):c&&(qt(this,c),c.bounds&&(this.tileBounds=new _g(c.bounds,this.minzoom,this.maxzoom)),Ka(c.tiles,this.map._requestManager._customAccessToken),this.fire(new Dt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Dt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(a)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=cr(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return qt({},this._options)}loadTile(t,n){const s=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),a={request:this.map._requestManager.transformRequest(s,pt.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:xe.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(a.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=n:t.request=t.actor.send("reloadTile",a,c.bind(this));else if(t.actor=this._tileWorkers[s]=this._tileWorkers[s]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",a,c.bind(this),void 0,!0);else{const u=WE.call({deduped:this._deduped},a,(d,f)=>{d||!f?c.call(this,d):(a.data={cacheControl:f.cacheControl,expires:f.expires,rawData:f.rawData.slice(0)},t.actor&&t.actor.send("loadTile",a,c.bind(this),void 0,!0))},!0);t.request={cancel:u}}function c(u,d){return delete t.request,t.aborted?n(null):u&&404!==u.status?n(u):(d&&d.resourceTiming&&(t.resourceTiming=d.resourceTiming),this.map._refreshExpiredTiles&&d&&t.setExpiryData(d),t.loadVectorData(d,this.map.painter),mu(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class vg extends Be{constructor(t,n,s,a){super(),this.id=t,this.dispatcher=s,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=qt({type:"raster"},n),qt(this,Or(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new Dt("dataloading",{dataType:"source"})),this._tileJSONRequest=zl(this._options,this.map._requestManager,null,null,(n,s)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new zt(n)):s&&(qt(this,s),s.bounds&&(this.tileBounds=new _g(s.bounds,this.minzoom,this.maxzoom)),Ka(s.tiles),this.fire(new Dt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Dt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=cr(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return qt({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const s=xe.devicePixelRatio>=2,a=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),s,this.tileSize);t.request=Ie(this.map._requestManager.transformRequest(a,pt.Tile),(c,u,d,f)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):c?(t.state="errored",n(c)):u?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:d,expires:f}),t.setTexture(u,this.map.painter),t.state="loaded",mu(this.dispatcher),void n(null)):n(null)))}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&t.texture instanceof Qn?(t.destroy(!0),t.texture&&t.texture instanceof Qn&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function YE(){return null!=Ex.workerClass?new Ex.workerClass:new st.Worker(Ex.workerUrl)}const xg="mapboxgl_preloaded_worker_pool";class Oh{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Oh.workerCount;)this.workers.push(new YE);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&0===this.numActive()&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[xg]}numActive(){return Object.keys(this.active).length}}let Lf;function Ff(){return Lf||(Lf=new Oh),Lf}Oh.workerCount=2;let Bl,M0,Es,T0=null;function Nf(){return Ct()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:M0||Le.DRACO_URL}const bg=5123,wg=5126,Eg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[bg]:Uint16Array,5125:Uint32Array,[wg]:Float32Array},iI={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[bg]:"DT_UINT16",5125:"DT_UINT32",[wg]:"DT_FLOAT32"},Kc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function kh(e,t,n){const s=n.json.bufferViews.length,a=n.buffers.length;t.bufferView=s,n.json.bufferViews[s]={buffer:a,byteLength:e.byteLength},n.buffers[a]=e}const S0="KHR_draco_mesh_compression";function rI(e,t){const n=e.extensions&&e.extensions[S0];if(!n)return;const s=new Es.Decoder,a=QE(t,n.bufferView),c=new Es.Mesh;if(!s.DecodeArrayToMesh(a,a.byteLength,c))throw new Error("Failed to decode Draco mesh");const u=t.json.accessors[e.indices],d=Eg[u.componentType],f=u.count*d.BYTES_PER_ELEMENT,p=Es._malloc(f);d===Uint16Array?s.GetTrianglesUInt16Array(c,f,p):s.GetTrianglesUInt32Array(c,f,p),kh(Es.memory.buffer.slice(p,p+f),u,t),Es._free(p);for(const g of Object.keys(n.attributes)){const _=s.GetAttributeByUniqueId(c,n.attributes[g]),v=t.json.accessors[e.attributes[g]],x=iI[v.componentType],b=v.count*Kc[v.type]*Eg[v.componentType].BYTES_PER_ELEMENT,E=Es._malloc(b);s.GetAttributeDataArrayForAllPoints(c,_,Es[x],b,E),kh(Es.memory.buffer.slice(E,E+b),v,t),Es._free(E)}s.destroy(),c.destroy(),delete e.extensions[S0]}const XE=1179937895,I0=new TextDecoder("utf8");function A0(e,t){return new URL(e,t).href}function KE(e,t,n,s){return fetch(A0(e.uri,s)).then(a=>a.arrayBuffer()).then(a=>{t.buffers[n]=a})}function QE(e,t){const n=e.json.bufferViews[t];return new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function JE(e,t,n,s){if(e.uri){const a=A0(e.uri,s);return fetch(a).then(c=>c.blob()).then(c=>st.createImageBitmap(c)).then(c=>{t.images[n]=c})}if(void 0!==e.bufferView){const a=QE(t,e.bufferView),c=new st.Blob([a],{type:e.mimeType});return st.createImageBitmap(c).then(u=>{t.images[n]=u})}}function tC(e,t=0,n){const s={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===XE){const p=new Uint32Array(e,t);let g=2;const _=(p[g++]>>2)-3,v=p[g++]>>2;if(g++,s.json=JSON.parse(I0.decode(p.subarray(g,g+v))),g+=v,g<_){const x=p[g++];g++;const b=t+(g<<2);s.buffers[0]=e.slice(b,b+x)}}else s.json=JSON.parse(I0.decode(new Uint8Array(e,t)));const{buffers:a,images:c,meshes:u,extensionsUsed:d}=s.json;let f=Promise.resolve();if(a){const p=[];for(let g=0;g<a.length;g++){const _=a[g];_.uri?p.push(KE(_,s,g,n)):s.buffers[g]||(s.buffers[g]=null)}f=Promise.all(p)}return f.then(()=>{const p=[],g=d&&d.includes(S0);if(g&&p.push(function(){if(!Es)return Bl||(Bl=function(_){let v,x=null;function b(){v=new Uint8Array(x.buffer)}function E(){throw new Error("Unexpected Draco error.")}const C={a:{a:E,d:function(M,T,R){return v.copyWithin(M,T,T+R)},c:function(M){const T=v.length,R=Math.max(M>>>0,Math.ceil(1.2*T)),P=Math.ceil((R-T)/65536);try{return x.grow(P),b(),!0}catch{return!1}},b:E}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(_,C):_.then(M=>M.arrayBuffer()).then(M=>WebAssembly.instantiate(M,C))).then(M=>{const{Rb:T,Qb:R,P,T:I,X:O,Ja:L,La:F,Qa:N,Va:B,Wa:V,eb:U,jb:q,f:j,e:X,yb:Q,zb:nt,Ab:Y,Bb:K,Db:ot,Gb:at}=M.instance.exports;x=X;const lt=(()=>{let dt=0,ft=0,gt=0,ht=0;return yt=>{gt&&(T(ht),T(dt),ft+=gt,gt=dt=0),dt||(ft+=128,dt=R(ft));const Ot=yt.length+7&-8;let Lt=dt;Ot>=ft&&(gt=Ot,Lt=ht=R(Ot));for(let Ut=0;Ut<yt.length;Ut++)v[Lt+Ut]=yt[Ut];return Lt}})();return b(),j(),{memory:X,_free:T,_malloc:R,Mesh:class{constructor(){this.ptr=P()}destroy(){I(this.ptr)}},Decoder:class{constructor(){this.ptr=L()}destroy(){q(this.ptr)}DecodeArrayToMesh(dt,ft,gt){const ht=lt(dt),yt=F(this.ptr,ht,ft,gt.ptr);return!!O(yt)}GetAttributeByUniqueId(dt,ft){return{ptr:N(this.ptr,dt.ptr,ft)}}GetTrianglesUInt16Array(dt,ft,gt){B(this.ptr,dt.ptr,ft,gt)}GetTrianglesUInt32Array(dt,ft,gt){V(this.ptr,dt.ptr,ft,gt)}GetAttributeDataArrayForAllPoints(dt,ft,gt,ht,yt){U(this.ptr,dt.ptr,ft.ptr,gt,ht,yt)}},DT_INT8:Q(),DT_UINT8:nt(),DT_INT16:Y(),DT_UINT16:K(),DT_UINT32:ot(),DT_FLOAT32:at()}})}(fetch(Nf())),Bl.then(_=>{Es=_,Bl=void 0}))}()),c)for(let _=0;_<c.length;_++)p.push(JE(c[_],s,_,n));return(p.length?Promise.all(p):Promise.resolve()).then(()=>{if(g&&u)for(const{primitives:_}of u)for(const v of _)rI(v,s);return s})})}function eC(e){return fetch(e).then(t=>t.arrayBuffer()).then(t=>tC(t,0,e))}class oI{constructor(t,n,s){if(this.triangleCount=n.length/3,this.min=new et(0,0),this.max=new et(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===t.length||0===s)return;const a=t.map(g=>g.x),c=t.map(g=>g.y);this.min=new et(Math.min(...a),Math.min(...c)),this.max=new et(Math.max(...a),Math.max(...c));const u=this.max.sub(this.min);u.x=Math.max(u.x,1),u.y=Math.max(u.y,1);const d=Math.max(u.x,u.y)/s;this.cellsX=Math.max(1,Math.ceil(u.x/d)),this.cellsY=Math.max(1,Math.ceil(u.y/d)),this.xScale=1/d,this.yScale=1/d;const f=[];for(let g=0;g<this.triangleCount;g++){const _=t[n[3*g+0]].sub(this.min),v=t[n[3*g+1]].sub(this.min),x=t[n[3*g+2]].sub(this.min),b=Qc(Math.floor(Math.min(_.x,v.x,x.x)),this.xScale,this.cellsX),E=Qc(Math.floor(Math.max(_.x,v.x,x.x)),this.xScale,this.cellsX),C=Qc(Math.floor(Math.min(_.y,v.y,x.y)),this.yScale,this.cellsY),M=Qc(Math.floor(Math.max(_.y,v.y,x.y)),this.yScale,this.cellsY),T=new et(0,0),R=new et(0,0),P=new et(0,0),I=new et(0,0);for(let O=C;O<=M;++O){T.y=R.y=O*d,P.y=I.y=(O+1)*d;for(let L=b;L<=E;++L)T.x=P.x=L*d,R.x=I.x=(L+1)*d,(Kd(_,v,x,T,R,I)||Kd(_,v,x,T,I,P))&&f.push({cellIdx:O*this.cellsX+L,triIdx:g})}}if(0===f.length)return;f.sort((g,_)=>g.cellIdx-_.cellIdx||g.triIdx-_.triIdx);let p=0;for(;p<f.length;){const g=f[p].cellIdx,_={start:this.payload.length,len:0};for(;p<f.length&&f[p].cellIdx===g;)++_.len,this.payload.push(f[p++].triIdx);this.cells[g]=_}}query(t,n,s){if(0===this.triangleCount||0===this.cells.length||t.x>this.max.x||this.min.x>n.x||t.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let f=0;f<this.lookup.length;f++)this.lookup[f]=0;const a=Qc(t.x-this.min.x,this.xScale,this.cellsX),c=Qc(n.x-this.min.x,this.xScale,this.cellsX),u=Qc(t.y-this.min.y,this.yScale,this.cellsY),d=Qc(n.y-this.min.y,this.yScale,this.cellsY);for(let f=u;f<=d;f++)for(let p=a;p<=c;p++){const g=this.cells[f*this.cellsX+p];if(g)for(let _=0;_<g.len;_++){const v=this.payload[g.start+_],x=Math.floor(v/8),b=1<<v%8;if(!(this.lookup[x]&b)&&(this.lookup[x]|=b,s.push(v),s.length===this.triangleCount))return}}}}function Qc(e,t,n){return Math.max(0,Math.min(n-1,Math.floor(e*t)))}function Lh(e,t){const n=e.json.bufferViews[t.bufferView];return new Eg[t.componentType](e.buffers[n.buffer],(t.byteOffset||0)+(n.byteOffset||0),t.count*Kc[t.type])}function IR(e,t,n){const s=e.indices,a=e.attributes,c={};c.indexArray=new Ai;const u=t.json.accessors[s],d=u.count/3;c.indexArray.reserve(d);const f=Lh(t,u);for(let v=0;v<d;v++)c.indexArray.emplaceBack(f[3*v],f[3*v+1],f[3*v+2]);c.indexArray._trim(),c.vertexArray=new hs;const p=t.json.accessors[a.POSITION];c.vertexArray.reserve(p.count);const g=Lh(t,p);for(let v=0;v<p.count;v++)c.vertexArray.emplaceBack(g[3*v],g[3*v+1],g[3*v+2]);if(c.vertexArray._trim(),c.aabb=new qn(p.min,p.max),c.centroid=function(v,x){const b=[0,0,0],E=v.length;if(E>0){for(let C=0;C<E;C++){const M=3*v[C];b[0]+=x[M],b[1]+=x[M+1],b[2]+=x[M+2]}b[0]/=E,b[1]/=E,b[2]/=E}return b}(f,g),void 0!==a.COLOR_0){const v=t.json.accessors[a.COLOR_0],x=Kc[v.type];if(v.componentType===wg){c.colorArray=3===x?new hs:new Mr,c.colorArray.reserve(v.count);const b=Lh(t,v);if(3===x)for(let E=0;E<v.count;E++)c.colorArray.emplaceBack(b[3*E],b[3*E+1],b[3*E+2]);else for(let E=0;E<v.count;E++)c.colorArray.emplaceBack(b[4*E],b[4*E+1],b[4*E+2],b[4*E+3]);c.colorArray._trim()}else if(v.componentType===bg&&4===x){c.colorArray=new Mr,c.colorArray.resize(v.count);const b=Lh(t,v),E=1/65535,C=c.colorArray.float32;for(let M=0;M<4*b.length;++M)C[M]=b[M]*E}else tt(`glTF color buffer parsing for accessor ${JSON.stringify(v)} is not supported`)}if(void 0!==a.NORMAL){c.normalArray=new hs;const v=t.json.accessors[a.NORMAL];c.normalArray.reserve(v.count);const x=Lh(t,v);for(let b=0;b<v.count;b++)c.normalArray.emplaceBack(x[3*b],x[3*b+1],x[3*b+2]);c.normalArray._trim()}if(void 0!==a.TEXCOORD_0&&n.length>0){c.texcoordArray=new Dd;const v=t.json.accessors[a.TEXCOORD_0];c.texcoordArray.reserve(v.count);const x=Lh(t,v);for(let b=0;b<v.count;b++)c.texcoordArray.emplaceBack(x[2*b],x[2*b+1]);c.texcoordArray._trim()}const _=e.material;return c.material=function(v,x){const{emissiveFactor:b=[0,0,0],alphaMode:E="OPAQUE",alphaCutoff:C=.5,normalTexture:M,occlusionTexture:T,emissiveTexture:R,doubleSided:P}=v,{baseColorFactor:I=[1,1,1,1],metallicFactor:O=1,roughnessFactor:L=1,baseColorTexture:F,metallicRoughnessTexture:N}=v.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new Pe(...I),metallicFactor:O,roughnessFactor:L,baseColorTexture:F?x[F.index]:void 0,metallicRoughnessTexture:N?x[N.index]:void 0},doubleSided:P,emissiveFactor:b,alphaMode:E,alphaCutoff:C,normalTexture:M?x[M.index]:void 0,occlusionTexture:T?x[T.index]:void 0,emissionTexture:R?x[R.index]:void 0,defined:void 0===v.defined}}(void 0!==_?t.json.materials[_]:{defined:!1},n),void 0!==a._FEATURE_RGBA4444&&(c.featureData=new Uint32Array(Lh(t,t.json.accessors[a._FEATURE_RGBA4444]).buffer)),c}function R0(e,t,n){const{matrix:s,rotation:a,translation:c,scale:u,mesh:d,extras:f,children:p}=e,g={};if(g.matrix=s||it.fromRotationTranslationScale([],a||[0,0,0,1],c||[0,0,0],u||[1,1,1]),void 0!==d){g.meshes=n[d];const _=g.anchor=[0,0];for(const v of g.meshes){const{min:x,max:b}=v.aabb;_[0]+=x[0]+b[0],_[1]+=x[1]+b[1]}_[0]=Math.floor(_[0]/g.meshes.length/2),_[1]=Math.floor(_[1]/g.meshes.length/2)}if(f&&(f.id&&(g.id=f.id),f.lights&&(g.lights=function(_){if(!_.length)return[];const v=function(M){const T=atob(M),R=new Uint8Array(T.length);for(let P=0;P<T.length;P++)R[P]=T.codePointAt(P);return R}(_),x=[],b=v.length/24,E=new Uint16Array(v.buffer),C=new Float32Array(v.buffer);for(let M=0;M<b;M++){const T=E[2*M*6]/30,R=E[2*M*6+1]/30,P=E[2*M*6+10]/100,I=C[6*M+1],O=C[6*M+2],L=C[6*M+3],F=C[6*M+4],N=L-I,B=F-O,V=Math.hypot(N,B);x.push({pos:[I+.5*N,O+.5*B,R],normal:[B/V,-N/V,0],width:V,height:T,depth:P,points:[I,O,L,F]})}return x}(f.lights))),p){const _=[];for(const v of p)_.push(R0(t.json.nodes[v],t,n));g.children=_}return g}function Cg(e){if(0===e.vertices.length||0===e.indices.length)return null;const[t,n]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let u=1;u<e.vertices.length;++u){const d=e.vertices[u];t.x=Math.min(t.x,d.x),t.y=Math.min(t.y,d.y),n.x=Math.max(n.x,d.x),n.y=Math.max(n.y,d.y)}const s=Math.ceil(Math.max(n.x-t.x,n.y-t.y)/256),a=Math.max(8,s),c=new oI(e.vertices,e.indices,a);return{vertices:e.vertices,indices:e.indices,grid:c,min:t,max:n}}function sI(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const n=t[0];if(!n||!Array.isArray(n)||0===n.length)return null;const s=[];for(const u of n){if(!Array.isArray(u)||2!==u.length)continue;const d=u[0],f=u[1];"number"==typeof d&&"number"==typeof f&&s.push(new et(d,f))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let a=0;for(let u=0;u<s.length;u++){const d=s[u],f=s[(u+1)%s.length],p=s[(u+2)%s.length];a+=(d.x-f.x)*(p.y-f.y)-(p.x-f.x)*(d.y-f.y)}a>0&&s.reverse();const c=rf(s.flatMap(u=>[u.x,u.y]),[]);return 0===c.length?null:{vertices:s,indices:c}}function aI(e){const t=[],n=[];let s=0;for(const a of e){s=t.length;const c=a.vertexArray.float32,u=a.indexArray.uint16;for(let d=0;d<a.vertexArray.length;d++)t.push(new et(c[3*d+0],c[3*d+1]));for(let d=0;d<3*a.indexArray.length;d++)n.push(u[d]+s)}if(n.length%3!=0)return null;for(let a=0;a<n.length;a+=3){const c=t[n[a+0]],u=t[n[a+1]],d=t[n[a+2]];(c.x-u.x)*(d.y-u.y)-(d.x-u.x)*(c.y-u.y)>0&&([n[a+1],n[a+2]]=[n[a+2],n[a+1]])}return{vertices:t,indices:n}}function Dg(e){const n=function(f,p){const g=[];for(const _ of f.json.meshes){const v=[];for(const x of _.primitives)v.push(IR(x,f,p));g.push(v)}return g}(e,function(f,p){const g=[],_=st.WebGL2RenderingContext;if(f.json.textures)for(const v of f.json.textures){const x={magFilter:_.LINEAR,minFilter:_.NEAREST,wrapS:_.REPEAT,wrapT:_.REPEAT};void 0!==v.sampler&&Object.assign(x,f.json.samplers[v.sampler]),g.push({image:p[v.source],sampler:x,uploaded:!1})}return g}(e,e.images)),{scenes:s,scene:a,nodes:c}=e.json,u=s?s[a||0].nodes:c,d=[];for(const f of u)d.push(R0(c[f],e,n));return function(f,p,g){const _={},v=new Set;for(let x=0;x<f.length;x++){const b=g[p[x]];if(!b.extras)continue;const E=b.extras["mapbox:footprint:version"],C=b.extras["mapbox:footprint:id"];(E||C)&&v.add(x),"1.0.0"===E&&C&&(_[C]=x)}for(let x=0;x<f.length;x++){if(v.has(x))continue;const b=f[x],E=g[p[x]];if(!E.extras)continue;let C=null;b.id in _&&(C=aI(f[_[b.id]].meshes)),C||(C=sI(E)),C&&(b.footprint=Cg(C))}if(v.size>0){const x=Array.from(v.values()).sort((b,E)=>b-E);for(let b=x.length-1;b>=0;b--)f.splice(x[b],1)}}(d,u,e.json.nodes),d}function zf(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,n=e.aabb.min[0]-1,s=e.aabb.min[1]-1,a=64/(e.aabb.max[0]-n+2),c=64/(e.aabb.max[1]-s+2);for(let u=0;u<t.length;u+=3){const d=t[u+2],f=(t[u+0]-n)*a|0,p=(t[u+1]-s)*c|0;d>e.heightmap[64*p+f]&&(e.heightmap[64*p+f]=d)}}function lI(e,t){const n={};n.indexArray=new Ai,n.indexArray.reserve(4*e.length),n.vertexArray=new hs,n.vertexArray.reserve(10*e.length),n.colorArray=new Mr,n.vertexArray.reserve(10*e.length);let s=0;for(const u of e){const d=Math.min(10,Math.max(4,1.3*u.height))*t,f=[-u.normal[1],u.normal[0],0],p=Math.min(.29,.1*u.width/u.depth),g=u.width-2*u.depth*t*(p+.01),_=G.scaleAndAdd([],u.pos,f,g/2),v=G.scaleAndAdd([],u.pos,f,-g/2),x=[_[0],_[1],_[2]+u.height],b=[v[0],v[1],v[2]+u.height],E=G.scaleAndAdd([],u.normal,f,p);G.scale(E,E,d);const C=G.scaleAndAdd([],u.normal,f,-p);G.scale(C,C,d),G.add(E,_,E),G.add(C,v,C),_[2]+=.1,v[2]+=.1,n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(C[0],C[1],C[2]),n.vertexArray.emplaceBack(_[0],_[1],_[2]),n.vertexArray.emplaceBack(v[0],v[1],v[2]),n.vertexArray.emplaceBack(x[0],x[1],x[2]),n.vertexArray.emplaceBack(b[0],b[1],b[2]),n.vertexArray.emplaceBack(_[0],_[1],_[2]),n.vertexArray.emplaceBack(v[0],v[1],v[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(C[0],C[1],C[2]);const M=g/d/2;n.colorArray.emplaceBack(-M-p,-1,M,.8),n.colorArray.emplaceBack(M+p,-1,M,.8),n.colorArray.emplaceBack(-M,0,M,1.3),n.colorArray.emplaceBack(M,0,M,1.3),n.colorArray.emplaceBack(M+p,-.8,M,.7),n.colorArray.emplaceBack(M+p,-.8,M,.7),n.colorArray.emplaceBack(0,0,M,1.3),n.colorArray.emplaceBack(0,0,M,1.3),n.colorArray.emplaceBack(M+p,-1.2,M,.8),n.colorArray.emplaceBack(M+p,-1.2,M,.8),n.indexArray.emplaceBack(6+s,4+s,8+s),n.indexArray.emplaceBack(7+s,9+s,5+s),n.indexArray.emplaceBack(0+s,1+s,2+s),n.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const a={defined:!0,emissiveFactor:[0,0,0]},c={};return c.baseColorFactor=Pe.white,a.pbrMetallicRoughness=c,n.material=a,n.aabb=new qn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}Xt(oI,"TriangleGridIndex");const P0={vector:D0,raster:vg,"raster-dem":class extends vg{constructor(e,t,n,s){super(e,t,n,s),this.type="raster-dem",this.maxzoom=22,this._options=qt({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(e,t){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function s(a,c){a&&(e.state="errored",t(a)),c&&(e.dem=c,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",t(null))}e.request=Ie(this.map._requestManager.transformRequest(n,pt.Tile),function(a,c,u,d){if(delete e.request,e.aborted)e.state="unloaded",t(null);else if(a)e.state="errored",t(a);else if(c){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:u,expires:d});const p=st.ImageBitmap&&c instanceof st.ImageBitmap&&x_(),g=1-(c.width-((f=c.width)<=1?1:Math.pow(2,Math.floor(Math.log(f)/Math.LN2))))/2;g<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const _=p?c:xe.getImageData(c,g),v={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:_,encoding:this.encoding,padding:g};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",v,s.bind(this),void 0,!0))}var f}.bind(this))}_getNeighboringTiles(e){const t=e.canonical,n=Math.pow(2,t.z),s=(t.x-1+n)%n,a=0===t.x?e.wrap-1:e.wrap,c=(t.x+1+n)%n,u=t.x+1===n?e.wrap+1:e.wrap,d={};return d[new nn(e.overscaledZ,a,t.z,s,t.y).key]={backfilled:!1},d[new nn(e.overscaledZ,u,t.z,c,t.y).key]={backfilled:!1},t.y>0&&(d[new nn(e.overscaledZ,a,t.z,s,t.y-1).key]={backfilled:!1},d[new nn(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},d[new nn(e.overscaledZ,u,t.z,c,t.y-1).key]={backfilled:!1}),t.y+1<n&&(d[new nn(e.overscaledZ,a,t.z,s,t.y+1).key]={backfilled:!1},d[new nn(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},d[new nn(e.overscaledZ,u,t.z,c,t.y+1).key]={backfilled:!1}),d}},geojson:class extends Be{constructor(e,t,n,s){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(s),this._data=t.data,this._options=qt({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const a=ut/this.tileSize;this.workerOptions=qt({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*a,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*a,extent:ut,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:ut,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*a,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,n,s){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:n},s),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Dt("dataloading",{dataType:"source"})),this._loaded=!1;const e=qt({},this.workerOptions);e.scope=this.scope;const t=this._data;"string"==typeof t?(e.request=this.map._requestManager.transformRequest(xe.resolveURL(t),pt.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,(n,s)=>{if(this._loaded=!0,this._pendingLoad=null,n)this.fire(new zt(n));else{const a={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&s&&s.resourceTiming&&s.resourceTiming[this.id]&&(a.resourceTiming=s.resourceTiming[this.id]),this.fire(new Dt("data",a)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(e,t){const n=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const s={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:xe.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};e.request=this.actor.send(n,s,(a,c)=>(delete e.request,e.destroy(),e.aborted?t(null):a?t(a):(e.loadVectorData(c,this.map.painter,"reloadTile"===n),t(null))),void 0,"loadTile"===n)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return qt({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Wo{constructor(e,t,n,s){super(e,t,n,s),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,pt.Source).url);!function(t,n){const s=st.document.createElement("video");s.muted=!0,s.onloadstart=function(){n(null,s)};for(let a=0;a<t.length;a++){const c=st.document.createElement("source");jt(t[a])||(s.crossOrigin="Anonymous"),c.src=t[a],s.appendChild(c)}}(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new zt(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const t=this.video.seekable;e<t.start(0)||e>t.end(0)?this.fire(new zt(new Yt(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,t=e.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new Qn(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Wo,model:class extends Be{constructor(e,t,n,s){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const e=[];for(const t in this._options.models){const n=this._options.models[t],s=eC(this.map._requestManager.transformRequest(n.uri,pt.Model).url).then(a=>{if(!a)return;const c=Dg(a),u=new za(t,n.position,n.orientation,c);u.computeBoundsAndApplyParent(),this.models.push(u)}).catch(a=>{this.fire(new zt(new Error(`Could not load model ${t} from ${n.uri}: ${a.message}`)))});e.push(s)}return Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new Dt("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new zt(new Error(`Could not load models: ${t.message}`)))})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends Be{constructor(e,t,n,s){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(s)}onAdd(e){this.map=e,this.load()}load(e){this._loaded=!1,this.fire(new Dt("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=zl(this._options,this.map._requestManager,t,n,(s,a)=>{this._tileJSONRequest=null,this._loaded=!0,s?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new zt(s))):a&&(qt(this,a),a.bounds&&(this.tileBounds=new _g(a.bounds,this.minzoom,this.maxzoom)),Ka(a.tiles,this.map._requestManager._customAccessToken),this.fire(new Dt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Dt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(s)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(e,t){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),s={request:this.map._requestManager.transformRequest(n,pt.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&"expired"!==e.state)if("loading"===e.state)e.reloadCallback=t;else{if(e.buckets){const c=Object.values(e.buckets);for(const u of c)u.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",s,a.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",s,a.bind(this),void 0,!0);function a(c,u){return e.aborted?t(null):c&&404!==c.status?t(c):(u&&(u.resourceTiming&&(e.resourceTiming=u.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(u),e.buckets={...e.buckets,...u.buckets}),e.state="loaded",void t(null))}}serialize(){return qt({},this._options)}},canvas:class extends Wo{constructor(e,t,n,s){super(e,t,n,s),t.coordinates?Array.isArray(t.coordinates)&&4===t.coordinates.length&&!t.coordinates.some(a=>!Array.isArray(a)||2!==a.length||a.some(c=>"number"!=typeof c))||this.fire(new zt(new Yt(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new zt(new Yt(`sources.${e}`,null,'missing required property "coordinates"'))),t.animate&&"boolean"!=typeof t.animate&&this.fire(new zt(new Yt(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),t.canvas?"string"==typeof t.canvas||t.canvas instanceof st.HTMLCanvasElement||this.fire(new zt(new Yt(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new zt(new Yt(`sources.${e}`,null,'missing required property "canvas"'))),this.options=t,this.animate=void 0===t.animate||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof st.HTMLCanvasElement?this.options.canvas:st.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new zt(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const t=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof ag||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Qn(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends Be{constructor(e,t,n,s){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(s),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new zt(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new zt(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new _g(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),qt(this,Or(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return Or(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Dt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Dt("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new Dt("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:n,z:s}=e.canonical;return this._implementation.hasTile({x:t,y:n,z:s})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:n,y:s,z:a}=e.tileID.canonical,c=new st.AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:n,y:s,z:a},{signal:c.signal})).then(function(u){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===u?(e.state="errored",t(null)):null===u?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):(d=u)instanceof st.ImageData||d instanceof st.HTMLCanvasElement||d instanceof st.ImageBitmap||d instanceof st.HTMLImageElement?(this.loadTileData(e,u),e.state="loaded",void t(null)):(e.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var d}.bind(this)).catch(u=>{20!==u.code&&(e.state="errored",t(u))}),e.request.cancel=()=>c.abort()}loadTileData(e,t){e.setTexture(t,this._map.painter)}unloadTile(e,t){if(e.texture&&e.texture instanceof Qn?(e.destroy(!0),e.texture&&e.texture instanceof Qn&&this._map.painter.saveTileTexture(e.texture)):e.destroy(),this._implementation.unloadTile){const{x:n,y:s,z:a}=e.tileID.canonical;this._implementation.unloadTile({x:n,y:s,z:a})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){const e=cr(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new Dt("data",{dataType:"source",sourceDataType:"content"}))}}},O0=function(e,t,n,s){const a=new P0[t.type](e,t,n,s);if(a.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${a.id}`);return Bi(["load","abort","unload","serialize","prepare"],a),a};function cI(e,t){const n=it.identity([]);return it.scale(n,n,[.5*e.width,.5*-e.height,1]),it.translate(n,n,[1,-1,0]),it.multiply(n,n,e.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(n)}function AR(e,t,n,s,a,c,u,d=!1){const f=e.tilesIn(s,u,d);f.sort(k0);const p=[];for(const _ of f)p.push({wrappedTileID:_.tile.tileID.wrapped().key,queryResults:_.tile.queryRenderedFeatures(t,n,e._state,_,a,c,cI(e.transform,_.tile.tileID),d)});const g=function(_){const v={},x={};for(const b of _){const E=b.queryResults,C=b.wrappedTileID,M=x[C]=x[C]||{};for(const T in E){const R=E[T],P=M[T]=M[T]||{},I=v[T]=v[T]||[];for(const O of R)P[O.featureIndex]||(P[O.featureIndex]=!0,I.push(O))}}return v}(p);for(const _ in g)g[_].forEach(v=>{const x=v.feature,b=x.layer;b&&"background"!==b.type&&"sky"!==b.type&&"slot"!==b.type&&(x.source=b.source,b["source-layer"]&&(x.sourceLayer=b["source-layer"]),x.state=void 0!==x.id?e.getFeatureState(b["source-layer"],x.id):{})});return g}function uI(e,t){const n=e.getRenderableIds().map(c=>e.getTileByID(c)),s=[],a={};for(let c=0;c<n.length;c++){const u=n[c],d=u.tileID.canonical.key;a[d]||(a[d]=!0,u.querySourceFeatures(s,t))}return s}function k0(e,t){const n=e.tileID,s=t.tileID;return n.overscaledZ-s.overscaledZ||n.canonical.y-s.canonical.y||n.wrap-s.wrap||n.canonical.x-s.canonical.x}class hI{constructor(t){this.style=t}processLayersChanged(){this.layers=[];for(const t in this.style._mergedLayers){const n=this.style._mergedLayers[t];if("fill-extrusion"===n.type)this.layers.push(n);else if("model"===n.type){const s=this.style.getLayerSource(n);s&&"batched-model"===s.type&&this.layers.push(n)}}}updateZOffset(t,n){this.currentBuildingBuckets=[];for(let a=0;a<this.layers.length;++a){const c=this.layers[a],u=this.style.getLayerSourceCache(c);let d=1;"fill-extrusion"===c.type&&(d=c.paint.get("fill-extrusion-opacity")>0?c.paint.get("fill-extrusion-vertical-scale"):0);let f=u?u.getTile(n):null;if(!f&&u&&n.canonical.z>u.getSource().minzoom){let p=n.scaledTo(Math.min(u.getSource().maxzoom,n.overscaledZ-1));for(;p.overscaledZ>=u.getSource().minzoom&&(f=u.getTile(p),!f&&0!==p.overscaledZ);)p=p.scaledTo(p.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:f?f.getBucket(c):null,tileID:f?f.tileID:n,verticalScale:d})}t.hasAnyZOffset=!1;let s=!1;for(let a=0;a<t.symbolInstances.length;a++){const c=t.symbolInstances.get(a),u=c.zOffset,d=this._getHeightAtTileOffset(n,c.tileAnchorX,c.tileAnchorY);c.zOffset=-1!==d?d:u,s||u===c.zOffset||(s=!0),t.hasAnyZOffset||0===c.zOffset||(t.hasAnyZOffset=!0)}s&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,s,a){let c=n,u=s;if(t.canonical.z!==a.canonical.z){const d=a.canonical,f=1/(1<<t.canonical.z-d.z);c=(n+t.canonical.x*ut)*f-d.x*ut|0,u=(s+t.canonical.y*ut)*f-d.y*ut|0}return{tileX:c,tileY:u}}_getHeightAtTileOffset(t,n,s){let a;for(let c=0;c<this.layers.length;++c){if("fill-extrusion"!==this.layers[c].type)continue;const{bucket:u,tileID:d,verticalScale:f}=this.currentBuildingBuckets[c];if(!u)continue;const{tileX:p,tileY:g}=this._mapCoordToOverlappingTile(t,n,s,d),_=u.getHeightAtTileCoord(p,g);if(_&&void 0!==_.height){if(!_.hidden)return _.height*f;a=_.height}}for(let c=0;c<this.layers.length;++c){if("model"!==this.layers[c].type)continue;const{bucket:u,tileID:d}=this.currentBuildingBuckets[c];if(!u)continue;const{tileX:f,tileY:p}=this._mapCoordToOverlappingTile(t,n,s,d),g=u.getHeightAtTileCoord(f,p);if(g&&!g.hidden)return void 0===g.height&&void 0!==a?Math.min(g.maxHeight,a)*g.verticalScale:(g.height||0)*g.verticalScale}return-1}}var nC=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Bf(e,t){const n={};for(const s in e)"ref"!==s&&(n[s]=e[s]);return nC.forEach(s=>{s in t&&(n[s]=t[s])}),n}function iC(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=Bf(e[n],t[e[n].ref]));return e}const cn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function rC(e,t,n){n.push({command:cn.addSource,args:[e,t[e]]})}function L0(e,t,n){t.push({command:cn.removeSource,args:[e]}),n[e]=!0}function dI(e,t,n,s){L0(e,n,s),rC(e,t,n)}function oC(e,t,n){let s;for(s in e[n])if(e[n].hasOwnProperty(s)&&"data"!==s&&!Xe(e[n][s],t[n][s]))return!1;for(s in t[n])if(t[n].hasOwnProperty(s)&&"data"!==s&&!Xe(e[n][s],t[n][s]))return!1;return!0}function Mg(e,t,n,s,a,c){let u;for(u in t=t||{},e=e||{})e.hasOwnProperty(u)&&(Xe(e[u],t[u])||n.push({command:c,args:[s,u,t[u],a]}));for(u in t)t.hasOwnProperty(u)&&!e.hasOwnProperty(u)&&(Xe(e[u],t[u])||n.push({command:c,args:[s,u,t[u],a]}))}function Fh(e){return e.id}function Tg(e,t){return e[t.id]=t,e}class sC{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let s=1;s<this.points.length;s++)this._distances[s]=this._distances[s-1]+this.points[s].dist(this.points[s-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=Qt(t,0,1);let n=1,s=this._distances[n];const a=t*this.paddedLength+this.padding;for(;s<a&&n<this._distances.length;)s=this._distances[++n];const c=n-1,u=this._distances[c],d=s-u,f=d>0?(a-u)/d:0;return this.points[c].mult(1-f).add(this.points[n].mult(f))}}class F0{constructor(t,n,s){const a=this.boxCells=[],c=this.circleCells=[];this.xCellCount=Math.ceil(t/s),this.yCellCount=Math.ceil(n/s);for(let u=0;u<this.xCellCount*this.yCellCount;u++)a.push([]),c.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,s,a,c){this._forEachCell(n,s,a,c,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(c)}insertCircle(t,n,s,a){this._forEachCell(n-a,s-a,n+a,s+a,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(s),this.circles.push(a)}_insertBoxCell(t,n,s,a,c,u){this.boxCells[c].push(u)}_insertCircleCell(t,n,s,a,c,u){this.circleCells[c].push(u)}_query(t,n,s,a,c,u){if(s<0||t>this.width||a<0||n>this.height)return!c&&[];const d=[];if(t<=0&&n<=0&&this.width<=s&&this.height<=a){if(c)return!0;for(let f=0;f<this.boxKeys.length;f++)d.push({key:this.boxKeys[f],x1:this.bboxes[4*f],y1:this.bboxes[4*f+1],x2:this.bboxes[4*f+2],y2:this.bboxes[4*f+3]});for(let f=0;f<this.circleKeys.length;f++){const p=this.circles[3*f],g=this.circles[3*f+1],_=this.circles[3*f+2];d.push({key:this.circleKeys[f],x1:p-_,y1:g-_,x2:p+_,y2:g+_})}return u?d.filter(u):d}return this._forEachCell(t,n,s,a,this._queryCell,d,{hitTest:c,seenUids:{box:{},circle:{}}},u),c?d.length>0:d}_queryCircle(t,n,s,a,c){const u=t-s,d=t+s,f=n-s,p=n+s;if(d<0||u>this.width||p<0||f>this.height)return!a&&[];const g=[];return this._forEachCell(u,f,d,p,this._queryCellCircle,g,{hitTest:a,circle:{x:t,y:n,radius:s},seenUids:{box:{},circle:{}}},c),a?g.length>0:g}query(t,n,s,a,c){return this._query(t,n,s,a,!1,c)}hitTest(t,n,s,a,c){return this._query(t,n,s,a,!0,c)}hitTestCircle(t,n,s,a){return this._queryCircle(t,n,s,!0,a)}_queryCell(t,n,s,a,c,u,d,f){const p=d.seenUids,g=this.boxCells[c];if(null!==g){const v=this.bboxes;for(const x of g)if(!p.box[x]){p.box[x]=!0;const b=4*x;if(t<=v[b+2]&&n<=v[b+3]&&s>=v[b+0]&&a>=v[b+1]&&(!f||f(this.boxKeys[x]))){if(d.hitTest)return u.push(!0),!0;u.push({key:this.boxKeys[x],x1:v[b],y1:v[b+1],x2:v[b+2],y2:v[b+3]})}}}const _=this.circleCells[c];if(null!==_){const v=this.circles;for(const x of _)if(!p.circle[x]){p.circle[x]=!0;const b=3*x;if(this._circleAndRectCollide(v[b],v[b+1],v[b+2],t,n,s,a)&&(!f||f(this.circleKeys[x]))){if(d.hitTest)return u.push(!0),!0;{const E=v[b],C=v[b+1],M=v[b+2];u.push({key:this.circleKeys[x],x1:E-M,y1:C-M,x2:E+M,y2:C+M})}}}}}_queryCellCircle(t,n,s,a,c,u,d,f){const p=d.circle,g=d.seenUids,_=this.boxCells[c];if(null!==_){const x=this.bboxes;for(const b of _)if(!g.box[b]){g.box[b]=!0;const E=4*b;if(this._circleAndRectCollide(p.x,p.y,p.radius,x[E+0],x[E+1],x[E+2],x[E+3])&&(!f||f(this.boxKeys[b])))return u.push(!0),!0}}const v=this.circleCells[c];if(null!==v){const x=this.circles;for(const b of v)if(!g.circle[b]){g.circle[b]=!0;const E=3*b;if(this._circlesCollide(x[E],x[E+1],x[E+2],p.x,p.y,p.radius)&&(!f||f(this.circleKeys[b])))return u.push(!0),!0}}}_forEachCell(t,n,s,a,c,u,d,f){const p=this._convertToXCellCoord(t),g=this._convertToYCellCoord(n),_=this._convertToXCellCoord(s),v=this._convertToYCellCoord(a);for(let x=p;x<=_;x++)for(let b=g;b<=v;b++)if(c.call(this,t,n,s,a,this.xCellCount*b+x,u,d,f))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,s,a,c,u){const d=a-t,f=c-n,p=s+u;return p*p>d*d+f*f}_circleAndRectCollide(t,n,s,a,c,u,d){const f=(u-a)/2,p=Math.abs(t-(a+f));if(p>f+s)return!1;const g=(d-c)/2,_=Math.abs(n-(c+g));if(_>g+s)return!1;if(p<=f||_<=g)return!0;const v=p-f,x=_-g;return v*v+x*x<=s*s}}const ia=100;class fI{constructor(t,n,s=new F0(t.width+200,t.height+200,25),a=new F0(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=a,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ia,this.screenBottomBoundary=t.height+ia,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=n}placeCollisionBox(t,n,s,a,c,u,d,f){let p=s.projectedAnchorX,g=s.projectedAnchorY,_=s.projectedAnchorZ;const v=s.elevation,x=s.tileID,b=t.getProjection();if(v&&x){const[O,L,F]=b.upVector(x.canonical,s.tileAnchorX,s.tileAnchorY),N=b.upVectorScale(x.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;p+=O*v*N,g+=L*v*N,_+=F*v*N}const E=this.projectAndGetPerspectiveRatio(d,p,g,_,s.tileID,"globe"===b.name||!!v||this.transform.pitch>0,b),C=u*E.perspectiveRatio,M=(s.x1*n+a.x-s.padding)*C+E.point.x,T=(s.y1*n+a.y-s.padding)*C+E.point.y,R=(s.x2*n+a.x+s.padding)*C+E.point.x,P=(s.y2*n+a.y+s.padding)*C+E.point.y,I=E.perspectiveRatio<=.55||E.occluded;return!this.isInsideGrid(M,T,R,P)||!c&&this.grid.hitTest(M,T,R,P,f)||I?{box:[],offscreen:!1,occluded:E.occluded}:{box:[M,T,R,P],offscreen:this.isOffscreen(M,T,R,P),occluded:!1}}placeCollisionCircles(t,n,s,a,c,u,d,f,p,g,_,v,x,b,E){const C=[],M=this.transform.elevation,T=t.getProjection(),R=M?M.getAtTileOffsetFunc(E,this.transform.center.lat,this.transform.worldSize,T):null,P=new et(s.tileAnchorX,s.tileAnchorY);let{x:I,y:O,z:L}=T.projectTilePoint(P.x,P.y,E.canonical);if(R){const[nt,Y,K]=R(P);I+=nt,O+=Y,L+=K}const F="globe"===T.name,N=this.projectAndGetPerspectiveRatio(d,I,O,L,E,F||!!M||this.transform.pitch>0,T),{perspectiveRatio:B}=N,V=(_?u/B:u*B)/Yi,U=Zo(I,O,L,f),q=N.signedDistanceFromCamera>0?Xv(V,c,s.lineOffsetX*V,s.lineOffsetY*V,!1,U,P,s,a,f,{},M&&!_?R:null,_&&!!M,T,E,_):null;let j=!1,X=!1,Q=!0;if(q&&!N.occluded){const nt=.5*x*B+b,Y=new et(-100,-100),K=new et(this.screenRightBoundary,this.screenBottomBoundary),ot=new sC,{first:at,last:lt}=q,dt=at.path.length;let ft=[];for(let yt=dt-1;yt>=1;yt--)ft.push(at.path[yt]);for(let yt=1;yt<lt.path.length;yt++)ft.push(lt.path[yt]);const gt=2.5*nt;p&&(ft=ft.map(([yt,Ot,Lt],Ut)=>(R&&!F&&(Lt=R(Ut<dt-1?at.tilePath[dt-1-Ut]:lt.tilePath[Ut-dt+2])[2]),Zo(yt,Ot,Lt,p))),ft.some(yt=>yt[3]<=0)&&(ft=[]));let ht=[];if(ft.length>0){let yt=1/0,Ot=-1/0,Lt=1/0,Ut=-1/0;for(const Gt of ft)yt=Math.min(yt,Gt[0]),Lt=Math.min(Lt,Gt[1]),Ot=Math.max(Ot,Gt[0]),Ut=Math.max(Ut,Gt[1]);Ot>=Y.x&&yt<=K.x&&Ut>=Y.y&&Lt<=K.y&&(ht=[ft.map(Gt=>new et(Gt[0],Gt[1]))],(yt<Y.x||Ot>K.x||Lt<Y.y||Ut>K.y)&&(ht=fS(ht,Y.x,Y.y,K.x,K.y)))}for(const yt of ht){ot.reset(yt,.25*nt);let Ot=0;Ot=ot.length<=.5*nt?1:Math.ceil(ot.paddedLength/gt)+1;for(let Lt=0;Lt<Ot;Lt++){const Ut=Lt/Math.max(Ot-1,1),Gt=ot.lerp(Ut),me=Gt.x+ia,ie=Gt.y+ia;C.push(me,ie,nt,0);const Je=me-nt,$e=ie-nt,pe=me+nt,ue=ie+nt;if(Q=Q&&this.isOffscreen(Je,$e,pe,ue),X=X||this.isInsideGrid(Je,$e,pe,ue),!n&&this.grid.hitTestCircle(me,ie,nt,v)&&(j=!0,!g))return{circles:[],offscreen:!1,collisionDetected:j,occluded:!1}}}}return{circles:!g&&j||!X?[]:C,offscreen:Q,collisionDetected:j,occluded:N.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let s=1/0,a=1/0,c=-1/0,u=-1/0;for(const g of t){const _=new et(g.x+ia,g.y+ia);s=Math.min(s,_.x),a=Math.min(a,_.y),c=Math.max(c,_.x),u=Math.max(u,_.y),n.push(_)}const d=this.grid.query(s,a,c,u).concat(this.ignoredGrid.query(s,a,c,u)),f={},p={};for(const g of d){const _=g.key;void 0===f[_.bucketInstanceId]&&(f[_.bucketInstanceId]={}),f[_.bucketInstanceId][_.featureIndex]||Yy(n,[new et(g.x1,g.y1),new et(g.x2,g.y1),new et(g.x2,g.y2),new et(g.x1,g.y2)])&&(f[_.bucketInstanceId][_.featureIndex]=!0,void 0===p[_.bucketInstanceId]&&(p[_.bucketInstanceId]=[]),p[_.bucketInstanceId].push(_.featureIndex))}return p}insertCollisionBox(t,n,s,a,c){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:s,featureIndex:a,collisionGroupID:c},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,s,a,c){const u=n?this.ignoredGrid:this.grid,d={bucketInstanceId:s,featureIndex:a,collisionGroupID:c};for(let f=0;f<t.length;f+=4)u.insertCircle(d,t[f],t[f+1],t[f+2])}projectAndGetPerspectiveRatio(t,n,s,a,c,u,d){const f=[n,s,a,1];let p=!1;a||this.transform.pitch>0?(mn.transformMat4(f,f,t),this.fogState&&c&&"globe"!==d.name&&(p=function(v,x,b,E,C,M){const T=M.calculateFogTileMatrix(C),R=[x,b,E];return G.transformMat4(R,R,T),Rf(v,G.length(R),M.pitch,M._fov)}(this.fogState,n,s,a,c.toUnwrapped(),this.transform)>.9)):Kv(f,f,t);const g=f[3];return{point:new et((f[0]/g+1)/2*this.transform.width+ia,(-f[1]/g+1)/2*this.transform.height+ia),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(d)/g*.5,1.5),signedDistanceFromCamera:g,occluded:u&&f[2]>g||p}}isOffscreen(t,n,s,a){return s<ia||t>=this.screenRightBoundary||a<ia||n>this.screenBottomBoundary}isInsideGrid(t,n,s,a){return s>=0&&t<this.gridRightBoundary&&a>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=it.identity([]);return it.translate(t,t,[-100,-100,0]),t}}function N0(e,t,n){const s=t.createTileMatrix(e,e.worldSize,n.toUnwrapped());return it.multiply(new Float32Array(16),e.projMatrix,s)}function z0(e,t,n){if(t.projection.name===n.projection.name)return e.projMatrix;const s=n.clone();return s.setProjection(t.projection),N0(s,t.getProjection(),e)}function B0(e,t,n){return t.name===n.projection.name?e.projMatrix:N0(n,t,e)}class j0{constructor(t,n,s,a){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):a&&s?1:0,this.placed=s}isHidden(){return 0===this.opacity&&!this.placed}}class jf{constructor(t,n,s,a,c,u=!1){this.text=new j0(t?t.text:null,n,s,c),this.icon=new j0(t?t.icon:null,n,a,c),this.clipped=u}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class V0{constructor(t,n,s,a=!1){this.text=t,this.icon=n,this.skipFade=s,this.clipped=a}}class pI{constructor(){this.invProjMatrix=it.create(),this.viewportMatrix=it.create(),this.circles=[]}}class mI{constructor(t,n,s,a,c){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=s,this.bucketIndex=a,this.tileID=c}}class gI{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:s=>s.collisionGroupID===n}}return this.collisionGroups[t]}}function aC(e,t,n,s,a){const{horizontalAlign:c,verticalAlign:u}=uf(e),d=-(c-.5)*t,f=-(u-.5)*n,p=ff(e,s);return new et(d+p[0]*a,f+p[1]*a)}function U0(e,t,n,s,a){const c=new et(e,t);return n&&c._rotate(s?a:-a),c}class _I{constructor(t,n,s,a,c,u){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new fI(this.transform,c),this.buildingIndex=u,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new gI(s),this.collisionCircleArrays={},this.prevPlacement=a,a&&(a.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,s,a){const c=s.getBucket(n),u=s.latestFeatureIndex;if(!c||!u||n.fqid!==c.layerIds[0])return;const d=c.layers[0].layout,f=s.collisionBoxArray,p=Math.pow(2,this.transform.zoom-s.tileID.overscaledZ),g=s.tileSize/ut,_=s.tileID.toUnwrapped();this.transform.setProjection(c.projection);const v=(x=s.tileID,b=c.getProjection(),E=this.transform,b.name===this.projection?E.calculateProjMatrix(x.toUnwrapped()):N0(E,b,x));var x,b,E;const C="map"===d.get("text-pitch-alignment"),M="map"===d.get("text-rotation-alignment");n.compileFilter();const T=n.dynamicFilter(),R=n.dynamicFilterNeedsFeature(),P=this.transform.calculatePixelsToTileUnitsMatrix(s),I=Yv(v,s.tileID.canonical,C,M,this.transform,c.getProjection(),P);let O=null;if(C){const N=Na(v,s.tileID.canonical,C,M,this.transform,c.getProjection(),P);O=it.multiply([],this.transform.labelPlaneMatrix,N)}let L=null;T&&s.latestFeatureIndex&&(L={unwrappedTileID:_,dynamicFilter:T,dynamicFilterNeedsFeature:R,featureIndex:s.latestFeatureIndex}),this.retainedQueryData[c.bucketInstanceId]=new mI(c.bucketInstanceId,u,c.sourceLayerIndex,c.index,s.tileID);const F={bucket:c,layout:d,posMatrix:v,textLabelPlaneMatrix:I,labelToScreenMatrix:O,clippingData:L,scale:p,textPixelRatio:g,holdingForFade:s.holdingForFade(),collisionBoxArray:f,partiallyEvaluatedTextSize:vs(c.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:vs(c.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(c.sourceID)};if(a)for(const N of c.sortKeyRanges){const{sortKey:B,symbolInstanceStart:V,symbolInstanceEnd:U}=N;t.push({sortKey:B,symbolInstanceStart:V,symbolInstanceEnd:U,parameters:F})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:c.symbolInstances.length,parameters:F})}attemptAnchorPlacement(t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C,M,T){const{textOffset0:R,textOffset1:P,crossTileID:I}=v,O=[R,P],L=aC(t,s,a,O,c),F=this.collisionIndex.placeCollisionBox(b,c,n,U0(L.x,L.y,u,d,this.transform.angle),_,f,p,g.predicate);if(C){const N=b.getSymbolInstanceIconSize(T,this.transform.zoom,v.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(b,N,C,U0(L.x,L.y,u,d,this.transform.angle),_,f,p,g.predicate).box.length)return}if(F.box.length>0){let N;return this.prevPlacement&&this.prevPlacement.variableOffsets[I]&&this.prevPlacement.placements[I]&&this.prevPlacement.placements[I].text&&(N=this.prevPlacement.variableOffsets[I].anchor),this.variableOffsets[I]={textOffset:O,width:s,height:a,anchor:t,textScale:c,prevAnchor:N},this.markUsedJustification(b,t,v,E),b.allowVerticalPlacement&&(this.markUsedOrientation(b,E,v),this.placedOrientations[I]=E),{shift:L,placedGlyphBoxes:F}}}placeLayerBucketPart(t,n,s,a){const{bucket:c,layout:u,posMatrix:d,textLabelPlaneMatrix:f,labelToScreenMatrix:p,clippingData:g,textPixelRatio:_,holdingForFade:v,collisionBoxArray:x,partiallyEvaluatedTextSize:b,partiallyEvaluatedIconSize:E,collisionGroup:C}=t.parameters,M=u.get("text-optional"),T=u.get("icon-optional"),R=u.get("text-allow-overlap"),P=u.get("icon-allow-overlap"),I="map"===u.get("text-rotation-alignment"),O="map"===u.get("text-pitch-alignment"),L="viewport-y"===u.get("symbol-z-order"),F=u.get("symbol-z-elevate");this.transform.setProjection(c.projection);let N=R&&(P||!c.hasIconData()||T),B=P&&(R||!c.hasTextData()||M);!c.collisionArrays&&x&&c.deserializeCollisionBoxes(x),s&&a&&c.updateCollisionDebugBuffers(this.transform.zoom,x);const V=(U,q,j)=>{const{crossTileID:X,numVerticalGlyphVertices:Q}=U;if(g){const pe={zoom:this.transform.zoom,pitch:this.transform.pitch};let ue=null;if(g.dynamicFilterNeedsFeature){const oe=this.retainedQueryData[c.bucketInstanceId];ue=g.featureIndex.loadFeature({featureIndex:U.featureIndex,bucketIndex:oe.bucketIndex,sourceLayerIndex:oe.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,g.dynamicFilter)(pe,ue,this.retainedQueryData[c.bucketInstanceId].tileID.canonical,new et(U.tileAnchorX,U.tileAnchorY),this.transform.calculateDistanceTileData(g.unwrappedTileID)))return this.placements[X]=new V0(!1,!1,!1,!0),void n.add(X)}if(n.has(X))return;if(v)return void(this.placements[X]=new V0(!1,!1,!1));let nt=!1,Y=!1,K=!0,ot=!1,at=!1,lt=null,dt={box:null,offscreen:null,occluded:null},ft={box:null,offscreen:null,occluded:null},gt=null,ht=null,yt=null,Ot=0,Lt=0,Ut=0;j.textFeatureIndex?Ot=j.textFeatureIndex:U.useRuntimeCollisionCircles&&(Ot=U.featureIndex),j.verticalTextFeatureIndex&&(Lt=j.verticalTextFeatureIndex);const Gt=pe=>{pe.tileID=this.retainedQueryData[c.bucketInstanceId].tileID;const ue=this.transform.elevation;pe.elevation=U.zOffset+(ue?ue.getAtTileOffset(pe.tileID,pe.tileAnchorX,pe.tileAnchorY):0)},me=j.textBox;if(me){Gt(me);const pe=oe=>{let He=On.horizontal;if(c.allowVerticalPlacement&&!oe&&this.prevPlacement){const Ye=this.prevPlacement.placedOrientations[X];Ye&&(this.placedOrientations[X]=Ye,He=Ye,this.markUsedOrientation(c,He,U))}return He},ue=(oe,He)=>{if(c.allowVerticalPlacement&&Q>0&&j.verticalTextBox){for(const Ye of c.writingModes)if(Ye===On.vertical?(dt=He(),ft=dt):dt=oe(),dt&&dt.box&&dt.box.length)break}else dt=oe()};if(u.get("text-variable-anchor")){let oe=u.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[X]){const we=this.prevPlacement.variableOffsets[X];oe.indexOf(we.anchor)>0&&(oe=oe.filter(Mn=>Mn!==we.anchor),oe.unshift(we.anchor))}const He=(we,Mn,ei)=>{const gn=c.getSymbolInstanceTextSize(b,U,this.transform.zoom,q),Wn=(we.x2-we.x1)*gn+2*we.padding,ui=(we.y2-we.y1)*gn+2*we.padding,ni=U.hasIconTextFit&&!P?Mn:null;ni&&Gt(ni);let Bn={box:[],offscreen:!1,occluded:!1};const Tn=R?2*oe.length:oe.length;for(let ar=0;ar<Tn;++ar){const Ba=this.attemptAnchorPlacement(oe[ar%oe.length],we,Wn,ui,gn,I,O,_,d,C,ar>=oe.length,U,q,c,ei,ni,b,E);if(Ba&&(Bn=Ba.placedGlyphBoxes,Bn&&Bn.box&&Bn.box.length)){nt=!0,lt=Ba.shift;break}}return Bn};ue(()=>He(me,j.iconBox,On.horizontal),()=>{const we=j.verticalTextBox;return we&&Gt(we),c.allowVerticalPlacement&&!(dt&&dt.box&&dt.box.length)&&Q>0&&we?He(we,j.verticalIconBox,On.vertical):{box:null,offscreen:null,occluded:null}}),dt&&(nt=dt.box,K=dt.offscreen,ot=dt.occluded);const Ye=pe(!(!dt||!dt.box));if(!nt&&this.prevPlacement){const we=this.prevPlacement.variableOffsets[X];we&&(this.variableOffsets[X]=we,this.markUsedJustification(c,we.anchor,U,Ye))}}else{const oe=(He,Ye)=>{const we=c.getSymbolInstanceTextSize(b,U,this.transform.zoom,q),Mn=this.collisionIndex.placeCollisionBox(c,we,He,new et(0,0),R,_,d,C.predicate);return Mn&&Mn.box&&Mn.box.length&&(this.markUsedOrientation(c,Ye,U),this.placedOrientations[X]=Ye),Mn};ue(()=>oe(me,On.horizontal),()=>{const He=j.verticalTextBox;return c.allowVerticalPlacement&&Q>0&&He?(Gt(He),oe(He,On.vertical)):{box:null,offscreen:null,occluded:null}}),pe(!!(dt&&dt.box&&dt.box.length))}}if(gt=dt,nt=gt&&gt.box&&gt.box.length>0,K=gt&&gt.offscreen,ot=gt&&gt.occluded,U.useRuntimeCollisionCircles){const pe=c.text.placedSymbolArray.get(U.centerJustifiedTextSymbolIndex>=0?U.centerJustifiedTextSymbolIndex:U.verticalPlacedTextSymbolIndex),ue=lh(c.textSizeData,b,pe),oe=u.get("text-padding");ht=this.collisionIndex.placeCollisionCircles(c,R,pe,c.lineVertexArray,c.glyphOffsetArray,ue,d,f,p,s,O,C.predicate,U.collisionCircleDiameter*ue/Yi,oe,this.retainedQueryData[c.bucketInstanceId].tileID),nt=R||ht.circles.length>0&&!ht.collisionDetected,K=K&&ht.offscreen,ot=ht.occluded}if(j.iconFeatureIndex&&(Ut=j.iconFeatureIndex),j.iconBox){const pe=ue=>{Gt(ue);const oe=U.hasIconTextFit&&lt?U0(lt.x,lt.y,I,O,this.transform.angle):new et(0,0),He=c.getSymbolInstanceIconSize(E,this.transform.zoom,U.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(c,He,ue,oe,P,_,d,C.predicate)};ft&&ft.box&&ft.box.length&&j.verticalIconBox?(yt=pe(j.verticalIconBox),Y=yt.box.length>0):(yt=pe(j.iconBox),Y=yt.box.length>0),K=K&&yt.offscreen,at=yt.occluded}const ie=M||0===U.numHorizontalGlyphVertices&&0===Q,Je=T||0===U.numIconVertices;if(ie||Je?Je?ie||(Y=Y&&nt):nt=Y&&nt:Y=nt=Y&&nt,nt&&gt&&gt.box&&this.collisionIndex.insertCollisionBox(gt.box,u.get("text-ignore-placement"),c.bucketInstanceId,ft&&ft.box&&Lt?Lt:Ot,C.ID),Y&&yt&&this.collisionIndex.insertCollisionBox(yt.box,u.get("icon-ignore-placement"),c.bucketInstanceId,Ut,C.ID),ht&&(nt&&this.collisionIndex.insertCollisionCircles(ht.circles,u.get("text-ignore-placement"),c.bucketInstanceId,Ot,C.ID),s)){const pe=c.bucketInstanceId;let ue=this.collisionCircleArrays[pe];void 0===ue&&(ue=this.collisionCircleArrays[pe]=new pI);for(let oe=0;oe<ht.circles.length;oe+=4)ue.circles.push(ht.circles[oe+0]),ue.circles.push(ht.circles[oe+1]),ue.circles.push(ht.circles[oe+2]),ue.circles.push(ht.collisionDetected?1:0)}const $e="globe"!==c.projection.name;N=N&&($e||!ot),B=B&&($e||!at),this.placements[X]=new V0(nt||N,Y||B,K||c.justReloaded),n.add(X)};if(F&&this.buildingIndex&&(this.buildingIndex.updateZOffset(c,this.retainedQueryData[c.bucketInstanceId].tileID),c.updateZOffset()),L){const U=c.getSortedSymbolIndexes(this.transform.angle);for(let q=U.length-1;q>=0;--q){const j=U[q];V(c.symbolInstances.get(j),j,c.collisionArrays[j])}c.hasAnyZOffset&&tt(`${c.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(c.hasAnyZOffset){const U=c.getSortedIndexesByZOffset();for(let q=0;q<U.length;++q){const j=U[q];V(c.symbolInstances.get(j),j,c.collisionArrays[j])}}else for(let U=t.symbolInstanceStart;U<t.symbolInstanceEnd;U++)V(c.symbolInstances.get(U),U,c.collisionArrays[U]);if(s&&c.bucketInstanceId in this.collisionCircleArrays){const U=this.collisionCircleArrays[c.bucketInstanceId];it.invert(U.invProjMatrix,d),U.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(t,n,s,a){const{leftJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:u,rightJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:f,crossTileID:p}=s,g=Xm(n),_=a===On.vertical?f:"left"===g?c:"center"===g?u:"right"===g?d:-1;c>=0&&(t.text.placedSymbolArray.get(c).crossTileID=_>=0&&c!==_?0:p),u>=0&&(t.text.placedSymbolArray.get(u).crossTileID=_>=0&&u!==_?0:p),d>=0&&(t.text.placedSymbolArray.get(d).crossTileID=_>=0&&d!==_?0:p),f>=0&&(t.text.placedSymbolArray.get(f).crossTileID=_>=0&&f!==_?0:p)}markUsedOrientation(t,n,s){const a=n===On.horizontal||n===On.horizontalOnly?n:0,c=n===On.vertical?n:0,{leftJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:d,rightJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:p}=s,g=t.text.placedSymbolArray;u>=0&&(g.get(u).placedOrientation=a),d>=0&&(g.get(d).placedOrientation=a),f>=0&&(g.get(f).placedOrientation=a),p>=0&&(g.get(p).placedOrientation=c)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let s=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const a=n?n.symbolFadeChange(t):1,c=n?n.opacities:{},u=n?n.variableOffsets:{},d=n?n.placedOrientations:{};for(const f in this.placements){const p=this.placements[f],g=c[f];g?(this.opacities[f]=new jf(g,a,p.text,p.icon,null,p.clipped),s=s||p.text!==g.text.placed||p.icon!==g.icon.placed):(this.opacities[f]=new jf(null,a,p.text,p.icon,p.skipFade,p.clipped),s=s||p.text||p.icon)}for(const f in c){const p=c[f];if(!this.opacities[f]){const g=new jf(p,a,!1,!1);g.isHidden()||(this.opacities[f]=g,s=s||p.text.placed||p.icon.placed)}}for(const f in u)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=u[f]);for(const f in d)this.placedOrientations[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.placedOrientations[f]=d[f]);s?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const s=new Set;for(const a of n){const c=a.getBucket(t);c&&a.latestFeatureIndex&&t.fqid===c.layerIds[0]&&(this.updateBucketOpacities(c,s,a.collisionBoxArray),c.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(c,a.tileID),c.updateZOffset()))}}updateBucketOpacities(t,n,s){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const a=t.layers[0].layout,c=!!t.layers[0].dynamicFilter(),u=new jf(null,0,!1,!1,!0),d=a.get("text-allow-overlap"),f=a.get("icon-allow-overlap"),p=a.get("text-variable-anchor"),g="map"===a.get("text-rotation-alignment"),_="map"===a.get("text-pitch-alignment"),v=new jf(null,0,d&&(f||!t.hasIconData()||a.get("icon-optional")),f&&(d||!t.hasTextData()||a.get("text-optional")),!0);!t.collisionArrays&&s&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(s);const x=(E,C,M)=>{for(let T=0;T<C/4;T++)E.opacityVertexArray.emplaceBack(M)};let b=0;for(let E=0;E<t.symbolInstances.length;E++){const C=t.symbolInstances.get(E),{numHorizontalGlyphVertices:M,numVerticalGlyphVertices:T,crossTileID:R,numIconVertices:P}=C,I=n.has(R);let O=this.opacities[R];I?O=u:O||(O=v,this.opacities[R]=O),n.add(R);const L=M>0||T>0,F=P>0,N=this.placedOrientations[R],B=N===On.vertical,V=N===On.horizontal||N===On.horizontalOnly;if(!L&&!F||O.isHidden()||b++,L){const U=uC(O.text);x(t.text,M,B?Nh:U),x(t.text,T,V?Nh:U);const q=O.text.isHidden(),{leftJustifiedTextSymbolIndex:j,centerJustifiedTextSymbolIndex:X,rightJustifiedTextSymbolIndex:Q,verticalPlacedTextSymbolIndex:nt}=C,Y=t.text.placedSymbolArray,K=q||B?1:0;j>=0&&(Y.get(j).hidden=K),X>=0&&(Y.get(X).hidden=K),Q>=0&&(Y.get(Q).hidden=K),nt>=0&&(Y.get(nt).hidden=q||V?1:0);const ot=this.variableOffsets[R];ot&&this.markUsedJustification(t,ot.anchor,C,N);const at=this.placedOrientations[R];at&&(this.markUsedJustification(t,"left",C,at),this.markUsedOrientation(t,at,C))}if(F){const U=uC(O.icon),{placedIconSymbolIndex:q,verticalPlacedIconSymbolIndex:j}=C,X=t.icon.placedSymbolArray,Q=O.icon.isHidden()?1:0;q>=0&&(x(t.icon,P,B?Nh:U),X.get(q).hidden=Q),j>=0&&(x(t.icon,C.numVerticalIconVertices,V?Nh:U),X.get(j).hidden=Q)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const U=t.collisionArrays[E];if(U){let q=new et(0,0),j=!0;if(U.textBox||U.verticalTextBox){if(p){const Q=this.variableOffsets[R];Q?(q=aC(Q.anchor,Q.width,Q.height,Q.textOffset,Q.textScale),g&&q._rotate(_?this.transform.angle:-this.transform.angle)):j=!1}c&&(j=!O.clipped),U.textBox&&Vf(t.textCollisionBox.collisionVertexArray,O.text.placed,!j||B,q.x,q.y),U.verticalTextBox&&Vf(t.textCollisionBox.collisionVertexArray,O.text.placed,!j||V,q.x,q.y)}const X=j&&!(V||!U.verticalIconBox);U.iconBox&&Vf(t.iconCollisionBox.collisionVertexArray,O.icon.placed,X,C.hasIconTextFit?q.x:0,C.hasIconTextFit?q.y:0),U.verticalIconBox&&Vf(t.iconCollisionBox.collisionVertexArray,O.icon.placed,!X,C.hasIconTextFit?q.x:0,C.hasIconTextFit?q.y:0)}}}if(t.fullyClipped=0===b,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const E=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=E.invProjMatrix,t.placementViewportMatrix=E.viewportMatrix,t.collisionCircleArray=E.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const s=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*s>t}setStale(){this.stale=!0}}function Vf(e,t,n,s,a){e.emplaceBack(t?1:0,n?1:0,s||0,a||0),e.emplaceBack(t?1:0,n?1:0,s||0,a||0),e.emplaceBack(t?1:0,n?1:0,s||0,a||0),e.emplaceBack(t?1:0,n?1:0,s||0,a||0)}const lC=Math.pow(2,25),yI=Math.pow(2,24),vI=Math.pow(2,17),cC=Math.pow(2,16),xI=Math.pow(2,9),bI=Math.pow(2,8),wI=Math.pow(2,1);function uC(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*lC+t*yI+n*vI+t*cC+n*xI+t*bI+n*wI+t}const Nh=0;class $0{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,n,s,a,c){const u=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(u,a,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,c())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,u.sort((d,f)=>d.sortKey-f.sortKey));this._currentPartIndex<u.length;){const d=u[this._currentPartIndex];if(n.placeLayerBucketPart(d,this._seenCrossTileIDs,s,0===d.symbolInstanceStart),this._currentPartIndex++,c())return!0}return!1}}class hC{constructor(t,n,s,a,c,u,d,f,p){this.placement=new _I(t,c,u,d,f,p),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=s,this._showCollisionBoxes=a,this._done=!1}isDone(){return this._done}continuePlacement(t,n,s,a){const c=xe.now(),u=()=>{const d=xe.now()-c;return!this._forceFullPlacement&&d>2};for(;this._currentPlacementIndex>=0;){const d=n[t[this._currentPlacementIndex]],f=this.placement.collisionIndex.transform.zoom;if("symbol"===d.type&&(!d.minzoom||d.minzoom<=f)&&(!d.maxzoom||d.maxzoom>f)){const p=d,g=p.layout.get("symbol-z-elevate"),_=this._inProgressLayer=this._inProgressLayer||new $0(p),v=cr(d.source,d.scope);if(_.continuePlacement(g?a[v]:s[v],this.placement,this._showCollisionBoxes,d,u))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Sg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ig{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,s]=new Uint8Array(t,0,2);if(219!==n)throw new Error("Data does not appear to be in a KDBush format.");const a=s>>4;if(1!==a)throw new Error(`Got v${a} data when expected v1.`);const c=Sg[15&s];if(!c)throw new Error("Unrecognized array type.");const[u]=new Uint16Array(t,2,1),[d]=new Uint32Array(t,4,1);return new Ig(d,u,c,t)}constructor(t,n=64,s=Float64Array,a){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const c=Sg.indexOf(this.ArrayType),u=2*t*this.ArrayType.BYTES_PER_ELEMENT,d=t*this.IndexArrayType.BYTES_PER_ELEMENT,f=(8-d%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${s}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+d+f,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+u+d+f),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+d+f,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=n,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return H0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,s,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:u,nodeSize:d}=this,f=[0,c.length-1,0],p=[];for(;f.length;){const g=f.pop()||0,_=f.pop()||0,v=f.pop()||0;if(_-v<=d){for(let C=v;C<=_;C++){const M=u[2*C],T=u[2*C+1];M>=t&&M<=s&&T>=n&&T<=a&&p.push(c[C])}continue}const x=v+_>>1,b=u[2*x],E=u[2*x+1];b>=t&&b<=s&&E>=n&&E<=a&&p.push(c[x]),(0===g?t<=b:n<=E)&&(f.push(v),f.push(x-1),f.push(1-g)),(0===g?s>=b:a>=E)&&(f.push(x+1),f.push(_),f.push(1-g))}return p}within(t,n,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:c,nodeSize:u}=this,d=[0,a.length-1,0],f=[],p=s*s;for(;d.length;){const g=d.pop()||0,_=d.pop()||0,v=d.pop()||0;if(_-v<=u){for(let C=v;C<=_;C++)jl(c[2*C],c[2*C+1],t,n)<=p&&f.push(a[C]);continue}const x=v+_>>1,b=c[2*x],E=c[2*x+1];jl(b,E,t,n)<=p&&f.push(a[x]),(0===g?t-s<=b:n-s<=E)&&(d.push(v),d.push(x-1),d.push(1-g)),(0===g?t+s>=b:n+s>=E)&&(d.push(x+1),d.push(_),d.push(1-g))}return f}}function H0(e,t,n,s,a,c){if(a-s<=n)return;const u=s+a>>1;Ag(e,t,u,s,a,c),H0(e,t,n,s,u-1,1-c),H0(e,t,n,u+1,a,1-c)}function Ag(e,t,n,s,a,c){for(;a>s;){if(a-s>600){const p=a-s+1,g=n-s+1,_=Math.log(p),v=.5*Math.exp(2*_/3),x=.5*Math.sqrt(_*v*(p-v)/p)*(g-p/2<0?-1:1);Ag(e,t,n,Math.max(s,Math.floor(n-g*v/p+x)),Math.min(a,Math.floor(n+(p-g)*v/p+x)),c)}const u=t[2*n+c];let d=s,f=a;for(Uf(e,t,s,n),t[2*a+c]>u&&Uf(e,t,s,a);d<f;){for(Uf(e,t,d,f),d++,f--;t[2*d+c]<u;)d++;for(;t[2*f+c]>u;)f--}t[2*s+c]===u?Uf(e,t,s,f):(f++,Uf(e,t,f,a)),f<=n&&(s=f+1),n<=f&&(a=f-1)}}function Uf(e,t,n,s){G0(e,n,s),G0(t,2*n,2*s),G0(t,2*n+1,2*s+1)}function G0(e,t,n){const s=e[t];e[t]=e[n],e[n]=s}function jl(e,t,n,s){const a=e-n,c=t-s;return a*a+c*c}const Rg=512/ut/2;class EI{constructor(t,n,s){this.tileID=t,this.bucketInstanceId=s,this.index=new Ig(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const a=t.canonical.x*ut,c=t.canonical.y*ut;for(let u=0;u<n.length;u++){const{key:d,crossTileID:f,tileAnchorX:p,tileAnchorY:g}=n.get(u),_=Math.floor((a+p)*Rg),v=Math.floor((c+g)*Rg);this.index.add(_,v),this.keys.push(d),this.crossTileIDs.push(f)}this.index.finish()}findMatches(t,n,s){const a=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),c=Rg/Math.pow(2,n.canonical.z-this.tileID.canonical.z),u=n.canonical.x*ut,d=n.canonical.y*ut;for(let f=0;f<t.length;f++){const p=t.get(f);if(p.crossTileID)continue;const{key:g,tileAnchorX:_,tileAnchorY:v}=p,x=Math.floor((u+_)*c),b=Math.floor((d+v)*c),E=this.index.range(x-a,b-a,x+a,b+a);for(const C of E){const M=this.crossTileIDs[C];if(this.keys[C]===g&&!s.has(M)){s.add(M),p.crossTileID=M;break}}}}}class RR{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class q0{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(0!==n)for(const s in this.indexes){const a=this.indexes[s],c={};for(const u in a){const d=a[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),c[d.tileID.key]=d}this.indexes[s]=c}this.lng=t}addBucket(t,n,s){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let c=0;c<n.symbolInstances.length;c++)n.symbolInstances.get(c).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const a=this.usedCrossTileIDs[t.overscaledZ];for(const c in this.indexes){const u=this.indexes[c];if(Number(c)>t.overscaledZ)for(const d in u){const f=u[d];f.tileID.isChildOf(t)&&f.findMatches(n.symbolInstances,t,a)}else{const d=u[t.scaledTo(Number(c)).key];d&&d.findMatches(n.symbolInstances,t,a)}}for(let c=0;c<n.symbolInstances.length;c++){const u=n.symbolInstances.get(c);u.crossTileID||(u.crossTileID=s.generate(),a.add(u.crossTileID))}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new EI(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const s of n.crossTileIDs)this.usedCrossTileIDs[t].delete(s)}removeStaleBuckets(t){let n=!1;for(const s in this.indexes){const a=this.indexes[s];for(const c in a)t[a[c].bucketInstanceId]||(this.removeBucketCrossTileIDs(s,a[c]),delete a[c],n=!0)}return n}}class Z0{constructor(){this.layerIndexes={},this.crossTileIDs=new RR,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,s,a){let c=this.layerIndexes[t.fqid];void 0===c&&(c=this.layerIndexes[t.fqid]=new q0);let u=!1;const d={};"globe"!==a.name&&c.handleWrapJump(s);for(const f of n){const p=f.getBucket(t);p&&t.fqid===p.layerIds[0]&&(p.bucketInstanceId||(p.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(f.tileID,p,this.crossTileIDs)&&(u=!0),d[p.bucketInstanceId]=!0)}return c.removeStaleBuckets(d)&&(u=!0),u}pruneUnusedLayers(t){const n={};t.forEach(s=>{n[s]=!0});for(const s in this.layerIndexes)n[s]||delete this.layerIndexes[s]}}var dC="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",W0="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Pg="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",fC="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Y0="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Og="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(vec2 texCoord,vec2 texResolution,out vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(vec2 fxy,vec4 colorMix,float colorOffset,vec4 t00,vec4 t10,vec4 t01,vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)\n);}vec2 raTexture2D_image1_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)\n);}vec2 raTexture2D_image0_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",X0="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",K0="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Q0=[];Hf(dC,Q0);const $f={"_prelude_fog.vertex.glsl":fC,"_prelude_terrain.vertex.glsl":Pg,"_prelude_shadow.vertex.glsl":X0,"_prelude_fog.fragment.glsl":Y0,"_prelude_shadow.fragment.glsl":K0,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Og},kg={};xn("",Pg),xn(Y0,fC),xn(K0,X0),xn(Og,"");const pC=xn("\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif","\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}"),mC=dC;var gC={background:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:xn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:xn('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:xn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:xn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:xn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:xn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in vec2 v_pos;in vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;out vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#ifdef RENDER_CUTOFF\ninvariant gl_Position;\n#endif\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),fillExtrusionDepth:xn("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:xn('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:xn("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;\n#ifdef FORCE_ABS_FL_GROUND_RADIUS\nfl_ground_radius=abs(flood_light_ground_radius);\n#endif\nfloat flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:xn("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform vec4 u_tl_br;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#elif defined(PROJECTION_GLOBE_VIEW)\nin vec2 a_pos;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec2 globe_tl=vec2(u_tl_br.x,u_tl_br.y);vec2 globe_br=vec2(u_tl_br.z,u_tl_br.w);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=1.0-((mercatorY-globe_br.y)/(globe_tl.y-globe_br.y));float mercatorX=mercatorXfromLng(latLng[1]);float uvX=(mercatorX-globe_br.x)/(globe_tl.x-globe_br.x);vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);uv=vec2(uvX,uvY);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\nuv=a_texture_pos/8192.0;\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),symbolIcon:xn('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:xn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:xn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:xn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:xn('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',W0),skyboxGradient:xn('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',W0),skyboxCapture:xn("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:xn('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:xn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\ntexColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(diffuse,1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nao=(texture(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:xn("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:xn("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function Hf(e,t){const n=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let s of n)if(s=s.trim(),"#"===s[0]&&s.includes("if")&&!s.includes("endif")){s=s.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const a=s.split(" ");for(const c of a)t.includes(c)||t.push(c)}}function xn(e,t){const n=/#include\s+"([^"]+)"/g,s=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let a=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);a&&(a=a.map(p=>{const g=p.split(" ");return g[g.length-1]}),a=[...new Set(a)]);const c={},u=[],d=[];e=e.replace(n,(p,g)=>(d.push(g),"")),t=t.replace(n,(p,g)=>(u.push(g),""));let f=[...Q0];Hf(e,f),Hf(t,f);for(const p of[...u,...d])$f[p]||console.error(`Undefined include: ${p}`),kg[p]||(kg[p]=[],Hf($f[p],kg[p])),f=[...f,...kg[p]];return{fragmentSource:e=e.replace(s,(p,g,_,v,x)=>(c[x]=!0,"define"===g?`\n#ifndef HAS_UNIFORM_u_${x}\nin ${_} ${v} ${x};\n#else\nuniform ${_} ${v} u_${x};\n#endif\n`:"initialize"===g?`\n#ifdef HAS_UNIFORM_u_${x}\n    ${_} ${v} ${x} = u_${x};\n#endif\n`:"define-attribute"===g?`\n#ifdef HAS_ATTRIBUTE_a_${x}\n    in ${_} ${v} ${x};\n#endif\n`:"initialize-attribute"===g?"":void 0)),vertexSource:t=t.replace(s,(p,g,_,v,x)=>{const b="float"===v?"vec2":v,E=x.match(/color/)?"color":b;return"define-attribute-vertex-shader-only"===g?`\n#ifdef HAS_ATTRIBUTE_a_${x}\nin ${_} ${v} a_${x};\n#endif\n`:c[x]?"define"===g?`\n#ifndef HAS_UNIFORM_u_${x}\nuniform lowp float u_${x}_t;\nin ${_} ${b} a_${x};\nout ${_} ${v} ${x};\n#else\nuniform ${_} ${v} u_${x};\n#endif\n`:"initialize"===g?"vec4"===E?`\n#ifndef HAS_UNIFORM_u_${x}\n    ${x} = a_${x};\n#else\n    ${_} ${v} ${x} = u_${x};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${x}\n    ${x} = unpack_mix_${E}(a_${x}, u_${x}_t);\n#else\n    ${_} ${v} ${x} = u_${x};\n#endif\n`:"define-attribute"===g?`\n#ifdef HAS_ATTRIBUTE_a_${x}\n    in ${_} ${v} a_${x};\n    out ${_} ${v} ${x};\n#endif\n`:"initialize-attribute"===g?`\n#ifdef HAS_ATTRIBUTE_a_${x}\n    ${x} = a_${x};\n#endif\n`:void 0:"define"===g?`\n#ifndef HAS_UNIFORM_u_${x}\nuniform lowp float u_${x}_t;\nin ${_} ${b} a_${x};\n#else\nuniform ${_} ${v} u_${x};\n#endif\n`:"define-instanced"===g?"mat4"===E?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${x}0;\nin vec4 a_${x}1;\nin vec4 a_${x}2;\nin vec4 a_${x}3;\n#else\nuniform ${_} ${v} u_${x};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${_} ${b} a_${x};\n#else\nuniform ${_} ${v} u_${x};\n#endif\n`:"initialize-attribute-custom"===g?`\n#ifdef HAS_ATTRIBUTE_a_${x}\n    ${_} ${v} ${x} = a_${x};\n#endif\n`:"vec4"===E?`\n#ifndef HAS_UNIFORM_u_${x}\n    ${_} ${v} ${x} = a_${x};\n#else\n    ${_} ${v} ${x} = u_${x};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${x}\n    ${_} ${v} ${x} = unpack_mix_${E}(a_${x}, u_${x}_t);\n#else\n    ${_} ${v} ${x} = u_${x};\n#endif\n`}),staticAttributes:a,usedDefines:f,vertexIncludes:u,fragmentIncludes:d}}class _C{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,n,s,a,c,u,d,f){this.context=t;let p=this.boundPaintVertexBuffers.length!==a.length;for(let _=0;!p&&_<a.length;_++)this.boundPaintVertexBuffers[_]!==a[_]&&(p=!0);let g=this.boundDynamicVertexBuffers.length!==d.length;for(let _=0;!g&&_<d.length;_++)this.boundDynamicVertexBuffers[_]!==d[_]&&(g=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==s||p||g||this.boundIndexBuffer!==c||this.boundVertexOffset!==u)this.freshBind(n,s,a,c,u,d,f);else{t.bindVertexArrayOES.set(this.vao);for(const _ of d)_&&(_.bind(),f&&_.instanceCount&&_.setVertexAttribDivisor(t.gl,n,f));c&&c.dynamicDraw&&c.bind()}}freshBind(t,n,s,a,c,u,d){const f=t.numAttributes,p=this.context,g=p.gl;this.vao&&this.destroy(),this.vao=p.gl.createVertexArray(),p.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=s,this.boundIndexBuffer=a,this.boundVertexOffset=c,this.boundDynamicVertexBuffers=u,n.enableAttributes(g,t),n.bind(),n.setVertexAttribPointers(g,t,c);for(const _ of s)_.enableAttributes(g,t),_.bind(),_.setVertexAttribPointers(g,t,c);for(const _ of u)_&&(_.enableAttributes(g,t),_.bind(),_.setVertexAttribPointers(g,t,c),d&&_.instanceCount&&_.setVertexAttribDivisor(g,t,d));a&&a.bind(),p.currentNumAttributes=f}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function CI(e,t){const n=Math.pow(2,t.canonical.z),s=t.canonical.y;return[new We(0,s/n).toLngLat().lat,new We(0,(s+1)/n).toLngLat().lat]}function DI(e,t,n,s,a,c,u){const d=e.context,f=d.gl,p=n.hillshadeFBO;if(!p)return;e.prepareDrawTile();const g=e.isTileAffectedByFog(t),_=e.getOrCreateProgram("hillshade",{overrideFog:g});d.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,p.colorAttachment.get());const v=((C,M,T,R)=>{const P=T.paint.get("hillshade-shadow-color"),I=T.paint.get("hillshade-highlight-color"),O=T.paint.get("hillshade-accent-color"),L=T.paint.get("hillshade-emissive-strength");let F=De(T.paint.get("hillshade-illumination-direction"));if("viewport"===T.paint.get("hillshade-illumination-anchor"))F-=C.transform.angle;else if(C.style&&C.style.enable3dLights()&&C.style.directionalLight){const B=C.style.directionalLight.properties.get("direction");F=De(ne(B.x,B.y,B.z)[1])}const N=!C.options.moving;return{u_matrix:R||C.transform.calculateProjMatrix(M.tileID.toUnwrapped(),N),u_image:0,u_latrange:CI(0,M.tileID),u_light:[T.paint.get("hillshade-exaggeration"),F],u_shadow:P,u_highlight:I,u_emissive_strength:L,u_accent:O}})(e,n,s,e.terrain?t.projMatrix:null);e.uploadCommonUniforms(d,_,t.toUnwrapped());const{tileBoundsBuffer:x,tileBoundsIndexBuffer:b,tileBoundsSegments:E}=e.getTileBoundsBuffers(n);_.draw(e,f.TRIANGLES,a,c,u,ze.disabled,v,s.id,x,b,E)}function MI(e,t,n){if(!t.needsDEMTextureUpload)return;const s=e.context,a=s.gl;s.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(n.stride);const c=n.getPixels();t.demTexture?t.demTexture.update(c,{premultiply:!1}):t.demTexture=new Qn(s,c,a.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function TI(e,t,n){const s=e.context,a=s.gl;if(!t.dem)return;const c=t.dem;if(s.activeTexture.set(a.TEXTURE1),MI(e,t,c),!t.demTexture)return;t.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE);const u=c.dim;s.activeTexture.set(a.TEXTURE0);let d=t.hillshadeFBO;if(!d){const v=new Qn(s,{width:u,height:u,data:null},a.RGBA);v.bind(a.LINEAR,a.CLAMP_TO_EDGE),d=t.hillshadeFBO=s.createFramebuffer(u,u,!0,"renderbuffer"),d.colorAttachment.set(v.texture)}s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,u,u]);const{tileBoundsBuffer:f,tileBoundsIndexBuffer:p,tileBoundsSegments:g}=e.getMercatorTileBoundsBuffers(),_=[];e.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:_}).draw(e,a.TRIANGLES,de.disabled,Se.disabled,Qe.unblended,ze.disabled,((v,x)=>{const b=x.stride,E=it.create();return it.ortho(E,0,ut,-ut,0,0,1),it.translate(E,E,[0,-ut,0]),{u_matrix:E,u_image:1,u_dimension:[b,b],u_zoom:v.overscaledZ}})(t.tileID,c),n.id,f,p,g),t.needsHillshadePrepare=!1}const yC=e=>({u_matrix:new ye(e),u_image0:new Ne(e),u_skirt_height:new xt(e),u_ground_shadow_factor:new be(e)}),vC=(e,t,n)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),xC=(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(s),u_merc_matrix:n,u_zoom_transition:a,u_merc_center:c,u_image0:0,u_frustum_tl:u,u_frustum_tr:d,u_frustum_br:f,u_frustum_bl:p,u_globe_pos:g,u_globe_radius:_,u_viewport:v,u_grid_matrix:b?Float32Array.from(b):new Float32Array(9),u_skirt_height:x}),zh=(e,t)=>{if(t>0&&e.terrain&&tt("Cutoff is currently disabled on terrain"),t<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const n=e.transform,s=Math.max(Math.abs(n._zoom-(e.minCutoffZoom-1)),1),a=n.isLODDisabled(!1)?Ps(60,45,n.pitch):Ps(30,15,n.pitch),c=n._farZ-n._nearZ,u=t*n.height,d=((1-(f=a))*(.75*n.cameraToCenterDistance)+f*(n._farZ+u))*s;var f;return{shouldRenderCutoff:a<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(d-n._nearZ)/c,(d-u-n._nearZ)/c]}}};function bC(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const Bh=new class{constructor(){this.operations={}}newMorphing(e,t,n,s,a){if(e in this.operations){const c=this.operations[e];c.to.tileID.key!==n.tileID.key&&(c.queued=n)}else this.operations[e]={startTime:s,phase:0,duration:a,from:t,to:n,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const n=this.operations[t];for(n.phase=(e-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},wC={0:null,1:"TERRAIN_VERTEX_MORPHING"};function EC(e,t,n){if(0===t)return 0;const s=t<1&&514===n?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*s}function SI(e,t){const n=1<<e.z;return!t&&(0===e.x||e.x===n-1)||0===e.y||e.y===n-1}const J0=e=>({u_matrix:e});function CC(e,t,n,s,a){if(a>0){const c=xe.now(),u=(c-e.timeAdded)/a,d=t?(c-t.timeAdded)/a:-1,f=n.getSource(),p=s.coveringZoomLevel({tileSize:f.tileSize,roundZoom:f.roundZoom}),g=!t||Math.abs(t.tileID.overscaledZ-p)>Math.abs(e.tileID.overscaledZ-p),_=g&&e.refreshedUponExpiration?1:Qt(g?u:1-d,0,1);return e.refreshedUponExpiration&&u>=1&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-_}:{opacity:_,mix:0}}return{opacity:1,mix:0}}class Gf extends ws{constructor(t){const n={type:"raster-dem",maxzoom:t.transform.maxZoom},s=new b0(Ff(),null),a=O0("mock-dem",n,s,t.style);super("mock-dem",a,!1),a.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,n){t.state="loaded",n(null)}}class DC extends ws{constructor(t){const n=O0("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new b0(Ff(),null),t.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,s){if(t.freezeTileCoverage)return;this.transform=t;const a=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((c,u)=>{if(c[u.key]="",!this._tiles[u.key]){const d=new Js(u,this._source.tileSize*u.overscaleFactor(),t.tileZoom);d.state="loaded",this._tiles[u.key]=d}return c},{});for(const c in this._tiles)c in a||(this.freeFBO(c),this._tiles[c].unloadVectorData(),delete this._tiles[c])}freeFBO(t){const n=this.proxyCachedFBO[t];if(void 0!==n){const s=Object.values(n);this.renderCachePool.push(...s),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class tx extends nn{constructor(t,n,s){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=n,this.projMatrix=s}}class MC extends Vm{constructor(t,n){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[s,a,c]=function(f){const p=new ro,g=new Ai,_=131;p.reserve(17161),g.reserve(33800);const v=ut/128,x=ut+v/2,b=x+v;for(let C=-v;C<b;C+=v)for(let M=-v;M<b;M+=v){const T=M<0||M>x||C<0||C>x?24575:0,R=Qt(Math.round(M),0,ut),P=Qt(Math.round(C),0,ut);p.emplaceBack(R+T,P)}const E=(C,M)=>{const T=M*_+C;g.emplaceBack(T+1,T,T+_),g.emplaceBack(T+_,T+_+1,T+1)};for(let C=1;C<129;C++)for(let M=1;M<129;M++)E(M,C);return[0,129].forEach(C=>{for(let M=0;M<130;M++)E(M,C),E(C,M)}),[p,g,32768]}(),u=t.context;this.gridBuffer=u.createVertexBuffer(s,Gs.members),this.gridIndexBuffer=u.createIndexBuffer(a),this.gridSegments=yn.simpleSegment(0,0,s.length,a.length),this.gridNoSkirtSegments=yn.simpleSegment(0,0,s.length,c),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new DC(n.map),this.orthoMatrix=it.create(),it.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,ut,0,ut,0,1);const d=u.gl;this._overlapStencilMode=new Se({func:d.GEQUAL,mask:255},0,255,d.KEEP,d.KEEP,d.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Gf(n.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,s){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const a=t.terrain.properties,c=0===t.terrain.drapeRenderMode,u=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=xe.now();const d=t.terrain&&t.terrain.scope,f=a.get("source"),p=c?this._mockSourceCache:t.getSourceCache(f,d);if(!p)return void tt(`Couldn't find terrain source "${f}".`);if(this.sourceCache=p,this._exaggeration=u?this.calculateExaggeration(n):a.get("exaggeration"),!n.projection.requiresDraping&&u&&0===this._exaggeration)return void this._disable();this.enabled=!0;const g=()=>{this.sourceCache.used&&tt(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const _=this.getScaledDemTileSize();this.sourceCache.update(n,_,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,g(),this._initializing=!0),g(),n.updateElevation(!0,s),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){const n=this._previousCameraAltitude,s=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=s;const a=null!=n?s-n:Number.MAX_VALUE;if(Math.abs(a)<2)return this._exaggeration;const c=t.zoom,u=this._style.terrain;if(!this._previousUpdateTimestamp)return u.getExaggeration(c);let d=c-this._previousZoom;const f=this._previousUpdateTimestamp;let p=c;null!=this._evaluationZoom&&(p=this._evaluationZoom,Math.abs(c-p)>.5&&(d=.5*(c-p+d)),d*a<0&&(p+=d)),this._evaluationZoom=p;const g=u.getExaggeration(p),_=g===u.getExaggeration(Math.max(0,p-.1));if(_&&Math.abs(g-this._exaggeration)<.01)return g;let v=Math.min(.1,.00375*(this._updateTimestamp-f));return(_||g<.1||Math.abs(d)<1e-4)&&(v=Math.min(.2,4*v)),vt(this._exaggeration,g,v)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,s=this.painter.transform;this._initializing&&(this._initializing=0===s._centerAltitude&&-1===this.getAtPointOrZero(We.fromLngLat(s.center),-1),this._emptyDEMTextureDirty=!this._initializing);const a=this.proxyCoords=n.getIds().map(f=>{const p=n.getTileByID(f).tileID;return p.projMatrix=s.calculateProjMatrix(p.toUnwrapped()),p});!function(f,p){const g=p.transform.pointCoordinate(p.transform.getCameraPoint()),_=new et(g.x,g.y);f.sort((v,x)=>{if(x.overscaledZ-v.overscaledZ)return x.overscaledZ-v.overscaledZ;const b=new et(v.canonical.x+(1<<v.canonical.z)*v.wrap,v.canonical.y),E=new et(x.canonical.x+(1<<x.canonical.z)*x.wrap,x.canonical.y),C=_.mult(1<<v.canonical.z);return C.x-=.5,C.y-=.5,C.distSqr(b)-C.distSqr(E)})}(a,this.painter);const c=this.proxyToSource||{};this.proxyToSource={},a.forEach(f=>{this.proxyToSource[f.key]={}}),this.terrainTileForTile={};const u=this._style._mergedSourceCaches;for(const f in u){const p=u[f];if(!p.used||(p!==this.sourceCache&&this.resetTileLookupCache(p.id),this._setupProxiedCoordsForOrtho(p,t[f],c),p.usedForTerrain))continue;const g=t[f];p.getSource().reparseOverscaled&&this._assignTerrainTiles(g)}this.proxiedCoords[n.id]=a.map(f=>new tx(f,f.key,this.orthoMatrix)),this._assignTerrainTiles(a),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(c),this.renderingToTexture=!1;const d={};this._visibleDemTiles=[];for(const f of this.proxyCoords){const p=this.terrainTileForTile[f.key];if(!p)continue;const g=p.tileID.key;g in d||(this._visibleDemTiles.push(p),d[g]=g)}}_assignTerrainTiles(t){this._initializing||t.forEach(n=>{if(this.terrainTileForTile[n.key])return;const s=this._findTileCoveringTileID(n,this.sourceCache);s&&(this.terrainTileForTile[n.key]=s)})}_prepareDEMTextures(){const t=this.painter.context,n=t.gl;for(const s in this.terrainTileForTile){const a=this.terrainTileForTile[s],c=a.dem;!c||a.demTexture&&!a.needsDEMTextureUpload||(t.activeTexture.set(n.TEXTURE1),MI(this.painter,a,c))}}_prepareDemTileUniforms(t,n,s,a){if(!n||null==n.demTexture)return!1;const c=t.tileID.canonical,u=Math.pow(2,n.tileID.canonical.z-c.z),d=a||"";return s[`u_dem_tl${d}`]=[c.x*u%1,c.y*u%1],s[`u_dem_scale${d}`]=u,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,n=t.gl;if(!this._emptyDepthBufferTexture){const s=new yi({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new Qn(t,s,n.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const n=this._visibleDemTiles.reduce((s,a)=>{if(!a.dem)return s;const c=a.dem.tree.minimums[0];return c>0&&t++,s+c},0);return t?n/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const s=this._getLoadedAreaMinimum(),[a,c]=(()=>{const d=new jT({width:1,height:1},new Float32Array([s]));return[n.R32F,d]})();this._emptyDEMTextureDirty=!1;let u=this._emptyDEMTexture;return u?u.update(c,{premultiply:!1}):u=this._emptyDEMTexture=new Qn(t,c,a,{premultiply:!1}),u}setupElevationDraw(t,n,s){const a=this.painter.context,c=a.gl,u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};u.u_exaggeration=this.exaggeration();let d=null,f=null,p=1;if(s&&s.morphing&&this._useVertexMorphing){const v=s.morphing.srcDemTile,x=s.morphing.dstDemTile;p=s.morphing.phase,v&&x&&(this._prepareDemTileUniforms(t,v,u,"_prev")&&(f=v),this._prepareDemTileUniforms(t,x,u)&&(d=x))}const g=v=>v&&v.demTexture&&this.painter.linearFloatFilteringSupported()?c.LINEAR:c.NEAREST,_=v=>{u.u_dem_size=1===v.size[0]?1:v.size[0]-2};if(f&&d)a.activeTexture.set(c.TEXTURE2),d.demTexture.bind(g(d),c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE4),f.demTexture.bind(g(f),c.CLAMP_TO_EDGE),d.demTexture&&_(d.demTexture),u.u_dem_lerp=p;else{d=this.terrainTileForTile[t.tileID.key],a.activeTexture.set(c.TEXTURE2);const v=this._prepareDemTileUniforms(t,d,u)?d.demTexture:this.emptyDEMTexture;v.bind(g(d),c.CLAMP_TO_EDGE),_(v)}if(a.activeTexture.set(c.TEXTURE3),s&&s.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE),this._depthFBO&&(u.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE),u.u_depth_size_inv=[1,1]),s&&s.useMeterToDem&&d){const v=(1<<d.tileID.canonical.z)*An(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;u.u_meter_to_dem=v}if(s&&s.labelPlaneMatrixInv&&(u.u_label_plane_matrix_inv=s.labelPlaneMatrixInv),n.setTerrainUniformValues(a,u),"globe"===this.painter.transform.projection.name){const v=this.globeUniformValues(this.painter.transform,t.tileID.canonical,s&&s.useDenormalizedUpVectorScale);n.setGlobeUniformValues(a,v)}}globeUniformValues(t,n,s){const a=t.projection;return{u_tile_tl_up:a.upVector(n,0,0),u_tile_tr_up:a.upVector(n,ut,0),u_tile_br_up:a.upVector(n,ut,ut),u_tile_bl_up:a.upVector(n,0,ut),u_tile_up_scale:s?qd(1):a.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,s=this.painter.context;0!==t.length&&(s.bindFramebuffer.set(null),s.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(a,c,u,d,f){if("globe"===a.transform.projection.name)!function(p,g,_,v,x){const b=p.context,E=b.gl;let C,M;const T=p.transform,R=Uy(p,b,T),P=(q,j)=>{if(M===j)return;const X=[wC[j],"PROJECTION_GLOBE_VIEW"];R&&X.push("CUSTOM_ANTIALIASING");const Q=p.isTileAffectedByFog(q);C=p.getOrCreateProgram("globeRaster",{defines:X,overrideFog:Q}),M=j},I=p.colorModeForRenderPass(),O=new de(E.LEQUAL,de.ReadWrite,p.depthRangeFor3D);Bh.update(x);const L=vm(T),F=[Ri(T.center.lng),wi(T.center.lat)],N=p.globeSharedBuffers,B=[T.width*xe.devicePixelRatio,T.height*xe.devicePixelRatio],V=Float32Array.from(T.globeMatrix),U={useDenormalizedUpVectorScale:!0};{const q=p.transform,j=EC(q.zoom,g.exaggeration(),g.sourceCache._source.tileSize);M=-1;const X=E.TRIANGLES;for(const Q of v){const nt=_.getTile(Q),Y=Se.disabled,K=g.prevTerrainTileForTile[Q.key],ot=g.terrainTileForTile[Q.key];bC(K,ot)&&Bh.newMorphing(Q.key,K,ot,x,250),b.activeTexture.set(E.TEXTURE0),nt.texture&&nt.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE);const at=Bh.getMorphValuesForProxy(Q.key),lt=at?1:0;at&&es(U,{morphing:{srcDemTile:at.from,dstDemTile:at.to,phase:qa(at.phase)}});const dt=vl(Q.canonical),ft=Hb(dt.getCenter().lat),gt=$y(Q.canonical,dt,ft,q.worldSize/q._pixelsPerMercatorPixel),ht=Aa(Mo(Q.canonical)),yt=xC(q.expandedFarZProjMatrix,V,L,ht,ti(q.zoom),F,q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.globeCenterInViewSpace,q.globeRadius,B,j,gt);if(P(Q,lt),C&&(g.setupElevationDraw(nt,C,U),p.uploadCommonUniforms(b,C,Q.toUnwrapped()),N)){const[Ot,Lt,Ut]=N.getGridBuffers(ft,0!==j);C.draw(p,X,O,Y,I,ze.backCCW,yt,"globe_raster",Ot,Lt,Ut)}}}if(N&&(p.renderDefaultNorthPole||p.renderDefaultSouthPole)){const q=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];R&&q.push("CUSTOM_ANTIALIASING"),C=p.getOrCreateProgram("globeRaster",{defines:q});for(const j of v){const{x:X,y:Q,z:nt}=j.canonical,Y=0===Q,K=Q===(1<<nt)-1,[ot,at,lt,dt]=N.getPoleBuffers(nt,!1);if(dt&&(Y||K)){const ft=_.getTile(j);b.activeTexture.set(E.TEXTURE0),ft.texture&&ft.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE);let gt=Ju(nt,X,T);const ht=Aa(Mo(j.canonical)),yt=(Ot,Lt)=>Ot.draw(p,E.TRIANGLES,O,Se.disabled,I,ze.disabled,xC(T.expandedFarZProjMatrix,gt,gt,ht,0,F,T.frustumCorners.TL,T.frustumCorners.TR,T.frustumCorners.BR,T.frustumCorners.BL,T.globeCenterInViewSpace,T.globeRadius,B,0),"globe_pole_raster",Lt,lt,dt);g.setupElevationDraw(ft,C,U),p.uploadCommonUniforms(b,C,j.toUnwrapped()),Y&&p.renderDefaultNorthPole&&yt(C,ot),K&&p.renderDefaultSouthPole&&(gt=it.scale(it.create(),gt,[1,-1,1]),yt(C,at))}}}}(a,c,u,d,f);else{const p=a.context,g=p.gl;let _,v;const x=a.shadowRenderer,b=zh(a,a.longestCutoffRange),E=I=>{if(v===I)return;const O=[];O.push(wC[I]),b.shouldRenderCutoff&&O.push("RENDER_CUTOFF"),_=a.getOrCreateProgram("terrainRaster",{defines:O}),v=I},C=a.colorModeForRenderPass(),M=new de(g.LEQUAL,de.ReadWrite,a.depthRangeFor3D);Bh.update(f);const T=a.transform,R=EC(T.zoom,c.exaggeration(),c.sourceCache._source.tileSize);let P=[0,0,0];if(x){const I=a.style.directionalLight,O=a.style.ambientLight;I&&O&&(P=Jf(I,O))}{v=-1;const I=g.TRIANGLES,[O,L]=[c.gridIndexBuffer,c.gridSegments];for(const F of d){const N=u.getTile(F),B=Se.disabled,V=c.prevTerrainTileForTile[F.key],U=c.terrainTileForTile[F.key];bC(V,U)&&Bh.newMorphing(F.key,V,U,f,250),p.activeTexture.set(g.TEXTURE0),N.texture&&N.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE);const q=Bh.getMorphValuesForProxy(F.key),j=q?1:0;let X;q&&(X={morphing:{srcDemTile:q.from,dstDemTile:q.to,phase:qa(q.phase)}});const Q=vC(F.projMatrix,SI(F.canonical,T.renderWorldCopies)?R/10:R,P);if(E(j),!_)continue;c.setupElevationDraw(N,_,X);const nt=F.toUnwrapped();x&&x.setupShadows(nt,_),a.uploadCommonUniforms(p,_,nt,null,b),_.draw(a,I,M,B,C,ze.backCCW,Q,"terrain_raster",c.gridBuffer,O,L)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const n=this.painter,s=this.painter.context,a=this.proxySourceCache,c=this.proxiedCoords[a.id],u=this._drapedRenderBatches.shift(),d=n.style.order,f=[];let p=0;for(const g of c){const _=a.getTileByID(g.proxyTileKey),v=a.proxyCachedFBO[g.key]?a.proxyCachedFBO[g.key][t]:void 0,x=void 0!==v?a.renderCache[v]:this.pool[p++],b=void 0!==v;if(_.texture=x.tex,b&&!x.dirty){f.push(_.tileID);continue}let E;s.bindFramebuffer.set(x.fb.framebuffer),this.renderedToTile=!1,x.dirty&&(s.clear({color:Pe.transparent,stencil:0}),x.dirty=!1);for(let C=u.start;C<=u.end;++C){const M=n.style._mergedLayers[d[C]];if(M.isHidden(n.transform.zoom))continue;const T=n.style.getLayerSourceCache(M),R=T?this.proxyToSource[g.key][T.id]:[g];if(!R)continue;const P=R;s.viewport.set([0,0,x.fb.width,x.fb.height]),E!==(T?T.id:null)&&(this._setupStencil(x,R,M,T),E=T?T.id:null),n.renderLayer(n,T,M,P)}if(0===this._drapedRenderBatches.length)for(const C of this._pendingGroundEffectLayers){const M=n.style._mergedLayers[d[C]];if(M.isHidden(n.transform.zoom))continue;const T=n.style.getLayerSourceCache(M),R=T?this.proxyToSource[g.key][T.id]:[g];if(!R)continue;const P=R;s.viewport.set([0,0,x.fb.width,x.fb.height]),E!==(T?T.id:null)&&(this._setupStencil(x,R,M,T),E=T?T.id:null),n.renderLayer(n,T,M,P)}this.renderedToTile?(x.dirty=!0,f.push(_.tileID)):b||--p,5===p&&(p=0,this.renderToBackBuffer(f))}return this.renderToBackBuffer(f),this.renderingToTexture=!1,s.bindFramebuffer.set(null),s.viewport.set([0,0,n.width,n.height]),u.end+1}postRender(){}isLayerOrderingCorrect(t){const n=t.order.length;let s=-1,a=n;for(let c=0;c<n;++c)this._style.isLayerDraped(t._mergedLayers[t.order[c]])?s=Math.max(s,c):a=Math.min(a,c);return a>s}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{t=Math.min(t,n.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,n,s){if(!this._visibleDemTiles)return null;const a=this._visibleDemTiles.filter(c=>c.dem).map(c=>{const u=c.tileID,d=1<<u.overscaledZ,{x:f,y:p}=u.canonical,g=f/d,_=(f+1)/d,v=p/d,x=(p+1)/d;return{minx:g,miny:v,maxx:_,maxy:x,t:c.dem.tree.raycastRoot(g,v,_,x,t,n,s),tile:c}});a.sort((c,u)=>(null!==c.t?c.t:Number.MAX_VALUE)-(null!==u.t?u.t:Number.MAX_VALUE));for(const c of a){if(null==c.t)return null;const u=c.tile.dem.tree.raycast(c.minx,c.miny,c.maxx,c.maxy,t,n,s);if(null!=u)return u}return null}_createFBO(){const t=this.painter.context,n=t.gl,s=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const a=new Qn(t,{width:s[0],height:s[1],data:null},n.RGBA);a.bind(n.LINEAR,n.CLAMP_TO_EDGE);const c=t.createFramebuffer(s[0],s[1],!0,null);return c.colorAttachment.set(a.texture),c.depthAttachment=new IS(t,c.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,s[0],s[1]),this._stencilRef=0,c.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):c.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:c,tex:a,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const n=this._style._mergedLayers[t],s=n.isHidden(this.painter.transform.zoom);return"custom"===n.type?!s&&n.shouldRedrape():!s&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const s of this._style.getSources())if(s instanceof D0){t=!0;break}if(!t)return;const n={};for(let s=0;s<this._style.order.length;++s){const a=this._style._mergedLayers[this._style.order[s]],c=this._style.getLayerSourceCache(a);if(c&&!n[c.id]&&!a.isHidden(this.painter.transform.zoom)&&"line"===a.type&&a.widthExpression()instanceof as){n[c.id]=!0;for(const u of this.proxyCoords){const d=this.proxyToSource[u.key][c.id];if(d)for(const f of d)this._clearRenderCacheForTile(c.id,f)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s]._source instanceof vg){t=!0;break}if(!t)return;const n={};for(let s=0;s<this._style.order.length;++s){const a=this._style._mergedLayers[this._style.order[s]],c=this._style.getLayerSourceCache(a);if(!c||n[c.id]||a.isHidden(this.painter.transform.zoom)||"raster"!==a.type)continue;const u=a.paint.get("raster-fade-duration");for(const d of this.proxyCoords){const f=this.proxyToSource[d.key][c.id];if(f)for(const p of f){const g=CC(c.getTile(p),c.findLoadedParent(p,0),c,this.painter.transform,u);(1!==g.opacity||0!==g.mix)&&this._clearRenderCacheForTile(c.id,p)}}}}_setupDrapedRenderBatches(){const t=this._style.order,n=t.length;if(0===n)return;const s=[];this._pendingGroundEffectLayers=[];let a,c=0,u=this._style._mergedLayers[t[c]];for(;!this._style.isLayerDraped(u)&&u.isHidden(this.painter.transform.zoom)&&++c<n;)u=this._style._mergedLayers[t[c]];for(;c<n;++c){const d=this._style._mergedLayers[t[c]];d.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(d)?void 0===a&&(a=c):("fill-extrusion"===d.type&&this._pendingGroundEffectLayers.push(c),void 0!==a&&(s.push({start:a,end:c-1}),a=void 0)))}if(void 0!==a&&s.push({start:a,end:c-1}),0!==s.length){const d=s[s.length-1];this._pendingGroundEffectLayers.every(p=>p>d.end)||tt("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=s}_setupRenderCache(t){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const u=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let d=0;d<u.length;++d){const f=Object.values(u[d]);n.renderCachePool.push(...f)}}return}this._clearRasterLayersFromRenderCache();const s=this.proxyCoords,a=this._tilesDirty;for(let u=s.length-1;u>=0;u--){const d=s[u];if(n.getTileByID(d.key),void 0!==n.proxyCachedFBO[d.key]){const f=t[d.key],p=this.proxyToSource[d.key];let g=0;for(const _ in p){const v=p[_],x=f[_];if(!x||x.length!==v.length||v.some((b,E)=>b!==x[E]||a[_]&&a[_].hasOwnProperty(b.key))){g=-1;break}++g}for(const _ in n.proxyCachedFBO[d.key])n.renderCache[n.proxyCachedFBO[d.key][_]].dirty=g<0||g!==Object.values(f).length}}const c=[...this._drapedRenderBatches];c.sort((u,d)=>d.end-d.start-(u.end-u.start));for(const u of c)for(const d of s){if(n.proxyCachedFBO[d.key])continue;let f=n.renderCachePool.pop();void 0===f&&n.renderCache.length<50&&(f=n.renderCache.length,n.renderCache.push(this._createFBO())),void 0!==f&&(n.proxyCachedFBO[d.key]={},n.proxyCachedFBO[d.key][u.start]=f,n.renderCache[f].dirty=!0)}this._tilesDirty={}}_setupStencil(t,n,s,a){if(!a||!this._sourceTilesOverlap[a.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const c=this.painter.context,u=c.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let d;if(s.isTileClipped())d=n.length,this._overlapStencilMode.test={func:u.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);d=1,this._overlapStencilMode.test={func:u.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+d>255&&(c.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=d,this._overlapStencilMode.ref=this._stencilRef,s.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Se.disabled}_renderTileClippingMasks(t,n){const s=this.painter,a=this.painter.context,c=a.gl;s._tileClippingMaskIDs={},a.setColorMode(Qe.disabled),a.setDepthMode(de.disabled);const u=s.getOrCreateProgram("clippingMask");for(const d of t){const f=s._tileClippingMaskIDs[d.key]=--n;u.draw(s,c.TRIANGLES,de.disabled,new Se({func:c.ALWAYS,mask:0},f,255,c.KEEP,c.KEEP,c.REPLACE),Qe.disabled,ze.disabled,J0(d.projMatrix),"$clipping",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const s=[t.x,t.y,1,1];mn.transformMat4(s,s,n.pixelMatrixInverse),mn.scale(s,s,1/s[3]),s[0]/=n.worldSize,s[1]/=n.worldSize;const a=n._camera.position,c=An(1,n.center.lat),u=[a[0],a[1],a[2]/c,0],d=G.subtract([],s.slice(0,3),u);G.normalize(d,d);const f=this.raycast(u,d,this._exaggeration);return null!==f&&f?(G.scaleAndAdd(u,u,d,f),u[3]=u[2],u[2]*=c,u):null}drawDepth(){const t=this.painter,n=t.context,s=this.proxySourceCache,a=Math.ceil(t.width),c=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===a&&this._depthFBO.height===c||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const u=n.gl,d=n.createFramebuffer(a,c,!0,"renderbuffer");n.activeTexture.set(u.TEXTURE0);const f=new Qn(n,{width:a,height:c,data:null},u.RGBA);f.bind(u.NEAREST,u.CLAMP_TO_EDGE),d.colorAttachment.set(f.texture);const p=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,a,c);d.depthAttachment.set(p),this._depthFBO=d,this._depthTexture=f}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,a,c]),function(u,d,f,p){if("globe"===u.transform.projection.name)return;const g=u.context,_=g.gl;g.clear({depth:1});const v=u.getOrCreateProgram("terrainDepth"),x=new de(_.LESS,de.ReadWrite,u.depthRangeFor3D);for(const b of p){const E=f.getTile(b),C=vC(b.projMatrix,0,[0,0,0]);d.setupElevationDraw(E,v),v.draw(u,_.TRIANGLES,x,Se.disabled,Qe.unblended,ze.backCCW,C,"terrain_depth",d.gridBuffer,d.gridIndexBuffer,d.gridNoSkirtSegments)}}(t,this,s,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,n,s){if(t.getSource()instanceof Wo)return this._setupProxiedCoordsForImageSource(t,n,s);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const a=this.proxiedCoords[t.id]=[],c=this.proxyCoords;for(let d=0;d<c.length;d++){const f=c[d],p=this._findTileCoveringTileID(f,t);if(p){const g=this._createProxiedId(f,p,s[f.key]&&s[f.key][t.id]);a.push(g),this.proxyToSource[f.key][t.id]=[g]}}let u=!1;for(let d=0;d<n.length;d++){const f=t.getTile(n[d]);if(!f||!f.hasData())continue;const p=this._findTileCoveringTileID(f.tileID,this.proxySourceCache);if(p&&p.tileID.canonical.z!==f.tileID.canonical.z){const g=this.proxyToSource[p.tileID.key][t.id],_=this._createProxiedId(p.tileID,f,s[p.tileID.key]&&s[p.tileID.key][t.id]);g?g.splice(g.length-1,0,_):this.proxyToSource[p.tileID.key][t.id]=[_],a.push(_),u=!0}}this._sourceTilesOverlap[t.id]=u}_setupProxiedCoordsForImageSource(t,n,s){if(!t.getSource().loaded())return;const a=this.proxiedCoords[t.id]=[],c=this.proxyCoords,u=t.getSource(),d=u.tileID;if(!d)return;const f=new et(d.x,d.y)._div(1<<d.z),p=u.coordinates.map(We.fromLngLat).reduce((_,v)=>(_.min.x=Math.min(_.min.x,v.x-f.x),_.min.y=Math.min(_.min.y,v.y-f.y),_.max.x=Math.max(_.max.x,v.x-f.x),_.max.y=Math.max(_.max.y,v.y-f.y),_),{min:new et(Number.MAX_VALUE,Number.MAX_VALUE),max:new et(-Number.MAX_VALUE,-Number.MAX_VALUE)}),g=(_,v)=>{const x=_.wrap+_.canonical.x/(1<<_.canonical.z),b=_.canonical.y/(1<<_.canonical.z),E=ut/(1<<_.canonical.z),C=v.wrap+v.canonical.x/(1<<v.canonical.z),M=v.canonical.y/(1<<v.canonical.z);return x+E<C+p.min.x||x>C+p.max.x||b+E<M+p.min.y||b>M+p.max.y};for(let _=0;_<c.length;_++){const v=c[_];for(let x=0;x<n.length;x++){const b=t.getTile(n[x]);if(!b||!b.hasData()||g(v,b.tileID))continue;const E=this._createProxiedId(v,b,s[v.key]&&s[v.key][t.id]),C=this.proxyToSource[v.key][t.id];C?C.push(E):this.proxyToSource[v.key][t.id]=[E],a.push(E)}}}_createProxiedId(t,n,s){let a=this.orthoMatrix;if(s){const c=s.find(u=>u.key===n.tileID.key);if(c)return c}if(n.tileID.key!==t.key){const c=t.canonical.z-n.tileID.canonical.z;let u,d,f;a=it.create();const p=n.tileID.wrap-t.wrap<<t.overscaledZ;c>0?(u=ut>>c,d=u*((n.tileID.canonical.x<<c)-t.canonical.x+p),f=u*((n.tileID.canonical.y<<c)-t.canonical.y)):(u=ut<<-c,d=ut*(n.tileID.canonical.x-(t.canonical.x+p<<-c)),f=ut*(n.tileID.canonical.y-(t.canonical.y<<-c))),it.ortho(a,0,u,0,u,0,1),it.translate(a,a,[d,f,0])}return new tx(n.tileID,t.key,a)}_findTileCoveringTileID(t,n){let s=n.getTile(t);if(s&&s.hasData())return s;const a=this._findCoveringTileCache[n.id],c=a[t.key];if(s=c?n.getTileByID(c):null,s&&s.hasData()||null===c)return s;let u=s?s.tileID:t,d=u.overscaledZ;const f=n.getSource().minzoom,p=[];if(!c){const _=n.getSource().maxzoom;if(t.canonical.z>=_){const v=t.canonical.z-_;n.getSource().reparseOverscaled?(d=Math.max(t.canonical.z+2,n.transform.tileZoom),u=new nn(d,t.wrap,_,t.canonical.x>>v,t.canonical.y>>v)):0!==v&&(d=_,u=new nn(d,t.wrap,_,t.canonical.x>>v,t.canonical.y>>v))}u.key!==t.key&&(p.push(u.key),s=n.getTile(u))}const g=_=>{p.forEach(v=>{a[v]=_}),p.length=0};for(d-=1;d>=f&&(!s||!s.hasData());d--){s&&g(s.tileID.key);const _=u.calculateScaledKey(d);if(s=n.getTileByID(_),s&&s.hasData())break;const v=a[_];if(null===v)break;void 0===v?p.push(_):s=n.getTileByID(v)}return g(s?s.tileID.key:null),s&&s.hasData()?s:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,n){let s=this._tilesDirty[t];s||(s=this._tilesDirty[t]={}),s[n.key]=!0}}function TC(e,t,n){const s=function(d,f,p){const g=G.dot(f,d),_=G.dot(p,[.2126,.7152,.0722]),v=(b,E,C)=>(1-C)*b+C*E,x=v(1-.3*Math.min(_,1),1,Math.min(g+1,1));return v(.92,1,Math.asin(Qt(f[2],-1,1))/Math.PI+.5)*x}(e,[0,0,1],t),a=[0,0,0];G.scale(a,n.slice(0,3),s);const c=[0,0,0];G.scale(c,t.slice(0,3),e[2]);const u=[0,0,0];return G.add(u,a,c),Un(u)}const SC=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],II=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class IC{static cacheKey(t,n,s,a){let c=`${n}${a?a.cacheKey:""}`;for(const u of s)t.usedDefines.includes(u)&&(c+=`/${u}`);return c}constructor(t,n,s,a,c,u){const d=t.gl;this.program=d.createProgram(),this.configuration=a,this.name=n,this.fixedDefines=[...u];const f=a?a.getBinderAttributes():[],p=(s.staticAttributes||[]).concat(f);let g=a?a.defines():[];g=g.concat(u.map(C=>`#define ${C}`));const _="#version 300 es\n";let v=_+g.concat("precision mediump float;",mC,pC.fragmentSource).join("\n");for(const C of s.fragmentIncludes)v+=`\n${$f[C]}`;v+=`\n${s.fragmentSource}`;let x=_+g.concat("precision highp float;",mC,pC.vertexSource).join("\n");for(const C of s.vertexIncludes)x+=`\n${$f[C]}`;x+=`\n${s.vertexSource}`;const b=d.createShader(d.FRAGMENT_SHADER);if(d.isContextLost())return void(this.failedToCreate=!0);d.shaderSource(b,v),d.compileShader(b),d.attachShader(this.program,b);const E=d.createShader(d.VERTEX_SHADER);if(d.isContextLost())this.failedToCreate=!0;else{d.shaderSource(E,x),d.compileShader(E),d.attachShader(this.program,E),this.attributes={},this.numAttributes=p.length;for(let C=0;C<this.numAttributes;C++)if(p[C]){const M=p[C].startsWith("a_")?p[C]:`a_${p[C]}`;d.bindAttribLocation(this.program,C,M),this.attributes[M]=C}d.linkProgram(this.program),d.deleteShader(E),d.deleteShader(b),this.fixedUniforms=c(t),this.binderUniforms=a?a.getUniforms(t):[],u.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new Ne(C=t),u_dem_prev:new Ne(C),u_dem_tl:new Me(C),u_dem_scale:new xt(C),u_dem_tl_prev:new Me(C),u_dem_scale_prev:new xt(C),u_dem_size:new xt(C),u_dem_lerp:new xt(C),u_exaggeration:new xt(C),u_depth:new Ne(C),u_depth_size_inv:new Me(C),u_meter_to_dem:new xt(C),u_label_plane_matrix_inv:new ye(C)}),u.includes("GLOBE")&&(this.globeUniforms=(C=>({u_tile_tl_up:new be(C),u_tile_tr_up:new be(C),u_tile_br_up:new be(C),u_tile_bl_up:new be(C),u_tile_up_scale:new xt(C)}))(t)),u.includes("FOG")&&(this.fogUniforms=(C=>({u_fog_matrix:new ye(C),u_fog_range:new Me(C),u_fog_color:new rr(C),u_fog_horizon_blend:new xt(C),u_fog_vertical_limit:new Me(C),u_fog_temporal_offset:new xt(C),u_frustum_tl:new be(C),u_frustum_tr:new be(C),u_frustum_br:new be(C),u_frustum_bl:new be(C),u_globe_pos:new be(C),u_globe_radius:new xt(C),u_globe_transition:new xt(C),u_is_globe:new Ne(C),u_viewport:new Me(C)}))(t)),u.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(C=>({u_cutoff_params:new rr(C)}))(t)),u.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(C=>({u_lighting_ambient_color:new be(C),u_lighting_directional_dir:new be(C),u_lighting_directional_color:new be(C),u_ground_radiance:new be(C)}))(t)),u.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(C=>({u_light_matrix_0:new ye(C),u_light_matrix_1:new ye(C),u_fade_range:new Me(C),u_shadow_normal_offset:new be(C),u_shadow_intensity:new xt(C),u_shadow_texel_size:new xt(C),u_shadow_map_resolution:new xt(C),u_shadow_direction:new be(C),u_shadow_bias:new be(C),u_shadowmap_0:new Ne(C),u_shadowmap_1:new Ne(C)}))(t))}var C}setTerrainUniformValues(t,n){if(!this.terrainUniforms)return;const s=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in n)s[a]&&s[a].set(this.program,a,n[a])}}setGlobeUniformValues(t,n){if(!this.globeUniforms)return;const s=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in n)s[a]&&s[a].set(this.program,a,n[a])}}setFogUniformValues(t,n){if(!this.fogUniforms)return;const s=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in n)s[a].set(this.program,a,n[a])}}setCutoffUniformValues(t,n){if(!this.cutoffUniforms)return;const s=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in n)s[a].set(this.program,a,n[a])}}setLightsUniformValues(t,n){if(!this.lightsUniforms)return;const s=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in n)s[a].set(this.program,a,n[a])}}setShadowUniformValues(t,n){if(this.failedToCreate||!this.shadowUniforms)return;const s=this.shadowUniforms;t.program.set(this.program);for(const a in n)s[a].set(this.program,a,n[a])}_drawDebugWireframe(t,n,s,a,c,u,d,f,p,g){const _=t.options.wireframe;if(!1===_.terrain&&!1===_.layers2D&&!1===_.layers3D)return;const v=t.context;if(!(()=>!(!_.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!_.layers2D||t._terrain&&t._terrain.renderingToTexture||!SC.includes(this.name))||!(!_.layers3D||!II.includes(this.name)))())return;const x=v.gl,b=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,c,v);if(!b)return;const E=[...this.fixedDefines];E.push("DEBUG_WIREFRAME");const C=t.getOrCreateProgram(this.name,{config:this.configuration,defines:E});v.program.set(C.program);const M=(P,I,O)=>{if(I[P]&&O[P])for(const L in I[P])O[P][L]&&O[P][L].set(O.program,L,I[P][L].current)};p&&p.setUniforms(C.program,v,C.binderUniforms,d,{zoom:f}),M("fixedUniforms",this,C),M("terrainUniforms",this,C),M("globeUniforms",this,C),M("fogUniforms",this,C),M("lightsUniforms",this,C),M("shadowUniforms",this,C),b.bind(),v.setColorMode(new Qe([x.ONE,x.ONE_MINUS_SRC_ALPHA,x.ZERO,x.ONE],Pe.transparent,[!0,!0,!0,!1])),v.setDepthMode(new de(n.func===x.LESS?x.LEQUAL:n.func,de.ReadOnly,n.range)),v.setStencilMode(Se.disabled);const T=3*u.primitiveLength*2,R=3*u.primitiveOffset*2*2;g&&g>1?x.drawElementsInstanced(x.LINES,T,x.UNSIGNED_SHORT,R,g):x.drawElements(x.LINES,T,x.UNSIGNED_SHORT,R),c.bind(),v.program.set(this.program),v.setDepthMode(n),v.setStencilMode(s),v.setColorMode(a)}draw(t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C){const M=t.context,T=M.gl;if(this.failedToCreate)return;M.program.set(this.program),M.setDepthMode(s),M.setStencilMode(a),M.setColorMode(c),M.setCullFace(u);for(const I of Object.keys(this.fixedUniforms))this.fixedUniforms[I].set(this.program,I,d[I]);b&&b.setUniforms(this.program,M,this.binderUniforms,v,{zoom:x});const R={[T.LINES]:2,[T.TRIANGLES]:3,[T.LINE_STRIP]:1}[n],P=C&&C>0?1:void 0;for(const I of _.get()){const O=I.vaos||(I.vaos={});(O[f]||(O[f]=new _C)).bind(M,this,p,b?b.getPaintVertexBuffers():[],g,I.vertexOffset,E||[],P),C&&C>1?T.drawElementsInstanced(n,I.primitiveLength*R,T.UNSIGNED_SHORT,I.primitiveOffset*R*2,C):T.drawElements(n,I.primitiveLength*R,T.UNSIGNED_SHORT,I.primitiveOffset*R*2),n===T.TRIANGLES&&this._drawDebugWireframe(t,s,a,c,g,I,v,x,b,C)}}}function AI(e,t){const n=Math.pow(2,t.tileID.overscaledZ),s=t.tileSize*Math.pow(2,e.transform.tileZoom)/n,a=s*(t.tileID.canonical.x+t.tileID.wrap*n),c=s*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/qc(t,1,e.transform.tileZoom),u_pixel_coord_upper:[a>>16,c>>16],u_pixel_coord_lower:[65535&a,65535&c]}}const PR=it.create(),AC=(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E)=>{const C=t.style.light,M=C.properties.get("position"),T=[M.x,M.y,M.z],R=$i.create();"viewport"===C.properties.get("anchor")&&($i.fromRotation(R,-t.transform.angle),G.transformMat3(T,T,R));const P=C.properties.get("color"),I=t.transform,O={u_matrix:e,u_lightpos:T,u_lightintensity:C.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+n,u_opacity:s,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:PR,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:a,u_edge_radius:c,u_flood_light_color:_,u_vertical_scale:v,u_flood_light_intensity:x,u_ground_shadow_factor:b,u_emissive_strength:E};return"globe"===I.projection.name&&(O.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],O.u_zoom_transition=f,O.u_inv_rot_matrix=g,O.u_merc_center=p,O.u_up_dir=I.projection.upVector(new oo(0,0,0),p[0]*ut,p[1]*ut),O.u_height_lift=d),O},RI=(e,t,n)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:n}),PI=(e,t,n,s,a,c,u,d,f,p,g,_,v,x)=>{const b=AC(e,t,n,s,a,c,u,f,p,g,_,v,x,1,[0,0,0],0),E={u_height_factor:-Math.pow(2,u.overscaledZ)/d.tileSize/8};return qt(b,AI(t,d),E)},RC=(e,t)=>({u_matrix:e,u_emissive_strength:t}),PC=(e,t,n,s)=>qt(RC(e,t),AI(n,s)),qf=(e,t,n)=>({u_matrix:e,u_world:n,u_emissive_strength:t}),OI=(e,t,n,s,a)=>qt(PC(e,t,n,s),{u_world:a}),ex=(e,t,n,s)=>{const a=ut/n.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.getCameraToCenterDistance(s),u_extrude_scale:[t.pixelsToGLUnits[0]/a,t.pixelsToGLUnits[1]/a]}},OC=(e,t,n=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:n}),OR=it.create(),kI=(e,t,n,s,a,c,u)=>{const d=e.transform,f="globe"===d.projection.name,p=f?Ub(d.zoom,t.canonical)*d._pixelsPerMercatorPixel:qc(n,1,c),g={u_matrix:t.projMatrix,u_extrude_scale:p,u_intensity:u,u_inv_rot_matrix:OR,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(f){g.u_inv_rot_matrix=s,g.u_merc_center=a,g.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],g.u_zoom_transition=ti(d.zoom);const _=a[0]*ut,v=a[1]*ut;g.u_up_dir=d.projection.upVector(new oo(0,0,0),_,v)}return g},LI=(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C,M,T,R,P,I)=>{return{u_matrix:e,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:s,u_grid_matrix:a,u_tl_parent:c,u_scale_parent:g,u_fade_t:_.mix,u_opacity:_.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(L=v.paint.get("raster-saturation"),L>0?1-1/(1.001-L):-L),u_contrast_factor:(O=v.paint.get("raster-contrast"),O>0?1/(1-O):1+O),u_spin_weights:ra(v.paint.get("raster-hue-rotate")),u_perspective_transform:x,u_raster_elevation:b,u_tl_br:u,u_zoom_transition:d,u_merc_center:f,u_cutoff_params:p,u_colorization_mix:FI(C,T),u_colorization_offset:NI(M,T),u_color_ramp:E,u_texture_offset:[P/(R+2*P),R/(R+2*P)],u_texture_res:[R+2*P,R+2*P],u_emissive_strength:I};var O,L};function ra(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}function FI([e,t,n,s],[a,c]){if(a===c)return[0,0,0,0];const u=259/257/(c-a);return[e*u,t*u,n*u,s*u]}function NI(e,[t,n]){return t===n?0:((e-t)/(n-t)*259-1)/257}const kC=it.create(),Zf=(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C,M)=>{const T=a.transform,R={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:T.getCameraToCenterDistance(E),u_rotate_symbol:+n,u_aspect_ratio:T.width/T.height,u_fade_change:a.options.fadeDuration?a.symbolFadeChange:1,u_matrix:c,u_label_plane_matrix:u,u_coord_matrix:d,u_is_text:+f,u_pitch_with_map:+s,u_texsize:p,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:kC,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:kC,u_up_vector:[0,-1,0],u_icon_transition:M||0,u_icon_saturation:C};return"globe"===E.name&&(R.u_tile_id=[g.canonical.x,g.canonical.y,1<<g.canonical.z],R.u_zoom_transition=_,R.u_inv_rot_matrix=x,R.u_merc_center=v,R.u_camera_forward=T._camera.forward(),R.u_ecef_origin=function(P,I){const O=[0,0,0],L=Aa(Mo(I.canonical));return G.transformMat4(O,O,L),G.transformMat4(O,O,P),O}(T.globeMatrix,g.toUnwrapped()),R.u_tile_matrix=Float32Array.from(T.globeMatrix),R.u_up_vector=b),R},nx=(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C)=>qt(Zf(e,t,n,s,a,c,u,d,f,p,_,v,x,b,E,C,1),{u_gamma_scale:s?a.transform.getCameraToCenterDistance(C)*Math.cos(a.terrain?0:a.transform._pitch):1,u_device_pixel_ratio:xe.devicePixelRatio,u_is_halo:+g,undefined:void 0}),zI=(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E)=>qt(nx(e,t,n,s,a,c,u,d,!0,f,!0,g,_,v,x,b,E),{u_texsize_icon:p,u_texture_icon:1}),LC=(e,t,n,s)=>({u_matrix:e,u_emissive_strength:t,u_opacity:n,u_color:s}),Lg=(e,t,n,s,a,c,u)=>qt(function(d,f,p,g){const _=p.imageManager.getPattern(d.toString(),f),{width:v,height:x}=p.imageManager.getPixelSize(f),b=Math.pow(2,g.tileID.overscaledZ),E=g.tileSize*Math.pow(2,p.transform.tileZoom)/b,C=E*(g.tileID.canonical.x+g.tileID.wrap*b),M=E*g.tileID.canonical.y;return{u_image:0,u_pattern_tl:_.tl,u_pattern_br:_.br,u_texsize:[v,x],u_pattern_size:_.displaySize,u_tile_units_to_pixels:1/qc(g,1,p.transform.tileZoom),u_pixel_coord_upper:[C>>16,M>>16],u_pixel_coord_lower:[65535&C,65535&M]}}(a,c,s,u),{u_matrix:e,u_emissive_strength:t,u_opacity:n}),mo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},ix=(e,t,n,s,a,c,u,d,f,p,g,_,v=[0,0,0])=>{const x=s.style.light,b=x.properties.get("position"),E=[-b.x,-b.y,b.z],C=$i.create();"viewport"===x.properties.get("anchor")&&($i.fromRotation(C,-s.transform.angle),G.transformMat3(E,E,C));const M="MASK"===p.alphaMode,T=x.properties.get("color"),R=_.paint.get("model-ambient-occlusion-intensity"),P=_.paint.get("model-color").constantOr(Pe.white),I=_.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:t,u_normal_matrix:n,u_lightpos:E,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_camera_pos:v,u_opacity:a,u_baseTextureIsAlpha:0,u_alphaMask:+M,u_alphaCutoff:p.alphaCutoff,u_baseColorFactor:[c.r,c.g,c.b,c.a],u_emissiveFactor:[u[0],u[1],u[2],1],u_metallicFactor:d,u_roughnessFactor:f,u_baseColorTexture:mo.BaseColor,u_metallicRoughnessTexture:mo.MetallicRoughness,u_normalTexture:mo.Normal,u_occlusionTexture:mo.Occlusion,u_emissionTexture:mo.Emission,u_color_mix:[P.r,P.g,P.b,I],u_aoIntensity:R,u_emissive_strength:g}},rx=new Float32Array(16),FC=(e,t=rx,n=rx)=>({u_matrix:e,u_instance:t,u_node_matrix:n}),BI={fillExtrusion:e=>({u_matrix:new ye(e),u_lightpos:new be(e),u_lightintensity:new xt(e),u_lightcolor:new be(e),u_vertical_gradient:new xt(e),u_opacity:new xt(e),u_edge_radius:new xt(e),u_ao:new Me(e),u_tile_id:new be(e),u_zoom_transition:new xt(e),u_inv_rot_matrix:new ye(e),u_merc_center:new Me(e),u_up_dir:new be(e),u_height_lift:new xt(e),u_flood_light_color:new be(e),u_vertical_scale:new xt(e),u_flood_light_intensity:new xt(e),u_ground_shadow_factor:new be(e),u_emissive_strength:new xt(e)}),fillExtrusionDepth:e=>({u_matrix:new ye(e),u_edge_radius:new xt(e),u_vertical_scale:new xt(e)}),fillExtrusionPattern:e=>({u_matrix:new ye(e),u_lightpos:new be(e),u_lightintensity:new xt(e),u_lightcolor:new be(e),u_vertical_gradient:new xt(e),u_height_factor:new xt(e),u_edge_radius:new xt(e),u_ao:new Me(e),u_tile_id:new be(e),u_zoom_transition:new xt(e),u_inv_rot_matrix:new ye(e),u_merc_center:new Me(e),u_up_dir:new be(e),u_height_lift:new xt(e),u_image:new Ne(e),u_texsize:new Me(e),u_pixel_coord_upper:new Me(e),u_pixel_coord_lower:new Me(e),u_tile_units_to_pixels:new xt(e),u_opacity:new xt(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new ye(e),u_opacity:new xt(e),u_ao_pass:new xt(e),u_meter_to_tile:new xt(e),u_ao:new Me(e),u_flood_light_intensity:new xt(e),u_flood_light_color:new be(e),u_attenuation:new xt(e),u_edge_radius:new xt(e),u_fb:new Ne(e),u_fb_size:new xt(e)}),fill:e=>({u_matrix:new ye(e),u_emissive_strength:new xt(e)}),fillPattern:e=>({u_matrix:new ye(e),u_emissive_strength:new xt(e),u_image:new Ne(e),u_texsize:new Me(e),u_pixel_coord_upper:new Me(e),u_pixel_coord_lower:new Me(e),u_tile_units_to_pixels:new xt(e)}),fillOutline:e=>({u_matrix:new ye(e),u_emissive_strength:new xt(e),u_world:new Me(e)}),fillOutlinePattern:e=>({u_matrix:new ye(e),u_emissive_strength:new xt(e),u_world:new Me(e),u_image:new Ne(e),u_texsize:new Me(e),u_pixel_coord_upper:new Me(e),u_pixel_coord_lower:new Me(e),u_tile_units_to_pixels:new xt(e)}),circle:e=>({u_camera_to_center_distance:new xt(e),u_extrude_scale:new Q1(e),u_device_pixel_ratio:new xt(e),u_matrix:new ye(e),u_inv_rot_matrix:new ye(e),u_merc_center:new Me(e),u_tile_id:new be(e),u_zoom_transition:new xt(e),u_up_dir:new be(e),u_emissive_strength:new xt(e)}),collisionBox:e=>({u_matrix:new ye(e),u_camera_to_center_distance:new xt(e),u_extrude_scale:new Me(e)}),collisionCircle:e=>({u_matrix:new ye(e),u_inv_matrix:new ye(e),u_camera_to_center_distance:new xt(e),u_viewport_size:new Me(e)}),debug:e=>({u_color:new Ec(e),u_matrix:new ye(e),u_overlay:new Ne(e),u_overlay_scale:new xt(e)}),clippingMask:e=>({u_matrix:new ye(e)}),heatmap:e=>({u_extrude_scale:new xt(e),u_intensity:new xt(e),u_matrix:new ye(e),u_inv_rot_matrix:new ye(e),u_merc_center:new Me(e),u_tile_id:new be(e),u_zoom_transition:new xt(e),u_up_dir:new be(e)}),heatmapTexture:e=>({u_image:new Ne(e),u_color_ramp:new Ne(e),u_opacity:new xt(e)}),hillshade:e=>({u_matrix:new ye(e),u_image:new Ne(e),u_latrange:new Me(e),u_light:new Me(e),u_shadow:new Ec(e),u_highlight:new Ec(e),u_emissive_strength:new xt(e),u_accent:new Ec(e)}),hillshadePrepare:e=>({u_matrix:new ye(e),u_image:new Ne(e),u_dimension:new Me(e),u_zoom:new xt(e)}),line:e=>({u_matrix:new ye(e),u_pixels_to_tile_units:new Q1(e),u_device_pixel_ratio:new xt(e),u_units_to_pixels:new Me(e),u_dash_image:new Ne(e),u_gradient_image:new Ne(e),u_image_height:new xt(e),u_texsize:new Me(e),u_tile_units_to_pixels:new xt(e),u_alpha_discard_threshold:new xt(e),u_trim_offset:new Me(e),u_emissive_strength:new xt(e)}),linePattern:e=>({u_matrix:new ye(e),u_texsize:new Me(e),u_pixels_to_tile_units:new Q1(e),u_device_pixel_ratio:new xt(e),u_image:new Ne(e),u_units_to_pixels:new Me(e),u_tile_units_to_pixels:new xt(e),u_alpha_discard_threshold:new xt(e)}),raster:e=>({u_matrix:new ye(e),u_normalize_matrix:new ye(e),u_globe_matrix:new ye(e),u_merc_matrix:new ye(e),u_grid_matrix:new dy(e),u_tl_parent:new Me(e),u_scale_parent:new xt(e),u_fade_t:new xt(e),u_opacity:new xt(e),u_image0:new Ne(e),u_image1:new Ne(e),u_brightness_low:new xt(e),u_brightness_high:new xt(e),u_saturation_factor:new xt(e),u_contrast_factor:new xt(e),u_spin_weights:new be(e),u_perspective_transform:new Me(e),u_raster_elevation:new xt(e),u_tl_br:new rr(e),u_zoom_transition:new xt(e),u_merc_center:new Me(e),u_cutoff_params:new rr(e),u_colorization_mix:new rr(e),u_colorization_offset:new xt(e),u_color_ramp:new Ne(e),u_texture_offset:new Me(e),u_texture_res:new Me(e),u_emissive_strength:new xt(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new Ne(e),u_is_size_feature_constant:new Ne(e),u_size_t:new xt(e),u_size:new xt(e),u_camera_to_center_distance:new xt(e),u_rotate_symbol:new Ne(e),u_aspect_ratio:new xt(e),u_fade_change:new xt(e),u_matrix:new ye(e),u_label_plane_matrix:new ye(e),u_coord_matrix:new ye(e),u_is_text:new Ne(e),u_pitch_with_map:new Ne(e),u_texsize:new Me(e),u_tile_id:new be(e),u_zoom_transition:new xt(e),u_inv_rot_matrix:new ye(e),u_merc_center:new Me(e),u_camera_forward:new be(e),u_tile_matrix:new ye(e),u_up_vector:new be(e),u_ecef_origin:new be(e),u_texture:new Ne(e),u_icon_transition:new xt(e),u_icon_saturation:new xt(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new Ne(e),u_is_size_feature_constant:new Ne(e),u_size_t:new xt(e),u_size:new xt(e),u_camera_to_center_distance:new xt(e),u_rotate_symbol:new Ne(e),u_aspect_ratio:new xt(e),u_fade_change:new xt(e),u_matrix:new ye(e),u_label_plane_matrix:new ye(e),u_coord_matrix:new ye(e),u_is_text:new Ne(e),u_pitch_with_map:new Ne(e),u_texsize:new Me(e),u_texture:new Ne(e),u_gamma_scale:new xt(e),u_device_pixel_ratio:new xt(e),u_tile_id:new be(e),u_zoom_transition:new xt(e),u_inv_rot_matrix:new ye(e),u_merc_center:new Me(e),u_camera_forward:new be(e),u_tile_matrix:new ye(e),u_up_vector:new be(e),u_ecef_origin:new be(e),u_is_halo:new Ne(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new Ne(e),u_is_size_feature_constant:new Ne(e),u_size_t:new xt(e),u_size:new xt(e),u_camera_to_center_distance:new xt(e),u_rotate_symbol:new Ne(e),u_aspect_ratio:new xt(e),u_fade_change:new xt(e),u_matrix:new ye(e),u_label_plane_matrix:new ye(e),u_coord_matrix:new ye(e),u_is_text:new Ne(e),u_pitch_with_map:new Ne(e),u_texsize:new Me(e),u_texsize_icon:new Me(e),u_texture:new Ne(e),u_texture_icon:new Ne(e),u_gamma_scale:new xt(e),u_device_pixel_ratio:new xt(e),u_is_halo:new Ne(e)}),background:e=>({u_matrix:new ye(e),u_emissive_strength:new xt(e),u_opacity:new xt(e),u_color:new Ec(e)}),backgroundPattern:e=>({u_matrix:new ye(e),u_emissive_strength:new xt(e),u_opacity:new xt(e),u_image:new Ne(e),u_pattern_tl:new Me(e),u_pattern_br:new Me(e),u_texsize:new Me(e),u_pattern_size:new Me(e),u_pixel_coord_upper:new Me(e),u_pixel_coord_lower:new Me(e),u_tile_units_to_pixels:new xt(e)}),terrainRaster:yC,terrainDepth:yC,skybox:e=>({u_matrix:new ye(e),u_sun_direction:new be(e),u_cubemap:new Ne(e),u_opacity:new xt(e),u_temporal_offset:new xt(e)}),skyboxGradient:e=>({u_matrix:new ye(e),u_color_ramp:new Ne(e),u_center_direction:new be(e),u_radius:new xt(e),u_opacity:new xt(e),u_temporal_offset:new xt(e)}),skyboxCapture:e=>({u_matrix_3f:new dy(e),u_sun_direction:new be(e),u_sun_intensity:new xt(e),u_color_tint_r:new rr(e),u_color_tint_m:new rr(e),u_luminance:new xt(e)}),globeRaster:e=>({u_proj_matrix:new ye(e),u_globe_matrix:new ye(e),u_normalize_matrix:new ye(e),u_merc_matrix:new ye(e),u_zoom_transition:new xt(e),u_merc_center:new Me(e),u_image0:new Ne(e),u_grid_matrix:new dy(e),u_skirt_height:new xt(e),u_frustum_tl:new be(e),u_frustum_tr:new be(e),u_frustum_br:new be(e),u_frustum_bl:new be(e),u_globe_pos:new be(e),u_globe_radius:new xt(e),u_viewport:new Me(e)}),globeAtmosphere:e=>({u_frustum_tl:new be(e),u_frustum_tr:new be(e),u_frustum_br:new be(e),u_frustum_bl:new be(e),u_horizon:new xt(e),u_transition:new xt(e),u_fadeout_range:new xt(e),u_color:new rr(e),u_high_color:new rr(e),u_space_color:new rr(e),u_temporal_offset:new xt(e),u_horizon_angle:new xt(e)}),model:e=>({u_matrix:new ye(e),u_lighting_matrix:new ye(e),u_normal_matrix:new ye(e),u_lightpos:new be(e),u_lightintensity:new xt(e),u_lightcolor:new be(e),u_camera_pos:new be(e),u_opacity:new xt(e),u_baseColorFactor:new rr(e),u_emissiveFactor:new rr(e),u_metallicFactor:new xt(e),u_roughnessFactor:new xt(e),u_baseTextureIsAlpha:new Ne(e),u_alphaMask:new Ne(e),u_alphaCutoff:new xt(e),u_baseColorTexture:new Ne(e),u_metallicRoughnessTexture:new Ne(e),u_normalTexture:new Ne(e),u_occlusionTexture:new Ne(e),u_emissionTexture:new Ne(e),u_color_mix:new rr(e),u_aoIntensity:new xt(e),u_emissive_strength:new xt(e)}),modelDepth:e=>({u_matrix:new ye(e),u_instance:new ye(e),u_node_matrix:new ye(e)}),groundShadow:e=>({u_matrix:new ye(e),u_ground_shadow_factor:new be(e)}),stars:e=>({u_matrix:new ye(e),u_up:new be(e),u_right:new be(e),u_intensity_multiplier:new xt(e)})};let Wf;function Io(e,t,n,s,a,c,u){const d=e.context,f=d.gl,p=e.transform,g=e.getOrCreateProgram("collisionBox"),_=[];let v=0,x=0;for(let P=0;P<s.length;P++){const I=s[P],O=t.getTile(I),L=O.getBucket(n);if(!L)continue;const F=z0(I,L,p);let N=F;0===a[0]&&0===a[1]||(N=e.translatePosMatrix(F,O,a,c));const B=u?L.textCollisionBox:L.iconCollisionBox,V=L.collisionCircleArray;if(V.length>0){const U=it.create(),q=N;it.mul(U,L.placementInvProjMatrix,p.glCoordMatrix),it.mul(U,U,L.placementViewportMatrix),_.push({circleArray:V,circleOffset:x,transform:q,invTransform:U,projection:L.getProjection()}),v+=V.length/4,x=v}B&&(e.terrain&&e.terrain.setupElevationDraw(O,g),g.draw(e,f.LINES,de.disabled,Se.disabled,e.colorModeForRenderPass(),ze.disabled,ex(N,p,O,L.getProjection()),n.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,null,p.zoom,null,[B.collisionVertexBuffer,B.collisionVertexBufferExt]))}if(!u||!_.length)return;const b=e.getOrCreateProgram("collisionCircle"),E=new yc;E.resize(4*v),E._trim();let C=0;for(const P of _)for(let I=0;I<P.circleArray.length/4;I++){const O=4*I,L=P.circleArray[O+0],F=P.circleArray[O+1],N=P.circleArray[O+2],B=P.circleArray[O+3];E.emplace(C++,L,F,N,B,0),E.emplace(C++,L,F,N,B,1),E.emplace(C++,L,F,N,B,2),E.emplace(C++,L,F,N,B,3)}(!Wf||Wf.length<2*v)&&(Wf=function(P){const I=2*P,O=new Ai;O.resize(I),O._trim();for(let L=0;L<I;L++){const F=6*L;O.uint16[F+0]=4*L+0,O.uint16[F+1]=4*L+1,O.uint16[F+2]=4*L+2,O.uint16[F+3]=4*L+2,O.uint16[F+4]=4*L+3,O.uint16[F+5]=4*L+0}return O}(v));const M=d.createIndexBuffer(Wf,!0),T=d.createVertexBuffer(E,_w.members,!0);for(const P of _){const I={u_matrix:P.transform,u_inv_matrix:P.invTransform,u_camera_to_center_distance:(R=p).getCameraToCenterDistance(P.projection),u_viewport_size:[R.width,R.height]};b.draw(e,f.TRIANGLES,de.disabled,Se.disabled,e.colorModeForRenderPass(),ze.disabled,I,n.id,T,M,yn.simpleSegment(0,2*P.circleOffset,P.circleArray.length,P.circleArray.length/2),null,p.zoom)}var R;T.destroy(),M.destroy()}const NC=it.create();function jI({width:e,height:t,anchor:n,textOffset:s,textScale:a},c){const{horizontalAlign:u,verticalAlign:d}=uf(n),f=-(u-.5)*e,p=-(d-.5)*t,g=ff(n,s);return new et((f/a+g[0])*c,(p/a+g[1])*c)}function zC(e,t,n,s,a,c,u,d,f,p,g){const _=e.text.placedSymbolArray,v=e.text.dynamicLayoutVertexArray,x=e.icon.dynamicLayoutVertexArray,b={},E=e.getProjection(),C=B0(d,E,c),M=c.elevation,T=E.upVectorScale(d.canonical,c.center.lat,c.worldSize).metersToTile;v.clear();for(let R=0;R<_.length;R++){const P=_.get(R),{tileAnchorX:I,tileAnchorY:O,numGlyphs:L}=P,F=P.hidden||!P.crossTileID||e.allowVerticalPlacement&&!P.placedOrientation?null:s[P.crossTileID];if(F){let N=0,B=0,V=0;if(M){const ot=M?M.getAtTileOffset(d,I,O):0,[at,lt,dt]=E.upVector(d.canonical,I,O);N=ot*at*T,B=ot*lt*T,V=ot*dt*T}let[U,q,j,X]=Zo(P.projectedAnchorX+N,P.projectedAnchorY+B,P.projectedAnchorZ+V,n?C:u);const Q=uE(c.getCameraToCenterDistance(E),X);let nt=a.evaluateSizeForFeature(e.textSizeData,p,P)*Q/Yi;n&&(nt*=e.tilePixelRatio/f);const Y=jI(F,nt);n?(({x:U,y:q,z:j}=E.projectTilePoint(I+Y.x,O+Y.y,d.canonical)),[U,q,j]=Zo(U+N,q+B,j+V,u)):(t&&Y._rotate(-c.angle),U+=Y.x,q+=Y.y,j=0);const K=e.allowVerticalPlacement&&P.placedOrientation===On.vertical?Math.PI/2:0;for(let ot=0;ot<L;ot++)yh(v,U,q,j,K);g&&P.associatedIconIndex>=0&&(b[P.associatedIconIndex]={x:U,y:q,z:j,angle:K})}else Ol(L,v)}if(g){x.clear();const R=e.icon.placedSymbolArray;for(let P=0;P<R.length;P++){const I=R.get(P),{numGlyphs:O}=I,L=b[P];if(I.hidden||!L)Ol(O,x);else{const{x:F,y:N,z:B,angle:V}=L;for(let U=0;U<O;U++)yh(x,F,N,B,V)}}e.icon.dynamicLayoutVertexBuffer.updateData(x)}e.text.dynamicLayoutVertexBuffer.updateData(v)}function BC(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function Fg(e,t,n,s,a,c,u,d,f,p,g,_,v){const x=e.context,b=x.gl,E=e.transform,C="map"===d,M="map"===f,T=C&&"point"!==n.layout.get("symbol-placement"),R=C&&!M&&!T,P=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let I=!1;const O=e.depthModeForSublayer(0,de.ReadOnly),L=[Ri(E.center.lng),wi(E.center.lat)],F=n.layout.get("text-variable-anchor"),N="globe"===E.projection.name,B=[],V=[0,-1,0];let U=V;!N&&!E.mercatorFromTransition||C||(U=function(q){const j=q._camera.getWorldToCamera(q.worldSize,1),X=it.multiply([],j,q.globeMatrix);it.invert(X,X);const Q=[0,0,0],nt=[0,1,0,0];return mn.transformMat4(nt,nt,X),Q[0]=nt[0],Q[1]=nt[1],Q[2]=nt[2],G.normalize(Q,Q),Q}(E));for(const q of s){const j=t.getTile(q),X=j.getBucket(n);if(!X||"mercator"===X.projection.name&&N)continue;const Q=a?X.text:X.icon;if(!Q||X.fullyClipped||!Q.segments.get().length)continue;const nt=Q.programConfigurations.get(n.id),Y=a||X.sdfIcons,K=a?X.textSizeData:X.iconSizeData,ot=M||0!==E.pitch,at=vs(K,E.zoom);let lt,dt,ft,gt,ht=[0,0],yt=null;if(a)dt=j.glyphAtlasTexture?j.glyphAtlasTexture:null,ft=b.LINEAR,lt=j.glyphAtlasTexture?j.glyphAtlasTexture.size:[0,0],X.iconsInText&&(ht=j.imageAtlasTexture?j.imageAtlasTexture.size:[0,0],yt=j.imageAtlasTexture?j.imageAtlasTexture:null,gt=ot||e.options.rotating||e.options.zooming||"composite"===K.kind||"camera"===K.kind?b.LINEAR:b.NEAREST);else{const Bn=1!==n.layout.get("icon-size").constantOr(0)||X.iconsNeedLinear;dt=j.imageAtlasTexture?j.imageAtlasTexture:null,ft=Y||e.options.rotating||e.options.zooming||Bn||ot?b.LINEAR:b.NEAREST,lt=j.imageAtlasTexture?j.imageAtlasTexture.size:[0,0]}const Ot="globe"===X.projection.name,Lt=Ot?U:V,Ut=Ot?ti(E.zoom):0,Gt=B0(q,X.getProjection(),E),me=E.calculatePixelsToTileUnitsMatrix(j),ie=Zc(Gt,j.tileID.canonical,M,C,E,X.getProjection(),me),Je=e.terrain&&M&&T?it.invert(it.create(),ie):NC,$e=Na(Gt,j.tileID.canonical,M,C,E,X.getProjection(),me),pe=F&&X.hasTextData(),ue=X.hasIconTextFit()&&pe&&X.hasIconData();if(T){const Bn=E.elevation,Tn=Bn?Bn.getAtTileOffsetFunc(q,E.center.lat,E.worldSize,X.getProjection()):null,ar=Yv(Gt,j.tileID.canonical,M,C,E,X.getProjection(),me);dE(X,Gt,e,a,ar,$e,M,p,Tn,q)}const oe=T||a&&F||ue,He=e.translatePosMatrix(Gt,j,c,u),Ye=oe?NC:ie,we=e.translatePosMatrix($e,j,c,u,!0),Mn=X.getProjection().createInversionMatrix(E,q.canonical),ei=n.paint.get("icon-image-cross-fade").constantOr(0),gn=[];e.terrainRenderModeElevated()&&M&&gn.push("PITCH_WITH_MAP_TERRAIN"),Ot&&(gn.push("PROJECTION_GLOBE_VIEW"),oe&&gn.push("PROJECTED_POS_ON_VIEWPORT")),ei>0&&gn.push("ICON_TRANSITION"),Q.zOffsetVertexBuffer&&gn.push("Z_OFFSET");const Wn=Y&&0!==n.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1);let ui;Y?ui=X.iconsInText?zI(K.kind,at,R,M,e,He,Ye,we,lt,ht,q,Ut,L,Mn,Lt,X.getProjection()):nx(K.kind,at,R,M,e,He,Ye,we,a,lt,!0,q,Ut,L,Mn,Lt,X.getProjection()):(g<1&&gn.push("SATURATION"),ui=Zf(K.kind,at,R,M,e,He,Ye,we,a,lt,q,Ut,L,Mn,Lt,X.getProjection(),g,ei));const ni={program:e.getOrCreateProgram(BC(Y,a,X),{config:nt,defines:gn}),buffers:Q,uniformValues:ui,atlasTexture:dt,atlasTextureIcon:yt,atlasInterpolation:ft,atlasInterpolationIcon:gt,isSDF:Y,hasHalo:Wn,tile:j,labelPlaneMatrixInv:Je};if(P&&X.canOverlap){I=!0;const Bn=Q.segments.get();for(const Tn of Bn)B.push({segments:new yn([Tn]),sortKey:Tn.sortKey,state:ni})}else B.push({segments:Q.segments,sortKey:0,state:ni})}I&&B.sort((q,j)=>q.sortKey-j.sortKey);for(const q of B){const j=q.state;if(e.terrain&&e.terrain.setupElevationDraw(j.tile,j.program,{useDepthForOcclusion:E.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:j.labelPlaneMatrixInv}),x.activeTexture.set(b.TEXTURE0),j.atlasTexture&&j.atlasTexture.bind(j.atlasInterpolation,b.CLAMP_TO_EDGE),j.atlasTextureIcon&&(x.activeTexture.set(b.TEXTURE1),j.atlasTextureIcon&&j.atlasTextureIcon.bind(j.atlasInterpolationIcon,b.CLAMP_TO_EDGE)),e.uploadCommonLightUniforms(e.context,j.program),j.hasHalo){const X=j.uniformValues;X.u_is_halo=1,Ng(j.buffers,q.segments,n,e,j.program,O,_,v,X,2),X.u_is_halo=0}else{if(j.isSDF){const X=j.uniformValues;j.hasHalo&&(X.u_is_halo=1,Ng(j.buffers,q.segments,n,e,j.program,O,_,v,X,1)),X.u_is_halo=0}Ng(j.buffers,q.segments,n,e,j.program,O,_,v,j.uniformValues,1)}}}function Ng(e,t,n,s,a,c,u,d,f,p){const g=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];a.draw(s,s.context.gl.TRIANGLES,c,u,d,ze.disabled,f,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,s.transform.zoom,e.programConfigurations.get(n.id),g,p)}function jC(e,t,n,s,a,c,u){const d=e.context.gl,f=n.paint.get("fill-pattern"),p=f&&f.constantOr(1);let g,_,v,x,b;u?(_=p&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",g=d.LINES):(_=p?"fillPattern":"fill",g=d.TRIANGLES);for(const E of s){const C=t.getTile(E);if(p&&!C.patternsLoaded())continue;const M=C.getBucket(n);if(!M)continue;e.prepareDrawTile();const T=M.programConfigurations.get(n.id),R=e.isTileAffectedByFog(E),P=e.getOrCreateProgram(_,{config:T,overrideFog:R});p&&(e.context.activeTexture.set(d.TEXTURE0),C.imageAtlasTexture&&C.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),T.updatePaintBuffers());const I=f.constantOr(null);if(I&&C.imageAtlas){const F=C.imageAtlas.patternPositions[I.toString()];F&&T.setConstantPatternPositions(F)}const O=e.translatePosMatrix(E.projMatrix,C,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),L=n.paint.get("fill-emissive-strength");if(u){x=M.indexBuffer2,b=M.segments2;const F=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[d.drawingBufferWidth,d.drawingBufferHeight];v="fillOutlinePattern"===_&&p?OI(O,L,e,C,F):qf(O,L,F)}else x=M.indexBuffer,b=M.segments,v=p?PC(O,L,e,C):RC(O,L);e.uploadCommonUniforms(e.context,P,E.toUnwrapped()),P.draw(e,g,a,e.stencilModeForClipping(E),c,ze.disabled,v,n.id,M.layoutVertexBuffer,x,b,n.paint,e.transform.zoom,T,void 0)}}function Yf(e,t,n,s,a,c,u,d){n.resetLayerRenderingStats();const f=e.context,p=f.gl,g=e.transform,_=n.paint.get("fill-extrusion-pattern"),v=_.constantOr(1),x=n.paint.get("fill-extrusion-opacity"),b=e.style.enable3dLights(),E=n.paint.get(b&&!v?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),C=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),E],M=n.layout.get("fill-extrusion-edge-radius"),T=M>0&&!n.paint.get("fill-extrusion-rounded-roof"),R=T?0:M,P="globe"===g.projection.name?u0():0,I="globe"===g.projection.name,O=I?ti(g.zoom):0,L=[Ri(g.center.lng),wi(g.center.lat)],F=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),N=n.paint.get("fill-extrusion-flood-light-intensity"),B=n.paint.get("fill-extrusion-vertical-scale"),V=zh(e,n.paint.get("fill-extrusion-cutoff-fade-range")),U=n.paint.get("fill-extrusion-emissive-strength"),q=[];let j;I&&q.push("PROJECTION_GLOBE_VIEW"),C[0]>0&&q.push("FAUX_AO"),T&&q.push("ZERO_ROOF_RADIUS"),d&&q.push("HAS_CENTROID"),N>0&&q.push("FLOOD_LIGHT"),V.shouldRenderCutoff&&q.push("RENDER_CUTOFF");const X="shadow"===e.renderPass,Q=e.shadowRenderer,nt=X&&!!Q;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let Y=[0,0,0];if(Q){const at=e.style.directionalLight,lt=e.style.ambientLight;at&&lt&&(Y=Jf(at,lt)),j=q.concat(["SHADOWS_SINGLE_CASCADE"])}const K=nt?"fillExtrusionDepth":v?"fillExtrusionPattern":"fillExtrusion",ot=n.getLayerRenderingStats();for(const at of s){const lt=t.getTile(at),dt=lt.getBucket(n);if(!dt||dt.projection.name!==g.projection.name)continue;let ft=!1;Q&&(ft=0===Q.getMaxCascadeForTile(at.toUnwrapped()));const gt=e.isTileAffectedByFog(at),ht=dt.programConfigurations.get(n.id),yt=e.getOrCreateProgram(K,{config:ht,defines:ft?j:q,overrideFog:gt});if(e.terrain&&e.terrain.setupElevationDraw(lt,yt,{useMeterToDem:!0}),!dt.centroidVertexBuffer){const ie=yt.attributes.a_centroid_pos;void 0!==ie&&p.vertexAttrib2f(ie,0,0)}!X&&Q&&Q.setupShadows(lt.tileID.toUnwrapped(),yt,"vector-tile",lt.tileID.overscaledZ),v&&(e.context.activeTexture.set(p.TEXTURE0),lt.imageAtlasTexture&&lt.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),ht.updatePaintBuffers());const Ot=_.constantOr(null);if(Ot&&lt.imageAtlas){const ie=lt.imageAtlas.patternPositions[Ot.toString()];ie&&ht.setConstantPatternPositions(ie)}const Lt=n.paint.get("fill-extrusion-vertical-gradient");let Ut;if(X&&Q){if(VC(lt.tileID,dt,e))continue;const ie=Q.calculateShadowPassMatrixFromTile(lt.tileID.toUnwrapped());Ut=RI(ie,R,B)}else{const ie=e.translatePosMatrix(at.expandedProjMatrix,lt,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Je=g.projection.createInversionMatrix(g,at.canonical);Ut=v?PI(ie,e,Lt,x,C,R,at,lt,P,O,L,Je,F,B):AC(ie,e,Lt,x,C,R,at,P,O,L,Je,F,B,N,Y,U)}e.uploadCommonUniforms(f,yt,at.toUnwrapped(),null,V);let Gt=dt.segments;if("mercator"===g.projection.name&&!X&&(Gt=dt.getVisibleSegments(lt.tileID,e.terrain,e.transform.getFrustum(0)),!Gt.get().length))continue;if(ot)if(X)for(const ie of Gt.get())ot.numRenderedVerticesInShadowPass+=ie.primitiveLength;else for(const ie of Gt.get())ot.numRenderedVerticesInTransparentPass+=ie.primitiveLength;const me=[];(e.terrain||d)&&me.push(dt.centroidVertexBuffer),I&&me.push(dt.layoutVertexExtBuffer),yt.draw(e,f.gl.TRIANGLES,a,c,u,ze.backCCW,Ut,n.id,dt.layoutVertexBuffer,dt.indexBuffer,Gt,n.paint,e.transform.zoom,ht,me)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function Jc(e,t,n,s,a,c,u,d,f,p,g,_,v,x,b,E,C,M,T){const R=e.context,P=R.gl,I=e.transform,O=e.transform.zoom,L=[],F=zh(e,n.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===p?(L.push("CLEAR_SUBPASS"),T&&(L.push("CLEAR_FROM_TEXTURE"),R.activeTexture.set(P.TEXTURE0),T.bind(P.LINEAR,P.CLAMP_TO_EDGE))):"sdf"===p&&L.push("SDF_SUBPASS"),C&&L.push("HAS_CENTROID"),F.shouldRenderCutoff&&L.push("RENDER_CUTOFF");const N=n.layout.get("fill-extrusion-edge-radius"),B=(V,U,q,j,X)=>{const Q=U.programConfigurations.get(n.id),nt=e.isTileAffectedByFog(V),Y=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:Q,defines:L,overrideFog:nt}),K={u_matrix:j,u_opacity:g,u_ao_pass:f?1:0,u_meter_to_tile:X,u_ao:[_,v*X],u_flood_light_intensity:x,u_flood_light_color:b,u_attenuation:E,u_edge_radius:O>=17?0:N*X,u_fb:0,u_fb_size:T?T.size[0]:0},ot=[];C&&ot.push(U.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(R,Y,V.toUnwrapped(),null,F),Y.draw(e,R.gl.TRIANGLES,a,c,u,d,K,n.id,U.vertexBuffer,U.indexBuffer,q,n.paint,O,Q,ot)};for(const V of s){const U=t.getTile(V),q=U.getBucket(n);if(!q||q.projection.name!==I.projection.name||!q.groundEffect||q.groundEffect&&!q.groundEffect.hasData())continue;const j=q.groundEffect,X=1/q.tileToMeter;{const Q=e.translatePosMatrix(V.projMatrix,U,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),nt=j.getDefaultSegment();B(V,j,nt,Q,X)}if(M)for(let Q=0;Q<4;Q++){const nt=Nb[Q](V),Y=t.getTile(nt);if(!Y)continue;const K=Y.getBucket(n);if(!K||K.projection.name!==I.projection.name||!K.groundEffect||K.groundEffect&&!K.groundEffect.hasData())continue;const ot=K.groundEffect;let at,lt;0===Q?(at=[-ut,0,0],lt=1):1===Q?(at=[ut,0,0],lt=0):2===Q?(at=[0,-ut,0],lt=3):(at=[0,ut,0],lt=2);const dt=ot.regionSegments[lt];if(!dt)continue;const ft=new Float32Array(16);it.translate(ft,V.projMatrix,at),B(V,ot,dt,e.translatePosMatrix(ft,U,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),X)}}}function VI(e,t,n,s,a,c,u){0===s.centroidVertexArray.length&&s.createCentroidsBuffer();const d=c?c.findDEMTileFor(n):null;if(!(d&&d.dem||u))return;const f=M=>{const T=t.getSource().minzoom,R=I=>{const O=t.getTileByID(I);if(O&&O.hasData())return O.getBucket(a)},P=[0,-1,1];for(const I of P){if(M.overscaledZ+I<T)continue;const O=R(M.calculateScaledKey(M.overscaledZ+I));if(O)return O}},p=[0,0,0],g=(M,T)=>(p[0]=Math.min(M.min.y,T.min.y),p[1]=Math.max(M.max.y,T.max.y),p[2]=ut-T.min.x>M.max.x?T.min.x-ut:M.max.x,p),_=(M,T)=>(p[0]=Math.min(M.min.x,T.min.x),p[1]=Math.max(M.max.x,T.max.x),p[2]=ut-T.min.y>M.max.y?T.min.y-ut:M.max.y,p),v=[(M,T)=>g(M,T),(M,T)=>g(T,M),(M,T)=>_(M,T),(M,T)=>_(T,M)],x=(M,T,R,P,I,O,L)=>{if(!c)return 0;const F=[[O?R:M,O?M:R,0],[O?R:T,O?T:R,0]],N=L<0?ut+L:L,B=[O?N:(M+T)/2,O?(M+T)/2:N,0];return 0===R&&L<0||0!==R&&L>0?c.getForTilePoints(I,[B],!0,P):F.push(B),c.getForTilePoints(n,F,!0,d),Math.max(F[0][2],F[1][2],B[2])/c.exaggeration()};for(let M=0;M<4;M++){const T=s.borderFeatureIndices[M];if(0===T.length)continue;const R=Nb[M](n),P=f(R);if(!(P&&P instanceof If)||s.borderDoneWithNeighborZ[M]===P.canonical.z)continue;0===P.centroidVertexArray.length&&P.createCentroidsBuffer();const I=c?c.findDEMTileFor(R):null;if(!(I&&I.dem||u))continue;const O=(M<2?1:5)-M,L=P.borderDoneWithNeighborZ[O]!==s.canonical.z,F=P.borderFeatureIndices[O];let N=0;if(s.canonical.z!==P.canonical.z){for(const B of T)s.showCentroid(s.featuresOnBorder[B]);if(L)for(const B of F)P.showCentroid(P.featuresOnBorder[B]);s.borderDoneWithNeighborZ[M]=P.canonical.z,P.borderDoneWithNeighborZ[O]=s.canonical.z}for(const B of T){const V=s.featuresOnBorder[B],U=s.centroidData[V.centroidDataIndex],q=V.borders[M];let j;for(;N<F.length;){j=P.featuresOnBorder[F[N]];const X=j.borders[O];if(X[1]>q[0]+3||X[0]>q[0]-3)break;P.showCentroid(j),N++}if(j&&N<F.length){const X=N;let Q=0;for(;!(j.borders[O][0]>q[1]-3)&&(Q++,++N!==F.length);)j=P.featuresOnBorder[F[N]];if(j=P.featuresOnBorder[F[X]],Q>1){const K=j.borders[O];Math.abs(q[0]-K[0])<3&&Math.abs(q[1]-K[1])<3&&(Q=1,N=X+1)}else if(0===Q){s.showCentroid(V);continue}const nt=P.centroidData[j.centroidDataIndex];u&&1===Q&&(((E=U).flags|(C=nt).flags)&sr?(E.flags|=sr,C.flags|=sr):(E.flags&=2147483647,C.flags&=2147483647));let Y=new et(0,0);if(Q>1)N=X;else if(I&&I.dem&&!(V.intersectsCount()>1||j.intersectsCount()>1)){const K=v[M](U,nt),ot=M%2?ut-1:0;b=x(K[0],Math.min(ut-1,K[1]),ot,I,R,M<2,K[2]),Y=new et(Math.ceil(7*(b+450)),0)}U.centroidXY=nt.centroidXY=Y,s.writeCentroidToBuffer(U),P.writeCentroidToBuffer(nt)}else s.showCentroid(V)}s.borderDoneWithNeighborZ[M]=P.canonical.z,P.borderDoneWithNeighborZ[O]=s.canonical.z}var b,E,C;(s.needsCentroidUpdate||!s.centroidVertexBuffer&&0!==s.centroidVertexArray.length)&&s.uploadCentroid(e)}const UI=[1,0,0],ox=[0,1,0],sx=[0,0,1];function VC(e,t,n){const s=n.transform,a=n.shadowRenderer;if(!a)return!0;const c=e.toUnwrapped(),u=s.tileSize*a._cascades[n.currentShadowCascade].scale;let d=t.maxHeight;if(s.elevation){const E=s.elevation.getMinMaxForTile(e);E&&(d+=E.max)}const f=[...a.shadowDirection];f[2]=-f[2];const p=a.computeSimplifiedTileShadowVolume(c,d,u,f);if(!p)return!1;const g=[UI,ox,sx,f,[f[0],0,f[2]],[0,f[1],f[2]]],_="globe"===s.projection.name,v=s.scaleZoom(u),x=so.fromInvProjectionMatrix(s.invProjMatrix,s.worldSize,v,!_),b=a.getCurrentCascadeFrustum();return 0===x.intersectsPrecise(p.vertices,p.planes,g)||0===b.intersectsPrecise(p.vertices,p.planes,g)}function ax(e){const t=e._nearZ,n=e.projection.farthestPixelDistance(e),s=n-t,a=.2*e.height,c=t+a;return[t,n,(c-a-t)/s,(c-t)/s]}const lx=new Pe(1,0,0,1),$I=new Pe(0,1,0,1),HI=new Pe(0,0,1,1),GI=new Pe(1,0,1,1),qI=new Pe(0,1,1,1);function UC(e,t,n){const s=e.context,a=e.transform,c=s.gl,u="globe"===a.projection.name,d=u?["PROJECTION_GLOBE_VIEW"]:[];let f=n.projMatrix;if(u&&ti(a.zoom)>0){const B=jy(jb(n.canonical,a));f=it.multiply(new Float32Array(16),a.globeMatrix,B),it.multiply(f,a.projMatrix,f)}const p=e.getOrCreateProgram("debug",{defines:d}),g=t.getTileByID(n.key);e.terrain&&e.terrain.setupElevationDraw(g,p);const _=de.disabled,v=Se.disabled,x=e.colorModeForRenderPass(),b="$debug";s.activeTexture.set(c.TEXTURE0),e.emptyTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),u?g._makeGlobeTileDebugBuffers(e.context,a):g._makeDebugTileBoundsBuffers(e.context,a.projection);const E=g._tileDebugBuffer||e.debugBuffer,C=g._tileDebugIndexBuffer||e.debugIndexBuffer,M=g._tileDebugSegments||e.debugSegments;p.draw(e,c.LINE_STRIP,_,v,x,ze.disabled,OC(f,Pe.red),b,E,C,M,null,null,null,[g._globeTileDebugBorderBuffer]);const T=g.latestRawTileData,R=Math.floor((T&&T.byteLength||0)/1024),P=t.getTile(n).tileSize,I=512/Math.min(P,512)*(n.overscaledZ/a.zoom)*.5;let O=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(O+=` => ${n.overscaledZ}`),O+=` ${R}kb`,function(B,V){B.initDebugOverlayCanvas();const U=B.debugOverlayCanvas,q=B.context.gl,j=B.debugOverlayCanvas.getContext("2d");j.clearRect(0,0,U.width,U.height),j.shadowColor="white",j.shadowBlur=2,j.lineWidth=1.5,j.strokeStyle="white",j.textBaseline="top",j.font="bold 36px Open Sans, sans-serif",j.fillText(V,5,5),j.strokeText(V,5,5),B.debugOverlayTexture.update(U),B.debugOverlayTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE)}(e,O);const L=g._tileDebugTextBuffer||e.debugBuffer,F=g._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,N=g._tileDebugTextSegments||e.debugSegments;p.draw(e,c.TRIANGLES,_,v,Qe.alphaBlended,ze.disabled,OC(f,Pe.transparent,I),b,L,F,N,null,null,null,[g._globeTileDebugTextBuffer])}function zg(e,t,n,s){Xf(e,0,t+n/2,e.transform.width,n,s)}function Bg(e,t,n,s){Xf(e,t-n/2,0,n,e.transform.height,s)}function Xf(e,t,n,s,a,c){const u=e.context,d=u.gl;d.enable(d.SCISSOR_TEST),d.scissor(t*xe.devicePixelRatio,n*xe.devicePixelRatio,s*xe.devicePixelRatio,a*xe.devicePixelRatio),u.clear({color:c}),d.disable(d.SCISSOR_TEST)}const $C=dn([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:cx}=$C;function Vl(e,t,n,s){e.emplaceBack(t,n,s)}class ux{constructor(t){this.vertexArray=new hs,this.indices=new Ai,Vl(this.vertexArray,-1,-1,1),Vl(this.vertexArray,1,-1,1),Vl(this.vertexArray,-1,1,1),Vl(this.vertexArray,1,1,1),Vl(this.vertexArray,-1,-1,-1),Vl(this.vertexArray,1,-1,-1),Vl(this.vertexArray,-1,1,-1),Vl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,cx),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=yn.simpleSegment(0,0,36,12)}}function tu(e,t,n,s,a,c){const u=e.context.gl,d=t.paint.get("sky-atmosphere-color"),f=t.paint.get("sky-atmosphere-halo-color"),p=t.paint.get("sky-atmosphere-sun-intensity"),g={u_matrix_3f:$i.fromMat4($i.create(),s),u_sun_direction:a,u_sun_intensity:p,u_color_tint_r:[(b=d).r,b.g,b.b,b.a],u_color_tint_m:[(E=f).r,E.g,E.b,E.a],u_luminance:5e-5};var b,E;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+c,t.skyboxTexture,0),n.draw(e,u.TRIANGLES,de.disabled,Se.disabled,Qe.unblended,ze.frontCW,g,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const ZI=dn([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class HC{constructor(t){const n=new vc;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const s=new Ai;s.emplaceBack(0,1,2),s.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,ZI.members),this.indexBuffer=t.createIndexBuffer(s),this.segments=yn.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const WI=dn([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Xr{constructor(){this.colorModeAlphaBlendedWriteRGB=new Qe([1,771,1,771],Pe.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Qe([1,0,1,0],Pe.transparent,[!1,!1,!1,!0])}update(t){const n=t.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new HC(n);const s=100,a=200,c=function(g){const _=b1(30),v=[];for(let x=0;x<16e3;++x){const b=2*Math.PI*_(),E=Math.acos(1-2*_())-.5*Math.PI;v.push(G.fromValues(Math.cos(E)*Math.cos(b),Math.cos(E)*Math.sin(b),Math.sin(E)))}return v}(),u=b1(300),d=new G1,f=new Ai;let p=0;for(let g=0;g<c.length;++g){const _=G.scale([],c[g],200),v=Math.max(0,1+.01*s*(1*u()-.5)),x=Math.max(0,1+.01*a*(1*u()-.5));d.emplaceBack(_[0],_[1],_[2],-1,-1,v,x),d.emplaceBack(_[0],_[1],_[2],1,-1,v,x),d.emplaceBack(_[0],_[1],_[2],1,1,v,x),d.emplaceBack(_[0],_[1],_[2],-1,1,v,x),f.emplaceBack(p+0,p+1,p+2),f.emplaceBack(p+0,p+2,p+3),p+=4}this.starsVx=n.createVertexBuffer(d,WI.members),this.starsIdx=n.createIndexBuffer(f),this.starsSegments=yn.simpleSegment(0,0,d.length,f.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const s=t.context,a=s.gl,c=t.transform,u=new de(a.LEQUAL,de.ReadOnly,[0,1]),d=ti(c.zoom),f=n.properties.get("color").toArray01(),p=n.properties.get("high-color").toArray01(),g=n.properties.get("space-color").toArray01PremultipliedAlpha(),_=5e-4,v=Qt((n.properties.get("horizon-blend")-0)/1*.2495+_,5e-4,.25),x=Uy(t,s,c)&&v===_?c.worldSize/(2*Math.PI*1.025)-1:c.globeRadius,b=t.frameCounter/1e3%1,E=G.length(c.globeCenterInViewSpace),C=Math.sqrt(Math.pow(E,2)-Math.pow(x,2)),M=Math.acos(C/E),T=R=>{const P="globe"===c.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];R&&P.push("ALPHA_PASS");const I=t.getOrCreateProgram("globeAtmosphere",{defines:P}),O={u_frustum_tl:c.frustumCorners.TL,u_frustum_tr:c.frustumCorners.TR,u_frustum_br:c.frustumCorners.BR,u_frustum_bl:c.frustumCorners.BL,u_horizon:c.frustumCorners.horizon,u_transition:d,u_fadeout_range:v,u_color:f,u_high_color:p,u_space_color:g,u_temporal_offset:b,u_horizon_angle:M};t.uploadCommonUniforms(s,I);const L=this.atmosphereBuffer;L&&I.draw(t,a.TRIANGLES,u,Se.disabled,R?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ze.backCW,O,R?"atmosphere_glow_alpha":"atmosphere_glow",L.vertexBuffer,L.indexBuffer,L.segments)};T(!1),T(!0)}drawStars(t,n){const s=Qt(n.properties.get("star-intensity"),0,1);if(0===s)return;const a=t.context,c=a.gl,u=t.transform,d=t.getOrCreateProgram("stars"),f=ur.identity([]);ur.rotateX(f,f,-u._pitch),ur.rotateZ(f,f,-u.angle),ur.rotateX(f,f,De(u._center.lat)),ur.rotateY(f,f,-De(u._center.lng));const p=it.fromQuat(new Float32Array(16),f),g=it.multiply([],u.starsProjMatrix,p),_=$i.fromMat4([],p),v=$i.invert([],_),x=[0,1,0];G.transformMat3(x,x,v),G.scale(x,x,.15);const b=[1,0,0];G.transformMat3(b,b,v),G.scale(b,b,.15);const E=(M=x,T=b,R=s,{u_matrix:Float32Array.from(g),u_up:M,u_right:T,u_intensity_multiplier:R});var M,T,R;t.uploadCommonUniforms(a,d),this.starsVx&&this.starsIdx&&d.draw(t,c.TRIANGLES,de.disabled,Se.disabled,this.colorModeAlphaBlendedWriteRGB,ze.disabled,E,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function eu(e,t){const n=[...e],s=t.cameraWorldSizeForFog/t.worldSize,a=it.identity([]);return it.scale(a,a,[s,s,1]),it.multiply(n,a,n),it.multiply(n,t.worldToFogMatrix,n),n}function hx(e,t,n,s){const a=n.material,c=s.context,{baseColorTexture:u,metallicRoughnessTexture:d}=a.pbrMetallicRoughness,{normalTexture:f,occlusionTexture:p,emissionTexture:g}=a;function _(v,x,b){if(v&&(e.push(x),c.activeTexture.set(c.gl.TEXTURE0+b),v.gfxTexture)){const{minFilter:E,magFilter:C,wrapS:M,wrapT:T}=v.sampler;v.gfxTexture.bindExtraParam(E,C,M,T)}}_(u,"HAS_TEXTURE_u_baseColorTexture",mo.BaseColor),_(d,"HAS_TEXTURE_u_metallicRoughnessTexture",mo.MetallicRoughness),_(f,"HAS_TEXTURE_u_normalTexture",mo.Normal),_(p,"HAS_TEXTURE_u_occlusionTexture",mo.Occlusion),_(g,"HAS_TEXTURE_u_emissionTexture",mo.Emission),n.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(e.push(12===n.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),"OPAQUE"!==a.alphaMode&&"MASK"!==a.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),a.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function jg(e,t,n,s,a,c){const u=n.paint.get("model-opacity"),d=t.context,f=new de(t.context.gl.LEQUAL,de.ReadWrite,t.depthRangeFor3D),p=t.transform,g=e.mesh,_=g.material,v=_.pbrMetallicRoughness,x=t.style.fog;let b;b="pixels"===t.transform.projection.zAxisUnit?[...e.nodeModelMatrix]:it.multiply([],s.zScaleMatrix,e.nodeModelMatrix),it.multiply(b,s.negCameraPosMatrix,b);const E=it.invert([],b);it.transpose(E,E);const C=n.paint.get("model-emissive-strength").constantOr(0),M=ix(new Float32Array(e.worldViewProjection),new Float32Array(b),new Float32Array(E),t,u,v.baseColorFactor,_.emissiveFactor,v.metallicFactor,v.roughnessFactor,_,C,n),T={defines:[]},R=[];hx(T.defines,R,g,t);const P=t.shadowRenderer;P&&(P.useNormalOffset=!1);let I=null;if(x){const F=eu(e.nodeModelMatrix,t.transform);if(I=new Float32Array(F),"globe"!==p.projection.name){const N=g.aabb.min,B=g.aabb.max,[V,U]=x.getOpacityForBounds(F,N[0],N[1],B[0],B[1]);T.overrideFog=V>=Fl||U>=Fl}}const O=zh(t,n.paint.get("model-cutoff-fade-range"));O.shouldRenderCutoff&&T.defines.push("RENDER_CUTOFF");const L=t.getOrCreateProgram("model",T);t.uploadCommonUniforms(d,L,null,I,O),"shadow"!==t.renderPass&&P&&P.setupShadowsFromMatrix(e.nodeModelMatrix,L),L.draw(t,d.gl.TRIANGLES,f,a,c,g.material.doubleSided?ze.disabled:ze.backCCW,M,n.id,g.vertexBuffer,g.indexBuffer,g.segments,n.paint,t.transform.zoom,void 0,R)}function YI(e,t,n,s,a,c,u){let d;d="globe"===e.projection.name?e0(n,e):[...n],it.multiply(d,d,t.matrix);const f=it.multiply([],s,d);if(t.meshes)for(const p of t.meshes){if("BLEND"!==p.material.alphaMode){u.push({mesh:p,depth:0,modelIndex:a,worldViewProjection:f,nodeModelMatrix:d});continue}const g=G.transformMat4([],p.centroid,f);g[2]>0&&c.push({mesh:p,depth:g[2],modelIndex:a,worldViewProjection:f,nodeModelMatrix:d})}if(t.children)for(const p of t.children)YI(e,p,n,s,a,c,u)}function GC(e,t,n,s){const a=n.shadowRenderer;if(!a)return;const c=a.getShadowPassDepthMode(),u=a.getShadowPassColorMode(),d=a.calculateShadowPassMatrixFromMatrix(t),f=FC(d);n.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,c,Se.disabled,u,ze.backCCW,f,s.id,e.vertexBuffer,e.indexBuffer,e.segments,s.paint,n.transform.zoom,void 0,void 0)}function qC(e,t,n){const s=t.updateZoomBasedPaintProperties(),a=function(c,u,d){let f,p,g,_=c.terrain?c.terrain.exaggeration():0;if(c.terrain&&_>0){const v=c.terrain,x=v.findDEMTileFor(d);x&&x.dem?f=zc.create(v,d,x):_=0}if(0===_&&(u.terrainElevationMin=0,u.terrainElevationMax=0),_===u.validForExaggeration&&(0===_||f&&f._demTile&&f._demTile.tileID===u.validForDEMTile.id&&f._dem._timestamp===u.validForDEMTile.timestamp))return!1;for(const v in u.instancesPerModel){const x=u.instancesPerModel[v];for(let b=0;b<x.instancedDataArray.length;++b){const E=(f?_*f.getElevationAt(0|x.instancedDataArray.float32[16*b],0|x.instancedDataArray.float32[16*b+1],!0,!0):0)+x.instancesEvaluatedElevation[b];x.instancedDataArray.float32[16*b+6]=E,p=p?Math.min(u.terrainElevationMin,E):E,g=g?Math.max(u.terrainElevationMax,E):E}}return u.terrainElevationMin=p||0,u.terrainElevationMax=g||0,u.validForExaggeration=_,u.validForDEMTile=f&&f._demTile?{id:f._demTile.tileID,timestamp:f._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,t,n);(s||a)&&(t.uploaded=!1,t.upload(e.context))}const Yo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new qn([0,0,0],[ut,ut,0])};function kR(e,t){const n=1<<e.canonical.z,s=t.getFreeCameraOptions().position,a=t.elevation,c=e.canonical.x/n,u=(e.canonical.x+1)/n,d=e.canonical.y/n,f=(e.canonical.y+1)/n;let p=t._centerAltitude;if(a){const x=a.getMinMaxForTile(e);x&&x.max>p&&(p=x.max)}const g=Qt(s.x,c,u)-s.x,_=Qt(s.y,d,f)-s.y,v=An(p,t.center.lat)-s.z;return t._zoomFromMercatorZ(Math.sqrt(g*g+_*_+v*v))}function XI(e,t,n,s,a,c,u){const d=e.context,f="shadow"===e.renderPass,p=e.shadowRenderer,g=f&&p?p.getShadowPassDepthMode():new de(d.gl.LEQUAL,de.ReadWrite,e.depthRangeFor3D),_=e.isTileAffectedByFog(c);if(n.meshes)for(const v of n.meshes){const x=["MODEL_POSITION_ON_GPU"],b=[];let E,C,M;s.instancedDataArray.length>20&&x.push("INSTANCED_ARRAYS");const T=zh(e,t.paint.get("model-cutoff-fade-range"));if(T.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),f&&p)E=e.getOrCreateProgram("modelDepth",{defines:x}),C=FC(u.shadowTileMatrix,u.shadowTileMatrix,Float32Array.from(n.matrix)),M=p.getShadowPassColorMode();else{hx(x,b,v,e),E=e.getOrCreateProgram("model",{defines:x,overrideFog:_});const P=v.material,I=P.pbrMetallicRoughness,O=t.paint.get("model-opacity"),L=t.paint.get("model-emissive-strength").constantOr(0);C=ix(c.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),e,O,I.baseColorFactor,P.emissiveFactor,I.metallicFactor,I.roughnessFactor,P,L,t,a),p&&(u.shadowUniformsInitialized?E.setShadowUniformValues(d,p.getShadowUniformValues()):(p.setupShadows(c.toUnwrapped(),E,"model-tile",c.overscaledZ),u.shadowUniformsInitialized=!0)),M=T.shouldRenderCutoff||O<1||"OPAQUE"!==P.alphaMode?Qe.alphaBlended:Qe.unblended}e.uploadCommonUniforms(d,E,c.toUnwrapped(),null,T);const R=v.material.doubleSided?ze.disabled:ze.backCCW;if(s.instancedDataArray.length>20)b.push(s.instancedDataBuffer),E.draw(e,d.gl.TRIANGLES,g,Se.disabled,M,R,C,t.id,v.vertexBuffer,v.indexBuffer,v.segments,t.paint,e.transform.zoom,void 0,b,s.instancedDataArray.length);else{const P=f?"u_instance":"u_normal_matrix";for(let I=0;I<s.instancedDataArray.length;++I)C[P]=new Float32Array(s.instancedDataArray.arrayBuffer,64*I,16),E.draw(e,d.gl.TRIANGLES,g,Se.disabled,M,R,C,t.id,v.vertexBuffer,v.indexBuffer,v.segments,t.paint,e.transform.zoom,void 0,b)}}if(n.children)for(const v of n.children)XI(e,t,v,s,a,c,u)}const LR=[1,-1,1];function Kf(e,t,n,s){if(!n.modelManager)return!0;const a=n.modelManager;if(!n.shadowRenderer)return!0;const c=n.shadowRenderer,u=t.aabb;let d=!0,f=e.maxHeight;if(0===f){let g=0;for(const _ in e.instancesPerModel){const v=a.getModel(_,s);v?g=Math.max(g,Math.max(Math.max(v.aabb.max[0],v.aabb.max[1]),v.aabb.max[2])):d=!1}f=e.maxScale*g*1.41+e.maxVerticalOffset,d&&(e.maxHeight=f)}u.max[2]=f,u.min[2]+=e.terrainElevationMin,u.max[2]+=e.terrainElevationMax,G.transformMat4(u.min,u.min,t.tileMatrix),G.transformMat4(u.max,u.max,t.tileMatrix);const p=u.intersects(c.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(e.isInsideFirstShadowMapFrustum=2===p),0===p}class KI{}class dx{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,s){{const _=this._storage.get(n.id);if(_)return _.lastUsedFrameIdx=t,_.buf}const a=s.gl,c=a.getBufferParameter(a.ELEMENT_ARRAY_BUFFER,a.BUFFER_SIZE),u=new ArrayBuffer(c),d=new Int16Array(u);a.getBufferSubData(a.ELEMENT_ARRAY_BUFFER,0,new Int16Array(u));const f=new Ea;for(let _=0;_<c/2;_+=3){const v=d[_],x=d[_+1],b=d[_+2];f.emplaceBack(v,x),f.emplaceBack(x,b),f.emplaceBack(b,v)}const p=s.bindVertexArrayOES.current,g=new KI;return g.buf=new Hc(s,f),g.lastUsedFrameIdx=t,this._storage.set(n.id,g),s.bindVertexArrayOES.set(p),g.buf}update(t){for(const[n,s]of this._storage)t-s.lastUsedFrameIdx>30&&(s.buf.destroy(),this._storage.delete(n))}destroy(){for(const[t,n]of this._storage)n.buf.destroy(),this._storage.delete(t)}}const ZC={symbol:function(e,t,n,s,a){if("translucent"!==e.renderPass)return;const c=Se.disabled,u=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(d,f,p,g,_,v,x){const b=f.transform,E="map"===_,C="map"===v;for(const M of d){const T=g.getTile(M),R=T.getBucket(p);if(!R||!R.text||!R.text.segments.get().length)continue;const P=vs(R.textSizeData,b.zoom),I=B0(M,R.getProjection(),b),O=b.calculatePixelsToTileUnitsMatrix(T),L=Zc(I,T.tileID.canonical,C,E,b,R.getProjection(),O),F=R.hasIconTextFit()&&R.hasIconData();if(P){const N=Math.pow(2,b.zoom-T.tileID.overscaledZ);zC(R,E,C,x,aS,b,L,M,N,P,F)}}}(s,e,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),a),0!==n.paint.get("icon-opacity").constantOr(1)&&Fg(e,t,n,s,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),n.paint.get("icon-color-saturation"),c,u),0!==n.paint.get("text-opacity").constantOr(1)&&Fg(e,t,n,s,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),n.paint.get("icon-color-saturation"),c,u),t.map.showCollisionBoxes&&(Io(e,t,n,s,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Io(e,t,n,s,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(e,t,n,s){if("translucent"!==e.renderPass)return;const a=n.paint.get("circle-opacity"),c=n.paint.get("circle-stroke-width"),u=n.paint.get("circle-stroke-opacity"),d=void 0!==n.layout.get("circle-sort-key").constantOr(1),f=n.paint.get("circle-emissive-strength");if(0===a.constantOr(1)&&(0===c.constantOr(1)||0===u.constantOr(1)))return;const p=e.context,g=p.gl,_=e.transform,v=e.depthModeForSublayer(0,de.ReadOnly),x=Se.disabled,b=e.colorModeForDrapableLayerRenderPass(f),E="globe"===_.projection.name,C=[Ri(_.center.lng),wi(_.center.lat)],M=[];for(let R=0;R<s.length;R++){const P=s[R],I=t.getTile(P),O=I.getBucket(n);if(!O||O.projection.name!==_.projection.name)continue;const L=O.programConfigurations.get(n.id),F=Xb(n),N=e.isTileAffectedByFog(P);E&&F.push("PROJECTION_GLOBE_VIEW");const B=e.getOrCreateProgram("circle",{config:L,defines:F,overrideFog:N}),V=O.layoutVertexBuffer,U=O.globeExtVertexBuffer,q=O.indexBuffer,j=_.projection.createInversionMatrix(_,P.canonical),X={programConfiguration:L,program:B,layoutVertexBuffer:V,globeExtVertexBuffer:U,indexBuffer:q,uniformValues:nh(e,P,I,j,C,n),tile:I};if(d){const Q=O.segments.get();for(const nt of Q)M.push({segments:new yn([nt]),sortKey:nt.sortKey,state:X})}else M.push({segments:O.segments,sortKey:0,state:X})}d&&M.sort((R,P)=>R.sortKey-P.sortKey);const T={useDepthForOcclusion:_.depthOcclusionForSymbolsAndCircles};for(const R of M){const{programConfiguration:P,program:I,layoutVertexBuffer:O,globeExtVertexBuffer:L,indexBuffer:F,uniformValues:N,tile:B}=R.state,V=R.segments;e.terrain&&e.terrain.setupElevationDraw(B,I,T),e.uploadCommonUniforms(p,I,B.tileID.toUnwrapped()),I.draw(e,g.TRIANGLES,v,x,b,ze.disabled,N,n.id,O,F,V,n.paint,_.zoom,P,[L])}},heatmap:function(e,t,n,s){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const a=e.context,c=a.gl,u=Se.disabled,d=new Qe([c.ONE,c.ONE,c.ONE,c.ONE],Pe.transparent,[!0,!0,!0,!0]);(function(x,b,E,C){const M=x.gl,T=b.width*C,R=b.height*C;x.activeTexture.set(M.TEXTURE1),x.viewport.set([0,0,T,R]);let P=E.heatmapFbo;if(!P||P&&(P.width!==T||P.height!==R)){P&&P.destroy();const I=M.createTexture();M.bindTexture(M.TEXTURE_2D,I),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_S,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_T,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,M.LINEAR),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,M.LINEAR),P=E.heatmapFbo=x.createFramebuffer(T,R,!0,null),function(O,L,F,N,B,V){const U=O.gl;U.texImage2D(U.TEXTURE_2D,0,O.extRenderToTextureHalfFloat?U.RGBA16F:U.RGBA,B,V,0,U.RGBA,O.extRenderToTextureHalfFloat?U.HALF_FLOAT:U.UNSIGNED_BYTE,null),N.colorAttachment.set(F)}(x,0,I,P,T,R)}else M.bindTexture(M.TEXTURE_2D,P.colorAttachment.get()),x.bindFramebuffer.set(P.framebuffer)})(a,e,n,"globe"===e.transform.projection.name?.5:.25),a.clear({color:Pe.transparent});const f=e.transform,p="globe"===f.projection.name,g=p?["PROJECTION_GLOBE_VIEW"]:[],_=p?ze.frontCCW:ze.disabled,v=[Ri(f.center.lng),wi(f.center.lat)];for(let x=0;x<s.length;x++){const b=s[x];if(t.hasRenderableParent(b))continue;const E=t.getTile(b),C=E.getBucket(n);if(!C||C.projection.name!==f.projection.name)continue;const M=e.isTileAffectedByFog(b),T=C.programConfigurations.get(n.id),R=e.getOrCreateProgram("heatmap",{config:T,defines:g,overrideFog:M}),{zoom:P}=e.transform;e.terrain&&e.terrain.setupElevationDraw(E,R),e.uploadCommonUniforms(a,R,b.toUnwrapped());const I=f.projection.createInversionMatrix(f,b.canonical);R.draw(e,c.TRIANGLES,de.disabled,u,d,_,kI(e,b,E,I,v,P,n.paint.get("heatmap-intensity")),n.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,n.paint,e.transform.zoom,T,p?[C.globeExtVertexBuffer]:null)}a.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(a,c){const u=a.context,d=u.gl,f=c.heatmapFbo;if(!f)return;u.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,f.colorAttachment.get()),u.activeTexture.set(d.TEXTURE1);let p=c.colorRampTexture;p||(p=c.colorRampTexture=new Qn(u,c.colorRamp,d.RGBA)),p.bind(d.LINEAR,d.CLAMP_TO_EDGE),a.getOrCreateProgram("heatmapTexture").draw(a,d.TRIANGLES,de.disabled,Se.disabled,a.colorModeForRenderPass(),ze.disabled,{u_image:0,u_color_ramp:1,u_opacity:c.paint.get("heatmap-opacity")},c.id,a.viewportBuffer,a.quadTriangleIndexBuffer,a.viewportSegments,c.paint,a.transform.zoom)}(e,n))},line:function(e,t,n,s){if("translucent"!==e.renderPass)return;const a=n.paint.get("line-opacity"),c=n.paint.get("line-width");if(0===a.constantOr(1)||0===c.constantOr(1))return;const u=n.paint.get("line-emissive-strength"),d=e.depthModeForSublayer(0,de.ReadOnly),f=e.colorModeForDrapableLayerRenderPass(u),p=e.terrain&&e.terrain.renderingToTexture?1:xe.devicePixelRatio,g=n.paint.get("line-dasharray"),_=g.constantOr(1),v=n.layout.get("line-cap"),x=n.paint.get("line-pattern"),b=x.constantOr(1),E=n.paint.get("line-pattern").constantOr(1),C=1!==n.paint.get("line-opacity").constantOr(1);let M=!E&&C;const T=n.paint.get("line-gradient"),R=b?"linePattern":"line",P=e.context,I=P.gl,O=NE(n);e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(M=!1);for(const L of s){const F=t.getTile(L);if(b&&!F.patternsLoaded())continue;const N=F.getBucket(n);if(!N)continue;e.prepareDrawTile();const B=N.programConfigurations.get(n.id),V=e.isTileAffectedByFog(L),U=e.getOrCreateProgram(R,{config:B,defines:O,overrideFog:V}),q=x.constantOr(null);if(q&&F.imageAtlas){const at=F.imageAtlas.patternPositions[q.toString()];at&&B.setConstantPatternPositions(at)}const j=g.constantOr(null),X=v.constantOr(null);if(!b&&j&&X&&F.lineAtlas){const at=F.lineAtlas.getDash(j,X);at&&B.setConstantPatternPositions(at)}let[Q,nt]=n.paint.get("line-trim-offset");("round"===X||"square"===X)&&Q!==nt&&(0===Q&&(Q-=1),1===nt&&(nt+=1));const Y=e.terrain?L.projMatrix:null,K=b?FE(e,F,n,Y,p):LE(e,F,n,Y,N.lineClipsArray.length,p,[Q,nt]);if(T){const at=N.gradients[n.id];let lt=at.texture;if(n.gradientVersion!==at.version){let dt=256;if(n.stepInterpolant){const ft=t.getSource().maxzoom,gt=L.canonical.z===ft?Math.ceil(1<<e.transform.maxZoom-L.canonical.z):1;dt=Qt(Yn(N.maxLineLength/ut*1024*gt),256,P.maxTextureSize)}at.gradient=Pm({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:dt,image:at.gradient||void 0,clips:N.lineClipsArray}),at.texture?at.texture.update(at.gradient):at.texture=new Qn(P,at.gradient,I.RGBA),at.version=n.gradientVersion,lt=at.texture}P.activeTexture.set(I.TEXTURE1),lt.bind(n.stepInterpolant?I.NEAREST:I.LINEAR,I.CLAMP_TO_EDGE)}_&&(P.activeTexture.set(I.TEXTURE0),F.lineAtlasTexture&&F.lineAtlasTexture.bind(I.LINEAR,I.REPEAT),B.updatePaintBuffers()),b&&(P.activeTexture.set(I.TEXTURE0),F.imageAtlasTexture&&F.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),B.updatePaintBuffers()),e.uploadCommonUniforms(P,U,L.toUnwrapped());const ot=at=>{U.draw(e,I.TRIANGLES,d,at,f,ze.disabled,K,n.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,n.paint,e.transform.zoom,B,[N.layoutVertexBuffer2])};if(M){const at=e.stencilModeForClipping(L).ref;0===at&&e.terrain&&P.clear({stencil:0});const lt={func:I.EQUAL,mask:255};K.u_alpha_discard_threshold=.8,ot(new Se(lt,at,255,I.KEEP,I.KEEP,I.INVERT)),K.u_alpha_discard_threshold=0,ot(new Se(lt,at,255,I.KEEP,I.KEEP,I.KEEP))}else ot(e.stencilModeForClipping(L))}M&&(e.resetStencilClippingMasks(),e.terrain&&P.clear({stencil:0}))},fill:function(e,t,n,s){const a=n.paint.get("fill-color"),c=n.paint.get("fill-opacity");if(0===c.constantOr(1))return;const u=n.paint.get("fill-emissive-strength"),d=e.colorModeForDrapableLayerRenderPass(u),f=n.paint.get("fill-pattern"),p=e.opaquePassEnabledForLayer()&&!f.constantOr(1)&&1===a.constantOr(Pe.transparent).a&&1===c.constantOr(0)?"opaque":"translucent";if(e.renderPass===p){const g=e.depthModeForSublayer(1,"opaque"===e.renderPass?de.ReadWrite:de.ReadOnly);jC(e,t,n,s,g,d,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){const g=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,de.ReadOnly);jC(e,t,n,s,g,d,!0)}},"fill-extrusion":function(e,t,n,s){const a=n.paint.get("fill-extrusion-opacity"),c=e.context,u=c.gl,d=e.terrain,f=d&&d.renderingToTexture,p=n.paint.get("fill-extrusion-cutoff-fade-range");if(0===a)return;const g=e.conflationActive&&e.layerUsedInConflation(n,t.getSource());if(g&&function(_,v,x,b){for(const E of b){const C=v.getTile(E).getBucket(x);C&&(C.updateReplacement(E,_.replacementSource),C.uploadCentroid(_.context))}}(e,t,n,s),d||g)for(const _ of s){const v=t.getTile(_).getBucket(n);v&&VI(e.context,t,_,v,n,d,g)}if("shadow"===e.renderPass&&e.shadowRenderer){const _=e.shadowRenderer;if(d&&a<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof as)return;const v=_.getShadowPassDepthMode(),x=_.getShadowPassColorMode();Yf(e,t,n,s,v,Se.disabled,x,g)}else if("translucent"===e.renderPass){const _=!n.paint.get("fill-extrusion-pattern").constantOr(1);if(!f){const v=new de(e.context.gl.LEQUAL,de.ReadWrite,e.depthRangeFor3D);0===p&&1===a&&_?Yf(e,t,n,s,v,Se.disabled,Qe.unblended,g):(Yf(e,t,n,s,v,Se.disabled,Qe.disabled,g),Yf(e,t,n,s,v,e.stencilModeFor3D(),e.colorModeForRenderPass(),g),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&_&&(!d&&"globe"!==e.transform.projection.name||f)){const v=n.paint.get("fill-extrusion-opacity"),x=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),b=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),E=n.paint.get("fill-extrusion-flood-light-intensity"),C=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),M=x>0&&b>0,T=E>0,R=(I,O,L)=>(1-L)*I+L*O,P=I=>{const O=e.depthModeForSublayer(1,de.ReadOnly,u.LEQUAL,!0),L=n.paint.get(I?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),F=R(.1,3,L),N=e._showOverdrawInspector;if(!N){const B=new Se({func:u.ALWAYS,mask:255},255,255,u.KEEP,u.KEEP,u.REPLACE),V=new Qe([u.ONE,u.ONE,u.ONE,u.ONE],Pe.transparent,[!1,!1,!1,!0],u.MIN);Jc(e,t,n,s,O,B,V,ze.disabled,I,"sdf",v,x,b,E,C,F,g,!1)}{const B=N?Se.disabled:new Se({func:u.EQUAL,mask:255},255,255,u.KEEP,u.DECR,u.DECR),V=N?e.colorModeForRenderPass():new Qe([u.ONE_MINUS_DST_ALPHA,u.DST_ALPHA,u.ONE,u.ONE],Pe.transparent,[!0,!0,!0,!0]);Jc(e,t,n,s,O,B,V,ze.disabled,I,"color",v,x,b,E,C,F,g,!1)}};if(f){const I=(O,L,F)=>{const N=e.depthModeForSublayer(1,de.ReadOnly,u.LEQUAL,!1),B=n.paint.get(O?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),V=R(.1,3,B);{const U=new Qe([u.ONE,u.ONE,u.ONE,u.ONE],Pe.transparent,[!1,!1,!1,!0]);Jc(e,t,n,s,N,Se.disabled,U,ze.disabled,O,"clear",v,x,b,E,C,V,g,L)}{const U=new Se({func:u.ALWAYS,mask:255},255,255,u.KEEP,u.KEEP,u.REPLACE),q=new Qe([u.ONE,u.ONE,u.ONE,u.ONE],Pe.transparent,[!1,!1,!1,!0],u.MIN);Jc(e,t,n,s,N,U,q,ze.disabled,O,"sdf",v,x,b,E,C,V,g,L)}{const U=O?u.ZERO:u.ONE_MINUS_DST_ALPHA,q=new Se({func:u.EQUAL,mask:255},255,255,u.KEEP,u.DECR,u.DECR),j=new Qe([U,u.DST_ALPHA,u.ONE_MINUS_DST_ALPHA,u.ZERO],Pe.transparent,[!0,!0,!0,!0]);Jc(e,t,n,s,N,q,j,ze.disabled,O,"color",v,x,b,E,C,V,g,L)}{const U=new Qe([u.ONE,u.ONE,u.ONE,O?u.ZERO:u.ONE],Pe.transparent,[!1,!1,!1,!0],O?u.FUNC_ADD:u.MAX);Jc(e,t,n,s,N,Se.disabled,U,ze.disabled,O,"clear",v,x,b,E,C,V,g,L,F)}};if(M||T){let O;if(e.prepareDrawTile(),d){const L=d.drapeBufferSize[0],F=d.drapeBufferSize[1];O=d.framebufferCopyTexture,O&&(!O||O.size[0]===L&&O.size[1]===F)||(O&&O.destroy(),O=d.framebufferCopyTexture=new Qn(c,new yi({width:L,height:F}),u.RGBA)),O.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,0,0,L,F,0)}M&&I(!0,!1,O),T&&I(!1,!0,O)}}else M&&P(!0),T&&P(!1)}}},hillshade:function(e,t,n,s){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass||e.style.disableElevatedTerrain)return;const a=e.context,c=e.terrain&&e.terrain.renderingToTexture,[u,d]="translucent"!==e.renderPass||c?[{},s]:e.stencilConfigForOverlap(s);for(const f of d){const p=t.getTile(f);if(p.needsHillshadePrepare&&"offscreen"===e.renderPass)TI(e,p,n);else if("translucent"===e.renderPass){const g=e.depthModeForSublayer(0,de.ReadOnly),_=n.paint.get("hillshade-emissive-strength"),v=e.colorModeForDrapableLayerRenderPass(_),x=c&&e.terrain?e.terrain.stencilModeForRTTOverlap(f):u[f.overscaledZ];DI(e,f,p,n,g,x,v)}}a.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,t,n,s,a,c){if("translucent"!==e.renderPass||0===n.paint.get("raster-opacity"))return;const u=e.context,d=u.gl,f=t.getSource(),p=function(L,F,N){const B=L.paint.get("raster-color"),V=[],U=L.paint.get("raster-resampling"),q=L.paint.get("raster-color-mix"),j=L.paint.get("raster-color-range"),X=[q[0],q[1],q[2],0],Q=q[3],nt="nearest"===U?N.NEAREST:N.LINEAR;if(B&&V.push("RASTER_COLOR"),B){F.activeTexture.set(N.TEXTURE2);let Y=L.colorRampTexture;Y||(Y=L.colorRampTexture=new Qn(F,L.colorRamp,N.RGBA)),Y.bind(N.LINEAR,N.CLAMP_TO_EDGE)}return{mix:X,range:j,offset:Q,defines:V,resampling:nt}}(n,u,d),g=p.defines,_="globe"===e.transform.projection.name;let v=!1;if(f instanceof Wo&&!s.length){if(!_)return;if(f.onNorthPole)v=!0,g.push("GLOBE_POLES");else{if(!f.onSouthPole)return;v=!0,g.push("GLOBE_POLES")}}const x=n.paint.get("raster-emissive-strength"),b=e.colorModeForDrapableLayerRenderPass(x),E=e.terrain&&e.terrain.renderingToTexture,C=f instanceof Wo&&0!==n.paint.get("raster-elevation"),M=!e.options.moving,T="nearest"===n.paint.get("raster-resampling")?d.NEAREST:d.LINEAR;if(v){const L=t.getSource();if(!(L instanceof Wo))return;const F=L.texture;if(!F)return;const N=e.globeSharedBuffers;if(!N)return;const B=new de(d.LEQUAL,de.ReadWrite,e.depthRangeFor3D),V=Float32Array.from(e.transform.expandedFarZProjMatrix);let U=Ju(0,0,e.transform);const q=Float32Array.from(Aa(Mo(new oo(0,0,0)))),j={opacity:1,mix:0};e.terrain&&e.terrain.prepareDrawTile(),u.activeTexture.set(d.TEXTURE0),F.bind(T,d.CLAMP_TO_EDGE),u.activeTexture.set(d.TEXTURE1),F.bind(T,d.CLAMP_TO_EDGE),F.useMipmap&&u.extTextureFilterAnisotropic&&e.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const[X,Q,nt,Y]=N.getPoleBuffers(0,!0);let K;L.onNorthPole?(K=X,e.renderDefaultNorthPole=!1):(U=it.scale(it.create(),U,[1,-1,1]),K=Q,e.renderDefaultSouthPole=!1);const ot=(lt=V,dt=q,ft=U,gt=j,ht=n,yt=L.perspectiveTransform||[0,0],Ot=n.paint.get("raster-elevation"),Ut=p.mix,Gt=p.offset,me=p.range,ie=x,LI(lt,dt,ft,new Float32Array(16),new Float32Array(9),[0,0],[0,0,0,0],0,[0,0],[0,0,0,0],1,gt,ht,yt||[0,0],Ot,2,Ut,Gt,me,1,0,ie)),at=e.getOrCreateProgram("raster",{defines:p.defines});return e.uploadCommonUniforms(u,at,null),void at.draw(e,d.TRIANGLES,B,Se.disabled,b,ze.disabled,ot,n.id,K,nt,Y)}var lt,dt,ft,gt,ht,yt,Ot,Ut,Gt,me,ie;if(!s.length)return;const[R,P]=f instanceof Wo||E?[{},s]:e.stencilConfigForOverlap(s),I=P[P.length-1].overscaledZ,O=C&&_;O&&p.defines.push("PROJECTION_GLOBE_VIEW"),C&&p.defines.push("RENDER_CUTOFF");for(const L of P){const F=L.toUnwrapped(),N=t.getTile(L);if(E&&(!N||!N.hasData())||!N.texture)continue;let B,V;E?(B=de.disabled,V=L.projMatrix):C?(B=new de(d.LEQUAL,de.ReadWrite,e.depthRangeFor3D),V=_?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(F,M)):(B=e.depthModeForSublayer(L.overscaledZ-I,1===n.paint.get("raster-opacity")?de.ReadWrite:de.ReadOnly,d.LESS),V=e.transform.calculateProjMatrix(F,M));const U=e.terrain&&E?e.terrain.stencilModeForRTTOverlap(L):R[L.overscaledZ],q=c?0:n.paint.get("raster-fade-duration");N.registerFadeDuration(q);const j=t.findLoadedParent(L,0),X=CC(N,j,t,e.transform,q);let Q,nt;e.terrain&&e.terrain.prepareDrawTile(),u.activeTexture.set(d.TEXTURE0),N.texture&&N.texture.bind(T,d.CLAMP_TO_EDGE),u.activeTexture.set(d.TEXTURE1),j?(j.texture&&j.texture.bind(T,d.CLAMP_TO_EDGE),Q=Math.pow(2,j.tileID.overscaledZ-N.tileID.overscaledZ),nt=[N.tileID.canonical.x*Q%1,N.tileID.canonical.y*Q%1]):N.texture&&N.texture.bind(T,d.CLAMP_TO_EDGE),N.texture&&N.texture.useMipmap&&u.extTextureFilterAnisotropic&&e.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const Y=e.transform,K=f instanceof Wo?f.perspectiveTransform:[0,0],ot=C?ax(Y):[0,0,0,0];let at,lt,dt,ft,gt,ht;if(O&&f instanceof Wo&&f.coordinates.length>3){at=Float32Array.from(Aa(Mo(new oo(0,0,0)))),lt=Float32Array.from(Y.globeMatrix),dt=Float32Array.from(vm(Y)),ft=[Ri(Y.center.lng),wi(Y.center.lat)],ht=[Ri(f.coordinates[1][0]),wi(f.coordinates[1][1]),Ri(f.coordinates[3][0]),wi(f.coordinates[3][1])];const Ut=new Ur(f.coordinates[1],f.coordinates[3]);gt=Float32Array.from($y(new oo(0,0,0),Ut,0,Y.worldSize/e.transform._pixelsPerMercatorPixel))}else at=new Float32Array(16),lt=new Float32Array(9),dt=new Float32Array(16),ft=[0,0],gt=new Float32Array(16),ht=[0,0,0,0];const yt=LI(V,at,lt,dt,gt,nt||[0,0],ht,ti(e.transform.zoom),ft,ot,Q||1,X,n,K,C?n.paint.get("raster-elevation"):0,2,p.mix,p.offset,p.range,1,0,x),Ot=e.isTileAffectedByFog(L),Lt=e.getOrCreateProgram("raster",{defines:p.defines,overrideFog:Ot});if(e.uploadCommonUniforms(u,Lt,F),f instanceof Wo){if(E||!_)f.boundsBuffer&&f.boundsSegments&&Lt.draw(e,d.TRIANGLES,B,Se.disabled,b,ze.disabled,yt,n.id,f.boundsBuffer,e.quadTriangleIndexBuffer,f.boundsSegments);else if(e.globeSharedBuffers){const[Ut,Gt,me]=e.globeSharedBuffers.getGridBuffers(0,!1);Lt.draw(e,d.TRIANGLES,B,Se.disabled,b,ze.frontCCW,yt,n.id,Ut,Gt,me),Lt.draw(e,d.TRIANGLES,B,Se.disabled,b,ze.backCCW,yt,n.id,Ut,Gt,me)}}else{const{tileBoundsBuffer:Ut,tileBoundsIndexBuffer:Gt,tileBoundsSegments:me}=e.getTileBoundsBuffers(N);Lt.draw(e,d.TRIANGLES,B,U,b,ze.disabled,yt,n.id,Ut,Gt,me)}}e.resetStencilClippingMasks()},background:function(e,t,n,s){const a=n.paint.get("background-color"),c=n.paint.get("background-opacity"),u=n.paint.get("background-emissive-strength");if(0===c)return;const d=e.context,f=d.gl,p=e.transform,g=p.tileSize,_=n.paint.get("background-pattern");if(e.isPatternMissing(_,n.scope))return;const v=!_&&1===a.a&&1===c&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==v)return;const x=Se.disabled,b=e.depthModeForSublayer(0,"opaque"===v?de.ReadWrite:de.ReadOnly),E=e.colorModeForDrapableLayerRenderPass(u),C=_?"backgroundPattern":"background";let M,T=s;T||(M=e.getBackgroundTiles(),T=Object.values(M).map(R=>R.tileID)),_&&(d.activeTexture.set(f.TEXTURE0),e.imageManager.bind(e.context,n.scope));for(const R of T){const P=e.isTileAffectedByFog(R),I=e.getOrCreateProgram(C,{overrideFog:P}),O=R.toUnwrapped(),L=s?R.projMatrix:e.transform.calculateProjMatrix(O);e.prepareDrawTile();const F=t?t.getTile(R):M?M[R.key]:new Js(R,g,p.zoom,e),N=_?Lg(L,u,c,e,_,n.scope,{tileID:R,tileSize:g}):LC(L,u,c,a);e.uploadCommonUniforms(d,I,O);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:V,tileBoundsSegments:U}=e.getTileBoundsBuffers(F);I.draw(e,f.TRIANGLES,b,x,E,ze.disabled,N,n.id,B,V,U)}},sky:function(e,t,n){const s=e._atmosphere?ti(e.transform.zoom):1,a=n.paint.get("sky-opacity")*s;if(0===a)return;const c=e.context,u=n.paint.get("sky-type"),d=new de(c.gl.LEQUAL,de.ReadOnly,[0,1]),f=e.frameCounter/1e3%1;"atmosphere"===u?"offscreen"===e.renderPass?n.needsSkyboxCapture(e)&&(function(p,g,_,v){const x=p.context,b=x.gl;let E=g.skyboxFbo;if(!E){E=g.skyboxFbo=x.createFramebuffer(32,32,!0,null),g.skyboxGeometry=new ux(x),g.skyboxTexture=x.gl.createTexture(),b.bindTexture(b.TEXTURE_CUBE_MAP,g.skyboxTexture),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MAG_FILTER,b.LINEAR);for(let R=0;R<6;++R)b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+R,0,b.RGBA,32,32,0,b.RGBA,b.UNSIGNED_BYTE,null)}x.bindFramebuffer.set(E.framebuffer),x.viewport.set([0,0,32,32]);const C=g.getCenter(p,!0),M=p.getOrCreateProgram("skyboxCapture"),T=new Float64Array(16);it.identity(T),it.rotateY(T,T,.5*-Math.PI),tu(p,g,M,T,C,0),it.identity(T),it.rotateY(T,T,.5*Math.PI),tu(p,g,M,T,C,1),it.identity(T),it.rotateX(T,T,.5*-Math.PI),tu(p,g,M,T,C,2),it.identity(T),it.rotateX(T,T,.5*Math.PI),tu(p,g,M,T,C,3),it.identity(T),tu(p,g,M,T,C,4),it.identity(T),it.rotateY(T,T,Math.PI),tu(p,g,M,T,C,5),x.viewport.set([0,0,p.width,p.height])}(e,n),n.markSkyboxValid(e)):"sky"===e.renderPass&&function(p,g,_,v,x){const b=p.context,E=b.gl,C=p.transform,M=p.getOrCreateProgram("skybox");b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_CUBE_MAP,g.skyboxTexture);const T={u_matrix:C.skyboxMatrix,u_sun_direction:g.getCenter(p,!1),u_cubemap:0,u_opacity:v,u_temporal_offset:x};p.uploadCommonUniforms(b,M),M.draw(p,E.TRIANGLES,_,Se.disabled,p.colorModeForRenderPass(),ze.backCW,T,"skybox",g.skyboxGeometry.vertexBuffer,g.skyboxGeometry.indexBuffer,g.skyboxGeometry.segment)}(e,n,d,a,f):"gradient"===u&&"sky"===e.renderPass&&function(p,g,_,v,x){const b=p.context,E=b.gl,C=p.transform,M=p.getOrCreateProgram("skyboxGradient");g.skyboxGeometry||(g.skyboxGeometry=new ux(b)),b.activeTexture.set(E.TEXTURE0);let T=g.colorRampTexture;T||(T=g.colorRampTexture=new Qn(b,g.colorRamp,E.RGBA)),T.bind(E.LINEAR,E.CLAMP_TO_EDGE);const R=(L=v,F=x,{u_matrix:C.skyboxMatrix,u_color_ramp:0,u_center_direction:g.getCenter(p,!1),u_radius:De(g.paint.get("sky-gradient-radius")),u_opacity:L,u_temporal_offset:F});var L,F;p.uploadCommonUniforms(b,M),M.draw(p,E.TRIANGLES,_,Se.disabled,p.colorModeForRenderPass(),ze.backCW,R,"skyboxGradient",g.skyboxGeometry.vertexBuffer,g.skyboxGeometry.indexBuffer,g.skyboxGeometry.segment)}(e,n,d,a,f)},debug:function(e,t,n){for(let s=0;s<n.length;s++)UC(e,t,n[s])},custom:function(e,t,n,s){const a=e.context,c=n.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&n.isLayerDraped(t)){if("offscreen"===e.renderPass){const u=c.prerender;if(u){if(e.setCustomLayerDefaults(),a.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const d=e.transform.pointMerc;u.call(c,a.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),ti(e.transform.zoom),[d.x,d.y],e.transform.pixelsPerMeterRatio)}else u.call(c,a.gl,e.transform.customLayerMatrix());a.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass){if(e.terrain&&e.terrain.renderingToTexture){const d=c.renderToTile;if(d){const f=s[0].canonical,p=new We(f.x+s[0].wrap*(1<<f.z),f.y,f.z);a.setDepthMode(de.disabled),a.setStencilMode(Se.disabled),a.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),d.call(c,a.gl,p),a.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),a.setColorMode(e.colorModeForRenderPass()),a.setStencilMode(Se.disabled);const u="3d"===c.renderingMode?new de(e.context.gl.LEQUAL,de.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,de.ReadOnly);if(a.setDepthMode(u),"globe"===e.transform.projection.name){const d=e.transform.pointMerc;c.render(a.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),ti(e.transform.zoom),[d.x,d.y],e.transform.pixelsPerMeterRatio)}else c.render(a.gl,e.transform.customLayerMatrix());a.setDirty(),e.setBaseState(),a.bindFramebuffer.set(null)}}else tt("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,t,n,s){if("opaque"===e.renderPass)return;const a=n.paint.get("model-opacity");if(0===a)return;const c=n.paint.get("model-cast-shadows");if("shadow"===e.renderPass&&(!c||e.terrain&&a<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof as))return;const u=e.shadowRenderer,d=n.paint.get("model-receive-shadows");u&&(u.useNormalOffset=!0,d||(u.enabled=!1));const f=()=>{u&&(u.useNormalOffset=!0,d||(u.enabled=!0))},p=t.getSource();if("light-beam"===e.renderPass&&"batched-model"!==p.type)return;if("vector"===p.type||"geojson"===p.type)return function(M,T,R,P){const I=M.transform;if("mercator"!==I.projection.name)return void tt(`Drawing 3D models for ${I.projection.name} projection is not yet implemented`);const O=I.getFreeCameraOptions().position;if(!M.modelManager)return;const L=M.modelManager,F=M.shadowRenderer;if(!R._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const N=R._unevaluatedLayout._values["model-id"],B={...R.layout.get("model-id").parameters};for(const V of P){const U=T.getTile(V).getBucket(R);if(!U||U.projection.name!==I.projection.name)continue;const q=kR(V,I);B.zoom=q;const j=N.possiblyEvaluate(B);if(qC(M,U,V),Yo.shadowUniformsInitialized=!1,Yo.useSingleShadowCascade=!!F&&0===F.getMaxCascadeForTile(V.toUnwrapped()),"shadow"===M.renderPass&&F){if(1===M.currentShadowCascade&&U.isInsideFirstShadowMapFrustum)continue;const nt=I.calculatePosMatrix(V.toUnwrapped(),I.worldSize);if(Yo.tileMatrix.set(nt),Yo.shadowTileMatrix=Float32Array.from(F.calculateShadowPassMatrixFromMatrix(nt)),Yo.aabb.min.fill(0),Yo.aabb.max[0]=Yo.aabb.max[1]=ut,Yo.aabb.max[2]=0,Kf(U,Yo,M,R.scope))continue}const X=1<<V.canonical.z,Q=[((O.x-V.wrap)*X-V.canonical.x)*ut,(O.y*X-V.canonical.y)*ut,O.z*X*ut];for(let nt in U.instancesPerModel){const Y=U.instancesPerModel[nt];Y.features.length>0&&(nt=j.evaluate(Y.features[0].feature,{}));const K=L.getModel(nt,R.scope);if(K&&K.uploaded)for(const ot of K.nodes)XI(M,R,ot,Y,Q,V,Yo)}}}(e,t,n,s),void f();if(!p.loaded())return;if("batched-model"===p.type)return function(M,T,R,P){const I=M.context,O=M.transform,L=M.style.fog,F=M.shadowRenderer;if("mercator"!==O.projection.name)return void tt(`Drawing 3D landmark models for ${O.projection.name} projection is not yet implemented`);const N=M.transform.getFreeCameraOptions().position,B=G.scale([],[N.x,N.y,N.z],M.transform.worldSize);G.negate(B,B);const V=it.identity([]),U=bl(O.center.lat,O.zoom),q=it.fromScaling([],[1,1,1/U]);it.translate(V,V,B);const j=R.paint.get("model-opacity"),X=new de(I.gl.LEQUAL,de.ReadWrite,M.depthRangeFor3D),Q=new de(I.gl.LEQUAL,de.ReadOnly,M.depthRangeFor3D),nt=function(Y,K){for(const ot of P){const at=T.getTile(ot).getBucket(R);if(!at||!at.uploaded)continue;let lt=!1;F&&(lt=0===F.getMaxCascadeForTile(ot.toUnwrapped()));const dt=O.calculatePosMatrix(ot.toUnwrapped(),O.worldSize),ft=at.modelTraits;for(const gt of at.getNodesInfo()){if(gt.hiddenByReplacement||!gt.node.meshes)continue;const ht=gt.node,yt="light-beam"===M.renderPass,Ot=[...dt],Lt=gt.evaluatedScale;let Ut=0;M.terrain&&ht.elevation&&(Ut=ht.elevation*M.terrain.exaggeration()),it.translate(Ot,Ot,[(ht.anchor?ht.anchor[0]:0)*(Lt[0]-1),(ht.anchor?ht.anchor[1]:0)*(Lt[1]-1),Ut]),Lt!==hg&&it.scale(Ot,Ot,Lt),it.multiply(Ot,Ot,ht.matrix);const Gt=it.multiply([],q,Ot);it.multiply(Gt,V,Gt);const me=it.invert([],Gt);it.transpose(me,me),it.scale(me,me,LR);const ie=it.multiply([],O.expandedFarZProjMatrix,Ot);for(let Je=0;Je<ht.meshes.length;++Je){const $e=ht.meshes[Je],pe=Je===ht.lightMeshIndex;if(pe){if(!yt&&!M.terrain&&M.shadowRenderer){M.currentLayer<M.firstLightBeamLayer&&(M.firstLightBeamLayer=M.currentLayer);continue}}else if(yt)continue;const ue={defines:[]},oe=[];hx(ue.defines,oe,$e,M),4&ft||ue.defines.push("DIFFUSE_SHADED"),lt&&ue.defines.push("SHADOWS_SINGLE_CASCADE");const He="shadow"===M.renderPass;if(He){GC($e,Ot,M,R);continue}let Ye=null;if(L){const ui=eu(Ot,M.transform);if(Ye=new Float32Array(ui),"globe"!==O.projection.name){const ni=$e.aabb.min,Bn=$e.aabb.max,[Tn,ar]=L.getOpacityForBounds(ui,ni[0],ni[1],Bn[0],Bn[1]);ue.overrideFog=Tn>=Fl||ar>=Fl}}const we=M.getOrCreateProgram("model",ue);!He&&F&&(F.useNormalOffset=!!$e.normalBuffer,F.setupShadowsFromMatrix(Ot,we,F.useNormalOffset)),M.uploadCommonUniforms(I,we,ot.toUnwrapped(),Ye);const Mn=$e.material,ei=Mn.pbrMetallicRoughness;ei.metallicFactor=.9,ei.roughnessFactor=.5;const gn=0,Wn=ix(new Float32Array(ie),new Float32Array(Gt),new Float32Array(me),M,j,ei.baseColorFactor,Mn.emissiveFactor,ei.metallicFactor,ei.roughnessFactor,Mn,gn,R);we.draw(M,I.gl.TRIANGLES,K&&!pe?X:Q,Se.disabled,Y?pe||j<1||gt.hasTranslucentParts?Qe.alphaBlended:Qe.unblended:Qe.disabled,ze.backCCW,Wn,R.id,$e.vertexBuffer,$e.indexBuffer,$e.segments,R.paint,M.transform.zoom,void 0,oe)}}}};(function(Y,K,ot,at){const lt=Y.terrain?Y.terrain.exaggeration():0,dt=Y.transform.zoom;for(const ft of at){const gt=K.getTile(ft).getBucket(ot);gt&&(Y.conflationActive&&gt.updateReplacement(ft,Y.replacementSource),gt.evaluateScale(Y,ot),Y.terrain&&lt>0&&gt.elevationUpdate(Y.terrain,lt,ft,ot.source),gt.needsReEvaluation(Y,dt,ot)&&gt.evaluate(ot))}})(M,T,R,P),1===j?nt(!0,!0):(nt(!1,!0),nt(!0,!1))}(e,t,n,s),void f();const g=p.getModels(),_=[],v=e.transform.getFreeCameraOptions().position,x=G.scale([],[v.x,v.y,v.z],e.transform.worldSize);G.negate(x,x);const b=[],E=[];let C=0;for(const M of g){const T=n.paint.get("model-rotation").constantOr(null),R=n.paint.get("model-scale").constantOr(null),P=n.paint.get("model-translation").constantOr(null);M.computeModelMatrix(e,T,R,P,!0,!0,!1);const I=it.identity([]),O=bl(M.position.lat,e.transform.zoom),L=it.fromScaling([],[1,1,1/O]);it.translate(I,I,x),_.push({zScaleMatrix:L,negCameraPosMatrix:I});for(const F of M.nodes)YI(e.transform,F,M.matrix,e.transform.expandedFarZProjMatrix,C,b,E);C++}if(b.sort((M,T)=>T.depth-M.depth),"shadow"!==e.renderPass){if(1===a)for(const M of E)jg(M,e,n,_[M.modelIndex],Se.disabled,e.colorModeForRenderPass());else{for(const M of E)jg(M,e,n,_[M.modelIndex],Se.disabled,Qe.disabled);for(const M of E)jg(M,e,n,_[M.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(const M of b)jg(M,e,n,_[M.modelIndex],Se.disabled,e.colorModeForRenderPass());f()}else{for(const M of E)GC(M.mesh,M.nodeModelMatrix,e,n);for(const M of b)GC(M.mesh,M.nodeModelMatrix,e,n);f()}}},fx={modelUpload:function(e,t,n){const s=t.getSource();if(!s.loaded())return;if("vector"===s.type||"geojson"===s.type)return void(e.modelManager&&e.modelManager.upload(e,n));if("batched-model"===s.type)return;const a=s.getModels();for(const c of a)c.upload(e.context)}};class QI{constructor(t,n,s){this.context=new rE(t,n),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=ws.maxUnderzooming+ws.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new bE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new WC(this),this._wireframeDebugCache=new dx,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(t,n){const s=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(s||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new MC(this,t));const a=this._terrain;this.transform.elevation=s?a:null,a.update(t,this.transform,n),this.transform.elevation&&!a.enabled&&(this.transform.elevation=null)}_updateFog(t){const n=t.fog;if(!n||"globe"===this.transform.projection.name||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[s,a]=n.getFovAdjustedRange(this.transform._fov);if(s>a)return void(this.transform.fogCullDistSq=null);const c=s+.78*(a-s);this.transform.fogCullDistSq=c*c}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*xe.devicePixelRatio,this.height=n*xe.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const s of this.style.order)this.style._mergedLayers[s].resize()}setup(){const t=this.context,n=new ro;n.emplaceBack(0,0),n.emplaceBack(ut,0),n.emplaceBack(0,ut),n.emplaceBack(ut,ut),this.tileExtentBuffer=t.createVertexBuffer(n,Gs.members),this.tileExtentSegments=yn.simpleSegment(0,0,4,2);const s=new ro;s.emplaceBack(0,0),s.emplaceBack(ut,0),s.emplaceBack(0,ut),s.emplaceBack(ut,ut),this.debugBuffer=t.createVertexBuffer(s,Gs.members),this.debugSegments=yn.simpleSegment(0,0,4,5);const a=new ro;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(-1,1),a.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(a,Gs.members),this.viewportSegments=yn.simpleSegment(0,0,4,2);const c=new cl;c.emplaceBack(0,0,0,0),c.emplaceBack(ut,0,ut,0),c.emplaceBack(0,ut,0,ut),c.emplaceBack(ut,ut,ut,ut),this.mercatorBoundsBuffer=t.createVertexBuffer(c,fo.members),this.mercatorBoundsSegments=yn.simpleSegment(0,0,4,2);const u=new Ai;u.emplaceBack(0,1,2),u.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(u);const d=new xc;for(const p of[0,1,3,2,0])d.emplaceBack(p);this.debugIndexBuffer=t.createIndexBuffer(d),this.emptyTexture=new Qn(t,new yi({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=it.create();const f=this.context.gl;this.stencilClearMode=new Se({func:f.ALWAYS,mask:0},0,255,f.ZERO,f.ZERO,f.ZERO),this.loadTimeStamps.push(st.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,de.disabled,this.stencilClearMode,Qe.disabled,ze.disabled,J0(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,n,s){if(!n||this.currentStencilSource===n.id||!t.isTileClipped()||!s||0===s.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let d=!1;for(const f of s)if(void 0===this._tileClippingMaskIDs[f.key]){d=!0;break}if(!d)return}this.currentStencilSource=n.id;const a=this.context,c=a.gl;this.nextStencilID+s.length>256&&this.clearStencil(),a.setColorMode(Qe.disabled),a.setDepthMode(de.disabled);const u=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const d of s){const f=n.getTile(d),p=this._tileClippingMaskIDs[d.key]=this.nextStencilID++,{tileBoundsBuffer:g,tileBoundsIndexBuffer:_,tileBoundsSegments:v}=this.getTileBoundsBuffers(f);u.draw(this,c.TRIANGLES,de.disabled,new Se({func:c.ALWAYS,mask:0},p,255,c.KEEP,c.KEEP,c.REPLACE),Qe.disabled,ze.disabled,J0(d.projMatrix),"$clipping",g,_,v)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Se({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new Se({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,s=t.sort((u,d)=>d.overscaledZ-u.overscaledZ),a=s[s.length-1].overscaledZ,c=s[0].overscaledZ-a+1;if(c>1){this.currentStencilSource=void 0,this.nextStencilID+c>256&&this.clearStencil();const u={};for(let d=0;d<c;d++)u[d+a]=new Se({func:n.GEQUAL,mask:255},d+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=c,[u,s]}return[{[a]:Se.disabled},s]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Qe([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new Pe(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Qe.unblended:Qe.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Qe([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new Pe(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,n,s,a=!1){if(!this.opaquePassEnabledForLayer()&&!a)return de.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new de(s||this.context.gl.LEQUAL,n,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this._wireframeDebugCache.update(this.frameCounter),this.style=t,this.options=n;const s=this.style._mergedLayers,a=this.style.order,c=a.map(I=>s[I]),u=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(xe.now()),this.imageManager.beginFrame();let d=0,f=!1;for(const I in u){const O=u[I];O.used&&(O.prepare(this.context),O.getSource().usedInConflation&&++d)}const p={},g={},_={},v={},x={};for(const I in u){const O=u[I];p[I]=O.getVisibleCoordinates(),g[I]=p[I].slice().reverse(),_[I]=O.getVisibleCoordinates(!0).reverse(),v[I]=O.getShadowCasterCoordinates(),x[I]=O.sortCoordinatesByDistance(p[I])}const b=I=>{const O=this.style.getLayerSourceCache(I);return O&&O.used?O.getSource():null};if(d){const I=[];for(const O of c)this.layerUsedInConflation(O,b(O))&&I.push(O);if(I&&I.length>1){const O=[];for(const L of I){const F=this.style.getLayerSourceCache(L);F&&F.used&&F.getSource().usedInConflation&&O.push({layer:L.fqid,cache:F})}this.replacementSource.setSources(O),f=!0}}f||this.replacementSource.clear(),this.conflationActive=f,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const I of c){const O=I.cutoffRange();if(this.longestCutoffRange=Math.max(O,this.longestCutoffRange),O>0){const L=b(I);L&&(this.minCutoffZoom=Math.max(L.minzoom,this.minCutoffZoom)),I.minzoom&&(this.minCutoffZoom=Math.max(I.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let I=0;I<c.length;I++)if(c[I].is3D()){this.opaquePassCutoff=I;break}const E=this.style&&this.style.fog;E?(this._fogVisible=0!==E.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=E.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(_),this.opaquePassCutoff=0);const C=this._shadowRenderer;if(C){C.updateShadowParameters(this.transform,this.style.directionalLight);for(const I in u)for(const O of p[I]){let L={min:0,max:0};this.terrain&&(L=this.terrain.getMinMaxForTile(O)||L),C.addShadowReceiver(O.toUnwrapped(),L.min,L.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new cR(this.context));for(const I of c){if(I.isHidden(this.transform.zoom))continue;const O=t.getLayerSourceCache(I);this.uploadLayer(this,I,O)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Xr),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Qa.has(this.context.gl))return;this.renderPass="offscreen";for(const I of c){const O=t.getLayerSourceCache(I);if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const L=O?g[O.id]:void 0;("custom"===I.type||"raster"===I.type||I.isSky()||L&&L.length)&&this.renderLayer(this,O,I,L)}this.depthRangeFor3D=[0,1-(c.length+2)*this.numSublayers*this.depthEpsilon];const M=this.terrain;M&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&M.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,v)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const T="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),R=(()=>{if(n.showOverdrawInspector)return Pe.black;if(this.style.fog&&this.transform.projection.supportsFog&&!T){const I=this.style.fog.properties.get("color").toArray01();return new Pe(...I)}if(this.style.fog&&this.transform.projection.supportsFog&&T){const I=this.style.fog.properties.get("space-color").toArray01();return new Pe(...I)}return Pe.transparent})();if(this.context.clear({color:R,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&T&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const I=c[this.currentLayer],O=t.getLayerSourceCache(I);if(I.isSky())continue;const L=O?(I.is3D()?x:g)[O.id]:void 0;this._renderTileClippingMasks(I,O,L),this.renderLayer(this,O,I,L)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&T&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||ti(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const I=c[this.currentLayer],O=t.getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,O,I,O?g[O.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let P=0;for(C&&(P=C.getShadowCastingLayerCount());this.currentLayer<a.length;){const I=c[this.currentLayer],O=t.getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(M&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=M.renderBatch(this.currentLayer);continue}let L;if(O&&(L=("symbol"===I.type?_:I.is3D()?x:g)[O.id]),this._renderTileClippingMasks(I,O,O?p[O.id]:void 0),this.renderLayer(this,O,I,L),!M&&C&&P>0&&I.hasShadowPass()&&0==--P&&(C.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const F=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=F;this.currentLayer++){const N=c[this.currentLayer];if(!N.hasLightBeamPass())continue;const B=t.getLayerSourceCache(N);this.renderLayer(this,B,N,B?g[B.id]:void 0)}this.currentLayer=F,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let I=null;c.forEach(O=>{const L=t.getLayerSourceCache(O);L&&!O.isHidden(this.transform.zoom)&&L.getVisibleCoordinates().length&&(!I||I.getSource().maxzoom<L.getSource().maxzoom)&&(I=L)}),I&&this.options.showTileBoundaries&&ZC.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const O=I.transform.padding;zg(I,I.transform.height-(O.top||0),3,lx),zg(I,O.bottom||0,3,$I),Bg(I,O.left||0,3,HI),Bg(I,I.transform.width-(O.right||0),3,GI);const L=I.transform.centerPoint;var F,N,B,V;Xf(F=I,(N=L.x)-1,(B=I.transform.height-L.y)-10,2,20,V=qI),Xf(F,N-10,B-1,20,2,V)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(st.performance.now()),this.saveCanvasCopy()),f||(this.conflationActive=!1)}uploadLayer(t,n,s){this.gpuTimingStart(n),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(n.type)||t.terrain&&"custom"===n.type)&&fx[`${n.type}Upload`]&&fx[`${n.type}Upload`](t,s,n.scope),this.gpuTimingEnd()}renderLayer(t,n,s,a){s.isHidden(this.transform.zoom)||("background"===s.type||"sky"===s.type||"custom"===s.type||"model"===s.type||"raster"===s.type||a&&a.length)&&(this.id=s.id,this.gpuTimingStart(s),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(s.type)||t.terrain&&"custom"===s.type)&&ZC[s.type](t,n,s,a,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,s=this.context.gl;let a=this.gpuTimers[t.id];a||(a=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQuery()}),a.calls++,s.beginQuery(n.TIME_ELAPSED_EXT,a.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,n=this.context.gl,s=n.createQuery();this.deferredRenderGpuTimeQueries.push(s),n.beginQuery(t.TIME_ELAPSED_EXT,s)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const n={};for(const s in t){const a=t[s],c=this.context.extTimerQuery,u=c.getQueryParameter(a.query,this.context.gl.QUERY_RESULT)/1e6;c.deleteQueryEXT(a.query),n[s]=u}return n}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.extTimerQuery,s=this.context.gl;let a=0;for(const c of t)a+=n.getQueryParameter(c,s.QUERY_RESULT)/1e6,n.deleteQueryEXT(c);return a}translatePosMatrix(t,n,s,a,c){if(!s[0]&&!s[1])return t;const u=c?"map"===a?this.transform.angle:0:"viewport"===a?-this.transform.angle:0;if(u){const p=Math.sin(u),g=Math.cos(u);s=[s[0]*g-s[1]*p,s[0]*p+s[1]*g]}const d=[c?s[0]:qc(n,s[0],this.transform.zoom),c?s[1]:qc(n,s[1],this.transform.zoom),0],f=new Float32Array(16);return it.translate(f,t,d),f}saveTileTexture(t){const n=t.size[0],s=this._tileTextures[n];s?s.push(t):this._tileTextures[n]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t,n){return null===t||void 0!==t&&!this.imageManager.getPattern(t.toString(),n)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(t,n,s){const a=void 0===s?this.terrain&&this.terrain.renderingToTexture:s,c=this.terrain&&0===this.terrain.exaggeration(),u=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===t||"terrainRaster"===t?(u.push("LIGHTING_3D_MODE"),u.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):a||u.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||u.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?u.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):u.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(u.push("TERRAIN"),this.linearFloatFilteringSupported()&&u.push("TERRAIN_DEM_FLOAT_FORMAT"),c&&u.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&u.push("GLOBE"),!this._fogVisible||a||void 0!==n&&!n||u.push("FOG","FOG_DITHERING"),a&&u.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&u.push("OVERDRAW_INSPECTOR"),u}getOrCreateProgram(t,n){this.cache=this.cache||{};const s=n&&n.defines||[],a=n&&n.config,c=this.currentGlobalDefines(t,n&&n.overrideFog,n&&n.overrideRtt).concat(s),u=IC.cacheKey(gC[t],t,c,a);return this.cache[u]||(this.cache[u]=new IC(this.context,t,gC[t],a,BI[t],c)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=st.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Qn(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const s=this.style.directionalLight,a=this.style.ambientLight;if(s&&a){const c=((u,d)=>{const f=u.properties.get("direction"),p=u.properties.get("color").toArray01(),g=u.properties.get("intensity"),_=d.properties.get("color").toArray01(),v=d.properties.get("intensity"),x=[f.x,f.y,f.z],b=ai(_,v),E=ai(p,g);return{u_lighting_ambient_color:b,u_lighting_directional_dir:x,u_lighting_directional_color:E,u_ground_radiance:TC(x,E,b)}})(s,a);n.setLightsUniformValues(t,c)}}}uploadCommonUniforms(t,n,s,a,c){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const u=this.style.fog;if(u){const d=u.getOpacity(this.transform.pitch),f=((p,g,_,v,x,b,E,C,M,T,R,P)=>{const I=p.transform,O=g.properties.get("color").toArray01();O[3]=v;const L=p.frameCounter/1e3%1,[F,N]=g.properties.get("vertical-range");return{u_fog_matrix:_?I.calculateFogTileMatrix(_):P||p.identityMat,u_fog_range:g.getFovAdjustedRange(I._fov),u_fog_color:O,u_fog_horizon_blend:g.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(F,N),N],u_fog_temporal_offset:L,u_frustum_tl:x,u_frustum_tr:b,u_frustum_br:E,u_frustum_bl:C,u_globe_pos:M,u_globe_radius:T,u_viewport:R,u_globe_transition:ti(I.zoom),u_is_globe:+("globe"===I.projection.name)}})(this,u,s,d,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*xe.devicePixelRatio,this.transform.height*xe.devicePixelRatio],a);n.setFogUniformValues(t,f)}c&&n.setCutoffUniformValues(t,c.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,n=this._backgroundTiles={},s=this.transform.coveringTiles({tileSize:512});for(const a of s)n[a.key]=t[a.key]||new Js(a,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(t,n){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||"building"!==t.sourceLayer&&(!n||"batched-model"!==n.type))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let n=this._cachedTileFogOpacities[t.key];return n||(this._cachedTileFogOpacities[t.key]=n=this.style.fog.getOpacityForTile(t)),n[0]>=Fl||n[1]>=Fl}}const nu=2048;class JI{constructor(t,n){this.aabb=t,this.lastCascade=n}}class px{add(t,n){const s=this.receivers[t.key];void 0!==s?(s.aabb.min[0]=Math.min(s.aabb.min[0],n.min[0]),s.aabb.min[1]=Math.min(s.aabb.min[1],n.min[1]),s.aabb.min[2]=Math.min(s.aabb.min[2],n.min[2]),s.aabb.max[0]=Math.max(s.aabb.max[0],n.max[0]),s.aabb.max[1]=Math.max(s.aabb.max[1],n.max[1]),s.aabb.max[2]=Math.max(s.aabb.max[2],n.max[2])):this.receivers[t.key]=new JI(n,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,n,s){const a=qn.fromPoints(t.points);let c=0;for(const u in this.receivers){const d=this.receivers[u];if(!d||!a.intersectsAabb(d.aabb))continue;d.aabb.min=a.closestPoint(d.aabb.min),d.aabb.max=a.closestPoint(d.aabb.max);const f=d.aabb.getCorners();for(let p=0;p<s.length;p++){let g=!0;for(const _ of f){const v=[_[0]*n,_[1]*n,_[2]];if(G.transformMat4(v,v,s[p].matrix),v[0]<-1||v[0]>1||v[1]<-1||v[1]>1){g=!1;break}}if(d.lastCascade=p,c=Math.max(c,p),g)break}}return c+1}}class WC{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new px,this._depthMode=new de(t.context.gl.LEQUAL,de.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const s=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const a=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||a<=0||(this._shadowLayerCount=s.style.order.reduce((x,b)=>{const E=s.style._mergedLayers[b];return x+(E.hasShadowPass()&&!E.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const c=s.context,u=nu,d=nu;if(0===this._cascades.length)for(let x=0;x<2;++x){const b=s._shadowMapDebug,E=c.gl,C=c.createFramebuffer(u,d,b,"texture"),M=new Qn(c,{width:u,height:d,data:null},E.DEPTH_COMPONENT);if(C.depthAttachment.set(M.texture),b){const T=new Qn(c,{width:u,height:d,data:null},E.RGBA);C.colorAttachment.set(T.texture)}this._cascades.push({framebuffer:C,texture:M,matrix:[],far:0,boundingSphereRadius:0,frustum:new so,scale:0})}this.shadowDirection=Qf(n);let f=0;if(t.elevation){const x=t.elevation,b=[1e4,-1e4];x.visibleDemTiles.filter(E=>E.dem).forEach(E=>{const C=E.dem.tree;b[0]=Math.min(b[0],C.minimums[0]),b[1]=Math.max(b[1],C.maximums[0])}),1e4!==b[0]&&(f=(b[1]-b[0])*x.exaggeration())}const p=1.5*t.cameraToCenterDistance,g=3*p,_=new Float64Array(16);for(let x=0;x<2;++x){const b=this._cascades[x];let E=t.height/50,C=1;0===x?C=p:(E=p,C=g);const[M,T]=FR(t,this.shadowDirection,E,C,nu,f);b.scale=t.scale,b.matrix=M,b.boundingSphereRadius=T,it.invert(_,b.matrix),b.frustum=so.fromInvProjectionMatrix(_,1,0,!0),b.far=C}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=a,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=nu,this._uniformValues.u_shadowmap_0=mo.ShadowMap0,this._uniformValues.u_shadowmap_1=mo.ShadowMap0+1,this._groundShadowTiles=s.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const v=s.transform.elevation;for(const x of this._groundShadowTiles){let b={min:0,max:0};if(v){const E=v.getMinMaxForTile(x);E&&(b=E)}this.addShadowReceiver(x.toUnwrapped(),b.min,b.max)}}get enabled(){return this._enabled}set enabled(t){this._enabled=t}drawShadowPass(t,n){if(!this._enabled)return;const s=this.painter,a=s.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(s.transform.getFrustum(0),s.transform.worldSize,this._cascades),a.viewport.set([0,0,nu,nu]);for(let c=0;c<this._numCascadesToRender;++c){s.currentShadowCascade=c,a.bindFramebuffer.set(this._cascades[c].framebuffer.framebuffer),a.clear({color:Pe.white,depth:1});for(const u of t.order){const d=t._mergedLayers[u];if(!d.hasShadowPass()||d.isHidden(s.transform.zoom))continue;const f=t.getLayerSourceCache(d),p=f?n[f.id]:void 0;("model"===d.type||p&&p.length)&&s.renderLayer(s,f,d,p)}}s.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const t=this.painter,n=t.style,s=t.context,a=n.directionalLight,c=n.ambientLight;if(!a||!c)return;const u=[],d=zh(t,t.longestCutoffRange);d.shouldRenderCutoff&&u.push("RENDER_CUTOFF");const f=Jf(a,c),p=new de(s.gl.LEQUAL,de.ReadOnly,t.depthRangeFor3D);for(const g of this._groundShadowTiles){const _=g.toUnwrapped(),v=t.isTileAffectedByFog(g),x=t.getOrCreateProgram("groundShadow",{defines:u,overrideFog:v});this.setupShadows(_,x),t.uploadCommonUniforms(s,x,_,null,d);const b={u_matrix:t.transform.calculateProjMatrix(_),u_ground_shadow_factor:f};x.draw(t,s.gl.TRIANGLES,p,Se.disabled,Qe.multiply,ze.disabled,b,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Qe.unblended:Qe.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,s=n.calculatePosMatrix(t,n.worldSize);return it.multiply(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}calculateShadowPassMatrixFromMatrix(t){return it.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,s,a=0){if(!this._enabled)return;const c=this.painter.transform,u=this.painter.context,d=u.gl,f=this._uniformValues,p=new Float64Array(16),g=c.calculatePosMatrix(t,c.worldSize);for(let _=0;_<2;_++)it.multiply(p,this._cascades[_].matrix,g),f[0===_?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(p),u.activeTexture.set(d.TEXTURE0+mo.ShadowMap0+_),this._cascades[_].texture.bind(d.NEAREST,d.CLAMP_TO_EDGE);if(this.useNormalOffset=!!s,this.useNormalOffset){const _=Wd(t.canonical),v=2/c.tileSize*ut/nu,x=v*this._cascades[0].boundingSphereRadius,b=v*this._cascades[1].boundingSphereRadius,E=("vector-tile"===s?1:3)/Math.pow(2,a-t.canonical.z-(1-c.zoom+Math.floor(c.zoom)));f.u_shadow_normal_offset=[_,x*E,b*E],f.u_shadow_bias=[6e-5,.0012,.012]}else f.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(u,f)}setupShadowsFromMatrix(t,n,s=!1){if(!this._enabled)return;const a=this.painter.context,c=a.gl,u=this._uniformValues,d=new Float64Array(16);for(let f=0;f<2;f++)it.multiply(d,this._cascades[f].matrix,t),u[0===f?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(d),a.activeTexture.set(c.TEXTURE0+mo.ShadowMap0+f),this._cascades[f].texture.bind(c.NEAREST,c.CLAMP_TO_EDGE);this.useNormalOffset=s,s?(u.u_shadow_normal_offset=[1,5,5],u.u_shadow_bias=[6e-5,.0012,.012]):u.u_shadow_bias=[36e-5,.0012,.012],n.setShadowUniformValues(a,u)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,s,a){if(a[2]>=0)return{};const c=function(f,p,g){const _=g/(1<<f.canonical.z);return new qn([f.canonical.x*_+f.wrap*g,f.canonical.y*_+f.wrap*g,0],[(f.canonical.x+1)*_+f.wrap*g,(f.canonical.y+1)*_+f.wrap*g,p])}(t,n,s).getCorners(),u=n/-a[2];a[0]<0?(G.add(c[0],c[0],[a[0]*u,0,0]),G.add(c[3],c[3],[a[0]*u,0,0])):a[0]>0&&(G.add(c[1],c[1],[a[0]*u,0,0]),G.add(c[2],c[2],[a[0]*u,0,0])),a[1]<0?(G.add(c[0],c[0],[0,a[1]*u,0]),G.add(c[1],c[1],[0,a[1]*u,0])):a[1]>0&&(G.add(c[2],c[2],[0,a[1]*u,0]),G.add(c[3],c[3],[0,a[1]*u,0]));const d={};return d.vertices=c,d.planes=[Vg(c[1],c[0],c[4]),Vg(c[2],c[1],c[5]),Vg(c[3],c[2],c[6]),Vg(c[0],c[3],c[7])],d}addShadowReceiver(t,n,s){this._receivers.add(t,qn.fromTileIdAndHeight(t,n,s))}getMaxCascadeForTile(t){const n=this._receivers.get(t);return n&&n.lastCascade?n.lastCascade:0}}function Vg(e,t,n){const s=G.sub([],n,t),a=G.sub([],e,t),c=G.cross([],s,a),u=G.length(c);return 0===u?[0,0,1,0]:(G.scale(c,c,1/u),[c[0],c[1],c[2],-G.dot(c,t)])}function Qf(e){const t=e.properties.get("direction"),n=ne(t.x,t.y,t.z);n[2]=Qt(n[2],0,75);const s=$t([n[0],n[1],n[2]]);return G.fromValues(s.x,s.y,s.z)}function Jf(e,t){const n=e.properties.get("color"),s=e.properties.get("intensity"),a=e.properties.get("direction"),c=[a.x,a.y,a.z],u=t.properties.get("color"),d=t.properties.get("intensity"),f=Math.max(G.dot([0,0,1],c),0),p=[0,0,0];G.scale(p,u.toArray01Linear().slice(0,3),d);const g=[0,0,0];return G.scale(g,n.toArray01Linear().slice(0,3),f*s),Un([p[0]>0?p[0]/(p[0]+g[0]):0,p[1]>0?p[1]/(p[1]+g[1]):0,p[2]>0?p[2]/(p[2]+g[2]):0])}function FR(e,t,n,s,a,c){const u=e.zoom,d=e.scale,f=e.worldSize,p=1/f,g=e.aspect,_=Math.sqrt(1+g*g)*Math.tan(.5*e.fovX),v=_*_,x=s-n,b=s+n;let E,C;v>x/b?(E=s,C=s*_):(E=.5*b*(1+v),C=.5*Math.sqrt(x*x+2*(s*s+n*n)*v+b*b*v*v));const M=e.projection.pixelsPerMeter(e.center.lat,f),T=e._camera.getCameraToWorldMercator(),R=[0,0,-E*p];G.transformMat4(R,R,T);let P=C*p;const I=e._edgeInsets;if(!(0===I.left&&0===I.top&&0===I.right&&0===I.bottom||I.left===I.right&&I.top===I.bottom)){const at=e._camera.getWorldToCamera(e.worldSize,"meters"===e.projection.zAxisUnit?M:1),lt=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,n,s);lt[8]=2*-e.centerOffset.x/e.width,lt[9]=2*e.centerOffset.y/e.height;const dt=new Float64Array(16);it.mul(dt,lt,at);const ft=new Float64Array(16);it.invert(ft,dt);const gt=so.fromInvProjectionMatrix(ft,f,u,!0);for(const ht of gt.points){const yt=((O=ht)[0]/=d,O[1]/=d,O[2]=An(O[2],e._center.lat),O);P=Math.max(P,G.len(G.subtract([],R,yt)))}}var O;P*=a/(a-1);const L=Math.acos(t[2]),F=Math.atan2(-t[0],-t[1]),N=new cg;N.position=R,N.setPitchBearing(L,F);const B=N.getWorldToCamera(f,M),V=P*f,U=Math.min(e._mercatorZfromZoom(17)*f*-2,-2*V),q=N.getCameraToClipOrthographic(-V,V,-V,V,U,(V+c*M)/t[2]),j=new Float64Array(16);it.multiply(j,q,B);const X=G.fromValues(Math.floor(1e6*R[0])/1e6*f,Math.floor(1e6*R[1])/1e6*f,0),Q=.5*a,nt=[0,0,0];G.transformMat4(nt,X,j),G.scale(nt,nt,Q);const Y=[Math.floor(nt[0]),Math.floor(nt[1]),Math.floor(nt[2])],K=[0,0,0];G.sub(K,nt,Y),G.scale(K,K,-1/Q);const ot=new Float64Array(16);return it.identity(ot),it.translate(ot,ot,K),it.multiply(j,ot,j),[j,V]}class YC extends Be{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,n){return eC(this.requestManager.transformRequest(n,pt.Model).url).then(s=>{if(!s)return;const a=Dg(s),c=new za(t,void 0,void 0,a);return c.computeBoundsAndApplyParent(),c}).catch(s=>{this.fire(new zt(new Error(`Could not load model ${t} from ${n}: ${s.message}`)))})}load(t,n){this.models[n]||(this.models[n]={});const s=Object.keys(t);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+s.length;const a=[];for(const c of s)a.push(this.loadModel(c,t[c]));Promise.allSettled(a).then(c=>{for(let u=0;u<c.length;u++){const{status:d,value:f}=c[u];"fulfilled"===d&&f&&(this.models[n][s[u]]=f)}this.numModelsLoading[n]-=s.length,this.fire(new Dt("data",{dataType:"style"}))}).catch(c=>{this.fire(new zt(new Error(`Could not load models: ${c.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,n){return!!this.getModel(t,n)}getModel(t,n){return this.models[n]||(this.models[n]={}),this.models[n][t]}addModel(t,n,s){this.models[s]||(this.models[s]={}),this.hasModel(t,s)&&this.removeModel(t,s),this.load({[t]:this.requestManager.normalizeModelURL(n)},s)}addModels(t,n){const s={};for(const a in t)s[a]=this.requestManager.normalizeModelURL(t[a]);this.load(s,n)}removeModel(t,n){this.models[n]||(this.models[n]={});const s=this.models[n][t];delete this.models[n][t],s.destroy()}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,n){this.models[n]||(this.models[n]={});for(const s in this.models[n])this.models[n][s].upload(t.context)}}const tp=(e,t)=>vd(e,t&&t.filter(n=>"source.canvas"!==n.identifier)),XC=Or(cn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),jh=Or(cn,["setCenter","setZoom","setBearing","setPitch"]),KC={version:8,layers:[],sources:{}},mx={duration:300,delay:0},gx=new Set(["fill","line","background","hillshade","raster"]);class oa extends Be{constructor(t,n={}){super(),this.map=t,this.scope=n.scope||"",this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=qt({},mx),this._buildingIndex=new hI(this),this.crossTileSymbolIndex=new Z0,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new aT,this.dispatcher=n.dispatcher?n.dispatcher:new b0(Ff(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new UE,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new Al(t._requestManager,n.localFontFamily?2:n.localIdeographFontFamily?1:0,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new YC(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this._config=n.config,this.dispatcher.broadcast("setReferrer",Tt());const s=this;this._rtlTextPluginCallback=oa.registerForPluginStateChange(a=>{s.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:a.pluginStatus,pluginURL:a.pluginURL},(c,u)=>{if(B1(c),u&&u.every(d=>d))for(const d in s._sourceCaches){const f=s._sourceCaches[d],p=f.getSource().type;"vector"!==p&&"geojson"!==p||f.reload()}})}),this.on("data",a=>{if("source"!==a.dataType||"metadata"!==a.sourceDataType)return;const c=this.getOwnSource(a.sourceId);if(c&&c.vectorLayerIds)for(const u in this._layers){const d=this._layers[u];d.source===c.id&&this._validateLayer(d)}})}loadURL(t,n={}){this.fire(new Dt("dataloading",{dataType:"style"}));const s="boolean"==typeof n.validate?n.validate:!_n(t);t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const a=this.importsCache.get(t);if(a)return this._load(a,s);const c=this.map._requestManager.transformRequest(t,pt.Style);this._request=It(c,(u,d)=>{if(this._request=null,u)this.fire(new zt(u));else if(d)return this.importsCache.set(t,d),this._load(d,s)})}loadJSON(t,n={}){this.fire(new Dt("dataloading",{dataType:"style"})),this._request=xe.frame(()=>{this._request=null,this._load(t,!1!==n.validate)})}loadEmpty(){this.fire(new Dt("dataloading",{dataType:"style"})),this._load(KC,!1)}_loadImports(t,n){if(this.importDepth>=4)return tt("Style doesn't support nesting deeper than 5"),Promise.resolve();const s=[];for(const a of t){const c=this._createFragmentStyle(a),u=new Promise(f=>{c.once("style.import.load",f),c.once("error",f)}).then(()=>this.mergeAll());if(s.push(u),this.resolvedImports.has(a.url)){c.loadEmpty();continue}const d=a.data||this.importsCache.get(a.url);d?c.loadJSON(d,{validate:n}):a.url?c.loadURL(a.url,{validate:n}):c.loadEmpty(),this.fragments.push({style:c,id:a.id,config:a.config})}return Promise.allSettled(s)}_createFragmentStyle(t){const n=this.scope?cr(t.id,this.scope):t.id,s=new oa(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:t.config});return s.setEventedParent(this.map,{style:s}),s}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const t=this.isRootStyle();this._shouldPrecompile=t,this.fire(new Dt(t?"style.load":"style.import.load"))}_load(t,n){const s=t.schema;if(this.isRootStyle()&&(t.fragment||s&&!1!==t.fragment)){const u=qt({},KC,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(u,n)}if(this.setConfig(this._config,s),n&&tp(this,er(t)))return;this._loaded=!0,this.stylesheet=$(t);for(const u in t.sources)this.addSource(u,t.sources[u],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const a=iC(this.stylesheet.layers);if(this._order=a.map(u=>u.id),this.stylesheet.light&&tt("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const u=this.stylesheet.lights[0];this.light=new _0(u.properties,u.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new _0(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const u of a){const d=mg(u,this.options);d.setScope(this.scope),d.isConfigDependent&&this._configDependentLayers.add(d.fqid),d.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=d,this._serializedLayers[d.id]=d.serialize();const f=this.getOwnLayerSourceCache(d),p=!!this.directionalLight&&this.directionalLight.shadowsEnabled();f&&d.canCastShadows()&&p&&(f.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const c=this.stylesheet.terrain;c&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=xe.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?tt("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(c,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new Dt("data",{dataType:"style"})),t.imports?this._loadImports(t.imports,n).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,n,s,a,c,u,d,f;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(p=>{if(p.stylesheet){if(null!=p.light&&(t=p.light),p.stylesheet.lights)for(const g of p.stylesheet.lights)"ambient"===g.type&&null!=p.ambientLight&&(n=p.ambientLight),"directional"===g.type&&null!=p.directionalLight&&(s=p.directionalLight);a=this._prioritizeTerrain(a,p.terrain,p.stylesheet.terrain),p.stylesheet.fog&&null!=p.fog&&(c=p.fog),null!=p.stylesheet.camera&&(f=p.stylesheet.camera),null!=p.stylesheet.projection&&(u=p.stylesheet.projection),null!=p.stylesheet.transition&&(d=p.stylesheet.transition)}}),this.light=t,this.ambientLight=n,this.directionalLight=s,this.fog=c,null===a?delete this.terrain:this.terrain=a,this.camera=f||{"camera-projection":"perspective"},this.projection=u||{name:"mercator"},this.transition=qt({},mx,d),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const n=s=>{for(const a of s.fragments)n(a.style);t(s)};n(this)}_prioritizeTerrain(t,n,s){const a=t&&0===t.drapeRenderMode;return null===s?n&&0===n.drapeRenderMode?n:a?t:null:null!=n&&(!t||a||n&&1===n.drapeRenderMode)?n:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{t=this._prioritizeTerrain(t,n.terrain,n.stylesheet.terrain)}),null===t?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(n=>{null!=n.stylesheet.projection&&(t=n.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},n={},s={};this.forEachFragmentStyle(a=>{for(const c in a._sourceCaches){const u=cr(c,a.scope);t[u]=a._sourceCaches[c]}for(const c in a._otherSourceCaches){const u=cr(c,a.scope);n[u]=a._otherSourceCaches[c]}for(const c in a._symbolSourceCaches){const u=cr(c,a.scope);s[u]=a._symbolSourceCaches[c]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=s}mergeLayers(){const t={},n=[],s={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(c=>{for(const u of c._order){const d=c._layers[u];if("slot"===d.type){const f=bd(u);if(t[f])continue;t[f]=[]}d.slot&&t[d.slot]?t[d.slot].push(d):n.push(d)}}),this._mergedOrder=[];const a=(c=[])=>{for(const u of c)if("slot"===u.type){const d=bd(u.id);t[d]&&a(t[d])}else{const d=cr(u.id,u.scope);this._mergedOrder.push(d),s[d]=u,u.is3D()&&(this._has3DLayers=!0),"circle"===u.type&&(this._hasCircleLayers=!0),"symbol"===u.type&&(this._hasSymbolLayers=!0)}};a(n),this._mergedLayers=s,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=qt({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(n,s,a){let c,u,d;const f=xe.devicePixelRatio>1?"@2x":"";let p=It(s.transformRequest(s.normalizeSpriteURL(n,f,".json"),pt.SpriteJSON),(v,x)=>{p=null,d||(d=v,c=x,_())}),g=Ie(s.transformRequest(s.normalizeSpriteURL(n,f,".png"),pt.SpriteImage),(v,x)=>{g=null,d||(d=v,u=x,_())});function _(){if(d)a(d);else if(c&&u){const v=xe.getImageData(u),x={};for(const b in c){const{width:E,height:C,x:M,y:T,sdf:R,pixelRatio:P,stretchX:I,stretchY:O,content:L}=c[b],F=new yi({width:E,height:C});yi.copy(v,F,{x:M,y:T},{x:0,y:0},{width:E,height:C}),x[b]={data:F,pixelRatio:P,sdf:R,stretchX:I,stretchY:O,content:L}}a(null,x)}}return{cancel(){p&&(p.cancel(),p=null),g&&(g.cancel(),g=null)}}}(t,this.map._requestManager,(n,s)=>{if(this._spriteRequest=null,n)this.fire(new zt(n));else if(s)for(const a in s)this.imageManager.addImage(a,this.scope,s[a]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Dt("data",{dataType:"style"}))})}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const s=t.sourceLayer;s&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(s))&&this.fire(new zt(new Error(`Source layer "${s}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,n)=>{const s=this.fragments[n];return s&&s.style&&(t.data=s.style.serialize()),t})}_serializeSources(){const t={};for(const n in this._sourceCaches){const s=this._sourceCaches[n].getSource();t[s.id]||(t[s.id]=s.serialize())}return t}_serializeLayers(t){const n=[];for(const s of t){const a=this._layers[s];a&&"custom"!==a.type&&n.push(a.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&("function"==typeof t.isLayerDraped?t.isLayerDraped(this.getLayerSourceCache(t)):gx.has(t.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new zt(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new zt(new Error(`The source '${t}' does not exist in the map's style.`)))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const s=this._changes.isDirty();if(this._changes.isDirty()){const c=this._changes.getLayerUpdatesByScope();for(const u in c){const{updatedIds:d,removedIds:f}=c[u];(d||f)&&this._updateWorkerLayers(u,d,f)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const a={};for(const c in this._mergedSourceCaches){const u=this._mergedSourceCaches[c];a[c]=u.used,u.used=!1}for(const c of this._mergedOrder){const u=this._mergedLayers[c];if(u.recalculate(t,this._availableImages),!u.isHidden(t.zoom)){const d=this.getLayerSourceCache(u);d&&(d.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let d=u.minzoom||0;d<(u.maxzoom||25.5);d++){const f=this.map.painter;if(f){const p=u.getProgramIds();if(!p)continue;for(const g of p){const _=u.getDefaultProgramParams(g,t.zoom);_&&(f.style=this,this.fog&&(f._fogVisible=!0,_.overrideFog=!0,f.getOrCreateProgram(g,_)),f._fogVisible=!1,_.overrideFog=!1,f.getOrCreateProgram(g,_),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(_.overrideRtt=!0,f.getOrCreateProgram(g,_)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const c in a){const u=this._mergedSourceCaches[c];a[c]!==u.used&&u.getSource().fire(new Dt("data",{sourceDataType:"visibility",dataType:"source",sourceId:u.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new Dt("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const n in this._sourceCaches)this._sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,n,s){const a=this.getFragmentStyle(t);a&&this.dispatcher.broadcast("updateLayers",{layers:n?a._serializeLayers(n):[],scope:t,removedIds:s||[],options:a.options})}setState(t){if(this._checkLoaded(),tp(this,er(t)))return!1;(t=$(t)).layers=iC(t.layers);const n=function(a,c){if(!a)return[{command:cn.setStyle,args:[c]}];let u=[];try{if(!Xe(a.version,c.version))return[{command:cn.setStyle,args:[c]}];Xe(a.center,c.center)||u.push({command:cn.setCenter,args:[c.center]}),Xe(a.zoom,c.zoom)||u.push({command:cn.setZoom,args:[c.zoom]}),Xe(a.bearing,c.bearing)||u.push({command:cn.setBearing,args:[c.bearing]}),Xe(a.pitch,c.pitch)||u.push({command:cn.setPitch,args:[c.pitch]}),Xe(a.sprite,c.sprite)||u.push({command:cn.setSprite,args:[c.sprite]}),Xe(a.glyphs,c.glyphs)||u.push({command:cn.setGlyphs,args:[c.glyphs]}),Xe(a.imports,c.imports)||function(_=[],v=[],x){v=v||[];const b=(_=_||[]).map(Fh),E=v.map(Fh),C=_.reduce(Tg,{}),M=v.reduce(Tg,{}),T=b.slice();let R,P,I,O;for(R=0,P=0;R<b.length;R++)I=b[R],M.hasOwnProperty(I)?P++:(x.push({command:cn.removeImport,args:[I]}),T.splice(T.indexOf(I,P),1));for(R=0,P=0;R<E.length;R++)I=E[E.length-1-R],T[T.length-1-R]!==I&&(C.hasOwnProperty(I)?(x.push({command:cn.removeImport,args:[I]}),T.splice(T.lastIndexOf(I,T.length-P),1)):P++,O=T[T.length-R],x.push({command:cn.addImport,args:[M[I],O]}),T.splice(T.length-R,0,I));for(const L of v){const F=C[L.id];if(!F||Xe(F,L))continue;Xe(F.config,L.config)||x.push({command:cn.setImportConfig,args:[L.id,L.config]}),Xe(F.url,L.url)||x.push({command:cn.setImportUrl,args:[L.id,L.url]});const N=L.data;Xe(F&&F.data,N)||x.push({command:cn.setImportData,args:[L.id,N]})}}(a.imports,c.imports,u),Xe(a.transition,c.transition)||u.push({command:cn.setTransition,args:[c.transition]}),Xe(a.light,c.light)||u.push({command:cn.setLight,args:[c.light]}),Xe(a.fog,c.fog)||u.push({command:cn.setFog,args:[c.fog]}),Xe(a.projection,c.projection)||u.push({command:cn.setProjection,args:[c.projection]}),Xe(a.lights,c.lights)||u.push({command:cn.setLights,args:[c.lights]}),Xe(a.camera,c.camera)||u.push({command:cn.setCamera,args:[c.camera]});const d={},f=[];!function(_,v,x,b){let E;for(E in v=v||{},_=_||{})_.hasOwnProperty(E)&&(v.hasOwnProperty(E)||L0(E,x,b));for(E in v){if(!v.hasOwnProperty(E))continue;const C=v[E];_.hasOwnProperty(E)?Xe(_[E],C)||("geojson"===_[E].type&&"geojson"===C.type&&oC(_,v,E)?x.push({command:cn.setGeoJSONSourceData,args:[E,C.data]}):dI(E,v,x,b)):rC(E,v,x)}}(a.sources,c.sources,f,d);const p=[];a.layers&&a.layers.forEach(_=>{_.source&&d[_.source]?u.push({command:cn.removeLayer,args:[_.id]}):p.push(_)});let g=a.terrain;g&&d[g.source]&&(u.push({command:cn.setTerrain,args:[void 0]}),g=void 0),u=u.concat(f),Xe(g,c.terrain)||u.push({command:cn.setTerrain,args:[c.terrain]}),function(_,v,x){v=v||[];const b=(_=_||[]).map(Fh),E=v.map(Fh),C=_.reduce(Tg,{}),M=v.reduce(Tg,{}),T=b.slice(),R=Object.create(null);let P,I,O,L,F,N,B;for(P=0,I=0;P<b.length;P++)O=b[P],M.hasOwnProperty(O)?I++:(x.push({command:cn.removeLayer,args:[O]}),T.splice(T.indexOf(O,I),1));for(P=0,I=0;P<E.length;P++)O=E[E.length-1-P],T[T.length-1-P]!==O&&(C.hasOwnProperty(O)?(x.push({command:cn.removeLayer,args:[O]}),T.splice(T.lastIndexOf(O,T.length-I),1)):I++,N=T[T.length-P],x.push({command:cn.addLayer,args:[M[O],N]}),T.splice(T.length-P,0,O),R[O]=!0);for(P=0;P<E.length;P++)if(O=E[P],L=C[O],F=M[O],!R[O]&&!Xe(L,F))if(Xe(L.source,F.source)&&Xe(L["source-layer"],F["source-layer"])&&Xe(L.type,F.type)){for(B in Mg(L.layout,F.layout,x,O,null,cn.setLayoutProperty),Mg(L.paint,F.paint,x,O,null,cn.setPaintProperty),Xe(L.slot,F.slot)||x.push({command:cn.setSlot,args:[O,F.slot]}),Xe(L.filter,F.filter)||x.push({command:cn.setFilter,args:[O,F.filter]}),Xe(L.minzoom,F.minzoom)&&Xe(L.maxzoom,F.maxzoom)||x.push({command:cn.setLayerZoomRange,args:[O,F.minzoom,F.maxzoom]}),L)L.hasOwnProperty(B)&&"layout"!==B&&"paint"!==B&&"filter"!==B&&"metadata"!==B&&"minzoom"!==B&&"maxzoom"!==B&&"slot"!==B&&(0===B.indexOf("paint.")?Mg(L[B],F[B],x,O,B.slice(6),cn.setPaintProperty):Xe(L[B],F[B])||x.push({command:cn.setLayerProperty,args:[O,B,F[B]]}));for(B in F)F.hasOwnProperty(B)&&!L.hasOwnProperty(B)&&"layout"!==B&&"paint"!==B&&"filter"!==B&&"metadata"!==B&&"minzoom"!==B&&"maxzoom"!==B&&"slot"!==B&&(0===B.indexOf("paint.")?Mg(L[B],F[B],x,O,B.slice(6),cn.setPaintProperty):Xe(L[B],F[B])||x.push({command:cn.setLayerProperty,args:[O,B,F[B]]}))}else x.push({command:cn.removeLayer,args:[O]}),N=T[T.lastIndexOf(O)+1],x.push({command:cn.addLayer,args:[F,N]})}(p,c.layers,u)}catch(d){console.warn("Unable to compute style diff:",d),u=[{command:cn.setStyle,args:[c]}]}return u}(this.serialize(),t).filter(a=>!(a.command in jh));if(0===n.length)return!1;const s=n.filter(a=>!(a.command in XC));if(s.length>0)throw new Error(`Unimplemented: ${s.map(a=>a.command).join(", ")}.`);return n.forEach(a=>{this[a.command].apply(this,a.args)}),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,n){return this.getImage(t)?this.fire(new zt(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,n),this._afterImageUpdated(t),this)}updateImage(t,n){this.imageManager.updateImage(t,this.scope,n)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new zt(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Dt("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,n,s={}){return this._checkLoaded(),this._validate(nT,`models.${t}`,n,null,s)||(this.modelManager.addModel(t,n,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new zt(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n,s={}){if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error(`There is already a source with ID "${t}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(JM,`sources.${t}`,n,null,s))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const a=O0(t,n,this.dispatcher,this);a.scope=this.scope,a.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a.id),source:a.serialize(),sourceId:a.id}));const c=u=>{const d=(u?"symbol:":"other:")+a.id,f=cr(d,this.scope),p=this._sourceCaches[d]=new ws(f,a,u);(u?this._symbolSourceCaches:this._otherSourceCaches)[a.id]=p,p.onAdd(this.map)};c(!1),"vector"!==n.type&&"geojson"!==n.type||c(!0),a.onAdd&&a.onAdd(this.map),s.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===t)return this.fire(new zt(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new zt(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const s=this.getOwnSourceCaches(t);for(const a of s){const c=bd(a.id);delete this._sourceCaches[c],this._changes.discardSourceCacheUpdate(a.id),a.fire(new Dt("data",{sourceDataType:"metadata",dataType:"source",sourceId:a.getSource().id})),a.setEventedParent(null),a.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,n){this._checkLoaded(),this.getOwnSource(t).setData(n),this._changes.setDirty()}getOwnSource(t){const n=this.getOwnSourceCache(t);return n&&n.getSource()}getOwnSources(){const t=[];for(const n in this._otherSourceCaches){const s=this.getOwnSourceCache(n);s&&t.push(s.getSource())}return t}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const a of t){if(this._validate(Nu,"lights",a))return;switch(a.type){case"ambient":if(this.ambientLight){const c=this.ambientLight;c.set(a),c.updateTransitions(n)}else this.ambientLight=new w0(a,qE,this.scope,this.options);break;case"directional":if(this.directionalLight){const c=this.directionalLight;c.set(a),c.updateTransitions(n)}else this.directionalLight=new w0(a,TR,this.scope,this.options)}}const s=new zn(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const s=_=>.2126*(_[0]<=.03928?_[0]/12.92:Math.pow((_[0]+.055)/1.055,2.4))+.7152*(_[1]<=.03928?_[1]/12.92:Math.pow((_[1]+.055)/1.055,2.4))+.0722*(_[2]<=.03928?_[2]/12.92:Math.pow((_[2]+.055)/1.055,2.4)),a=t.properties.get("color").toArray01(),c=t.properties.get("intensity"),u=t.properties.get("direction"),d=1-ne(u.x,u.y,u.z)[2]/90,f=s(a)*c*d,p=n.properties.get("color").toArray01(),g=n.properties.get("intensity");return(f+s(p)*g)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(ny(t)){const n=function(c){const u=c.indexOf("\x1f");return u>=0?c.slice(u+1):""}(t),s=this.fragments.find(({id:c})=>c===n);if(!s)throw new Error(`Style import not found: ${t}`);const a=bd(t);return s.style.getFragmentStyle(a)}{const n=this.fragments.find(({id:s})=>s===t);if(!n)throw new Error(`Style import not found: ${t}`);return n.style}}getConfigProperty(t,n){const s=this.getFragmentStyle(t);if(!s)return null;const a=s.options.get(n),c=a?a.value||a.default:null;return c?c.serialize():null}setConfigProperty(t,n,s){const a=xa(s);if("success"!==a.result)return void tp(this,a.value);const c=a.value.expression,u=this.getFragmentStyle(t);if(!u)return;const d=u.options.get(n);d&&(u.options.set(n,{...d,value:c}),u.updateConfigDependencies())}setConfig(t,n){if(this._config=t,t||n)if(n){this.options.clear();for(const s in n){let a,c;const u=xa(n[s].default);if("success"===u.result&&(a=u.value.expression),t&&void 0!==t[s]){const v=xa(t[s]);"success"===v.result&&(c=v.value.expression)}const{minValue:d,maxValue:f,stepValue:p,type:g,values:_}=n[s];a?this.options.set(s,{default:a,value:c,minValue:d,maxValue:f,stepValue:p,type:g,values:_}):this.fire(new zt(new Error(`No schema defined for config option "${s}".`)))}}else this.fire(new zt(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const t of this._configDependentLayers){const n=this.getLayer(t);n&&(n.possiblyEvaluateVisibility(),this._updateLayer(n))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(t,n,s={}){this._checkLoaded();const a=t.id;if(this._layers[a])return void this.fire(new zt(new Error(`Layer with id "${a}" already exists on this map`)));let c;if("custom"===t.type){if(tp(this,function(g){const _=[],v=g.id;return void 0===v&&_.push({message:`layers.${v}: missing required property "id"`}),void 0===g.render&&_.push({message:`layers.${v}: missing required method "render"`}),g.renderingMode&&"2d"!==g.renderingMode&&"3d"!==g.renderingMode&&_.push({message:`layers.${v}: property "renderingMode" must be either "2d" or "3d"`}),_}(t)))return;c=mg(t,this.options)}else{if("object"==typeof t.source&&(this.addSource(a,t.source),t=qt(t=$(t),{source:a})),this._validate(eT,`layers.${a}`,t,{arrayIndex:-1},s))return;c=mg(t,this.options),this._validateLayer(c),c.setEventedParent(this,{layer:{id:a}}),this._serializedLayers[c.id]=c.serialize()}c.isConfigDependent&&this._configDependentLayers.add(c.fqid),c.setScope(this.scope);let u=this._order.length;if(n){const g=this._order.indexOf(n);if(-1===g)return void this.fire(new zt(new Error(`Layer with id "${n}" does not exist on this map.`)));c.slot===this._layers[n].slot?u=g:tt(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(u,0,a),this._layerOrderChanged=!0,this._layers[a]=c;const d=this.getOwnLayerSourceCache(c),f=!!this.directionalLight&&this.directionalLight.shadowsEnabled();d&&c.canCastShadows()&&f&&(d.castsShadows=!0);const p=this._changes.getRemovedLayer(c);if(p&&c.source&&d&&"custom"!==c.type){this._changes.discardLayerRemoval(c);const g=cr(c.source,c.scope);p.type!==c.type?this._changes.updateSourceCache(g,"clear"):(this._changes.updateSourceCache(g,"reload"),d.pause())}this._updateLayer(c),c.onAdd&&c.onAdd(this.map),c.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const s=this._checkLayer(t);if(!s||t===n)return;const a=this._order.indexOf(t);this._order.splice(a,1);let c=this._order.length;if(n){const u=this._order.indexOf(n);if(-1===u)return void this.fire(new zt(new Error(`Layer with id "${n}" does not exist on this map.`)));s.slot===this._layers[n].slot?c=u:tt(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(c,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;n.setEventedParent(null);const s=this._order.indexOf(t);this._order.splice(s,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const a=this.getOwnLayerSourceCache(n);if(a&&a.castsShadows){let c=!1;for(const u in this._layers)if(this._layers[u].source===n.source&&this._layers[u].canCastShadows()){c=!0;break}a.castsShadows=c}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const n in this._layers)if(this._layers[n].type===t)return!0;return!1}setLayerZoomRange(t,n,s){this._checkLoaded();const a=this._checkLayer(t);a&&(a.minzoom===n&&a.maxzoom===s||(null!=n&&(a.minzoom=n),null!=s&&(a.maxzoom=s),this._updateLayer(a)))}setSlot(t,n){this._checkLoaded();const s=this._checkLayer(t);s&&s.slot!==n&&(s.slot=n,this._updateLayer(s))}setFilter(t,n,s={}){this._checkLoaded();const a=this._checkLayer(t);if(a&&!Xe(a.filter,n))return null==n?(a.filter=void 0,void this._updateLayer(a)):void(this._validate(X_,`layers.${a.id}.filter`,n,{layerType:a.type},s)||(a.filter=$(n),this._updateLayer(a)))}getFilter(t){const n=this._checkLayer(t);if(n)return $(n.filter)}setLayoutProperty(t,n,s,a={}){this._checkLoaded();const c=this._checkLayer(t);c&&(Xe(c.getLayoutProperty(n),s)||(c.setLayoutProperty(n,s,a),c.isConfigDependent&&this._configDependentLayers.add(c.fqid),this._updateLayer(c)))}getLayoutProperty(t,n){const s=this._checkLayer(t);if(s)return s.getLayoutProperty(n)}setPaintProperty(t,n,s,a={}){this._checkLoaded();const c=this._checkLayer(t);if(!c||Xe(c.getPaintProperty(n),s))return;const u=c.setPaintProperty(n,s,a);c.isConfigDependent&&this._configDependentLayers.add(c.fqid),u&&this._updateLayer(c),this._changes.updatePaintProperties(c)}getPaintProperty(t,n){const s=this._checkLayer(t);if(s)return s.getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const s=t.source,a=t.sourceLayer,c=this._checkSource(s);if(!c)return;const u=c.type;if("geojson"===u&&a)return void this.fire(new zt(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===u&&!a)return void this.fire(new zt(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new zt(new Error("The feature id parameter must be provided.")));const d=this.getOwnSourceCaches(s);for(const f of d)f.setFeatureState(a,t.id,n)}removeFeatureState(t,n){this._checkLoaded();const s=t.source,a=this._checkSource(s);if(!a)return;const c=a.type,u="vector"===c?t.sourceLayer:void 0;if("vector"===c&&!u)return void this.fire(new zt(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new zt(new Error("A feature id is required to remove its specific state property.")));const d=this.getOwnSourceCaches(s);for(const f of d)f.removeFeatureState(u,t.id,n)}getFeatureState(t){this._checkLoaded();const n=t.source,s=t.sourceLayer,a=this._checkSource(n);if(a){if("vector"!==a.type||s)return void 0===t.id&&this.fire(new zt(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(s,t.id);this.fire(new zt(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=qt({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return qt({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return At({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},s=>void 0!==s)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),s=cr(t.source,t.scope),a=this._changes.getUpdatedSourceCaches();t.source&&!a[s]&&n&&"raster"!==n.getSource().type&&(this._changes.updateSourceCache(s,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const n=d=>"fill-extrusion"===this._mergedLayers[d].type,s=this.order,a={},c=[];for(let d=s.length-1;d>=0;d--){const f=s[d];if(n(f)){a[f]=d;for(const p of t){const g=p[f];if(g)for(const _ of g)c.push(_)}}}c.sort((d,f)=>f.intersectionZ-d.intersectionZ);const u=[];for(let d=s.length-1;d>=0;d--){const f=s[d];if(n(f))for(let p=c.length-1;p>=0;p--){const g=c[p].feature;if(a[g.layer.id]<d)break;u.push(g),c.pop()}else for(const p of t){const g=p[f];if(g)for(const _ of g)u.push(_.feature)}}return u}queryRenderedFeatures(t,n,s){n&&n.filter&&this._validate(X_,"queryRenderedFeatures.filter",n.filter,null,n),n.scope=this.scope,n.availableImages=this._availableImages,n.serializedLayers=this._serializedLayers;const a={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new zt(new Error("parameters.layers must be an Array."))),[];for(const p of n.layers){const g=this._mergedLayers[p];if(!g)return this.fire(new zt(new Error(`The layer '${p}' does not exist in the map's style and cannot be queried for features.`))),[];a[g.source]=!0}}const c=[],u=n.serializedLayers||{},d=n&&n.layers?n.layers.some(p=>{const g=this.getLayer(p);return g&&g.is3D()}):this.has3DLayers(),f=ci.createFromScreenPoints(t,s);for(const p in this._mergedSourceCaches){const g=this._mergedSourceCaches[p].getSource();if(!g||g.scope!==n.scope)continue;const _=this._mergedSourceCaches[p].getSource().id;n.layers&&!a[_]||c.push(AR(this._mergedSourceCaches[p],this._mergedLayers,u,f,n,s,d,!!this.map._showQueryGeometry))}return this.placement&&c.push(function(p,g,_,v,x,b,E){const C={},M=b.queryRenderedSymbols(v),T=[];for(const R of Object.keys(M).map(Number))T.push(E[R]);T.sort(k0);for(const R of T){const P=R.featureIndex.lookupSymbolFeatures(M[R.bucketInstanceId],g,R.bucketIndex,R.sourceLayerIndex,x.filter,x.layers,x.availableImages,p);for(const I in P){const O=C[I]=C[I]||[],L=P[I];L.sort((F,N)=>{const B=R.featureSortOrder;if(B){const V=B.indexOf(F.featureIndex);return B.indexOf(N.featureIndex)-V}return N.featureIndex-F.featureIndex});for(const F of L)O.push(F)}}for(const R in C)C[R].forEach(P=>{const I=P.feature,O=_(p[R]);if(!O)return;const L=O.getFeatureState(I.layer["source-layer"],I.id);I.source=I.layer.source,I.layer["source-layer"]&&(I.sourceLayer=I.layer["source-layer"]),I.state=L});return C}(this._mergedLayers,u,this.getLayerSourceCache.bind(this),f.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(c)}querySourceFeatures(t,n){n&&n.filter&&this._validate(X_,"querySourceFeatures.filter",n.filter,null,n);const s=this.getOwnSourceCaches(t);let a=[];for(const c of s)a=a.concat(uI(c,n));return a}addSourceType(t,n,s){return oa.getSourceType(t)?s(new Error(`A source type called "${t}" already exists.`)):(oa.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},s):s(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n,s={}){this._checkLoaded();const a=this.light.getLight();let c=!1;for(const d in t)if(!Xe(t[d],a[d])){c=!0;break}if(!c)return;const u=this._getTransitionParameters();this.light.setLight(t,n,s),this.light.updateTransitions(u)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,n=1){if(this._checkLoaded(),!t)return delete this.terrain,null===t?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let s=t;const a=null==t.source;if(1===n){if("object"==typeof s.source){const d="terrain-dem-src";this.addSource(d,s.source),s=$(s),s=qt(s,{source:d})}const c=qt({},s),u={};if(this.terrain&&a){c.source=this.terrain.get().source;const d=this.terrain?this.getFragmentStyle(this.terrain.scope):null;d&&(u.style=d.serialize())}if(this._validate(wo,"terrain",c,u))return}if(!this.terrain||this.terrain.scope!==this.scope&&!a||this.terrain&&n!==this.terrain.drapeRenderMode){if(!s)return;this._createTerrain(s,n),this.fire(new Dt("data",{dataType:"style"}))}else{const c=this.terrain,u=c.get();for(const d of Object.keys(rt.terrain))!s.hasOwnProperty(d)&&rt.terrain[d].default&&(s[d]=rt.terrain[d].default);for(const d in t)if(!Xe(t[d],u[d])){c.set(t,this.options),this.stylesheet.terrain=t;const f=this._getTransitionParameters({duration:0});c.updateTransitions(f),this.fire(new Dt("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const n=this.fog=new nI(t,this.map.transform);this.stylesheet.fog=n.get();const s=this._getTransitionParameters({duration:0});n.updateTransitions(s)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!Xe(n.get(),t)){n.set(t),this.stylesheet.fog=n.get();const s=this._getTransitionParameters({duration:0});n.updateTransitions(s)}}else this._createFog(t);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:xe.now(),transition:qt(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],n=[];for(const s in this._mergedLayers)this.isLayerDraped(this._mergedLayers[s])?t.push(s):n.push(s);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...n)}_createTerrain(t,n){const s=this.terrain=new GE(t,n,this.scope,this.options);1===n&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const a=this._getTransitionParameters({duration:0});s.updateTransitions(a)}_force3DLayerUpdate(){for(const t in this._layers){const n=this._layers[t];"fill-extrusion"===n.type&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const n=this._layers[t];"symbol"===n.type&&this._updateLayer(n)}}_validate(t,n,s,a,c={}){if(c&&!1===c.validate)return!1;const u=qt({},this.serialize());return tp(this,t.call(er,qt({key:n,style:u,value:s,styleSpec:rt},a)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),Wp.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const n=this.getSourceCaches(t);for(const s of n)s.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const n=this.getSourceCaches(t);for(const s of n)s.resume(),s.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}updateSources(t){let n;this.directionalLight&&(n=Qf(this.directionalLight));for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].update(t,void 0,void 0,n)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const n=this._sourceCaches[t];n.resume(),n.reload()}}_updatePlacement(t,n,s,a,c=!1){let u=!1,d=!1;const f={},p={};for(const g of this._mergedOrder){const _=this._mergedLayers[g];if("symbol"!==_.type)continue;const v=cr(_.source,_.scope);let x=f[v];if(!x){const E=this.getLayerSourceCache(_);if(!E)continue;const C=E.getRenderableIds(!0).map(M=>E.getTileByID(M));p[v]=C.slice(),x=f[v]=C.sort((M,T)=>T.tileID.overscaledZ-M.tileID.overscaledZ||(M.tileID.isLessThan(T.tileID)?-1:1))}const b=this.crossTileSymbolIndex.addLayer(_,x,t.center.lng,t.projection);u=u||b}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),c=c||this._layerOrderChanged||0===s,this._layerOrderChanged&&this.fire(new Dt("neworder")),(c||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(xe.now(),t.zoom))&&(this.pauseablePlacement=new hC(t,this._mergedOrder,c,n,s,a,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,f,p),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(xe.now()),d=!0),u&&this.pauseablePlacement.placement.setStale()),d||u)for(const g of this._mergedOrder){const _=this._mergedLayers[g];"symbol"===_.type&&this.placement.updateLayerOpacities(_,f[cr(_.source,_.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(xe.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t){this._checkLoaded();const n=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==n.findIndex(({id:a})=>a===t.id)?this.fire(new zt(new Error(`Import with id '${t.id}' already exists in the map's style.`))):(n.push(t),this._loadImports([t],!0),this)}setImportUrl(t,n){this._checkLoaded();const s=this.stylesheet.imports||[],a=this.getImportIndex(t);if(-1===a)return this;s[a].url=n;const c=this.fragments[a];return c.style=this._createFragmentStyle(s[a]),c.style.on("style.import.load",()=>this.mergeAll()),c.style.loadURL(n),this}setImportData(t,n){this._checkLoaded();const s=this.getImportIndex(t),a=this.stylesheet.imports||[];return-1===s?this:n?(this.fragments[s].style.setState(n),this._reloadImports(),this):(delete a[s].data,this.setImportUrl(t,a[s].url))}setImportConfig(t,n){this._checkLoaded();const s=this.getImportIndex(t),a=this.stylesheet.imports||[];if(-1===s)return this;n?a[s].config=n:delete a[s].config;const c=this.fragments[s],u=c.style.stylesheet&&c.style.stylesheet.schema;return c.config=n,c.style.setConfig(n,u),c.style.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const n=this.stylesheet.imports||[],s=this.getImportIndex(t);return-1===s||(n.splice(s,1),this.fragments[s].style._remove(),this.fragments.splice(s,1),this._reloadImports()),this}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(s=>s.id===t);return-1===n&&this.fire(new zt(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),n}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const n in this._mergedOtherSourceCaches){const s=this._mergedOtherSourceCaches[n];s&&t.push(s.getSource())}return t}getSource(t,n){const s=this.getSourceCache(t,n);return s&&s.getSource()}getLayerSource(t){const n=this.getLayerSourceCache(t);return n&&n.getSource()}getSourceCache(t,n){const s=cr(t,n);return this._mergedOtherSourceCaches[s]}getLayerSourceCache(t){const n=cr(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(t){const n=[];return this._mergedOtherSourceCaches[t]&&n.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&n.push(this._mergedSymbolSourceCaches[t]),n}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const n in t){const s=t[n];"reload"===s?this.reloadSource(n):"clear"===s&&this.clearSource(n)}}updateLayers(t){const n=this._changes.getUpdatedPaintProperties();for(const s of n){const a=this.getLayer(s);a&&a.updateTransitions(t)}}getImages(t,n,s){this.imageManager.getImages(n.icons,n.scope,s),this._updateTilesForChangedImages();const a=c=>{c&&c.setDependencies(n.tileID.key,n.type,n.icons)};a(this._otherSourceCaches[n.source]),a(this._symbolSourceCaches[n.source])}getGlyphs(t,n,s){this.glyphManager.getGlyphs(n.stacks,n.scope,s)}getResource(t,n,s){return Rt(n,s)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const n=[];return this._otherSourceCaches[t]&&n.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&n.push(this._symbolSourceCaches[t]),n}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return 0===n.length?(this.fire(new zt(new Error(`There is no source with ID '${t}'`))),!1):n.every(s=>s.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function QC(e,t){let n=!1,s=null;const a=()=>{s=null,n&&(e(),s=setTimeout(a,t),n=!1)};return()=>(n=!0,s||a(),s)}oa.getSourceType=function(e){return P0[e]},oa.setSourceType=function(e,t){P0[e]=t},oa.registerForPluginStateChange=function(e){return e({pluginStatus:Dr,pluginURL:js}),Wp.on("pluginStateChange",e),e};class NR{constructor(t){this._hashName=t&&encodeURIComponent(t),Bi(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=QC(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,st.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),st.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const n=JC(t);if(this._hashName){const s=this._hashName;let a=!1;const c=st.location.hash.slice(1).split("&").map(u=>{const d=u.split("=")[0];return d===s?(a=!0,`${d}=${n}`):u}).filter(u=>u);return a||c.push(`${s}=${n}`),`#${c.join("&")}`}return`#${n}`}_getCurrentHash(){const t=st.location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(s=>s.split("=")).forEach(s=>{s[0]===this._hashName&&(n=s)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(s=>isNaN(s))){const s=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(n[3]||0):t.getBearing();return t.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:s,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=st.location.href.replace(/(#.+)?$/,this.getHashString());st.history.replaceState(st.history.state,null,t)}}function JC(e,t){const n=e.getCenter(),s=Math.round(100*e.getZoom())/100,a=Math.ceil((s*Math.LN2+Math.log(512/360/.5))/Math.LN10),c=Math.pow(10,a),u=Math.round(n.lng*c)/c,d=Math.round(n.lat*c)/c,f=e.getBearing(),p=e.getPitch();let g=t?`/${u}/${d}/${s}`:`${s}/${d}/${u}`;return(f||p)&&(g+="/"+Math.round(10*f)/10),p&&(g+=`/${Math.round(p)}`),g}const Ug={linearity:.3,easing:Za(0,0,.3,1)},tA=qt({deceleration:2500,maxSpeed:1400},Ug),tD=qt({deceleration:20,maxSpeed:1400},Ug),eD=qt({deceleration:1e3,maxSpeed:360},Ug),eA=qt({deceleration:1e3,maxSpeed:90},Ug);class nD{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:xe.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=xe.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new et(0,0),pinchAround:void 0,around:void 0};for(const{settings:c}of this._inertiaBuffer)n.zoom+=c.zoomDelta||0,n.bearing+=c.bearingDelta||0,n.pitch+=c.pitchDelta||0,c.panDelta&&n.pan._add(c.panDelta),c.around&&(n.around=c.around),c.pinchAround&&(n.pinchAround=c.pinchAround);const s=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,a={};if(n.pan.mag()){const c=$g(n.pan.mag(),s,qt({},tA,t||{}));a.offset=n.pan.mult(c.amount/n.pan.mag()),a.center=this._map.transform.center,ep(a,c)}if(n.zoom){const c=$g(n.zoom,s,tD);a.zoom=this._map.transform.zoom+c.amount,ep(a,c)}if(n.bearing){const c=$g(n.bearing,s,eD);a.bearing=this._map.transform.bearing+Qt(c.amount,-179,179),ep(a,c)}if(n.pitch){const c=$g(n.pitch,s,eA);a.pitch=this._map.transform.pitch+c.amount,ep(a,c)}if(a.zoom||a.bearing){const c=void 0===n.pinchAround?n.around:n.pinchAround;a.around=c?this._map.unproject(c):this._map.getCenter()}return this.clear(),a.noMoveStart=!0,a}}function ep(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function $g(e,t,n){const{maxSpeed:s,linearity:a,deceleration:c}=n,u=Qt(e*a/(t/1e3),-s,s),d=Math.abs(u)/(c*a);return{easing:n.easing,duration:1e3*d,amount:u*(d/2)}}class Ao extends Dt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,s,a={}){const c=Ge(n.getCanvasContainer(),s);super(t,qt({point:c,lngLat:n.unproject(c),originalEvent:s},a)),this._defaultPrevented=!1,this.target=n}}class np extends Dt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,s){const a="touchend"===t?s.changedTouches:s.touches,c=gu(n.getCanvasContainer(),a),u=c.map(f=>n.unproject(f)),d=c.reduce((f,p,g,_)=>f.add(p.div(_.length)),new et(0,0));super(t,{points:c,point:d,lngLats:u,lngLat:n.unproject(d),originalEvent:s}),this._defaultPrevented=!1}}class nA extends Dt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,s){super(t,{originalEvent:s}),this._defaultPrevented=!1}}class iD{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new nA(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Ao(t.type,this._map,t))}mouseup(t){this._map.fire(new Ao(t.type,this._map,t))}preclick(t){const n=qt({},t);n.type="preclick",this._map.fire(new Ao(n.type,this._map,n))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Ao(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Ao(t.type,this._map,t))}mouseover(t){this._map.fire(new Ao(t.type,this._map,t))}mouseout(t){this._map.fire(new Ao(t.type,this._map,t))}touchstart(t){return this._firePreventable(new np(t.type,this._map,t))}touchmove(t){this._map.fire(new np(t.type,this._map,t))}touchend(t){this._map.fire(new np(t.type,this._map,t))}touchcancel(t){this._map.fire(new np(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class rD{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Ao(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ao("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Ao(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class oD{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&0===t.button&&(qi(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const s=n,a=this._startPos,c=this._lastPos;if(!a||!c||c.equals(s)||!this._box&&s.dist(a)<this._clickTolerance)return;this._lastPos=s,this._box||(this._box=rn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const u=Math.min(a.x,s.x),d=Math.max(a.x,s.x),f=Math.min(a.y,s.y),p=Math.max(a.y,s.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${u}px,${f}px)`,this._box.style.width=d-u+"px",this._box.style.height=p-f+"px")})}mouseupWindow(t,n){if(!this._active)return;const s=this._startPos,a=n;if(s&&0===t.button){if(this.reset(),Kh(),s.x!==a.x||s.y!==a.y)return this._map.fire(new Dt("boxzoomend",{originalEvent:t})),{cameraAnimation:c=>c.fitScreenCoordinates(s,a,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),vp(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new Dt(t,{originalEvent:n}))}}function Hg(e,t){const n={};for(let s=0;s<e.length;s++)n[e[s].identifier]=t[s];return n}class iA{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,s){(this.centroid||s.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),s.length===this.numTouches&&(this.centroid=function(a){const c=new et(0,0);for(const u of a)c._add(u);return c.div(a.length)}(n),this.touches=Hg(s,n)))}touchmove(t,n,s){if(this.aborted||!this.centroid)return;const a=Hg(s,n);for(const c in this.touches){const u=a[c];(!u||u.dist(this.touches[c])>30)&&(this.aborted=!0)}}touchend(t,n,s){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===s.length){const a=!this.aborted&&this.centroid;if(this.reset(),a)return a}}}class _x{constructor(t){this.singleTap=new iA(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,n,s){this.singleTap.touchstart(t,n,s)}touchmove(t,n,s){this.singleTap.touchmove(t,n,s)}touchend(t,n,s){const a=this.singleTap.touchend(t,n,s);if(a){const c=t.timeStamp-this.lastTime<500,u=!this.lastTap||this.lastTap.dist(a)<30;if(c&&u||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=a,this.count===this.numTaps)return this.reset(),a}}}class zR{constructor(){this._zoomIn=new _x({numTouches:1,numTaps:2}),this._zoomOut=new _x({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,s){this._zoomIn.touchstart(t,n,s),this._zoomOut.touchstart(t,n,s)}touchmove(t,n,s){this._zoomIn.touchmove(t,n,s),this._zoomOut.touchmove(t,n,s)}touchend(t,n,s){const a=this._zoomIn.touchend(t,n,s),c=this._zoomOut.touchend(t,n,s);return a?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:u=>u.easeTo({duration:300,zoom:u.getZoom()+1,around:u.unproject(a)},{originalEvent:t})}):c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:u=>u.easeTo({duration:300,zoom:u.getZoom()-1,around:u.unproject(c)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const sD={0:1,2:2};class aD{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const s=xp(t);this._correctButton(t,s)&&(this._lastPoint=n,this._eventButton=s)}mousemoveWindow(t,n){const s=this._lastPoint;if(s)if(t.preventDefault(),null!=this._eventButton&&function(a,c){const u=sD[c];return void 0===a.buttons||(a.buttons&u)!==u}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(s)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(s,n)}mouseupWindow(t){this._lastPoint&&xp(t)===this._eventButton&&(this._moved&&Kh(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class BR extends aD{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return 0===n&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class rA extends aD{_correctButton(t,n){return 0===n&&t.ctrlKey||2===n}_move(t,n){const s=.8*(n.x-t.x);if(s)return this._active=!0,{bearingDelta:s}}contextmenu(t){t.preventDefault()}}class oA extends aD{_correctButton(t,n){return 0===n&&t.ctrlKey||2===n}_move(t,n){const s=-.5*(n.y-t.y);if(s)return this._active=!0,{pitchDelta:s}}contextmenu(t){t.preventDefault()}}class jR{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),Bi(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new et(0,0)}touchstart(t,n,s){return this._calculateTransform(t,n,s)}touchmove(t,n,s){if(this._active&&!(s.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===s.length&&!_e())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,s)}}touchend(t,n,s){this._calculateTransform(t,n,s),this._active&&s.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,s){s.length>0&&(this._active=!0);const a=Hg(s,n),c=new et(0,0),u=new et(0,0);let d=0;for(const p in a){const g=a[p],_=this._touches[p];_&&(c._add(g),u._add(g.sub(_)),d++,a[p]=g)}if(this._touches=a,d<this._minTouches||!u.mag())return;const f=u.div(d);return this._sum._add(f),this._sum.mag()<this._clickTolerance?void 0:{around:c.div(d),panDelta:f}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=rn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class lD{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,n,s){return{}}touchstart(t,n,s){this._firstTwoTouches||s.length<2||(this._firstTwoTouches=[s[0].identifier,s[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,s){const a=this._firstTwoTouches;if(!a)return;t.preventDefault();const[c,u]=a,d=yx(s,n,c),f=yx(s,n,u);if(!d||!f)return;const p=this._aroundCenter?null:d.add(f).div(2);return this._move([d,f],p,t)}touchend(t,n,s){if(!this._firstTwoTouches)return;const[a,c]=this._firstTwoTouches,u=yx(s,n,a),d=yx(s,n,c);u&&d||(this._active&&Kh(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function yx(e,t,n){for(let s=0;s<e.length;s++)if(e[s].identifier===n)return t[s]}function sA(e,t){return Math.log(e/t)/Math.LN2}class VR extends lD{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const s=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(sA(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:sA(this._distance,s),pinchAround:n}}}function Gg(e,t){return 180*e.angleWith(t)/Math.PI}class vx extends lD{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const s=this._vector;if(this._vector=t[0].sub(t[1]),s&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Gg(this._vector,s),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,s=this._startVector;if(!s)return!1;const a=Gg(t,s);return Math.abs(a)<n}}function qg(e){return Math.abs(e.y)>Math.abs(e.x)}class aA extends lD{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,qg(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,s){const a=this._lastPoints;if(!a)return;const c=t[0].sub(a[0]),u=t[1].sub(a[1]);return this._map._cooperativeGestures&&!_e()&&s.touches.length<3||(this._valid=this.gestureBeginsVertically(c,u,s.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+u.y)/2*-.5})}gestureBeginsVertically(t,n,s){if(void 0!==this._valid)return this._valid;const a=t.mag()>=2,c=n.mag()>=2;if(!a&&!c)return;if(!a||!c)return null==this._firstMove&&(this._firstMove=s),s-this._firstMove<100&&void 0;const u=t.y>0==n.y>0;return qg(t)&&qg(n)&&u}}const sa={panStep:100,bearingStep:15,pitchStep:10};class lA{constructor(){const t=sa;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,s=0,a=0,c=0,u=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?s=-1:(t.preventDefault(),c=-1);break;case 39:t.shiftKey?s=1:(t.preventDefault(),c=1);break;case 38:t.shiftKey?a=1:(t.preventDefault(),u=-1);break;case 40:t.shiftKey?a=-1:(t.preventDefault(),u=1);break;default:return}return this._rotationDisabled&&(s=0,a=0),{cameraAnimation:d=>{const f=d.getZoom();d.easeTo({duration:300,easeId:"keyboardHandler",easing:UR,zoom:n?Math.round(f)+n*(t.shiftKey?2:1):f,bearing:d.getBearing()+s*this._bearingStep,pitch:d.getPitch()+a*this._pitchStep,offset:[-c*this._panStep,-u*this._panStep],center:d.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function UR(e){return e*(2-e)}const cA=4.000244140625;class uA{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,Bi(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||_e()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===st.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const s=xe.now(),a=s-(this._lastWheelEventTime||0);this._lastWheelEventTime=s,0!==n&&n%cA==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":a>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(a*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=Ge(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const p="wheel"===this._type&&Math.abs(this._delta)>cA?this._wheelZoomRate:this._defaultZoomRate;let g=2/(1+Math.exp(-Math.abs(this._delta*p)));this._delta<0&&0!==g&&(g=1/g);const _=n(),v=Math.pow(2,_),x="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):v;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(x*g))),"wheel"===this._type&&(this._startZoom=_,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const s="number"==typeof this._targetZoom?this._targetZoom:n(),a=this._startZoom,c=this._easing;let u,d=!1;if("wheel"===this._type&&a&&c){const p=Math.min((xe.now()-this._lastWheelEventTime)/200,1);u=vt(a,s,c(p)),p<1?this._frameId||(this._frameId=!0):d=!0}else u=s,d=!0;this._active=!0,d&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let f=u-n();return f*this._lastDelta<0&&(f=0),{noInertia:!0,needsRenderFrame:!d,zoomDelta:f,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=jn;if(this._prevEase){const s=this._prevEase,a=(xe.now()-s.start)/s.duration,c=s.easing(a+.01)-s.easing(a),u=.27/Math.sqrt(c*c+1e-4)*.01;n=Za(u,Math.sqrt(.0729-u*u),.25,1)}return this._prevEase={start:xe.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=rn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(st.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class cD{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hA{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,n){return t.preventDefault(),{cameraAnimation:s=>{s.easeTo({duration:300,zoom:s.getZoom()+(t.shiftKey?-1:1),around:s.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uD{constructor(){this._tap=new _x({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,n,s){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?s.length>0&&(this._swipePoint=n[0],this._swipeTouch=s[0].identifier):this._tap.touchstart(t,n,s))}touchmove(t,n,s){if(this._tapTime){if(this._swipePoint){if(s[0].identifier!==this._swipeTouch)return;const a=n[0],c=a.y-this._swipePoint.y;return this._swipePoint=a,t.preventDefault(),this._active=!0,{zoomDelta:c/128}}}else this._tap.touchmove(t,n,s)}touchend(t,n,s){this._tapTime?this._swipePoint&&0===s.length&&this.reset():this._tap.touchend(t,n,s)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dA{constructor(t,n,s){this._el=t,this._mousePan=n,this._touchPan=s}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $R{constructor(t,n,s){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=s}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class fA{constructor(t,n,s,a){this._el=t,this._touchZoom=n,this._touchRotate=s,this._tapDragZoom=a,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ul=e=>e.zoom||e.drag||e.pitch||e.rotate;class Zg extends Dt{}class pA{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const s=G.sub([],n,t);this.radius=G.length(s[2]<0?G.div([],s,this.constants):[s[0],s[1],0])}projectRay(t){G.div(t,t,this.constants),G.normalize(t,t),G.mul(t,t,this.constants);const n=G.scale([],t,this.radius);if(n[2]>0){const s=G.scale([],[0,0,1],G.dot(n,[0,0,1])),a=G.scale([],G.normalize([],[n[0],n[1],0]),this.radius),c=G.add([],n,G.scale([],G.sub([],G.add([],a,s),n),2));n[0]=c[0],n[1]=c[1]}return n}}function Wg(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class mA{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new nD(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new pA,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),Bi(["handleEvent","handleWindowEvent"],this);const s=this._el;this._listeners=[[s,"touchstart",{passive:!0}],[s,"touchmove",{passive:!1}],[s,"touchend",void 0],[s,"touchcancel",void 0],[s,"mousedown",void 0],[s,"mousemove",void 0],[s,"mouseup",void 0],[st.document,"mousemove",{capture:!0}],[st.document,"mouseup",void 0],[s,"mouseover",void 0],[s,"mouseout",void 0],[s,"dblclick",void 0],[s,"click",void 0],[s,"keydown",{capture:!1}],[s,"keyup",void 0],[s,"wheel",{passive:!1}],[s,"contextmenu",void 0],[st,"blur",void 0]];for(const[a,c,u]of this._listeners)a.addEventListener(c,a===st.document?this.handleWindowEvent:this.handleEvent,u)}destroy(){for(const[t,n,s]of this._listeners)t.removeEventListener(n,t===st.document?this.handleWindowEvent:this.handleEvent,s)}_addDefaultHandlers(t){const n=this._map,s=n.getCanvasContainer();this._add("mapEvent",new iD(n,t));const a=n.boxZoom=new oD(n,t);this._add("boxZoom",a);const c=new zR,u=new hA;n.doubleClickZoom=new cD(u,c),this._add("tapZoom",c),this._add("clickZoom",u);const d=new uD;this._add("tapDragZoom",d);const f=n.touchPitch=new aA(n);this._add("touchPitch",f);const p=new rA(t),g=new oA(t);n.dragRotate=new $R(t,p,g),this._add("mouseRotate",p,["mousePitch"]),this._add("mousePitch",g,["mouseRotate"]);const _=new BR(t),v=new jR(n,t);n.dragPan=new dA(s,_,v),this._add("mousePan",_),this._add("touchPan",v,["touchZoom","touchRotate"]);const x=new vx,b=new VR;n.touchZoomRotate=new fA(s,b,x,d),this._add("touchRotate",x,["touchPan","touchZoom"]),this._add("touchZoom",b,["touchPan","touchRotate"]),this._add("blockableMapEvent",new rD(n));const E=n.scrollZoom=new uA(n,this);this._add("scrollZoom",E,["mousePan"]);const C=n.keyboard=new lA;this._add("keyboard",C);for(const M of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[M]&&n[M].enable(t[M])}_add(t,n,s){this._handlers.push({handlerName:t,handler:n,allowed:s}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ul(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,n,s){for(const a in t)if(a!==s&&(!n||n.indexOf(a)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const s of t)this._el.contains(s.target)&&n.push(s);return n}handleEvent(t,n){this._updatingCamera=!0;const s="renderFrame"===t.type,a=s?void 0:t,c={needsRenderFrame:!1},u={},d={},f=t.touches?this._getMapTouches(t.touches):void 0,p=f?gu(this._el,f):s?void 0:Ge(this._el,t);for(const{handlerName:v,handler:x,allowed:b}of this._handlers){if(!x.isEnabled())continue;let E;this._blockedByActive(d,b,v)?x.reset():x[n||t.type]&&(E=x[n||t.type](t,p,f),this.mergeHandlerResult(c,u,E,v,a),E&&E.needsRenderFrame&&this._triggerRenderFrame()),(E||x.isActive())&&(d[v]=x)}const g={};for(const v in this._previousActiveHandlers)d[v]||(g[v]=a);this._previousActiveHandlers=d,(Object.keys(g).length||Wg(c))&&(this._changes.push([c,u,g]),this._triggerRenderFrame()),(Object.keys(d).length||Wg(c))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:_}=c;_&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],_(this._map))}mergeHandlerResult(t,n,s,a,c){if(!s)return;qt(t,s);const u={handlerName:a,originalEvent:s.originalEvent||c};void 0!==s.zoomDelta&&(n.zoom=u),void 0!==s.panDelta&&(n.drag=u),void 0!==s.pitchDelta&&(n.pitch=u),void 0!==s.bearingDelta&&(n.rotate=u)}_applyChanges(){const t={},n={},s={};for(const[a,c,u]of this._changes)a.panDelta&&(t.panDelta=(t.panDelta||new et(0,0))._add(a.panDelta)),a.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(t.around=a.around),void 0!==a.aroundCoord&&(t.aroundCoord=a.aroundCoord),void 0!==a.pinchAround&&(t.pinchAround=a.pinchAround),a.noInertia&&(t.noInertia=a.noInertia),qt(n,c),qt(s,u);this._updateMapTransform(t,n,s),this._changes=[]}_updateMapTransform(t,n,s){const a=this._map,c=a.transform,u=T=>[T.x,T.y,T.z];if((T=>{const R=this._eventsInProgress.drag;return R&&!this._handlersById[R.handlerName].isActive()})()&&!Wg(t)){const T=c.zoom;c.cameraElevationReference="sea",null!=this._originalZoom&&c._orthographicProjectionAtLowPitch&&"globe"!==c.projection.name&&0===c.pitch?(c.cameraElevationReference="ground",c.zoom=this._originalZoom):(c.recenterOnTerrain(),c.cameraElevationReference="ground"),T!==c.zoom&&this._map._update(!0)}if(c._isCameraConstrained&&a._stop(!0),!Wg(t))return void this._fireEvents(n,s,!0);let{panDelta:d,zoomDelta:f,bearingDelta:p,pitchDelta:g,around:_,aroundCoord:v,pinchAround:x}=t;c._isCameraConstrained&&(f>0&&(f=0),c._isCameraConstrained=!1),void 0!==x&&(_=x),(f||(T=>n[T]&&!this._eventsInProgress[T])("drag"))&&_&&(this._dragOrigin=u(c.pointCoordinate3D(_)),this._originalZoom=c.zoom,this._trackingEllipsoid.setup(c._camera.position,this._dragOrigin)),c.cameraElevationReference="sea",a._stop(!0),_=_||a.transform.centerPoint,p&&(c.bearing+=p),g&&(c.pitch+=g),c._updateCameraState();const b=[0,0,0];if(d)if("mercator"===c.projection.name){const T=this._trackingEllipsoid.projectRay(c.screenPointToMercatorRay(_).dir),R=this._trackingEllipsoid.projectRay(c.screenPointToMercatorRay(_.sub(d)).dir);b[0]=R[0]-T[0],b[1]=R[1]-T[1]}else{const T=c.pointCoordinate(_);if("globe"===c.projection.name){d=d.rotate(-c.angle);const R=c._pixelsPerMercatorPixel/c.worldSize;b[0]=-d.x*Wy(Ei(T.y))*R,b[1]=-d.y*Wy(c.center.lat)*R}else{const R=c.pointCoordinate(_.sub(d));T&&R&&(b[0]=R.x-T.x,b[1]=R.y-T.y)}}const E=c.zoom,C=[0,0,0];if(f){const T=u(v||c.pointCoordinate3D(_)),R={dir:G.normalize([],G.sub([],T,c._camera.position))};if(R.dir[2]<0){const P=c.zoomDeltaToMovement(T,f);G.scale(C,R.dir,P)}}const M=G.add(b,b,C);c._translateCameraConstrained(M),f&&Math.abs(c.zoom-E)>1e-4&&c.recenterOnTerrain(),c.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,s,!0)}_fireEvents(t,n,s){const a=Ul(this._eventsInProgress),c=Ul(t),u={};for(const g in t){const{originalEvent:_}=t[g];this._eventsInProgress[g]||(u[`${g}start`]=_),this._eventsInProgress[g]=t[g]}!a&&c&&this._fireEvent("movestart",c.originalEvent);for(const g in u)this._fireEvent(g,u[g]);c&&this._fireEvent("move",c.originalEvent);for(const g in t){const{originalEvent:_}=t[g];this._fireEvent(g,_)}const d={};let f;for(const g in this._eventsInProgress){const{handlerName:_,originalEvent:v}=this._eventsInProgress[g];this._handlersById[_].isActive()||(delete this._eventsInProgress[g],f=n[_]||v,d[`${g}end`]=f)}for(const g in d)this._fireEvent(g,d[g]);const p=Ul(this._eventsInProgress);if(s&&(a||c)&&!p){this._updatingCamera=!0;const g=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),_=v=>0!==v&&-this._bearingSnap<v&&v<this._bearingSnap;g?(_(g.bearing||this._map.getBearing())&&(g.bearing=0),this._map.easeTo(g,{originalEvent:f})):(this._map.fire(new Dt("moveend",{originalEvent:f})),_(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new Dt(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Zg("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const hD="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class gA extends Be{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=!1!==n.respectPrefersReducedMotion,Bi(["_renderFrameCallback"],this)}getCenter(){return new ve(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,s){return t=et.convert(t).mult(-1),this.panTo(this.transform.center,qt({offset:t},n),s)}panTo(t,n,s){return this.easeTo(qt({center:t},n),s)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,s){return this.easeTo(qt({zoom:t},n),s)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,s){return this.easeTo(qt({bearing:t},n),s)}resetNorth(t,n){return this.rotateTo(0,qt({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(qt({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=Ur.convert(t);const s=n&&n.bearing||0,a=n&&n.pitch||0,c=t.getNorthWest(),u=t.getSouthEast();return this._cameraForBounds(this.transform,c,u,s,a,n)}_extendCameraOptions(t){const n={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=qt({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const s=t.padding;t.padding={top:s,bottom:s,right:s,left:s}}return t.padding=qt(n,t.padding),t}_minimumAABBFrustumDistance(t,n){const s=n.max[0]-n.min[0],a=n.max[1]-n.min[1];return s/a>t.aspect?s/(2*Math.tan(.5*t.fovX)*t.aspect):a/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,n,s,a,c,u){const d=t.clone(),f=this._extendCameraOptions(u);d.bearing=a,d.pitch=c;const p=ve.convert(n),g=ve.convert(s),_=.5*(p.lat+g.lat),v=.5*(p.lng+g.lng),x=lo(_,v),b=G.normalize([],x),E=G.normalize([],G.cross([],b,[0,1,0])),C=G.cross([],E,b),M=[E[0],E[1],E[2],0,C[0],C[1],C[2],0,b[0],b[1],b[2],0,0,0,0,1],T=[x,lo(p.lat,p.lng),lo(g.lat,p.lng),lo(g.lat,g.lng),lo(p.lat,g.lng),lo(_,p.lng),lo(_,g.lng),lo(p.lat,v),lo(g.lat,v)];let R=qn.fromPoints(T.map(K=>[G.dot(E,K),G.dot(C,K),G.dot(b,K)]));const P=G.transformMat4([],R.center,M);0===G.squaredLength(P)&&G.set(P,0,0,1),G.normalize(P,P),G.scale(P,P,Rr),d.center=function([K,ot,at]){const lt=Math.hypot(K,ot,at),dt=Math.atan2(K,at),ft=.5*Math.PI-Math.acos(-ot/lt);return new ve(ki(dt),ki(ft))}(P);const I=d.getWorldToCameraMatrix(),O=it.invert(new Float64Array(16),I);R=qn.applyTransform(R,it.multiply([],I,M)),G.transformMat4(P,P,I);const L=.5*(R.max[2]-R.min[2]),F=this._minimumAABBFrustumDistance(d,R),N=G.scale([],[0,0,1],L),B=G.add(N,P,N),V=F+(0===d.pitch?0:G.distance(P,B)),U=d.globeCenterInViewSpace,q=G.sub([],P,[U[0],U[1],U[2]]);G.normalize(q,q),G.scale(q,q,V);const j=G.add([],P,q);G.transformMat4(j,j,O);const X=Ic/Rr,Q=G.length(j),nt=An(Math.max(Q*X-Ic,Number.EPSILON),0),Y=Math.min(d.zoomFromMercatorZAdjusted(nt),f.maxZoom);return Y>.5*(Gd+Sc)?(d.setProjection({name:"mercator"}),d.zoom=Y,this._cameraForBounds(d,n,s,a,c,u)):{center:d.center,zoom:Y,bearing:a,pitch:c}}queryTerrainElevation(t,n){const s=this.transform.elevation;return s?(n=qt({},{exaggerated:!0},n),s.getAtPoint(We.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,s,a,c,u){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,n,s,a,c,u);const d=t.clone(),f=this._extendCameraOptions(u),p=d.padding;d.bearing=a,d.pitch=c;const g=ve.convert(n),_=ve.convert(s),v=new ve(g.lng,_.lat),x=new ve(_.lng,g.lat),b=d.project(g),E=d.project(_),C=this.queryTerrainElevation(g),M=this.queryTerrainElevation(_),T=this.queryTerrainElevation(v),R=this.queryTerrainElevation(x),P=[[b.x,b.y,Math.min(C||0,M||0,T||0,R||0)],[E.x,E.y,Math.max(C||0,M||0,T||0,R||0)]];let I=qn.fromPoints(P);const O=d.getWorldToCameraMatrix(),L=it.invert(new Float64Array(16),O);I=qn.applyTransform(I,O);const F=G.sub([],I.max,I.min),N=p.left||0,B=p.right||0,V=p.bottom||0,U=p.top||0,{left:q,right:j,top:X,bottom:Q}=f.padding,nt=.5*(N+B),Y=.5*(U+V),K=Math.min(d.scaleZoom(d.scale*Math.min((d.width-(N+B+q+j))/F[0],(d.height-(V+U+Q+X))/F[1])),f.maxZoom),ot=d.scale/d.zoomScale(K);I=new qn([I.min[0]-(q+nt)*ot,I.min[1]-(Q+Y)*ot,I.min[2]],[I.max[0]+(j+nt)*ot,I.max[1]+(X+Y)*ot,I.max[2]]);const at=.5*F[2],lt=this._minimumAABBFrustumDistance(d,I),dt=[0,0,1,0];mn.transformMat4(dt,dt,O),mn.normalize(dt,dt);const ft=G.scale([],dt,lt+at),gt=G.add([],I.center,ft),ht=("number"==typeof f.offset.x&&"number"==typeof f.offset.y?new et(f.offset.x,f.offset.y):et.convert(f.offset)).rotate(-De(a));I.center[0]-=ht.x*ot,I.center[1]+=ht.y*ot,G.transformMat4(I.center,I.center,L),G.transformMat4(gt,gt,L);const yt=[I.center[0],I.center[1],gt[2]*d.pixelsPerMeter];G.scale(yt,yt,1/d.worldSize);const Ot=or(yt[0]),Lt=Ei(yt[1]),Ut=Math.min(d._zoomFromMercatorZ(yt[2]),f.maxZoom),Gt=new ve(Ot,Lt);return d.mercatorFromTransition&&Ut<.5*(Gd+Sc)?(d.setProjection({name:"globe"}),d.zoom=Ut,this._cameraForBounds(d,n,s,a,c,u)):{center:Gt,zoom:Ut,bearing:a,pitch:c}}fitBounds(t,n,s){const a=this.cameraForBounds(t,n);return this._fitInternal(a,n,s)}fitScreenCoordinates(t,n,s,a,c){const u=et.convert(t),d=et.convert(n),f=new et(Math.min(u.x,d.x),Math.min(u.y,d.y)),p=new et(Math.max(u.x,d.x),Math.max(u.y,d.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(u,d))return this;const g=this.transform.pointLocation3D(f),_=this.transform.pointLocation3D(p),v=this.transform.pointLocation3D(new et(f.x,p.y)),x=this.transform.pointLocation3D(new et(p.x,f.y)),b=[Math.min(g.lng,_.lng,v.lng,x.lng),Math.min(g.lat,_.lat,v.lat,x.lat)],E=[Math.max(g.lng,_.lng,v.lng,x.lng),Math.max(g.lat,_.lat,v.lat,x.lat)],C=a&&a.pitch?a.pitch:this.getPitch(),M=this._cameraForBounds(this.transform,b,E,s,C,a);return this._fitInternal(M,a,c)}_fitInternal(t,n,s){return t?(delete(n=qt(t,n)).padding,n.linear?this.easeTo(n,s):this.flyTo(n,s)):this}jumpTo(t,n){this.stop();const s=t.preloadOnly?this.transform.clone():this.transform;let a=!1,c=!1,u=!1;return"zoom"in t&&s.zoom!==+t.zoom&&(a=!0,s.zoom=+t.zoom),void 0!==t.center&&(s.center=ve.convert(t.center)),"bearing"in t&&s.bearing!==+t.bearing&&(c=!0,s.bearing=+t.bearing),"pitch"in t&&s.pitch!==+t.pitch&&(u=!0,s.pitch=+t.pitch),null==t.padding||s.isPaddingEqual(t.padding)||(s.padding=t.padding),t.preloadOnly?(this._preloadTiles(s),this):(this.fire(new Dt("movestart",n)).fire(new Dt("move",n)),a&&this.fire(new Dt("zoomstart",n)).fire(new Dt("zoom",n)).fire(new Dt("zoomend",n)),c&&this.fire(new Dt("rotatestart",n)).fire(new Dt("rotate",n)).fire(new Dt("rotateend",n)),u&&this.fire(new Dt("pitchstart",n)).fire(new Dt("pitch",n)).fire(new Dt("pitchend",n)),this.fire(new Dt("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||tt(hD),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const s=this.transform;if(!s.projection.supportsFreeCamera)return tt(hD),this;this.stop();const a=s.zoom,c=s.pitch,u=s.bearing;s.setFreeCameraOptions(t);const d=a!==s.zoom,f=c!==s.pitch,p=u!==s.bearing;return this.fire(new Dt("movestart",n)).fire(new Dt("move",n)),d&&this.fire(new Dt("zoomstart",n)).fire(new Dt("zoom",n)).fire(new Dt("zoomend",n)),p&&this.fire(new Dt("rotatestart",n)).fire(new Dt("rotate",n)).fire(new Dt("rotateend",n)),f&&this.fire(new Dt("pitchstart",n)).fire(new Dt("pitch",n)).fire(new Dt("pitchend",n)),this.fire(new Dt("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),(!1===(t=qt({offset:[0,0],duration:500,easing:jn},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const s=this.transform,a=this.getZoom(),c=this.getBearing(),u=this.getPitch(),d=this.getPadding(),f="zoom"in t?+t.zoom:a,p="bearing"in t?this._normalizeBearing(t.bearing,c):c,g="pitch"in t?+t.pitch:u,_="padding"in t?t.padding:s.padding,v=et.convert(t.offset);let x,b,E;if("globe"===s.projection.name){const N=We.fromLngLat(s.center),B=v.rotate(-s.angle);N.x+=B.x/s.worldSize,N.y+=B.y/s.worldSize;const V=N.toLngLat(),U=ve.convert(t.center||V);this._normalizeCenter(U),x=s.centerPoint.add(B),b=new et(N.x,N.y).mult(s.worldSize),E=new et(Ri(U.lng),wi(U.lat)).mult(s.worldSize).sub(b)}else{x=s.centerPoint.add(v);const N=s.pointLocation(x),B=ve.convert(t.center||N);this._normalizeCenter(B),b=s.project(N),E=s.project(B).sub(b)}const C=s.zoomScale(f-a);let M,T;t.around&&(M=ve.convert(t.around),T=s.locationPoint(M));const R=this._zooming||f!==a,P=this._rotating||c!==p,I=this._pitching||g!==u,O=!s.isPaddingEqual(_),L=N=>B=>{if(R&&(N.zoom=vt(a,f,B)),P&&(N.bearing=vt(c,p,B)),I&&(N.pitch=vt(u,g,B)),O&&(N.interpolatePadding(d,_,B),x=N.centerPoint.add(v)),M)N.setLocationAtPoint(M,T);else{const V=N.zoomScale(N.zoom-a),U=f>a?Math.min(2,C):Math.max(.5,C),q=Math.pow(U,1-B),j=N.unproject(b.add(E.mult(B*q)).mult(V));N.setLocationAtPoint(N.renderWorldCopies?j.wrap():j,x)}return t.preloadOnly||this._fireMoveEvents(n),N};if(t.preloadOnly){const N=this._emulate(L,t.duration,s);return this._preloadTiles(N),this}const F={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=R,this._rotating=P,this._pitching=I,this._padding=O,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,F),this._ease(L(s),N=>{"sea"===s.cameraElevationReference&&s.recenterOnTerrain(),this._afterEase(n,N)},t),this}_prepareEase(t,n,s={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),n||s.moving||this.fire(new Dt("movestart",t)),this._zooming&&!s.zooming&&this.fire(new Dt("zoomstart",t)),this._rotating&&!s.rotating&&this.fire(new Dt("rotatestart",t)),this._pitching&&!s.pitching&&this.fire(new Dt("pitchstart",t))}_fireMoveEvents(t){this.fire(new Dt("move",t)),this._zooming&&this.fire(new Dt("zoom",t)),this._rotating&&this.fire(new Dt("rotate",t)),this._pitching&&this.fire(new Dt("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const s=this._zooming,a=this._rotating,c=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,s&&this.fire(new Dt("zoomend",t)),a&&this.fire(new Dt("rotateend",t)),c&&this.fire(new Dt("pitchend",t)),this.fire(new Dt("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const K=Or(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(K,n)}this.stop(),t=qt({offset:[0,0],speed:1.2,curve:1.42,easing:jn},t);const s=this.transform,a=this.getZoom(),c=this.getBearing(),u=this.getPitch(),d=this.getPadding(),f="zoom"in t?Qt(+t.zoom,s.minZoom,s.maxZoom):a,p="bearing"in t?this._normalizeBearing(t.bearing,c):c,g="pitch"in t?+t.pitch:u,_="padding"in t?t.padding:s.padding,v=s.zoomScale(f-a),x=et.convert(t.offset);let b=s.centerPoint.add(x);const E=s.pointLocation(b),C=ve.convert(t.center||E);this._normalizeCenter(C);const M=s.project(E),T=s.project(C).sub(M);let R=t.curve;const P=Math.max(s.width,s.height),I=P/v,O=T.mag();if("minZoom"in t){const K=Qt(Math.min(t.minZoom,a,f),s.minZoom,s.maxZoom),ot=P/s.zoomScale(K-a);R=Math.sqrt(ot/O*2)}const L=R*R;function F(K){const ot=(I*I-P*P+(K?-1:1)*L*L*O*O)/(2*(K?I:P)*L*O);return Math.log(Math.sqrt(ot*ot+1)-ot)}function N(K){return(Math.exp(K)-Math.exp(-K))/2}function B(K){return(Math.exp(K)+Math.exp(-K))/2}const V=F(0);let U=function(K){return B(V)/B(V+R*K)},q=function(K){return P*((B(V)*(N(ot=V+R*K)/B(ot))-N(V))/L)/O;var ot},j=(F(1)-V)/R;if(Math.abs(O)<1e-6||!isFinite(j)){if(Math.abs(P-I)<1e-6)return this.easeTo(t,n);const K=I<P?-1:1;j=Math.abs(Math.log(I/P))/R,q=function(){return 0},U=function(ot){return Math.exp(K*R*ot)}}t.duration="duration"in t?+t.duration:1e3*j/("screenSpeed"in t?+t.screenSpeed/R:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const X=c!==p,Q=g!==u,nt=!s.isPaddingEqual(_),Y=K=>ot=>{const at=ot*j,lt=1/U(at);K.zoom=1===ot?f:a+K.scaleZoom(lt),X&&(K.bearing=vt(c,p,ot)),Q&&(K.pitch=vt(u,g,ot)),nt&&(K.interpolatePadding(d,_,ot),b=K.centerPoint.add(x));const dt=1===ot?C:K.unproject(M.add(T.mult(q(at))).mult(lt));return K.setLocationAtPoint(K.renderWorldCopies?dt.wrap():dt,b),K._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),K};if(t.preloadOnly){const K=this._emulate(Y,t.duration,s);return this._preloadTiles(K),this}return this._zooming=!0,this._rotating=X,this._pitching=Q,this._padding=nt,this._prepareEase(n,!1),this._ease(Y(s),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const s=this._onEaseEnd;this._onEaseEnd=void 0,s.call(this,n)}if(!t){const s=this.handlers;s&&s.stop(!1)}return this}_ease(t,n,s){!1===s.animate||0===s.duration?(t(1),n()):(this._easeStart=xe.now(),this._easeOptions=s,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((xe.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=Os(t,-180,180);const s=Math.abs(t-n);return Math.abs(t-360-n)<s&&(t-=360),Math.abs(t+360-n)<s&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(n.maxBounds||"globe"!==n.projection.name&&!n.renderWorldCopies)return;const s=t.lng-n.center.lng;t.lng+=s>180?-360:s<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&xe.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,n,s){const a=Math.ceil(15*n/1e3),c=[],u=t(s.clone());for(let d=0;d<=a;d++){const f=u(d/a);c.push(f.clone())}return c}}class dD{constructor(t={}){this.options=t,Bi(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const n=this.options&&this.options.compact;return this._map=t,this._container=rn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=rn("button","mapboxgl-ctrl-attrib-button",this._container),rn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=rn("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===n&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const s=this._map._getUIString(`AttributionControl.${n}`);t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",s)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||Le.ACCESS_TOKEN}];if(t){const s=n.reduce((a,c,u)=>(c.value&&(a+=`${c.key}=${c.value}${u<n.length-1?"&":""}`),a),"?");t.href=`${Le.FEEDBACK_URL}/${s}#${JC(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const a=this._map.style.stylesheet;this.styleOwner=a.owner,this.styleId=a.id}const n=this._map.style._mergedSourceCaches;for(const a in n){const c=n[a];if(c.used){const u=c.getSource();u.attribution&&t.indexOf(u.attribution)<0&&t.push(u.attribution)}}t.sort((a,c)=>a.length-c.length),t=t.filter((a,c)=>{for(let u=c+1;u<t.length;u++)if(t[u].indexOf(a)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const s=t.join(" | ");s!==this._attribHTML&&(this._attribHTML=s,t.length?(this._innerContainer.innerHTML=s,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Yg{constructor(){Bi(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=rn("div","mapboxgl-ctrl");const n=rn("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const n in t){const s=t[n].getSource();if(s.hasOwnProperty("mapbox_logo")&&!s.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class fD{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,s=n?this._queue.concat(n):this._queue;for(const a of s)if(a.id===t)return void(a.cancelled=!0)}run(t=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const s of n)if(!s.cancelled&&(s.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function pD(e,t,n){if(e=new ve(e.lng,e.lat),t){const s=new ve(e.lng-360,e.lat),a=new ve(e.lng+360,e.lat),c=360*Math.ceil(Math.abs(e.lng-n.center.lng)/360),u=n.locationPoint(e).distSqr(t),d=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint(s).distSqr(t)<u&&(d||Math.abs(s.lng-n.center.lng)<c)?e=s:n.locationPoint(a).distSqr(t)<u&&(d||Math.abs(a.lng-n.center.lng)<c)&&(e=a)}for(;Math.abs(e.lng-n.center.lng)>180;){const s=n.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=n.width&&s.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}const xx={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class bx extends Be{constructor(t,n){if(super(),(t instanceof st.HTMLElement||n)&&(t=qt({element:t},n)),Bi(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=et.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=rn("div");const c=41,u=27,d=ks("svg",{display:"block",height:c*this._scale+"px",width:u*this._scale+"px",viewBox:`0 0 ${u} ${c}`},this._element),f=ks("radialGradient",{id:"shadowGradient"},ks("defs",{},d));ks("stop",{offset:"10%","stop-opacity":.4},f),ks("stop",{offset:"100%","stop-opacity":.05},f),ks("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},d),ks("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},d),ks("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},d),ks("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},d),this._offset=et.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",c=>{c.preventDefault()}),this._element.addEventListener("mousedown",c=>{c.preventDefault()});const s=this._element.classList;for(const c in xx)s.remove(`mapboxgl-marker-anchor-${c}`);s.add(`mapboxgl-marker-anchor-${this._anchor}`);const a=t&&t.className?t.className.trim().split(/\s+/):[];s.add(...a),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=ve.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const a=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[a,-1*(24.6+a)],"bottom-right":[-a,-1*(24.6+a)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const n=t.code,s=t.charCode||t.keyCode;"Space"!==n&&"Enter"!==n&&32!==s&&13!==s||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,s=this._element;this._popup&&(n===s||s.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,n=this._pos;if(!t||!n)return!1;const s=t.unproject(n),a=t.getFreeCameraOptions();if(!a.position)return!1;const c=a.position.toLngLat();return c.distanceTo(s)<.9*c.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const s=t.unproject(n);let a;t._showingGlobe()&&Hy(t.transform,this._lngLat)?a=0:(a=1-t._queryFogOpacity(s),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(a*=this._occludedOpacity)),this._element.style.opacity=`${a}`,this._element.style.pointerEvents=a>0?"auto":"none",this._popup&&this._popup._setOpacity(a),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px)\n            ${xx[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${n.x}px,${n.y}px)\n        `}_calculateXYTransform(){const t=this._pos,n=this._map,s=this.getPitchAlignment();if(!n||!t||"map"!==s)return"";if(!n._showingGlobe()){const f=n.getPitch();return f?`rotateX(${f}deg)`:""}const a=ki(RT(n.transform,this._lngLat)),c=t.sub(AT(n.transform)),u=Math.abs(c.x)+Math.abs(c.y);if(0===u)return"";const d=a/u;return`rotateX(${-c.y*d}deg) rotateY(${c.x*d}deg)`}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let s=0;const a=this.getRotationAlignment();if("map"===a)if(n._showingGlobe()){const c=n.project(new ve(this._lngLat.lng,this._lngLat.lat+.001)),u=n.project(new ve(this._lngLat.lng,this._lngLat.lat-.001)).sub(c);s=ki(Math.atan2(u.y,u.x))-90}else s=-n.getBearing();else if("horizon"===a){const c=Ps(4,6,n.getZoom()),u=AT(n.transform);u.y+=c*n.transform.height;const d=t.sub(u),f=ki(Math.atan2(d.y,d.x));s=(f>90?f-270:f+90)*(1-c)}return s+=this._rotation,s?`rotateZ(${s}deg)`:""}_update(t){st.cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=pD(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),!0===t?this._updateFrameId=st.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=et.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const n=this._map;if(!n)return;const s=this._pointerdownPos,a=this._positionDelta;if(s&&a){if(!this._isDragging){const c=this._clickTolerance||n._clickTolerance;if(t.point.dist(s)<c)return;this._isDragging=!0}this._pos=t.point.sub(a),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new Dt("dragstart"))),this.fire(new Dt("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new Dt("dragend")),this._state="inactive"}_addDragHandler(t){const n=this._map,s=this._pos;n&&s&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(s),this._pointerdownPos=t.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const n=this._map;return n&&(t?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const _A={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},yA=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function mD(e=new et(0,0),t="bottom"){if("number"==typeof e){const n=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(t){case"top":return new et(0,e);case"top-left":return new et(n,n);case"top-right":return new et(-n,n);case"bottom":return new et(0,-e);case"bottom-left":return new et(n,-n);case"bottom-right":return new et(-n,-n);case"left":return new et(e,0);case"right":return new et(-e,0)}return new et(0,0)}return e instanceof et||Array.isArray(e)?et.convert(e):et.convert(e[t]||[0,0])}class vA{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=qa((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,n,s){this._start=this.getValue(n),this._end=t,this._startTime=n,this._endTime=n+s}}const xA={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},gD={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},wx={showCompass:!0,showZoom:!0,visualizePitch:!1};class bA{constructor(t,n,s=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new rA({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,s&&(this.mousePitch=new oA({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),Bi(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),qi()}move(t,n){const s=this.map,a=this.mouseRotate.mousemoveWindow(t,n),c=a&&a.bearingDelta;if(c&&s.setBearing(s.getBearing()+c),this.mousePitch){const u=this.mousePitch.mousemoveWindow(t,n),d=u&&u.pitchDelta;d&&s.setPitch(s.getPitch()+d)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){vp(),st.removeEventListener("mousemove",this.mousemove),st.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(qt({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Ge(this.element,t)),st.addEventListener("mousemove",this.mousemove),st.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Ge(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=gu(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=gu(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const wA={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},_D={maxWidth:100,unit:"metric"},yD={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ex={version:Ko,supported:u1,setRTLTextPlugin:function(e,t,n=!1){if(Dr===nr||Dr===Zp||Dr===mc)throw new Error("setRTLTextPlugin cannot be called multiple times.");js=xe.resolveURL(e),Dr=nr,jo=t,j1(),n||Vs()},getRTLTextPluginStatus:vr,Map:class extends gA{constructor(e){__.mark(Wh.create);const t=e;if(null!=(e=qt({},gD,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&function(n){const s=n.navigator?n.navigator.userAgent:null;return!!function(a){if(null==ge){const c=a.navigator?a.navigator.userAgent:null;ge=!!a.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return ge}(n)&&s&&(s.match("Version/15.4")||s.match("Version/15.5")||s.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(st)&&(e.antialias=!1,tt("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ug(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new fD,this._domRenderTaskQueue=new fD,this._controls=[],this._markers=[],this._popups=[],this._mapId=hi(),this._locale=qt({},xA,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new vA(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new ce(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,this._contextCreateOptions=e.contextCreateOptions?{...e.contextCreateOptions}:{},"string"==typeof e.container){if(this._container=st.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container.toString()}' not found.`)}else{if(!(e.container instanceof st.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&tt("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),Bi(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==st&&(this._fullscreenchangeEvent="onfullscreenchange"in st.document?"fullscreenchange":"webkitfullscreenchange",st.addEventListener("online",this._onWindowOnline,!1),st.addEventListener("resize",this._onWindowResize,!1),st.addEventListener("orientationchange",this._onWindowResize,!1),st.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),st.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new mA(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||Le.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new NR("string"==typeof e.hash&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==t.center&&null==t.zoom||(this.transform._unmodified=!1),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});const n=e.bounds;n&&(this.resize(),this.fitBounds(n,qt({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new dD({customAttribution:e.customAttribution})),this._logoControl=new Yg,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update("style"===n.dataType),this.fire(new Dt(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new Dt(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(e,t){if(void 0===t&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new zt(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=e.onAdd(this);this._controls.push(e);const s=this._controlPositions[t];return-1!==t.indexOf("bottom")?s.insertBefore(n,s.firstChild):s.appendChild(n),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new zt(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(e);return t>-1&&this._controls.splice(t,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new Dt("movestart",e)).fire(new Dt("move",e)),this.fire(new Dt("resize",e)),t&&this.fire(new Dt("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(Ur.convert(e)),this._update()}setMinZoom(e){if((e=e??-2)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new Dt("zoomstart")).fire(new Dt("zoom")).fire(new Dt("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=e??22)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new Dt("zoomstart")).fire(new Dt("zoom")).fire(new Dt("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=e??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new Dt("pitchstart")).fire(new Dt("pitch")).fire(new Dt("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=e??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new Dt("pitchstart")).fire(new Dt("pitch")).fire(new Dt("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?st.navigator.language:Array.isArray(e)?0===e.length?void 0:e.map(t=>"auto"===t?st.navigator.language:t):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const e=this.transform,t=e.projection.name;let n;"globe"===t&&e.zoom>=Sc?(e.setMercatorFromTransition(),n=!0):"mercator"===t&&e.zoom<Sc&&(e.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(e){let t;return t="globe"===e.name&&this.transform.zoom>=Sc?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(ve.convert(e))}unproject(e){return this.transform.pointLocation3D(et.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,n){if("mouseenter"===e||"mouseover"===e){let s=!1;const a=u=>{const d=t.filter(p=>this.getLayer(p)),f=d.length?this.queryRenderedFeatures(u.point,{layers:d}):[];f.length?s||(s=!0,n.call(this,new Ao(e,this,u.originalEvent,{features:f}))):s=!1},c=()=>{s=!1};return{layers:new Set(t),listener:n,delegates:{mousemove:a,mouseout:c}}}if("mouseleave"===e||"mouseout"===e){let s=!1;const a=u=>{const d=t.filter(f=>this.getLayer(f));(d.length?this.queryRenderedFeatures(u.point,{layers:d}):[]).length?s=!0:s&&(s=!1,n.call(this,new Ao(e,this,u.originalEvent)))},c=u=>{s&&(s=!1,n.call(this,new Ao(e,this,u.originalEvent)))};return{layers:new Set(t),listener:n,delegates:{mousemove:a,mouseout:c}}}{const s=a=>{const c=t.filter(d=>this.getLayer(d)),u=c.length?this.queryRenderedFeatures(a.point,{layers:c}):[];u.length&&(a.features=u,n.call(this,a),delete a.features)};return{layers:new Set(t),listener:n,delegates:{[e]:s}}}}on(e,t,n){if(void 0===n)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t)for(const a of t)if(!this._isValidId(a))return this;const s=this._createDelegatedListener(e,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(s);for(const a in s.delegates)this.on(a,s.delegates[a]);return this}once(e,t,n){if(void 0===n)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t)for(const a of t)if(!this._isValidId(a))return this;const s=this._createDelegatedListener(e,t,n);for(const a in s.delegates)this.once(a,s.delegates[a]);return this}off(e,t,n){if(void 0===n)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(const c of t)if(!this._isValidId(c))return this;const s=(c,u)=>{if(c.size!==u.size)return!1;for(const d of c)if(!u.has(d))return!1;return!0},a=this._delegatedListeners?this._delegatedListeners[e]:void 0;return a&&(c=>{for(let u=0;u<c.length;u++){const d=c[u];if(d.listener===n&&s(d.layers,t)){for(const f in d.delegates)this.off(f,d.delegates[f]);return c.splice(u,1),this}}})(a),this}queryRenderedFeatures(e,t){if(!this.style)return[];if(void 0!==t||void 0===e||e instanceof et||Array.isArray(e)||(t=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers))for(const n of t.layers)if(!this._isValidId(n))return[];return this.style.queryRenderedFeatures(e,t,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(e){const{name:t}=this.transform.projection;return"globe"!==t&&"mercator"!==t&&tt(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(et.convert(e))}setStyle(e,t){return!1!==(t=qt({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new oa(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new oa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,t){if("string"==typeof e){const n=this._requestManager.normalizeStyleURL(e),s=this._requestManager.transformRequest(n,pt.Style);It(s,(a,c)=>{a?this.fire(new zt(a)):c&&this._updateDiff(c,t)})}else"object"==typeof e&&this._updateDiff(e,t)}_updateDiff(e,t){try{this.style.setState(e)&&this._update(!0)}catch(n){tt(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(e,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(tt("There is no style added to the map."),!1)}_isValidId(e){return null==e?(this.fire(new zt(new Error("IDs can't be empty."))),!1):!ny(e)||(this.fire(new zt(new Error(`IDs can't contain special symbols: "${e}".`))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const n=e[t]._tiles;for(const s in n){const a=n[s];if("loaded"!==a.state&&"errored"!==a.state)return!1}}return!0}addSourceType(e,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(e,t,{pixelRatio:n=1,sdf:s=!1,stretchX:a,stretchY:c,content:u}={}){if(this._lazyInitEmptyStyle(),t instanceof st.HTMLImageElement||st.ImageBitmap&&t instanceof st.ImageBitmap){const{width:d,height:f,data:p}=xe.getImageData(t);this.style.addImage(e,{data:new yi({width:d,height:f},p),pixelRatio:n,stretchX:a,stretchY:c,content:u,sdf:s,version:0})}else if(void 0===t.width||void 0===t.height)this.fire(new zt(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:d,height:f}=t,p=t;this.style.addImage(e,{data:new yi({width:d,height:f},new Uint8Array(p.data)),pixelRatio:n,stretchX:a,stretchY:c,content:u,sdf:s,version:0,userImage:p}),p.onAdd&&p.onAdd(this,e)}}updateImage(e,t){this._lazyInitEmptyStyle();const n=this.style.getImage(e);if(!n)return void this.fire(new zt(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const s=t instanceof st.HTMLImageElement||st.ImageBitmap&&t instanceof st.ImageBitmap?xe.getImageData(t):t,{width:a,height:c}=s;void 0!==a&&void 0!==c?a===n.data.width&&c===n.data.height?(n.data.replace(s.data,!(t instanceof st.HTMLImageElement||st.ImageBitmap&&t instanceof st.ImageBitmap)),this.style.updateImage(e,n)):this.fire(new zt(new Error(`The width and height of the updated image (${a}, ${c})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`))):this.fire(new zt(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new zt(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,t){Ie(this._requestManager.transformRequest(e,pt.Image),(n,s)=>{t(n,s instanceof st.HTMLImageElement?xe.getImageData(s):s)})}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new zt(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,n){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,n),this._update(!0)):this}setFilter(e,t,n={}){return this._isValidId(e)?(this.style.setFilter(e,t,n),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,n,s={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,n,s),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,n,s={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,n,s),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,n){return this.style.setConfigProperty(e,t,n),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(ve.convert(e),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,s,a,c=this._container;for(;c&&(!s||!a);){const u=st.getComputedStyle(c).transform;u&&"none"!==u&&(n=u.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&"0"!==n[0]&&"1"!==n[0]&&(s=n[0]),n[3]&&"0"!==n[3]&&"1"!==n[3]&&(a=n[3])),c=c.parentElement}this._containerWidth=s?Math.abs(e/s):e,this._containerHeight=a?Math.abs(t/a):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==st.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&tt("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=rn("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=rn("div","mapboxgl-canvas-container",e);this._canvas=rn("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=rn("div","mapboxgl-control-container",e),s=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(a=>{s[a]=rn("div",`mapboxgl-ctrl-${a}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){const n=xe.devicePixelRatio||1;this._canvas.width=n*Math.ceil(e),this._canvas.height=n*Math.ceil(t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const e=qt({},u1.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",e);t?(l1(t,!0),this.painter=new QI(t,this._contextCreateOptions,this.transform),this.on("data",n=>{"source"===n.dataType&&this.painter.setTileLoadedFlag(!0)}),yo.testSupport(t)):this.fire(new zt(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Dt("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new Dt("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(e){let t;this.fire(new Dt("renderstart"));const n=this.painter.context.extTimerQuery,s=xe.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=a.createQuery(),a.beginQuery(n.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],st.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],st.performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const c=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const f=this.transform.zoom,p=this.transform.pitch,g=xe.now(),_=new zn(f,{now:g,fadeDuration:c,pitch:p,transition:this.style.transition});this.style.update(_)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let u=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),u=this._updateAverageElevation(s),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):u=this._updateAverageElevation(s),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,c,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:c,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Dt("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Dt("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const f=xe.now()-s;a.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const p=a.getQueryParameter(t,a.QUERY_RESULT)/1e6;a.deleteQuery(t),this.fire(new Dt("gpu-timing-frame",{cpuTime:f,gpuTime:p})),st.performance.mark("frame-gpu",{startTime:s,detail:{gpuTime:p}})},50)}if(this.listens("gpu-timing-layer")){const f=this.painter.collectGpuTimers();setTimeout(()=>{const p=this.painter.queryGpuTimers(f);this.fire(new Dt("gpu-timing-layer",{layerTimes:p}))},50)}if(this.listens("gpu-timing-deferred-render")){const f=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const p=this.painter.queryGpuTimeDeferredRender(f);this.fire(new Dt("gpu-timing-deferred-render",{gpuTime:p}))},50)}const d=this._sourcesDirty||this._styleDirty||this._placementDirty||u;if(d||this._repaint)this.triggerRepaint();else{const f=!this.isMoving()&&this.loaded();if(f&&(u=this._updateAverageElevation(s,!0)),u)this.triggerRepaint();else if(this._triggerFrame(!1),f&&(this.fire(new Dt("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const p=this._calculateSpeedIndex();this.fire(new Dt("speedindexcompleted",{speedIndex:p})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,__.mark(Wh.fullLoad),this._performanceMetricsCollection&&a1(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){const n=a=>(this.transform.averageElevation=a,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);const s=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(s||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const a=this.transform.averageElevation;let c=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(c)?c=0:this._averageElevationLastSampledAt=e;const u=Math.abs(a-c);if(u>1){if(this._isInitialLoad||s)return this._averageElevation.jumpTo(c),n(c);this._averageElevation.easeTo(c,e,300)}else if(u>1e-4)return this._averageElevation.jumpTo(c),n(c)}return!!this._averageElevation.isEasing(e)&&n(this._averageElevation.getValue(e))}_authenticate(){wM(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===wn||401===e.status)){const t=this.painter.context.gl;l1(t,!1),this._logoControl instanceof Yg&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new zt(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),X2(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,s=n.createFramebuffer();function a(c){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,c,0);const u=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,u),u}return n.bindFramebuffer(n.FRAMEBUFFER,s),this._canvasPixelComparison(a(e),t.canvasCopies.map(a),t.timeStamps)}_canvasPixelComparison(e,t,n){let s=n[1]-n[0];const a=e.length/4;for(let c=0;c<t.length;c++){const u=t[c];let d=0;for(let f=0;f<u.length;f+=4)u[f]===e[f]&&u[f+1]===e[f+1]&&u[f+2]===e[f+2]&&u[f+3]===e[f+3]&&(d+=1);s+=(n[c+2]-n[c+1])*(1-d/a)}return s}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==st&&(st.removeEventListener("resize",this._onWindowResize,!1),st.removeEventListener("orientationchange",this._onWindowResize,!1),st.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),st.removeEventListener("online",this._onWindowOnline,!1),st.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Qa.delete(this.painter.context.gl),this._removed=!0,this.fire(new Dt("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=xe.frame(t=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(t)}))}_preloadTiles(e){return Kl(this.style?Object.values(this.style._sourceCaches):[],(t,n)=>t._preloadTiles(e,n),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===st.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(e,t){mr=e,wr=t}get version(){return Ko}},NavigationControl:class{constructor(e){this.options=qt({},wx,e),this._container=rn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(Bi(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),rn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),rn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(Bi(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:t}):n.resetNorth({},{originalEvent:t}))}),this._compassIcon=rn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),n=t===e.getMaxZoom(),s=t===e.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bA(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const n=rn("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",n),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends Be{constructor(e){super(),this.options=qt({geolocation:st.navigator.geolocation},wA,e),Bi(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=QC(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=rn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){const t=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,e(n)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==st.navigator.permissions?st.navigator.permissions.query({name:"geolocation"}).then(n=>t("denied"!==n.state)).catch(()=>t()):t()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new Dt("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Dt("geolocate",e)),this._finish()}}_updateCamera(e){const t=new ve(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,s=qt({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),s,{geolocateSource:!0})}_updateMarker(e){if(e){const t=new ve(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,t=An(1,e._center.lat)*e.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Dt("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=rn("button","mapboxgl-ctrl-geolocate",this._container),rn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){tt("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=rn("div","mapboxgl-user-location"),this._dotElement.appendChild(rn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(rn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new bx({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=rn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bx({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Dt("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return tt("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Dt("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Dt("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Dt("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{st.addEventListener("ondeviceorientationabsolute"in st?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==st.DeviceMotionEvent&&"function"==typeof st.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),st.removeEventListener("deviceorientation",this._onDeviceOrientation),st.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:dD,ScaleControl:class{constructor(e){this.options=qt({},_D,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),Bi(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,s=t._containerWidth/2-e/2,a=t.unproject([s,n]),c=t.unproject([s+e,n]),u=a.distanceTo(c);if("imperial"===this.options.unit){const d=3.2808*u;d>5280?this._setScale(e,d/5280,"mile"):this._setScale(e,d,"foot")}else"nautical"===this.options.unit?this._setScale(e,u/1852,"nautical-mile"):u>=1e3?this._setScale(e,u/1e3,"kilometer"):this._setScale(e,u,"meter")}_setScale(e,t,n){this._map._requestDomTask(()=>{const s=function(c){const u=Math.pow(10,`${Math.floor(c)}`.length-1);let d=c/u;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:d>=1?1:function(f){const p=Math.pow(10,Math.ceil(-Math.log(f)/Math.LN10));return Math.round(f*p)/p}(d),u*d}(t),a=s/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==n?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(s):`${s}&nbsp;${yD[n]}`,this._container.style.width=e*a+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=rn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof st.HTMLElement?this._container=e.container:tt("Full screen control 'container' must be a DOM element.")),Bi(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in st.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in st.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=rn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",tt("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,st.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!st.document.fullscreenEnabled&&!st.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=rn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);rn("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),st.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(st.document.fullscreenElement||st.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?st.document.exitFullscreen?st.document.exitFullscreen():st.document.webkitCancelFullScreen&&st.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends Be{constructor(e){super(),this.options=qt(Object.create(_A),e),Bi(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new Dt("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new Dt("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=ve.convert(e),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(st.document.createTextNode(e))}setHTML(e){const t=st.document.createDocumentFragment(),n=st.document.createElement("body");let s;for(n.innerHTML=e;s=n.firstChild,s;)t.appendChild(s);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=rn("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const n=this._closeButton=rn("button","mapboxgl-popup-close-button",t);n.type="button",n.setAttribute("aria-label","Close popup"),n.setAttribute("aria-hidden","true"),n.innerHTML="&#215;",n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,s=this._pos;if(!t||!n||!s)return"bottom";const a=n.offsetWidth,c=n.offsetHeight,u=s.x<a/2,d=s.x>t.transform.width-a/2;if(s.y+e<c)return u?"top-left":d?"top-right":"top";if(s.y>t.transform.height-c){if(u)return"bottom-left";if(d)return"bottom-right"}return u?"left":d?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(e){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let s=this._container;if(s||(s=this._container=rn("div","mapboxgl-popup",t.getContainer()),this._tip=rn("div","mapboxgl-popup-tip",s),s.appendChild(n)),this.options.maxWidth&&s.style.maxWidth!==this.options.maxWidth&&(s.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pD(this._lngLat,this._pos,t.transform)),!this._trackPointer||e){const a=this._pos=this._trackPointer&&e?e:t.project(this._lngLat),c=mD(this.options.offset),u=this._anchor=this._getAnchor(c.y),d=mD(this.options.offset,u),f=a.add(d).round();t._requestDomTask(()=>{this._container&&u&&(this._container.style.transform=`${xx[u]} translate(${f.x}px,${f.y}px)`)})}if(!this._marker&&t._showingGlobe()){const a=Hy(t.transform,this._lngLat)?0:1;this._setOpacity(a)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(yA);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:bx,Style:oa,LngLat:ve,LngLatBounds:Ur,Point:et,MercatorCoordinate:We,FreeCameraOptions:qv,Evented:Be,config:Le,prewarm:function(){Ff().acquire(xg)},clearPrewarmedResources:function(){const e=Lf;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(xg),Lf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return Le.ACCESS_TOKEN},set accessToken(e){Le.ACCESS_TOKEN=e},get baseApiUrl(){return Le.API_URL},set baseApiUrl(e){Le.API_URL=e},get workerCount(){return Oh.workerCount},set workerCount(e){Oh.workerCount=e},get maxParallelImageRequests(){return Le.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){Le.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){!function(t){if(!pu())return;const n=st.caches.delete($n);t&&n.catch(t).then(()=>t())}(e)},workerUrl:"",workerClass:null,get dracoUrl(){return Nf()},set dracoUrl(e){M0=xe.resolveURL(e),T0||(T0=new b0(Ff(),new Be)),T0.broadcast("setDracoUrl",M0)},setNow:xe.setNow,restoreNow:xe.restoreNow};te.A=Pr,te.D=Il,te.E=ut,te.F=Um,te.K=Ig,te.O=nn,te.P=et,te.T=vE,te.V=pv,te.a=Oa,te.b=gv,te.c=mg,te.d=class extends Be{constructor(e,t,n,s,a,c){super(),this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=a||WE,this.loading={},this.loaded={},this.deduped=new C0(e.scheduler),this.isSpriteLoaded=s,this.scheduler=e.scheduler,this.brightness=c}loadTile(e,t){const n=e.uid,s=e&&e.request,a=s&&s.collectResourceTiming,c=this.loading[n]=new SR(e);c.abort=this.loadVectorData(e,(u,d)=>{const f=!this.loading[n];if(delete this.loading[n],f||u||!d)return c.status="done",f||(this.loaded[n]=c),t(u);const p=d.rawData,g={};d.expires&&(g.expires=d.expires),d.cacheControl&&(g.cacheControl=d.cacheControl),c.vectorTile=d.vectorTile||new fv(new jm(p));const _=()=>{c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,(v,x)=>{if(v||!x)return t(v);const b={};if(a){const E=c1(s);E.length>0&&(b.resourceTiming=JSON.parse(JSON.stringify(E)))}t(null,qt({rawTileData:p.slice(0)},x,g,b))})};this.isSpriteLoaded?_():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(_,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):_()}),this.loaded=this.loaded||{},this.loaded[n]=c})}reloadTile(e,t){const n=this.loaded,s=e.uid,a=this;if(n&&n[s]){const c=n[s];c.showCollisionBoxes=e.showCollisionBoxes,c.projection=e.projection,c.brightness=e.brightness,c.tileTransform=Pl(e.tileID.canonical,e.projection),c.extraShadowCaster=e.extraShadowCaster;const u=(d,f)=>{const p=c.reloadCallback;p&&(delete c.reloadCallback,c.parse(c.vectorTile,a.layerIndex,this.availableImages,a.actor,p)),t(d,f)};"parsing"===c.status?c.reloadCallback=u:"done"===c.status&&(c.vectorTile?c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,u):u())}else t(null,void 0)}abortTile(e,t){const n=e.uid,s=this.loading[n];s&&(s.abort&&s.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,s=e.uid;n&&n[s]&&delete n[s],t()}},te.e=xa,te.f=c1,te.g=Jr,te.h=It,te.i=Nt,te.j=function(e,t){const n=Dg(e);for(const s of n){for(const a of s.meshes)zf(a);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(lI(s.lights,t)))}return n},te.k=zn,te.l=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==XE){const n=new Uint32Array(e,0,7),[,,s,a,c,u]=n;t=n.byteLength+a+c+u+c,(s!==e.byteLength||t>=e.byteLength)&&tt("Invalid b3dm header information.")}return tC(e,t)},te.m=eg,te.n=Eo,te.o=Dt,te.p=Ga,te.q=function(e){to(),kr&&kr.then(t=>{t.keys().then(n=>{for(let s=0;s<n.length-e;s++)t.delete(n[s])})})},te.r=nC,te.s=Ex,te.t=Wd,te.v=kn,te.w=st}),qh(0,function(te){function st(At){if("number"==typeof At||"boolean"==typeof At||"string"==typeof At||null==At)return JSON.stringify(At);if(Array.isArray(At)){let W="[";for(const tt of At)W+=`${st(tt)},`;return`${W}]`}let $="{";for(const W of Object.keys(At).sort())$+=`${W}:${st(At[W])},`;return`${$}}`}function Ko(At){let $="";for(const W of te.r)$+=`/${st(At[W])}`;return $}class Ms{constructor($){this.keyCache={},this._layers={},this._layerConfigs={},$&&this.replace($)}replace($,W){this._layerConfigs={},this._layers={},this.update($,[],W)}update($,W,tt){this._options=tt;for(const Mt of $){this._layerConfigs[Mt.id]=Mt;const $t=this._layers[Mt.id]=te.c(Mt,this._options);$t.setScope(this.scope),$t.compileFilter(),this.keyCache[Mt.id]&&delete this.keyCache[Mt.id]}for(const Mt of W)delete this.keyCache[Mt],delete this._layerConfigs[Mt],delete this._layers[Mt];this.familiesBySource={};const bt=function(Mt,$t){const ne={};for(let ae=0;ae<Mt.length;ae++){const ge=$t&&$t[Mt[ae].id]||Ko(Mt[ae]);$t&&($t[Mt[ae].id]=ge);let _e=ne[ge];_e||(_e=ne[ge]=[]),_e.push(Mt[ae])}const Ct=[];for(const ae in ne)Ct.push(ne[ae]);return Ct}(te.v(this._layerConfigs),this.keyCache);for(const Mt of bt){const $t=Mt.map(Ln=>this._layers[Ln.id]),ne=$t[0];if("none"===ne.visibility)continue;const Ct=ne.source||"";let ae=this.familiesBySource[Ct];ae||(ae=this.familiesBySource[Ct]={});const ge=ne.sourceLayer||"_geojsonTileLayer";let _e=ae[ge];_e||(_e=ae[ge]=[]),_e.push($t)}}}class Le{loadTile($,W){const{uid:tt,encoding:bt,rawImageData:Mt,padding:$t}=$,ne=te.w.ImageBitmap&&Mt instanceof te.w.ImageBitmap?this.getImageData(Mt,$t):Mt;W(null,new te.D(tt,ne,bt,$t<1))}getImageData($,W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);const tt=this.offscreenCanvasContext.getImageData(-W,-W,$.width+2*W,$.height+2*W);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),tt}}function yo(At,$){if(0!==At.length){Qo(At[0],$);for(var W=1;W<At.length;W++)Qo(At[W],!$)}}function Qo(At,$){for(var W=0,tt=0,bt=0,Mt=At.length,$t=Mt-1;bt<Mt;$t=bt++){var ne=(At[bt][0]-At[$t][0])*(At[$t][1]+At[bt][1]),Ct=W+ne;tt+=Math.abs(W)>=Math.abs(ne)?W-Ct+ne:ne-Ct+W,W=Ct}W+tt>=0!=!!$&&At.reverse()}var ha=te.g(function At($,W){var tt,bt=$&&$.type;if("FeatureCollection"===bt)for(tt=0;tt<$.features.length;tt++)At($.features[tt],W);else if("GeometryCollection"===bt)for(tt=0;tt<$.geometries.length;tt++)At($.geometries[tt],W);else if("Feature"===bt)At($.geometry,W);else if("Polygon"===bt)yo($.coordinates,W);else if("MultiPolygon"===bt)for(tt=0;tt<$.coordinates.length;tt++)yo($.coordinates[tt],W);return $});const Wl=te.V.prototype.toGeoJSON;var Ha={exports:{}},pp=te.p,Zh=te.a.VectorTileFeature,Jr=Ts;function Ts(At,$){this.options=$||{},this.features=At,this.length=At.length}function Ss(At,$){this.id="number"==typeof At.id?At.id:void 0,this.type=At.type,this.rawGeometry=1===At.type?[At.geometry]:At.geometry,this.properties=At.tags,this.extent=$||4096}Ts.prototype.feature=function(At){return new Ss(this.features[At],this.options.extent)},Ss.prototype.loadGeometry=function(){var At=this.rawGeometry;this.geometry=[];for(var $=0;$<At.length;$++){for(var W=At[$],tt=[],bt=0;bt<W.length;bt++)tt.push(new pp(W[bt][0],W[bt][1]));this.geometry.push(tt)}return this.geometry},Ss.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var At=this.geometry,$=1/0,W=-1/0,tt=1/0,bt=-1/0,Mt=0;Mt<At.length;Mt++)for(var $t=At[Mt],ne=0;ne<$t.length;ne++){var Ct=$t[ne];$=Math.min($,Ct.x),W=Math.max(W,Ct.x),tt=Math.min(tt,Ct.y),bt=Math.max(bt,Ct.y)}return[$,tt,W,bt]},Ss.prototype.toGeoJSON=Zh.prototype.toGeoJSON;var mp=te.b,Ga=Jr;function Is(At){var $=new mp;return function(W,tt){for(var bt in W.layers)tt.writeMessage(3,et,W.layers[bt])}(At,$),$.finish()}function et(At,$){var W;$.writeVarintField(15,At.version||1),$.writeStringField(1,At.name||""),$.writeVarintField(5,At.extent||4096);var tt={keys:[],values:[],keycache:{},valuecache:{}};for(W=0;W<At.length;W++)tt.feature=At.feature(W),$.writeMessage(2,Xe,tt);var bt=tt.keys;for(W=0;W<bt.length;W++)$.writeStringField(3,bt[W]);var Mt=tt.values;for(W=0;W<Mt.length;W++)$.writeMessage(4,g_,Mt[W])}function Xe(At,$){var W=At.feature;void 0!==W.id&&$.writeVarintField(1,W.id),$.writeMessage(2,Yl,At),$.writeVarintField(3,W.type),$.writeMessage(4,ki,W)}function Yl(At,$){var W=At.feature,tt=At.keys,bt=At.values,Mt=At.keycache,$t=At.valuecache;for(var ne in W.properties){var Ct=W.properties[ne],ae=Mt[ne];if(null!==Ct){void 0===ae&&(tt.push(ne),Mt[ne]=ae=tt.length-1),$.writeVarint(ae);var ge=typeof Ct;"string"!==ge&&"boolean"!==ge&&"number"!==ge&&(Ct=JSON.stringify(Ct));var _e=ge+":"+Ct,Ln=$t[_e];void 0===Ln&&(bt.push(Ct),$t[_e]=Ln=bt.length-1),$.writeVarint(Ln)}}}function As(At,$){return($<<3)+(7&At)}function De(At){return At<<1^At>>31}function ki(At,$){for(var W=At.loadGeometry(),tt=At.type,bt=0,Mt=0,$t=W.length,ne=0;ne<$t;ne++){var Ct=W[ne],ae=1;1===tt&&(ae=Ct.length),$.writeVarint(As(1,ae));for(var ge=3===tt?Ct.length-1:Ct.length,_e=0;_e<ge;_e++){1===_e&&1!==tt&&$.writeVarint(As(2,ge-1));var Ln=Ct[_e].x-bt,si=Ct[_e].y-Mt;$.writeVarint(De(Ln)),$.writeVarint(De(si)),bt+=Ln,Mt+=si}3===tt&&$.writeVarint(As(7,1))}}function g_(At,$){var W=typeof At;"string"===W?$.writeStringField(1,At):"boolean"===W?$.writeBooleanField(7,At):"number"===W&&(At%1!=0?$.writeDoubleField(3,At):At<0?$.writeSVarintField(6,At):$.writeVarintField(5,At))}Ha.exports=Is,Ha.exports.fromVectorTileJs=Is,Ha.exports.fromGeojsonVt=function(At,$){$=$||{};var W={};for(var tt in At)W[tt]=new Ga(At[tt].features,$),W[tt].name=tt,W[tt].version=$.version,W[tt].extent=$.extent;return Is({layers:W})},Ha.exports.GeoJSONWrapper=Ga;var qa=te.g(Ha.exports);const Rs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:At=>At},Xl=Math.fround||(Za=new Float32Array(1),At=>(Za[0]=+At,Za[0]));var Za;const jn=3,Qt=5,Ps=6;class Os{constructor($){this.options=Object.assign(Object.create(Rs),$),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load($){const{log:W,minZoom:tt,maxZoom:bt}=this.options;W&&console.time("total time");const Mt=`prepare ${$.length} points`;W&&console.time(Mt),this.points=$;const $t=[];for(let Ct=0;Ct<$.length;Ct++){const ae=$[Ct];if(!ae.geometry)continue;const[ge,_e]=ae.geometry.coordinates,Ln=Xl(qt(ge)),si=Xl(Or(_e));$t.push(Ln,si,1/0,Ct,-1,1),this.options.reduce&&$t.push(0)}let ne=this.trees[bt+1]=this._createTree($t);W&&console.timeEnd(Mt);for(let Ct=bt;Ct>=tt;Ct--){const ae=+Date.now();ne=this.trees[Ct]=this._createTree(this._cluster(ne,Ct)),W&&console.log("z%d: %d clusters in %dms",Ct,ne.numItems,+Date.now()-ae)}return W&&console.timeEnd("total time"),this}getClusters($,W){let tt=(($[0]+180)%360+360)%360-180;const bt=Math.max(-90,Math.min(90,$[1]));let Mt=180===$[2]?180:(($[2]+180)%360+360)%360-180;const $t=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)tt=-180,Mt=180;else if(tt>Mt){const _e=this.getClusters([tt,bt,180,$t],W),Ln=this.getClusters([-180,bt,Mt,$t],W);return _e.concat(Ln)}const ne=this.trees[this._limitZoom(W)],Ct=ne.range(qt(tt),Or($t),qt(Mt),Or(bt)),ae=ne.data,ge=[];for(const _e of Ct){const Ln=this.stride*_e;ge.push(ae[Ln+Qt]>1?Kl(ae,Ln,this.clusterProps):this.points[ae[Ln+jn]])}return ge}getChildren($){const W=this._getOriginId($),tt=this._getOriginZoom($),bt="No cluster with the specified id.",Mt=this.trees[tt];if(!Mt)throw new Error(bt);const $t=Mt.data;if(W*this.stride>=$t.length)throw new Error(bt);const ne=this.options.radius/(this.options.extent*Math.pow(2,tt-1)),Ct=Mt.within($t[W*this.stride],$t[W*this.stride+1],ne),ae=[];for(const ge of Ct){const _e=ge*this.stride;$t[_e+4]===$&&ae.push($t[_e+Qt]>1?Kl($t,_e,this.clusterProps):this.points[$t[_e+jn]])}if(0===ae.length)throw new Error(bt);return ae}getLeaves($,W,tt){const bt=[];return this._appendLeaves(bt,$,W=W||10,tt=tt||0,0),bt}getTile($,W,tt){const bt=this.trees[this._limitZoom($)],Mt=Math.pow(2,$),{extent:$t,radius:ne}=this.options,Ct=ne/$t,ae=(tt-Ct)/Mt,ge=(tt+1+Ct)/Mt,_e={features:[]};return this._addTileFeatures(bt.range((W-Ct)/Mt,ae,(W+1+Ct)/Mt,ge),bt.data,W,tt,Mt,_e),0===W&&this._addTileFeatures(bt.range(1-Ct/Mt,ae,1,ge),bt.data,Mt,tt,Mt,_e),W===Mt-1&&this._addTileFeatures(bt.range(0,ae,Ct/Mt,ge),bt.data,-1,tt,Mt,_e),_e.features.length?_e:null}getClusterExpansionZoom($){let W=this._getOriginZoom($)-1;for(;W<=this.options.maxZoom;){const tt=this.getChildren($);if(W++,1!==tt.length)break;$=tt[0].properties.cluster_id}return W}_appendLeaves($,W,tt,bt,Mt){const $t=this.getChildren(W);for(const ne of $t){const Ct=ne.properties;if(Ct&&Ct.cluster?Mt+Ct.point_count<=bt?Mt+=Ct.point_count:Mt=this._appendLeaves($,Ct.cluster_id,tt,bt,Mt):Mt<bt?Mt++:$.push(ne),$.length===tt)break}return Mt}_createTree($){const W=new te.K($.length/this.stride|0,this.options.nodeSize,Float32Array);for(let tt=0;tt<$.length;tt+=this.stride)W.add($[tt],$[tt+1]);return W.finish(),W.data=$,W}_addTileFeatures($,W,tt,bt,Mt,$t){for(const ne of $){const Ct=ne*this.stride,ae=W[Ct+Qt]>1;let ge,_e,Ln;if(ae)ge=kn(W,Ct,this.clusterProps),_e=W[Ct],Ln=W[Ct+1];else{const ai=this.points[W[Ct+jn]];ge=ai.properties;const[Un,$n]=ai.geometry.coordinates;_e=qt(Un),Ln=Or($n)}const si={type:1,geometry:[[Math.round(this.options.extent*(_e*Mt-tt)),Math.round(this.options.extent*(Ln*Mt-bt))]],tags:ge};let Hi;Hi=ae||this.options.generateId?W[Ct+jn]:this.points[W[Ct+jn]].id,void 0!==Hi&&(si.id=Hi),$t.features.push(si)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(Math.floor(+$),this.options.maxZoom+1))}_cluster($,W){const{radius:tt,extent:bt,reduce:Mt,minPoints:$t}=this.options,ne=tt/(bt*Math.pow(2,W)),Ct=$.data,ae=[],ge=this.stride;for(let _e=0;_e<Ct.length;_e+=ge){if(Ct[_e+2]<=W)continue;Ct[_e+2]=W;const Ln=Ct[_e],si=Ct[_e+1],Hi=$.within(Ct[_e],Ct[_e+1],ne),ai=Ct[_e+Qt];let Un=ai;for(const $n of Hi){const mr=$n*ge;Ct[mr+2]>W&&(Un+=Ct[mr+Qt])}if(Un>ai&&Un>=$t){let $n,mr=Ln*ai,wr=si*ai,kr=-1;const Jo=((_e/ge|0)<<5)+(W+1)+this.points.length;for(const pu of Hi){const to=pu*ge;if(Ct[to+2]<=W)continue;Ct[to+2]=W;const da=Ct[to+Qt];mr+=Ct[to]*da,wr+=Ct[to+1]*da,Ct[to+4]=Jo,Mt&&($n||($n=this._map(Ct,_e,!0),kr=this.clusterProps.length,this.clusterProps.push($n)),Mt($n,this._map(Ct,to)))}Ct[_e+4]=Jo,ae.push(mr/Un,wr/Un,1/0,Jo,-1,Un),Mt&&ae.push(kr)}else{for(let $n=0;$n<ge;$n++)ae.push(Ct[_e+$n]);if(Un>1)for(const $n of Hi){const mr=$n*ge;if(!(Ct[mr+2]<=W)){Ct[mr+2]=W;for(let wr=0;wr<ge;wr++)ae.push(Ct[mr+wr])}}}}return ae}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,W,tt){if($[W+Qt]>1){const $t=this.clusterProps[$[W+Ps]];return tt?Object.assign({},$t):$t}const bt=this.points[$[W+jn]].properties,Mt=this.options.map(bt);return tt&&Mt===bt?Object.assign({},Mt):Mt}}function Kl(At,$,W){return{type:"Feature",id:At[$+jn],properties:kn(At,$,W),geometry:{type:"Point",coordinates:[(tt=At[$],360*(tt-.5)),Di(At[$+1])]}};var tt}function kn(At,$,W){const tt=At[$+Qt],bt=tt>=1e4?`${Math.round(tt/1e3)}k`:tt>=1e3?Math.round(tt/100)/10+"k":tt,Mt=At[$+Ps],$t=-1===Mt?{}:Object.assign({},W[Mt]);return Object.assign($t,{cluster:!0,cluster_id:At[$+jn],point_count:tt,point_count_abbreviated:bt})}function qt(At){return At/360+.5}function Or(At){const $=Math.sin(At*Math.PI/180),W=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return W<0?0:W>1?1:W}function Di(At){const $=(180-360*At)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}var hi={exports:{}};hi.exports=function(){function At(pt,_t,Tt,Rt){for(var It,Nt=Rt,jt=Tt-_t>>1,kt=Tt-_t,Kt=pt[_t],Bt=pt[_t+1],Ie=pt[Tt],wn=pt[Tt+1],ce=_t+3;ce<Tt;ce+=3){var _n=$(pt[ce],pt[ce+1],Kt,Bt,Ie,wn);if(_n>Nt)It=ce,Nt=_n;else if(_n===Nt){var pn=Math.abs(ce-jt);pn<kt&&(It=ce,kt=pn)}}Nt>Rt&&(It-_t>3&&At(pt,_t,It,Rt),pt[It+2]=Nt,Tt-It>3&&At(pt,It,Tt,Rt))}function $(pt,_t,Tt,Rt,It,Nt){var jt=It-Tt,kt=Nt-Rt;if(0!==jt||0!==kt){var Kt=((pt-Tt)*jt+(_t-Rt)*kt)/(jt*jt+kt*kt);Kt>1?(Tt=It,Rt=Nt):Kt>0&&(Tt+=jt*Kt,Rt+=kt*Kt)}return(jt=pt-Tt)*jt+(kt=_t-Rt)*kt}function W(pt,_t,Tt,Rt){var It={id:void 0===pt?null:pt,type:_t,geometry:Tt,tags:Rt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Nt){var jt=Nt.geometry,kt=Nt.type;if("Point"===kt||"MultiPoint"===kt||"LineString"===kt)tt(Nt,jt);else if("Polygon"===kt||"MultiLineString"===kt)for(var Kt=0;Kt<jt.length;Kt++)tt(Nt,jt[Kt]);else if("MultiPolygon"===kt)for(Kt=0;Kt<jt.length;Kt++)for(var Bt=0;Bt<jt[Kt].length;Bt++)tt(Nt,jt[Kt][Bt])}(It),It}function tt(pt,_t){for(var Tt=0;Tt<_t.length;Tt+=3)pt.minX=Math.min(pt.minX,_t[Tt]),pt.minY=Math.min(pt.minY,_t[Tt+1]),pt.maxX=Math.max(pt.maxX,_t[Tt]),pt.maxY=Math.max(pt.maxY,_t[Tt+1])}function bt(pt,_t,Tt,Rt){if(_t.geometry){var It=_t.geometry.coordinates,Nt=_t.geometry.type,jt=Math.pow(Tt.tolerance/((1<<Tt.maxZoom)*Tt.extent),2),kt=[],Kt=_t.id;if(Tt.promoteId?Kt=_t.properties[Tt.promoteId]:Tt.generateId&&(Kt=Rt||0),"Point"===Nt)Mt(It,kt);else if("MultiPoint"===Nt)for(var Bt=0;Bt<It.length;Bt++)Mt(It[Bt],kt);else if("LineString"===Nt)$t(It,kt,jt,!1);else if("MultiLineString"===Nt){if(Tt.lineMetrics){for(Bt=0;Bt<It.length;Bt++)$t(It[Bt],kt=[],jt,!1),pt.push(W(Kt,"LineString",kt,_t.properties));return}ne(It,kt,jt,!1)}else if("Polygon"===Nt)ne(It,kt,jt,!0);else{if("MultiPolygon"!==Nt){if("GeometryCollection"===Nt){for(Bt=0;Bt<_t.geometry.geometries.length;Bt++)bt(pt,{id:Kt,geometry:_t.geometry.geometries[Bt],properties:_t.properties},Tt,Rt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Bt=0;Bt<It.length;Bt++){var Ie=[];ne(It[Bt],Ie,jt,!0),kt.push(Ie)}}pt.push(W(Kt,Nt,kt,_t.properties))}}function Mt(pt,_t){_t.push(Ct(pt[0])),_t.push(ae(pt[1])),_t.push(0)}function $t(pt,_t,Tt,Rt){for(var It,Nt,jt=0,kt=0;kt<pt.length;kt++){var Kt=Ct(pt[kt][0]),Bt=ae(pt[kt][1]);_t.push(Kt),_t.push(Bt),_t.push(0),kt>0&&(jt+=Rt?(It*Bt-Kt*Nt)/2:Math.sqrt(Math.pow(Kt-It,2)+Math.pow(Bt-Nt,2))),It=Kt,Nt=Bt}var Ie=_t.length-3;_t[2]=1,At(_t,0,Ie,Tt),_t[Ie+2]=1,_t.size=Math.abs(jt),_t.start=0,_t.end=_t.size}function ne(pt,_t,Tt,Rt){for(var It=0;It<pt.length;It++){var Nt=[];$t(pt[It],Nt,Tt,Rt),_t.push(Nt)}}function Ct(pt){return pt/360+.5}function ae(pt){var _t=Math.sin(pt*Math.PI/180),Tt=.5-.25*Math.log((1+_t)/(1-_t))/Math.PI;return Tt<0?0:Tt>1?1:Tt}function ge(pt,_t,Tt,Rt,It,Nt,jt,kt){if(Rt/=_t,Nt>=(Tt/=_t)&&jt<Rt)return pt;if(jt<Tt||Nt>=Rt)return null;for(var Kt=[],Bt=0;Bt<pt.length;Bt++){var Ie=pt[Bt],wn=Ie.geometry,ce=Ie.type,_n=0===It?Ie.minX:Ie.minY,pn=0===It?Ie.maxX:Ie.maxY;if(_n>=Tt&&pn<Rt)Kt.push(Ie);else if(!(pn<Tt||_n>=Rt)){var pi=[];if("Point"===ce||"MultiPoint"===ce)_e(wn,pi,Tt,Rt,It);else if("LineString"===ce)Ln(wn,pi,Tt,Rt,It,!1,kt.lineMetrics);else if("MultiLineString"===ce)Hi(wn,pi,Tt,Rt,It,!1);else if("Polygon"===ce)Hi(wn,pi,Tt,Rt,It,!0);else if("MultiPolygon"===ce)for(var Mi=0;Mi<wn.length;Mi++){var gr=[];Hi(wn[Mi],gr,Tt,Rt,It,!0),gr.length&&pi.push(gr)}if(pi.length){if(kt.lineMetrics&&"LineString"===ce){for(Mi=0;Mi<pi.length;Mi++)Kt.push(W(Ie.id,ce,pi[Mi],Ie.tags));continue}"LineString"!==ce&&"MultiLineString"!==ce||(1===pi.length?(ce="LineString",pi=pi[0]):ce="MultiLineString"),"Point"!==ce&&"MultiPoint"!==ce||(ce=3===pi.length?"Point":"MultiPoint"),Kt.push(W(Ie.id,ce,pi,Ie.tags))}}}return Kt.length?Kt:null}function _e(pt,_t,Tt,Rt,It){for(var Nt=0;Nt<pt.length;Nt+=3){var jt=pt[Nt+It];jt>=Tt&&jt<=Rt&&(_t.push(pt[Nt]),_t.push(pt[Nt+1]),_t.push(pt[Nt+2]))}}function Ln(pt,_t,Tt,Rt,It,Nt,jt){for(var kt,Kt,Bt=si(pt),Ie=0===It?Un:$n,wn=pt.start,ce=0;ce<pt.length-3;ce+=3){var _n=pt[ce],pn=pt[ce+1],pi=pt[ce+2],Mi=pt[ce+3],gr=pt[ce+4],Oo=0===It?_n:pn,Li=0===It?Mi:gr,Lr=!1;jt&&(kt=Math.sqrt(Math.pow(_n-Mi,2)+Math.pow(pn-gr,2))),Oo<Tt?Li>Tt&&(Kt=Ie(Bt,_n,pn,Mi,gr,Tt),jt&&(Bt.start=wn+kt*Kt)):Oo>Rt?Li<Rt&&(Kt=Ie(Bt,_n,pn,Mi,gr,Rt),jt&&(Bt.start=wn+kt*Kt)):ai(Bt,_n,pn,pi),Li<Tt&&Oo>=Tt&&(Kt=Ie(Bt,_n,pn,Mi,gr,Tt),Lr=!0),Li>Rt&&Oo<=Rt&&(Kt=Ie(Bt,_n,pn,Mi,gr,Rt),Lr=!0),!Nt&&Lr&&(jt&&(Bt.end=wn+kt*Kt),_t.push(Bt),Bt=si(pt)),jt&&(wn+=kt)}var _r=pt.length-3;_n=pt[_r],pn=pt[_r+1],pi=pt[_r+2],(Oo=0===It?_n:pn)>=Tt&&Oo<=Rt&&ai(Bt,_n,pn,pi),_r=Bt.length-3,Nt&&_r>=3&&(Bt[_r]!==Bt[0]||Bt[_r+1]!==Bt[1])&&ai(Bt,Bt[0],Bt[1],Bt[2]),Bt.length&&_t.push(Bt)}function si(pt){var _t=[];return _t.size=pt.size,_t.start=pt.start,_t.end=pt.end,_t}function Hi(pt,_t,Tt,Rt,It,Nt){for(var jt=0;jt<pt.length;jt++)Ln(pt[jt],_t,Tt,Rt,It,Nt,!1)}function ai(pt,_t,Tt,Rt){pt.push(_t),pt.push(Tt),pt.push(Rt)}function Un(pt,_t,Tt,Rt,It,Nt){var jt=(Nt-_t)/(Rt-_t);return pt.push(Nt),pt.push(Tt+(It-Tt)*jt),pt.push(1),jt}function $n(pt,_t,Tt,Rt,It,Nt){var jt=(Nt-Tt)/(It-Tt);return pt.push(_t+(Rt-_t)*jt),pt.push(Nt),pt.push(1),jt}function mr(pt,_t){for(var Tt=[],Rt=0;Rt<pt.length;Rt++){var It,Nt=pt[Rt],jt=Nt.type;if("Point"===jt||"MultiPoint"===jt||"LineString"===jt)It=wr(Nt.geometry,_t);else if("MultiLineString"===jt||"Polygon"===jt){It=[];for(var kt=0;kt<Nt.geometry.length;kt++)It.push(wr(Nt.geometry[kt],_t))}else if("MultiPolygon"===jt)for(It=[],kt=0;kt<Nt.geometry.length;kt++){for(var Kt=[],Bt=0;Bt<Nt.geometry[kt].length;Bt++)Kt.push(wr(Nt.geometry[kt][Bt],_t));It.push(Kt)}Tt.push(W(Nt.id,jt,It,Nt.tags))}return Tt}function wr(pt,_t){var Tt=[];Tt.size=pt.size,void 0!==pt.start&&(Tt.start=pt.start,Tt.end=pt.end);for(var Rt=0;Rt<pt.length;Rt+=3)Tt.push(pt[Rt]+_t,pt[Rt+1],pt[Rt+2]);return Tt}function kr(pt,_t){if(pt.transformed)return pt;var Tt,Rt,It,Nt=1<<pt.z,jt=pt.x,kt=pt.y;for(Tt=0;Tt<pt.features.length;Tt++){var Kt=pt.features[Tt],Bt=Kt.geometry,Ie=Kt.type;if(Kt.geometry=[],1===Ie)for(Rt=0;Rt<Bt.length;Rt+=2)Kt.geometry.push(Jo(Bt[Rt],Bt[Rt+1],_t,Nt,jt,kt));else for(Rt=0;Rt<Bt.length;Rt++){var wn=[];for(It=0;It<Bt[Rt].length;It+=2)wn.push(Jo(Bt[Rt][It],Bt[Rt][It+1],_t,Nt,jt,kt));Kt.geometry.push(wn)}}return pt.transformed=!0,pt}function Jo(pt,_t,Tt,Rt,It,Nt){return[Math.round(Tt*(pt*Rt-It)),Math.round(Tt*(_t*Rt-Nt))]}function pu(pt,_t,Tt,Rt,It){for(var Nt=_t===It.maxZoom?0:It.tolerance/((1<<_t)*It.extent),jt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Tt,y:Rt,z:_t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},kt=0;kt<pt.length;kt++){jt.numFeatures++,to(jt,pt[kt],Nt,It);var Kt=pt[kt].minX,Bt=pt[kt].minY,Ie=pt[kt].maxX,wn=pt[kt].maxY;Kt<jt.minX&&(jt.minX=Kt),Bt<jt.minY&&(jt.minY=Bt),Ie>jt.maxX&&(jt.maxX=Ie),wn>jt.maxY&&(jt.maxY=wn)}return jt}function to(pt,_t,Tt,Rt){var It=_t.geometry,Nt=_t.type,jt=[];if("Point"===Nt||"MultiPoint"===Nt)for(var kt=0;kt<It.length;kt+=3)jt.push(It[kt]),jt.push(It[kt+1]),pt.numPoints++,pt.numSimplified++;else if("LineString"===Nt)da(jt,It,pt,Tt,!1,!1);else if("MultiLineString"===Nt||"Polygon"===Nt)for(kt=0;kt<It.length;kt++)da(jt,It[kt],pt,Tt,"Polygon"===Nt,0===kt);else if("MultiPolygon"===Nt)for(var Kt=0;Kt<It.length;Kt++){var Bt=It[Kt];for(kt=0;kt<Bt.length;kt++)da(jt,Bt[kt],pt,Tt,!0,0===kt)}if(jt.length){var Ie=_t.tags||null;if("LineString"===Nt&&Rt.lineMetrics){for(var wn in Ie={},_t.tags)Ie[wn]=_t.tags[wn];Ie.mapbox_clip_start=It.start/It.size,Ie.mapbox_clip_end=It.end/It.size}var ce={geometry:jt,type:"Polygon"===Nt||"MultiPolygon"===Nt?3:"LineString"===Nt||"MultiLineString"===Nt?2:1,tags:Ie};null!==_t.id&&(ce.id=_t.id),pt.features.push(ce)}}function da(pt,_t,Tt,Rt,It,Nt){var jt=Rt*Rt;if(Rt>0&&_t.size<(It?jt:Rt))Tt.numPoints+=_t.length/3;else{for(var kt=[],Kt=0;Kt<_t.length;Kt+=3)(0===Rt||_t[Kt+2]>jt)&&(Tt.numSimplified++,kt.push(_t[Kt]),kt.push(_t[Kt+1])),Tt.numPoints++;It&&function(Bt,Ie){for(var wn=0,ce=0,_n=Bt.length,pn=_n-2;ce<_n;pn=ce,ce+=2)wn+=(Bt[ce]-Bt[pn])*(Bt[ce+1]+Bt[pn+1]);if(wn>0===Ie)for(ce=0,_n=Bt.length;ce<_n/2;ce+=2){var pi=Bt[ce],Mi=Bt[ce+1];Bt[ce]=Bt[_n-2-ce],Bt[ce+1]=Bt[_n-1-ce],Bt[_n-2-ce]=pi,Bt[_n-1-ce]=Mi}}(kt,Nt),pt.push(kt)}}function Ya(pt,_t){var Tt=(_t=this.options=function(It,Nt){for(var jt in Nt)It[jt]=Nt[jt];return It}(Object.create(this.options),_t)).debug;if(Tt&&console.time("preprocess data"),_t.maxZoom<0||_t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(_t.promoteId&&_t.generateId)throw new Error("promoteId and generateId cannot be used together.");var It,Nt,jt,kt,Kt,Bt,Rt=function(It,Nt){var jt=[];if("FeatureCollection"===It.type)for(var kt=0;kt<It.features.length;kt++)bt(jt,It.features[kt],Nt,kt);else bt(jt,"Feature"===It.type?It:{geometry:It},Nt);return jt}(pt,_t);this.tiles={},this.tileCoords=[],Tt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",_t.indexMaxZoom,_t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(It=Rt,Nt=_t,jt=Nt.buffer/Nt.extent,kt=It,Kt=ge(It,1,-1-jt,jt,0,-1,2,Nt),Bt=ge(It,1,1-jt,2+jt,0,-1,2,Nt),(Kt||Bt)&&(kt=ge(It,1,-jt,1+jt,0,-1,2,Nt)||[],Kt&&(kt=mr(Kt,1).concat(kt)),Bt&&(kt=kt.concat(mr(Bt,-1)))),Rt=kt).length&&this.splitTile(Rt,0,0,0),Tt&&(Rt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function mu(pt,_t,Tt){return 32*((1<<pt)*Tt+_t)+pt}return Ya.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ya.prototype.splitTile=function(pt,_t,Tt,Rt,It,Nt,jt){for(var kt=[pt,_t,Tt,Rt],Kt=this.options,Bt=Kt.debug;kt.length;){Rt=kt.pop(),Tt=kt.pop(),_t=kt.pop(),pt=kt.pop();var Ie=1<<_t,wn=mu(_t,Tt,Rt),ce=this.tiles[wn];if(!ce&&(Bt>1&&console.time("creation"),ce=this.tiles[wn]=pu(pt,_t,Tt,Rt,Kt),this.tileCoords.push({z:_t,x:Tt,y:Rt}),Bt)){Bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",_t,Tt,Rt,ce.numFeatures,ce.numPoints,ce.numSimplified),console.timeEnd("creation"));var _n="z"+_t;this.stats[_n]=(this.stats[_n]||0)+1,this.total++}if(ce.source=pt,It){if(_t===Kt.maxZoom||_t===It)continue;var pn=1<<It-_t;if(Tt!==Math.floor(Nt/pn)||Rt!==Math.floor(jt/pn))continue}else if(_t===Kt.indexMaxZoom||ce.numPoints<=Kt.indexMaxPoints)continue;if(ce.source=null,0!==pt.length){Bt>1&&console.time("clipping");var pi,Mi,gr,Oo,Li,Lr,_r=.5*Kt.buffer/Kt.extent,eo=.5-_r,Xa=.5+_r,Ti=1+_r;pi=Mi=gr=Oo=null,Li=ge(pt,Ie,Tt-_r,Tt+Xa,0,ce.minX,ce.maxX,Kt),Lr=ge(pt,Ie,Tt+eo,Tt+Ti,0,ce.minX,ce.maxX,Kt),pt=null,Li&&(pi=ge(Li,Ie,Rt-_r,Rt+Xa,1,ce.minY,ce.maxY,Kt),Mi=ge(Li,Ie,Rt+eo,Rt+Ti,1,ce.minY,ce.maxY,Kt),Li=null),Lr&&(gr=ge(Lr,Ie,Rt-_r,Rt+Xa,1,ce.minY,ce.maxY,Kt),Oo=ge(Lr,Ie,Rt+eo,Rt+Ti,1,ce.minY,ce.maxY,Kt),Lr=null),Bt>1&&console.timeEnd("clipping"),kt.push(pi||[],_t+1,2*Tt,2*Rt),kt.push(Mi||[],_t+1,2*Tt,2*Rt+1),kt.push(gr||[],_t+1,2*Tt+1,2*Rt),kt.push(Oo||[],_t+1,2*Tt+1,2*Rt+1)}}},Ya.prototype.getTile=function(pt,_t,Tt){var Rt=this.options,It=Rt.extent,Nt=Rt.debug;if(pt<0||pt>24)return null;var jt=1<<pt,kt=mu(pt,_t=(_t%jt+jt)%jt,Tt);if(this.tiles[kt])return kr(this.tiles[kt],It);Nt>1&&console.log("drilling down to z%d-%d-%d",pt,_t,Tt);for(var Kt,Bt=pt,Ie=_t,wn=Tt;!Kt&&Bt>0;)Bt--,Ie=Math.floor(Ie/2),wn=Math.floor(wn/2),Kt=this.tiles[mu(Bt,Ie,wn)];return Kt&&Kt.source?(Nt>1&&console.log("found parent tile z%d-%d-%d",Bt,Ie,wn),Nt>1&&console.time("drilling down"),this.splitTile(Kt.source,Bt,Ie,wn,pt,_t,Tt),Nt>1&&console.timeEnd("drilling down"),this.tiles[kt]?kr(this.tiles[kt],It):null):null},function(pt,_t){return new Ya(pt,_t)}}();var gp=te.g(hi.exports);function Yn(At,$){const W=At.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);const tt=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!tt)return $(null,null);const bt=new class{constructor($t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=te.E,this.length=$t.length,this._features=$t}feature($t){return new class{constructor(ne){this._feature=ne,this.extent=te.E,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(1===this._feature.type){const ne=[];for(const Ct of this._feature.geometry)ne.push([new te.P(Ct[0],Ct[1])]);return ne}{const ne=[];for(const Ct of this._feature.geometry){const ae=[];for(const ge of Ct)ae.push(new te.P(ge[0],ge[1]));ne.push(ae)}return ne}}toGeoJSON(ne,Ct,ae){return Wl.call(this,ne,Ct,ae)}}(this._features[$t])}}(tt.features);let Mt=qa(bt);0===Mt.byteOffset&&Mt.byteLength===Mt.buffer.byteLength||(Mt=new Uint8Array(Mt)),$(null,{vectorTile:bt,rawData:Mt.buffer})}class du extends te.d{constructor($,W,tt,bt,Mt,$t){super($,W,tt,bt,Yn,$t),Mt&&(this.loadGeoJSON=Mt)}loadData($,W){const tt=$&&$.request,bt=tt&&tt.collectResourceTiming;this.loadGeoJSON($,(Mt,$t)=>{if(Mt||!$t)return W(Mt);if("object"!=typeof $t)return W(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));{ha($t,!0);try{if($.filter){const Ct=te.e($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ct.result)throw new Error(Ct.value.map(ge=>`${ge.key}: ${ge.message}`).join(", "));$t={type:"FeatureCollection",features:$t.features.filter(ge=>Ct.value.evaluate({zoom:0},ge))}}this._geoJSONIndex=$.cluster?new Os(function({superclusterOptions:Ct,clusterProperties:ae}){if(!ae||!Ct)return Ct;const ge={},_e={},Ln={accumulated:null,zoom:0},si={properties:null},Hi=Object.keys(ae);for(const ai of Hi){const[Un,$n]=ae[ai],mr=te.e($n),wr=te.e("string"==typeof Un?[Un,["accumulated"],["get",ai]]:Un);ge[ai]=mr.value,_e[ai]=wr.value}return Ct.map=ai=>{si.properties=ai;const Un={};for(const $n of Hi)Un[$n]=ge[$n].evaluate(Ln,si);return Un},Ct.reduce=(ai,Un)=>{si.properties=Un;for(const $n of Hi)Ln.accumulated=ai[$n],ai[$n]=_e[$n].evaluate(Ln,si)},Ct}($)).load($t.features):gp($t,$.geojsonVtOptions)}catch(Ct){return W(Ct)}this.loaded={};const ne={};if(bt){const Ct=te.f(tt);Ct&&(ne.resourceTiming={},ne.resourceTiming[$.source]=JSON.parse(JSON.stringify(Ct)))}W(null,ne)}})}reloadTile($,W){const tt=this.loaded;return tt&&tt[$.uid]?super.reloadTile($,W):this.loadTile($,W)}loadGeoJSON($,W){if($.request)te.h($.request,W);else{if("string"!=typeof $.data)return W(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));try{return W(null,JSON.parse($.data))}catch{return W(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom($,W){try{W(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(tt){W(tt)}}getClusterChildren($,W){try{W(null,this._geoJSONIndex.getChildren($.clusterId))}catch(tt){W(tt)}}getClusterLeaves($,W){try{W(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(tt){W(tt)}}}class Bi{constructor($,W){this.tileID=new te.O($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=$.projection,this.brightness=W}parse($,W,tt,bt){this.status="parsing";const Mt=new te.O(tt.tileID.overscaledZ,tt.tileID.wrap,tt.tileID.canonical.z,tt.tileID.canonical.x,tt.tileID.canonical.y),$t={},ne=W.familiesBySource[tt.source],Ct=new te.F(Mt,tt.promoteId);return Ct.bucketLayerIDs=[],te.l($).then(ae=>{if(!ae)return bt(new Error("Could not parse tile"));const ge=te.j(ae,1/te.t(tt.tileID.canonical)),_e=ae.json.extensionsUsed&&ae.json.extensionsUsed.includes("MAPBOX_mesh_features"),Ln=new te.k(this.zoom,{brightness:this.brightness});for(const si in ne)for(const Hi of ne[si]){const ai=Hi[0],Un=ae.json.extensionsUsed;ai.recalculate(Ln,[]);const $n=new te.T(ge,Mt,Un&&Un.includes("MAPBOX_mesh_features"),this.brightness);_e||($n.needsUpload=!0),$t[ai.fqid]=$n,$n.evaluate(ai)}this.status="done",bt(null,{buckets:$t,featureIndex:Ct})}).catch(ae=>bt(new Error(ae.message)))}}class Wa{constructor($,W,tt,bt,Mt,$t){this.actor=$,this.layerIndex=W,this.brightness=$t,this.loading={},this.loaded={}}loadTile($,W){const tt=$.uid,bt=this.loading[tt]=new Bi($,this.brightness);te.i($.request,(Mt,$t)=>{const ne=!this.loading[tt];return delete this.loading[tt],ne||Mt?(bt.status="done",ne||(this.loaded[tt]=bt),W(Mt)):$t&&0!==$t.byteLength?void bt.parse($t,this.layerIndex,$,(Ct,ae)=>{bt.status="done",this.loaded=this.loaded||{},this.loaded[tt]=bt,Ct||!ae?W(Ct):W(null,ae)}):(bt.status="done",this.loaded[tt]=bt,W())})}reloadTile($,W){const tt=this.loaded,bt=$.uid;if(tt&&tt[bt]){const Mt=tt[bt];Mt.projection=$.projection,Mt.brightness=$.brightness;const $t=(ne,Ct)=>{Mt.reloadCallback&&(delete Mt.reloadCallback,this.loadTile($,W)),W(ne,Ct)};"parsing"===Mt.status?Mt.reloadCallback=$t:"done"===Mt.status&&this.loadTile($,W)}}abortTile($,W){const tt=$.uid;this.loading[tt]&&delete this.loading[tt],W()}removeTile($,W){const tt=this.loaded,bt=$.uid;tt&&tt[bt]&&delete tt[bt],W()}}class fu{constructor($){this.self=$,this.actor=new te.A($,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=te.m({name:"mercator"}),this.workerSourceTypes={vector:te.d,geojson:du,"batched-model":Wa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(W,tt)=>{if(this.workerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.workerSourceTypes[W]=tt},this.self.registerRTLTextPlugin=W=>{if(te.n.isParsed())throw new Error("RTL text plugin already registered.");te.n.applyArabicShaping=W.applyArabicShaping,te.n.processBidirectionalText=W.processBidirectionalText,te.n.processStyledBidirectionalText=W.processStyledBidirectionalText}}clearCaches($,W,tt){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],tt()}checkIfReady($,W,tt){tt()}setReferrer($,W){this.referrer=W}spriteLoaded($,{scope:W,isLoaded:tt}){if(this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.isSpriteLoaded[$][W]=tt,this.workerSources[$]&&this.workerSources[$][W])for(const bt in this.workerSources[$][W]){const Mt=this.workerSources[$][W][bt];for(const $t in Mt)Mt[$t]instanceof te.d&&(Mt[$t].isSpriteLoaded=tt,Mt[$t].fire(new te.o("isSpriteLoaded")))}}setImages($,{scope:W,images:tt},bt){if(this.availableImages[$]||(this.availableImages[$]={}),this.availableImages[$][W]=tt,this.workerSources[$]&&this.workerSources[$][W]){for(const Mt in this.workerSources[$][W]){const $t=this.workerSources[$][W][Mt];for(const ne in $t)$t[ne].availableImages=tt}bt()}else bt()}setProjection($,W){this.projections[$]=te.m(W)}setBrightness($,W,tt){this.brightness=W,tt()}setLayers($,W,tt){this.getLayerIndex($,W.scope).replace(W.layers,W.options),tt()}updateLayers($,W,tt){this.getLayerIndex($,W.scope).update(W.layers,W.removedIds,W.options),tt()}loadTile($,W,tt){W.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,W.type,W.source,W.scope).loadTile(W,tt)}loadDEMTile($,W,tt){this.getDEMWorkerSource($,W.source,W.scope).loadTile(W,tt)}reloadTile($,W,tt){W.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,W.type,W.source,W.scope).reloadTile(W,tt)}abortTile($,W,tt){this.getWorkerSource($,W.type,W.source,W.scope).abortTile(W,tt)}removeTile($,W,tt){this.getWorkerSource($,W.type,W.source,W.scope).removeTile(W,tt)}removeSource($,W,tt){if(!(this.workerSources[$]&&this.workerSources[$][W.scope]&&this.workerSources[$][W.scope][W.type]&&this.workerSources[$][W.scope][W.type][W.source]))return;const bt=this.workerSources[$][W.scope][W.type][W.source];delete this.workerSources[$][W.scope][W.type][W.source],void 0!==bt.removeSource?bt.removeSource(W,tt):tt()}loadWorkerSource($,W,tt){try{this.self.importScripts(W.url),tt()}catch(bt){tt(bt.toString())}}syncRTLPluginState($,W,tt){try{te.n.setState(W);const bt=te.n.getPluginURL();if(te.n.isLoaded()&&!te.n.isParsed()&&null!=bt){this.self.importScripts(bt);const Mt=te.n.isParsed();tt(Mt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${bt}`),Mt)}}catch(bt){tt(bt.toString())}}setDracoUrl($,W){this.dracoUrl=W}getAvailableImages($,W){this.availableImages[$]||(this.availableImages[$]={});let tt=this.availableImages[$][W];return tt||(tt=[]),tt}getLayerIndex($,W){this.layerIndexes[$]||(this.layerIndexes[$]={});let tt=this.layerIndexes[$][W];return tt||(tt=this.layerIndexes[$][W]=new Ms,tt.scope=W),tt}getWorkerSource($,W,tt,bt){return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][bt]||(this.workerSources[$][bt]={}),this.workerSources[$][bt][W]||(this.workerSources[$][bt][W]={}),this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.workerSources[$][bt][W][tt]||(this.workerSources[$][bt][W][tt]=new this.workerSourceTypes[W]({send:($t,ne,Ct,ae,ge,_e)=>{this.actor.send($t,ne,Ct,$,ge,_e)},scheduler:this.actor.scheduler},this.getLayerIndex($,bt),this.getAvailableImages($,bt),this.isSpriteLoaded[$][bt],void 0,this.brightness)),this.workerSources[$][bt][W][tt]}getDEMWorkerSource($,W,tt){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][tt]||(this.demWorkerSources[$][tt]={}),this.demWorkerSources[$][tt][W]||(this.demWorkerSources[$][tt][W]=new Le),this.demWorkerSources[$][tt][W]}enforceCacheSizeLimit($,W){te.q(W)}getWorkerPerformanceMetrics($,W,tt){tt(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new fu(self)),fu}),qh(0,function(te){return te.s}),Pn}()}},p_=>{p_(p_.s=961)}]);